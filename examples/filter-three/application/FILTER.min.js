/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.3
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/
var FILTER=FILTER||{};
(function(c){var d,l=Math.min;d={normal:function(b){return b},lighten:function(b,a){return a>b?a:b},darken:function(b,a){return a>b?b:a},multiply:function(b,a){return b*a*0.003921568627451},average:function(b,a){return 0.5*(b+a)},add:function(b,a){return Math.min(255,b+a)},substract:function(b,a){return b+a<255?0:b+a-255},difference:function(b,a){return Math.abs(b-a)},negation:function(b,a){return 255-Math.abs(255-b-a)},screen:function(b,a){return 255-((255-b)*(255-a)>>8)},exclusion:function(b,a){return b+
a-2*b*a*0.003921568627451},overlay:function(b,a){return a<128?2*b*a*0.003921568627451:255-2*(255-b)*(255-a)*0.003921568627451},softLight:function(b,a){return a<128?2*((b>>1)+64)*a*0.003921568627451:255-2*(255-((b>>1)+64))*(255-a)*0.003921568627451},hardLight:function(b,a){return b<128?2*a*b*0.003921568627451:255-2*(255-a)*(255-b)*0.003921568627451},colorDodge:function(b,a){return a==255?a:Math.min(255,(b<<8)/(255-a))},colorBurn:function(b,a){return a==0?a:Math.max(0,255-(255-b<<8)/a)},linearLight:function(b,
a){return a<128?d.linearBurn(b,2*a):d.linearDodge(b,2*(a-128))},vividLight:function(b,a){return a<128?d.colorBurn(b,2*a):d.colorDodge(b,2*(a-128))},pinLight:function(b,a){return a<128?d.darken(b,2*a):d.lighten(b,2*(a-128))},hardMix:function(b,a){return d.vividLight(b,a)<128?0:255},reflect:function(b,a){return a==255?a:Math.min(255,b*b/(255-a))},glow:function(b,a){return b==255?b:Math.min(255,a*a/(255-b))},phoenix:function(b,a){return Math.min(b,a)-Math.max(b,a)+255}};d.linearDodge=d.add;d.linearBurn=
d.substract;c.blendModes=d;c.Image=function(b,a){this.height=this.width=0;this.imageData=this.context=null;this.canvasElement=document.createElement("canvas");this.canvasElement.width=0;this.canvasElement.height=0;this.context=this.canvasElement.getContext("2d");this._integral=this._histogram=null;this._integralRefresh=this._histogramRefresh=!0;this.setImage(b,a)};c.Image.prototype={getData:function(){return new c.ImArray(this.imageData.data)},setData:function(b){this.imageData.data.set(b);this.context.putImageData(this.imageData,
0,0);this._integralRefresh=this._histogramRefresh=!0;return this},getPixelData:function(){return this.imageData},setPixelData:function(b){this.context.putImageData(b,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setWidth:function(b){this.width=b;this.canvasElement.width=this.width;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=
this._histogramRefresh=!0;return this},setHeight:function(b){this.height=b;this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setImage:function(b,a){if(typeof b=="undefined"||b==null)return this;var j=this,d;b instanceof Image||b instanceof HTMLCanvasElement||b instanceof HTMLVideoElement?(d=b,this.width=b.width,this.height=b.height,
this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.context=this.canvasElement.getContext("2d"),this.context.drawImage(d,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._integralRefresh=this._histogramRefresh=!0):(d=new Image,d.onload=function(){j.width=d.width;j.height=d.height;j.canvasElement.width=j.width;j.canvasElement.height=j.height;j.context=j.canvasElement.getContext("2d");j.context.drawImage(d,0,0);j.imageData=j.context.getImageData(0,
0,j.width,j.height);j._histogramRefresh=!0;j._integralRefresh=!0;typeof a!="undefined"&&a.call(j)},d.src=b);d.crossOrigin="";return this},blend:function(b,a,j,c,g){typeof a=="undefined"&&(a="normal");typeof j=="undefined"&&(j=1);j>1&&(j=1);j<0&&(j=0);typeof c=="undefined"&&(c=0);typeof g=="undefined"&&(g=0);var h=0,e=0;c<0&&(h=-c,c=0);g<0&&(e=-g,g=0);if(!(c>=this.width||g>=this.height)){a=d[a];if(a==void 0||a==null)return this;var o=l(this.width,b.width-h),m=l(this.height,b.height-e),D=this.context.getImageData(c,
g,o,m),h=b.context.getImageData(h,e,o,m),b=D.data,h=h.data,t,r,v,x=1-j,w=h.length,q;for(q=0;q<w;q+=4)t=b[q],r=b[q+1],v=b[q+2],e=a(h[q],t),o=a(h[q+1],r),m=a(h[q+2],v),b[q]=e*j+t*x,b[q+1]=o*j+r*x,b[q+2]=m*j+v*x;this.context.putImageData(D,c,g);this._integralRefresh=this._histogramRefresh=!0;return this}},_refresh:function(){this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);return this},clone:function(){return new c.Image(this.canvasElement)},
integral:function(){this._integralRefresh&&this._computeIntegral();return this._integral},_computeIntegral:function(){var b=this.width,a=this.height,j=new c.Array32U(b*a),d=this.getPixelData().data,g,h,e,l,m;for(l=e=h=g=0;g<b;)ii=g+e,m=ii<<2,m=4899*d[m]+9617*d[m+1]+1868*d[m+2]+8192>>>14,l+=(m&255)>>>0,j[ii]=g>0?j[ii-1]+l:l,h++,e+=b,a==h&&(g++,l=e=h=0);this._integral=j;this._integralRefresh=!1},histogram:function(){this._histogramRefresh&&this._computeHistogram();return this._histogram},_computeHistogram:function(){for(var b=
this.getPixelData().data,a=0,j=b.length,d=new c.ImArray(256),g=new c.ImArray(256),h=new c.ImArray(256),e,l,m,a=0;a<256;)d[a]=0,g[a]=0,h[a]=0,a++;for(a=0;a<j;)e=b[a],l=b[a+1],m=b[a+2],d[e]++,g[l]++,h[m]++,a+=4;this._histogram=[d,g,h];this._histogramRefresh=!1},createImageData:function(b,a){this.width=b;this.height=a;this.canvasElement.width=this.width;this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.context.createImageData(b,a);return this.imageData=this.context.getImageData(0,
0,this.width,this.height)},scale:function(){return this}}})(FILTER);
(function(c){c.Color={blend:function(d,c,b){return{red:d.red-~~((d.red-c.red)*b+0.5),green:d.green-~~((d.green-c.green)*b+0.5),blue:d.blue-~~((d.blue-c.blue)*b+0.5)}},distance:function(d,c){var b=d.red-c.red,a=d.green-c.green,j=d.blue-c.blue;return Math.sqrt(b*b+a*a+j*j)},RGBA2Color:function(d){return typeof d.alpha!="undefined"?(d.alpha<<24)+(d.red<<16)+(d.green<<8)+d.blue:(d.red<<16)+(d.green<<8)+d.blue},Color2RGBA:function(d){d=~~d;return{red:d>>16&255,green:d>>8&255,blue:d&255,alpha:d>>24&255}},
RGB2YCbCr:function(d){var c=d.red,b=d.green,d=d.blue;return{Y:~~(0.299*c+0.587*b+0.114*d),Cb:~~(128-0.169*c-0.331*b+0.5*d),Cr:~~(128+0.5*c-0.42*b-0.08*d)}},YCbCr2RGB:function(d){var c=d.Y,b=d.Cb,d=d.Cr;return{red:~~(c+1.4(d-128)),green:~~(c-0.343*(b-128)-0.711*(d-128)),blue:~~(c+1.765*(b-128))}},RGB2HSV:function(d){var c=d.red*0.00392156862745098,b=d.green*0.00392156862745098,a=d.blue*0.00392156862745098,j;j=c<b?c<a?c:a:b<a?b:a;d=c>b?c>a?c:a:b>a?b:a;if(j==d)return{H:NaN,S:0,V:d};c=((c==j?3:b==j?5:
1)-(c==j?b-a:b==j?a-c:c-b)/(d-j))*60;c>=360?c-=360:c<0&&(c+=360);$=(d-j)/d;return{H:c,S:void 0,V:d}}}})(FILTER);
(function(c){c.Array32F=typeof Float32Array!=="undefined"?Float32Array:Array;c.Array64F=typeof Float64Array!=="undefined"?Float64Array:Array;c.Array8I=typeof Int8Array!=="undefined"?Int8Array:Array;c.Array16I=typeof Int16Array!=="undefined"?Int16Array:Array;c.Array32I=typeof Int32Array!=="undefined"?Int32Array:Array;c.Array8U=typeof Uint8Array!=="undefined"?Uint8Array:Array;c.Array16U=typeof Uint16Array!=="undefined"?Uint16Array:Array;c.Array32U=typeof Uint32Array!=="undefined"?Uint32Array:Array;
c.ImArray=typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:c.Array8U;c.CONSTANTS={SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI};c.Filter=function(){};c.Filter.prototype={apply:function(){}};c.CompositeFilter=function(b){this._stack=typeof b!="undefined"&&b.length?b:[]};c.CompositeFilter.prototype={_stack:[],apply:function(b){if(this._stack.length){for(var a=b.getData(),c=b.width,d=b.height,g=this._stack,h=g.length,e=0,l;e<h;)(l=g[e++])&&(a=l._apply(a,c,d));b.setData(a)}},filters:function(b){if(b)this._stack=
b;return this},push:function(b){this._stack.push(b);return this},pop:function(){return this._stack.pop()},remove:function(b){for(var a=this._stack.length;--a>=0;)b===this._stack[a]&&this._stack.splice(a,1);return this}};var d=null,l=null;c.static={createImageData:function(b,a){d||(d=document.createElement("canvas"),l=d.getContext("2d"));return l.createImageData(b,a)}}})(FILTER);
(function(c){c.LUMA={R:0.212671,G:0.71516,B:0.072169};var d=c.Array32F,l=c.CONSTANTS.toRad;c.ColorMatrixFilter=function(b){this.matrix=typeof b!="undefined"&&b.length?new d(b):null};c.ColorMatrixFilter.prototype={desaturate:function(){return this.concat([c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,0,0,0,1,0])},grayscale:function(){return this.desaturate()},colorize:function(b,a){var d,k,g,h;typeof a=="undefined"&&(a=1);d=(b>>16&255)*0.00392156862745098;
k=(b>>8&255)*0.00392156862745098;g=(b&255)*0.00392156862745098;h=1-a;return this.concat([h+a*d*c.LUMA.R,a*d*c.LUMA.G,a*d*c.LUMA.B,0,0,a*k*c.LUMA.R,h+a*k*c.LUMA.G,a*k*c.LUMA.B,0,0,a*g*c.LUMA.R,a*g*c.LUMA.G,h+a*g*c.LUMA.B,0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},saturate:function(b){var a,d,k;a=1-b;d=a*c.LUMA.R;k=a*c.LUMA.G;a*=c.LUMA.B;return this.concat([d+b,k,a,0,0,d,k+b,a,0,0,d,k,a+b,0,0,0,0,0,1,0])},contrast:function(b,a,d){typeof a==
"undefined"&&(a=b);typeof d=="undefined"&&(d=b);b+=1;a+=1;d+=1;return this.concat([b,0,0,0,128*(1-b),0,a,0,0,128*(1-a),0,0,d,0,128*(1-d),0,0,0,1,0])},brightness:function(b,a,d){typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);return this.concat([1,0,0,0,b,0,1,0,0,a,0,0,1,0,d,0,0,0,1,0])},adjustHue:function(b){b*=l;var a=Math.cos(b),b=Math.sin(b);return this.concat([c.LUMA.R+a*(1-c.LUMA.R)+b*-c.LUMA.R,c.LUMA.G+a*-c.LUMA.G+b*-c.LUMA.G,c.LUMA.B+a*-c.LUMA.B+b*(1-c.LUMA.B),0,0,c.LUMA.R+a*-c.LUMA.R+
b*0.143,c.LUMA.G+a*(1-c.LUMA.G)+b*0.14,c.LUMA.B+a*-c.LUMA.B+b*-0.283,0,0,c.LUMA.R+a*-c.LUMA.R+b*-(1-c.LUMA.R),c.LUMA.G+a*-c.LUMA.G+b*c.LUMA.G,c.LUMA.B+a*(1-c.LUMA.B)+b*c.LUMA.B,0,0,0,0,0,1,0])},average:function(b,a,d){typeof b=="undefined"&&(b=0.3333);typeof a=="undefined"&&(a=0.3333);typeof d=="undefined"&&(d=0.3334);return this.concat([b,a,d,0,0,b,a,d,0,0,b,a,d,0,0,0,0,0,1,0])},quickContrastCorrection:function(b){typeof b=="undefined"&&(b=1.2);return this.concat([b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,
0,0,1,0])},quickSepia:function(b,a,d){typeof b=="undefined"&&(b=1);typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);return this.concat([b*0.5,0.5,0.5,0,0,0.33,a*0.33,0.33,0,0,0.25,0.25,d*0.25,0,0,0,0,0,1,0])},quickSepia2:function(b,a,d){typeof b=="undefined"&&(b=1);typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);return this.concat([b*0.3930000066757202,0.7689999938011169,0.1889999955892563,0,0,0.3490000069141388,a*0.6859999895095825,0.1679999977350235,0,0,0.2720000147819519,0.5339999794960022,
d*0.1309999972581863,0,0,0,0,0,1,0])},threshold:function(b,a){typeof a=="undefined"&&(a=256);return this.concat([c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*b,c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*b,c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*b,0,0,0,1,0])},threshold_rgb:function(b,a){typeof a=="undefined"&&(a=256);return this.concat([a,0,0,0,-(a-1)*b,0,a,0,0,-(a-1)*b,0,0,a,0,-(a-1)*b,0,0,0,1,0])},threshold_alpha:function(b,a){typeof b=="undefined"&&(b=0.5);typeof a=="undefined"&&(a=256);return this.concat([1,
0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,a,-a*b])},blend:function(b,a){var c;if(this.matrix){c=this.matrix;for(var k=b.matrix,g=1-a,h=0,e=new d(20);h<20;)e[h]=g*c[h]+a*k[h],h++;c=e}else c=new d(b.matrix);this.matrix=c;return this},reset:function(){this.matrix=null;return this},concat:function(b){var a;if(this.matrix){a=this.matrix;var b=new d(b),c=new d(20),k,g,h,e,l;k=b[0];g=b[1];h=b[2];e=b[3];l=b[4];c[0]=k*a[0]+g*a[5]+h*a[10]+e*a[15];c[1]=k*a[1]+g*a[6]+h*a[11]+e*a[16];c[2]=k*a[2]+g*a[7]+h*a[12]+e*a[17];
c[3]=k*a[3]+g*a[8]+h*a[13]+e*a[18];c[4]=k*a[4]+g*a[9]+h*a[14]+e*a[19]+l;k=b[5];g=b[6];h=b[7];e=b[8];l=b[9];c[5]=k*a[0]+g*a[5]+h*a[10]+e*a[15];c[6]=k*a[1]+g*a[6]+h*a[11]+e*a[16];c[7]=k*a[2]+g*a[7]+h*a[12]+e*a[17];c[8]=k*a[3]+g*a[8]+h*a[13]+e*a[18];c[9]=k*a[4]+g*a[9]+h*a[14]+e*a[19]+l;k=b[10];g=b[11];h=b[12];e=b[13];l=b[14];c[10]=k*a[0]+g*a[5]+h*a[10]+e*a[15];c[11]=k*a[1]+g*a[6]+h*a[11]+e*a[16];c[12]=k*a[2]+g*a[7]+h*a[12]+e*a[17];c[13]=k*a[3]+g*a[8]+h*a[13]+e*a[18];c[14]=k*a[4]+g*a[9]+h*a[14]+e*a[19]+
l;k=b[15];g=b[16];h=b[17];e=b[18];l=b[19];c[15]=k*a[0]+g*a[5]+h*a[10]+e*a[15];c[16]=k*a[1]+g*a[6]+h*a[11]+e*a[16];c[17]=k*a[2]+g*a[7]+h*a[12]+e*a[17];c[18]=k*a[3]+g*a[8]+h*a[13]+e*a[18];c[19]=k*a[4]+g*a[9]+h*a[14]+e*a[19]+l;a=c}else a=new d(b);this.matrix=a;return this},_apply:function(b){if(!this.matrix)return b;for(var a=b.length,c=this.matrix,d=0,g,h,e,l;d<a;)g=b[d],h=b[d+1],e=b[d+2],l=b[d+3],b[d]=c[0]*g+c[1]*h+c[2]*e+c[3]*l+c[4],b[d+1]=c[5]*g+c[6]*h+c[7]*e+c[8]*l+c[9],b[d+2]=c[10]*g+c[11]*h+c[12]*
e+c[13]*l+c[14],b[d+3]=c[15]*g+c[16]*h+c[17]*e+c[18]*l+c[19],d+=4;return b},apply:function(b){if(!this.matrix)return b;return b.setData(this._apply(b.getData(),b.width,b.height))}}})(FILTER);
(function(c){function d(a){var b=o.length,c,d;a--;if(a<b)c=o[a].slice();else for(c=new e(o[b-1]);b<=a;){d=c.slice();c=[1];i=0;for(il=d.length-1;i<il;i++)c.push(d[i]+d[i+1]);c.push(1);b<12&&o.push(c.slice());b++}return c}function l(a){var b,c=-(a>>1),d=Array(a);for(b=0;b<a;b++)d[b]=c,c++;return d}function b(a,c){var d,e,g=a.length,h,j=[],k=0;if(typeof a[0].length=="undefined")for(d=0;d<g;d++)for(e=0;e<g;e++)h=a[d]*c[e],k+=h,j.push(h);else for(d=0;d<g;d++)for(e=0;e<g;e++)h=b(a[d],c[e]),k+=h.sum,j=j.concat(h.ker);
return{kernel:j,sum:k}}function a(a){a=d(a);return b(a,a)}function j(a,c){var e=d(a),h=l(a);return 1==c?b(h.reverse(),e):b(e,h)}function k(a,c){var d,e=Array(a);for(d=0;d<a;d++)e[d]=1;d=l(a);return 1==c?b(d.reverse(),e):b(e,d)}function g(a,b,c,d){var h=a.length,g,j=new e(a.length),c=c||1,d=d||1;for(g=0;g<h;g++)j[g]=c*a[g]+d*b[g];return j}function h(a,b){var b=b||1,c=a*a,d,g=new e(c);for(d=0;d<c;d++)g[d]=b;return g}var e=c.Array32F,o=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,
20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],m=c.CONSTANTS.toRad;c.ConvolutionMatrixFilter=function(a,b){this.factor=b||1;typeof a!="undefined"&&a.length?(this.matrix=new e(a),this.dim=~~(Math.sqrt(a.length)+0.5)):(this.matrix=null,this.dim=0);this.auxMatrix=null;this._isGrad=!1};c.ConvolutionMatrixFilter.prototype={lowPass:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(h(a),1/(a*a),a)},highPass:function(a,b){var a=typeof a=="undefined"?3:a%2?a:a+1,c=a*a,d=-(typeof b==
"undefined"?1:b)/c,e=h(a,d);e[c>>2]=1+d;return this.set(e,1,a)},boxBlur:function(a){return this.lowPass(a)},binomialLowPass:function(b){var b=typeof b=="undefined"?3:b%2?b:b+1,c=a(b);return this.set(new e(c.kernel),1/c.sum,b)},binomialHighPass:function(b){var b=typeof b=="undefined"?3:b%2?b:b+1,c=a(b);return this.set(g(h(b),new e(c.kernel),1,-1/c.sum),1,b)},gaussBlur:function(a){return this.binomialLowPass(a)},sharpen:function(a,b){b=typeof b=="undefined"?0.5:b;return b<=0?this.set([0,-2,0,-2,10,
-2,0,-2,0],0.5,3):this.highPass(a,b)},prewittX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=k(a,0);return this.set(new e(b.kernel),1,a)},prewittY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=k(a,1);return this.set(new e(b.kernel),1,a)},prewittDirectional:function(a,b){a=typeof a=="undefined"?3:a%2?a:a+1;b*=m;var c=Math.cos(b),d=Math.sin(b),h=k(a,0),j=k(a,1);return this.set(g(new e(h.kernel),new e(j.kernel),c,d),1,a)},prewitt:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=
k(a,0),c=k(a,1);this.set(new e(b.kernel),1,a);this._isGrad=!0;this.auxMatrix=new e(c.kernel);return this},gradX:function(a){return this.prewittX(a)},gradY:function(a){return this.prewittY(a)},gradDirectional:function(a,b){return this.prewittDirectional(a,b)},grad:function(a){return this.prewitt(a)},sobelX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=j(a,0);return this.set(new e(b.kernel),1,a)},sobelY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=j(a,1);return this.set(new e(b.kernel),
1,a)},sobelDirectional:function(a,b){a=typeof a=="undefined"?3:a%2?a:a+1;b*=m;var c=Math.cos(b),d=Math.sin(b),h=j(a,0),k=j(a,1);return this.set(g(new e(h.kernel),new e(k.kernel),c,d),1,a)},sobel:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=j(a,0),c=j(a,1);this.set(new e(b.kernel),1,a);this.auxMatrix=new e(c.kernel);this._isGrad=!0;return this},laplace:function(){return this.set([0,-1,0,-1,4,-1,0,-1,0],1,3)},emboss:function(a,b){var b=1,c=(typeof a=="undefined"||a!=1&&a!=-1?1:a)*b;return this.set([-c*
2,-c*1,0,-c*1,b*1,c*1,0,c*1,c*2],1,3)},embossHigh:function(){return this.emboss(1)},embossLow:function(){return this.emboss(-1)},edges:function(){return this.set([0,1,0,1,-4,1,0,1,0],1,3)},edges2:function(){return this.set([0,2,0,2,-8,2,0,2,0],0.5,3)},motionblur:function(a){var b=new e(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);if(a==0)for(a=0;a<9;a++)b[36+a]=1;else if(a==2)for(a=
0;a<9;a++)b[9*a+5]=1;else if(a==1)for(a=0;a<9;a++)b[9*a+a]=1;return this.set(b,1/9,9)},reset:function(){this.auxMatrix=this.matrix=null;this.dim=0;return this},set:function(a,b,c){this.matrix=new e(a);this.factor=b;this.dim=c;this.auxMatrix=null;this._isGrad=!1;return this},_apply:function(a,b,d){if(!this.matrix)return a;var e=this.dim,h=e>>1,g=new c.ImArray(a.length),j,k,l,m,p,o=0,s=0,C=0,E=0,G=0,H=0,z,y,B,F,J,L,M,I=Math.abs;for(k=L=0;k<d;k++){for(j=0;j<b;j++){m=k;l=j;p=L+j<<2;for(y=H=G=E=J=C=s=
o=0;y<e;y++){z=m+y-h;if(z>=0&&z<d){M=z*b;for(z=0;z<e;z++)B=l+z-h,B>=0&&B<b&&(B=M+B<<2,F=this.matrix[J+z],o+=a[B]*F,s+=a[B+1]*F,C+=a[B+2]*F,this.auxMatrix&&(F=this.auxMatrix[J+z],E+=a[B]*F,G+=a[B+1]*F,H+=a[B+2]*F))}J+=e}this._isGrad?(g[p]=this.factor*(I(o)+I(E)),g[p+1]=this.factor*(I(s)+I(G)),g[p+2]=this.factor*(I(C)+I(H))):(g[p]=this.factor*o,g[p+1]=this.factor*s,g[p+2]=this.factor*C);g[p+3]=a[p+3]}L+=b}return g},apply:function(a){if(!this.matrix)return a;return a.setData(this._apply(a.getData(),
a.width,a.height))}}})(FILTER);
(function(c){c.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3};c.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4};var d=Math.min;c.DisplacementMapFilter=function(c){this.map=c};c.DisplacementMapFilter.prototype={scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:c.MODE.CLAMP,map:null,_apply:function(l,b,a){if(!this.map)return l;var j=this.map.getData(),k=this.map.width,g=this.map.height,h=d(k,b),g=d(g,a),e=this.scaleX*0.00390625,o=this.scaleY*0.00390625,m=this.color>>24&255,D=this.color>>16&
255,t=this.color>>8&255,r=this.color&255,v=~~this.startY,x=~~this.startX,w=this.componentX,q=this.componentY,n=this.mode,u,A,p,K,s,C,E,G,H,z=v*b,y=new c.ImArray(l.length);for(E=H=G=0;E<g;E++){A=E+v;if(A>=0&&A<a)for(C=0;C<h;C++)if(u=C+x,!(u<0||u>=b)){p=H+z+u<<2;K=G+C<<2;s=A+~~((j[K+q]-128)*o);u+=~~((j[K+w]-128)*e);if(s>=a||s<0||u>=b||u<0)switch(n){case c.MODE.IGNORE:continue;case c.MODE.COLOR:y[p]=D;y[p+1]=t;y[p+2]=r;y[p+3]=m;continue;case c.MODE.WRAP:s>=a&&(s-=a);s<0&&(s+=a);u>=b&&(u-=b);u<0&&(u+=
b);break;default:s>=a&&(s=a-1),s<0&&(s=0),u>=b&&(u=b-1),u<0&&(u=0)}s=s*b+u<<2;y[p]=l[s];y[p+1]=l[s+1];y[p+2]=l[s+2];y[p+3]=l[s+3]}G+=k;H+=b}return y},apply:function(c){if(!this.map)return c;return c.setData(this._apply(c.getData(),c.width,c.height))}}})(FILTER);
(function(c){c.NonLinearFilter=function(c){this.func=c;this.isMaximum=this.isMinimum=this.isMedian=!1;this.dim=0};c.NonLinearFilter.prototype={median:function(c){this.isMedian=!0;this.isMaximum=this.isMinimum=!1;this.dim=typeof c=="undefined"?3:c%2?c:c+1;return this},erode:function(c){this.isMedian=!1;this.isMinimum=!0;this.isMaximum=!1;this.dim=typeof c=="undefined"?3:c%2?c:c+1;return this},dilate:function(c){this.isMinimum=this.isMedian=!1;this.isMaximum=!0;this.dim=typeof c=="undefined"?3:c%2?
c:c+1;return this},_apply:function(d,l,b){if(this.isMedian){var a=this.dim,j=a>>1,k=new c.ImArray(d.length),g=l,h=b,e,o,m,D,t,r=[],v=[],x=[],w,q,n,u,A,p;for(o=A=0;o<h;o++){for(e=0;e<g;e++){D=o;m=e;t=A+e<<2;r.length=0;v.length=0;for(q=u=x.length=0;q<a;q++){w=D+q-j;if(w>=0&&w<b){p=w*l;for(w=0;w<a;w++)n=m+w-j,n>=0&&n<l&&(n=p+n<<2,r.push(d[n]),v.push(d[n+1]),x.push(d[n+2]))}u+=a}r.sort();v.sort();x.sort();r.length%2==1?(m=~~(0.5*r.length)+1,k[t]=r[m],k[t+1]=v[m],k[t+2]=x[m]):(m=~~(0.5*r.length),k[t]=
~~(0.5*(r[m]+r[m+1])),k[t+1]=~~(0.5*(v[m]+v[m+1])),k[t+2]=~~(0.5*(x[m]+x[m+1])));k[t+3]=d[t+3]}A+=g}return k}else if(this.isMinimum||this.isMaximum){a=this.dim;j=a>>1;k=new c.ImArray(d.length);g=l;h=b;for(o=A=0;o<h;o++){for(e=0;e<g;e++){D=o;m=e;t=A+e<<2;this.isMaximum?x=v=r=0:this.isMinimum&&(x=v=r=255);for(q=u=0;q<a;q++){w=D+q-j;if(w>=0&&w<b){p=w*l;for(w=0;w<a;w++)n=m+w-j,n>=0&&n<l&&(n=p+n<<2,this.isMaximum?(d[n]>r&&(r=d[n]),d[n+1]>v&&(v=d[n+1]),d[n+2]>x&&(x=d[n+2])):this.isMaximum&&(d[n]<r&&(r=
d[n]),d[n+1]<v&&(v=d[n+1]),d[n+2]<x&&(x=d[n+2])))}u+=a}k[t]=r;k[t+1]=v;k[t+2]=x;k[t+3]=d[t+3]}A+=g}return k}return d},apply:function(c){return c.setData(this._apply(c.getData(),c.width,c.height))}}})(FILTER);
