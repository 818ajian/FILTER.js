<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                font-family: Monospace;
                background-color: #121212;
                color:#aaa;
                margin: 0px;
                overflow: hidden;
                padding:0;
                position:relative;
                height:100%;
                min-height:900px; 
                overflow:scroll;
            }
            .panel
            {
                display:inline-block;
                max-width:240px;
                position:relative;
                margin:0;
                padding:0;
                cursor:pointer;
                vertical-align:top;
                padding-right:5px;
                border-right:2px solid #aaa;
            }
            #aside
            {
                position:absolute;
                color:#aaa;
                font-size:12px;
                z-index:100;
                width:250px;
                right:0
            }
            #container { max-width:400px; }
            #filters { max-width:600px; }
            span
            {
                vertical-aligh:top;
                position:relative;
                display:inline-block;
                width:25px;
                padding:0;
                padding-left:10px;
            }
        </style>
        <script src="../build/FILTER.min.js"></script>
        <title>Filters with canvas and FILTER.js</title>
    </head>
	<body>
		<div id="aside"><input id="test" type="button" value="Apply Filters" /></div>
        
		<div id="container" class="panel"></div>
        
		<div id="filters" class="panel"></div>
        
		<script>
        //<![CDATA[
            
            // utils
            function linebreak() { return document.createElement('br'); }
            function text(t) { return document.createTextNode(t); }
            function wrap(tag, t) { var e=document.createElement(tag); e.innerHTML=t; return e;}
            function span(t) { return wrap('span', t); }
            function html(el, c) { el.innerHTML=c; }
            function append(el, c) { el.innerHTML+=c; }
            function addEvent(el, ev, handler) { el.addEventListener(ev, handler, false); }
            function getEl(id) { return document.getElementById(id); }
            function add(el, child) { el.appendChild(child); }
            function addAll(el, childs) { var l=childs.length, i=0; while (i<l) { el.appendChild(childs[i]); i++; } }
            
            var 
                che='che.jpg',
                aside=getEl('aside'), test=getEl('test'), container=getEl('container'), filters=getEl('filters'),
                 // images
                displacemap=new FILTER.Image(),
                im1=new FILTER.Image(che, function(){
                        var grd;
                        // create a displace map image
                        displacemap.createImageData(im1.width,im1.height);
                        displacemap.context.fillStyle="rgb(128,128,128)";
                        displacemap.context.fillRect(0,0, displacemap.width, displacemap.height);
                        // create radial gradient
                        grd = displacemap.context.createRadialGradient(displacemap.width/2, displacemap.height/2, 0, displacemap.width/2, displacemap.height/2, displacemap.width/2);
                        grd.addColorStop(1, "#808080"); // neutral
                        grd.addColorStop(0, "#ffffff"); // white
                        displacemap.context.fillStyle = grd;
                        displacemap.context.beginPath();
                        displacemap.context.arc(displacemap.width/2,displacemap.height/2,displacemap.width/2,0,Math.PI*2,true);
                        displacemap.context.fill();
                        displacemap._refresh();
                }),
                im2=new FILTER.Image(che),
                im3=new FILTER.Image(che),
                im4=new FILTER.Image(che),
                im5=new FILTER.Image(che),
                im6=new FILTER.Image(che),
                im7=new FILTER.Image(che),
                im8=new FILTER.Image(che),
                im9=new FILTER.Image(che),
                im10=new FILTER.Image(che),
                im11=new FILTER.Image(che),
                im12=new FILTER.Image(che),
                im13=new FILTER.Image(che),
                im14=new FILTER.Image(che),
                 
                 // filters
                redChannel=new FILTER.ColorMatrixFilter().redChannel(),
                greenChannel=new FILTER.ColorMatrixFilter().greenChannel(),
                blueChannel=new FILTER.ColorMatrixFilter().blueChannel(),
                clr=new FILTER.ColorMatrixFilter().colorize(0xff0000),
                //contrast=new FILTER.ColorMatrixFilter().contrast(0.3),
                equalize=new FILTER.HistogramEqualizeFilter(),
                //rgbequalize=new FILTER.RGBHistogramEqualizeFilter(),
                //noise=new FILTER.NoiseFilter(-127, 127),
                sepia=new FILTER.ColorMatrixFilter().quickSepia(),
                gray=new FILTER.ColorMatrixFilter().grayscale(),
                grc=new FILTER.ColorMatrixFilter().grayscale().contrast(1),
                median=new FILTER.NonLinearFilter().median(5),
                blur=new FILTER.ConvolutionMatrixFilter().boxBlur(3),
                gauss=new FILTER.ConvolutionMatrixFilter().gaussBlur(3),
                sobel=new FILTER.ConvolutionMatrixFilter().sobel(3),
                grad=new FILTER.ConvolutionMatrixFilter().grad(3),
                emboss=new FILTER.ConvolutionMatrixFilter().embossHigh(),
                grayAndSobel=new FILTER.CompositeFilter([gray, sobel]),
                grayAndPrewitt=new FILTER.CompositeFilter([gray, gauss, grad]),
                displace=new FILTER.DisplacementMapFilter(displacemap)
                ;
            
            addAll(container, [
                span('1.'),
                im1.canvasElement,
                span('2.'),
                im2.canvasElement,
                linebreak(),
                span('3.'),
                im3.canvasElement,
                span('4.'),
                im4.canvasElement,
                linebreak(),
                span('14.'),
                im14.canvasElement,
                span('M:'),
                displacemap.canvasElement
            ]);
            addAll(filters, [
                span('5.'),
                im5.canvasElement,
                span('6.'),
                im6.canvasElement,
                span('7.'),
                im7.canvasElement,
                linebreak(),
                span('8.'),
                im8.canvasElement,
                span('9.'),
                im9.canvasElement,
                span('10.'),
                im10.canvasElement,
                linebreak(),
                span('11.'),
                im11.canvasElement,
                span('11.'),
                im12.canvasElement,
                span('13.'),
                im13.canvasElement
            ]);
            
            addEvent(test, 'click', dotest);
            
            function dotest(event)
            {
                // apply them
                equalize.apply(im14);
                redChannel.apply(im2);
                greenChannel.apply(im3);
                blueChannel.apply(im4);
                //rgbequalize.apply(im5);
                clr.apply(im5);
                grc.apply(im6);
                sepia.apply(im7);
                blur.apply(im8);
                gauss.apply(im9);
                emboss.apply(im10);
                median.apply(im11);
                displace.scaleX=100;
                displace.scaleY=100;
                displace.apply(im12);
                grayAndSobel.apply(im13);
                //grayAndPrewitt.apply(im10);

                append(aside, "<div><ol><li>Original Image</li><li>Red Channel</li><li>Green Channel</li><li>Blue Channel</li><li>Red Colorized</li><li>Grayscale and Contrast</li><li>Quick Sepia</li><li>Box Blur</li><li>Gauss Blur</li><li>Emboss</li><li>Median</li><li>Displace Map</li><li>Grayscale and Sobel Gradient Magnitude (Composite)</li><li>Histogram Equalization (Plugin)</li></ol>M: Displace Map</div>");
            }
            
        //]]>
		</script>
    </body>
</html>