/**
*
*   FILTER.js Plugins
*   @version: 0.9.0
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,r){"use strict";"object"==typeof module&&module.exports?module.exports=r.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(n,t){return r.moduleUri=n.uri,r.call(e,t),t}):(r.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(r){return!function(r){"use strict";var n=r._notSupportClamp,t=Math.random;r.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,r){var n=this;n.min=e||-127,n.max=r||127},path:r.getPath(e.moduleUri),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{min:e.min,max:e.max}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.min=r.min,n.max=r.max),n},apply:function(e,r,a){var i=this;if(!i._isOn)return e;var s,o,l,h,u,c,f,d,m=i.max-i.min,g=i.min,p=e.length;if(n)for(s=0;p>s;s+=4)l=e[s],h=e[s+1],u=e[s+2],o=m*t()+g,c=l+o,f=h+o,d=u+o,0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),0>d?d=0:d>255&&(d=255),e[s]=~~c,e[s+1]=~~f,e[s+2]=~~d;else for(s=0;p>s;s+=4)l=e[s],h=e[s+1],u=e[s+2],o=m*t()+g,c=l+o,f=h+o,d=u+o,e[s]=~~c,e[s+1]=~~f,e[s+2]=~~d;return e}})}(r),!function(r){"use strict";var n=r._notSupportClamp,t=r.Array32F,a=r.Color.RGB2YCbCr,i=r.Color.YCbCr2RGB;r.Create({name:"HistogramEqualizeFilter",path:r.getPath(e.moduleUri),apply:function(e,r,s){var o=this;if(!o._isOn)return e;var l,h,u,c,f,d,m,g,p,_,y,v=0,C=255,w=0,b=e.length,M=b>>2,I=1/M;for(f=new t(256),p=0;256>p;p+=8)f[p]=0,f[p+1]=0,f[p+2]=0,f[p+3]=0,f[p+4]=0,f[p+5]=0,f[p+6]=0,f[p+7]=0;for(p=0;b>p;p+=4)_=a(e.subarray(p,p+3)),l=e[p]=~~_[2],h=e[p+1]=~~_[0],u=e[p+2]=~~_[1],f[h]+=I,h>v?v=h:C>h&&(C=h);for(w=0,p=0;256>p;p+=8)w+=f[p],f[p]=w,w+=f[p+1],f[p+1]=w,w+=f[p+2],f[p+2]=w,w+=f[p+3],f[p+3]=w,w+=f[p+4],f[p+4]=w,w+=f[p+5],f[p+5]=w,w+=f[p+6],f[p+6]=w,w+=f[p+7],f[p+7]=w;if(c=v-C,n)for(p=0;b>p;p+=4)_=[e[p+1],e[p+2],e[p]],_[0]=f[_[0]]*c+C,y=i(_),d=y[0],m=y[1],g=y[2],d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m,g=0>g?0:g>255?255:g,e[p]=~~d,e[p+1]=~~m,e[p+2]=~~g;else for(p=0;b>p;p+=4)_=[e[p+1],e[p+2],e[p]],_[0]=f[_[0]]*c+C,y=i(_),e[p]=~~y[0],e[p+1]=~~y[1],e[p+2]=~~y[2];return e}}),r.Create({name:"GrayscaleHistogramEqualizeFilter",path:r.getPath(e.moduleUri),apply:function(e,r,a){var i=this;if(!i._isOn)return e;var s,o,l,h,u,c=0,f=255,d=0,m=e.length,g=m>>2,p=1/g;for(h=new t(256),u=0;256>u;u+=8)h[u]=0,h[u+1]=0,h[u+2]=0,h[u+3]=0,h[u+4]=0,h[u+5]=0,h[u+6]=0,h[u+7]=0;for(u=0;m>u;u+=4)s=e[u],h[s]+=p,s>c?c=s:f>s&&(f=s);for(d=0,u=0;256>u;u+=8)d+=h[u],h[u]=d,d+=h[u+1],h[u+1]=d,d+=h[u+2],h[u+2]=d,d+=h[u+3],h[u+3]=d,d+=h[u+4],h[u+4]=d,d+=h[u+5],h[u+5]=d,d+=h[u+6],h[u+6]=d,d+=h[u+7],h[u+7]=d;if(l=c-f,n)for(u=0;m>u;u+=4)s=e[u],o=h[s]*l+f,o=0>o?0:o>255?255:o,o=~~o,e[u]=o,e[u+1]=o,e[u+2]=o;else for(u=0;m>u;u+=4)s=e[u],o=~~(h[s]*l+f),e[u]=o,e[u+1]=o,e[u+2]=o;return e}}),r.Create({name:"RGBHistogramEqualizeFilter",path:r.getPath(e.moduleUri),apply:function(e,r,a){var i=this;if(!i._isOn)return e;var s,o,l,h,u,c,f,d,m,g,p,_,y,v,C,w,b=0,M=0,I=0,O=255,z=255,x=255,A=e.length,P=A>>2,Y=1/P;for(f=new t(256),d=new t(256),m=new t(256),w=0;256>w;w+=8)f[w]=0,d[w]=0,m[w]=0,f[w+1]=0,d[w+1]=0,m[w+1]=0,f[w+2]=0,d[w+2]=0,m[w+2]=0,f[w+3]=0,d[w+3]=0,m[w+3]=0,f[w+4]=0,d[w+4]=0,m[w+4]=0,f[w+5]=0,d[w+5]=0,m[w+5]=0,f[w+6]=0,d[w+6]=0,m[w+6]=0,f[w+7]=0,d[w+7]=0,m[w+7]=0;for(w=0;A>w;w+=4)s=e[w],o=e[w+1],l=e[w+2],f[s]+=Y,d[o]+=Y,m[l]+=Y,s>b?b=s:O>s&&(O=s),o>M?M=o:z>o&&(z=o),l>I?I=l:x>l&&(x=l);for(g=p=_=0,w=0;256>w;w+=8)g+=f[w],f[w]=g,p+=d[w],d[w]=p,_+=m[w],m[w]=_,g+=f[w+1],f[w+1]=g,p+=d[w+1],d[w+1]=p,_+=m[w+1],m[w+1]=_,g+=f[w+2],f[w+2]=g,p+=d[w+2],d[w+2]=p,_+=m[w+2],m[w+2]=_,g+=f[w+3],f[w+3]=g,p+=d[w+3],d[w+3]=p,_+=m[w+3],m[w+3]=_,g+=f[w+4],f[w+4]=g,p+=d[w+4],d[w+4]=p,_+=m[w+4],m[w+4]=_,g+=f[w+5],f[w+5]=g,p+=d[w+5],d[w+5]=p,_+=m[w+5],m[w+5]=_,g+=f[w+6],f[w+6]=g,p+=d[w+6],d[w+6]=p,_+=m[w+6],m[w+6]=_,g+=f[w+7],f[w+7]=g,p+=d[w+7],d[w+7]=p,_+=m[w+7],m[w+7]=_;if(h=b-O,u=M-z,c=I-x,n)for(w=0;A>w;w+=4)s=e[w],o=e[w+1],l=e[w+2],y=f[s]*h+O,v=d[o]*u+z,C=m[l]*c+x,y=0>y?0:y>255?255:y,v=0>v?0:v>255?255:v,C=0>C?0:C>255?255:C,e[w]=~~y,e[w+1]=~~v,e[w+2]=~~C;else for(w=0;A>w;w+=4)s=e[w],o=e[w+1],l=e[w+2],y=f[s]*h+O,v=d[o]*u+z,C=m[l]*c+x,e[w]=~~y,e[w+1]=~~v,e[w+2]=~~C;return e}})}(r),!function(r){"use strict";var n=Math.sqrt,t=r._notSupportClamp,a=r.Array32F;r.Create({name:"PixelateFilter",scale:1,init:function(e){var r=this;r.scale=e||1},path:r.getPath(e.moduleUri),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.scale=r.scale),n},apply:function(e,r,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,h,u,c,f,d,m,g,p,_,y,v,C,w,b,M,I,O,z,x,A,P,Y,k,X,F,S,L,N,R,U,H,E,T,q,G,B,D,j,W,$,V,Q,J,K,Z=e.length,ee=Z>>>2,re=(r<<1)+r;for(o=~~(n(ee)*s.scale*.01),l=r*o,h=i%o,u=r%o,c=(h-1)*r,g=1/(o*o),p=1/(u*o),_=1/(h*o),y=1/(u*h),v=g,C=p,w=_,b=y,x=o-1,A=(o-1)*r,q=0,B=r-1,G=0,D=ee-r,M=new a(3*ee),P=0,Y=0,k=0,I=O=z=0,k=0;r>k;k++,P+=4,Y+=3)I+=e[P],O+=e[P+1],z+=e[P+2],M[Y]=I,M[Y+1]=O,M[Y+2]=z;for(Y=0,k=0,I=O=z=0,P=re+r;Z>P;P+=4,Y+=3,k++)k>=r&&(k=0,I=O=z=0),I+=e[P],O+=e[P+1],z+=e[P+2],M[Y+re]=M[Y]+I,M[Y+re+1]=M[Y+1]+O,M[Y+re+2]=M[Y+2]+z;for(k=0,X=0,F=0,U=k,H=F,E=U+x,T=H+A,E=E>B?B:E,T=T>D?D:T,j=U+H,V=E+T,W=E+H,$=U+T,j=(j<<1)+j,W=(W<<1)+W,$=($<<1)+$,V=(V<<1)+V,m=v,Q=m*(M[V]-M[W]-M[$]+M[j]),J=m*(M[V+1]-M[W+1]-M[$+1]+M[j+1]),K=m*(M[V+2]-M[W+2]-M[$+2]+M[j+2]),t&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K,S=0,L=0,N=0,P=0;Z>P;P+=4)R=S+k+N+F<<2,e[R]=Q,e[R+1]=J,e[R+2]=K,S++,(S+k>=r||S>=o)&&(S=0,L++,N+=r),(L+X>=i||L>=o)&&(k+=o,k>=r&&(k=0,X+=o,F+=l),S=0,L=0,N=0,U=k,H=F,E=U+x,T=H+A,E=E>B?B:E,T=T>D?D:T,j=U+H,V=E+T,W=E+H,$=U+T,j=(j<<1)+j,W=(W<<1)+W,$=($<<1)+$,V=(V<<1)+V,f=0==E-U-u+1,d=0==T-H-c,m=f&&d?b:f?C:d?w:v,Q=m*(M[V]-M[W]-M[$]+M[j]),J=m*(M[V+1]-M[W+1]-M[$+1]+M[j+1]),K=m*(M[V+2]-M[W+2]-M[$+2]+M[j+2]),t&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K);return e}})}(r),!function(r){"use strict";var n=Math.sqrt,t=(Math.SQRT2,Math.min,r._notSupportClamp),a=r.Array32F;r.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var r=this;r.scale=e||1},path:r.getPath(e.moduleUri),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.scale=r.scale),n},apply:function(e,r,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,h,u,c,f,d,m,g,p,_,y,v,C,w,b,M,I,O,z,x,A,P,Y,k,X,F,S,L,N,R,U,H,E,T,q,G,B,D,j,W,$,V,Q,J,K,Z,ee,re,ne,te,ae,ie,se,oe=e.length,le=oe>>>2,he=(r<<1)+r;for(o=~~(n(le)*s.scale*.01),l=o>>1,h=o-1,u=r*o,c=i%o,f=r%o,d=(c-1)*r,_=1/(o*o),y=1/(f*o),v=1/(c*o),C=1/(f*c),w=2*_,b=2*y,M=2*v,I=2*C,P=h,Y=h*r,B=0,j=r-1,D=0,W=le-r,O=new a(3*le),k=0,X=0,F=0,z=x=A=0,F=0;r>F;F++,k+=4,X+=3)z+=e[k],x+=e[k+1],A+=e[k+2],O[X]=z,O[X+1]=x,O[X+2]=A;for(X=0,F=0,z=x=A=0,k=he+r;oe>k;k+=4,X+=3,F++)F>=r&&(F=0,z=x=A=0),z+=e[k],x+=e[k+1],A+=e[k+2],O[X+he]=O[X]+z,O[X+he+1]=O[X+1]+x,O[X+he+2]=O[X+2]+A;for(F=0,S=0,L=0,E=F,T=L,q=F-l+P,G=L+Y,q=q>j?j:q,G=G>W?W:G,$=E+T,J=q+G,V=q+T,Q=E+G,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,p=w,re=p*(O[J]-O[V]-O[Q]+O[$]),ne=p*(O[J+1]-O[V+1]-O[Q+1]+O[$+1]),te=p*(O[J+2]-O[V+2]-O[Q+2]+O[$+2]),E=F+l,q=F+P,q=q>j?j:q,$=E+T,J=q+G,V=q+T,Q=E+G,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,ae=p*(O[J]-O[V]-O[Q]+O[$]),ie=p*(O[J+1]-O[V+1]-O[Q+1]+O[$+1]),se=p*(O[J+2]-O[V+2]-O[Q+2]+O[$+2]),t&&(re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,te=0>te?0:te>255?255:te,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie,se=0>se?0:se>255?255:se),re=~~re,ne=~~ne,te=~~te,ae=~~ae,ie=~~ie,se=~~se,K=re,Z=ne,ee=te,N=0,R=0,U=0,k=0;oe>k;k+=4)H=N+F+U+L<<2,e[H]=K,e[H+1]=Z,e[H+2]=ee,N++,(N+F>=r||N>=o)&&(N=0,R++,U+=r,K=re,Z=ne,ee=te),N>h-R&&(K=ae,Z=ie,ee=se),(R+S>=i||R>=o)&&(F+=o,F>=r&&(F=0,S+=o,L+=u),N=0,R=0,U=0,E=F,T=L,q=F-l+P,G=L+Y,q=q>j?j:q,G=G>W?W:G,$=E+T,J=q+G,V=q+T,Q=E+G,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,m=0==q-E+l-f+1,g=0==G-T-d,p=m&&g?I:m?b:g?M:w,re=p*(O[J]-O[V]-O[Q]+O[$]),ne=p*(O[J+1]-O[V+1]-O[Q+1]+O[$+1]),te=p*(O[J+2]-O[V+2]-O[Q+2]+O[$+2]),E=F+l,q=F+P,q=q>j?j:q,$=E+T,J=q+G,V=q+T,Q=E+G,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,m=0==q-E+l-f+1,p=m&&g?I:m?b:g?M:w,ae=p*(O[J]-O[V]-O[Q]+O[$]),ie=p*(O[J+1]-O[V+1]-O[Q+1]+O[$+1]),se=p*(O[J+2]-O[V+2]-O[Q+2]+O[$+2]),t&&(re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,te=0>te?0:te>255?255:te,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie,se=0>se?0:se>255?255:se),re=~~re,ne=~~ne,te=~~te,ae=~~ae,ie=~~ie,se=~~se,K=re,Z=ne,ee=te);return e}})}(r),!function(r,n){"use strict";var t=7/16,a=3/16,i=5/16,s=1/16,o=r.Array32F,l=r.Color.clamp,h=r.Color.RGB2YCbCr,u=r.Color.YCbCr2RGB;r.Create({name:"HalftoneFilter",_threshold:.4,_size:1,_grayscale:!1,init:function(e,r,t){var a=this;a._size=e||1,a._threshold=l(n===r?.4:r,0,1),a._grayscale=!!t},path:r.getPath(e.moduleUri),size:function(e){return this._size=e,this},threshold:function(e){return this._threshold=l(e,0,1),this},grayscale:function(e){return arguments.length||(e=!0),this._grayscale=!!e,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_size:e._size,_threshold:e._threshold,_grayscale:e._grayscale}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n._size=r._size,n._threshold=r._threshold,n._grayscale=r._grayscale),n},apply:function(e,r,n){var c,f,d,m,g,p,_,y,v,C,w,b,M,I,O,z,x,A=this,P=e.length,Y=P>>>2,k=new o(3*Y),X=A._size,F=X*X,S=1/F,L=255*A._threshold,N=N<<1,R=!A._grayscale,U=X*r,H=t,E=a,T=i,q=s;for(_=0,y=0,p=0;n>_;){for(b=M=I=0,v=0,C=0,w=0;X>C;)c=p+y+v+w<<2,f=3*(p+y+v+w),b+=e[c]+k[f],M+=e[c+1]+k[f+1],I+=e[c+2]+k[f+2],v++,v>=X&&(v=0,C++,w+=r);if(b*=S,M*=S,I*=S,g=R?h([b,M,I]):[b,M,I],d=g[0],d>L?R?(g[0]=l(~~d,0,255),m=u(g)):m=[255,255,255]:m=[0,0,0],c=p+y<<2,O=e[c]-m[0],z=e[c+1]-m[1],x=e[c+2]-m[2],r>p+X)for(v=X,C=0,w=0;X>C;)f=3*(p+y+v+w),k[f]+=H*O,k[f+1]+=H*z,k[f+2]+=H*x,v++,v>=N&&(v=X,C++,w+=r);if(n>_+X&&p>X)for(v=-X,C=X,w=0;N>C;)f=3*(p+y+v+w),k[f]+=E*O,k[f+1]+=E*z,k[f+2]+=E*x,v++,v>=0&&(v=-X,C++,w+=r);if(n>_+X)for(v=0,C=X,w=0;N>C;)f=3*(p+y+v+w),k[f]+=T*O,k[f+1]+=T*z,k[f+2]+=T*x,v++,v>=X&&(v=0,C++,w+=r);if(n>_+X&&r>p+X)for(v=X,C=X,w=0;N>C;)f=3*(p+y+v+w),k[f]+=q*O,k[f+1]+=q*z,k[f+2]+=q*x,v++,v>=N&&(v=X,C++,w+=r);for(v=0,C=0,w=0;X>C;)c=p+y+v+w<<2,e[c]=m[0],e[c+1]=m[1],e[c+2]=m[2],v++,v>=X&&(v=0,C++,w+=r);p+=X,p>=r&&(p=0,_+=X,y+=U)}return e}})}(r),!function(r){"use strict";var n=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=r._notSupportClamp,s=r.Array32F;r.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,r,n,t){var a=this;a.centerX=e||0,a.centerY=r||0,a.radius=n||10,a.amount=t||10},path:r.getPath(e.moduleUri),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.centerX=r.centerX,n.centerY=r.centerY,n.radius=r.radius,n.amount=r.amount),n},apply:function(e,r,o){var l=this;if(!l._isOn)return e;var h,u,c,f,d,m,g,p,_,y,v,C,w,b,M,I,O,z,x,A,P,Y,k,X,F,S,L,N,R,U,H,E,T,q=e.length,G=l.centerX||0,B=l.centerY||0,D=l.radius,j=l.amount;if(0>=j)return e;for(h=q>>2,U=0,H=r-1,E=0,T=h-r,G=a(G*(r-1)),B=a(B*(o-1)),c=(h<<1)+h,g=(r<<1)+r,u=new s(c),p=0,_=0,y=0,f=d=m=0,y=0;r>y;y++,p+=4,_+=3)f+=e[p],d+=e[p+1],m+=e[p+2],u[_]=f,u[_+1]=d,u[_+2]=m;for(p=g+r,_=0,y=0,f=d=m=0,p=g+r;q>p;p+=4,_+=3,y++)y>=r&&(y=0,f=d=m=0),f+=e[p],d+=e[p+1],m+=e[p+2],u[_+g]=u[_]+f,u[_+g+1]=u[_+1]+d,u[_+g+2]=u[_+2]+m;for(y=0,v=0,C=0,p=0;q>p;p+=4,y++)y>=r&&(y=0,v++,C+=r),b=y-G,M=v-B,w=t(b)+t(M),I=w>D?~~n((w-D)*j):~~(w/D+.5),I>0&&(O=I*r,z=.25/(I*I),x=y-I,A=C-O,P=y+I,Y=C+O,U>x?x=U:P>H&&(P=H),E>A?A=E:Y>T&&(Y=T),k=x+A,S=P+Y,X=P+A,F=x+Y,k=(k<<1)+k,X=(X<<1)+X,F=(F<<1)+F,S=(S<<1)+S,L=z*(u[S]-u[X]-u[F]+u[k]),N=z*(u[S+1]-u[X+1]-u[F+1]+u[k+1]),R=z*(u[S+2]-u[X+2]-u[F+2]+u[k+2]),i&&(L=0>L?0:L>255?255:L,N=0>N?0:N>255?255:N,R=0>R?0:R>255?255:R),e[p]=~~L,e[p+1]=~~N,e[p+2]=~~R);return e}})}(r),!function(r){"use strict";r.Create({name:"SeamlessTileFilter",type:0,init:function(e){var r=this;r.type=e||0},path:r.getPath(e.moduleUri),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{type:e.type}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.type=r.type),n},apply:function(e,n,t){var a,i,s,o,l,h,u,c,f,d,m,g,p,_,y,v=this,C=v.type,w=r.Image.resize,b=r.ImArray,M=Math.sqrt;for(n!==t?e=w(e,n,t,g=n>t?n:t,g):g=n,p=Math.round(g/2),_=g*g,y=e.length,a=new b(y),i=new b(y),s=new r.Array8U(_),c=0,f=0,d=0;y>d;d+=4,c++)c>=g&&(c=0,f++),m=(c+p)%g+(f+p)%g*g<<2,a[m]=e[d],a[m+1]=e[d+1],a[m+2]=e[d+2],a[m+3]=e[d+3];for(c=0,f=0;p>c;f++){switch(f>=p&&(f=0,c++),C){case 0:u=M((c-p)*(c-p)+(f-p)*(f-p))/p;break;case 1:u=p-f>p-c?(f-p)/p:(c-g/2)/p;break;case 2:default:u=p-f>p-c?M((f-g)*(f-g)+(c-g)*(c-g))/(1.13*g):M((c-g)*(c-g)+(f-g)*(f-g))/(1.13*g)}u=255-255*u,1>u?u=1:u>255&&(u=255),s[c+f*g]=u,s[c+(g-1-f)*g]=u,s[g-1-c+f*g]=u,s[g-1-c+(g-1-f)*g]=u}for(f=0,c=0;g>f;c++)c>=g&&(c=0,f++),m=c+f*g,o=s[m],l=s[(c+p)%g+(f+p)%g*g],h=o+l,o/=h,l/=h,m<<=2,i[m]=~~(o*e[m]+l*a[m]),i[m+1]=~~(o*e[m+1]+l*a[m+1]),i[m+2]=~~(o*e[m+2]+l*a[m+2]),i[m+3]=e[m+3];return n!==t&&(i=w(i,g,g,n,t)),i}})}(r),!function(r){"use strict";var n=r.TypedArray,t=Math.abs,a=(Math.min,Math.max,Math.ceil),i=r.MODE.TILE,s=r.MODE.STRETCH,o=r.Array8U,l=r.Array32U;r.Create({name:"FloodFillFilter",x:0,y:0,color:null,tolerance:0,path:r.getPath(e.moduleUri),init:function(e,r,n,t){var a=this;a.x=e||0,a.y=r||0,a.color=n||[0,0,0],a.tolerance=t||0},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{color:e.color,x:e.x,y:e.y,tolerance:e.tolerance}}},unserialize:function(e){var r,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,r=e.params,t.color=n(r.color,Array),t.x=r.x,t.y=r.y,t.tolerance=r.tolerance),t},apply:function(e,r,n){var a,i,s,l,h,u,c,f,d,m,g,p=this,_=~~(255*(p.tolerance>=1?.999:p.tolerance)),y=p.color,v=r<<2,C=p.x,w=p.y,b=e.length,M=0,I=b-v,O=0,z=r-1<<2;if(c=w*r<<2,C<<=2,O>C||C>z||M>c||c>I||e[C+c]===y[0]&&e[C+c+1]===y[1]&&e[C+c+2]===y[2])return e;for(a=new o(3),a[0]=e[C+c],a[1]=e[C+c+1],a[2]=e[C+c+2],f=new Array(b>>>2),d=0,c+v>=M&&I>=c+v&&(f[d++]=[c,C,C,v]),f[d++]=[c+v,C,C,-v];d>0;){for(m=f[--d],c=m[0]+(v=m[3]),h=m[1],u=m[2],l=h;l>=O&&(s=l+c,t(a[0]-e[s])<=_&&t(a[1]-e[s+1])<=_&&t(a[2]-e[s+2])<=_);l-=4)e[s]=y[0],e[s+1]=y[1],e[s+2]=y[2];if(l>=h){for(s=l+c;u>=l&&!(t(a[0]-e[s])<=_&&t(a[1]-e[s+1])<=_&&t(a[2]-e[s+2])<=_);)l+=4,s=l+c;i=l,g=u>=l}else i=l+4,h>i&&c-v>=M&&I>=c-v&&(f[d++]=[c,i,h-4,-v]),l=h+4,g=!0;for(;g;){for(s=l+c;z>=l&&t(a[0]-e[s])<=_&&t(a[1]-e[s+1])<=_&&t(a[2]-e[s+2])<=_;)e[s]=y[0],e[s+1]=y[1],e[s+2]=y[2],l+=4,s=l+c;for(c+v>=M&&I>=c+v&&(f[d++]=[c,i,l-4,v]),l>u+4&&c-v>=M&&I>=c-v&&(f[d++]=[c,u+4,l-4,-v]),s=l+c;u>=l&&!(t(a[0]-e[s])<=_&&t(a[1]-e[s+1])<=_&&t(a[2]-e[s+2])<=_);)l+=4,s=l+c;i=l,g=u>=l}}return e}}),r.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:0,pattern:null,_pattern:null,mode:i,path:r.getPath(e.moduleUri),init:function(e,r,n,t,a,s,o){var l=this;l.x=e||0,l.y=r||0,l.offsetX=t||0,l.offsetY=a||0,n&&l.setPattern(n),l.mode=s||i,l.tolerance=o||0},dispose:function(){var e=this;return e.pattern=null,e._pattern=null,e.x=null,e.y=null,e.offsetX=null,e.offsetY=null,e.tolerance=null,e.mode=null,e.$super("dispose"),e},setPattern:function(e){var r=this;return e&&(r.pattern=e,r._pattern=null),r},serialize:function(){var e=this,r=e.pattern;return{filter:e.name,_isOn:!!e._isOn,params:{x:e.x,y:e.y,offsetX:e.offsetX,offsetY:e.offsetY,tolerance:e.tolerance,mode:e.mode,_pattern:e._pattern||(r?{data:r.getData(),width:r.width,height:r.height}:null)}}},unserialize:function(e){var t,a=this;return e&&a.name===e.filter&&(a._isOn=!!e._isOn,t=e.params,a.x=t.x,a.y=t.y,a.offsetX=t.offsetX,a.offsetY=t.offsetY,a.tolerance=t.tolerance,a.mode=t.mode,a.pattern=null,a._pattern=t._pattern,a._pattern&&(a._pattern.data=n(a._pattern.data,r.ImArray))),a},apply:function(e,r,n){var i=this,h=i.pattern;if(!i._isOn||!h&&!i._pattern)return e;var u,c,f,d,m,g,p,_,y,v,C,w,b,M,I,O,z=i._pattern||{data:h.getData(),width:h.width,height:h.height},x=~~(255*(i.tolerance>=1?.999:i.tolerance)),A=i.mode,P=r<<2,Y=z.data,k=z.width,X=z.height,F=i.x,S=i.y,L=i.offsetX||0,N=i.offsetY||0,R=e.length,U=R>>>2,H=0,E=R-P,T=0,q=r-1<<2;if(0>L&&(L+=k),0>N&&(N+=X),m=S,_=S*r<<2,F<<=2,T>F||F>q||H>_||_>E)return e;for(u=new o(3),u[0]=e[F+_],u[1]=e[F+_+1],u[2]=e[F+_+2],w=new Array(U),b=0,M=new l(a(U/32)),_+P>=H&&E>=_+P&&(w[b++]=[_,F,F,P,m+1]),w[b++]=[_+P,F,F,-P,m];b>0;){for(I=w[--b],_=I[0]+(P=I[3]),g=I[1],p=I[2],m=I[4],d=g;d>=T&&(f=d+_,!(M[f>>>7]&1<<(f>>>2&31))&&t(u[0]-e[f])<=x&&t(u[1]-e[f+1])<=x&&t(u[2]-e[f+2])<=x);d-=4)M[f>>>7]|=1<<(f>>>2&31),s===A?(v=~~(k*(d>>>2)/r),C=~~(X*m/n)):(v=((d>>>2)+L)%k,C=(m+N)%X),y=v+C*k<<2,e[f]=Y[y],e[f+1]=Y[y+1],e[f+2]=Y[y+2];if(d>=g){for(f=d+_;p>=d&&!(!(M[f>>>7]&1<<(f>>>2&31))&&t(u[0]-e[f])<=x&&t(u[1]-e[f+1])<=x&&t(u[2]-e[f+2])<=x);)d+=4,f=d+_;c=d,O=p>=d}else c=d+4,g>c&&_-P>=H&&E>=_-P&&(w[b++]=[_,c,g-4,-P,P>0?m-1:m+1]),d=g+4,O=!0;for(;O;){for(f=d+_;q>=d&&!(M[f>>>7]&1<<(f>>>2&31))&&t(u[0]-e[f])<=x&&t(u[1]-e[f+1])<=x&&t(u[2]-e[f+2])<=x;)M[f>>>7]|=1<<(f>>>2&31),s===A?(v=~~(k*(d>>>2)/r),C=~~(X*m/n)):(v=((d>>>2)+L)%k,C=(m+N)%X),y=v+C*k<<2,e[f]=Y[y],e[f+1]=Y[y+1],e[f+2]=Y[y+2],d+=4,f=d+_;for(_+P>=H&&E>=_+P&&(w[b++]=[_,c,d-4,P,P>0?m+1:m-1]),d>p+4&&_-P>=H&&E>=_-P&&(w[b++]=[_,p+4,d-4,-P,P>0?m-1:m+1]),f=d+_;p>=d&&!(!(M[f>>>7]&1<<(f>>>2&31))&&t(u[0]-e[f])<=x&&t(u[1]-e[f+1])<=x&&t(u[2]-e[f+2])<=x);)d+=4,f=d+_;c=d,O=p>=d}}return e}})}(r),!function(r){"use strict";var n=r._notSupportClamp,t=r.Color.RGB2HSV,a=.7083333333333334;r.Create({name:"HSVConverterFilter",path:r.getPath(e.moduleUri),apply:function(e,r,i){var s=this;if(!s._isOn)return e;var o,l,h,u,c,f=e.length;if(n)for(o=0;f>o;o+=4)l=t(e.subarray(o,o+3)),h=l[0]*a,c=255*l[1],u=l[2],0>h?h=0:h>255&&(h=255),0>u?u=0:u>255&&(u=255),0>c?c=0:c>255&&(c=255),e[o]=~~h,e[o+1]=~~u,e[o+2]=~~c;else for(o=0;f>o;o+=4)l=t(e.subarray(o,o+3)),h=l[0]*a,c=255*l[1],u=l[2],e[o]=~~h,e[o+1]=~~u,e[o+2]=~~c;return e}})}(r),!function(r){"use strict";var n=(r._notSupportClamp,r.TypedArray),t=r.Color.RGBA2Color,a=r.Color.Color2RGBA;r.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(e,r){var n=this;n.thresholds=e,n.quantizedColors=r||null},path:r.getPath(e.moduleUri),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{thresholds:e.thresholds,quantizedColors:e.quantizedColors}}},unserialize:function(e){var r,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,r=e.params,t.thresholds=n(r.thresholds,Array),t.quantizedColors=n(r.quantizedColors,Array)),t},apply:function(e,r,n){var i=this;if(!(i._isOn&&i.thresholds&&i.thresholds.length&&i.quantizedColors&&i.quantizedColors.length))return e;var s,o,l,h,u=e.length,c=i.thresholds,f=c.length,d=i.quantizedColors,m=d.length;for(l=0;u>l;l+=4){for(s=t(e.subarray[l+4]),h=0;f>h&&s>c[h];)h++;s=m>h?d[h]:255,o=a(s),e[l]=o[0],e[l+1]=o[1],e[l+2]=o[2],e[l+3]=o[3]}return e}})}(r),!function(r){"use strict";var n=(r._notSupportClamp,r.ImArray,r.Color.clampPixel),t=r.TypedArray,a=r.Color.RGB2HSV,i=(r.Color.HSV2RGB,r.Color.Color2RGBA);r.Create({name:"HueExtractorFilter",range:null,background:0,init:function(e,r){var n=this;n.range=e,n.background=r||0},path:r.getPath(e.moduleUri),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{range:e.range,background:e.background}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.range=t(r.range,Array),n.background=r.background),n},apply:function(e,r,t){var s=this;if(!s._isOn||!s.range||!s.range.length)return e;var o,l,h,u,c,f,d,m=e.length,g=s.range[0],p=s.range[s.range.length-1];for(f=i(s.background||0),o=~~n(f[0]),l=~~n(f[1]),h=~~n(f[2]),u=~~n(f[3]),c=0;m>c;c+=4)d=a(e.subarray(c,c+3))[0],(g>d||d>p)&&(e[c]=o,e[c+1]=l,e[c+2]=h,e[c+3]=u);return e}})}(r),!function(r){"use strict";function n(e,r,n,t,a,i){var s,o,u,y,v,C=e.length,w=new h(C),b=new h(C),M=new h(C),I=new h(C),O=new h(i),z=new h(i),x=a*a,A=2*x,P=g*x;for(s=0;i>s&&(o=_(-(s*s)/A),!(c>=o&&s>=2));s++)u=_(-((v=s-.5)*v)/A),y=_(-((v=s+.5)*v)/A),O[s]=(o+u+y)/3/P,z[s]=y-u;var v,Y,k,X,F,S,L,N,R,U=s-1,H=r-(s-1),E=r*(s-1),T=r*(n-(s-1));for(v=U;H>v;v++)for(Y=E;T>Y;Y+=r){for(k=v+Y,X=e[k]*O[0],F=X,S=1,L=r;s>S;)F+=O[S]*(e[k-L]+e[k+L]),X+=O[S]*(e[k-S]+e[k+S]),L+=r,S++;b[k]=F,w[k]=X}for(v=U;H>v;v++)for(Y=E;T>Y;Y+=r){for(N=0,k=v+Y,R=1;s>R;R++)N+=z[R]*(b[k-R]-b[k+R]);M[k]=N}for(v=s;r-s>v;v++)for(Y=E;T>Y;Y+=r){for(N=0,k=v+Y,L=r,R=1;s>R;R++)N+=z[R]*(w[k-L]-w[k+L]),L+=r;I[k]=N}U=s,H=r-s,E=r*s,T=r*(n-s);var q,G,B,D,j,W,$,V,Q,J,K,Z,ee,re,ne,te,ae,ie,se,oe;for(v=U;H>v;v++)for(Y=E;T>Y;Y+=r)k=v+Y,q=k-r,G=k+r,D=k-1,B=k+1,j=q-1,W=q+1,$=G-1,V=G+1,Q=M[k],J=I[k],K=l(Q,J),ee=l(M[q],I[q]),re=l(M[G],I[G]),te=l(M[D],I[D]),ne=l(M[B],I[B]),ie=l(M[W],I[W]),oe=l(M[V],I[V]),se=l(M[$],I[$]),ae=l(M[j],I[j]),(0>=Q*J?p(Q)>=p(J)?(Z=p(Q*K))>=p(J*ie-(Q+J)*ne)&&Z>p(J*se-(Q+J)*te):(Z=p(J*K))>=p(Q*ie-(J+Q)*ee)&&Z>p(Q*se-(J+Q)*re):p(Q)>=Math.abs(J)?(Z=p(Q*K))>=p(J*oe+(Q-J)*ne)&&Z>p(J*ae+(Q-J)*te):(Z=p(J*K))>=p(Q*oe+(J-Q)*re)&&Z>p(Q*ae+(J-Q)*ee))?t[k]=K>=d?m:Math.floor(f*K):t[k]=0}function t(e,r,n,t,i,s){var o,l,h,u=0,c=e.length;for(o=0;c>o;o++)e[o]=0;for(h=0,l=0,u=0;c>u;u++,h++)h>=r&&(h=0,l++),0===e[u]&&t[u]>=s&&a(e,r,n,t,h,l,u,i)}function a(e,r,n,t,i,s,o,l){var h,u,c,f=0==i?i:i-1,d=i==r-1?i:i+1,m=0==s?s:s-1,g=s==n-1?s:s+1;for(e[o]=t[o],h=f,u=m;d>=h&&g>=u;){if(c=h+u*r,(u!=s||h!=i)&&0===e[c]&&t[c]>=l)return void a(e,r,n,t,h,u,c,l);u++,u>g&&(u=m,h++)}}function i(e,n){var t,a,i,s,o,l=e.length,h=r.LUMA[0],u=r.LUMA[1],c=r.LUMA[2];for(t=0,a=0;l>t;t+=4,a++)i=e[t],s=e[t+1],o=e[t+2],n[a]=~~(h*i+u*s+c*o+.5)}function s(e){var r,n,t,a,i,s=new u(256),o=new u(256),l=e.length;for(r=0;l>r;r++)s[e[r]]++;for(n=0,t=0,r=0;256>r;r++){for(n+=s[r],i=255*n/l,a=t+1;i>=a;a++)o[a]=r;t=i}for(r=0;l>r;r++)e[r]=o[e[r]]}function o(e,r){var n,t,a,i=e.length;for(n=0,t=0;i>n;n+=4,t++)a=r[t]>0?255:0,e[n]=e[n+1]=e[n+2]=a}var l,h=r.Array32F,u=r.Array32I,c=.005,f=100,d=1e3,m=f*d,g=r.CONST.PI2,p=Math.abs,_=Math.exp;l=Math.hypot?Math.hypot:function(e,r){return p(e)+p(r)},r.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,gaussRadius:2,gaussWidth:16,contrastNormalized:!1,path:r.getPath(e.moduleUri),init:function(e,r,n,t,a){var i=this;i.low=arguments.length<1?2.5:e,i.high=arguments.length<2?7.5:r,i.gaussRadius=arguments.length<3?2:n,i.gaussWidth=arguments.length<4?16:t,i.contrastNormalized=!!a},thresholds:function(e,r){var n=this;return n.low=e,n.high=r,n},kernel:function(e,r){var n=this;return n.gaussRadius=e,n.gaussWidth=r,n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{low:e.low,high:e.high,gaussRadius:e.gaussRadius,gaussWidth:e.gaussWidth,contrastNormalized:e.contrastNormalized}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.low=r.low,n.high=r.high,n.gaussRadius=r.gaussRadius,n.gaussWidth=r.gaussWidth,n.contrastNormalized=r.contrastNormalized),n},apply:function(e,r,a){var l,h,c,d,m=this,g=e.length>>2;return c=new u(g),d=new u(g),l=Math.round(m.low*f),h=Math.round(m.high*f),i(e,c),m.contrastNormalized&&s(c),n(c,r,a,d,m.gaussRadius,m.gaussWidth),t(c,r,a,d,l,h),o(e,c),e}})}(r),!function(r,n){"use strict";function t(e,r,n,t,a,i,s){var o,l,h,u,c,f,d,m=e.length;for(u=0,h=0,o=l=0;r>u;)d=4899*e[h]+9617*e[h+1]+1868*e[h+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[u]=d,a[u]=o,i[u]=l,s[u]=d,u++,h+=4;for(c=0,f=1,u=r,h=r<<2,o=l=0;m>h;)d=4899*e[h]+9617*e[h+1]+1868*e[h+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[u]=d,a[u]=a[u-r]+o,i[u]=i[u-r]+l,s[u]=s[u+1-r]+(d+t[u-r])+(f>1?s[u-r-r]:0)+(c>0?s[u-1-r]:0),c++,u++,h+=4,c>=r&&(c=0,f++,o=l=0)}function a(e,r,n,t){var a,i,s,o,l,h,u,c,m,g,p,_=e.length,y=new f(_);for(a=0;r>a;a++)y[a]=0,y[a+r]=0,y[a+_-r]=0,y[a+_-r-r]=0,t[a]=0,t[a+_-r]=0;for(i=0,s=0;n>i;i++,s+=r)y[0+s]=0,y[1+s]=0,y[r-1+s]=0,y[r-2+s]=0,t[0+s]=0,t[r-1+s]=0;for(a=2;r-2>a;a++)for(o=0,i=2,s=r<<1;n-2>i;i++,s+=r)u=a+s,c=u+r,m=c+r,g=u-r,p=g-r,o=0+(e[p-2]<<1)+(e[g-2]<<2)+(e[u-2]<<2)+e[u-2]+(e[c-2]<<2)+(e[m-2]<<1)+(e[p-1]<<2)+(e[g-1]<<3)+e[g-1]+(e[u-1]<<4)-(e[u-1]<<2)+(e[c-1]<<3)+e[c-1]+(e[m-1]<<2)+(e[p]<<2)+e[p]+(e[g]<<4)-(e[g]<<2)+(e[u]<<4)-e[u]+(e[c]<<4)-(e[c]<<2)+(e[m]<<2)+e[m]+(e[p+1]<<2)+(e[g+1]<<3)+e[g+1]+(e[u+1]<<4)-(e[u+1]<<2)+(e[c+1]<<3)+e[c+1]+(e[m+1]<<2)+(e[p+2]<<1)+(e[g+2]<<2)+(e[u+2]<<2)+e[u+2]+(e[c+2]<<2)+(e[m+2]<<1),y[u]=((103*o+8192&4294967295)>>>14&255)>>>0;for(a=1;r-1>a;a++)for(i=1,s=r;n-1>i;i++,s+=r)u=s+a,c=u+r,g=u-r,l=0-y[g-1]+y[g+1]-y[u-1]-y[u-1]+y[u+1]+y[u+1]-y[c-1]+y[c+1],h=0+y[g-1]+y[g]+y[g]+y[g+1]-y[c-1]-y[c]-y[c]-y[c+1],t[u]=d(l)+d(h);for(a=0,o=0;r>a;)o+=t[a],t[a]=o,a++;for(a=r,s=0,o=0;_>a;)o+=t[a],t[a]=t[a-r]+o,a++,s++,s>=r&&(s=0,o=0);return t}function i(e,r){var n=.2*m(r.width,e.width),t=.2*m(r.height,e.height);return!!(d(e.x-r.x)<=n&&d(e.y-r.y)<=t&&d(e.width-r.width)<=n&&d(e.height-r.height)<=t)}function s(e,r){e.x+=r.x,e.y+=r.y,e.width+=r.width,e.height+=r.height}function o(e,r){return!!(e.x>=r.x&&e.y>=r.y&&e.x+e.width<=r.x+r.width&&e.y+e.height<=r.y+r.height)}function l(e){e.x=~~(e.x+.5),e.y=~~(e.y+.5),e.width=~~(e.width+.5),e.height=~~(e.height+.5)}function h(e,r){return r.area-e.area}function u(e,r){var n,t,a,u,c,f,d,m=e.length,g=new Array(m),p=[],_=0,y=!1;for(a=0;m>a;a++)g[a]=0;for(a=0;m>a;a++){for(y=!1,u=0;a>u;u++)i(e[u],e[a])&&(y=!0,g[a]=g[u]);y||(g[a]=_,_++)}for(n=new Array(_),t=new Array(_),a=0;_>a;a++)n[a]=0,t[a]={x:0,y:0,width:0,height:0};for(a=0;m>a;a++)d=g[a],n[d]++,s(t[d],e[a]);for(a=0;_>a;a++)c=n[a],c>=r&&(f=1/(c+c),d={x:f*(2*t[a].x+c),y:f*(2*t[a].y+c),width:f*(2*t[a].width+c),height:f*(2*t[a].height+c)},p.push(d));for(m=p.length,a=0;m>a;a++)for(u=a+1;m>u;u++)!p[a].inside&&o(p[a],p[u])?p[a].inside=!0:!p[u].inside&&o(p[u],p[a])&&(p[u].inside=!0);for(a=m;--a>=0;)p[a].inside?p.splice(a,1):(l(p[a]),p[a].area=p[a].width*p[a].height);return p.sort(h)}var c=r.Array32F,f=r.Array8U,d=Math.abs,m=Math.max,g=Math.min,p=(Math.floor,Math.round,Math.sqrt),_=r.TypedObj,y="hasOwnProperty";r.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,r,t,a,i,s){var o=this;o.objects=null,o.haardata=e||null,o.baseScale=n===r?1:r,o.scaleIncrement=n===t?1.25:t,o.stepIncrement=n===a?.5:a,o.minNeighbors=n===i?1:i,o.doCannyPruning=n===s?!0:!!s,o._haarchanged=!!o.haardata},path:r.getPath(e.moduleUri),dispose:function(){var e=this;return e.objects=null,e.haardata=null,e.$super("dispose"),e},haar:function(e){var r=this;return r.haardata=e,r._haarchanged=!0,r},params:function(e){var r=this;return e&&(e[y]("haardata")&&(r.haardata=e.haardata,r._haarchanged=!0),e[y]("baseScale")&&(r.baseScale=e.baseScale),e[y]("scaleIncrement")&&(r.scaleIncrement=e.scaleIncrement),e[y]("stepIncrement")&&(r.stepIncrement=e.stepIncrement),e[y]("minNeighbors")&&(r.minNeighbors=e.minNeighbors),e[y]("doCannyPruning")&&(r.doCannyPruning=e.doCannyPruning),e[y]("cannyLow")&&(r.cannyLow=e.cannyLow),e[y]("cannyHigh")&&(r.cannyHigh=e.cannyHigh)),r},serialize:function(){var e=this,r={filter:e.name,_isOn:!!e._isOn,params:{baseScale:e.baseScale,scaleIncrement:e.scaleIncrement,stepIncrement:e.stepIncrement,minNeighbors:e.minNeighbors,doCannyPruning:e.doCannyPruning,cannyLow:e.cannyLow,cannyHigh:e.cannyHigh}};return e._haarchanged&&(r.params.haardata=_(e.haardata),e._haarchanged=!1),r},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,r[y]("haardata")&&(n.haardata=_(r.haardata,1)),n.baseScale=r.baseScale,n.scaleIncrement=r.scaleIncrement,n.stepIncrement=r.stepIncrement,n.minNeighbors=r.minNeighbors,n.doCannyPruning=r.doCannyPruning,n.cannyLow=r.cannyLow,n.cannyHigh=r.cannyHigh),n},getMeta:function(){return r.isWorker?_(this.objects):this.objects},setMeta:function(e){return this.objects="string"==typeof e?_(e,1):e,this},apply:function(e,r,n){var i,s,o,l,h,d,m,_,y,v,C,w,b,M,I,O,z,x,A,P,Y,k,X,F,S,L,N,R,U,H,E,T,q,G,B,D,j,W,$,F,V,Q,J,K,Z,ee,re,ne,te,ae,ie,se,oe,le,he,ue,ce,fe,de,me=this,ge=e.length>>>2,pe=me.haardata,_e=pe.stages,ye=me.baseScale,ve=me.scaleIncrement,Ce=me.stepIncrement,we=me.minNeighbors,be=me.doCannyPruning,Me=me.cannyLow,Ie=me.cannyHigh,Oe=pe.size1,ze=pe.size2,xe=g(r/Oe,n/ze),Ae=[],Pe=ge-1,Ye=0,ke=0,Xe=_e.length;for(t(e,r,n,s=new f(ge),o=new c(ge),l=new c(ge),h=new c(ge)),be&&a(s,r,n,d=new c(ge)),S=0,L=r-1,N=0,R=ge-r,i=ye;xe>=i;){for(y=~~(i*Oe),m=~~(y*Ce),v=~~(i*ze),_=~~(v*Ce),I=v*r,O=_*r,C=ke*O,Y=r-y,k=n-v,U=y*v,H=1/U,b=ke,M=C;k>b;b+=_,M+=O)for(w=Ye;Y>w;w+=m)if(z=w-1+M-r,x=z+y,A=z+I,P=A+y,z=0>z?0:z>Pe?Pe:z,x=0>x?0:x>Pe?Pe:x,A=0>A?0:A>Pe?Pe:A,P=0>P?0:P>Pe?Pe:P,!(be&&(G=H*(d[P]-d[A]-d[x]+d[z]),Me>G||G>Ie))){for(E=H*(o[P]-o[A]-o[x]+o[z]),T=H*(l[P]-l[A]-l[x]+l[z]),q=T-E*E,q=q>1?p(q):1,B=!0,X=0;Xe>X;X++){for(D=_e[X],j=D.thres,W=D.trees,$=W.length,de=0,F=0;$>F;F++)for(J=W[F].feats,V=0;;){if(K=J[V],Z=K.rects,ee=Z.length,re=K.thres,ne=0,K.tilt)for(te=0;ee>te;te++)ae=Z[te],ie=w+~~(i*ae[0]),se=(b-1+~~(i*ae[1]))*r,oe=w+~~(i*(ae[0]+ae[2])),le=(b-1+~~(i*(ae[1]+ae[2])))*r,he=w+~~(i*(ae[0]-ae[3])),ue=(b-1+~~(i*(ae[1]+ae[3])))*r,ce=w+~~(i*(ae[0]+ae[2]-ae[3])),fe=(b-1+~~(i*(ae[1]+ae[2]+ae[3])))*r,ie=S>ie?S:ie>L?L:ie,oe=S>oe?S:oe>L?L:oe,he=S>he?S:he>L?L:he,ce=S>ce?S:ce>L?L:ce,se=N>se?N:se>R?R:se,le=N>le?N:le>R?R:le,ue=N>ue?N:ue>R?R:ue,fe=N>fe?N:fe>R?R:fe,ne+=ae[4]*(h[ce+fe]-h[he+ue]-h[oe+le]+h[ie+se]);else for(te=0;ee>te;te++)ae=Z[te],ie=w-1+~~(i*ae[0]),oe=w-1+~~(i*(ae[0]+ae[2])),se=r*(b-1+~~(i*ae[1])),le=r*(b-1+~~(i*(ae[1]+ae[3]))),ie=S>ie?S:ie>L?L:ie,oe=S>oe?S:oe>L?L:oe,se=N>se?N:se>R?R:se,le=N>le?N:le>R?R:le,ne+=ae[4]*(o[oe+le]-o[ie+le]-o[oe+se]+o[ie+se]);if(Q=re*q>ne*H?0:1){if(K.has_r){de+=K.r_val;break}V=K.r_node}else{if(K.has_l){de+=K.l_val;break}V=K.l_node}}if(B=de>j,!B)break}B&&Ae.push({x:w,y:b,width:y,height:v})}i*=ve}return me.objects=u(Ae,we),e}})}(r),!function(r){"use strict";var n=(r._notSupportClamp,Math.min),t=Math.floor,a=r.CHANNEL.RED;r.CHANNEL.GREEN,r.CHANNEL.BLUE,r.CHANNEL.ALPHA;r.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,path:r.getPath(e.moduleUri),init:function(e,r,n,t,i){var s=this;s._srcImg=null,s.srcImg=null,s.srcChannel=r||a,s.dstChannel=n||a,s.centerX=t||0,s.centerY=i||0,e&&s.setSrc(e)},dispose:function(){var e=this;return e.srcImg=null,e._srcImg=null,e.$super("dispose"),e},setSrc:function(e){var r=this;return e&&(r.srcImg=e,r._srcImg=null),r},serialize:function(){var e=this,r=e.srcImg;return{filter:e.name,_isOn:!!e._isOn,params:{_srcImg:e._srcImg||(r?{data:r.getData(),width:r.width,height:r.height}:null),centerX:e.centerX,centerY:e.centerY,srcChannel:e.srcChannel,dstChannel:e.dstChannel}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.srcImg=null,t._srcImg=n._srcImg,t._srcImg&&(t._srcImg.data=r.TypedArray(t._srcImg.data,r.ImArray)),t.centerX=n.centerX,t.centerY=n.centerY,t.srcChannel=n.srcChannel,t.dstChannel=n.dstChannel),t},apply:function(e,r,a){var i=this,s=i.srcImg;if(!i._isOn||!s&&!i._srcImg)return e;var o,l,h,u,c,f,d=i._srcImg||{data:s.getData(),width:s.width,height:s.height},m=d.data,g=d.width,p=d.height,_=e.length,y=(m.length,i.srcChannel),v=i.dstChannel,C=n(r,g),w=n(a,p),b=i.centerX||0,M=i.centerY||0,I=g>>1,O=p>>1;for(b=t(b*(r-1))-I,M=t(M*(a-1))-O,o=0,l=0,h=0,o=0;_>o;o+=4,l++)l>=r&&(l=0,h++),c=l-b,f=h-M,c>=0&&C>c&&f>=0&&w>f&&(u=c+f*g<<2,e[o+v]=m[u+y]);return e}})}(r),!function(r){"use strict";var n=(r._notSupportClamp,Math.min),t=Math.floor;r.Create({name:"AlphaMaskFilter",_alphaMask:null,
alphaMask:null,centerX:0,centerY:0,path:r.getPath(e.moduleUri),init:function(e,r,n){var t=this;t.centerX=r||0,t.centerY=n||0,t._alphaMask=null,t.alphaMask=null,e&&t.setMask(e)},dispose:function(){var e=this;return e.alphaMask=null,e._alphaMask=null,e.$super("dispose"),e},setMask:function(e){var r=this;return e&&(r.alphaMask=e,r._alphaMask=null),r},serialize:function(){var e=this,r=e.alphaMask;return{filter:e.name,_isOn:!!e._isOn,params:{_alphaMask:e._alphaMask||(r?{data:r.getData(),width:r.width,height:r.height}:null),centerX:e.centerX,centerY:e.centerY}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.alphaMask=null,t._alphaMask=n._alphaMask,t._alphaMask&&(t._alphaMask.data=r.TypedArray(t._alphaMask.data,r.ImArray)),t.centerX=n.centerX,t.centerY=n.centerY),t},apply:function(e,r,a){var i=this,s=i.alphaMask;if(!i._isOn||!s&&!i._alphaMask)return e;var o,l,h,u,c,f,d=i._alphaMask||{data:s.getData(),width:s.width,height:s.height},m=d.data,g=d.width,p=d.height,_=e.length,y=(m.length,n(r,g)),v=n(a,p),C=i.centerX||0,w=i.centerY||0,b=g>>1,M=p>>1;for(C=t(C*(r-1))-b,w=t(w*(a-1))-M,l=0,h=0,o=0;_>o;o+=4,l++)l>=r&&(l=0,h++),c=l-C,f=h-w,c>=0&&y>c&&f>=0&&v>f?(u=c+f*g<<2,e[o+3]=m[u+3]):e[o+3]=0;return e}})}(r),!function(r,n){"use strict";var t,a="hasOwnProperty",i=Math.min,s=Math.max,o=Math.round,l=(Math.floor,Math.abs),h=r._notSupportClamp;t={normal:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=e[r],c=e[r+1],f=e[r+2],d=n[t],m=n[t+1],g=n[t+2];a=d,i=m,s=g,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[r]=~~u,e[r+1]=~~c,e[r+2]=~~f},lighten:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=e[r],c=e[r+1],f=e[r+2],d=n[t],m=n[t+1],g=n[t+2];a=u>d?u:d,i=c>m?c:m,s=f>g?f:g,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[r]=~~u,e[r+1]=~~c,e[r+2]=~~f},darken:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=e[r],c=e[r+1],f=e[r+2],d=n[t],m=n[t+1],g=n[t+2];a=u>d?d:u,i=c>m?m:c,s=f>g?g:f,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[r]=~~u,e[r+1]=~~c,e[r+2]=~~f},multiply:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=e[r],c=e[r+1],f=e[r+2],d=n[t],m=n[t+1],g=n[t+2];a=u*d*.003921568627451,i=c*m*.003921568627451,s=f*g*.003921568627451,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[r]=~~u,e[r+1]=~~c,e[r+2]=~~f},average:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=e[r],c=e[r+1],f=e[r+2],d=n[t],m=n[t+1],g=n[t+2];a=.5*(u+d),i=.5*(c+m),s=.5*(f+g),u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[r]=~~u,e[r+1]=~~c,e[r+2]=~~f},add:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=e[r],c=e[r+1],f=e[r+2],d=n[t],m=n[t+1],g=n[t+2];a=u+d,i=c+m,s=f+g,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[r]=~~u,e[r+1]=~~c,e[r+2]=~~f},subtract:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=e[r],c=e[r+1],f=e[r+2],d=n[t],m=n[t+1],g=n[t+2];a=255>u+d?0:u+d-255,i=255>c+m?0:c+m-255,s=255>f+g?0:f+g-255,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[r]=~~u,e[r+1]=~~c,e[r+2]=~~f},difference:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],u=1-o,c=e[r],f=e[r+1],d=e[r+2],m=n[t],g=n[t+1],p=n[t+2];a=l(m-c),i=l(g-f),s=l(p-d),c=a*o+c*u,f=i*o+f*u,d=s*o+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[r]=~~c,e[r+1]=~~f,e[r+2]=~~d},negation:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],u=1-o,c=e[r],f=e[r+1],d=e[r+2],m=n[t],g=n[t+1],p=n[t+2];a=255-l(255-m-c),i=255-l(255-g-f),s=255-l(255-p-d),c=a*o+c*u,f=i*o+f*u,d=s*o+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[r]=~~c,e[r+1]=~~f,e[r+2]=~~d},screen:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=e[r],c=e[r+1],f=e[r+2],d=n[t],m=n[t+1],g=n[t+2];a=255-((255-d)*(255-u)>>8),i=255-((255-m)*(255-c)>>8),s=255-((255-g)*(255-f)>>8),u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[r]=~~u,e[r+1]=~~c,e[r+2]=~~f},exclusion:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=e[r],c=e[r+1],f=e[r+2],d=n[t],m=n[t+1],g=n[t+2];a=d+u-2*d*u*.003921568627451,i=m+c-2*m*c*.003921568627451,s=g+f-2*g*f*.003921568627451,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[r]=~~u,e[r+1]=~~c,e[r+2]=~~f},overlay:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=e[r],c=e[r+1],f=e[r+2],d=n[t],m=n[t+1],g=n[t+2];a=128>u?2*d*u*.003921568627451:255-2*(255-d)*(255-u)*.003921568627451,i=128>c?2*m*c*.003921568627451:255-2*(255-m)*(255-c)*.003921568627451,a=128>f?2*g*f*.003921568627451:255-2*(255-g)*(255-f)*.003921568627451,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[r]=~~u,e[r+1]=~~c,e[r+2]=~~f},softlight:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=e[r],c=e[r+1],f=e[r+2],d=n[t],m=n[t+1],g=n[t+2];a=128>u?2*((d>>1)+64)*(.003921568627451*u):255-2*(255-((d>>1)+64))*(255-u)*.003921568627451,i=128>c?2*((m>>1)+64)*(.003921568627451*c):255-2*(255-((m>>1)+64))*(255-c)*.003921568627451,s=128>f?2*((g>>1)+64)*(.003921568627451*f):255-2*(255-((g>>1)+64))*(255-f)*.003921568627451,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[r]=~~u,e[r+1]=~~c,e[r+2]=~~f},hardlight:function(e,r,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=e[r],c=e[r+1],f=e[r+2],d=n[t],m=n[t+1],g=n[t+2];a=128>d?2*u*d*.003921568627451:255-2*(255-u)*(255-d)*.003921568627451,i=128>m?2*c*m*.003921568627451:255-2*(255-c)*(255-m)*.003921568627451,s=128>g?2*f*g*.003921568627451:255-2*(255-f)*(255-g)*.003921568627451,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[r]=~~u,e[r+1]=~~c,e[r+2]=~~f},colordodge:function(e,r,n,t){var a,s,o,l=.003921568627451*n[t+3],u=1-l,c=e[r],f=e[r+1],d=e[r+2],m=n[t],g=n[t+1],p=n[t+2];a=255==c?c:i(255,(m<<8)/(255-c)),s=255==f?f:i(255,(g<<8)/(255-f)),o=255==d?c:i(255,(p<<8)/(255-d)),c=a*l+c*u,f=s*l+f*u,d=o*l+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[r]=~~c,e[r+1]=~~f,e[r+2]=~~d},colorburn:function(e,r,n,t){var a,i,o,l=.003921568627451*n[t+3],u=1-l,c=e[r],f=e[r+1],d=e[r+2],m=n[t],g=n[t+1],p=n[t+2];a=0==c?c:s(0,255-(255-m<<8)/c),i=0==f?f:s(0,255-(255-g<<8)/f),o=0==d?d:s(0,255-(255-p<<8)/d),c=a*l+c*u,f=i*l+f*u,d=o*l+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[r]=~~c,e[r+1]=~~f,e[r+2]=~~d},linearlight:function(e,r,n,t){var a,i,s,o,l=.003921568627451*n[t+3],u=1-l,c=e[r],f=e[r+1],d=e[r+2],m=n[t],g=n[t+1],p=n[t+2];128>c?(o=2*c,a=255>o+m?0:o+m-255):(o=2*(c-128),a=o+m),128>f?(o=2*f,i=255>o+g?0:o+g-255):(o=2*(f-128),i=o+g),128>d?(o=2*d,s=255>o+p?0:o+p-255):(o=2*(d-128),s=o+p),c=a*l+c*u,f=i*l+f*u,d=s*l+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[r]=~~c,e[r+1]=~~f,e[r+2]=~~d},reflect:function(e,r,n,t){var a,s,o,l=.003921568627451*n[t+3],u=1-l,c=e[r],f=e[r+1],d=e[r+2],m=n[t],g=n[t+1],p=n[t+2];a=255==c?c:i(255,m*m/(255-c)),s=255==f?f:i(255,g*g/(255-f)),o=255==d?d:i(255,p*p/(255-d)),c=a*l+c*u,f=s*l+f*u,d=o*l+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[r]=~~c,e[r+1]=~~f,e[r+2]=~~d},glow:function(e,r,n,t){var a,s,o,l=.003921568627451*n[t+3],u=1-l,c=e[r],f=e[r+1],d=e[r+2],m=n[t],g=n[t+1],p=n[t+2];a=255==m?m:i(255,c*c/(255-m)),s=255==g?g:i(255,f*f/(255-g)),o=255==p?p:i(255,d*d/(255-p)),c=a*l+c*u,f=s*l+f*u,d=o*l+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[r]=~~c,e[r+1]=~~f,e[r+2]=~~d},phoenix:function(e,r,n,t){var a,o,l,u=.003921568627451*n[t+3],c=1-u,f=e[r],d=e[r+1],m=e[r+2],g=n[t],p=n[t+1],_=n[t+2];a=i(g,f)-s(g,f)+255,o=i(p,d)-s(p,d)+255,l=i(_,m)-s(_,m)+255,f=a*u+f*c,d=o*u+d*c,m=l*u+m*c,h&&(f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m),e[r]=~~f,e[r+1]=~~d,e[r+2]=~~m},vividlight:function(e,r,n,t){var a,o,l,u,c=.003921568627451*n[t+3],f=1-c,d=e[r],m=e[r+1],g=e[r+2],p=n[t],_=n[t+1],y=n[t+2];128>d?(u=2*d,a=0==u?u:s(0,255-(255-p<<8)/u)):(u=2*(d-128),a=255==u?u:i(255,(p<<8)/(255-u))),128>m?(u=2*m,o=0==u?u:s(0,255-(255-_<<8)/u)):(u=2*(m-128),o=255==u?u:i(255,(_<<8)/(255-u))),128>g?(u=2*g,l=0==u?u:s(0,255-(255-y<<8)/u)):(u=2*(m-128),l=255==u?u:i(255,(y<<8)/(255-u))),d=a*c+d*f,m=o*c+m*f,g=l*c+g*f,h&&(d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m,g=0>g?0:g>255?255:g),e[r]=~~d,e[r+1]=~~m,e[r+2]=~~g},pinlight:function(e,r,n,t){var a,i,s,o,l=.003921568627451*n[t+3],u=1-l,c=e[r],f=e[r+1],d=e[r+2],m=n[t],g=n[t+1],p=n[t+2];128>c?(o=2*c,a=o>m?o:m):(o=2*(c-128),a=o>m?m:o),128>f?(o=2*f,i=o>g?o:g):(o=2*(c-128),i=o>g?g:o),128>d?(o=2*d,s=o>p?o:p):(o=2*(d-128),s=o>p?p:o),c=a*l+c*u,f=i*l+f*u,d=s*l+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[r]=~~c,e[r+1]=~~f,e[r+2]=~~d},hardmix:function(e,r,n,t){var a,o,l,u,c=.003921568627451*n[t+3],f=1-c,d=e[r],m=e[r+1],g=e[r+2],p=n[t],_=n[t+1],y=n[t+2];128>d?(u=2*d,a=0==u?u:s(0,255-(255-p<<8)/u)):(u=2*(d-128),a=255==u?u:i(255,(p<<8)/(255-u))),a=128>a?0:255,128>m?(u=2*m,o=0==u?u:s(0,255-(255-_<<8)/u)):(u=2*(m-128),o=255==u?u:i(255,(_<<8)/(255-u))),o=128>o?0:255,128>g?(u=2*g,l=0==u?u:s(0,255-(255-y<<8)/u)):(u=2*(g-128),l=255==u?u:i(255,(y<<8)/(255-u))),l=128>l?0:255,d=a*c+d*f,m=o*c+m*f,g=l*c+g*f,h&&(d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m,g=0>g?0:g>255?255:g),e[r]=~~d,e[r+1]=~~m,e[r+2]=~~g}},t.lineardodge=t.add,t.linearburn=t.subtract,r.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendImage:null,startX:0,startY:0,path:r.getPath(e.moduleUri),init:function(e,r){var n=this;n.startX=0,n.startY=0,n._blendImage=null,n.blendImage=null,n._blendMode=null,e&&n.setImage(e),r&&n.setMode(r)},dispose:function(){var e=this;return e.blendImage=null,e._blendImage=null,e._blendMode=null,e.$super("dispose"),e},setImage:function(e){var r=this;return e&&(r.blendImage=e,r._blendImage=null),r},setMode:function(e){var r=this;return e?(r._blendMode=(""+e).toLowerCase(),t[a](r._blendMode)||(r._blendMode=null)):r._blendMode=null,r},serialize:function(){var e=this,r=e.blendImage;return{filter:e.name,_isOn:!!e._isOn,params:{_blendImage:e._blendImage||(r?{data:r.getData(),width:r.width,height:r.height}:null),_blendMode:e._blendMode,startX:e.startX,startY:e.startY}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.startX=n.startX,t.startY=n.startY,t.blendImage=null,t._blendImage=n._blendImage,t._blendImage&&(t._blendImage.data=r.TypedArray(t._blendImage.data,r.ImArray)),t.setMode(n._blendMode)),t},reset:function(){var e=this;return e.startX=0,e.startY=0,e._blendMode=null,e},apply:function(e,r,n){var a=this,s=a.blendImage;if(!a._isOn||!a._blendMode||!s&&!a._blendImage)return e;var l,h,u,c,f,d,m,g,p,_,y,v,C,w,b=a._blendImage||{data:s.getData(),width:s.width,height:s.height},M=a.startX||0,I=a.startY||0,O=0,z=0,x=t[a._blendMode];if(0>M&&(O=-M,M=0),0>I&&(z=-I,I=0),c=b.width,f=b.height,M>=r||I>=n)return e;if(O>=c||z>=f)return e;if(M=o(M),I=o(I),O=o(O),z=o(z),l=i(r-M,c-O),h=i(n-I,f-z),0>=l||0>=h)return e;for(u=b.data,_=M,y=I*r,v=O,C=z*c,d=M+l,m=O+l,g=0,p=h*l;p>g;)w=v+C<<2,u[w+3]&&x(e,_+y<<2,u,w),g++,_++,_>=d&&(_=M,y+=r),v++,v>=m&&(v=O,C+=c);return e}})}(r),r});