/**
*
*   FILTER.js Plugins
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,n){"use strict";"object"==typeof module&&module.exports?module.exports=n.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(r,t){return n.moduleUri=r.uri,n.call(e,t),t}):(n.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(n){"use strict";var r=n.getPath(e.moduleUri);return!function(e){var n=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,n){var r=this;r.min=e||-127,r.max=n||127},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{min:e.min,max:e.max}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.min=n.min,r.max=n.max),r},apply:function(e,r,a){var i=this;if(!i._isOn)return e;var s,o,l,u,c,f,h,d,m=i.max-i.min,p=i.min,_=e.length;if(n)for(s=0;_>s;s+=4)l=e[s],u=e[s+1],c=e[s+2],o=m*t()+p,f=l+o,h=u+o,d=c+o,0>f?f=0:f>255&&(f=255),0>h?h=0:h>255&&(h=255),0>d?d=0:d>255&&(d=255),e[s]=~~f,e[s+1]=~~h,e[s+2]=~~d;else for(s=0;_>s;s+=4)l=e[s],u=e[s+1],c=e[s+2],o=m*t()+p,f=l+o,h=u+o,d=c+o,e[s]=~~f,e[s+1]=~~h,e[s+2]=~~d;return e}})}(n),!function(e){var n=e.Util.Image.perlin,t=e.MODE;e.Create({name:"PerlinNoiseFilter",_baseX:1,_baseY:1,_octaves:1,_offsets:null,_mode:t.GRAY,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:r,init:function(e,n,r,a,i,s,o,l){var u=this;u._mode=t.GRAY,u._baseX=e||1,u._baseY=n||1,u._seed=o||0,u._stitch=!!a,u._fractal=!1!==i,u._perlin=!!l,u.octaves(r||1,s)},seed:function(e){var n=this;return n._seed=e||0,n},octaves:function(e,n){var r=this;for(r._octaves=e||1,r._offsets=n?n.slice(0):[];r._offsets.length<r._octaves;)r._offsets.push([0,0]);return r},seamless:function(e){return arguments.length||(e=!0),this._stitch=!!e,this},colors:function(e){return arguments.length||(e=!0),this._mode=e?t.COLOR:t.GRAY,this},turbulence:function(e){return arguments.length||(e=!0),this._fractal=!e,this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_baseX:e._baseX,_baseY:e._baseY,_octaves:e._octaves,_offsets:e._offsets,_seed:e._seed||0,_stitch:e._stitch,_mode:e._mode,_fractal:e._fractal,_perlin:e._perlin}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r._baseX=n._baseX,r._baseY=n._baseY,r._octaves=n._octaves,r._offsets=n._offsets,r._seed=n._seed||0,r._stitch=n._stitch,r._mode=n._mode,r._fractal=n._fractal,r._perlin=n._perlin),r},apply:function(e,r,a){var i=this;return i._isOn&&n?(i._seed&&(n.seed(i._seed),i._seed=0),n(e,r,a,i._stitch,t.COLOR!==i._mode,i._baseX,i._baseY,i._octaves,i._offsets,1,.5,i._perlin)):e}})}(n),!function(e,n){var t=e.Util.Image,a=e.Util.Array.typed,i=Math.floor;e.Create({name:"GradientFilter",colors:null,stops:null,angle:0,path:r,init:function(e,n,r){var t=this;t.setColors(e,n),t.angle=r||0},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.angle=null,e.$super("dispose"),e},setColors:function(e,n){var r=this;if(e&&e.length){var a=t.colors_stops(e,n);r.colors=a[0],r.stops=a[1]}return r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{angle:e.angle,colors:e.colors,stops:e.stops}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.angle=n.angle,r.colors=a(n.colors,Array),r.stops=a(n.stops,Array)),r},apply:function(e,n,r){var a=this;return a._isOn&&a.colors?t.gradient(e,n,r,a.colors,a.stops,a.angle,t.lerp):e}}),e.Create({name:"RadialGradientFilter",colors:null,stops:null,centerX:0,centerY:0,radiusX:1,radiusY:1,init:function(e,n,r,t,a,i){var s=this;s.setColors(e,n),s.centerX=r||0,s.centerY=t||0,s.radiusX=a||1,s.radiusY=i||1},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.centerX=null,e.centerY=null,e.radiusX=null,e.radiusY=null,e.$super("dispose"),e},setColors:function(e,n){var r=this;if(e&&e.length){var a=t.colors_stops(e,n);r.colors=a[0],r.stops=a[1]}return r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radiusX:e.radiusX,radiusY:e.radiusY,colors:e.colors,stops:e.stops}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.centerX=n.centerX||0,r.centerY=n.centerY||0,r.radiusX=n.radiusX||1,r.radiusY=n.radiusY||1,r.colors=a(n.colors,Array),r.stops=a(n.stops,Array)),r},apply:function(e,n,r){var a=this;return a._isOn&&a.colors?t.radial_gradient(e,n,r,a.colors,a.stops,i((a.centerX||0)*(n-1)),i((a.centerY||0)*(r-1)),a.radiusX,a.radiusY,t.lerp):e}})}(n),!function(e){var n=Math.min,t=Math.floor,a=e.CHANNEL;e.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:a.RED,dstChannel:a.RED,path:r,init:function(e,n,r,t,i){var s=this;s._srcImg=null,s.srcImg=null,s.srcChannel=n||a.RED,s.dstChannel=r||a.RED,s.centerX=t||0,s.centerY=i||0,e&&s.setSrc(e)},dispose:function(){var e=this;return e.srcChannel=null,e.dstChannel=null,e.centerX=null,e.centerY=null,e.srcImg=null,e._srcImg=null,e.$super("dispose"),e},setSrc:function(e){var n=this;return e&&(n.srcImg=e,n._srcImg=null),n},serialize:function(){var e=this,n=e.srcImg;return{filter:e.name,_isOn:!!e._isOn,params:{_srcImg:e._srcImg||(n?{data:n.getData(),width:n.width,height:n.height}:null),centerX:e.centerX,centerY:e.centerY,srcChannel:e.srcChannel,dstChannel:e.dstChannel}}},unserialize:function(n){var r,t=this;return n&&t.name===n.filter&&(t._isOn=!!n._isOn,r=n.params,t.srcImg=null,t._srcImg=r._srcImg,t._srcImg&&(t._srcImg.data=e.Util.Array.typed(t._srcImg.data,e.ImArray)),t.centerX=r.centerX,t.centerY=r.centerY,t.srcChannel=r.srcChannel,t.dstChannel=r.dstChannel),t},apply:function(e,r,a){var i=this,s=i.srcImg;if(!i._isOn||!s&&!i._srcImg)return e;var o,l,u,c,f,h,d=i._srcImg||{data:s.getData(),width:s.width,height:s.height},m=d.data,p=d.width,_=d.height,g=e.length,v=(m.length,i.srcChannel),y=i.dstChannel,O=n(r,p),C=n(a,_),b=i.centerX||0,w=i.centerY||0,I=p>>1,Y=_>>1;for(b=t(b*(r-1))-I,w=t(w*(a-1))-Y,o=0,l=0,u=0,o=0;g>o;o+=4,l++)l>=r&&(l=0,u++),f=l-b,h=u-w,f>=0&&O>f&&h>=0&&C>h&&(c=f+h*p<<2,e[o+y]=m[c+v]);return e}})}(n),!function(e){var n=(e._notSupportClamp,e.CHANNEL),t=Math.min,a=Math.floor;e.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,channel:n.ALPHA,path:r,init:function(e,r,t,a){var i=this;i.centerX=r||0,i.centerY=t||0,i.channel=null==a?n.ALPHA:a||n.RED,i._alphaMask=null,i.alphaMask=null,e&&i.setMask(e)},dispose:function(){var e=this;return e.centerX=null,e.centerY=null,e.channel=null,e.alphaMask=null,e._alphaMask=null,e.$super("dispose"),e},setMask:function(e){var n=this;return e&&(n.alphaMask=e,n._alphaMask=null),n},serialize:function(){var e=this,n=e.alphaMask;return{filter:e.name,_isOn:!!e._isOn,params:{_alphaMask:e._alphaMask||(n?{data:n.getData(),width:n.width,height:n.height}:null),centerX:e.centerX,centerY:e.centerY,channel:e.channel}}},unserialize:function(n){var r,t=this;return n&&t.name===n.filter&&(t._isOn=!!n._isOn,r=n.params,t.alphaMask=null,t._alphaMask=r._alphaMask,t._alphaMask&&(t._alphaMask.data=e.Util.Array.typed(t._alphaMask.data,e.ImArray)),t.centerX=r.centerX,t.centerY=r.centerY,t.channel=r.channel),t},apply:function(e,r,i){var s=this,o=s.alphaMask;if(!s._isOn||!o&&!s._alphaMask)return e;var l,u,c,f,h,d,m=s._alphaMask||{data:o.getData(),width:o.width,height:o.height},p=m.data,_=m.width,g=m.height,v=e.length,y=(p.length,t(r,_)),O=t(i,g),C=null==s.channel?n.ALPHA:s.channel||n.RED,b=s.centerX||0,w=s.centerY||0,I=_>>1,Y=g>>1;for(b=a(b*(r-1))-I,w=a(w*(i-1))-Y,u=0,c=0,l=0;v>l;l+=4,u++)u>=r&&(u=0,c++),h=u-b,d=c-w,h>=0&&y>h&&d>=0&&O>d?(f=h+d*_<<2,e[l+3]=p[f+C]):e[l+3]=0;return e}})}(n),!function(e){var n=e._notSupportClamp,t=e.Array32F,a=e.MODE,i=Math.min,s=Math.max;e.Util.Array.subarray;e.Create({name:"HistogramEqualizeFilter",path:r,mode:a.COLOR,init:function(e){var n=this;n.mode=e||a.COLOR},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{mode:e.mode}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.mode=n.mode),r},_apply_rgb:function(e,r,a){var o=this;if(!o._isOn)return e;var l,u,c,f,h,d,m,p,_,g,v,y,O,C,b,w,I=0,Y=0,M=0,z=255,X=255,A=255,x=e.length,R=x>>2,H=1/R;for(m=new t(256),p=new t(256),_=new t(256),w=0;x>w;w+=4)l=e[w],u=e[w+1],c=e[w+2],m[l]+=H,p[u]+=H,_[c]+=H,I=s(l,I),Y=s(u,Y),M=s(c,M),z=i(l,z),X=i(u,X),A=i(c,A);for(g=v=y=0,w=0;256>w;w+=32)g+=m[w],m[w]=g,g+=m[w+1],m[w+1]=g,g+=m[w+2],m[w+2]=g,g+=m[w+3],m[w+3]=g,g+=m[w+4],m[w+4]=g,g+=m[w+5],m[w+5]=g,g+=m[w+6],m[w+6]=g,g+=m[w+7],m[w+7]=g,g+=m[w+8],m[w+8]=g,g+=m[w+9],m[w+9]=g,g+=m[w+10],m[w+10]=g,g+=m[w+11],m[w+11]=g,g+=m[w+12],m[w+12]=g,g+=m[w+13],m[w+13]=g,g+=m[w+14],m[w+14]=g,g+=m[w+15],m[w+15]=g,g+=m[w+16],m[w+16]=g,g+=m[w+17],m[w+17]=g,g+=m[w+18],m[w+18]=g,g+=m[w+19],m[w+19]=g,g+=m[w+20],m[w+20]=g,g+=m[w+21],m[w+21]=g,g+=m[w+22],m[w+22]=g,g+=m[w+23],m[w+23]=g,g+=m[w+24],m[w+24]=g,g+=m[w+25],m[w+25]=g,g+=m[w+26],m[w+26]=g,g+=m[w+27],m[w+27]=g,g+=m[w+28],m[w+28]=g,g+=m[w+29],m[w+29]=g,g+=m[w+30],m[w+30]=g,g+=m[w+31],m[w+31]=g,v+=p[w],p[w]=v,v+=p[w+1],p[w+1]=v,v+=p[w+2],p[w+2]=v,v+=p[w+3],p[w+3]=v,v+=p[w+4],p[w+4]=v,v+=p[w+5],p[w+5]=v,v+=p[w+6],p[w+6]=v,v+=p[w+7],p[w+7]=v,v+=p[w+8],p[w+8]=v,v+=p[w+9],p[w+9]=v,v+=p[w+10],p[w+10]=v,v+=p[w+11],p[w+11]=v,v+=p[w+12],p[w+12]=v,v+=p[w+13],p[w+13]=v,v+=p[w+14],p[w+14]=v,v+=p[w+15],p[w+15]=v,v+=p[w+16],p[w+16]=v,v+=p[w+17],p[w+17]=v,v+=p[w+18],p[w+18]=v,v+=p[w+19],p[w+19]=v,v+=p[w+20],p[w+20]=v,v+=p[w+21],p[w+21]=v,v+=p[w+22],p[w+22]=v,v+=p[w+23],p[w+23]=v,v+=p[w+24],p[w+24]=v,v+=p[w+25],p[w+25]=v,v+=p[w+26],p[w+26]=v,v+=p[w+27],p[w+27]=v,v+=p[w+28],p[w+28]=v,v+=p[w+29],p[w+29]=v,v+=p[w+30],p[w+30]=v,v+=p[w+31],p[w+31]=v,y+=_[w],_[w]=y,y+=_[w+1],_[w+1]=y,y+=_[w+2],_[w+2]=y,y+=_[w+3],_[w+3]=y,y+=_[w+4],_[w+4]=y,y+=_[w+5],_[w+5]=y,y+=_[w+6],_[w+6]=y,y+=_[w+7],_[w+7]=y,y+=_[w+8],_[w+8]=y,y+=_[w+9],_[w+9]=y,y+=_[w+10],_[w+10]=y,y+=_[w+11],_[w+11]=y,y+=_[w+12],_[w+12]=y,y+=_[w+13],_[w+13]=y,y+=_[w+14],_[w+14]=y,y+=_[w+15],_[w+15]=y,y+=_[w+16],_[w+16]=y,y+=_[w+17],_[w+17]=y,y+=_[w+18],_[w+18]=y,y+=_[w+19],_[w+19]=y,y+=_[w+20],_[w+20]=y,y+=_[w+21],_[w+21]=y,y+=_[w+22],_[w+22]=y,y+=_[w+23],_[w+23]=y,y+=_[w+24],_[w+24]=y,y+=_[w+25],_[w+25]=y,y+=_[w+26],_[w+26]=y,y+=_[w+27],_[w+27]=y,y+=_[w+28],_[w+28]=y,y+=_[w+29],_[w+29]=y,y+=_[w+30],_[w+30]=y,y+=_[w+31],_[w+31]=y;if(f=I-z,h=Y-X,d=M-A,n)for(w=0;x>w;w+=4)l=e[w],u=e[w+1],c=e[w+2],O=m[l]*f+z,C=p[u]*h+X,b=_[c]*d+A,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,b=0>b?0:b>255?255:b,e[w]=~~O,e[w+1]=~~C,e[w+2]=~~b;else for(w=0;x>w;w+=4)l=e[w],u=e[w+1],c=e[w+2],O=m[l]*f+z,C=p[u]*h+X,b=_[c]*d+A,e[w]=~~O,e[w+1]=~~C,e[w+2]=~~b;return e},apply:function(e,r,o){var l=this;if(!l._isOn)return e;if(a.RGB===l.mode)return l._apply_rgb(e,r,o);var u,c,f,h,d,m,p,_,g,v,y=0,O=255,C=e.length,b=C>>2,w=1/b,I=a.GRAY===l.mode;if(_=new t(256),I)for(v=0;C>v;v+=4)u=e[v],_[u]+=w,y=s(u,y),O=i(u,O);else for(v=0;C>v;v+=4)u=e[v],c=e[v+1],f=e[v+2],h=~~(0+.299*u+.587*c+.114*f),d=~~(128-.168736*u-.331264*c+.5*f),m=~~(128+.5*u-.418688*c-.081312*f),m=0>m?0:m>255?255:m,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[v]=m,e[v+1]=h,e[v+2]=d,_[h]+=w,y=s(h,y),O=i(h,O);for(g=0,v=0;256>v;v+=32)g+=_[v],_[v]=g,g+=_[v+1],_[v+1]=g,g+=_[v+2],_[v+2]=g,g+=_[v+3],_[v+3]=g,g+=_[v+4],_[v+4]=g,g+=_[v+5],_[v+5]=g,g+=_[v+6],_[v+6]=g,g+=_[v+7],_[v+7]=g,g+=_[v+8],_[v+8]=g,g+=_[v+9],_[v+9]=g,g+=_[v+10],_[v+10]=g,g+=_[v+11],_[v+11]=g,g+=_[v+12],_[v+12]=g,g+=_[v+13],_[v+13]=g,g+=_[v+14],_[v+14]=g,g+=_[v+15],_[v+15]=g,g+=_[v+16],_[v+16]=g,g+=_[v+17],_[v+17]=g,g+=_[v+18],_[v+18]=g,g+=_[v+19],_[v+19]=g,g+=_[v+20],_[v+20]=g,g+=_[v+21],_[v+21]=g,g+=_[v+22],_[v+22]=g,g+=_[v+23],_[v+23]=g,g+=_[v+24],_[v+24]=g,g+=_[v+25],_[v+25]=g,g+=_[v+26],_[v+26]=g,g+=_[v+27],_[v+27]=g,g+=_[v+28],_[v+28]=g,g+=_[v+29],_[v+29]=g,g+=_[v+30],_[v+30]=g,g+=_[v+31],_[v+31]=g;if(p=y-O,n)if(I)for(v=0;C>v;v+=4)u=~~(_[e[v]]*p+O),u=0>u?0:u>255?255:u,e[v]=u,e[v+1]=u,e[v+2]=u;else for(v=0;C>v;v+=4)h=_[e[v+1]]*p+O,d=e[v+2],m=e[v],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v]=u,e[v+1]=c,e[v+2]=f;else if(I)for(v=0;C>v;v+=4)u=~~(_[e[v]]*p+O),e[v]=u,e[v+1]=u,e[v+2]=u;else for(v=0;C>v;v+=4)h=_[e[v+1]]*p+O,d=e[v+2],m=e[v],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),e[v]=u,e[v+1]=c,e[v+2]=f;return e}})}(n),!function(e){var n=e.ImArray,t=Math.sqrt,a=Math.min;Math.max,t(3);e.Create({name:"PixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.scale=n.scale),r},apply:function(e,r,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,c,f,h,d,m,p,_,g,v,y,O,C,b,w,I,Y,M,z,X,A,x,R,H,F,L,k,E,N,S,U,q=e.length,D=q>>>2,P=r-1,T=D-r;for(o=new n(q),l=~~(t(D)*s.scale*.01),u=l-1,c=r*u,_=g=v=y=O=0,p=0;q>p;p+=4)C=_-v,b=g-O,w=a(P,C+u),I=a(T,b+c),f=C+b<<2,h=C+I<<2,d=w+b<<2,m=w+I<<2,X=e[f],A=e[f+1],x=e[f+2],R=e[h],H=e[h+1],F=e[h+2],L=e[d],k=e[d+1],E=e[d+2],N=e[m],S=e[m+1],U=e[m+2],Y=~~((X+R+L+N)/4),M=~~((A+H+k+S)/4),z=~~((x+F+E+U)/4),o[p]=Y,o[p+1]=M,o[p+2]=z,o[p+3]=e[p+3],_++,v++,_>=r&&(v=0,_=0,y++,O+=r,g+=r,y>=l&&(y=0,O=0)),v>=l&&(v=0);return o}}),e.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.scale=n.scale),r},apply:function(e,r,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,c,f,h,d,m,p,_,g,v,y,O,C,b,w,I,Y,M,z,X,A,x,R,H,F,L,k,E,N=e.length,S=N>>>2,U=r-1,q=S-r;for(o=new n(N),l=~~(t(S)*s.scale*.01),u=l-1,c=r*u,p=_=g=v=y=0,m=0;N>m;m+=4)O=p-g,C=_-y,b=a(U,O+u),w=a(q,C+c),I=a(U,O+(u>>>1)),g+v>u?(f=b+C<<2,h=b+w<<2,d=O+C<<2):(f=O+C<<2,h=O+w<<2,d=b+C<<2),X=e[f],A=e[f+1],x=e[f+2],R=e[h],H=e[h+1],F=e[h+2],L=e[d],k=e[d+1],E=e[d+2],Y=~~((X+R+L)/3),M=~~((A+H+k)/3),z=~~((x+F+E)/3),o[m]=Y,o[m+1]=M,o[m+2]=z,o[m+3]=e[m+3],p++,g++,p>=r&&(g=0,p=0,v++,y+=r,_+=r,v>=l&&(v=0,y=0)),g>=l&&(g=0);return o}})}(n),!function(e,n){var t=7/16,a=3/16,i=5/16,s=1/16,o=e.MODE,l=e.Array32F,u=e.Color.clamp,c=e.Color.RGB2YCbCr,f=e.Color.YCbCr2RGB;e.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:o.GRAY,init:function(e,n,r){var t=this;t.size=e||1,t.thresh=u(null==n?.4:n,0,1),t.mode=r||o.GRAY},path:r,threshold:function(e){return this.thresh=u(e,0,1),this},grayscale:function(e){return arguments.length||(e=!0),this.mode=e?o.GRAY:o.RGB,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{size:e.size,thresh:e.thresh,mode:e.mode}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.size=n.size,r.thresh=n.thresh,r.mode=n.mode),r},apply:function(e,n,r){var h,d,m,p,_,g,v,y,O,C,b,w,I,Y,M,z,X,A=this,x=e.length,R=x>>>2,H=new l(3*R),F=A.size,L=F*F,k=1/L,E=255*A.thresh,N=N<<1,S=o.RGB===A.mode,U=F*n,q=t,D=a,P=i,T=s;for(v=0,y=0,g=0;r>v;){for(w=I=Y=0,O=0,C=0,b=0;F>C;)h=g+y+O+b<<2,d=3*(g+y+O+b),w+=e[h]+H[d],I+=e[h+1]+H[d+1],Y+=e[h+2]+H[d+2],O++,O>=F&&(O=0,C++,b+=n);if(w*=k,I*=k,Y*=k,_=S?c([w,I,Y],0):[w,I,Y],m=_[0],m>E?S?(_[0]=u(~~m,0,255),p=f(_,0)):p=[255,255,255]:p=[0,0,0],h=g+y<<2,M=e[h]-p[0],z=e[h+1]-p[1],X=e[h+2]-p[2],n>g+F)for(O=F,C=0,b=0;F>C;)d=3*(g+y+O+b),H[d]+=q*M,H[d+1]+=q*z,H[d+2]+=q*X,O++,O>=N&&(O=F,C++,b+=n);if(r>v+F&&g>F)for(O=-F,C=F,b=0;N>C;)d=3*(g+y+O+b),H[d]+=D*M,H[d+1]+=D*z,H[d+2]+=D*X,O++,O>=0&&(O=-F,C++,b+=n);if(r>v+F)for(O=0,C=F,b=0;N>C;)d=3*(g+y+O+b),H[d]+=P*M,H[d+1]+=P*z,H[d+2]+=P*X,O++,O>=F&&(O=0,C++,b+=n);if(r>v+F&&n>g+F)for(O=F,C=F,b=0;N>C;)d=3*(g+y+O+b),H[d]+=T*M,H[d+1]+=T*z,H[d+2]+=T*X,O++,O>=N&&(O=F,C++,b+=n);for(O=0,C=0,b=0;F>C;)h=g+y+O+b<<2,e[h]=p[0],e[h+1]=p[1],e[h+2]=p[2],O++,O>=F&&(O=0,C++,b+=n);g+=F,g>=n&&(g=0,v+=F,y+=U)}return e}})}(n),!function(e,n){var t="hasOwnProperty",a=Math.min,i=Math.round,s=e._notSupportClamp,o=e.Color.Combine;e.Create({name:"BlendFilter",_blendImage:null,blendImage:null,mode:null,startX:0,startY:0,path:r,init:function(e,n){var r=this;r.startX=0,r.startY=0,r._blendImage=null,r.blendImage=null,r.mode=null,e&&r.setImage(e),n&&r.setMode(n)},dispose:function(){var e=this;return e.blendImage=null,e._blendImage=null,e.mode=null,e.$super("dispose"),e},setImage:function(e){var n=this;return e&&(n.blendImage=e,n._blendImage=null),n},setMode:function(e){var n=this;return e?(n.mode=(""+e).toLowerCase(),o[t](n.mode)||(n.mode=null)):n.mode=null,n},serialize:function(){var e=this,n=e.blendImage;return{filter:e.name,_isOn:!!e._isOn,params:{_blendImage:e._blendImage||(n?{data:n.getData(),width:n.width,height:n.height}:null),mode:e.mode,startX:e.startX,startY:e.startY}}},unserialize:function(n){var r,t=this;return n&&t.name===n.filter&&(t._isOn=!!n._isOn,r=n.params,t.startX=r.startX,t.startY=r.startY,t.blendImage=null,t._blendImage=r._blendImage,t._blendImage&&(t._blendImage.data=e.Util.Array.typed(t._blendImage.data,e.ImArray)),t.setMode(r.mode)),t},reset:function(){var e=this;return e.startX=0,e.startY=0,e.mode=null,e},apply:function(e,n,r){var t=this,l=t.blendImage;if(!t._isOn||!t.mode||!l&&!t._blendImage)return e;var u,c,f,h,d,m,p,_,g,v,y,O,C,b,w=t._blendImage||{data:l.getData(),width:l.width,height:l.height},I=t.startX||0,Y=t.startY||0,M=0,z=0,X=o[t.mode];if(0>I&&(M=-I,I=0),0>Y&&(z=-Y,Y=0),h=w.width,d=w.height,I>=n||Y>=r)return e;if(M>=h||z>=d)return e;if(I=i(I),Y=i(Y),M=i(M),z=i(z),u=a(n-I,h-M),c=a(r-Y,d-z),0>=u||0>=c)return e;for(f=w.data,v=I,y=Y*n,O=M,C=z*h,m=I+u,p=M+u,_=0,g=c*u;g>_;_++)b=O+C<<2,0<f[b+3]&&X(e,f,v+y<<2,b,s),v++,v>=m&&(v=I,y+=n),O++,O>=p&&(O=M,C+=h);return e}})}(n),!function(e,n){var t=e.ImArray,a=e.Util.Filter.integral_convolution,i=new e.Array32F([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]);e.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:3,path:r,init:function(e,n,r,t,a){var i=this;i.offsetX=e||0,i.offsetY=n||0,i.color=r||0,i.opacity=null==t?1:+t,i.quality=a||3},dispose:function(){var e=this;return e.offsetX=null,e.offsetY=null,e.color=null,e.opacity=null,e.quality=null,e.$super("dispose"),e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{offsetX:e.offsetX,offsetY:e.offsetY,color:e.color,opacity:e.opacity,quality:e.quality}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.offsetX=n.offsetX,r.offsetY=n.offsetY,r.color=n.color,r.opacity=n.opacity,r.quality=n.quality),r},apply:function(e,n,r){var s=this;if(!s._isOn)return e;var o,l,u,c,f,h,d,m,p=s.color||0,_=~~s.quality,g=s.offsetX||0,v=s.offsetY||0,y=s.opacity,O=p>>>16&255,C=p>>>8&255,b=255&p,w=e.length,I=w>>>2;if(0>y&&(y=0),y>1&&(y=1),0===y)return e;for(0>=_&&(_=1),_>3&&(_=3),m=new t(w),o=0;w>o;o+=4)d=e[o+3],d>0?(m[o]=O,m[o+1]=C,m[o+2]=b,m[o+3]=~~(y*d)):(m[o]=0,m[o+1]=0,m[o+2]=0,m[o+3]=0);for(m=a(!1,m,n,r,i,null,3,3,1,0,_),v*=n,l=0,u=0,h=0;w>h;h+=4,l++)l>=n&&(l=0,u+=n),c=l+g,f=u+v,0>c||c>=n||0>f||f>=I||(o=c+f<<2,d=e[o+3],y=m[h+3],255!==d&&0!==y&&(y/=255,O=~~(e[o]+(m[h]-e[o])*y),C=~~(e[o+1]+(m[h+1]-e[o+1])*y),b=~~(e[o+2]+(m[h+2]-e[o+2])*y),e[o]=O,e[o+1]=C,e[o+2]=b));return e}})}(n),!function(e){var n=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=e._notSupportClamp,s=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,n,r,t){var a=this;a.centerX=e||0,a.centerY=n||0,a.radius=r||10,a.amount=t||10},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.centerX=n.centerX,r.centerY=n.centerY,r.radius=n.radius,r.amount=n.amount),r},apply:function(e,r,o){var l=this;if(!l._isOn)return e;var u,c,f,h,d,m,p,_,g,v,y,O,C,b,w,I,Y,M,z,X,A,x,R,H,F,L,k,E,N,S,U,q,D,P=e.length,T=l.centerX||0,G=l.centerY||0,$=l.radius,j=l.amount;if(0>=j)return e;for(u=P>>2,S=0,U=r-1,q=0,D=u-r,T=a(T*(r-1)),G=a(G*(o-1)),f=(u<<1)+u,p=(r<<1)+r,c=new s(f),_=0,g=0,v=0,h=d=m=0,v=0;r>v;v++,_+=4,g+=3)h+=e[_],d+=e[_+1],m+=e[_+2],c[g]=h,c[g+1]=d,c[g+2]=m;for(_=p+r,g=0,v=0,h=d=m=0,_=p+r;P>_;_+=4,g+=3,v++)v>=r&&(v=0,h=d=m=0),h+=e[_],d+=e[_+1],m+=e[_+2],c[g+p]=c[g]+h,c[g+p+1]=c[g+1]+d,c[g+p+2]=c[g+2]+m;for(v=0,y=0,O=0,_=0;P>_;_+=4,v++)v>=r&&(v=0,y++,O+=r),b=v-T,w=y-G,C=t(b)+t(w),I=C>$?~~n((C-$)*j):~~(C/$+.5),I>0&&(Y=I*r,M=.25/(I*I),z=v-I,X=O-Y,A=v+I,x=O+Y,S>z?z=S:A>U&&(A=U),q>X?X=q:x>D&&(x=D),R=z+X,L=A+x,H=A+X,F=z+x,R=(R<<1)+R,H=(H<<1)+H,F=(F<<1)+F,L=(L<<1)+L,k=M*(c[L]-c[H]-c[F]+c[R]),E=M*(c[L+1]-c[H+1]-c[F+1]+c[R+1]),N=M*(c[L+2]-c[H+2]-c[F+2]+c[R+2]),i&&(k=0>k?0:k>255?255:k,E=0>E?0:E>255?255:E,N=0>N?0:N>255?255:N),e[_]=~~k,e[_+1]=~~E,e[_+2]=~~N);return e}})}(n),!function(e){e.Create({name:"SeamlessTileFilter",type:2,init:function(e){var n=this;n.type=null==e?2:e||0},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{type:e.type}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.type=n.type),r},apply:function(n,r,t){var a,i,s,o,l,u,c,f,h,d,m,p,_,g,v,y=this,O=y.type,C=e.Interpolation.bilinear,b=e.ImArray,w=e.Array8U,I=Math.sqrt;for(r!==t?n=C(n,r,t,p=r>t?r:t,p):p=r,_=Math.round(p/2),g=p*p,v=n.length,a=new b(v),i=new b(v),s=new w(g),f=0,h=0,d=0;v>d;d+=4,f++)f>=p&&(f=0,h++),m=(f+_)%p+(h+_)%p*p<<2,a[m]=n[d],a[m+1]=n[d+1],a[m+2]=n[d+2],a[m+3]=n[d+3];if(0===O)for(f=0,h=0;_>f;h++)h>=_&&(h=0,f++),c=255-255*I((f-_)*(f-_)+(h-_)*(h-_))/_,c=1>c?1:c>255?255:c,s[f+h*p]=c,s[f+(p-1-h)*p]=c,s[p-1-f+h*p]=c,s[p-1-f+(p-1-h)*p]=c;else if(1===O)for(f=0,h=0;_>f;h++)h>=_&&(h=0,f++),c=255-255*(_+f>_+h?(h-_)/_:(f-p/2)/_),c=1>c?1:c>255?255:c,s[f+h*p]=c,s[f+(p-1-h)*p]=c,s[p-1-f+h*p]=c,s[p-1-f+(p-1-h)*p]=c;else for(f=0,h=0;_>f;h++)h>=_&&(h=0,f++),c=255-255*(_+f>_+h?I((h-p)*(h-p)+(f-p)*(f-p))/(1.13*p):I((f-p)*(f-p)+(h-p)*(h-p))/(1.13*p)),c=1>c?1:c>255?255:c,s[f+h*p]=c,s[f+(p-1-h)*p]=c,s[p-1-f+h*p]=c,s[p-1-f+(p-1-h)*p]=c;for(h=0,f=0;p>h;f++)f>=p&&(f=0,h++),m=f+h*p,o=s[m],l=s[(f+_)%p+(h+_)%p*p],u=o+l,o/=u,l/=u,m<<=2,i[m]=~~(o*n[m]+l*a[m]),i[m+1]=~~(o*n[m+1]+l*a[m+1]),i[m+2]=~~(o*n[m+2]+l*a[m+2]),i[m+3]=n[m+3];return r!==t&&(i=C(i,p,p,r,t)),i}})}(n),!function(e){var n=e.Util.Array.typed,t=Math.abs,a=(Math.min,Math.max,Math.ceil),i=e.MODE,s=e.Array8U,o=e.Array32U;e.Create({name:"FloodFillFilter",x:0,y:0,color:null,borderColor:null,tolerance:0,path:r,init:function(e,n,r,t,a){var i=this;i.x=e||0,i.y=n||0,i.color=r||0,i.tolerance=t||0,i.borderColor=a===+a?+a:null},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{color:e.color,borderColor:e.borderColor,x:e.x,y:e.y,tolerance:e.tolerance}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.color=n.color,r.borderColor=n.borderColor,r.x=n.x,r.y=n.y,r.tolerance=n.tolerance),r},apply:function(e,n,r){var a,i,o,l,u,c,f,h,d,m,p,_,g=this,v=~~(255*(g.tolerance>=1?.999:g.tolerance)),y=g.color||0,O=g.borderColor,C=O===+O,b=n<<2,w=g.x,I=g.y,Y=e.length,M=0,z=Y-b,X=0,A=n-1<<2;if(h=I*n<<2,w<<=2,X>w||w>A||M>h||h>z)return e;if(a=new s(3),i=new s(3),i[0]=y>>>16&255,i[1]=y>>>8&255,i[2]=255&y,C){if(a[0]=O>>>16&255,a[1]=O>>>8&255,a[2]=255&O,t(a[0]-e[w+h])<=v&&t(a[1]-e[w+h+1])<=v&&t(a[2]-e[w+h+2])<=v)return e}else{if(e[w+h]===i[0]&&e[w+h+1]===i[1]&&e[w+h+2]===i[2])return e;a[0]=e[w+h],a[1]=e[w+h+1],a[2]=e[w+h+2]}for(d=new Array(Y>>>2),m=0,h+b>=M&&z>=h+b&&(d[m++]=[h,w,w,b]),d[m++]=[h+b,w,w,-b];m>0;){if(p=d[--m],h=p[0]+(b=p[3]),c=p[1],f=p[2],C)for(u=c;u>=X&&(l=u+h,!(t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v));u-=4)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];else for(u=c;u>=X&&(l=u+h,t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v);u-=4)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];if(u>=c){if(l=u+h,C)for(;f>=u&&t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v;)u+=4,l=u+h;else for(;f>=u&&!(t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v);)u+=4,l=u+h;o=u,_=f>=u}else o=u+4,c>o&&h-b>=M&&z>=h-b&&(d[m++]=[h,o,c-4,-b]),u=c+4,_=!0;for(;_;){if(l=u+h,C)for(;A>=u&&!(t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v);)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],u+=4,l=u+h;else for(;A>=u&&t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v;)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],u+=4,l=u+h;if(h+b>=M&&z>=h+b&&(d[m++]=[h,o,u-4,b]),u>f+4&&h-b>=M&&z>=h-b&&(d[m++]=[h,f+4,u-4,-b]),l=u+h,C)for(;f>=u&&t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v;)u+=4,l=u+h;else for(;f>=u&&!(t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v);)u+=4,l=u+h;o=u,_=f>=u}}return e}}),e.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:0,pattern:null,_pattern:null,mode:i.TILE,borderColor:null,path:r,init:function(e,n,r,t,a,s,o,l){var u=this;u.x=e||0,u.y=n||0,u.offsetX=t||0,u.offsetY=a||0,r&&u.setPattern(r),u.mode=s||i.TILE,u.tolerance=o||0,u.borderColor=l===+l?+l:null},dispose:function(){var e=this;return e.pattern=null,e._pattern=null,e.x=null,e.y=null,e.offsetX=null,e.offsetY=null,e.tolerance=null,e.mode=null,e.borderColor=null,e.$super("dispose"),e},setPattern:function(e){var n=this;return e&&(n.pattern=e,n._pattern=null),n},serialize:function(){var e=this,n=e.pattern;return{filter:e.name,_isOn:!!e._isOn,params:{x:e.x,y:e.y,offsetX:e.offsetX,offsetY:e.offsetY,tolerance:e.tolerance,mode:e.mode,borderColor:e.borderColor,_pattern:e._pattern||(n?{data:n.getData(),width:n.width,height:n.height}:null)}}},unserialize:function(r){var t,a=this;return r&&a.name===r.filter&&(a._isOn=!!r._isOn,t=r.params,a.x=t.x,a.y=t.y,a.offsetX=t.offsetX,a.offsetY=t.offsetY,a.tolerance=t.tolerance,a.mode=t.mode,a.borderColor=t.borderColor,a.pattern=null,a._pattern=t._pattern,a._pattern&&(a._pattern.data=n(a._pattern.data,e.ImArray))),a},apply:function(e,n,r){var l=this,u=l.pattern;if(!l._isOn||!u&&!l._pattern)return e;var c,f,h,d,m,p,_,g,v,y,O,C,b,w,I,Y,M=l._pattern||{data:u.getData(),width:u.width,height:u.height},z=~~(255*(l.tolerance>=1?.999:l.tolerance)),X=l.mode,A=l.borderColor,x=A===+A,R=n<<2,H=M.data,F=M.width,L=M.height,k=l.x,E=l.y,N=l.offsetX||0,S=l.offsetY||0,U=e.length,q=U>>>2,D=0,P=U-R,T=0,G=n-1<<2,$=i.STRETCH;if(0>N&&(N+=F),0>S&&(S+=L),m=E,g=E*n<<2,k<<=2,T>k||k>G||D>g||g>P)return e;if(c=new s(3),x){if(c[0]=A>>>16&255,c[1]=A>>>8&255,c[2]=255&A,t(c[0]-e[k+g])<=z&&t(c[1]-e[k+g+1])<=z&&t(c[2]-e[k+g+2])<=z)return e}else c[0]=e[k+g],c[1]=e[k+g+1],c[2]=e[k+g+2];for(C=new Array(q),b=0,w=new o(a(q/32)),g+R>=D&&P>=g+R&&(C[b++]=[g,k,k,R,m+1]),C[b++]=[g+R,k,k,-R,m];b>0;){if(I=C[--b],g=I[0]+(R=I[3]),p=I[1],_=I[2],m=I[4],x)for(d=p;d>=T&&(h=d+g,!(w[h>>>7]&1<<(h>>>2&31)||t(c[0]-e[h])<=z&&t(c[1]-e[h+1])<=z&&t(c[2]-e[h+2])<=z));d-=4)w[h>>>7]|=1<<(h>>>2&31),$===X?(y=~~(F*(d>>>2)/n),O=~~(L*m/r)):(y=((d>>>2)+N)%F,O=(m+S)%L),v=y+O*F<<2,e[h]=H[v],e[h+1]=H[v+1],e[h+2]=H[v+2];else for(d=p;d>=T&&(h=d+g,!(w[h>>>7]&1<<(h>>>2&31))&&t(c[0]-e[h])<=z&&t(c[1]-e[h+1])<=z&&t(c[2]-e[h+2])<=z);d-=4)w[h>>>7]|=1<<(h>>>2&31),$===X?(y=~~(F*(d>>>2)/n),O=~~(L*m/r)):(y=((d>>>2)+N)%F,O=(m+S)%L),v=y+O*F<<2,e[h]=H[v],e[h+1]=H[v+1],e[h+2]=H[v+2];if(d>=p){if(h=d+g,x)for(;_>=d&&w[h>>>7]&1<<(h>>>2&31)||t(c[0]-e[h])<=z&&t(c[1]-e[h+1])<=z&&t(c[2]-e[h+2])<=z;)d+=4,h=d+g;else for(;_>=d&&!(!(w[h>>>7]&1<<(h>>>2&31))&&t(c[0]-e[h])<=z&&t(c[1]-e[h+1])<=z&&t(c[2]-e[h+2])<=z);)d+=4,h=d+g;f=d,Y=_>=d}else f=d+4,p>f&&g-R>=D&&P>=g-R&&(C[b++]=[g,f,p-4,-R,R>0?m-1:m+1]),d=p+4,Y=!0;for(;Y;){if(h=d+g,x)for(;G>=d&&!(w[h>>>7]&1<<(h>>>2&31))&&!(t(c[0]-e[h])<=z&&t(c[1]-e[h+1])<=z&&t(c[2]-e[h+2])<=z);)w[h>>>7]|=1<<(h>>>2&31),$===X?(y=~~(F*(d>>>2)/n),O=~~(L*m/r)):(y=((d>>>2)+N)%F,O=(m+S)%L),v=y+O*F<<2,e[h]=H[v],e[h+1]=H[v+1],e[h+2]=H[v+2],d+=4,h=d+g;else for(;G>=d&&!(w[h>>>7]&1<<(h>>>2&31))&&t(c[0]-e[h])<=z&&t(c[1]-e[h+1])<=z&&t(c[2]-e[h+2])<=z;)w[h>>>7]|=1<<(h>>>2&31),$===X?(y=~~(F*(d>>>2)/n),O=~~(L*m/r)):(y=((d>>>2)+N)%F,O=(m+S)%L),v=y+O*F<<2,e[h]=H[v],e[h+1]=H[v+1],e[h+2]=H[v+2],d+=4,h=d+g;if(g+R>=D&&P>=g+R&&(C[b++]=[g,f,d-4,R,R>0?m+1:m-1]),d>_+4&&g-R>=D&&P>=g-R&&(C[b++]=[g,_+4,d-4,-R,R>0?m-1:m+1]),h=d+g,x)for(;_>=d&&w[h>>>7]&1<<(h>>>2&31)||t(c[0]-e[h])<=z&&t(c[1]-e[h+1])<=z&&t(c[2]-e[h+2])<=z;)d+=4,h=d+g;else for(;_>=d&&!(!(w[h>>>7]&1<<(h>>>2&31))&&t(c[0]-e[h])<=z&&t(c[1]-e[h+1])<=z&&t(c[2]-e[h+2])<=z);)d+=4,h=d+g;f=d,Y=_>=d}}return e}})}(n),!function(e){var n=e._notSupportClamp,t=e.MODE,a=e.CHANNEL,i=e.Color.hue,s=e.Color.RGB2HSV;e.Util.Array.subarray;e.Create({name:"HSVConverterFilter",path:r,mode:t.HSV,init:function(e){var n=this;n.mode=e||t.HSV},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{mode:e.mode}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.mode=n.mode),r},apply:function(e,r,o){var l=this;if(!l._isOn)return e;var u,c,f,h,d,m=e.length,p=l.mode,_=a.H,g=a.S,v=a.V;if(n)if(t.HUE===p)for(u=0;m>u;u+=4)c=~~(.7083333333333334*i(e[u],e[u+1],e[u+2])),c=0>c?0:c>255?255:c,e[u]=c,e[u+1]=c,e[u+2]=c;else for(u=0;m>u;u+=4)c=s([e[u],e[u+1],e[u+2]],0),f=.7083333333333334*c[0],d=255*c[1],h=c[2],f=0>f?0:f>255?255:f,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[u+_]=~~f,e[u+g]=~~h,e[u+v]=~~d;else if(t.HUE===p)for(u=0;m>u;u+=4)c=~~(.7083333333333334*i(e[u],e[u+1],e[u+2])),e[u]=c,e[u+1]=c,e[u+2]=c;else for(u=0;m>u;u+=4)c=s([e[u],e[u+1],e[u+2]],0),f=.7083333333333334*c[0],d=255*c[1],h=c[2],e[u+_]=~~f,e[u+g]=~~h,e[u+v]=~~d;return e}})}(n),!function(e){var n=e.Util.Array.typed,t=e.MODE,a=e.Color.hue,i=e.Color.intensity;e.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,mode:t.COLOR,init:function(e,n,r){var a=this;a.thresholds=e,a.quantizedColors=n||null,a.mode=r||t.COLOR},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{thresholds:e.thresholds,quantizedColors:e.quantizedColors,mode:e.mode}}},unserialize:function(e){var r,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,r=e.params,t.thresholds=n(r.thresholds,Array),t.quantizedColors=n(r.quantizedColors,Array),t.mode=r.mode),t},apply:function(e,n,r){var s=this;if(!(s._isOn&&s.thresholds&&s.thresholds.length&&s.quantizedColors&&s.quantizedColors.length))return e;var o,l,u,c,f=e.length,h=s.mode||t.COLOR,d=s.thresholds,m=d.length,p=s.quantizedColors,_=p.length;if(t.HUE===h){for(u=0;f>u;u+=4)if(0!==e[u+3]){for(l=a(e[u],e[u+1],e[u+2]),c=0;m>c&&l>d[c];)c++;o=_>c?p[c]:16777215,e[u]=o>>>16&255,e[u+1]=o>>>8&255,e[u+2]=255&o}}else if(t.INTENSITY===h){for(u=0;f>u;u+=4)if(0!==e[u+3]){for(l=i(e[u],e[u+1],e[u+2]),c=0;m>c&&l>d[c];)c++;o=_>c?p[c]:16777215,e[u]=o>>>16&255,e[u+1]=o>>>8&255,e[u+2]=255&o}}else for(u=0;f>u;u+=4)if(0!==e[u+3]){for(l=e[u]<<16|e[u+1]<<8|255&e[u+2],c=0;m>c&&l>d[c];)c++;o=_>c?p[c]:16777215,e[u]=o>>>16&255,e[u+1]=o>>>8&255,e[u+2]=255&o}return e}})}(n),!function(e){var n=e.Color.hue;e.Create({name:"HueExtractorFilter",minHue:0,maxHue:360,background:0,init:function(e,n,r){var t=this;t.minHue=e,t.maxHue=n,t.background=r||0},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{minHue:e.minHue,maxHue:e.maxHue,background:e.background}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.minHue=n.minHue,r.maxHue=n.maxHue,r.background=n.background),r},apply:function(e,r,t){var a=this;if(!a._isOn)return e;var i,s,o,l,u,c,f=a.background||0,h=e.length,d=a.minHue,m=a.maxHue;for(i=f>>>16&255,s=f>>>8&255,o=255&f,l=f>>>24&255,u=0;h>u;u+=4)c=n(e[u],e[u+1],e[u+2]),(d>c||c>m)&&(e[u]=i,e[u+1]=s,e[u+2]=o,e[u+3]=l);return e}})}(n),!function(e){function n(e,n,r,t,a,i){var s,o,c,v,y,O=e.length,C=new u(O),b=new u(O),w=new u(O),I=new u(O),Y=new u(i),M=new u(i),z=a*a,X=2*z,A=p*z;
for(s=0;i>s&&(o=g(-(s*s)/X),!(f>=o&&s>=2));s++)c=g(-((y=s-.5)*y)/X),v=g(-((y=s+.5)*y)/X),Y[s]=(o+c+v)/3/A,M[s]=v-c;var y,x,R,H,F,L,k,E,N,S=s-1,U=n-(s-1),q=n*(s-1),D=n*(r-(s-1));for(y=S;U>y;y++)for(x=q;D>x;x+=n){for(R=y+x,H=e[R]*Y[0],F=H,L=1,k=n;s>L;)F+=Y[L]*(e[R-k]+e[R+k]),H+=Y[L]*(e[R-L]+e[R+L]),k+=n,L++;b[R]=F,C[R]=H}for(y=S;U>y;y++)for(x=q;D>x;x+=n){for(E=0,R=y+x,N=1;s>N;N++)E+=M[N]*(b[R-N]-b[R+N]);w[R]=E}for(y=s;n-s>y;y++)for(x=q;D>x;x+=n){for(E=0,R=y+x,k=n,N=1;s>N;N++)E+=M[N]*(C[R-k]-C[R+k]),k+=n;I[R]=E}S=s,U=n-s,q=n*s,D=n*(r-s);var P,T,G,$,j,W,B,V,J,K,Q,Z,ee,ne,re,te,ae,ie,se,oe;for(y=S;U>y;y++)for(x=q;D>x;x+=n)R=y+x,P=R-n,T=R+n,$=R-1,G=R+1,j=P-1,W=P+1,B=T-1,V=T+1,J=w[R],K=I[R],Q=l(J,K),ee=l(w[P],I[P]),ne=l(w[T],I[T]),te=l(w[$],I[$]),re=l(w[G],I[G]),ie=l(w[W],I[W]),oe=l(w[V],I[V]),se=l(w[B],I[B]),ae=l(w[j],I[j]),(0>=J*K?_(J)>=_(K)?(Z=_(J*Q))>=_(K*ie-(J+K)*re)&&Z>_(K*se-(J+K)*te):(Z=_(K*Q))>=_(J*ie-(K+J)*ee)&&Z>_(J*se-(K+J)*ne):_(J)>=Math.abs(K)?(Z=_(J*Q))>=_(K*oe+(J-K)*re)&&Z>_(K*ae+(J-K)*te):(Z=_(K*Q))>=_(J*oe+(K-J)*ne)&&Z>_(J*ae+(K-J)*ee))?t[R]=Q>=d?m:Math.floor(h*Q):t[R]=0}function t(e,n,r,t,i,s){var o,l,u,c=0,f=e.length;for(o=0;f>o;o++)e[o]=0;for(u=0,l=0,c=0;f>c;c++,u++)u>=n&&(u=0,l++),0===e[c]&&t[c]>=s&&a(e,n,r,t,u,l,c,i)}function a(e,n,r,t,i,s,o,l){var u,c,f,h=0==i?i:i-1,d=i==n-1?i:i+1,m=0==s?s:s-1,p=s==r-1?s:s+1;for(e[o]=t[o],u=h,c=m;d>=u&&p>=c;){if(f=u+c*n,(c!=s||u!=i)&&0===e[f]&&t[f]>=l)return void a(e,n,r,t,u,c,f,l);c++,c>p&&(c=m,u++)}}function i(n,r){var t,a,i,s,o,l=n.length,u=e.LUMA[0],c=e.LUMA[1],f=e.LUMA[2];for(t=0,a=0;l>t;t+=4,a++)i=n[t],s=n[t+1],o=n[t+2],r[a]=~~(u*i+c*s+f*o+.5)}function s(e){var n,r,t,a,i,s=new c(256),o=new c(256),l=e.length;for(n=0;l>n;n++)s[e[n]]++;for(r=0,t=0,n=0;256>n;n++){for(r+=s[n],i=255*r/l,a=t+1;i>=a;a++)o[a]=n;t=i}for(n=0;l>n;n++)e[n]=o[e[n]]}function o(e,n){var r,t,a,i=e.length;for(r=0,t=0;i>r;r+=4,t++)a=n[t]>0?255:0,e[r]=e[r+1]=e[r+2]=a}var l,u=e.Array32F,c=e.Array32I,f=.005,h=100,d=1e3,m=h*d,p=e.CONST.PI2,_=Math.abs,g=Math.exp;l=Math.hypot?Math.hypot:function(e,n){return _(e)+_(n)},e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,gaussRadius:2,gaussWidth:16,contrastNormalized:!1,path:r,init:function(e,n,r,t,a){var i=this;i.low=arguments.length<1?2.5:e,i.high=arguments.length<2?7.5:n,i.gaussRadius=arguments.length<3?2:r,i.gaussWidth=arguments.length<4?16:t,i.contrastNormalized=!!a},thresholds:function(e,n){var r=this;return r.low=e,r.high=n,r},kernel:function(e,n){var r=this;return r.gaussRadius=e,r.gaussWidth=n,r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{low:e.low,high:e.high,gaussRadius:e.gaussRadius,gaussWidth:e.gaussWidth,contrastNormalized:e.contrastNormalized}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.low=n.low,r.high=n.high,r.gaussRadius=n.gaussRadius,r.gaussWidth=n.gaussWidth,r.contrastNormalized=n.contrastNormalized),r},apply:function(e,r,a){var l,u,f,d,m=this,p=e.length>>2;return f=new c(p),d=new c(p),l=Math.round(m.low*h),u=Math.round(m.high*h),i(e,f),m.contrastNormalized&&s(f),n(f,r,a,d,m.gaussRadius,m.gaussWidth),t(f,r,a,d,l,u),o(e,f),e}})}(n),!function(e,n){function t(e,n,r,t,a,i,s){var o,l,u,c,f,h,d,m=e.length;for(c=0,u=0,o=l=0;n>c;c++,u+=4)d=4899*e[u]+9617*e[u+1]+1868*e[u+2]+8192>>>14&255,o+=d,l+=d*d,t[c]=d,a[c]=o,i[c]=l,s[c]=d;for(f=0,h=1,c=n,u=n<<2,o=l=0;m>u;u+=4,f++,c++)f>=n&&(f=0,h++,o=l=0),d=4899*e[u]+9617*e[u+1]+1868*e[u+2]+8192>>>14&255,o+=d,l+=d*d,t[c]=d,a[c]=a[c-n]+o,i[c]=i[c-n]+l,s[c]=s[c+1-n]+(d+t[c-n])+(h>1?s[c-n-n]:0)+(f>0?s[c-1-n]:0)}function a(e,n,r,t){var a,i,s,o,l,u,c,f,m,p,_,g=r.length,v=new h(g);for(a=0;e>a;a++)v[a]=0,v[a+e]=0,v[a+g-e]=0,v[a+g-e-e]=0,t[a]=0,t[a+g-e]=0;for(i=0,s=0;n>i;i++,s+=e)v[0+s]=0,v[1+s]=0,v[e-1+s]=0,v[e-2+s]=0,t[0+s]=0,t[e-1+s]=0;for(a=2;e-2>a;a++)for(i=2,s=e<<1;n-2>i;i++,s+=e)c=a+s,f=c+e,m=f+e,p=c-e,_=p-e,o=0+(r[_-2]<<1)+(r[p-2]<<2)+(r[c-2]<<2)+r[c-2]+(r[f-2]<<2)+(r[m-2]<<1)+(r[_-1]<<2)+(r[p-1]<<3)+r[p-1]+(r[c-1]<<4)-(r[c-1]<<2)+(r[f-1]<<3)+r[f-1]+(r[m-1]<<2)+(r[_]<<2)+r[_]+(r[p]<<4)-(r[p]<<2)+(r[c]<<4)-r[c]+(r[f]<<4)-(r[f]<<2)+(r[m]<<2)+r[m]+(r[_+1]<<2)+(r[p+1]<<3)+r[p+1]+(r[c+1]<<4)-(r[c+1]<<2)+(r[f+1]<<3)+r[f+1]+(r[m+1]<<2)+(r[_+2]<<1)+(r[p+2]<<2)+(r[c+2]<<2)+r[c+2]+(r[f+2]<<2)+(r[m+2]<<1),v[c]=((103*o+8192&4294967295)>>>14&255)>>>0;for(a=1;e-1>a;a++)for(i=1,s=e;n-1>i;i++,s+=e)c=s+a,f=c+e,p=c-e,l=0-v[p-1]+v[p+1]-v[c-1]-v[c-1]+v[c+1]+v[c+1]-v[f-1]+v[f+1],u=0+v[p-1]+v[p]+v[p]+v[p+1]-v[f-1]-v[f]-v[f]-v[f+1],t[c]=d(l)+d(u);for(a=0,o=0;e>a;a++)o+=t[a],t[a]=o;for(a=e,s=0,o=0;g>a;a++,s++)s>=e&&(s=0,o=0),o+=t[a],t[a]=t[a-e]+o}function i(e,n,r,t,a,i,s,o,l,u,c,f,h,d,m,g,v){var y,b,w,I,Y,M,z,X,A,x,R,H,F,L,k,E,N,S,U,q,D,P,T,G,$,j,W,B,V,J,K,Q,Z,ee,U,ne,re,te,ae,ie,se,oe,le,ue,ce,fe,he,de,me,pe,_e,ge,ve,ye=null!=m,Oe=i-t+1,Ce=s-a+1,be=Oe*Ce,we=be-1,Ie=o.stages,Ye=Ie.length,Me=o.size1,ze=o.size2,Xe=p(Oe/Me,Ce/ze),Ae=t,xe=a;for(q=0,D=Oe-1,P=0,T=be-Oe,y=l,y=l;Xe>=y;y*=u)for(I=~~(y*Me),b=~~(I*c),Y=~~(y*ze),w=~~(Y*c),x=Y*Oe,R=w*Oe,M=xe*R,E=Oe-I,N=Ce-Y,G=I*Y,$=1/G,X=xe,A=M;N>X;X+=w,A+=R)for(z=Ae;E>z;z+=b)if(H=z-1+A-Oe,F=H+I,L=H+x,k=L+I,H=0>H?0:H>we?we:H,F=0>F?0:F>we?we:F,L=0>L?0:L>we?we:L,k=0>k?0:k>we?we:k,!(ye&&(V=$*(m[k]-m[L]-m[F]+m[H]),g>V||V>v))){for(j=$*(f[k]-f[L]-f[F]+f[H]),W=$*(d[k]-d[L]-d[F]+d[H]),B=W-j*j,B=B>1?_(B):1,J=!1,S=0;Ye>S;S++){for(K=Ie[S],Q=K.thres,Z=K.trees,ee=Z.length,ve=0,U=0;ee>U;U++)for(re=Z[U].feats,ne=0;;){if(te=re[ne],ae=te.rects,ie=ae.length,se=te.thres,oe=0,te.tilt)for(le=0;ie>le;le++)ue=ae[le],ce=z+~~(y*ue[0]),fe=(X-1+~~(y*ue[1]))*Oe,he=z+~~(y*(ue[0]+ue[2])),de=(X-1+~~(y*(ue[1]+ue[2])))*Oe,me=z+~~(y*(ue[0]-ue[3])),pe=(X-1+~~(y*(ue[1]+ue[3])))*Oe,_e=z+~~(y*(ue[0]+ue[2]-ue[3])),ge=(X-1+~~(y*(ue[1]+ue[2]+ue[3])))*Oe,ce=q>ce?q:ce>D?D:ce,he=q>he?q:he>D?D:he,me=q>me?q:me>D?D:me,_e=q>_e?q:_e>D?D:_e,fe=P>fe?P:fe>T?T:fe,de=P>de?P:de>T?T:de,pe=P>pe?P:pe>T?T:pe,ge=P>ge?P:ge>T?T:ge,oe+=ue[4]*(h[_e+ge]-h[me+pe]-h[he+de]+h[ce+fe]);else for(le=0;ie>le;le++)ue=ae[le],ce=z-1+~~(y*ue[0]),he=z-1+~~(y*(ue[0]+ue[2])),fe=Oe*(X-1+~~(y*ue[1])),de=Oe*(X-1+~~(y*(ue[1]+ue[3]))),ce=q>ce?q:ce>D?D:ce,he=q>he?q:he>D?D:he,fe=P>fe?P:fe>T?T:fe,de=P>de?P:de>T?T:de,oe+=ue[4]*(f[he+de]-f[ce+de]-f[he+fe]+f[ce+fe]);if(se*B>oe*$){if(te.has_l){ve+=te.l_val;break}ne=te.l_node}else{if(te.has_r){ve+=te.r_val;break}ne=te.r_node}}if(J=ve>Q,!J)break}J&&(e.count===e.length&&C.apply(e,new Array(O)),e[e.count++]=[z,X,I,Y])}}function s(e,n,r){var t=m(n[2],e[2])*r,a=m(n[3],e[3])*r;return d(e[0]-n[0])<=t&&d(e[1]-n[1])<=a&&d(e[2]-n[2])<=t&&d(e[3]-n[3])<=a}function o(e,n){return e.x1>=n.x1&&e.y1>=n.y1&&e.x2<=n.x2&&e.y2<=n.y2}function l(e){e.x1=~~(e.x1+.5),e.y1=~~(e.y1+.5),e.x2=~~(e.x2+.5),e.y2=~~(e.y2+.5)}function u(e,n){return n.area-e.area}function c(e,n,r){var t,a,i,c,f,h,d,m,p,_,g,v=e.length,y=new Array(v),O=[],C=0,b=!1;for(i=0;v>i;i++)y[i]=0;for(i=0;v>i;i++){for(b=!1,c=0;i>c;c++)s(e[c],e[i],r)&&(b=!0,y[i]=y[c]);b||(y[i]=C,C++)}for(t=new Array(C),a=new Array(C),i=0;C>i;i++)t[i]=0,a[i]=[0,0,0,0];for(i=0;v>i;i++)d=y[i],t[d]++,a[d][0]+=e[i][0],a[d][1]+=e[i][1],a[d][2]+=e[i][2],a[d][3]+=e[i][3];for(i=0;C>i;i++)f=t[i],f>=n&&(h=1/(f+f),m=h*(2*a[i][0]+f),p=h*(2*a[i][1]+f),_=h*(2*a[i][2]+f),g=h*(2*a[i][3]+f),O.push({x1:m,y1:p,x2:m+_-1,y2:p+g-1,x:m,y:p,width:_,height:g,area:0,inside:0}));for(v=O.length,i=0;v>i;i++)for(c=i+1;v>c;c++)!O[i].inside&&o(O[i],O[c])?O[i].inside=1:!O[c].inside&&o(O[c],O[i])&&(O[c].inside=1);for(i=v;--i>=0;)O[i].inside?O.splice(i,1):(l(O[i]),O[i].area=O[i].width*O[i].height);return O.sort(u)}var f=e.Array32F,h=e.Array8U,d=Math.abs,m=Math.max,p=Math.min,_=(Math.floor,Math.round,Math.sqrt),g=e.Util.Array.typed,v=e.Util.Array.typed_obj,y="hasOwnProperty",O=10,C=Array.prototype.push;e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,selection:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,r,t,a,i,s,o){var l=this;l.objects=null,l.haardata=e||null,l.baseScale=n===r?1:r,l.scaleIncrement=n===t?1.25:t,l.stepIncrement=n===a?.5:a,l.minNeighbors=n===i?1:i,l.doCannyPruning=n===s?!0:!!s,l.tolerance=null==o?.2:+o,l._haarchanged=!!l.haardata},path:r,dispose:function(){var e=this;return e.selection=null,e.objects=null,e.haardata=null,e.$super("dispose"),e},haar:function(e){var n=this;return n.haardata=e,n._haarchanged=!0,n},select:function(e,n,r,t){var a=this;return!1===e?a.selection=null:a.selection=[p(1,m(0,e||0)),p(1,m(0,n||0)),p(1,m(0,r||0)),p(1,m(0,t||0))],a},params:function(e){var n=this;return e&&(e[y]("haardata")&&(n.haardata=e.haardata,n._haarchanged=!0),e[y]("baseScale")&&(n.baseScale=e.baseScale),e[y]("scaleIncrement")&&(n.scaleIncrement=e.scaleIncrement),e[y]("stepIncrement")&&(n.stepIncrement=e.stepIncrement),e[y]("minNeighbors")&&(n.minNeighbors=e.minNeighbors),e[y]("doCannyPruning")&&(n.doCannyPruning=e.doCannyPruning),e[y]("tolerance")&&(n.tolerance=e.tolerance),e[y]("cannyLow")&&(n.cannyLow=e.cannyLow),e[y]("cannyHigh")&&(n.cannyHigh=e.cannyHigh),e[y]("selection")&&(n.selection=e.selection||null)),n},serialize:function(){var e=this,n={filter:e.name,_isOn:!!e._isOn,params:{baseScale:e.baseScale,scaleIncrement:e.scaleIncrement,stepIncrement:e.stepIncrement,minNeighbors:e.minNeighbors,doCannyPruning:e.doCannyPruning,tolerance:e.tolerance,cannyLow:e.cannyLow,cannyHigh:e.cannyHigh,selection:e.selection}};return e._haarchanged&&(n.params.haardata=v(e.haardata),e._haarchanged=!1),n},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,n[y]("haardata")&&(r.haardata=v(n.haardata,1)),r.baseScale=n.baseScale,r.scaleIncrement=n.scaleIncrement,r.stepIncrement=n.stepIncrement,r.minNeighbors=n.minNeighbors,r.doCannyPruning=n.doCannyPruning,r.tolerance=n.tolerance,r.cannyLow=n.cannyLow,r.cannyHigh=n.cannyHigh,r.selection=g(n.selection,Array)),r},getMeta:function(){return e.isWorker?v(this.objects):this.objects},setMeta:function(e){return this.objects="string"==typeof e?v(e,1):e,this},apply:function(e,n,r){var s=this;if(!s._isOn||!s.haardata)return e;var o,l,u,d,_,g=e.length>>>2,v=s.selection||null,y=null,C=null,b=null,w=null,I=null;return v?(o=p(n-1,m(0,v[0]*(n-1))),l=p(r-1,m(0,v[1]*(r-1))),u=p(n-1,m(0,v[2]*(n-1))),d=p(r-1,m(0,v[3]*(r-1)))):(o=0,l=0,u=n-1,d=r-1),t(e,n,r,y=new h(g),C=new f(g),b=new f(g),w=new f(g)),s.doCannyPruning&&a(n,r,y,I=new f(g)),_=new Array(O),_.count=0,i(_,n,r,o,l,u,d,s.haardata,s.baseScale,s.scaleIncrement,s.stepIncrement,C,w,b,I,s.cannyLow,s.cannyHigh),_.length>_.count&&(_.length=_.count),s.objects=c(_,s.minNeighbors,s.tolerance),e}}),e.HaarDetectorFilter.detect=i,e.HaarDetectorFilter.merge=c}(n),!function(e,n){function t(e,n){for(;n[e][1]!==e;)n[e][1]=n[n[e][1]][1],e=n[e][1];return e}function a(e,n,r){var a=t(e,r),i=t(n,r);a!==i&&(r[a][1]=i)}function i(e,n,r){var t=r.next;return t+1>r.length&&Array.prototype.push.apply(r,new Array(O)),r[t]=[t,t,0],++r.next,t}function s(e,n,r,t){return e}function o(e,n,r,t,a){return 0===e[n+3]&&0===e[r+3]||y(e[n]-e[r])<=t&&y(e[n+1]-e[r+1])<=t&&y(e[n+2]-e[r+2])<=t}function l(e,n,r,t,a){return y(n[r]-e[0])<=t&&y(n[r+1]-e[1])<=t&&y(n[r+2]-e[2])<=t}function u(e,n,r,t,a){if(0===e[n+3]&&0===e[r+3])return!0;var i=n>>>2,s=r>>>2;return null==a[i]&&(a[i]=_(e[n],e[n+1],e[n+2])),null==a[s]&&(a[s]=_(e[r],e[r+1],e[r+2])),y(a[i],a[s])<=t}function c(e,n,r,t,a){var i=r>>>2;return null==a[i]&&(a[i]=_(n[r],n[r+1],n[r+2])),y(a[i],e)<=t}function f(e,n,r,t,a){if(0===e[n+3]&&0===e[r+3])return!0;var i=n>>>2,s=r>>>2;return null==a[i]&&(a[i]=p(e[n],e[n+1],e[n+2])),null==a[s]&&(a[s]=p(e[r],e[r+1],e[r+2])),y(a[i],a[s])<=t}function h(e,n,r,t,a){var i=r>>>2;return null==a[i]&&(a[i]=p(n[r],n[r+1],n[r+2])),y(a[i],e)<=t}var d=e.Array32U,m=e.MODE,p=e.Color.hue,_=e.Color.intensity,g=Math.min,v=Math.max,y=Math.abs,O=20;e.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:0,mode:m.COLOR,color:null,invert:!1,box:null,init:function(e,n,r,t,a){var i=this;i.connectivity=8===e?8:4,i.tolerance=n||0,i.mode=r||m.COLOR,i.color=null==t?null:t,i.invert=!!a},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{connectivity:e.connectivity,tolerance:e.tolerance,mode:e.mode,color:e.color,invert:e.invert}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.connectivity=n.connectivity,r.tolerance=n.tolerance,r.mode=n.mode,r.color=n.color,r.invert=n.invert),r},apply:function(e,n,r){var p=this;if(!p._isOn)return e;var _,y,C,b,w,I,Y,M,z,X,A,x,R=e.length,H=R>>>2,F=n<<2,L=p.mode||m.COLOR,k=p.invert,E=p.color,N=g(.999,v(0,p.tolerance||0)),S=8===p.connectivity?8:4,U=8===S,q=U?-1:0,D=q<<2,P=null,T=null,G=null,$=null,j=null!=E;for(z=new Array(O),z.next=0,X=new d(H),m.HUE===L?(N*=360,P=f,T=new Array(H),j&&(G=h)):m.INTENSITY===L?(N*=255,P=u,T=new Array(H),j&&(G=c)):(N*=255,P=o,j&&(E=[E>>>16&255,E>>>8&255,255&E],G=l)),$=j?i(0,0,z):null,X[0]=j&&!G(E,e,0,N,T)?$:i(0,0,z),w=1,_=4;n>w;w++,_+4)X[w]=j&&!G(E,e,_,N,T)?$:P(e,_,_-4,N,T)?s(X[w-1],w,0,z):i(w,0,z);for(I=1,M=n,_=F;r>I;I++,M+=n,_+=F)for(X[M]=j&&!G(E,e,_,N,T)?$:P(e,_,_-F,N,T)?s(X[M-n],0,I,z):i(0,I,z),w=1,y=4;n>w;w++,y+=4)if(!j||G(E,e,_+y,N,T)){for(b=$===X[M+w-1]?-1:P(e,_+y,_+y-4,N,T)?s(X[M+w-1],w,I,z):-1,Y=q,C=D;1>Y;Y++,C+=4)$!==X[M-n+w+Y]&&P(e,_+y,_-F+y+C,N,T)&&(b>=0?a(b,X[M-n+w+Y],z):b=s(X[M-n+w+Y],w+Y,I,z));X[M+w]=b>=0?s(b,w,I,z):i(w,I,z),U&&$!==X[M+w-1]&&$!==X[M-n+w]&&P(e,_+y-4,_-F+y,N,T)&&a(X[M+w-1],X[M-n+w],z)}else X[M+w]=$;if(0===$)for(_=0,A=z.next,x=0;A>_;_++)_===z[_][1]&&(z[_][2]=0===z[_][1]?0:++x);else for(_=0,A=z.next,x=0;A>_;_++)_===z[_][1]&&(z[_][2]=x++);if(x=x>0?x:1,k)for(w=0,_=0;R>_;_+=4,w++)E=z[t(X[w],z)][2],E=~~(255-255*E/x),e[_]=E,e[_+1]=E,e[_+2]=E;else for(w=0,_=0;R>_;_+=4,w++)E=z[t(X[w],z)][2],E=~~(255*E/x),e[_]=E,e[_+1]=E,e[_+2]=E;return e}})}(n),n});