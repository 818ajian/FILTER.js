/**
*
*   FILTER.js Plugins
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,r){"use strict";"object"==typeof module&&module.exports?module.exports=r.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(n,t){return r.moduleUri=n.uri,r.call(e,t),t}):(r.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(r){"use strict";var n=r.getPath(e.moduleUri);return!function(e){var r=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,r){var n=this;n.min=e||-127,n.max=r||127},path:n,serialize:function(){var e=this;return{min:e.min,max:e.max}},unserialize:function(e){var r=this;return r.min=e.min,r.max=e.max,r},apply:function(e,n,a){var i=this;if(!i._isOn)return e;var o,l,s,u,c,f,h,d,p=i.max-i.min,y=i.min,v=e.length;if(r)for(o=0;v>o;o+=4)s=e[o],u=e[o+1],c=e[o+2],l=p*t()+y,f=s+l,h=u+l,d=c+l,0>f?f=0:f>255&&(f=255),0>h?h=0:h>255&&(h=255),0>d?d=0:d>255&&(d=255),e[o]=0|f,e[o+1]=0|h,e[o+2]=0|d;else for(o=0;v>o;o+=4)s=e[o],u=e[o+1],c=e[o+2],l=p*t()+y,f=s+l,h=u+l,d=c+l,e[o]=0|f,e[o+1]=0|h,e[o+2]=0|d;return e}})}(r),!function(e){var r=e.Util.Image.perlin,t=e.MODE;e.Create({name:"PerlinNoiseFilter",mode:t.GRAY,_baseX:1,_baseY:1,_octaves:1,_offsets:null,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:n,init:function(e,r,n,a,i,o,l,s){var u=this;u.mode=t.GRAY,u._baseX=e||1,u._baseY=r||1,u._seed=l||0,u._stitch=!!a,u._fractal=!1!==i,u._perlin=!!s,u.octaves(n||1,o)},seed:function(e){var r=this;return r._seed=e||0,r},octaves:function(e,r){var n=this;for(n._octaves=e||1,n._offsets=r?r.slice(0):[];n._offsets.length<n._octaves;)n._offsets.push([0,0]);return n},seamless:function(e){return arguments.length||(e=!0),this._stitch=!!e,this},colors:function(e){return arguments.length||(e=!0),this.mode=e?t.COLOR:t.GRAY,this},turbulence:function(e){return arguments.length||(e=!0),this._fractal=!e,this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var e=this;return{_baseX:e._baseX,_baseY:e._baseY,_octaves:e._octaves,_offsets:e._offsets,_seed:e._seed||0,_stitch:e._stitch,_fractal:e._fractal,_perlin:e._perlin}},unserialize:function(e){var r=this;return r._baseX=e._baseX,r._baseY=e._baseY,r._octaves=e._octaves,r._offsets=e._offsets,r._seed=e._seed||0,r._stitch=e._stitch,r._fractal=e._fractal,r._perlin=e._perlin,r},apply:function(e,n,a){var i=this;return r?(i._seed&&(r.seed(i._seed),i._seed=0),r(e,n,a,i._stitch,t.COLOR!==i.mode,i._baseX,i._baseY,i._octaves,i._offsets,1,.5,i._perlin)):e}})}(r),!function(e,r){var t=e.Color.Gradient,a=e.MODE,i=e.Util.Array.typed,o=Math.floor;e.Create({name:"GradientFilter",colors:null,stops:null,angle:0,centerX:0,centerY:0,radiusX:1,radiusY:1,path:n,dispose:function(){var e=this;return e.colors=null,e.stops=null,e.angle=null,e.centerX=null,e.centerY=null,e.radiusX=null,e.radiusY=null,e.$super("dispose"),e},setColors:function(e,r){var n=this;if(e&&e.length){var a=t.stops(e,r);n.colors=a[0],n.stops=a[1]}return n},serialize:function(){var e=this;return{angle:e.angle,centerX:e.centerX,centerY:e.centerY,radiusX:e.radiusX,radiusY:e.radiusY,colors:e.colors,stops:e.stops}},unserialize:function(e){var r=this;return r.angle=e.angle||0,r.centerX=e.centerX||0,r.centerY=e.centerY||0,r.radiusX=e.radiusX||1,r.radiusY=e.radiusY||1,r.colors=i(e.colors,Array),r.stops=i(e.stops,Array),r},linear:function(e,r,n){var t=this;return t.mode=a.LINEAR,t.setColors(e,r),t.angle=n||0,t},radial:function(e,r,n,t,i,o){var l=this;return l.mode=a.RADIAL,l.setColors(e,r),l.centerX=n||0,l.centerY=t||0,l.radiusX=i||1,l.radiusY=o||1,l},apply:function(e,r,n){var i=this;return i.colors?a.RADIAL===i.mode?t.radial(e,r,n,i.colors,i.stops,o((i.centerX||0)*(r-1)),o((i.centerY||0)*(n-1)),i.radiusX,i.radiusY,t.interpolate):t.linear(e,r,n,i.colors,i.stops,i.angle,t.interpolate):e}})}(r),!function(e){var r=Math.min,t=Math.floor,a=e.CHANNEL,i=e.MODE;e.Create({name:"ChannelCopyFilter",srcChannel:a.R,dstChannel:a.R,centerX:0,centerY:0,color:0,hasInputs:!0,path:n,init:function(e,r,n,t,i){var o=this;o.srcChannel=e||a.R,o.dstChannel=r||a.R,o.centerX=n||0,o.centerY=t||0,o.color=i||0},dispose:function(){var e=this;return e.srcChannel=null,e.dstChannel=null,e.centerX=null,e.centerY=null,e.color=null,e.$super("dispose"),e},serialize:function(){var e=this;return{srcChannel:e.srcChannel,dstChannel:e.dstChannel,centerX:e.centerX,centerY:e.centerY,color:e.color}},unserialize:function(e){var r=this;return r.srcChannel=e.srcChannel,r.dstChannel=e.dstChannel,r.centerX=e.centerX,r.centerY=e.centerY,r.color=e.color,r},apply:function(e,n,a){var o,l=this;if(o=l.input("source"),!o)return e;var s,u,c,f,h,d,p,y,v,m,_=o[0],g=o[1],C=o[2],w=e.length,b=(_.length,l.srcChannel),Y=l.dstChannel,A=l.centerX||0,X=l.centerY||0,x=g>>>1,I=C>>>1,M=r(n,g),S=r(a,C),z=l.color||0,F=l.mode,R=i.COLOR32,L=i.COLOR8,O=i.COLORMASK32,E=i.COLORMASK8;for(R===F||O===F?(m=z>>>24&255,p=z>>>16&255,y=z>>>8&255,v=255&z):L!==F&&E!==F||(z&=255),A=t(A*(n-1))-x,X=t(X*(a-1))-I,u=0,c=0,s=0;w>s;s+=4,u++)u>=n&&(u=0,c++),h=u-A,d=c-X,0>h||h>=M||0>d||d>=S?R===F?(e[s]=p,e[s+1]=y,e[s+2]=v,e[s+3]=m):O===F?(e[s]=p&e[s],e[s+1]=y&e[s+1],e[s+2]=v&e[s+2],e[s+3]=m&e[s+3]):L===F?e[s+Y]=z:E===F&&(e[s+Y]=z&e[s+b]):(f=h+d*g<<2,e[s+Y]=_[f+b]);return e}})}(r),!function(e){var r=e._notSupportClamp,t=e.Array32F,a=e.MODE,i=Math.min,o=Math.max;e.Create({name:"HistogramEqualizeFilter",path:n,mode:a.INTENSITY,init:function(e){var r=this;r.mode=e||a.INTENSITY},_apply_rgb:function(e,n,a){var l,s,u,c,f,h,d,p,y,v,m,_,g,C,w,b,Y=0,A=0,X=0,x=255,I=255,M=255,S=e.length,z=S>>>2;for(d=new t(256),p=new t(256),y=new t(256),b=0;S>b;b+=4)l=e[b],s=e[b+1],u=e[b+2],d[l]++,p[s]++,y[u]++,Y=o(l,Y),A=o(s,A),X=o(u,X),x=i(l,x),I=i(s,I),M=i(u,M);for(v=m=_=0,b=0;256>b;b+=32)v+=d[b],d[b]=v,v+=d[b+1],d[b+1]=v,v+=d[b+2],d[b+2]=v,v+=d[b+3],d[b+3]=v,v+=d[b+4],d[b+4]=v,v+=d[b+5],d[b+5]=v,v+=d[b+6],d[b+6]=v,v+=d[b+7],d[b+7]=v,v+=d[b+8],d[b+8]=v,v+=d[b+9],d[b+9]=v,v+=d[b+10],d[b+10]=v,v+=d[b+11],d[b+11]=v,v+=d[b+12],d[b+12]=v,v+=d[b+13],d[b+13]=v,v+=d[b+14],d[b+14]=v,v+=d[b+15],d[b+15]=v,v+=d[b+16],d[b+16]=v,v+=d[b+17],d[b+17]=v,v+=d[b+18],d[b+18]=v,v+=d[b+19],d[b+19]=v,v+=d[b+20],d[b+20]=v,v+=d[b+21],d[b+21]=v,v+=d[b+22],d[b+22]=v,v+=d[b+23],d[b+23]=v,v+=d[b+24],d[b+24]=v,v+=d[b+25],d[b+25]=v,v+=d[b+26],d[b+26]=v,v+=d[b+27],d[b+27]=v,v+=d[b+28],d[b+28]=v,v+=d[b+29],d[b+29]=v,v+=d[b+30],d[b+30]=v,v+=d[b+31],d[b+31]=v,m+=p[b],p[b]=m,m+=p[b+1],p[b+1]=m,m+=p[b+2],p[b+2]=m,m+=p[b+3],p[b+3]=m,m+=p[b+4],p[b+4]=m,m+=p[b+5],p[b+5]=m,m+=p[b+6],p[b+6]=m,m+=p[b+7],p[b+7]=m,m+=p[b+8],p[b+8]=m,m+=p[b+9],p[b+9]=m,m+=p[b+10],p[b+10]=m,m+=p[b+11],p[b+11]=m,m+=p[b+12],p[b+12]=m,m+=p[b+13],p[b+13]=m,m+=p[b+14],p[b+14]=m,m+=p[b+15],p[b+15]=m,m+=p[b+16],p[b+16]=m,m+=p[b+17],p[b+17]=m,m+=p[b+18],p[b+18]=m,m+=p[b+19],p[b+19]=m,m+=p[b+20],p[b+20]=m,m+=p[b+21],p[b+21]=m,m+=p[b+22],p[b+22]=m,m+=p[b+23],p[b+23]=m,m+=p[b+24],p[b+24]=m,m+=p[b+25],p[b+25]=m,m+=p[b+26],p[b+26]=m,m+=p[b+27],p[b+27]=m,m+=p[b+28],p[b+28]=m,m+=p[b+29],p[b+29]=m,m+=p[b+30],p[b+30]=m,m+=p[b+31],p[b+31]=m,_+=y[b],y[b]=_,_+=y[b+1],y[b+1]=_,_+=y[b+2],y[b+2]=_,_+=y[b+3],y[b+3]=_,_+=y[b+4],y[b+4]=_,_+=y[b+5],y[b+5]=_,_+=y[b+6],y[b+6]=_,_+=y[b+7],y[b+7]=_,_+=y[b+8],y[b+8]=_,_+=y[b+9],y[b+9]=_,_+=y[b+10],y[b+10]=_,_+=y[b+11],y[b+11]=_,_+=y[b+12],y[b+12]=_,_+=y[b+13],y[b+13]=_,_+=y[b+14],y[b+14]=_,_+=y[b+15],y[b+15]=_,_+=y[b+16],y[b+16]=_,_+=y[b+17],y[b+17]=_,_+=y[b+18],y[b+18]=_,_+=y[b+19],y[b+19]=_,_+=y[b+20],y[b+20]=_,_+=y[b+21],y[b+21]=_,_+=y[b+22],y[b+22]=_,_+=y[b+23],y[b+23]=_,_+=y[b+24],y[b+24]=_,_+=y[b+25],y[b+25]=_,_+=y[b+26],y[b+26]=_,_+=y[b+27],y[b+27]=_,_+=y[b+28],y[b+28]=_,_+=y[b+29],y[b+29]=_,_+=y[b+30],y[b+30]=_,_+=y[b+31],y[b+31]=_;if(c=(Y-x)/z,f=(A-I)/z,h=(X-M)/z,r)for(b=0;S>b;b+=4)l=e[b],s=e[b+1],u=e[b+2],g=d[l]*c+x,C=p[s]*f+I,w=y[u]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~w;else for(b=0;S>b;b+=4)l=e[b],s=e[b+1],u=e[b+2],g=d[l]*c+x,C=p[s]*f+I,w=y[u]*h+M,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~w;return e},apply:function(e,n,l){var s=this;if(a.RGB===s.mode)return s._apply_rgb(e,n,l);var u,c,f,h,d,p,y,v,m,_,g=0,C=255,w=e.length,b=w>>>2,Y=a.GRAY===s.mode;if(v=new t(256),Y)for(_=0;w>_;_+=4)u=e[_],v[u]++,g=o(u,g),C=i(u,C);else for(_=0;w>_;_+=4)u=e[_],c=e[_+1],f=e[_+2],h=~~(0+.299*u+.587*c+.114*f),d=~~(128-.168736*u-.331264*c+.5*f),p=~~(128+.5*u-.418688*c-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_]=p,e[_+1]=h,e[_+2]=d,v[h]++,g=o(h,g),C=i(h,C);for(m=0,_=0;256>_;_+=32)m+=v[_],v[_]=m,m+=v[_+1],v[_+1]=m,m+=v[_+2],v[_+2]=m,m+=v[_+3],v[_+3]=m,m+=v[_+4],v[_+4]=m,m+=v[_+5],v[_+5]=m,m+=v[_+6],v[_+6]=m,m+=v[_+7],v[_+7]=m,m+=v[_+8],v[_+8]=m,m+=v[_+9],v[_+9]=m,m+=v[_+10],v[_+10]=m,m+=v[_+11],v[_+11]=m,m+=v[_+12],v[_+12]=m,m+=v[_+13],v[_+13]=m,m+=v[_+14],v[_+14]=m,m+=v[_+15],v[_+15]=m,m+=v[_+16],v[_+16]=m,m+=v[_+17],v[_+17]=m,m+=v[_+18],v[_+18]=m,m+=v[_+19],v[_+19]=m,m+=v[_+20],v[_+20]=m,m+=v[_+21],v[_+21]=m,m+=v[_+22],v[_+22]=m,m+=v[_+23],v[_+23]=m,m+=v[_+24],v[_+24]=m,m+=v[_+25],v[_+25]=m,m+=v[_+26],v[_+26]=m,m+=v[_+27],v[_+27]=m,m+=v[_+28],v[_+28]=m,m+=v[_+29],v[_+29]=m,m+=v[_+30],v[_+30]=m,m+=v[_+31],v[_+31]=m;if(y=(g-C)/b,r)if(Y)for(_=0;w>_;_+=4)u=~~(v[e[_]]*y+C),u=0>u?0:u>255?255:u,e[_]=u,e[_+1]=u,e[_+2]=u;else for(_=0;w>_;_+=4)h=v[e[_+1]]*y+C,d=e[_+2],p=e[_],u=~~(h+1.402*(p-128)),c=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[_]=u,e[_+1]=c,e[_+2]=f;else if(Y)for(_=0;w>_;_+=4)u=~~(v[e[_]]*y+C),e[_]=u,e[_+1]=u,e[_+2]=u;else for(_=0;w>_;_+=4)h=v[e[_+1]]*y+C,d=e[_+2],p=e[_],u=~~(h+1.402*(p-128)),c=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_]=u,e[_+1]=c,e[_+2]=f;return e}})}(r),!function(e){var r=e.ImArray,t=Math.sqrt,a=Math.min;Math.max,t(3);e.Create({name:"PixelateFilter",scale:1,init:function(e){var r=this;r.scale=e||1},path:n,serialize:function(){var e=this;return{scale:e.scale}},unserialize:function(e){var r=this;return r.scale=e.scale,r},apply:function(e,n,i){var o=this;if(!o._isOn||o.scale<=1)return e;o.scale>100&&(o.scale=100);var l,s,u,c,f,h,d,p,y,v,m,_,g,C,w,b,Y,A,X,x,I,M=e.length,S=M>>>2,z=n-1,F=S-n;for(l=new r(M),s=t(S)*o.scale*.01|0,u=s-1,c=n*u,g=C=w=b=Y=0,_=0;M>_;_+=4)A=g-w,X=C-Y,x=a(z,A+u),I=a(F,X+c),f=A+X<<2,h=A+I<<2,d=x+X<<2,p=x+I<<2,y=e[f]+e[h]+e[d]+e[p],v=e[f+1]+e[h+1]+e[d+1]+e[p+1],m=e[f+2]+e[h+2]+e[d+2]+e[p+2],l[_]=.25*y|0,l[_+1]=.25*v|0,l[_+2]=.25*m|0,l[_+3]=e[_+3],g++,w++,g>=n&&(w=0,g=0,b++,Y+=n,C+=n,b>=s&&(b=0,Y=0)),w>=s&&(w=0);return l}}),e.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var r=this;r.scale=e||1},path:n,serialize:function(){var e=this;return{scale:e.scale}},unserialize:function(e){var r=this;return r.scale=e.scale,r},apply:function(e,n,i){var o=this;if(!o._isOn||o.scale<=1)return e;o.scale>100&&(o.scale=100);var l,s,u,c,f,h,d,p,y,v,m,_,g,C,w,b,Y,A,X,x,I=e.length,M=I>>>2,S=n-1,z=M-n;for(l=new r(I),s=t(M)*o.scale*.01|0,u=s-1,c=n*u,_=g=C=w=b=0,m=0;I>m;m+=4)Y=_-C,A=g-b,X=a(S,Y+u),x=a(z,A+c),C+w>u?(f=X+A<<2,h=X+x<<2,d=Y+A<<2):(f=Y+A<<2,h=Y+x<<2,d=X+A<<2),p=e[f]+e[h]+e[d],y=e[f+1]+e[h+1]+e[d+1],v=e[f+2]+e[h+2]+e[d+2],l[m]=.333*p|0,l[m+1]=.333*y|0,l[m+2]=.333*v|0,l[m+3]=e[m+3],_++,C++,_>=n&&(C=0,_=0,w++,b+=n,g+=n,w>=s&&(w=0,b=0)),C>=s&&(C=0);return l}})}(r),!function(e,r){var t=7/16,a=3/16,i=5/16,o=1/16,l=e.MODE,s=e.Array32F,u=e.Color.clamp,c=e.Color.intensity;e.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:l.GRAY,init:function(e,r,n){var t=this;t.size=e||1,t.thresh=u(null==r?.4:r,0,1),t.mode=n||l.GRAY},path:n,threshold:function(e){return this.thresh=u(e,0,1),this},serialize:function(){var e=this;return{size:e.size,thresh:e.thresh}},unserialize:function(e){var r=this;return r.size=e.size,r.thresh=e.thresh,r},apply:function(e,r,n){var u,f,h,d,p,y,v,m,_,g,C,w,b,Y,A,X,x,I,M,S,z,F=this,R=e.length,L=R>>>2,O=new s(3*L),E=F.size,T=E*E,N=1/T,D=255*F.thresh,G=G<<1,P=l.RGB===F.mode,U=E*r,q=t,H=a,$=i,k=o;for(p=0,y=0,d=0;n>p;){if(g=C=w=0,P){for(v=0,m=0,_=0;E>m;)u=d+y+v+_<<2,f=3*(d+y+v+_),g+=e[u]+O[f],C+=e[u+1]+O[f+1],w+=e[u+2]+O[f+2],++v>=E&&(v=0,m++,_+=r);g*=N,C*=N,w*=N,h=c(g,C,w),h>D?(b=0|g,Y=0|C,A=0|w):(b=0,Y=0,A=0)}else{for(v=0,m=0,_=0;E>m;)u=d+y+v+_<<2,f=3*(d+y+v+_),g+=e[u]+O[f],++v>=E&&(v=0,m++,_+=r);h=g*N,h>D?(b=255,Y=255,A=255):(b=0,Y=0,A=0)}if(u=d+y<<2,X=e[u]-b,x=e[u+1]-Y,I=e[u+2]-A,r>d+E)for(M=q*X,S=q*x,z=q*I,v=E,m=0,_=0;E>m;)f=3*(d+y+v+_),O[f]+=M,O[f+1]+=S,O[f+2]+=z,++v>=G&&(v=E,m++,_+=r);if(n>p+E&&d>E)for(M=H*X,S=H*x,z=H*I,v=-E,m=E,_=0;G>m;)f=3*(d+y+v+_),O[f]+=M,O[f+1]+=S,O[f+2]+=z,++v>=0&&(v=-E,m++,_+=r);if(n>p+E)for(M=$*X,S=$*x,z=$*I,v=0,m=E,_=0;G>m;)f=3*(d+y+v+_),O[f]+=M,O[f+1]+=S,O[f+2]+=z,++v>=E&&(v=0,m++,_+=r);if(n>p+E&&r>d+E)for(M=k*X,S=k*x,z=k*I,v=E,m=E,_=0;G>m;)f=3*(d+y+v+_),O[f]+=M,O[f+1]+=S,O[f+2]+=z,++v>=G&&(v=E,m++,_+=r);for(v=0,m=0,_=0;E>m;)u=d+y+v+_<<2,e[u]=b,e[u+1]=Y,e[u+2]=A,++v>=E&&(v=0,m++,_+=r);d+=E,d>=r&&(d=0,p+=E,y+=U)}return e}})}(r),!function(e,r){var t=e.ImArray,a=e.Util.Filter.integral_convolution,i=e.MODE,o=new e.ConvolutionMatrix([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]);e.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:1,onlyShadow:!1,path:n,init:function(e,r,n,t,a,i){var o=this;o.offsetX=e||0,o.offsetY=r||0,o.color=n||0,o.opacity=null==t?1:+t,o.quality=0|(a||1),o.onlyShadow=!!i},dispose:function(){var e=this;return e.offsetX=null,e.offsetY=null,e.color=null,e.opacity=null,e.quality=null,e.onlyShadow=null,e.$super("dispose"),e},serialize:function(){var e=this;return{offsetX:e.offsetX,offsetY:e.offsetY,color:e.color,opacity:e.opacity,quality:e.quality,onlyShadow:e.onlyShadow}},unserialize:function(e){var r=this;return r.offsetX=e.offsetX,r.offsetY=e.offsetY,r.color=e.color,r.opacity=e.opacity,r.quality=e.quality,r.onlyShadow=e.onlyShadow,r},apply:function(e,r,n){var l=this;if(!l._isOn)return e;var s,u,c,f,h,d,p,y,v,m,_,g=l.color||0,C=l.opacity,w=l.quality,b=l.onlyShadow,Y=l.offsetX||0,A=l.offsetY||0,X=e.length,x=X>>>2;if(0>C&&(C=0),C>1&&(C=1),0===C)return e;for(s=g>>>16&255,u=g>>>8&255,c=255&g,0>=w&&(w=1),w>3&&(w=3),_=new t(X),f=0;X>f;f+=4)m=e[f+3],m>0&&(_[f]=s,_[f+1]=u,_[f+2]=c,_[f+3]=C*m|0);if(_=a(s===u&&u===c?i.GRAY:i.RGB,_,r,n,o,null,3,3,1,0,w),A*=r,b)for(h=0,d=0,v=0;X>v;v+=4,h++)h>=r&&(h=0,d+=r),p=h+Y,y=d+A,0>p||p>=r||0>y||y>=x||(f=p+y<<2,e[f]=_[v],e[f+1]=_[v+1],e[f+2]=_[v+2],e[f+3]=_[v+3]);else for(h=0,d=0,v=0;X>v;v+=4,h++)h>=r&&(h=0,d+=r),p=h+Y,y=d+A,0>p||p>=r||0>y||y>=x||(f=p+y<<2,m=e[f+3],C=_[v+3],255!==m&&0!==C&&(C/=255,s=e[f]+(_[v]-e[f])*C,u=e[f+1]+(_[v+1]-e[f+1])*C,c=e[f+2]+(_[v+2]-e[f+2])*C,e[f]=0|s,e[f+1]=0|u,e[f+2]=0|c));return e}})}(r),!function(e){var r=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=e._notSupportClamp,o=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,r,n,t){var a=this;a.centerX=e||0,a.centerY=r||0,a.radius=n||10,a.amount=t||10},path:n,serialize:function(){var e=this;return{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}},unserialize:function(e){var r=this;return r.centerX=e.centerX,r.centerY=e.centerY,r.radius=e.radius,r.amount=e.amount,r},apply:function(e,n,l){var s=this;if(!s._isOn)return e;var u,c,f,h,d,p,y,v,m,_,g,C,w,b,Y,A,X,x,I,M,S,z,F,R,L,O,E,T,N,D,G,P,U,q=e.length,H=s.centerX||0,$=s.centerY||0,k=s.radius,B=s.amount;if(0>=B)return e;for(u=q>>>2,D=0,G=n-1,P=0,U=u-n,H=a(H*(n-1)),$=a($*(l-1)),f=(u<<1)+u,y=(n<<1)+n,c=new o(f),v=0,m=0,_=0,h=d=p=0,_=0;n>_;_++,v+=4,m+=3)h+=e[v],d+=e[v+1],p+=e[v+2],c[m]=h,c[m+1]=d,c[m+2]=p;for(v=y+n,m=0,_=0,h=d=p=0,v=y+n;q>v;v+=4,m+=3,_++)_>=n&&(_=0,h=d=p=0),h+=e[v],d+=e[v+1],p+=e[v+2],c[m+y]=c[m]+h,c[m+y+1]=c[m+1]+d,c[m+y+2]=c[m+2]+p;for(_=0,g=0,C=0,v=0;q>v;v+=4,_++)_>=n&&(_=0,g++,C+=n),b=_-H,Y=g-$,w=t(b)+t(Y),A=w>k?0|r((w-k)*B):w/k+.5|0,A>0&&(X=A*n,x=.25/(A*A),I=_-A,M=C-X,S=_+A,z=C+X,D>I?I=D:S>G&&(S=G),P>M?M=P:z>U&&(z=U),F=I+M,O=S+z,R=S+M,L=I+z,F=(F<<1)+F,R=(R<<1)+R,L=(L<<1)+L,O=(O<<1)+O,E=x*(c[O]-c[R]-c[L]+c[F]),T=x*(c[O+1]-c[R+1]-c[L+1]+c[F+1]),N=x*(c[O+2]-c[R+2]-c[L+2]+c[F+2]),i&&(E=0>E?0:E>255?255:E,T=0>T?0:T>255?255:T,N=0>N?0:N>255?255:N),e[v]=0|E,e[v+1]=0|T,e[v+2]=0|N);return e}})}(r),!function(e){e.Create({name:"SeamlessTileFilter",type:2,init:function(e){var r=this;r.type=null==e?2:e||0},path:n,serialize:function(){var e=this;return{type:e.type}},unserialize:function(e){var r=this;return r.type=e.type,r},apply:function(r,n,t){var a,i,o,l,s,u,c,f,h,d,p,y,v,m,_,g=this,C=g.type,w=e.Interpolation.bilinear,b=e.ImArray,Y=e.Array8U,A=Math.sqrt;for(n!==t?r=w(r,n,t,y=n>t?n:t,y):y=n,v=Math.round(y/2),m=y*y,_=r.length,a=new b(_),i=new b(_),o=new Y(m),f=0,h=0,d=0;_>d;d+=4,f++)f>=y&&(f=0,h++),p=(f+v)%y+(h+v)%y*y<<2,a[p]=r[d],a[p+1]=r[d+1],a[p+2]=r[d+2],a[p+3]=r[d+3];if(0===C)for(f=0,h=0;v>f;h++)h>=v&&(h=0,f++),c=255-255*A((f-v)*(f-v)+(h-v)*(h-v))/v,c=1>c?1:c>255?255:c,o[f+h*y]=c,o[f+(y-1-h)*y]=c,o[y-1-f+h*y]=c,o[y-1-f+(y-1-h)*y]=c;else if(1===C)for(f=0,h=0;v>f;h++)h>=v&&(h=0,f++),c=255-255*(v+f>v+h?(h-v)/v:(f-y/2)/v),c=1>c?1:c>255?255:c,o[f+h*y]=c,o[f+(y-1-h)*y]=c,o[y-1-f+h*y]=c,o[y-1-f+(y-1-h)*y]=c;else for(f=0,h=0;v>f;h++)h>=v&&(h=0,f++),c=255-255*(v+f>v+h?A((h-y)*(h-y)+(f-y)*(f-y))/(1.13*y):A((f-y)*(f-y)+(h-y)*(h-y))/(1.13*y)),c=1>c?1:c>255?255:c,o[f+h*y]=c,o[f+(y-1-h)*y]=c,o[y-1-f+h*y]=c,o[y-1-f+(y-1-h)*y]=c;for(h=0,f=0;y>h;f++)f>=y&&(f=0,h++),p=f+h*y,l=o[p],s=o[(f+v)%y+(h+v)%y*y],u=l+s,l/=u,s/=u,p<<=2,i[p]=~~(l*r[p]+s*a[p]),i[p+1]=~~(l*r[p+1]+s*a[p+1]),i[p+2]=~~(l*r[p+2]+s*a[p+2]),i[p+3]=r[p+3];return n!==t&&(i=w(i,y,y,n,t)),i}})}(r),!function(e){var r=(e.Util.Array.typed,Math.abs),t=(Math.min,Math.max,Math.ceil),a=e.MODE,i=e.Array8U,o=e.Array32U;e.Create({name:"FloodFillFilter",x:0,y:0,color:null,borderColor:null,tolerance:0,path:n,init:function(e,r,n,t,a){var i=this;i.x=e||0,i.y=r||0,i.color=n||0,i.tolerance=t||0,i.borderColor=a===+a?+a:null},serialize:function(){var e=this;return{color:e.color,borderColor:e.borderColor,x:e.x,y:e.y,tolerance:e.tolerance}},unserialize:function(e){var r=this;return r.color=e.color,r.borderColor=e.borderColor,r.x=e.x,r.y=e.y,r.tolerance=e.tolerance,r},apply:function(e,n,t){var a,o,l,s,u,c,f,h,d,p,y,v,m=this,_=255*(m.tolerance>=1?.999:m.tolerance)|0,g=m.color||0,C=m.borderColor,w=C===+C,b=n<<2,Y=m.x,A=m.y,X=e.length,x=0,I=X-b,M=0,S=n-1<<2;if(h=A*n<<2,Y<<=2,M>Y||Y>S||x>h||h>I)return e;if(a=new i(3),o=new i(3),o[0]=g>>>16&255,o[1]=g>>>8&255,o[2]=255&g,w){if(a[0]=C>>>16&255,a[1]=C>>>8&255,a[2]=255&C,r(a[0]-e[Y+h])<=_&&r(a[1]-e[Y+h+1])<=_&&r(a[2]-e[Y+h+2])<=_)return e}else{if(e[Y+h]===o[0]&&e[Y+h+1]===o[1]&&e[Y+h+2]===o[2])return e;a[0]=e[Y+h],a[1]=e[Y+h+1],a[2]=e[Y+h+2]}for(d=new Array(X>>>2),p=0,h+b>=x&&I>=h+b&&(d[p++]=[h,Y,Y,b]),d[p++]=[h+b,Y,Y,-b];p>0;){if(y=d[--p],h=y[0]+(b=y[3]),c=y[1],f=y[2],w)for(u=c;u>=M&&(s=u+h,!(r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_));u-=4)e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2];else for(u=c;u>=M&&(s=u+h,r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_);u-=4)e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2];if(u>=c){if(s=u+h,w)for(;f>=u&&r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_;)u+=4,s=u+h;else for(;f>=u&&!(r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_);)u+=4,s=u+h;l=u,v=f>=u}else l=u+4,c>l&&h-b>=x&&I>=h-b&&(d[p++]=[h,l,c-4,-b]),u=c+4,v=!0;for(;v;){if(s=u+h,w)for(;S>=u&&!(r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_);)e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],u+=4,s=u+h;else for(;S>=u&&r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_;)e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],u+=4,s=u+h;if(h+b>=x&&I>=h+b&&(d[p++]=[h,l,u-4,b]),u>f+4&&h-b>=x&&I>=h-b&&(d[p++]=[h,f+4,u-4,-b]),s=u+h,w)for(;f>=u&&r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_;)u+=4,s=u+h;else for(;f>=u&&!(r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_);)u+=4,s=u+h;l=u,v=f>=u}}return e}}),e.ColorFillFilter=e.FloodFillFilter,e.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:0,mode:a.TILE,borderColor:null,hasInputs:!0,path:n,init:function(e,r,n,t,i,o,l,s){var u=this;u.x=e||0,u.y=r||0,u.offsetX=t||0,u.offsetY=i||0,n&&u.setInput("pattern",n),u.mode=o||a.TILE,u.tolerance=l||0,u.borderColor=s===+s?+s:null},dispose:function(){var e=this;return e.x=null,e.y=null,e.offsetX=null,e.offsetY=null,e.tolerance=null,e.borderColor=null,e.$super("dispose"),e},serialize:function(){var e=this;return{x:e.x,y:e.y,offsetX:e.offsetX,offsetY:e.offsetY,tolerance:e.tolerance,borderColor:e.borderColor}},unserialize:function(e){var r=this;return r.x=e.x,r.y=e.y,r.offsetX=e.offsetX,r.offsetY=e.offsetY,r.tolerance=e.tolerance,r.borderColor=e.borderColor,r},apply:function(e,n,l){var s,u=this;if(s=u.input("pattern"),!s)return e;var c,f,h,d,p,y,v,m,_,g,C,w,b,Y,A,X,x=255*(u.tolerance>=1?.999:u.tolerance)|0,I=u.mode,M=u.borderColor,S=M===+M,z=n<<2,F=s[0],R=s[1],L=s[2],O=u.x,E=u.y,T=u.offsetX||0,N=u.offsetY||0,D=e.length,G=D>>>2,P=0,U=D-z,q=0,H=n-1<<2,$=a.STRETCH;if(0>T&&(T+=R),0>N&&(N+=L),p=E,m=E*n<<2,O<<=2,q>O||O>H||P>m||m>U)return e;if(c=new i(3),S){if(c[0]=M>>>16&255,c[1]=M>>>8&255,c[2]=255&M,r(c[0]-e[O+m])<=x&&r(c[1]-e[O+m+1])<=x&&r(c[2]-e[O+m+2])<=x)return e}else c[0]=e[O+m],c[1]=e[O+m+1],c[2]=e[O+m+2];for(w=new Array(G),b=0,Y=new o(t(G/32)),m+z>=P&&U>=m+z&&(w[b++]=[m,O,O,z,p+1]),w[b++]=[m+z,O,O,-z,p];b>0;){if(A=w[--b],m=A[0]+(z=A[3]),y=A[1],v=A[2],p=A[4],S)for(d=y;d>=q&&(h=d+m,!(Y[h>>>7]&1<<(h>>>2&31)||r(c[0]-e[h])<=x&&r(c[1]-e[h+1])<=x&&r(c[2]-e[h+2])<=x));d-=4)Y[h>>>7]|=1<<(h>>>2&31),$===I?(g=R*(d>>>2)/n|0,C=L*p/l|0):(g=((d>>>2)+T)%R,C=(p+N)%L),_=g+C*R<<2,e[h]=F[_],e[h+1]=F[_+1],e[h+2]=F[_+2];else for(d=y;d>=q&&(h=d+m,!(Y[h>>>7]&1<<(h>>>2&31))&&r(c[0]-e[h])<=x&&r(c[1]-e[h+1])<=x&&r(c[2]-e[h+2])<=x);d-=4)Y[h>>>7]|=1<<(h>>>2&31),$===I?(g=R*(d>>>2)/n|0,C=L*p/l|0):(g=((d>>>2)+T)%R,C=(p+N)%L),_=g+C*R<<2,e[h]=F[_],e[h+1]=F[_+1],e[h+2]=F[_+2];if(d>=y){if(h=d+m,S)for(;v>=d&&Y[h>>>7]&1<<(h>>>2&31)||r(c[0]-e[h])<=x&&r(c[1]-e[h+1])<=x&&r(c[2]-e[h+2])<=x;)d+=4,h=d+m;else for(;v>=d&&!(!(Y[h>>>7]&1<<(h>>>2&31))&&r(c[0]-e[h])<=x&&r(c[1]-e[h+1])<=x&&r(c[2]-e[h+2])<=x);)d+=4,h=d+m;f=d,X=v>=d}else f=d+4,y>f&&m-z>=P&&U>=m-z&&(w[b++]=[m,f,y-4,-z,z>0?p-1:p+1]),d=y+4,X=!0;for(;X;){if(h=d+m,S)for(;H>=d&&!(Y[h>>>7]&1<<(h>>>2&31))&&!(r(c[0]-e[h])<=x&&r(c[1]-e[h+1])<=x&&r(c[2]-e[h+2])<=x);)Y[h>>>7]|=1<<(h>>>2&31),$===I?(g=R*(d>>>2)/n|0,C=L*p/l|0):(g=((d>>>2)+T)%R,C=(p+N)%L),_=g+C*R<<2,e[h]=F[_],e[h+1]=F[_+1],e[h+2]=F[_+2],d+=4,h=d+m;else for(;H>=d&&!(Y[h>>>7]&1<<(h>>>2&31))&&r(c[0]-e[h])<=x&&r(c[1]-e[h+1])<=x&&r(c[2]-e[h+2])<=x;)Y[h>>>7]|=1<<(h>>>2&31),$===I?(g=R*(d>>>2)/n|0,C=L*p/l|0):(g=((d>>>2)+T)%R,C=(p+N)%L),_=g+C*R<<2,e[h]=F[_],e[h+1]=F[_+1],e[h+2]=F[_+2],d+=4,h=d+m;if(m+z>=P&&U>=m+z&&(w[b++]=[m,f,d-4,z,z>0?p+1:p-1]),d>v+4&&m-z>=P&&U>=m-z&&(w[b++]=[m,v+4,d-4,-z,z>0?p-1:p+1]),h=d+m,S)for(;v>=d&&Y[h>>>7]&1<<(h>>>2&31)||r(c[0]-e[h])<=x&&r(c[1]-e[h+1])<=x&&r(c[2]-e[h+2])<=x;)d+=4,h=d+m;else for(;v>=d&&!(!(Y[h>>>7]&1<<(h>>>2&31))&&r(c[0]-e[h])<=x&&r(c[1]-e[h+1])<=x&&r(c[2]-e[h+2])<=x);)d+=4,h=d+m;f=d,X=v>=d}}return e}})}(r),!function(e){var r=e.Util.Filter.canny_gradient,t=.005,a=100,i=1e3,o=a*i,l=Math.round;e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,radius:2,width:14,path:n,init:function(e,r,n,t){var a=this;a.low=arguments.length<1?2.5:+e,a.high=arguments.length<2?7.5:+r,a.radius=arguments.length<3?2:+n,a.width=arguments.length<4?14:+t},thresholds:function(e,r,n,t){var a=this;return a.low=+e,a.high=+r,null!=n&&(a.radius=+n),null!=t&&(a.width=+t),a},serialize:function(){var e=this;return{low:e.low,high:e.high,radius:e.radius,width:e.width}},unserialize:function(e){var r=this;return r.low=e.low,r.high=e.high,r.radius=e.radius,r.width=e.width,r},apply:function(e,n,s){var u=this;return r(e,n,s,u.radius,u.width,l(u.low*a),l(u.high*a),t,a,i,o)}})}(r),!function(e,r){function t(e,r,n,t,a,i,o,l,s,u,c,f,p,y,_,g,C){var w,b,Y,A,X,x,I,M,S,z,F,R,L,O,E,T,N,D,G,P,U,q,H,$,k,B,j,K,W,J,Q,V,Z,ee,G,re,ne,te,ae,ie,oe,le,se,ue,ce,fe,he,de,pe,ye,ve,me,_e,ge=null!=_,Ce=i-t+1,we=o-a+1,be=Ce*we,Ye=be-1,Ae=l.stages,Xe=Ae.length,xe=l.size1,Ie=l.size2,Me=h(Ce/xe,we/Ie),Se=t,ze=a;for(P=0,U=Ce-1,q=0,H=be-Ce,w=s,w=s;Me>=w;w*=u)for(A=w*xe|0,b=A*c|0,X=w*Ie|0,Y=X*c|0,z=X*Ce,F=Y*Ce,x=ze*F,T=Ce-A,N=we-X,$=A*X,k=1/$,M=ze,S=x;N>M;M+=Y,S+=F)for(I=Se;T>I;I+=b)if(R=I-1+S-Ce,L=R+A,O=R+z,E=O+A,R=0>R?0:R>Ye?Ye:R,L=0>L?0:L>Ye?Ye:L,O=0>O?0:O>Ye?Ye:O,E=0>E?0:E>Ye?Ye:E,!(ge&&(W=k*(_[E]-_[O]-_[L]+_[R]),g>W||W>C))){for(B=k*(f[E]-f[O]-f[L]+f[R]),j=k*(y[E]-y[O]-y[L]+y[R]),K=j-B*B,K=K>1?d(K):1,J=!1,D=0;Xe>D;D++){for(Q=Ae[D],V=Q.thres,Z=Q.trees,ee=Z.length,_e=0,G=0;ee>G;G++)for(ne=Z[G].feats,re=0;;){if(te=ne[re],ae=te.rects,ie=ae.length,oe=te.thres,le=0,te.tilt)for(se=0;ie>se;se++)ue=ae[se],ce=I+w*ue[0]|0,fe=(M-1+w*ue[1]|0)*Ce,he=I+w*(ue[0]+ue[2])|0,de=(M-1+w*(ue[1]+ue[2])|0)*Ce,pe=I+w*(ue[0]-ue[3])|0,ye=(M-1+w*(ue[1]+ue[3])|0)*Ce,ve=I+w*(ue[0]+ue[2]-ue[3])|0,me=(M-1+w*(ue[1]+ue[2]+ue[3])|0)*Ce,ce=P>ce?P:ce>U?U:ce,he=P>he?P:he>U?U:he,pe=P>pe?P:pe>U?U:pe,ve=P>ve?P:ve>U?U:ve,fe=q>fe?q:fe>H?H:fe,de=q>de?q:de>H?H:de,ye=q>ye?q:ye>H?H:ye,me=q>me?q:me>H?H:me,le+=ue[4]*(p[ve+me]-p[pe+ye]-p[he+de]+p[ce+fe]);else for(se=0;ie>se;se++)ue=ae[se],ce=I-1+w*ue[0]|0,he=I-1+w*(ue[0]+ue[2])|0,fe=Ce*(M-1+w*ue[1]|0),de=Ce*(M-1+w*(ue[1]+ue[3])|0),ce=P>ce?P:ce>U?U:ce,he=P>he?P:he>U?U:he,fe=q>fe?q:fe>H?H:fe,de=q>de?q:de>H?H:de,le+=ue[4]*(f[he+de]-f[ce+de]-f[he+fe]+f[ce+fe]);if(oe*K>le*k){if(te.has_l){_e+=te.l_val;break}re=te.l_node}else{if(te.has_r){_e+=te.r_val;break}re=te.r_node}}if(J=_e>V,!J)break}J&&(e.count===e.length&&m.apply(e,new Array(v)),e[e.count++]=[I,M,A,X])}}function a(e,r,n){var t=f(r[2],e[2])*n,a=f(r[3],e[3])*n;return c(e[0]-r[0])<=t&&c(e[1]-r[1])<=a&&c(e[2]-r[2])<=t&&c(e[3]-r[3])<=a}function i(e,r){return e.x1>=r.x1&&e.y1>=r.y1&&e.x2<=r.x2&&e.y2<=r.y2}function o(e){e.x1=e.x1+.5|0,e.y1=e.y1+.5|0,e.x2=e.x2+.5|0,e.y2=e.y2+.5|0}function l(e,r){return r.area-e.area}function s(e,r,n){var t,s,u,c,f,h,d,p,y,v,m,_=e.length,g=new Array(_),C=[],w=0,b=!1;for(u=0;_>u;u++)g[u]=0;for(u=0;_>u;u++){for(b=!1,c=0;u>c;c++)a(e[c],e[u],n)&&(b=!0,g[u]=g[c]);b||(g[u]=w,w++)}for(t=new Array(w),s=new Array(w),u=0;w>u;u++)t[u]=0,s[u]=[0,0,0,0];for(u=0;_>u;u++)d=g[u],t[d]++,s[d][0]+=e[u][0],s[d][1]+=e[u][1],s[d][2]+=e[u][2],s[d][3]+=e[u][3];for(u=0;w>u;u++)f=t[u],f>=r&&(h=1/(f+f),p=h*(2*s[u][0]+f),y=h*(2*s[u][1]+f),v=h*(2*s[u][2]+f),m=h*(2*s[u][3]+f),C.push({x1:p,y1:y,x2:p+v-1,y2:y+m-1,x:p,y:y,width:v,height:m,area:0,inside:0}));for(_=C.length,u=0;_>u;u++)for(c=u+1;_>c;c++)!C[u].inside&&i(C[u],C[c])?C[u].inside=1:!C[c].inside&&i(C[c],C[u])&&(C[c].inside=1);for(u=_;--u>=0;)C[u].inside?C.splice(u,1):(o(C[u]),C[u].area=C[u].width*C[u].height);return C.sort(l)}var u=e.Array32F,c=(e.Array8U,Math.abs),f=Math.max,h=Math.min,d=(Math.floor,Math.round,Math.sqrt),p=(e.Util.Array.typed,e.Util.Array.typed_obj),y="hasOwnProperty",v=10,m=Array.prototype.push,_=e.Util.Filter,g=_.SAT,C=_.GRAD;_.haar_detect=t,_.merge_features=s,e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,n,t,a,i,o,l){var s=this;s.haardata=e||null,s.baseScale=r===n?1:n,s.scaleIncrement=r===t?1.25:t,s.stepIncrement=r===a?.5:a,s.minNeighbors=r===i?1:i,s.doCannyPruning=r===o?!0:!!o,s.tolerance=null==l?.2:+l,s._haarchanged=!!s.haardata},path:n,dispose:function(){var e=this;return e.haardata=null,e.$super("dispose"),e},haar:function(e){var r=this;return r.haardata=e,r._haarchanged=!0,r},params:function(e){var r=this;return e&&(e[y]("haardata")&&(r.haardata=e.haardata,r._haarchanged=!0),e[y]("baseScale")&&(r.baseScale=e.baseScale),e[y]("scaleIncrement")&&(r.scaleIncrement=e.scaleIncrement),e[y]("stepIncrement")&&(r.stepIncrement=e.stepIncrement),e[y]("minNeighbors")&&(r.minNeighbors=e.minNeighbors),e[y]("doCannyPruning")&&(r.doCannyPruning=e.doCannyPruning),e[y]("tolerance")&&(r.tolerance=e.tolerance),e[y]("cannyLow")&&(r.cannyLow=e.cannyLow),e[y]("cannyHigh")&&(r.cannyHigh=e.cannyHigh),e[y]("selection")&&(r.selection=e.selection||null)),r},serialize:function(){var e,r=this;return e={baseScale:r.baseScale,scaleIncrement:r.scaleIncrement,stepIncrement:r.stepIncrement,minNeighbors:r.minNeighbors,doCannyPruning:r.doCannyPruning,tolerance:r.tolerance,cannyLow:r.cannyLow,cannyHigh:r.cannyHigh},r._haarchanged&&(e.haardata=p(r.haardata),r._haarchanged=!1),e},unserialize:function(e){var r=this;return e[y]("haardata")&&(r.haardata=p(e.haardata,1)),r.baseScale=e.baseScale,r.scaleIncrement=e.scaleIncrement,r.stepIncrement=e.stepIncrement,r.minNeighbors=e.minNeighbors,r.doCannyPruning=e.doCannyPruning,r.tolerance=e.tolerance,r.cannyLow=e.cannyLow,r.cannyHigh=e.cannyHigh,r},metaData:function(r){return r&&e.isWorker?p(this.meta):this.meta},setMetaData:function(e,r){return this.meta=r&&"string"==typeof e?p(e,1):e,this},apply:function(e,r,n,t){var a=this;if(!a.haardata)return e;var i,o,l,s,c,d=e.length>>>2,p=a.selection||null,y=null,m=null,w=null,b=null,Y=_.haar_detect,A=_.merge_features;return p?(i=h(r-1,f(0,p[0]*(r-1))),o=h(n-1,f(0,p[1]*(n-1))),l=h(r-1,f(0,p[2]*(r-1))),s=h(n-1,f(0,p[3]*(n-1)))):(i=0,o=0,l=r-1,s=n-1),t&&t.haarfilter_SAT?(y=t.haarfilter_SAT,m=t.haarfilter_SAT2,w=t.haarfilter_RSAT):(g(e,r,n,y=new u(d),m=new u(d),w=new u(d)),t&&(t.haarfilter_SAT=y,t.haarfilter_SAT2=m,t.haarfilter_RSAT=w)),a.doCannyPruning&&(t&&t.haarfilter_EDGES?b=t.haarfilter_EDGES:(C(e,r,n,b=new u(d),null,1),t&&(t.haarfilter_EDGES=b))),c=new Array(v),c.count=0,Y(c,r,n,i,o,l,s,a.haardata,a.baseScale,a.scaleIncrement,a.stepIncrement,y,w,m,b,a.cannyLow,a.cannyHigh),c.length>c.count&&(c.length=c.count),a.meta={objects:A(c,a.minNeighbors,a.tolerance)},e}})}(r),!function(e,r){function t(e,r){for(;r[e][1]!==e;)r[e][1]=r[r[e][1]][1],e=r[e][1];return e}function a(e,r,n){var a=t(e,n),i=t(r,n);a!==i&&(n[a][1]=i)}function i(e,r,n){var t=n.next;return t+1>n.length&&Array.prototype.push.apply(n,new Array(C)),n[t]=[t,t,0],++n.next,t}function o(e,r,n,t){return e}function l(e,r,n,t,a){return 0===e[r+3]&&0===e[n+3]||g(e[r]-e[n])<=t&&g(e[r+1]-e[n+1])<=t&&g(e[r+2]-e[n+2])<=t}function s(e,r,n,t,a){return g(r[n]-e[0])<=t&&g(r[n+1]-e[1])<=t&&g(r[n+2]-e[2])<=t}function u(e,r,n,t,a){if(0===e[r+3]&&0===e[n+3])return!0;var i=r>>>2,o=n>>>2;return null==a[i]&&(a[i]=v(e[r],e[r+1],e[r+2])),null==a[o]&&(a[o]=v(e[n],e[n+1],e[n+2])),g(a[i],a[o])<=t}function c(e,r,n,t,a){var i=n>>>2;return null==a[i]&&(a[i]=v(r[n],r[n+1],r[n+2])),g(a[i],e)<=t}function f(e,r,n,t,a){if(0===e[r+3]&&0===e[n+3])return!0;var i=r>>>2,o=n>>>2;return null==a[i]&&(a[i]=y(e[r],e[r+1],e[r+2])),null==a[o]&&(a[o]=y(e[n],e[n+1],e[n+2])),g(a[i],a[o])<=t}function h(e,r,n,t,a){var i=n>>>2;return null==a[i]&&(a[i]=y(r[n],r[n+1],r[n+2])),g(a[i],e)<=t}var d=e.Array32U,p=e.MODE,y=e.Color.hue,v=e.Color.intensity,m=Math.min,_=Math.max,g=Math.abs,C=20;e.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:0,mode:p.COLOR,color:null,invert:!1,box:null,init:function(e,r,n,t,a){var i=this;i.connectivity=8===e?8:4,i.tolerance=r||0,i.mode=n||p.COLOR,i.color=null==t?null:t,i.invert=!!a},path:n,serialize:function(){var e=this;return{connectivity:e.connectivity,tolerance:e.tolerance,color:e.color,invert:e.invert}},unserialize:function(e){var r=this;return r.connectivity=e.connectivity,r.tolerance=e.tolerance,r.color=e.color,r.invert=e.invert,r},apply:function(e,r,n){var y=this;if(!y._isOn)return e;var v,g,w,b,Y,A,X,x,I,M,S,z,F=e.length,R=F>>>2,L=r<<2,O=y.mode||p.COLOR,E=y.invert,T=y.color,N=m(.999,_(0,y.tolerance||0)),D=8===y.connectivity?8:4,G=8===D,P=G?-1:0,U=P<<2,q=null,H=null,$=null,k=null,B=null!=T;for(I=new Array(C),I.next=0,M=new d(R),p.HUE===O?(N*=360,q=f,H=new Array(R),B&&($=h)):p.INTENSITY===O?(N*=255,q=u,H=new Array(R),B&&($=c)):(N*=255,q=l,B&&(T=[T>>>16&255,T>>>8&255,255&T],$=s)),k=B?i(0,0,I):null,M[0]=B&&!$(T,e,0,N,H)?k:i(0,0,I),Y=1,v=4;r>Y;Y++,v+4)M[Y]=B&&!$(T,e,v,N,H)?k:q(e,v,v-4,N,H)?o(M[Y-1],Y,0,I):i(Y,0,I);for(A=1,
x=r,v=L;n>A;A++,x+=r,v+=L)for(M[x]=B&&!$(T,e,v,N,H)?k:q(e,v,v-L,N,H)?o(M[x-r],0,A,I):i(0,A,I),Y=1,g=4;r>Y;Y++,g+=4)if(!B||$(T,e,v+g,N,H)){for(b=k===M[x+Y-1]?-1:q(e,v+g,v+g-4,N,H)?o(M[x+Y-1],Y,A,I):-1,X=P,w=U;1>X;X++,w+=4)k!==M[x-r+Y+X]&&q(e,v+g,v-L+g+w,N,H)&&(b>=0?a(b,M[x-r+Y+X],I):b=o(M[x-r+Y+X],Y+X,A,I));M[x+Y]=b>=0?o(b,Y,A,I):i(Y,A,I),G&&k!==M[x+Y-1]&&k!==M[x-r+Y]&&q(e,v+g-4,v-L+g,N,H)&&a(M[x+Y-1],M[x-r+Y],I)}else M[x+Y]=k;if(0===k)for(v=0,S=I.next,z=0;S>v;v++)v===I[v][1]&&(I[v][2]=0===I[v][1]?0:++z);else for(v=0,S=I.next,z=0;S>v;v++)v===I[v][1]&&(I[v][2]=z++);if(z=z>0?z:1,E)for(Y=0,v=0;F>v;v+=4,Y++)T=I[t(M[Y],I)][2],T=255-255*T/z|0,e[v]=T,e[v+1]=T,e[v+2]=T;else for(Y=0,v=0;F>v;v+=4,Y++)T=I[t(M[Y],I)][2],T=255*T/z|0,e[v]=T,e[v+1]=T,e[v+2]=T;return e}})}(r),r});