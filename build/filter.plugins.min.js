/**
*
*   FILTER.js Plugins
*   @version: 0.6.9
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e,r,n,a){var i="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),l=!i&&"undefined"!=typeof navigator,s="function"==typeof importScripts&&navigator instanceof WorkerNavigator,o=Array,u=o.prototype,h=function(){var t=null;if(i)return t=__filename,{path:__dirname,file:__filename};if(s)t=self.location.href;else if(l){var e;(e=document.getElementsByTagName("script"))&&e.length&&(t=e[e.length-1].src)}return t?{path:t.split("/").slice(0,-1).join("/"),file:t}:{path:null,file:null}},c=h(),f=function(t,e){if(i)return e;if("."==e.charAt(0)){t=t.split("/"),e=e.split("/");var r,n=0,a=0,l=e.length,s=t.length;for(r=0;l>r;r++)if(/^\.\./.test(e[r]))n++,a++;else{if(!/^\./.test(e[r]))break;a++}n=n>=s?0:s-n,e=t.slice(0,n).concat(e.slice(a)).join("/")}return e};r=r?[].concat(r):[];var m,d,p,g=r.length,v=new o(g),C=new o(g),_=new o(g),b=new o(g);for(m=0;g>m;m++)v[m]=r[m][0],C[m]=r[m][1],_[m]=/\.js$/i.test(C[m])?f(c.path,C[m]):f(c.path,C[m]+".js");if("object"==typeof module&&module.exports){if(a===module.exports[e]){for(m=0;g>m;m++)b[m]=module.exports[v[m]]||require(_[m])[v[m]];d=n.apply(t,b),module.exports[e]=d||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(C),function(r){if(a===r[e]){for(var i=u.slice.call(arguments,1),l=i.length,s=0;l>s;s++)b[s]=r[v[s]]||i[s];d=n.apply(t,b),r[e]=d||1}});else if(s){for(m=0;g>m;m++)self[v[m]]||importScripts(_[m]),b[m]=self[v[m]];d=n.apply(t,b),self[e]=d||1}else if(a===t[e]){var y=function(t,e){p=p||document.getElementsByTagName("head")[0];var r=0,n=document.createElement("script");n.type="text/javascript",n.language="javascript",n.onload=n.onreadystatechange=function(){r||n.readyState&&"loaded"!=n.readyState&&"complete"!=n.readyState||(r=1,n.onload=n.onreadystatechange=null,p.removeChild(n),n=null,e&&e())},n.src=t,p.appendChild(n)},M=function(e,r,n){t[e]?n():y(r,n)},F=function(r){return function(){g>r&&(b[r]=t[v[r]]),++r<g?M(v[r],_[r],F(r)):(d=n.apply(t,b),t[e]=d||1)}};g?M(v[0],_[0],F(0)):(d=n.apply(t,b),t[e]=d||1)}}(this,"FILTER_PLUGINS",[["FILTER","./filter"]],function(t){var e=null;return!function(t){"use strict";var e=t._notSupportClamp,r=Math.random;t.NoiseFilter=t.Create({name:"NoiseFilter",min:-127,max:127,init:function(t,e){this.min=t||-127,this.max=e||127},serialize:function(){var t=this;return{filter:t.name,params:{min:t.min,max:t.max}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r.min=e.min,r.max=e.max),r},apply:function(t){var n,a,i,l,s,o,u,h,c=this.max-this.min,f=this.min,m=t.length;if(e)for(n=0;m>n;n+=4)i=t[n],l=t[n+1],s=t[n+2],a=c*r()+f,o=i+a,u=l+a,h=s+a,0>o?o=0:o>255&&(o=255),0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),t[n]=~~o,t[n+1]=~~u,t[n+2]=~~h;else for(n=0;m>n;n+=4)i=t[n],l=t[n+1],s=t[n+2],a=c*r()+f,o=i+a,u=l+a,h=s+a,t[n]=~~o,t[n+1]=~~u,t[n+2]=~~h;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F,n=t.Color.RGB2YCbCr,a=t.Color.YCbCr2RGB;t.HistogramEqualizeFilter=t.Create({name:"HistogramEqualizeFilter",apply:function(t){var i,l,s,o,u,h,c,f,m,d,p,g=0,v=255,C=0,_=t.length,b=_>>2,y=1/b;for(u=new r(256),m=0;256>m;m+=4)u[m]=0,u[m+1]=0,u[m+2]=0,u[m+3]=0;for(m=0;_>m;m+=4)i=t[m],l=t[m+1],s=t[m+2],d=n({r:i,g:l,b:s}),i=t[m]=~~d.cr,l=t[m+1]=~~d.y,s=t[m+2]=~~d.cb,u[l]+=y,l>g?g=l:v>l&&(v=l);for(C=0,m=0;256>m;m+=4)C+=u[m],u[m]=C,C+=u[m+1],u[m+1]=C,C+=u[m+2],u[m+2]=C,C+=u[m+3],u[m+3]=C;if(o=g-v,e)for(m=0;_>m;m+=4)d={cr:t[m],y:t[m+1],cb:t[m+2]},d.y=u[d.y]*o+v,p=a(d),h=p.r,c=p.g,f=p.b,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,t[m]=~~h,t[m+1]=~~c,t[m+2]=~~f;else for(m=0;_>m;m+=4)d={cr:t[m],y:t[m+1],cb:t[m+2]},d.y=u[d.y]*o+v,p=a(d),t[m]=~~p.r,t[m+1]=~~p.g,t[m+2]=~~p.b;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F;t.GrayscaleHistogramEqualizeFilter=t.Create({name:"GrayscaleHistogramEqualizeFilter",apply:function(t){var n,a,i,l,s,o=0,u=255,h=0,c=t.length,f=c>>2,m=1/f;for(l=new r(256),s=0;256>s;s+=4)l[s]=0,l[s+1]=0,l[s+2]=0,l[s+3]=0;for(s=0;c>s;s+=4)n=t[s],l[n]+=m,n>o?o=n:u>n&&(u=n);for(h=0,s=0;256>s;s+=4)h+=l[s],l[s]=h,h+=l[s+1],l[s+1]=h,h+=l[s+2],l[s+2]=h,h+=l[s+3],l[s+3]=h;if(i=o-u,e)for(s=0;c>s;s+=4)n=t[s],a=l[n]*i+u,a=0>a?0:a>255?255:a,a=~~a,t[s]=a,t[s+1]=a,t[s+2]=a;else for(s=0;c>s;s+=4)n=t[s],a=~~(l[n]*i+u),t[s]=a,t[s+1]=a,t[s+2]=a;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F;t.RGBHistogramEqualizeFilter=t.Create({name:"RGBHistogramEqualizeFilter",apply:function(t){var n,a,i,l,s,o,u,h,c,f,m,d,p,g,v,C,_=0,b=0,y=0,M=255,F=255,z=255,Y=t.length,k=Y>>2,I=1/k;for(u=new r(256),h=new r(256),c=new r(256),C=0;256>C;C+=4)u[C]=0,h[C]=0,c[C]=0,u[C+1]=0,h[C+1]=0,c[C+1]=0,u[C+2]=0,h[C+2]=0,c[C+2]=0,u[C+3]=0,h[C+3]=0,c[C+3]=0;for(C=0;Y>C;C+=4)n=t[C],a=t[C+1],i=t[C+2],u[n]+=I,h[a]+=I,c[i]+=I,n>_?_=n:M>n&&(M=n),a>b?b=a:F>a&&(F=a),i>y?y=i:z>i&&(z=i);for(f=m=d=0,C=0;256>C;C+=4)f+=u[C],u[C]=f,m+=h[C],h[C]=m,d+=c[C],c[C]=d,f+=u[C+1],u[C+1]=f,m+=h[C+1],h[C+1]=m,d+=c[C+1],c[C+1]=d,f+=u[C+2],u[C+2]=f,m+=h[C+2],h[C+2]=m,d+=c[C+2],c[C+2]=d,f+=u[C+3],u[C+3]=f,m+=h[C+3],h[C+3]=m,d+=c[C+3],c[C+3]=d;if(l=_-M,s=b-F,o=y-z,e)for(C=0;Y>C;C+=4)n=t[C],a=t[C+1],i=t[C+2],p=u[n]*l+M,g=h[a]*s+F,v=c[i]*o+z,p=0>p?0:p>255?255:p,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,t[C]=~~p,t[C+1]=~~g,t[C+2]=~~v;else for(C=0;Y>C;C+=4)n=t[C],a=t[C+1],i=t[C+2],p=u[n]*l+M,g=h[a]*s+F,v=c[i]*o+z,t[C]=~~p,t[C+1]=~~g,t[C+2]=~~v;return t}})}(t),!function(t){"use strict";var e=Math.sqrt,r=t._notSupportClamp,n=t.Array32F;t.PixelateFilter=t.Create({name:"PixelateFilter",scale:1,init:function(t){this.scale=t||1},serialize:function(){var t=this;return{filter:t.name,params:{scale:t.scale}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r.scale=e.scale),r},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var l,s,o,u,h,c,f,m,d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E,A,q,H,B,R,G,L,T,j,P,V,D,U,Q,W,$,J,K,O=t.length,Z=O>>2,te=(a<<1)+a;for(l=~~(.01*e(Z)*this.scale),s=a*l,o=i%l,u=a%l,h=(o-1)*a,d=1/(l*l),p=1/(u*l),g=1/(o*l),v=1/(u*o),C=d,_=p,b=g,y=v,k=l-1,I=(l-1)*a,T=0,P=a-1,j=0,V=Z-a,M=new n(3*Z),X=0,S=0,x=0,F=z=Y=0,x=0;a>x;x++,X+=4,S+=3)F+=t[X],z+=t[X+1],Y+=t[X+2],M[S]=F,M[S+1]=z,M[S+2]=Y;for(S=0,x=0,F=z=Y=0,X=te+a;O>X;X+=4,S+=3,x++)x>=a&&(x=0,F=z=Y=0),F+=t[X],z+=t[X+1],Y+=t[X+2],M[S+te]=M[S]+F,M[S+te+1]=M[S+1]+z,M[S+te+2]=M[S+2]+Y;for(x=0,N=0,w=0,B=x,R=w,G=B+k,L=R+I,G=G>P?P:G,L=L>V?V:L,D=B+R,W=G+L,U=G+R,Q=B+L,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,m=C,$=m*(M[W]-M[U]-M[Q]+M[D]),J=m*(M[W+1]-M[U+1]-M[Q+1]+M[D+1]),K=m*(M[W+2]-M[U+2]-M[Q+2]+M[D+2]),r&&($=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),$=~~$,J=~~J,K=~~K,E=0,A=0,q=0,X=0;O>X;X+=4)H=E+x+q+w<<2,t[H]=$,t[H+1]=J,t[H+2]=K,E++,(E+x>=a||E>=l)&&(E=0,A++,q+=a),(A+N>=i||A>=l)&&(x+=l,x>=a&&(x=0,N+=l,w+=s),E=0,A=0,q=0,B=x,R=w,G=B+k,L=R+I,G=G>P?P:G,L=L>V?V:L,D=B+R,W=G+L,U=G+R,Q=B+L,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,c=0==G-B-u+1,f=0==L-R-h,m=c&&f?y:c?_:f?b:C,$=m*(M[W]-M[U]-M[Q]+M[D]),J=m*(M[W+1]-M[U+1]-M[Q+1]+M[D+1]),K=m*(M[W+2]-M[U+2]-M[Q+2]+M[D+2]),r&&($=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),$=~~$,J=~~J,K=~~K);return t}})}(t),!function(t){"use strict";var e=Math.sqrt,r=(Math.SQRT2,Math.min,t._notSupportClamp),n=t.Array32F;t.TriangularPixelateFilter=t.Create({name:"TriangularPixelateFilter",scale:1,init:function(t){this.scale=t||1},serialize:function(){var t=this;return{filter:t.name,params:{scale:t.scale}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r.scale=e.scale),r},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var l,s,o,u,h,c,f,m,d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E,A,q,H,B,R,G,L,T,j,P,V,D,U,Q,W,$,J,K,O,Z,te,ee,re,ne,ae,ie,le=t.length,se=le>>2,oe=(a<<1)+a;for(l=~~(.01*e(se)*this.scale),s=l>>1,o=l-1,u=a*l,h=i%l,c=a%l,f=(h-1)*a,g=1/(l*l),v=1/(c*l),C=1/(h*l),_=1/(c*h),b=2*g,y=2*v,M=2*C,F=2*_,X=o,S=o*a,P=0,D=a-1,V=0,U=se-a,z=new n(3*se),x=0,N=0,w=0,Y=k=I=0,w=0;a>w;w++,x+=4,N+=3)Y+=t[x],k+=t[x+1],I+=t[x+2],z[N]=Y,z[N+1]=k,z[N+2]=I;for(N=0,w=0,Y=k=I=0,x=oe+a;le>x;x+=4,N+=3,w++)w>=a&&(w=0,Y=k=I=0),Y+=t[x],k+=t[x+1],I+=t[x+2],z[N+oe]=z[N]+Y,z[N+oe+1]=z[N+1]+k,z[N+oe+2]=z[N+2]+I;for(w=0,E=0,A=0,G=w,L=A,T=w-s+X,j=A+S,T=T>D?D:T,j=j>U?U:j,Q=G+L,J=T+j,W=T+L,$=G+j,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,p=b,te=p*(z[J]-z[W]-z[$]+z[Q]),ee=p*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),re=p*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),G=w+s,T=w+X,T=T>D?D:T,Q=G+L,J=T+j,W=T+L,$=G+j,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,ne=p*(z[J]-z[W]-z[$]+z[Q]),ae=p*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),ie=p*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),r&&(te=0>te?0:te>255?255:te,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie),te=~~te,ee=~~ee,re=~~re,ne=~~ne,ae=~~ae,ie=~~ie,K=te,O=ee,Z=re,q=0,H=0,B=0,x=0;le>x;x+=4)R=q+w+B+A<<2,t[R]=K,t[R+1]=O,t[R+2]=Z,q++,(q+w>=a||q>=l)&&(q=0,H++,B+=a,K=te,O=ee,Z=re),q>o-H&&(K=ne,O=ae,Z=ie),(H+E>=i||H>=l)&&(w+=l,w>=a&&(w=0,E+=l,A+=u),q=0,H=0,B=0,G=w,L=A,T=w-s+X,j=A+S,T=T>D?D:T,j=j>U?U:j,Q=G+L,J=T+j,W=T+L,$=G+j,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,m=0==T-G+s-c+1,d=0==j-L-f,p=m&&d?F:m?y:d?M:b,te=p*(z[J]-z[W]-z[$]+z[Q]),ee=p*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),re=p*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),G=w+s,T=w+X,T=T>D?D:T,Q=G+L,J=T+j,W=T+L,$=G+j,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,m=0==T-G+s-c+1,p=m&&d?F:m?y:d?M:b,ne=p*(z[J]-z[W]-z[$]+z[Q]),ae=p*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),ie=p*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),r&&(te=0>te?0:te>255?255:te,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie),te=~~te,ee=~~ee,re=~~re,ne=~~ne,ae=~~ae,ie=~~ie,K=te,O=ee,Z=re);return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Color.RGB2HSV,n=.7083333333333334;t.HSVConverterFilter=t.Create({name:"HSVConverterFilter",apply:function(t){var a,i,l,s,o,u,h,c,f=t.length;if(e)for(s=0;f>s;s+=4)a=t[s],i=t[s+1],l=t[s+2],o=r({r:a,g:i,b:l}),u=o.h*n,c=255*o.s,h=o.v,0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),0>c?c=0:c>255&&(c=255),t[s]=~~u,t[s+1]=~~h,t[s+2]=~~c;else for(s=0;f>s;s+=4)a=t[s],i=t[s+1],l=t[s+2],o=r({r:a,g:i,b:l}),u=o.h*n,c=255*o.s,h=o.v,t[s]=~~u,t[s+1]=~~h,t[s+2]=~~c;return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,t.ImArray,t.Color.clampPixel),r=t.Color.RGB2HSV,n=(t.Color.HSV2RGB,t.Color.Color2RGBA);t.HueExtractorFilter=t.Create({name:"HueExtractorFilter",range:null,background:0,init:function(t,e){this.range=t,this.background=e||0},serialize:function(){var t=this;return{filter:t.name,params:{range:t.range,background:t.background}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r.range=e.range,r.background=e.background),r},apply:function(t){if(!this.range||!this.range.length)return t;var a,i,l,s,o,u,h,c,f,m,d=t.length,p=this.range[0],g=this.range[this.range.length-1];for(f=n(this.background||0),s=~~e(f.r),o=~~e(f.g),u=~~e(f.b),h=~~e(f.a),c=0;d>c;c+=4)a=t[c],i=t[c+1],l=t[c+2],m=r({r:a,g:i,b:l}).h,(p>m||m>g)&&(t[c]=s,t[c+1]=o,t[c+2]=u,t[c+3]=h);return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,Math.min),r=Math.floor,n=t.CHANNEL.RED;t.CHANNEL.GREEN,t.CHANNEL.BLUE,t.CHANNEL.ALPHA,t.ChannelCopyFilter=t.Create({name:"ChannelCopyFilter",srcImg:null,_srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,init:function(t,e,r,a,i){this._srcImg=null,this.srcImg=null,this.srcChannel=e||n,this.dstChannel=r||n,this.centerX=a||0,this.centerY=i||0,t&&this.setSrc(t)},serialize:function(){var t=this;return{filter:t.name,params:{_srcImg:t._srcImg,centerX:t.centerX,centerY:t.centerY,srcChannel:t.srcChannel,dstChannel:t.dstChannel}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r._srcImg=e._srcImg,r.centerX=e.centerX,r.centerY=e.centerY,r.srcChannel=e.srcChannel,r.dstChannel=e.dstChannel),r},setSrc:function(t){return t&&(this.srcImg=t,this._srcImg={data:t.getData(),width:t.width,height:t.height}),this},apply:function(t,n,a){if(!this._srcImg)return t;var i,l,s,o,u,h,c=this._srcImg.data,f=t.length,m=(c.length,this._srcImg.width),d=this._srcImg.height,p=this.srcChannel,g=this.dstChannel,v=e(n,m),C=e(a,d),_=this.centerX||0,b=this.centerY||0,y=m>>1,M=d>>1;for(_=r(_*(n-1))-y,b=r(b*(a-1))-M,i=0,l=0,s=0,i=0;f>i;i+=4,l++)l>=n&&(l=0,s++),u=l-_,h=s-b,u>=0&&v>u&&h>=0&&C>h&&(o=u+h*m<<2,t[i+g]=c[o+p]);return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,Math.min),r=Math.floor;t.AlphaMaskFilter=t.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,init:function(t,e,r){this.centerX=e||0,this.centerY=r||0,this._alphaMask=null,this.alphaMask=null,t&&this.setMask(t)},serialize:function(){var t=this;return{filter:t.name,params:{_alphaMask:t._alphaMask,centerX:t.centerX,centerY:t.centerY}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r._alphaMask=e._alphaMask,r.centerX=e.centerX,r.centerY=e.centerY),r},setMask:function(t){return t&&(this.alphaMask=t,this._alphaMask={data:t.getData(),width:t.width,height:t.height}),this},apply:function(t,n,a){if(!this._alphaMask)return t;var i,l,s,o,u,h,c=this._alphaMask.data,f=this._alphaMask.width,m=this._alphaMask.height,d=t.length,p=(c.length,e(n,f)),g=e(a,m),v=this.centerX||0,C=this.centerY||0,_=f>>1,b=m>>1;for(v=r(v*(n-1))-_,C=r(C*(a-1))-b,l=0,s=0,i=0;d>i;i+=4,l++)l>=n&&(l=0,s++),u=l-v,h=s-C,u>=0&&p>u&&h>=0&&g>h?(o=u+h*f<<2,t[i+3]=c[o+3]):t[i+3]=0;return t}})}(t),!function(t,e){"use strict";var r,n=Math.min,a=Math.max,i=Math.round,l=(Math.floor,Math.abs),s=t._notSupportClamp;t.BlendFilter=t.Create({name:"BlendFilter",_blendModeName:null,_blendMode:null,_blendImage:null,blendImage:null,startX:0,startY:0,amount:1,init:function(t,e,r){this.startX=0,this.startY=0,this.amount=1,this._blendImage=null,this.blendImage=null,this._blendModeName=null,this._blendMode=null,t&&this.image(t),e&&this.mode(e,r)},serialize:function(){var t=this;return{filter:t.name,params:{_blendImage:t._blendImage,_blendModeName:t._blendModeName,startX:t.startX,startY:t.startY,amount:t.amount}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r._blendImage=e._blendImage,r.startX=e.startX,r.startY=e.startY,r.mode(e._blendModeName,e.amount)),r},image:function(t){return t&&(this.blendImage=t,this._blendImage={data:t.getData(),width:t.width,height:t.height}),this},mode:function(t,i){return t?(this._blendModeName=(""+t).toLowerCase(),this._blendMode=r[this._blendModeName]||null,this.amount=a(0,n(1,e===i?1:i))):(this._blendModeName=null,this._blendMode=null),this},reset:function(){return this.startX=0,this.startY=0,this.amount=1,this._blendModeName=null,this._blendMode=null,this},apply:function(t,e,r){if(!this._blendMode||!this._blendImage)return t;var a,l,s,o,u,h=this.startX||0,c=this.startY||0,f=0,m=0,d=this._blendImage,p=this.amount||1;return o=d.width,u=d.height,0>h&&(f=-h,h=0),0>c&&(m=-c,c=0),h>=e||c>=r?t:f>=o||m>=u?t:(h=i(h),c=i(c),f=i(f),m=i(m),a=n(e-h,o-f),l=n(r-c,u-m),0>=a||0>=l?t:(s=d.data,this._blendMode(t,e,r,s,o,u,h,c,f,m,a,l,p)))}}),r={normal:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;for(E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],x=I,N=X,w=S,z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},lighten:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;for(E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],x=z>I?z:I,N=Y>X?Y:X,w=k>S?k:S,z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},darken:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;for(E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],x=z>I?I:z,N=Y>X?X:Y,w=k>S?S:k,z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},multiply:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;for(E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],x=.003921568627451*z*I,N=.003921568627451*Y*X,w=.003921568627451*k*S,z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},average:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;for(E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],x=.5*(z+I),N=.5*(Y+X),w=.5*(k+S),z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},add:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;for(E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],x=z+I,N=Y+X,w=k+S,z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},subtract:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;for(E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],x=255>z+I?0:z+I-255,N=255>Y+X?0:Y+X-255,w=255>k+S?0:k+S-255,z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},difference:function(t,e,r,n,a,i,o,u,h,c,f,m,d){var p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E,A;for(A=1-d,y=o,M=u*e,F=h,z=c*a,p=o+f,g=h+f,v=0,C=m*f;C>v;)_=y+M<<2,b=F+z<<2,Y=t[_],k=t[_+1],I=t[_+2],X=n[b],S=n[b+1],x=n[b+2],N=l(X-Y),w=l(S-k),E=l(x-I),Y=N*d+Y*A,k=w*d+k*A,I=E*d+I*A,s&&(Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k,I=0>I?0:I>255?255:I),t[_]=~~Y,t[_+1]=~~k,t[_+2]=~~I,v++,y++,y>=p&&(y=o,M+=e),F++,F>=g&&(F=h,z+=a);return t},negation:function(t,e,r,n,a,i,o,u,h,c,f,m,d){var p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E,A;for(A=1-d,y=o,M=u*e,F=h,z=c*a,p=o+f,g=h+f,v=0,C=m*f;C>v;)_=y+M<<2,b=F+z<<2,Y=t[_],k=t[_+1],I=t[_+2],X=n[b],S=n[b+1],x=n[b+2],N=255-l(255-X-Y),w=255-l(255-S-k),E=255-l(255-x-I),Y=N*d+Y*A,k=w*d+k*A,I=E*d+I*A,s&&(Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k,I=0>I?0:I>255?255:I),t[_]=~~Y,t[_+1]=~~k,t[_+2]=~~I,v++,y++,y>=p&&(y=o,M+=e),F++,F>=g&&(F=h,z+=a);return t},screen:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;for(E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],x=255-((255-I)*(255-z)>>8),N=255-((255-X)*(255-Y)>>8),w=255-((255-S)*(255-k)>>8),z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},exclusion:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;for(E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],x=I+z-.003921568627451*2*I*z,N=X+Y-.003921568627451*2*X*Y,w=S+k-.003921568627451*2*S*k,z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},overlay:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;for(E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],x=128>z?.003921568627451*2*I*z:255-.003921568627451*2*(255-I)*(255-z),N=128>Y?.003921568627451*2*X*Y:255-.003921568627451*2*(255-X)*(255-Y),x=128>k?.003921568627451*2*S*k:255-.003921568627451*2*(255-S)*(255-k),z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},softlight:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;for(E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],x=128>z?2*((I>>1)+64)*.003921568627451*z:255-.003921568627451*2*(255-((I>>1)+64))*(255-z),N=128>Y?2*((X>>1)+64)*.003921568627451*Y:255-.003921568627451*2*(255-((X>>1)+64))*(255-Y),w=128>k?2*((S>>1)+64)*.003921568627451*k:255-.003921568627451*2*(255-((S>>1)+64))*(255-k),z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},hardlight:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;for(E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],x=128>I?.003921568627451*2*z*I:255-.003921568627451*2*(255-z)*(255-I),N=128>X?.003921568627451*2*Y*X:255-.003921568627451*2*(255-Y)*(255-X),w=128>S?.003921568627451*2*k*S:255-.003921568627451*2*(255-k)*(255-S),z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},colordodge:function(t,e,r,a,i,l,o,u,h,c,f,m,d){var p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E,A;for(A=1-d,y=o,M=u*e,F=h,z=c*i,p=o+f,g=h+f,v=0,C=m*f;C>v;)_=y+M<<2,b=F+z<<2,Y=t[_],k=t[_+1],I=t[_+2],X=a[b],S=a[b+1],x=a[b+2],N=255==Y?Y:n(255,(X<<8)/(255-Y)),w=255==k?k:n(255,(S<<8)/(255-k)),E=255==I?Y:n(255,(x<<8)/(255-I)),Y=N*d+Y*A,k=w*d+k*A,I=E*d+I*A,s&&(Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k,I=0>I?0:I>255?255:I),t[_]=~~Y,t[_+1]=~~k,t[_+2]=~~I,v++,y++,y>=p&&(y=o,M+=e),F++,F>=g&&(F=h,z+=i);return t},colorburn:function(t,e,r,n,i,l,o,u,h,c,f,m,d){var p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E,A;for(A=1-d,y=o,M=u*e,F=h,z=c*i,p=o+f,g=h+f,v=0,C=m*f;C>v;)_=y+M<<2,b=F+z<<2,Y=t[_],k=t[_+1],I=t[_+2],X=n[b],S=n[b+1],x=n[b+2],N=0==Y?Y:a(0,255-(255-X<<8)/Y),w=0==k?k:a(0,255-(255-S<<8)/k),E=0==I?I:a(0,255-(255-x<<8)/I),Y=N*d+Y*A,k=w*d+k*A,I=E*d+I*A,s&&(Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k,I=0>I?0:I>255?255:I),t[_]=~~Y,t[_+1]=~~k,t[_+2]=~~I,v++,y++,y>=p&&(y=o,M+=e),F++,F>=g&&(F=h,z+=i);return t},linearlight:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;for(var A;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],128>z?(A=2*z,x=255>A+I?0:A+I-255):(A=2*(z-128),x=A+I),128>Y?(A=2*Y,N=255>A+X?0:A+X-255):(A=2*(Y-128),N=A+X),128>k?(A=2*k,w=255>A+S?0:A+S-255):(A=2*(k-128),w=A+S),z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},reflect:function(t,e,r,a,i,l,o,u,h,c,f,m,d){var p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E,A;for(A=1-d,y=o,M=u*e,F=h,z=c*i,p=o+f,g=h+f,v=0,C=m*f;C>v;)_=y+M<<2,b=F+z<<2,Y=t[_],k=t[_+1],I=t[_+2],X=a[b],S=a[b+1],x=a[b+2],N=255==Y?Y:n(255,X*X/(255-Y)),w=255==k?k:n(255,S*S/(255-k)),E=255==I?I:n(255,x*x/(255-I)),Y=N*d+Y*A,k=w*d+k*A,I=E*d+I*A,s&&(Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k,I=0>I?0:I>255?255:I),t[_]=~~Y,t[_+1]=~~k,t[_+2]=~~I,v++,y++,y>=p&&(y=o,M+=e),F++,F>=g&&(F=h,z+=i);return t},glow:function(t,e,r,a,i,l,o,u,h,c,f,m,d){var p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E,A;for(A=1-d,y=o,M=u*e,F=h,z=c*i,p=o+f,g=h+f,v=0,C=m*f;C>v;)_=y+M<<2,b=F+z<<2,Y=t[_],k=t[_+1],I=t[_+2],X=a[b],S=a[b+1],x=a[b+2],N=255==X?X:n(255,Y*Y/(255-X)),w=255==S?S:n(255,k*k/(255-S)),E=255==x?x:n(255,I*I/(255-x)),Y=N*d+Y*A,k=w*d+k*A,I=E*d+I*A,s&&(Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k,I=0>I?0:I>255?255:I),t[_]=~~Y,t[_+1]=~~k,t[_+2]=~~I,v++,y++,y>=p&&(y=o,M+=e),F++,F>=g&&(F=h,z+=i);return t},phoenix:function(t,e,r,i,l,o,u,h,c,f,m,d,p){var g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E,A,q;for(q=1-p,M=u,F=h*e,z=c,Y=f*l,g=u+m,v=c+m,C=0,_=d*m;_>C;)b=M+F<<2,y=z+Y<<2,k=t[b],I=t[b+1],X=t[b+2],S=i[y],x=i[y+1],N=i[y+2],w=n(S,k)-a(S,k)+255,E=n(x,I)-a(x,I)+255,A=n(N,X)-a(N,X)+255,k=w*p+k*q,I=E*p+I*q,X=A*p+X*q,s&&(k=0>k?0:k>255?255:k,I=0>I?0:I>255?255:I,X=0>X?0:X>255?255:X),t[b]=~~k,t[b+1]=~~I,t[b+2]=~~X,C++,M++,M>=g&&(M=u,F+=e),z++,z>=v&&(z=c,Y+=l);return t},vividlight:function(t,e,r,i,l,o,u,h,c,f,m,d,p){var g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E,A,q;q=1-p,M=u,F=h*e,z=c,Y=f*l,g=u+m,v=c+m,C=0,_=d*m;for(var H;_>C;)b=M+F<<2,y=z+Y<<2,k=t[b],I=t[b+1],X=t[b+2],S=i[y],x=i[y+1],N=i[y+2],128>k?(H=2*k,w=0==H?H:a(0,255-(255-S<<8)/H)):(H=2*(k-128),w=255==H?H:n(255,(S<<8)/(255-H))),128>I?(H=2*I,E=0==H?H:a(0,255-(255-x<<8)/H)):(H=2*(I-128),E=255==H?H:n(255,(x<<8)/(255-H))),128>X?(H=2*X,A=0==H?H:a(0,255-(255-N<<8)/H)):(H=2*(I-128),A=255==H?H:n(255,(N<<8)/(255-H))),k=w*p+k*q,I=E*p+I*q,X=A*p+X*q,s&&(k=0>k?0:k>255?255:k,I=0>I?0:I>255?255:I,X=0>X?0:X>255?255:X),t[b]=~~k,t[b+1]=~~I,t[b+2]=~~X,C++,M++,M>=g&&(M=u,F+=e),z++,z>=v&&(z=c,Y+=l);return t},pinlight:function(t,e,r,n,a,i,l,o,u,h,c,f,m){var d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E;E=1-m,b=l,y=o*e,M=u,F=h*a,d=l+c,p=u+c,g=0,v=f*c;for(var A;v>g;)C=b+y<<2,_=M+F<<2,z=t[C],Y=t[C+1],k=t[C+2],I=n[_],X=n[_+1],S=n[_+2],128>z?(A=2*z,x=A>I?A:I):(A=2*(z-128),x=A>I?I:A),128>Y?(A=2*Y,N=A>X?A:X):(A=2*(z-128),N=A>X?X:A),128>k?(A=2*k,w=A>S?A:S):(A=2*(k-128),w=A>S?S:A),z=x*m+z*E,Y=N*m+Y*E,k=w*m+k*E,s&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[C]=~~z,t[C+1]=~~Y,t[C+2]=~~k,g++,b++,b>=d&&(b=l,y+=e),M++,M>=p&&(M=u,F+=a);return t},hardmix:function(t,e,r,i,l,o,u,h,c,f,m,d,p){var g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E,A,q;q=1-p,M=u,F=h*e,z=c,Y=f*l,g=u+m,v=c+m,C=0,_=d*m;for(var H;_>C;)b=M+F<<2,y=z+Y<<2,k=t[b],I=t[b+1],X=t[b+2],S=i[y],x=i[y+1],N=i[y+2],128>k?(H=2*k,w=0==H?H:a(0,255-(255-S<<8)/H)):(H=2*(k-128),w=255==H?H:n(255,(S<<8)/(255-H))),w=128>w?0:255,128>I?(H=2*I,E=0==H?H:a(0,255-(255-x<<8)/H)):(H=2*(I-128),E=255==H?H:n(255,(x<<8)/(255-H))),E=128>E?0:255,128>X?(H=2*X,A=0==H?H:a(0,255-(255-N<<8)/H)):(H=2*(X-128),A=255==H?H:n(255,(N<<8)/(255-H))),A=128>A?0:255,k=w*p+k*q,I=E*p+I*q,X=A*p+X*q,s&&(k=0>k?0:k>255?255:k,I=0>I?0:I>255?255:I,X=0>X?0:X>255?255:X),t[b]=~~k,t[b+1]=~~I,t[b+2]=~~X,C++,M++,M>=g&&(M=u,F+=e),z++,z>=v&&(z=c,Y+=l);return t}},r.lineardodge=r.add,r.linearburn=r.subtract}(t),!function(t){"use strict";var e=(t._notSupportClamp,t.Color.RGBA2Color),r=t.Color.Color2RGBA;t.ThresholdFilter=t.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(t,e){this.thresholds=t,this.quantizedColors=e||null},serialize:function(){var t=this;return{filter:t.name,params:{thresholds:t.thresholds,quantizedColors:t.quantizedColors}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r.thresholds=e.thresholds,r.quantizedColors=e.quantizedColors),r},apply:function(t){if(!this.thresholds||!this.thresholds.length)return t;if(!this.quantizedColors||!this.quantizedColors.length)return t;var n,a,i,l,s,o,u,h,c=t.length,f=this.thresholds,m=f.length,d=this.quantizedColors,p=d.length;for(u=0;c>u;u+=4){for(s=e({r:t[u],g:t[u+1],b:t[u+2],a:t[u+3]}),h=0;m>h&&s>f[h];)h++;s=p>h?d[h]:255,o=r(s),n=o.r,a=o.g,i=o.b,l=o.a,t[u]=n,t[u+1]=a,t[u+2]=i,t[u+3]=l}return t}})}(t),!function(t){"use strict";var e=(Math.sqrt,Math.exp,Math.log),r=Math.abs,n=Math.floor,a=t._notSupportClamp,i=t.Array32F;t.BokehFilter=t.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(t,e,r,n){this.centerX=t||0,this.centerY=e||0,this.radius=r||10,this.amount=n||10},serialize:function(){var t=this;return{filter:t.name,params:{centerX:t.centerX,centerY:t.centerY,radius:t.radius,amount:t.amount}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r.centerX=e.centerX,r.centerY=e.centerY,r.radius=e.radius,r.amount=e.amount),r},apply:function(t,l,s){var o,u,h,c,f,m,d,p,g,v,C,_,b,y,M,F,z,Y,k,I,X,S,x,N,w,E,A,q,H,B,R,G,L,T=t.length,j=this.centerX||0,P=this.centerY||0,V=this.radius,D=this.amount;if(0>=D)return t;for(o=T>>2,B=0,R=l-1,G=0,L=o-l,j=n(j*(l-1)),P=n(P*(s-1)),h=(o<<1)+o,d=(l<<1)+l,u=new i(h),p=0,g=0,v=0,c=f=m=0,v=0;l>v;v++,p+=4,g+=3)c+=t[p],f+=t[p+1],m+=t[p+2],u[g]=c,u[g+1]=f,u[g+2]=m;for(p=d+l,g=0,v=0,c=f=m=0,p=d+l;T>p;p+=4,g+=3,v++)v>=l&&(v=0,c=f=m=0),c+=t[p],f+=t[p+1],m+=t[p+2],u[g+d]=u[g]+c,u[g+d+1]=u[g+1]+f,u[g+d+2]=u[g+2]+m;for(v=0,C=0,_=0,p=0;T>p;p+=4,v++)v>=l&&(v=0,C++,_+=l),y=v-j,M=C-P,b=r(y)+r(M),F=b>V?~~e((b-V)*D):~~(b/V+.5),F>0&&(z=F*l,Y=.25/(F*F),k=v-F,I=_-z,X=v+F,S=_+z,B>k?k=B:X>R&&(X=R),G>I?I=G:S>L&&(S=L),x=k+I,E=X+S,N=X+I,w=k+S,x=(x<<1)+x,N=(N<<1)+N,w=(w<<1)+w,E=(E<<1)+E,A=Y*(u[E]-u[N]-u[w]+u[x]),q=Y*(u[E+1]-u[N+1]-u[w+1]+u[x+1]),H=Y*(u[E+2]-u[N+2]-u[w+2]+u[x+2]),a&&(A=0>A?0:A>255?255:A,q=0>q?0:q>255?255:q,H=0>H?0:H>255?255:H),t[p]=~~A,t[p+1]=~~q,t[p+2]=~~H);return t}})}(t),e});