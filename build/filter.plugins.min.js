/**
*
*   FILTER.js Plugins
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,r){"use strict";"object"==typeof module&&module.exports?module.exports=r.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(n,t){return r.moduleUri=n.uri,r.call(e,t),t}):(r.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(r){"use strict";var n=r.getPath(e.moduleUri);return!function(e){var r=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,r){var n=this;n.min=e||-127,n.max=r||127},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{min:e.min,max:e.max}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.min=r.min,n.max=r.max),n},apply:function(e,n,a){var i=this;if(!i._isOn)return e;var s,o,l,u,h,c,f,d,p=i.max-i.min,_=i.min,m=e.length;if(r)for(s=0;m>s;s+=4)l=e[s],u=e[s+1],h=e[s+2],o=p*t()+_,c=l+o,f=u+o,d=h+o,0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),0>d?d=0:d>255&&(d=255),e[s]=~~c,e[s+1]=~~f,e[s+2]=~~d;else for(s=0;m>s;s+=4)l=e[s],u=e[s+1],h=e[s+2],o=p*t()+_,c=l+o,f=u+o,d=h+o,e[s]=~~c,e[s+1]=~~f,e[s+2]=~~d;return e}})}(r),!function(e){var r=e.Util.Image.perlin;e.Create({name:"PerlinNoiseFilter",_baseX:1,_baseY:1,_octaves:1,_offsets:null,_colors:!1,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:n,init:function(e,r,n,t,a,i,s,o){var l=this;l._baseX=e||1,l._baseY=r||1,l._seed=s||0,l._stitch=!!t,l._fractal=!1!==a,l._perlin=!!o,l.octaves(n||1,i)},seed:function(e){var r=this;return r._seed=e||0,r},octaves:function(e,r){var n=this;for(n._octaves=e||1,n._offsets=r?r.slice(0):[];n._offsets.length<n._octaves;)n._offsets.push([0,0]);return n},seamless:function(e){return arguments.length||(e=!0),this._stitch=!!e,this},colors:function(e){return arguments.length||(e=!0),this._colors=!!e,this},turbulence:function(e){return arguments.length||(e=!0),this._fractal=!e,this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_baseX:e._baseX,_baseY:e._baseY,_octaves:e._octaves,_offsets:e._offsets,_seed:e._seed||0,_stitch:e._stitch,_colors:e._colors,_fractal:e._fractal,_perlin:e._perlin}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n._baseX=r._baseX,n._baseY=r._baseY,n._octaves=r._octaves,n._offsets=r._offsets,n._seed=r._seed||0,n._stitch=r._stitch,n._colors=r._colors,n._fractal=r._fractal,n._perlin=r._perlin),n},apply:function(e,n,t){var a=this;return a._isOn&&r?(a._seed&&(r.seed(a._seed),a._seed=0),r(e,n,t,a._stitch,!a._colors,a._baseX,a._baseY,a._octaves,a._offsets,1,.5,a._perlin)):e}})}(r),!function(e,r){var t=e.Util.Image,a=e.Util.Array.typed;e.Create({name:"GradientFilter",colors:null,stops:null,angle:0,path:n,init:function(e,r,n){var t=this;t.setColors(e,r),t.angle=n||0},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.angle=null,e.$super("dispose"),e},setColors:function(e,r){var n=this;if(e&&e.length){var a=t.colors_stops(e,r);n.colors=a[0],n.stops=a[1]}return n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{angle:e.angle,colors:e.colors,stops:e.stops}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.angle=r.angle,n.colors=a(r.colors,Array),n.stops=a(r.stops,Array)),n},apply:function(e,r,n){var a=this;return a._isOn&&a.colors?t.gradient(e,r,n,a.colors,a.stops,a.angle,t.lerp):e}}),e.Create({name:"RadialGradientFilter",colors:null,stops:null,centerX:0,centerY:0,radiusX:1,radiusY:1,init:function(e,r,n,t,a,i){var s=this;s.setColors(e,r),s.centerX=n||0,s.centerY=t||0,s.radiusX=a||1,s.radiusY=i||1},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.centerX=null,e.centerY=null,e.radiusX=null,e.radiusY=null,e.$super("dispose"),e},setColors:function(e,r){var n=this;if(e&&e.length){var a=t.colors_stops(e,r);n.colors=a[0],n.stops=a[1]}return n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radiusX:e.radiusX,radiusY:e.radiusY,colors:e.colors,stops:e.stops}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.centerX=r.centerX||0,n.centerY=r.centerY||0,n.radiusX=r.radiusX||1,n.radiusY=r.radiusY||1,n.colors=a(r.colors,Array),n.stops=a(r.stops,Array)),n},apply:function(e,r,n){var a=this;return a._isOn&&a.colors?t.radial_gradient(e,r,n,a.colors,a.stops,a.centerX,a.centerY,a.radiusX,a.radiusY,t.lerp):e}})}(r),!function(e){var r=(e._notSupportClamp,Math.min),t=Math.floor,a=e.CHANNEL.RED;e.CHANNEL.GREEN,e.CHANNEL.BLUE,e.CHANNEL.ALPHA;e.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,path:n,init:function(e,r,n,t,i){var s=this;s._srcImg=null,s.srcImg=null,s.srcChannel=r||a,s.dstChannel=n||a,s.centerX=t||0,s.centerY=i||0,e&&s.setSrc(e)},dispose:function(){var e=this;return e.srcImg=null,e._srcImg=null,e.$super("dispose"),e},setSrc:function(e){var r=this;return e&&(r.srcImg=e,r._srcImg=null),r},serialize:function(){var e=this,r=e.srcImg;return{filter:e.name,_isOn:!!e._isOn,params:{_srcImg:e._srcImg||(r?{data:r.getData(),width:r.width,height:r.height}:null),centerX:e.centerX,centerY:e.centerY,srcChannel:e.srcChannel,dstChannel:e.dstChannel}}},unserialize:function(r){var n,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,n=r.params,t.srcImg=null,t._srcImg=n._srcImg,t._srcImg&&(t._srcImg.data=e.Util.Array.typed(t._srcImg.data,e.ImArray)),t.centerX=n.centerX,t.centerY=n.centerY,t.srcChannel=n.srcChannel,t.dstChannel=n.dstChannel),t},apply:function(e,n,a){var i=this,s=i.srcImg;if(!i._isOn||!s&&!i._srcImg)return e;var o,l,u,h,c,f,d=i._srcImg||{data:s.getData(),width:s.width,height:s.height},p=d.data,_=d.width,m=d.height,g=e.length,y=(p.length,i.srcChannel),v=i.dstChannel,b=r(n,_),C=r(a,m),O=i.centerX||0,w=i.centerY||0,M=_>>1,I=m>>1;for(O=t(O*(n-1))-M,w=t(w*(a-1))-I,o=0,l=0,u=0,o=0;g>o;o+=4,l++)l>=n&&(l=0,u++),c=l-O,f=u-w,c>=0&&b>c&&f>=0&&C>f&&(h=c+f*_<<2,e[o+v]=p[h+y]);return e}})}(r),!function(e){var r=(e._notSupportClamp,Math.min),t=Math.floor;e.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,path:n,init:function(e,r,n){var t=this;t.centerX=r||0,t.centerY=n||0,t._alphaMask=null,t.alphaMask=null,e&&t.setMask(e)},dispose:function(){var e=this;return e.alphaMask=null,e._alphaMask=null,e.$super("dispose"),e},setMask:function(e){var r=this;return e&&(r.alphaMask=e,r._alphaMask=null),r},serialize:function(){var e=this,r=e.alphaMask;return{filter:e.name,_isOn:!!e._isOn,params:{_alphaMask:e._alphaMask||(r?{data:r.getData(),width:r.width,height:r.height}:null),centerX:e.centerX,centerY:e.centerY}}},unserialize:function(r){var n,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,n=r.params,t.alphaMask=null,t._alphaMask=n._alphaMask,t._alphaMask&&(t._alphaMask.data=e.Util.Array.typed(t._alphaMask.data,e.ImArray)),t.centerX=n.centerX,t.centerY=n.centerY),t},apply:function(e,n,a){var i=this,s=i.alphaMask;if(!i._isOn||!s&&!i._alphaMask)return e;var o,l,u,h,c,f,d=i._alphaMask||{data:s.getData(),width:s.width,height:s.height},p=d.data,_=d.width,m=d.height,g=e.length,y=(p.length,r(n,_)),v=r(a,m),b=i.centerX||0,C=i.centerY||0,O=_>>1,w=m>>1;for(b=t(b*(n-1))-O,C=t(C*(a-1))-w,l=0,u=0,o=0;g>o;o+=4,l++)l>=n&&(l=0,u++),c=l-b,f=u-C,c>=0&&y>c&&f>=0&&v>f?(h=c+f*_<<2,e[o+3]=p[h+3]):e[o+3]=0;return e}})}(r),!function(e){var r=e._notSupportClamp,t=e.Array32F,a=Math.min,i=Math.max;e.Util.Array.subarray;e.Create({name:"HistogramEqualizeFilter",path:n,apply:function(e,n,s){var o=this;if(!o._isOn)return e;var l,u,h,c,f,d,p,_,m,g,y=0,v=255,b=e.length,C=b>>2,O=1/C;for(_=new t(256),g=0;b>g;g+=4)l=e[g],u=e[g+1],h=e[g+2],c=~~(0+.299*l+.587*u+.114*h),f=~~(128-.168736*l-.331264*u+.5*h),d=~~(128+.5*l-.418688*u-.081312*h),d=0>d?0:d>255?255:d,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[g]=d,e[g+1]=c,e[g+2]=f,_[c]+=O,y=i(c,y),v=a(c,v);for(m=0,g=0;256>g;g+=32)m+=_[g],_[g]=m,m+=_[g+1],_[g+1]=m,m+=_[g+2],_[g+2]=m,m+=_[g+3],_[g+3]=m,m+=_[g+4],_[g+4]=m,m+=_[g+5],_[g+5]=m,m+=_[g+6],_[g+6]=m,m+=_[g+7],_[g+7]=m,m+=_[g+8],_[g+8]=m,m+=_[g+9],_[g+9]=m,m+=_[g+10],_[g+10]=m,m+=_[g+11],_[g+11]=m,m+=_[g+12],_[g+12]=m,m+=_[g+13],_[g+13]=m,m+=_[g+14],_[g+14]=m,m+=_[g+15],_[g+15]=m,m+=_[g+16],_[g+16]=m,m+=_[g+17],_[g+17]=m,m+=_[g+18],_[g+18]=m,m+=_[g+19],_[g+19]=m,m+=_[g+20],_[g+20]=m,m+=_[g+21],_[g+21]=m,m+=_[g+22],_[g+22]=m,m+=_[g+23],_[g+23]=m,m+=_[g+24],_[g+24]=m,m+=_[g+25],_[g+25]=m,m+=_[g+26],_[g+26]=m,m+=_[g+27],_[g+27]=m,m+=_[g+28],_[g+28]=m,m+=_[g+29],_[g+29]=m,m+=_[g+30],_[g+30]=m,m+=_[g+31],_[g+31]=m;if(p=y-v,r)for(g=0;b>g;g+=4)c=_[e[g+1]]*p+v,f=e[g+2],d=e[g],l=~~(c+1.402*(d-128)),u=~~(c-.34414*(f-128)-.71414*(d-128)),h=~~(c+1.772*(f-128)),l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,e[g]=l,e[g+1]=u,e[g+2]=h;else for(g=0;b>g;g+=4)c=_[e[g+1]]*p+v,f=e[g+2],d=e[g],l=~~(c+1.402*(d-128)),u=~~(c-.34414*(f-128)-.71414*(d-128)),h=~~(c+1.772*(f-128)),e[g]=l,e[g+1]=u,e[g+2]=h;return e}}),e.Create({name:"GrayscaleHistogramEqualizeFilter",path:n,apply:function(e,n,s){var o=this;if(!o._isOn)return e;var l,u,h,c,f,d,p=0,_=255,m=e.length,g=m>>2,y=1/g;for(c=new t(256),d=0;m>d;d+=4)l=e[d],c[l]+=y,p=i(l,p),_=a(l,_);for(f=0,d=0;256>d;d+=32)f+=c[d],c[d]=f,f+=c[d+1],c[d+1]=f,f+=c[d+2],c[d+2]=f,f+=c[d+3],c[d+3]=f,f+=c[d+4],c[d+4]=f,f+=c[d+5],c[d+5]=f,f+=c[d+6],c[d+6]=f,f+=c[d+7],c[d+7]=f,f+=c[d+8],c[d+8]=f,f+=c[d+9],c[d+9]=f,f+=c[d+10],c[d+10]=f,f+=c[d+11],c[d+11]=f,f+=c[d+12],c[d+12]=f,f+=c[d+13],c[d+13]=f,f+=c[d+14],c[d+14]=f,f+=c[d+15],c[d+15]=f,f+=c[d+16],c[d+16]=f,f+=c[d+17],c[d+17]=f,f+=c[d+18],c[d+18]=f,f+=c[d+19],c[d+19]=f,f+=c[d+20],c[d+20]=f,f+=c[d+21],c[d+21]=f,f+=c[d+22],c[d+22]=f,f+=c[d+23],c[d+23]=f,f+=c[d+24],c[d+24]=f,f+=c[d+25],c[d+25]=f,f+=c[d+26],c[d+26]=f,f+=c[d+27],c[d+27]=f,f+=c[d+28],c[d+28]=f,f+=c[d+29],c[d+29]=f,f+=c[d+30],c[d+30]=f,f+=c[d+31],c[d+31]=f;if(h=p-_,r)for(d=0;m>d;d+=4)l=e[d],u=c[l]*h+_,u=0>u?0:u>255?255:u,u=~~u,e[d]=u,e[d+1]=u,e[d+2]=u;else for(d=0;m>d;d+=4)l=e[d],u=~~(c[l]*h+_),e[d]=u,e[d+1]=u,e[d+2]=u;return e}}),e.Create({name:"RGBHistogramEqualizeFilter",path:n,apply:function(e,n,s){var o=this;if(!o._isOn)return e;var l,u,h,c,f,d,p,_,m,g,y,v,b,C,O,w,M=0,I=0,z=0,Y=255,X=255,x=255,A=e.length,H=A>>2,F=1/H;for(p=new t(256),_=new t(256),m=new t(256),w=0;A>w;w+=4)l=e[w],u=e[w+1],h=e[w+2],p[l]+=F,_[u]+=F,m[h]+=F,M=i(l,M),I=i(u,I),z=i(h,z),Y=a(l,Y),X=a(u,X),x=a(h,x);for(g=y=v=0,w=0;256>w;w+=32)g+=p[w],p[w]=g,g+=p[w+1],p[w+1]=g,g+=p[w+2],p[w+2]=g,g+=p[w+3],p[w+3]=g,g+=p[w+4],p[w+4]=g,g+=p[w+5],p[w+5]=g,g+=p[w+6],p[w+6]=g,g+=p[w+7],p[w+7]=g,g+=p[w+8],p[w+8]=g,g+=p[w+9],p[w+9]=g,g+=p[w+10],p[w+10]=g,g+=p[w+11],p[w+11]=g,g+=p[w+12],p[w+12]=g,g+=p[w+13],p[w+13]=g,g+=p[w+14],p[w+14]=g,g+=p[w+15],p[w+15]=g,g+=p[w+16],p[w+16]=g,g+=p[w+17],p[w+17]=g,g+=p[w+18],p[w+18]=g,g+=p[w+19],p[w+19]=g,g+=p[w+20],p[w+20]=g,g+=p[w+21],p[w+21]=g,g+=p[w+22],p[w+22]=g,g+=p[w+23],p[w+23]=g,g+=p[w+24],p[w+24]=g,g+=p[w+25],p[w+25]=g,g+=p[w+26],p[w+26]=g,g+=p[w+27],p[w+27]=g,g+=p[w+28],p[w+28]=g,g+=p[w+29],p[w+29]=g,g+=p[w+30],p[w+30]=g,g+=p[w+31],p[w+31]=g,y+=_[w],_[w]=y,y+=_[w+1],_[w+1]=y,y+=_[w+2],_[w+2]=y,y+=_[w+3],_[w+3]=y,y+=_[w+4],_[w+4]=y,y+=_[w+5],_[w+5]=y,y+=_[w+6],_[w+6]=y,y+=_[w+7],_[w+7]=y,y+=_[w+8],_[w+8]=y,y+=_[w+9],_[w+9]=y,y+=_[w+10],_[w+10]=y,y+=_[w+11],_[w+11]=y,y+=_[w+12],_[w+12]=y,y+=_[w+13],_[w+13]=y,y+=_[w+14],_[w+14]=y,y+=_[w+15],_[w+15]=y,y+=_[w+16],_[w+16]=y,y+=_[w+17],_[w+17]=y,y+=_[w+18],_[w+18]=y,y+=_[w+19],_[w+19]=y,y+=_[w+20],_[w+20]=y,y+=_[w+21],_[w+21]=y,y+=_[w+22],_[w+22]=y,y+=_[w+23],_[w+23]=y,y+=_[w+24],_[w+24]=y,y+=_[w+25],_[w+25]=y,y+=_[w+26],_[w+26]=y,y+=_[w+27],_[w+27]=y,y+=_[w+28],_[w+28]=y,y+=_[w+29],_[w+29]=y,y+=_[w+30],_[w+30]=y,y+=_[w+31],_[w+31]=y,v+=m[w],m[w]=v,v+=m[w+1],m[w+1]=v,v+=m[w+2],m[w+2]=v,v+=m[w+3],m[w+3]=v,v+=m[w+4],m[w+4]=v,v+=m[w+5],m[w+5]=v,v+=m[w+6],m[w+6]=v,v+=m[w+7],m[w+7]=v,v+=m[w+8],m[w+8]=v,v+=m[w+9],m[w+9]=v,v+=m[w+10],m[w+10]=v,v+=m[w+11],m[w+11]=v,v+=m[w+12],m[w+12]=v,v+=m[w+13],m[w+13]=v,v+=m[w+14],m[w+14]=v,v+=m[w+15],m[w+15]=v,v+=m[w+16],m[w+16]=v,v+=m[w+17],m[w+17]=v,v+=m[w+18],m[w+18]=v,v+=m[w+19],m[w+19]=v,v+=m[w+20],m[w+20]=v,v+=m[w+21],m[w+21]=v,v+=m[w+22],m[w+22]=v,v+=m[w+23],m[w+23]=v,v+=m[w+24],m[w+24]=v,v+=m[w+25],m[w+25]=v,v+=m[w+26],m[w+26]=v,v+=m[w+27],m[w+27]=v,v+=m[w+28],m[w+28]=v,v+=m[w+29],m[w+29]=v,v+=m[w+30],m[w+30]=v,v+=m[w+31],m[w+31]=v;if(c=M-Y,f=I-X,d=z-x,r)for(w=0;A>w;w+=4)l=e[w],u=e[w+1],h=e[w+2],b=p[l]*c+Y,C=_[u]*f+X,O=m[h]*d+x,b=0>b?0:b>255?255:b,C=0>C?0:C>255?255:C,O=0>O?0:O>255?255:O,e[w]=~~b,e[w+1]=~~C,e[w+2]=~~O;else for(w=0;A>w;w+=4)l=e[w],u=e[w+1],h=e[w+2],b=p[l]*c+Y,C=_[u]*f+X,O=m[h]*d+x,e[w]=~~b,e[w+1]=~~C,e[w+2]=~~O;return e}})}(r),!function(e){var r=Math.sqrt,t=e._notSupportClamp,a=e.Array32F;e.Create({name:"PixelateFilter",scale:1,init:function(e){var r=this;r.scale=e||1},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.scale=r.scale),n},apply:function(e,n,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,h,c,f,d,p,_,m,g,y,v,b,C,O,w,M,I,z,Y,X,x,A,H,F,k,N,L,S,q,U,E,R,P,T,D,G,$,j,W,B,V,Q,J,K,Z=e.length,ee=Z>>>2,re=(n<<1)+n;for(o=~~(r(ee)*s.scale*.01),l=n*o,u=i%o,h=n%o,c=(u-1)*n,_=1/(o*o),m=1/(h*o),g=1/(u*o),y=1/(h*u),v=_,b=m,C=g,O=y,Y=o-1,X=(o-1)*n,T=0,G=n-1,D=0,$=ee-n,w=new a(3*ee),x=0,A=0,H=0,M=I=z=0,H=0;n>H;H++,x+=4,A+=3)M+=e[x],I+=e[x+1],z+=e[x+2],w[A]=M,w[A+1]=I,w[A+2]=z;for(A=0,H=0,M=I=z=0,x=re+n;Z>x;x+=4,A+=3,H++)H>=n&&(H=0,M=I=z=0),M+=e[x],I+=e[x+1],z+=e[x+2],w[A+re]=w[A]+M,w[A+re+1]=w[A+1]+I,w[A+re+2]=w[A+2]+z;for(H=0,F=0,k=0,U=H,E=k,R=U+Y,P=E+X,R=R>G?G:R,P=P>$?$:P,j=U+E,V=R+P,W=R+E,B=U+P,j=(j<<1)+j,W=(W<<1)+W,B=(B<<1)+B,V=(V<<1)+V,p=v,Q=p*(w[V]-w[W]-w[B]+w[j]),J=p*(w[V+1]-w[W+1]-w[B+1]+w[j+1]),K=p*(w[V+2]-w[W+2]-w[B+2]+w[j+2]),t&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K,N=0,L=0,S=0,x=0;Z>x;x+=4)q=N+H+S+k<<2,e[q]=Q,e[q+1]=J,e[q+2]=K,N++,(N+H>=n||N>=o)&&(N=0,L++,S+=n),(L+F>=i||L>=o)&&(H+=o,H>=n&&(H=0,F+=o,k+=l),N=0,L=0,S=0,U=H,E=k,R=U+Y,P=E+X,R=R>G?G:R,P=P>$?$:P,j=U+E,V=R+P,W=R+E,B=U+P,j=(j<<1)+j,W=(W<<1)+W,B=(B<<1)+B,V=(V<<1)+V,f=h+U===R+1,d=c+E===P,p=f&&d?O:f?b:d?C:v,Q=p*(w[V]-w[W]-w[B]+w[j]),J=p*(w[V+1]-w[W+1]-w[B+1]+w[j+1]),K=p*(w[V+2]-w[W+2]-w[B+2]+w[j+2]),t&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K);return e}})}(r),!function(e){var r=Math.sqrt,t=(Math.SQRT2,Math.min,e._notSupportClamp),a=e.Array32F;e.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var r=this;r.scale=e||1},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.scale=r.scale),n},apply:function(e,n,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,h,c,f,d,p,_,m,g,y,v,b,C,O,w,M,I,z,Y,X,x,A,H,F,k,N,L,S,q,U,E,R,P,T,D,G,$,j,W,B,V,Q,J,K,Z,ee,re,ne,te,ae=e.length,ie=ae>>>2,se=(n<<1)+n;for(o=~~(r(ie)*s.scale*.01),l=o>>1,u=o-1,h=n*o,c=i%o,f=n%o,d=(c-1)*n,g=1/(o*o),y=1/(f*o),v=1/(c*o),b=1/(f*c),C=2*g,O=2*y,w=2*v,M=2*b,x=u,A=u*n,P=0,D=n-1,T=0,G=ie-n,I=new a(3*ie),H=0,F=0,k=0,z=Y=X=0,k=0;n>k;k++,H+=4,F+=3)z+=e[H],Y+=e[H+1],X+=e[H+2],I[F]=z,I[F+1]=Y,I[F+2]=X;for(F=0,k=0,z=Y=X=0,H=se+n;ae>H;H+=4,F+=3,k++)k>=n&&(k=0,z=Y=X=0),z+=e[H],Y+=e[H+1],X+=e[H+2],I[F+se]=I[F]+z,I[F+se+1]=I[F+1]+Y,I[F+se+2]=I[F+2]+X;for(k=0,N=0,q=k,U=N,E=k-l+x,R=N+A,E=E>D?D:E,R=R>G?G:R,$=q+U,B=E+R,j=E+U,W=q+R,$=($<<1)+$,j=(j<<1)+j,W=(W<<1)+W,B=(B<<1)+B,m=C,K=m*(I[B]-I[j]-I[W]+I[$]),Z=m*(I[B+1]-I[j+1]-I[W+1]+I[$+1]),ee=m*(I[B+2]-I[j+2]-I[W+2]+I[$+2]),q=k+l,E=k+x,E=E>D?D:E,$=q+U,B=E+R,j=E+U,W=q+R,$=($<<1)+$,j=(j<<1)+j,W=(W<<1)+W,B=(B<<1)+B,re=m*(I[B]-I[j]-I[W]+I[$]),ne=m*(I[B+1]-I[j+1]-I[W+1]+I[$+1]),te=m*(I[B+2]-I[j+2]-I[W+2]+I[$+2]),t&&(K=0>K?0:K>255?255:K,Z=0>Z?0:Z>255?255:Z,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,te=0>te?0:te>255?255:te),K=~~K,Z=~~Z,ee=~~ee,re=~~re,ne=~~ne,te=~~te,V=K,Q=Z,J=ee,L=0,S=0,H=0;ae>H;H+=4)e[H]=V,e[H+1]=Q,e[H+2]=J,k++,L++,k>=n&&(L=0,k=0,S++,N+=n,S>=o&&(S=0)),L>=o&&(L=0),0===L&&(q=k,U=N,E=k-l+x,R=N+A,E=E>D?D:E,R=R>G?G:R,$=q+U,B=E+R,j=E+U,W=q+R,$=($<<1)+$,j=(j<<1)+j,W=(W<<1)+W,B=(B<<1)+B,p=f+q===E+l+1,_=U+d===R,m=p&&_?M:p?O:_?w:C,K=m*(I[B]-I[j]-I[W]+I[$]),Z=m*(I[B+1]-I[j+1]-I[W+1]+I[$+1]),ee=m*(I[B+2]-I[j+2]-I[W+2]+I[$+2]),q=k+l,E=k+x,E=E>D?D:E,$=q+U,B=E+R,j=E+U,W=q+R,$=($<<1)+$,j=(j<<1)+j,W=(W<<1)+W,B=(B<<1)+B,p=f+q===E+l+1,m=p&&_?M:p?O:_?w:C,re=m*(I[B]-I[j]-I[W]+I[$]),ne=m*(I[B+1]-I[j+1]-I[W+1]+I[$+1]),te=m*(I[B+2]-I[j+2]-I[W+2]+I[$+2]),t&&(K=0>K?0:K>255?255:K,Z=0>Z?0:Z>255?255:Z,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,te=0>te?0:te>255?255:te),K=~~K,Z=~~Z,ee=~~ee,re=~~re,ne=~~ne,te=~~te,V=K,Q=Z,J=ee),L+S>u&&(V=re,Q=ne,J=te);return e}})}(r),!function(e,r){var t=7/16,a=3/16,i=5/16,s=1/16,o=e.Array32F,l=e.Color.clamp,u=e.Color.RGB2YCbCr,h=e.Color.YCbCr2RGB;e.Create({name:"HalftoneFilter",_threshold:.4,_size:1,_grayscale:!1,init:function(e,n,t){var a=this;a._size=e||1,a._threshold=l(r===n?.4:n,0,1),a._grayscale=!!t},path:n,size:function(e){return this._size=e,this},threshold:function(e){return this._threshold=l(e,0,1),this},grayscale:function(e){return arguments.length||(e=!0),this._grayscale=!!e,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_size:e._size,_threshold:e._threshold,_grayscale:e._grayscale}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n._size=r._size,n._threshold=r._threshold,n._grayscale=r._grayscale),n},apply:function(e,r,n){var c,f,d,p,_,m,g,y,v,b,C,O,w,M,I,z,Y,X=this,x=e.length,A=x>>>2,H=new o(3*A),F=X._size,k=F*F,N=1/k,L=255*X._threshold,S=S<<1,q=!X._grayscale,U=F*r,E=t,R=a,P=i,T=s;for(g=0,y=0,m=0;n>g;){for(O=w=M=0,v=0,b=0,C=0;F>b;)c=m+y+v+C<<2,f=3*(m+y+v+C),O+=e[c]+H[f],w+=e[c+1]+H[f+1],M+=e[c+2]+H[f+2],v++,v>=F&&(v=0,b++,C+=r);if(O*=N,w*=N,M*=N,_=q?u([O,w,M]):[O,w,M],d=_[0],d>L?q?(_[0]=l(~~d,0,255),p=h(_)):p=[255,255,255]:p=[0,0,0],c=m+y<<2,I=e[c]-p[0],z=e[c+1]-p[1],Y=e[c+2]-p[2],r>m+F)for(v=F,b=0,C=0;F>b;)f=3*(m+y+v+C),H[f]+=E*I,H[f+1]+=E*z,H[f+2]+=E*Y,v++,v>=S&&(v=F,b++,C+=r);if(n>g+F&&m>F)for(v=-F,b=F,C=0;S>b;)f=3*(m+y+v+C),H[f]+=R*I,H[f+1]+=R*z,H[f+2]+=R*Y,v++,v>=0&&(v=-F,b++,C+=r);if(n>g+F)for(v=0,b=F,C=0;S>b;)f=3*(m+y+v+C),H[f]+=P*I,H[f+1]+=P*z,H[f+2]+=P*Y,v++,v>=F&&(v=0,b++,C+=r);if(n>g+F&&r>m+F)for(v=F,b=F,C=0;S>b;)f=3*(m+y+v+C),H[f]+=T*I,H[f+1]+=T*z,H[f+2]+=T*Y,v++,v>=S&&(v=F,b++,C+=r);for(v=0,b=0,C=0;F>b;)c=m+y+v+C<<2,e[c]=p[0],e[c+1]=p[1],e[c+2]=p[2],v++,v>=F&&(v=0,b++,C+=r);m+=F,m>=r&&(m=0,g+=F,y+=U)}return e}})}(r),!function(e,r){var t="hasOwnProperty",a=Math.min,i=Math.round,s=e._notSupportClamp,o=e.Color.Combine;e.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendImage:null,startX:0,startY:0,path:n,init:function(e,r){var n=this;n.startX=0,n.startY=0,n._blendImage=null,n.blendImage=null,n._blendMode=null,e&&n.setImage(e),r&&n.setMode(r)},dispose:function(){var e=this;return e.blendImage=null,e._blendImage=null,e._blendMode=null,e.$super("dispose"),e},setImage:function(e){var r=this;return e&&(r.blendImage=e,r._blendImage=null),r},setMode:function(e){var r=this;return e?(r._blendMode=(""+e).toLowerCase(),o[t](r._blendMode)||(r._blendMode=null)):r._blendMode=null,r},serialize:function(){var e=this,r=e.blendImage;return{filter:e.name,_isOn:!!e._isOn,params:{_blendImage:e._blendImage||(r?{data:r.getData(),width:r.width,height:r.height}:null),_blendMode:e._blendMode,startX:e.startX,startY:e.startY}}},unserialize:function(r){var n,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,n=r.params,t.startX=n.startX,t.startY=n.startY,t.blendImage=null,t._blendImage=n._blendImage,t._blendImage&&(t._blendImage.data=e.Util.Array.typed(t._blendImage.data,e.ImArray)),t.setMode(n._blendMode)),t},reset:function(){var e=this;return e.startX=0,e.startY=0,e._blendMode=null,e},apply:function(e,r,n){var t=this,l=t.blendImage;if(!t._isOn||!t._blendMode||!l&&!t._blendImage)return e;var u,h,c,f,d,p,_,m,g,y,v,b,C,O,w=t._blendImage||{data:l.getData(),width:l.width,height:l.height},M=t.startX||0,I=t.startY||0,z=0,Y=0,X=o[t._blendMode];if(0>M&&(z=-M,M=0),0>I&&(Y=-I,I=0),f=w.width,d=w.height,M>=r||I>=n)return e;if(z>=f||Y>=d)return e;if(M=i(M),I=i(I),z=i(z),Y=i(Y),u=a(r-M,f-z),h=a(n-I,d-Y),0>=u||0>=h)return e;for(c=w.data,y=M,v=I*r,b=z,C=Y*f,p=M+u,_=z+u,m=0,g=h*u;g>m;)O=b+C<<2,c[O+3]&&X(e,c,y+v<<2,O,s),m++,y++,y>=p&&(y=M,v+=r),b++,b>=_&&(b=z,C+=f);return e}})}(r),!function(e,r){var t=e.ImArray,a=e.Util.Filter.integral_convolution,i=new e.Array32F([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]);e.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:3,path:n,init:function(e,r,n,t,a){var i=this;i.offsetX=e||0,i.offsetY=r||0,i.color=n||0,i.opacity=null==t?1:+t,i.quality=a||3},dispose:function(){var e=this;return e.offsetX=null,e.offsetY=null,e.color=null,e.opacity=null,e.quality=null,e.$super("dispose"),e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{offsetX:e.offsetX,offsetY:e.offsetY,color:e.color,opacity:e.opacity,quality:e.quality}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.offsetX=r.offsetX,n.offsetY=r.offsetY,n.color=r.color,n.opacity=r.opacity,n.quality=r.quality),n},apply:function(e,r,n){var s=this;if(!s._isOn)return e;var o,l,u,h,c,f,d,p,_=s.color||0,m=~~s.quality,g=s.offsetX||0,y=s.offsetY||0,v=s.opacity,b=_>>>16&255,C=_>>>8&255,O=255&_,w=e.length,M=w>>>2;if(0>v&&(v=0),v>1&&(v=1),0===v)return e;for(0>=m&&(m=1),m>3&&(m=3),p=new t(w),o=0;w>o;o+=4)d=e[o+3],d>0?(p[o]=b,p[o+1]=C,p[o+2]=O,p[o+3]=~~(v*d)):(p[o]=0,p[o+1]=0,p[o+2]=0,p[o+3]=0);for(p=a(!1,p,r,n,i,null,3,3,1,0,m),y*=r,l=0,u=0,f=0;w>f;f+=4,l++)l>=r&&(l=0,u+=r),h=l+g,c=u+y,0>h||h>=r||0>c||c>=M||(o=h+c<<2,d=e[o+3],v=p[f+3],255!==d&&0!==v&&(v/=255,b=~~(e[o]+(p[f]-e[o])*v),C=~~(e[o+1]+(p[f+1]-e[o+1])*v),O=~~(e[o+2]+(p[f+2]-e[o+2])*v),e[o]=b,e[o+1]=C,e[o+2]=O));return e}})}(r),!function(e){var r=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=e._notSupportClamp,s=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,r,n,t){var a=this;a.centerX=e||0,a.centerY=r||0,a.radius=n||10,a.amount=t||10},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.centerX=r.centerX,n.centerY=r.centerY,n.radius=r.radius,n.amount=r.amount),n},apply:function(e,n,o){var l=this;if(!l._isOn)return e;var u,h,c,f,d,p,_,m,g,y,v,b,C,O,w,M,I,z,Y,X,x,A,H,F,k,N,L,S,q,U,E,R,P,T=e.length,D=l.centerX||0,G=l.centerY||0,$=l.radius,j=l.amount;if(0>=j)return e;for(u=T>>2,U=0,E=n-1,R=0,P=u-n,D=a(D*(n-1)),G=a(G*(o-1)),c=(u<<1)+u,_=(n<<1)+n,h=new s(c),m=0,g=0,y=0,f=d=p=0,y=0;n>y;y++,m+=4,g+=3)f+=e[m],d+=e[m+1],p+=e[m+2],h[g]=f,h[g+1]=d,h[g+2]=p;for(m=_+n,g=0,y=0,f=d=p=0,m=_+n;T>m;m+=4,g+=3,y++)y>=n&&(y=0,f=d=p=0),f+=e[m],d+=e[m+1],p+=e[m+2],h[g+_]=h[g]+f,h[g+_+1]=h[g+1]+d,h[g+_+2]=h[g+2]+p;for(y=0,v=0,b=0,m=0;T>m;m+=4,y++)y>=n&&(y=0,v++,b+=n),O=y-D,w=v-G,C=t(O)+t(w),M=C>$?~~r((C-$)*j):~~(C/$+.5),M>0&&(I=M*n,z=.25/(M*M),Y=y-M,X=b-I,x=y+M,A=b+I,U>Y?Y=U:x>E&&(x=E),R>X?X=R:A>P&&(A=P),H=Y+X,N=x+A,F=x+X,k=Y+A,H=(H<<1)+H,F=(F<<1)+F,k=(k<<1)+k,N=(N<<1)+N,L=z*(h[N]-h[F]-h[k]+h[H]),S=z*(h[N+1]-h[F+1]-h[k+1]+h[H+1]),q=z*(h[N+2]-h[F+2]-h[k+2]+h[H+2]),i&&(L=0>L?0:L>255?255:L,S=0>S?0:S>255?255:S,q=0>q?0:q>255?255:q),e[m]=~~L,e[m+1]=~~S,e[m+2]=~~q);return e}})}(r),!function(e){e.Create({name:"SeamlessTileFilter",type:0,init:function(e){var r=this;r.type=e||0},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{type:e.type}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.type=r.type),n},apply:function(r,n,t){var a,i,s,o,l,u,h,c,f,d,p,_,m,g,y,v=this,b=v.type,C=e.Interpolation.bilinear,O=e.ImArray,w=Math.sqrt;for(n!==t?r=C(r,n,t,_=n>t?n:t,_):_=n,m=Math.round(_/2),g=_*_,y=r.length,a=new O(y),i=new O(y),s=new e.Array8U(g),c=0,f=0,d=0;y>d;d+=4,c++)c>=_&&(c=0,f++),p=(c+m)%_+(f+m)%_*_<<2,a[p]=r[d],a[p+1]=r[d+1],a[p+2]=r[d+2],a[p+3]=r[d+3];for(c=0,f=0;m>c;f++){switch(f>=m&&(f=0,c++),b){case 0:h=w((c-m)*(c-m)+(f-m)*(f-m))/m;break;case 1:h=m-f>m-c?(f-m)/m:(c-_/2)/m;break;case 2:default:h=m-f>m-c?w((f-_)*(f-_)+(c-_)*(c-_))/(1.13*_):w((c-_)*(c-_)+(f-_)*(f-_))/(1.13*_)}h=255-255*h,1>h?h=1:h>255&&(h=255),s[c+f*_]=h,s[c+(_-1-f)*_]=h,s[_-1-c+f*_]=h,s[_-1-c+(_-1-f)*_]=h}for(f=0,c=0;_>f;c++)c>=_&&(c=0,f++),p=c+f*_,o=s[p],l=s[(c+m)%_+(f+m)%_*_],u=o+l,o/=u,l/=u,p<<=2,i[p]=~~(o*r[p]+l*a[p]),i[p+1]=~~(o*r[p+1]+l*a[p+1]),i[p+2]=~~(o*r[p+2]+l*a[p+2]),i[p+3]=r[p+3];return n!==t&&(i=C(i,_,_,n,t)),i}})}(r),!function(e){var r=e.Util.Array.typed,t=Math.abs,a=(Math.min,Math.max,Math.ceil),i=e.MODE.TILE,s=e.MODE.STRETCH,o=e.Array8U,l=e.Array32U;e.Create({name:"FloodFillFilter",x:0,y:0,color:null,borderColor:null,tolerance:0,path:n,init:function(e,r,n,t,a){var i=this;i.x=e||0,i.y=r||0,i.color=n||0,i.tolerance=t||0,i.borderColor=a===+a?+a:null},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{color:e.color,borderColor:e.borderColor,x:e.x,y:e.y,tolerance:e.tolerance}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.color=r.color,n.borderColor=r.borderColor,n.x=r.x,n.y=r.y,n.tolerance=r.tolerance),n},apply:function(e,r,n){var a,i,s,l,u,h,c,f,d,p,_,m,g=this,y=~~(255*(g.tolerance>=1?.999:g.tolerance)),v=g.color||0,b=g.borderColor,C=b===+b,O=r<<2,w=g.x,M=g.y,I=e.length,z=0,Y=I-O,X=0,x=r-1<<2;if(f=M*r<<2,w<<=2,X>w||w>x||z>f||f>Y)return e;if(a=new o(3),i=new o(3),i[0]=v>>>16&255,i[1]=v>>>8&255,i[2]=255&v,C){if(a[0]=b>>>16&255,a[1]=b>>>8&255,a[2]=255&b,t(a[0]-e[w+f])<=y&&t(a[1]-e[w+f+1])<=y&&t(a[2]-e[w+f+2])<=y)return e}else{if(e[w+f]===i[0]&&e[w+f+1]===i[1]&&e[w+f+2]===i[2])return e;a[0]=e[w+f],a[1]=e[w+f+1],a[2]=e[w+f+2]}for(d=new Array(I>>>2),p=0,f+O>=z&&Y>=f+O&&(d[p++]=[f,w,w,O]),d[p++]=[f+O,w,w,-O];p>0;){if(_=d[--p],f=_[0]+(O=_[3]),h=_[1],c=_[2],C)for(u=h;u>=X&&(l=u+f,!(t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y));u-=4)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];else for(u=h;u>=X&&(l=u+f,t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y);u-=4)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];if(u>=h){if(l=u+f,C)for(;c>=u&&t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y;)u+=4,l=u+f;else for(;c>=u&&!(t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y);)u+=4,l=u+f;s=u,m=c>=u}else s=u+4,h>s&&f-O>=z&&Y>=f-O&&(d[p++]=[f,s,h-4,-O]),u=h+4,m=!0;for(;m;){if(l=u+f,C)for(;x>=u&&!(t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y);)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],u+=4,l=u+f;else for(;x>=u&&t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y;)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],u+=4,l=u+f;if(f+O>=z&&Y>=f+O&&(d[p++]=[f,s,u-4,O]),u>c+4&&f-O>=z&&Y>=f-O&&(d[p++]=[f,c+4,u-4,-O]),l=u+f,C)for(;c>=u&&t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y;)u+=4,l=u+f;else for(;c>=u&&!(t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y);)u+=4,l=u+f;s=u,m=c>=u}}return e}}),e.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:0,pattern:null,_pattern:null,mode:i,borderColor:null,path:n,init:function(e,r,n,t,a,s,o,l){var u=this;u.x=e||0,u.y=r||0,u.offsetX=t||0,u.offsetY=a||0,n&&u.setPattern(n),u.mode=s||i,u.tolerance=o||0,u.borderColor=l===+l?+l:null},dispose:function(){var e=this;return e.pattern=null,e._pattern=null,e.x=null,e.y=null,e.offsetX=null,e.offsetY=null,e.tolerance=null,e.mode=null,e.borderColor=null,e.$super("dispose"),e},setPattern:function(e){var r=this;return e&&(r.pattern=e,r._pattern=null),r},serialize:function(){var e=this,r=e.pattern;return{filter:e.name,_isOn:!!e._isOn,params:{x:e.x,y:e.y,offsetX:e.offsetX,offsetY:e.offsetY,tolerance:e.tolerance,mode:e.mode,borderColor:e.borderColor,_pattern:e._pattern||(r?{data:r.getData(),width:r.width,height:r.height}:null)}}},unserialize:function(n){var t,a=this;return n&&a.name===n.filter&&(a._isOn=!!n._isOn,t=n.params,a.x=t.x,a.y=t.y,a.offsetX=t.offsetX,a.offsetY=t.offsetY,a.tolerance=t.tolerance,a.mode=t.mode,a.borderColor=t.borderColor,a.pattern=null,a._pattern=t._pattern,a._pattern&&(a._pattern.data=r(a._pattern.data,e.ImArray))),a},apply:function(e,r,n){var i=this,u=i.pattern;if(!i._isOn||!u&&!i._pattern)return e;var h,c,f,d,p,_,m,g,y,v,b,C,O,w,M,I,z=i._pattern||{data:u.getData(),width:u.width,height:u.height},Y=~~(255*(i.tolerance>=1?.999:i.tolerance)),X=i.mode,x=i.borderColor,A=x===+x,H=r<<2,F=z.data,k=z.width,N=z.height,L=i.x,S=i.y,q=i.offsetX||0,U=i.offsetY||0,E=e.length,R=E>>>2,P=0,T=E-H,D=0,G=r-1<<2;if(0>q&&(q+=k),0>U&&(U+=N),p=S,g=S*r<<2,L<<=2,D>L||L>G||P>g||g>T)return e;if(h=new o(3),A){if(h[0]=x>>>16&255,h[1]=x>>>8&255,h[2]=255&x,t(h[0]-e[L+g])<=Y&&t(h[1]-e[L+g+1])<=Y&&t(h[2]-e[L+g+2])<=Y)return e}else h[0]=e[L+g],h[1]=e[L+g+1],h[2]=e[L+g+2];for(C=new Array(R),O=0,w=new l(a(R/32)),g+H>=P&&T>=g+H&&(C[O++]=[g,L,L,H,p+1]),C[O++]=[g+H,L,L,-H,p];O>0;){if(M=C[--O],g=M[0]+(H=M[3]),_=M[1],m=M[2],p=M[4],A)for(d=_;d>=D&&(f=d+g,!(w[f>>>7]&1<<(f>>>2&31)||t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y));d-=4)w[f>>>7]|=1<<(f>>>2&31),s===X?(v=~~(k*(d>>>2)/r),b=~~(N*p/n)):(v=((d>>>2)+q)%k,b=(p+U)%N),y=v+b*k<<2,e[f]=F[y],e[f+1]=F[y+1],e[f+2]=F[y+2];else for(d=_;d>=D&&(f=d+g,!(w[f>>>7]&1<<(f>>>2&31))&&t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y);d-=4)w[f>>>7]|=1<<(f>>>2&31),s===X?(v=~~(k*(d>>>2)/r),b=~~(N*p/n)):(v=((d>>>2)+q)%k,b=(p+U)%N),y=v+b*k<<2,e[f]=F[y],e[f+1]=F[y+1],e[f+2]=F[y+2];if(d>=_){if(f=d+g,A)for(;m>=d&&w[f>>>7]&1<<(f>>>2&31)||t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y;)d+=4,f=d+g;else for(;m>=d&&!(!(w[f>>>7]&1<<(f>>>2&31))&&t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y);)d+=4,f=d+g;c=d,I=m>=d}else c=d+4,_>c&&g-H>=P&&T>=g-H&&(C[O++]=[g,c,_-4,-H,H>0?p-1:p+1]),d=_+4,I=!0;for(;I;){if(f=d+g,A)for(;G>=d&&!(w[f>>>7]&1<<(f>>>2&31))&&!(t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y);)w[f>>>7]|=1<<(f>>>2&31),s===X?(v=~~(k*(d>>>2)/r),b=~~(N*p/n)):(v=((d>>>2)+q)%k,b=(p+U)%N),y=v+b*k<<2,e[f]=F[y],e[f+1]=F[y+1],e[f+2]=F[y+2],d+=4,f=d+g;else for(;G>=d&&!(w[f>>>7]&1<<(f>>>2&31))&&t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y;)w[f>>>7]|=1<<(f>>>2&31),s===X?(v=~~(k*(d>>>2)/r),b=~~(N*p/n)):(v=((d>>>2)+q)%k,b=(p+U)%N),y=v+b*k<<2,e[f]=F[y],e[f+1]=F[y+1],e[f+2]=F[y+2],d+=4,f=d+g;if(g+H>=P&&T>=g+H&&(C[O++]=[g,c,d-4,H,H>0?p+1:p-1]),d>m+4&&g-H>=P&&T>=g-H&&(C[O++]=[g,m+4,d-4,-H,H>0?p-1:p+1]),f=d+g,A)for(;m>=d&&w[f>>>7]&1<<(f>>>2&31)||t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y;)d+=4,f=d+g;else for(;m>=d&&!(!(w[f>>>7]&1<<(f>>>2&31))&&t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y);)d+=4,f=d+g;c=d,I=m>=d}}return e}})}(r),!function(e){var r=e._notSupportClamp,t=e.Color.RGB2HSV,a=e.Util.Array.subarray;e.Create({name:"HSVConverterFilter",path:n,apply:function(e,n,i){var s=this;if(!s._isOn)return e;var o,l,u,h,c,f=e.length;if(r)for(o=0;f>o;o+=4)l=t(a(e,o,o+3)),u=.7083333333333334*l[0],c=255*l[1],h=l[2],u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,e[o]=~~u,e[o+1]=~~h,e[o+2]=~~c;else for(o=0;f>o;o+=4)l=t(a(e,o,o+3)),u=.7083333333333334*l[0],c=255*l[1],h=l[2],e[o]=~~u,e[o+1]=~~h,e[o+2]=~~c;return e}})}(r),!function(e){var r=e.Util.Array.typed,t=e.Color.hue;e.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,asHue:!1,init:function(e,r,n){var t=this;t.thresholds=e,t.quantizedColors=r||null,
t.asHue=!!n},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{thresholds:e.thresholds,quantizedColors:e.quantizedColors,asHue:e.asHue}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.thresholds=r(n.thresholds,Array),t.quantizedColors=r(n.quantizedColors,Array),t.asHue=n.asHue),t},apply:function(e,r,n){var a=this;if(!(a._isOn&&a.thresholds&&a.thresholds.length&&a.quantizedColors&&a.quantizedColors.length))return e;var i,s,o,l,u=e.length,h=a.thresholds,c=h.length,f=a.quantizedColors,d=f.length;if(a.asHue){for(o=0;u>o;o+=4)if(0!==e[o+3]){for(s=t(e[o],e[o+1],e[o+2]),l=0;c>l&&s>h[l];)l++;i=d>l?f[l]:16777215,e[o]=i>>>16&255,e[o+1]=i>>>8&255,e[o+2]=255&i}}else for(o=0;u>o;o+=4)if(0!==e[o+3]){for(i=e[o]<<16|e[o+1]<<8|255&e[o+2],l=0;c>l&&i>h[l];)l++;i=d>l?f[l]:16777215,e[o]=i>>>16&255,e[o+1]=i>>>8&255,e[o+2]=255&i}return e}})}(r),!function(e){var r=e.Color.hue;e.Create({name:"HueExtractorFilter",minHue:0,maxHue:360,background:0,init:function(e,r,n){var t=this;t.minHue=e,t.maxHue=r,t.background=n||0},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{minHue:e.minHue,maxHue:e.maxHue,background:e.background||0}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.minHue=r.minHue,n.maxHue=r.maxHue,n.background=r.background||0),n},apply:function(e,n,t){var a=this;if(!a._isOn)return e;var i,s,o,l,u,h,c=a.background||0,f=e.length,d=a.minHue,p=a.maxHue;for(i=c>>>16&255,s=c>>>8&255,o=255&c,l=c>>>24&255,u=0;f>u;u+=4)h=r(e[u],e[u+1],e[u+2]),(d>h||h>p)&&(e[u]=i,e[u+1]=s,e[u+2]=o,e[u+3]=l);return e}})}(r),!function(e){function r(e,r,n,t,a,i){var s,o,h,y,v,b=e.length,C=new u(b),O=new u(b),w=new u(b),M=new u(b),I=new u(i),z=new u(i),Y=a*a,X=2*Y,x=_*Y;for(s=0;i>s&&(o=g(-(s*s)/X),!(c>=o&&s>=2));s++)h=g(-((v=s-.5)*v)/X),y=g(-((v=s+.5)*v)/X),I[s]=(o+h+y)/3/x,z[s]=y-h;var v,A,H,F,k,N,L,S,q,U=s-1,E=r-(s-1),R=r*(s-1),P=r*(n-(s-1));for(v=U;E>v;v++)for(A=R;P>A;A+=r){for(H=v+A,F=e[H]*I[0],k=F,N=1,L=r;s>N;)k+=I[N]*(e[H-L]+e[H+L]),F+=I[N]*(e[H-N]+e[H+N]),L+=r,N++;O[H]=k,C[H]=F}for(v=U;E>v;v++)for(A=R;P>A;A+=r){for(S=0,H=v+A,q=1;s>q;q++)S+=z[q]*(O[H-q]-O[H+q]);w[H]=S}for(v=s;r-s>v;v++)for(A=R;P>A;A+=r){for(S=0,H=v+A,L=r,q=1;s>q;q++)S+=z[q]*(C[H-L]-C[H+L]),L+=r;M[H]=S}U=s,E=r-s,R=r*s,P=r*(n-s);var T,D,G,$,j,W,B,V,Q,J,K,Z,ee,re,ne,te,ae,ie,se,oe;for(v=U;E>v;v++)for(A=R;P>A;A+=r)H=v+A,T=H-r,D=H+r,$=H-1,G=H+1,j=T-1,W=T+1,B=D-1,V=D+1,Q=w[H],J=M[H],K=l(Q,J),ee=l(w[T],M[T]),re=l(w[D],M[D]),te=l(w[$],M[$]),ne=l(w[G],M[G]),ie=l(w[W],M[W]),oe=l(w[V],M[V]),se=l(w[B],M[B]),ae=l(w[j],M[j]),(0>=Q*J?m(Q)>=m(J)?(Z=m(Q*K))>=m(J*ie-(Q+J)*ne)&&Z>m(J*se-(Q+J)*te):(Z=m(J*K))>=m(Q*ie-(J+Q)*ee)&&Z>m(Q*se-(J+Q)*re):m(Q)>=Math.abs(J)?(Z=m(Q*K))>=m(J*oe+(Q-J)*ne)&&Z>m(J*ae+(Q-J)*te):(Z=m(J*K))>=m(Q*oe+(J-Q)*re)&&Z>m(Q*ae+(J-Q)*ee))?t[H]=K>=d?p:Math.floor(f*K):t[H]=0}function t(e,r,n,t,i,s){var o,l,u,h=0,c=e.length;for(o=0;c>o;o++)e[o]=0;for(u=0,l=0,h=0;c>h;h++,u++)u>=r&&(u=0,l++),0===e[h]&&t[h]>=s&&a(e,r,n,t,u,l,h,i)}function a(e,r,n,t,i,s,o,l){var u,h,c,f=0==i?i:i-1,d=i==r-1?i:i+1,p=0==s?s:s-1,_=s==n-1?s:s+1;for(e[o]=t[o],u=f,h=p;d>=u&&_>=h;){if(c=u+h*r,(h!=s||u!=i)&&0===e[c]&&t[c]>=l)return void a(e,r,n,t,u,h,c,l);h++,h>_&&(h=p,u++)}}function i(r,n){var t,a,i,s,o,l=r.length,u=e.LUMA[0],h=e.LUMA[1],c=e.LUMA[2];for(t=0,a=0;l>t;t+=4,a++)i=r[t],s=r[t+1],o=r[t+2],n[a]=~~(u*i+h*s+c*o+.5)}function s(e){var r,n,t,a,i,s=new h(256),o=new h(256),l=e.length;for(r=0;l>r;r++)s[e[r]]++;for(n=0,t=0,r=0;256>r;r++){for(n+=s[r],i=255*n/l,a=t+1;i>=a;a++)o[a]=r;t=i}for(r=0;l>r;r++)e[r]=o[e[r]]}function o(e,r){var n,t,a,i=e.length;for(n=0,t=0;i>n;n+=4,t++)a=r[t]>0?255:0,e[n]=e[n+1]=e[n+2]=a}var l,u=e.Array32F,h=e.Array32I,c=.005,f=100,d=1e3,p=f*d,_=e.CONST.PI2,m=Math.abs,g=Math.exp;l=Math.hypot?Math.hypot:function(e,r){return m(e)+m(r)},e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,gaussRadius:2,gaussWidth:16,contrastNormalized:!1,path:n,init:function(e,r,n,t,a){var i=this;i.low=arguments.length<1?2.5:e,i.high=arguments.length<2?7.5:r,i.gaussRadius=arguments.length<3?2:n,i.gaussWidth=arguments.length<4?16:t,i.contrastNormalized=!!a},thresholds:function(e,r){var n=this;return n.low=e,n.high=r,n},kernel:function(e,r){var n=this;return n.gaussRadius=e,n.gaussWidth=r,n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{low:e.low,high:e.high,gaussRadius:e.gaussRadius,gaussWidth:e.gaussWidth,contrastNormalized:e.contrastNormalized}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.low=r.low,n.high=r.high,n.gaussRadius=r.gaussRadius,n.gaussWidth=r.gaussWidth,n.contrastNormalized=r.contrastNormalized),n},apply:function(e,n,a){var l,u,c,d,p=this,_=e.length>>2;return c=new h(_),d=new h(_),l=Math.round(p.low*f),u=Math.round(p.high*f),i(e,c),p.contrastNormalized&&s(c),r(c,n,a,d,p.gaussRadius,p.gaussWidth),t(c,n,a,d,l,u),o(e,c),e}})}(r),!function(e,r){function t(e,r,n,t,a,i,s){var o,l,u,h,c,f,d,p=e.length;for(h=0,u=0,o=l=0;r>h;)d=4899*e[u]+9617*e[u+1]+1868*e[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[h]=d,a[h]=o,i[h]=l,s[h]=d,h++,u+=4;for(c=0,f=1,h=r,u=r<<2,o=l=0;p>u;)d=4899*e[u]+9617*e[u+1]+1868*e[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[h]=d,a[h]=a[h-r]+o,i[h]=i[h-r]+l,s[h]=s[h+1-r]+(d+t[h-r])+(f>1?s[h-r-r]:0)+(c>0?s[h-1-r]:0),c++,h++,u+=4,c>=r&&(c=0,f++,o=l=0)}function a(e,r,n,t){var a,i,s,o,l,u,h,c,p,_,m,g=e.length,y=new f(g);for(a=0;r>a;a++)y[a]=0,y[a+r]=0,y[a+g-r]=0,y[a+g-r-r]=0,t[a]=0,t[a+g-r]=0;for(i=0,s=0;n>i;i++,s+=r)y[0+s]=0,y[1+s]=0,y[r-1+s]=0,y[r-2+s]=0,t[0+s]=0,t[r-1+s]=0;for(a=2;r-2>a;a++)for(o=0,i=2,s=r<<1;n-2>i;i++,s+=r)h=a+s,c=h+r,p=c+r,_=h-r,m=_-r,o=0+(e[m-2]<<1)+(e[_-2]<<2)+(e[h-2]<<2)+e[h-2]+(e[c-2]<<2)+(e[p-2]<<1)+(e[m-1]<<2)+(e[_-1]<<3)+e[_-1]+(e[h-1]<<4)-(e[h-1]<<2)+(e[c-1]<<3)+e[c-1]+(e[p-1]<<2)+(e[m]<<2)+e[m]+(e[_]<<4)-(e[_]<<2)+(e[h]<<4)-e[h]+(e[c]<<4)-(e[c]<<2)+(e[p]<<2)+e[p]+(e[m+1]<<2)+(e[_+1]<<3)+e[_+1]+(e[h+1]<<4)-(e[h+1]<<2)+(e[c+1]<<3)+e[c+1]+(e[p+1]<<2)+(e[m+2]<<1)+(e[_+2]<<2)+(e[h+2]<<2)+e[h+2]+(e[c+2]<<2)+(e[p+2]<<1),y[h]=((103*o+8192&4294967295)>>>14&255)>>>0;for(a=1;r-1>a;a++)for(i=1,s=r;n-1>i;i++,s+=r)h=s+a,c=h+r,_=h-r,l=0-y[_-1]+y[_+1]-y[h-1]-y[h-1]+y[h+1]+y[h+1]-y[c-1]+y[c+1],u=0+y[_-1]+y[_]+y[_]+y[_+1]-y[c-1]-y[c]-y[c]-y[c+1],t[h]=d(l)+d(u);for(a=0,o=0;r>a;)o+=t[a],t[a]=o,a++;for(a=r,s=0,o=0;g>a;)o+=t[a],t[a]=t[a-r]+o,a++,s++,s>=r&&(s=0,o=0);return t}function i(e,r){var n=.2*p(r.width,e.width),t=.2*p(r.height,e.height);return!!(d(e.x-r.x)<=n&&d(e.y-r.y)<=t&&d(e.width-r.width)<=n&&d(e.height-r.height)<=t)}function s(e,r){e.x+=r.x,e.y+=r.y,e.width+=r.width,e.height+=r.height}function o(e,r){return!!(e.x>=r.x&&e.y>=r.y&&e.x+e.width<=r.x+r.width&&e.y+e.height<=r.y+r.height)}function l(e){e.x=~~(e.x+.5),e.y=~~(e.y+.5),e.width=~~(e.width+.5),e.height=~~(e.height+.5)}function u(e,r){return r.area-e.area}function h(e,r){var n,t,a,h,c,f,d,p=e.length,_=new Array(p),m=[],g=0,y=!1;for(a=0;p>a;a++)_[a]=0;for(a=0;p>a;a++){for(y=!1,h=0;a>h;h++)i(e[h],e[a])&&(y=!0,_[a]=_[h]);y||(_[a]=g,g++)}for(n=new Array(g),t=new Array(g),a=0;g>a;a++)n[a]=0,t[a]={x:0,y:0,width:0,height:0};for(a=0;p>a;a++)d=_[a],n[d]++,s(t[d],e[a]);for(a=0;g>a;a++)c=n[a],c>=r&&(f=1/(c+c),d={x:f*(2*t[a].x+c),y:f*(2*t[a].y+c),width:f*(2*t[a].width+c),height:f*(2*t[a].height+c)},m.push(d));for(p=m.length,a=0;p>a;a++)for(h=a+1;p>h;h++)!m[a].inside&&o(m[a],m[h])?m[a].inside=!0:!m[h].inside&&o(m[h],m[a])&&(m[h].inside=!0);for(a=p;--a>=0;)m[a].inside?m.splice(a,1):(l(m[a]),m[a].area=m[a].width*m[a].height);return m.sort(u)}var c=e.Array32F,f=e.Array8U,d=Math.abs,p=Math.max,_=Math.min,m=(Math.floor,Math.round,Math.sqrt),g=e.Util.Array.typed_obj,y="hasOwnProperty";e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,n,t,a,i,s){var o=this;o.objects=null,o.haardata=e||null,o.baseScale=r===n?1:n,o.scaleIncrement=r===t?1.25:t,o.stepIncrement=r===a?.5:a,o.minNeighbors=r===i?1:i,o.doCannyPruning=r===s?!0:!!s,o._haarchanged=!!o.haardata},path:n,dispose:function(){var e=this;return e.objects=null,e.haardata=null,e.$super("dispose"),e},haar:function(e){var r=this;return r.haardata=e,r._haarchanged=!0,r},params:function(e){var r=this;return e&&(e[y]("haardata")&&(r.haardata=e.haardata,r._haarchanged=!0),e[y]("baseScale")&&(r.baseScale=e.baseScale),e[y]("scaleIncrement")&&(r.scaleIncrement=e.scaleIncrement),e[y]("stepIncrement")&&(r.stepIncrement=e.stepIncrement),e[y]("minNeighbors")&&(r.minNeighbors=e.minNeighbors),e[y]("doCannyPruning")&&(r.doCannyPruning=e.doCannyPruning),e[y]("cannyLow")&&(r.cannyLow=e.cannyLow),e[y]("cannyHigh")&&(r.cannyHigh=e.cannyHigh)),r},serialize:function(){var e=this,r={filter:e.name,_isOn:!!e._isOn,params:{baseScale:e.baseScale,scaleIncrement:e.scaleIncrement,stepIncrement:e.stepIncrement,minNeighbors:e.minNeighbors,doCannyPruning:e.doCannyPruning,cannyLow:e.cannyLow,cannyHigh:e.cannyHigh}};return e._haarchanged&&(r.params.haardata=g(e.haardata),e._haarchanged=!1),r},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,r[y]("haardata")&&(n.haardata=g(r.haardata,1)),n.baseScale=r.baseScale,n.scaleIncrement=r.scaleIncrement,n.stepIncrement=r.stepIncrement,n.minNeighbors=r.minNeighbors,n.doCannyPruning=r.doCannyPruning,n.cannyLow=r.cannyLow,n.cannyHigh=r.cannyHigh),n},getMeta:function(){return e.isWorker?g(this.objects):this.objects},setMeta:function(e){return this.objects="string"==typeof e?g(e,1):e,this},apply:function(e,r,n){var i,s,o,l,u,d,p,g,y,v,b,C,O,w,M,I,z,Y,X,x,A,H,F,k,N,L,S,q,U,E,R,P,T,D,G,$,j,W,B,k,V,Q,J,K,Z,ee,re,ne,te,ae,ie,se,oe,le,ue,he,ce,fe,de,pe=this,_e=e.length>>>2,me=pe.haardata,ge=me.stages,ye=pe.baseScale,ve=pe.scaleIncrement,be=pe.stepIncrement,Ce=pe.minNeighbors,Oe=pe.doCannyPruning,we=pe.cannyLow,Me=pe.cannyHigh,Ie=me.size1,ze=me.size2,Ye=_(r/Ie,n/ze),Xe=[],xe=_e-1,Ae=0,He=0,Fe=ge.length;for(t(e,r,n,s=new f(_e),o=new c(_e),l=new c(_e),u=new c(_e)),Oe&&a(s,r,n,d=new c(_e)),N=0,L=r-1,S=0,q=_e-r,i=ye;Ye>=i;){for(y=~~(i*Ie),p=~~(y*be),v=~~(i*ze),g=~~(v*be),M=v*r,I=g*r,b=He*I,A=r-y,H=n-v,U=y*v,E=1/U,O=He,w=b;H>O;O+=g,w+=I)for(C=Ae;A>C;C+=p)if(z=C-1+w-r,Y=z+y,X=z+M,x=X+y,z=0>z?0:z>xe?xe:z,Y=0>Y?0:Y>xe?xe:Y,X=0>X?0:X>xe?xe:X,x=0>x?0:x>xe?xe:x,!(Oe&&(D=E*(d[x]-d[X]-d[Y]+d[z]),we>D||D>Me))){for(R=E*(o[x]-o[X]-o[Y]+o[z]),P=E*(l[x]-l[X]-l[Y]+l[z]),T=P-R*R,T=T>1?m(T):1,G=!0,F=0;Fe>F;F++){for($=ge[F],j=$.thres,W=$.trees,B=W.length,de=0,k=0;B>k;k++)for(J=W[k].feats,V=0;;){if(K=J[V],Z=K.rects,ee=Z.length,re=K.thres,ne=0,K.tilt)for(te=0;ee>te;te++)ae=Z[te],ie=C+~~(i*ae[0]),se=(O-1+~~(i*ae[1]))*r,oe=C+~~(i*(ae[0]+ae[2])),le=(O-1+~~(i*(ae[1]+ae[2])))*r,ue=C+~~(i*(ae[0]-ae[3])),he=(O-1+~~(i*(ae[1]+ae[3])))*r,ce=C+~~(i*(ae[0]+ae[2]-ae[3])),fe=(O-1+~~(i*(ae[1]+ae[2]+ae[3])))*r,ie=N>ie?N:ie>L?L:ie,oe=N>oe?N:oe>L?L:oe,ue=N>ue?N:ue>L?L:ue,ce=N>ce?N:ce>L?L:ce,se=S>se?S:se>q?q:se,le=S>le?S:le>q?q:le,he=S>he?S:he>q?q:he,fe=S>fe?S:fe>q?q:fe,ne+=ae[4]*(u[ce+fe]-u[ue+he]-u[oe+le]+u[ie+se]);else for(te=0;ee>te;te++)ae=Z[te],ie=C-1+~~(i*ae[0]),oe=C-1+~~(i*(ae[0]+ae[2])),se=r*(O-1+~~(i*ae[1])),le=r*(O-1+~~(i*(ae[1]+ae[3]))),ie=N>ie?N:ie>L?L:ie,oe=N>oe?N:oe>L?L:oe,se=S>se?S:se>q?q:se,le=S>le?S:le>q?q:le,ne+=ae[4]*(o[oe+le]-o[ie+le]-o[oe+se]+o[ie+se]);if(Q=re*T>ne*E?0:1){if(K.has_r){de+=K.r_val;break}V=K.r_node}else{if(K.has_l){de+=K.l_val;break}V=K.l_node}}if(G=de>j,!G)break}G&&Xe.push({x:C,y:O,width:y,height:v})}i*=ve}return pe.objects=h(Xe,Ce),e}})}(r),!function(e,r){function t(e,r){for(;r[e][1]!==e;)r[e][1]=r[r[e][1]][1],e=r[e][1];return e}function a(e,r,n){var a=t(e,n),i=t(r,n);a!==i&&(n[a][1]=i)}function i(e){var r=e.highest;return r+1>e.length&&Array.prototype.push.apply(e,new Array(l)),e[r]=[r,r],++e.highest,r}function s(e,r,n){return 0===e[r+3]&&0===e[n+3]||e[r]===e[n]&&e[r+1]===e[n+1]&&e[r+2]===e[n+2]&&e[r+3]===e[n+3]}var o=e.Array32U,l=20;e.Create({name:"ConnectedComponentsFilter",connectivity:4,init:function(e){var r=this;r.connectivity=8===e?8:4},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{connectivity:e.connectivity}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.connectivity=r.connectivity),n},apply:function(e,r,n){var u=this;if(!u._isOn)return e;var h,c,f,d,p,_,m,g,y,v,b,C=e.length,O=C>>>2,w=r<<2,M=8===u.connectivity?8:4,I=8===M,z=I?-1:0,Y=4*z;for(y=new Array(l),y.highest=0,v=new o(O),v[0]=i(y),p=1,h=4;r>p;p++,h+4)v[p]=s(e,h,h-4)?v[p-1]:i(y);for(_=1,g=r,h=w;n>_;_++,g+=r,h+=w)for(v[g]=s(e,h,h-w)?v[g-r]:i(y),p=1,c=4;r>p;p++,c+=4){for(d=s(e,h+c,h+c-4)?v[g+p-1]:-1,m=z,f=Y;1>m;m++,f+=4)s(e,h+c,h-w+c+f)&&(d>=0?a(d,v[g-r+p+m],y):d=v[g-r+p+m]);v[g+p]=d>=0?d:i(y),I&&s(e,h+c-4,h-w+c)&&a(v[g+p-1],v[g-r+p],y)}var X=y.highest>0?y.highest-1:1;for(p=0,h=0;C>h;h+=4,p++)b=~~(255-255*y[t(v[p],y)][0]/X),e[h]=b,e[h+1]=b,e[h+2]=b,e[h+3]=255;return e}})}(r),r});