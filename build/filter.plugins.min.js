/**
*
*   FILTER.js Plugins
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,n){"use strict";"object"==typeof module&&module.exports?module.exports=n.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(r,t){return n.moduleUri=r.uri,n.call(e,t),t}):(n.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(n){"use strict";var r=n.getPath(e.moduleUri);return!function(e){var n=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,n){var r=this;r.min=e||-127,r.max=n||127},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{min:e.min,max:e.max}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.min=n.min,r.max=n.max),r},apply:function(e,r,a){var i=this;if(!i._isOn)return e;var s,o,l,u,c,f,h,d,m=i.max-i.min,p=i.min,_=e.length;if(n)for(s=0;_>s;s+=4)l=e[s],u=e[s+1],c=e[s+2],o=m*t()+p,f=l+o,h=u+o,d=c+o,0>f?f=0:f>255&&(f=255),0>h?h=0:h>255&&(h=255),0>d?d=0:d>255&&(d=255),e[s]=~~f,e[s+1]=~~h,e[s+2]=~~d;else for(s=0;_>s;s+=4)l=e[s],u=e[s+1],c=e[s+2],o=m*t()+p,f=l+o,h=u+o,d=c+o,e[s]=~~f,e[s+1]=~~h,e[s+2]=~~d;return e}})}(n),!function(e){var n=e.Util.Image.perlin,t=e.MODE;e.Create({name:"PerlinNoiseFilter",_baseX:1,_baseY:1,_octaves:1,_offsets:null,_mode:t.GRAY,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:r,init:function(e,n,r,a,i,s,o,l){var u=this;u._mode=t.GRAY,u._baseX=e||1,u._baseY=n||1,u._seed=o||0,u._stitch=!!a,u._fractal=!1!==i,u._perlin=!!l,u.octaves(r||1,s)},seed:function(e){var n=this;return n._seed=e||0,n},octaves:function(e,n){var r=this;for(r._octaves=e||1,r._offsets=n?n.slice(0):[];r._offsets.length<r._octaves;)r._offsets.push([0,0]);return r},seamless:function(e){return arguments.length||(e=!0),this._stitch=!!e,this},colors:function(e){return arguments.length||(e=!0),this._mode=e?t.COLOR:t.GRAY,this},turbulence:function(e){return arguments.length||(e=!0),this._fractal=!e,this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_baseX:e._baseX,_baseY:e._baseY,_octaves:e._octaves,_offsets:e._offsets,_seed:e._seed||0,_stitch:e._stitch,_mode:e._mode,_fractal:e._fractal,_perlin:e._perlin}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r._baseX=n._baseX,r._baseY=n._baseY,r._octaves=n._octaves,r._offsets=n._offsets,r._seed=n._seed||0,r._stitch=n._stitch,r._mode=n._mode,r._fractal=n._fractal,r._perlin=n._perlin),r},apply:function(e,r,a){var i=this;return i._isOn&&n?(i._seed&&(n.seed(i._seed),i._seed=0),n(e,r,a,i._stitch,t.COLOR!==i._mode,i._baseX,i._baseY,i._octaves,i._offsets,1,.5,i._perlin)):e}})}(n),!function(e,n){var t=e.Color.Gradient,a=e.Util.Array.typed,i=Math.floor;e.Create({name:"GradientFilter",colors:null,stops:null,angle:0,path:r,init:function(e,n,r){var t=this;t.setColors(e,n),t.angle=r||0},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.angle=null,e.$super("dispose"),e},setColors:function(e,n){var r=this;if(e&&e.length){var a=t.stops(e,n);r.colors=a[0],r.stops=a[1]}return r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{angle:e.angle,colors:e.colors,stops:e.stops}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.angle=n.angle,r.colors=a(n.colors,Array),r.stops=a(n.stops,Array)),r},apply:function(e,n,r){var a=this;return a._isOn&&a.colors?t.linear(e,n,r,a.colors,a.stops,a.angle,t.interpolate):e}}),e.Create({name:"RadialGradientFilter",colors:null,stops:null,centerX:0,centerY:0,radiusX:1,radiusY:1,init:function(e,n,r,t,a,i){var s=this;s.setColors(e,n),s.centerX=r||0,s.centerY=t||0,s.radiusX=a||1,s.radiusY=i||1},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.centerX=null,e.centerY=null,e.radiusX=null,e.radiusY=null,e.$super("dispose"),e},setColors:function(e,n){var r=this;if(e&&e.length){var a=t.stops(e,n);r.colors=a[0],r.stops=a[1]}return r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radiusX:e.radiusX,radiusY:e.radiusY,colors:e.colors,stops:e.stops}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.centerX=n.centerX||0,r.centerY=n.centerY||0,r.radiusX=n.radiusX||1,r.radiusY=n.radiusY||1,r.colors=a(n.colors,Array),r.stops=a(n.stops,Array)),r},apply:function(e,n,r){var a=this;return a._isOn&&a.colors?t.radial(e,n,r,a.colors,a.stops,i((a.centerX||0)*(n-1)),i((a.centerY||0)*(r-1)),a.radiusX,a.radiusY,t.interpolate):e}})}(n),!function(e){var n=Math.min,t=Math.floor,a=e.CHANNEL;e.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:a.RED,dstChannel:a.RED,path:r,init:function(e,n,r,t,i){var s=this;s._srcImg=null,s.srcImg=null,s.srcChannel=n||a.RED,s.dstChannel=r||a.RED,s.centerX=t||0,s.centerY=i||0,e&&s.setSrc(e)},dispose:function(){var e=this;return e.srcChannel=null,e.dstChannel=null,e.centerX=null,e.centerY=null,e.srcImg=null,e._srcImg=null,e.$super("dispose"),e},setSrc:function(e){var n=this;return e&&(n.srcImg=e,n._srcImg=null),n},serialize:function(){var e=this,n=e.srcImg;return{filter:e.name,_isOn:!!e._isOn,params:{_srcImg:e._srcImg||(n?{data:n.getData(),width:n.width,height:n.height}:null),centerX:e.centerX,centerY:e.centerY,srcChannel:e.srcChannel,dstChannel:e.dstChannel}}},unserialize:function(n){var r,t=this;return n&&t.name===n.filter&&(t._isOn=!!n._isOn,r=n.params,t.srcImg=null,t._srcImg=r._srcImg,t._srcImg&&(t._srcImg.data=e.Util.Array.typed(t._srcImg.data,e.ImArray)),t.centerX=r.centerX,t.centerY=r.centerY,t.srcChannel=r.srcChannel,t.dstChannel=r.dstChannel),t},apply:function(e,r,a){var i=this,s=i.srcImg;if(!i._isOn||!s&&!i._srcImg)return e;var o,l,u,c,f,h,d=i._srcImg||{data:s.getData(),width:s.width,height:s.height},m=d.data,p=d.width,_=d.height,g=e.length,v=(m.length,i.srcChannel),y=i.dstChannel,O=n(r,p),C=n(a,_),b=i.centerX||0,I=i.centerY||0,w=p>>>1,Y=_>>>1;for(b=t(b*(r-1))-w,I=t(I*(a-1))-Y,o=0,l=0,u=0,o=0;g>o;o+=4,l++)l>=r&&(l=0,u++),f=l-b,h=u-I,f>=0&&O>f&&h>=0&&C>h&&(c=f+h*p<<2,e[o+y]=m[c+v]);return e}})}(n),!function(e){var n=(e._notSupportClamp,e.CHANNEL),t=Math.min,a=Math.floor;e.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,channel:n.ALPHA,path:r,init:function(e,r,t,a){var i=this;i.centerX=r||0,i.centerY=t||0,i.channel=null==a?n.ALPHA:a||n.RED,i._alphaMask=null,i.alphaMask=null,e&&i.setMask(e)},dispose:function(){var e=this;return e.centerX=null,e.centerY=null,e.channel=null,e.alphaMask=null,e._alphaMask=null,e.$super("dispose"),e},setMask:function(e){var n=this;return e&&(n.alphaMask=e,n._alphaMask=null),n},serialize:function(){var e=this,n=e.alphaMask;return{filter:e.name,_isOn:!!e._isOn,params:{_alphaMask:e._alphaMask||(n?{data:n.getData(),width:n.width,height:n.height}:null),centerX:e.centerX,centerY:e.centerY,channel:e.channel}}},unserialize:function(n){var r,t=this;return n&&t.name===n.filter&&(t._isOn=!!n._isOn,r=n.params,t.alphaMask=null,t._alphaMask=r._alphaMask,t._alphaMask&&(t._alphaMask.data=e.Util.Array.typed(t._alphaMask.data,e.ImArray)),t.centerX=r.centerX,t.centerY=r.centerY,t.channel=r.channel),t},apply:function(e,r,i){var s=this,o=s.alphaMask;if(!s._isOn||!o&&!s._alphaMask)return e;var l,u,c,f,h,d,m=s._alphaMask||{data:o.getData(),width:o.width,height:o.height},p=m.data,_=m.width,g=m.height,v=e.length,y=(p.length,t(r,_)),O=t(i,g),C=null==s.channel?n.ALPHA:s.channel||n.RED,b=s.centerX||0,I=s.centerY||0,w=_>>>1,Y=g>>>1;for(b=a(b*(r-1))-w,I=a(I*(i-1))-Y,u=0,c=0,l=0;v>l;l+=4,u++)u>=r&&(u=0,c++),h=u-b,d=c-I,h>=0&&y>h&&d>=0&&O>d?(f=h+d*_<<2,e[l+3]=p[f+C]):(e[l]=0,e[l+1]=0,e[l+2]=0,e[l+3]=0);return e}})}(n),!function(e){var n=e._notSupportClamp,t=e.Array32F,a=e.MODE,i=Math.min,s=Math.max;e.Create({name:"HistogramEqualizeFilter",path:r,mode:a.INTENSITY,init:function(e){var n=this;n.mode=e||a.INTENSITY},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{mode:e.mode}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.mode=n.mode),r},_apply_rgb:function(e,r,a){var o,l,u,c,f,h,d,m,p,_,g,v,y,O,C,b,I=0,w=0,Y=0,M=255,X=255,A=255,z=e.length,x=z>>>2,R=(7&x)<<2,F=1/x;for(d=new t(256),m=new t(256),p=new t(256),b=0;z>b;b+=32)o=e[b],l=e[b+1],u=e[b+2],d[o]+=F,m[l]+=F,p[u]+=F,I=s(o,I),w=s(l,w),Y=s(u,Y),M=i(o,M),X=i(l,X),A=i(u,A),o=e[b+4],l=e[b+5],u=e[b+6],d[o]+=F,m[l]+=F,p[u]+=F,I=s(o,I),w=s(l,w),Y=s(u,Y),M=i(o,M),X=i(l,X),A=i(u,A),o=e[b+8],l=e[b+9],u=e[b+10],d[o]+=F,m[l]+=F,p[u]+=F,I=s(o,I),w=s(l,w),Y=s(u,Y),M=i(o,M),X=i(l,X),A=i(u,A),o=e[b+12],l=e[b+13],u=e[b+14],d[o]+=F,m[l]+=F,p[u]+=F,I=s(o,I),w=s(l,w),Y=s(u,Y),M=i(o,M),X=i(l,X),A=i(u,A),o=e[b+16],l=e[b+17],u=e[b+18],d[o]+=F,m[l]+=F,p[u]+=F,I=s(o,I),w=s(l,w),Y=s(u,Y),M=i(o,M),X=i(l,X),A=i(u,A),o=e[b+20],l=e[b+21],u=e[b+22],d[o]+=F,m[l]+=F,p[u]+=F,I=s(o,I),w=s(l,w),Y=s(u,Y),M=i(o,M),X=i(l,X),A=i(u,A),o=e[b+24],l=e[b+25],u=e[b+26],d[o]+=F,m[l]+=F,p[u]+=F,I=s(o,I),w=s(l,w),Y=s(u,Y),M=i(o,M),X=i(l,X),A=i(u,A),o=e[b+28],l=e[b+29],u=e[b+30],d[o]+=F,m[l]+=F,p[u]+=F,I=s(o,I),w=s(l,w),Y=s(u,Y),M=i(o,M),X=i(l,X),A=i(u,A);if(R)for(b=z-R;z>b;b+=4)o=e[b],l=e[b+1],u=e[b+2],d[o]+=F,m[l]+=F,p[u]+=F,I=s(o,I),w=s(l,w),Y=s(u,Y),M=i(o,M),X=i(l,X),A=i(u,A);for(_=g=v=0,b=0;256>b;b+=32)_+=d[b],d[b]=_,_+=d[b+1],d[b+1]=_,_+=d[b+2],d[b+2]=_,_+=d[b+3],d[b+3]=_,_+=d[b+4],d[b+4]=_,_+=d[b+5],d[b+5]=_,_+=d[b+6],d[b+6]=_,_+=d[b+7],d[b+7]=_,_+=d[b+8],d[b+8]=_,_+=d[b+9],d[b+9]=_,_+=d[b+10],d[b+10]=_,_+=d[b+11],d[b+11]=_,_+=d[b+12],d[b+12]=_,_+=d[b+13],d[b+13]=_,_+=d[b+14],d[b+14]=_,_+=d[b+15],d[b+15]=_,_+=d[b+16],d[b+16]=_,_+=d[b+17],d[b+17]=_,_+=d[b+18],d[b+18]=_,_+=d[b+19],d[b+19]=_,_+=d[b+20],d[b+20]=_,_+=d[b+21],d[b+21]=_,_+=d[b+22],d[b+22]=_,_+=d[b+23],d[b+23]=_,_+=d[b+24],d[b+24]=_,_+=d[b+25],d[b+25]=_,_+=d[b+26],d[b+26]=_,_+=d[b+27],d[b+27]=_,_+=d[b+28],d[b+28]=_,_+=d[b+29],d[b+29]=_,_+=d[b+30],d[b+30]=_,_+=d[b+31],d[b+31]=_,g+=m[b],m[b]=g,g+=m[b+1],m[b+1]=g,g+=m[b+2],m[b+2]=g,g+=m[b+3],m[b+3]=g,g+=m[b+4],m[b+4]=g,g+=m[b+5],m[b+5]=g,g+=m[b+6],m[b+6]=g,g+=m[b+7],m[b+7]=g,g+=m[b+8],m[b+8]=g,g+=m[b+9],m[b+9]=g,g+=m[b+10],m[b+10]=g,g+=m[b+11],m[b+11]=g,g+=m[b+12],m[b+12]=g,g+=m[b+13],m[b+13]=g,g+=m[b+14],m[b+14]=g,g+=m[b+15],m[b+15]=g,g+=m[b+16],m[b+16]=g,g+=m[b+17],m[b+17]=g,g+=m[b+18],m[b+18]=g,g+=m[b+19],m[b+19]=g,g+=m[b+20],m[b+20]=g,g+=m[b+21],m[b+21]=g,g+=m[b+22],m[b+22]=g,g+=m[b+23],m[b+23]=g,g+=m[b+24],m[b+24]=g,g+=m[b+25],m[b+25]=g,g+=m[b+26],m[b+26]=g,g+=m[b+27],m[b+27]=g,g+=m[b+28],m[b+28]=g,g+=m[b+29],m[b+29]=g,g+=m[b+30],m[b+30]=g,g+=m[b+31],m[b+31]=g,v+=p[b],p[b]=v,v+=p[b+1],p[b+1]=v,v+=p[b+2],p[b+2]=v,v+=p[b+3],p[b+3]=v,v+=p[b+4],p[b+4]=v,v+=p[b+5],p[b+5]=v,v+=p[b+6],p[b+6]=v,v+=p[b+7],p[b+7]=v,v+=p[b+8],p[b+8]=v,v+=p[b+9],p[b+9]=v,v+=p[b+10],p[b+10]=v,v+=p[b+11],p[b+11]=v,v+=p[b+12],p[b+12]=v,v+=p[b+13],p[b+13]=v,v+=p[b+14],p[b+14]=v,v+=p[b+15],p[b+15]=v,v+=p[b+16],p[b+16]=v,v+=p[b+17],p[b+17]=v,v+=p[b+18],p[b+18]=v,v+=p[b+19],p[b+19]=v,v+=p[b+20],p[b+20]=v,v+=p[b+21],p[b+21]=v,v+=p[b+22],p[b+22]=v,v+=p[b+23],p[b+23]=v,v+=p[b+24],p[b+24]=v,v+=p[b+25],p[b+25]=v,v+=p[b+26],p[b+26]=v,v+=p[b+27],p[b+27]=v,v+=p[b+28],p[b+28]=v,v+=p[b+29],p[b+29]=v,v+=p[b+30],p[b+30]=v,v+=p[b+31],p[b+31]=v;if(c=I-M,f=w-X,h=Y-A,n){for(b=0;z>b;b+=32)o=e[b],l=e[b+1],u=e[b+2],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b]=~~y,e[b+1]=~~O,e[b+2]=~~C,o=e[b+4],l=e[b+5],u=e[b+6],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+4]=~~y,e[b+5]=~~O,e[b+6]=~~C,o=e[b+8],l=e[b+9],u=e[b+10],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+8]=~~y,e[b+9]=~~O,e[b+10]=~~C,o=e[b+12],l=e[b+13],u=e[b+14],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+12]=~~y,e[b+13]=~~O,e[b+14]=~~C,o=e[b+16],l=e[b+17],u=e[b+18],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+16]=~~y,e[b+17]=~~O,e[b+18]=~~C,o=e[b+20],l=e[b+21],u=e[b+22],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+20]=~~y,e[b+21]=~~O,e[b+22]=~~C,o=e[b+24],l=e[b+25],u=e[b+26],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+24]=~~y,e[b+25]=~~O,e[b+26]=~~C,o=e[b+28],l=e[b+29],u=e[b+30],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+28]=~~y,e[b+29]=~~O,e[b+30]=~~C;if(R)for(b=z-R;z>b;b+=4)o=e[b],l=e[b+1],u=e[b+2],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b]=~~y,e[b+1]=~~O,e[b+2]=~~C}else{for(b=0;z>b;b+=32)o=e[b],l=e[b+1],u=e[b+2],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,e[b]=~~y,e[b+1]=~~O,e[b+2]=~~C,o=e[b+4],l=e[b+5],u=e[b+6],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,e[b+4]=~~y,e[b+5]=~~O,e[b+6]=~~C,o=e[b+8],l=e[b+9],u=e[b+10],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,e[b+8]=~~y,e[b+9]=~~O,e[b+10]=~~C,o=e[b+12],l=e[b+13],u=e[b+14],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,e[b+12]=~~y,e[b+13]=~~O,e[b+14]=~~C,o=e[b+16],l=e[b+17],u=e[b+18],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,e[b+16]=~~y,e[b+17]=~~O,e[b+18]=~~C,o=e[b+20],l=e[b+21],u=e[b+22],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,e[b+20]=~~y,e[b+21]=~~O,e[b+22]=~~C,o=e[b+24],l=e[b+25],u=e[b+26],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,e[b+24]=~~y,e[b+25]=~~O,e[b+26]=~~C,o=e[b+28],l=e[b+29],u=e[b+30],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,e[b+28]=~~y,e[b+29]=~~O,e[b+30]=~~C;if(R)for(b=z-R;z>b;b+=4)o=e[b],l=e[b+1],u=e[b+2],y=d[o]*c+M,O=m[l]*f+X,C=p[u]*h+A,e[b]=~~y,e[b+1]=~~O,e[b+2]=~~C}return e},apply:function(e,r,o){var l=this;if(!l._isOn)return e;if(a.RGB===l.mode)return l._apply_rgb(e,r,o);var u,c,f,h,d,m,p,_,g,v,y=0,O=255,C=e.length,b=C>>>2,I=1/b,w=a.GRAY===l.mode,Y=(7&b)<<2;if(_=new t(256),w){for(v=0;C>v;v+=32)u=e[v],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+4],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+8],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+12],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+16],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+20],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+24],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+28],_[u]+=I,y=s(u,y),O=i(u,O);if(Y)for(v=C-Y;C>v;v+=4)u=e[v],_[u]+=I,y=s(u,y),O=i(u,O)}else{for(v=0;C>v;v+=32)u=e[v],c=e[v+1],f=e[v+2],h=~~(0+.299*u+.587*c+.114*f),d=~~(128-.168736*u-.331264*c+.5*f),m=~~(128+.5*u-.418688*c-.081312*f),m=0>m?0:m>255?255:m,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[v]=m,e[v+1]=h,e[v+2]=d,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+4],c=e[v+5],f=e[v+6],h=~~(0+.299*u+.587*c+.114*f),d=~~(128-.168736*u-.331264*c+.5*f),m=~~(128+.5*u-.418688*c-.081312*f),m=0>m?0:m>255?255:m,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[v+4]=m,e[v+5]=h,e[v+6]=d,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+8],c=e[v+9],f=e[v+10],h=~~(0+.299*u+.587*c+.114*f),d=~~(128-.168736*u-.331264*c+.5*f),m=~~(128+.5*u-.418688*c-.081312*f),m=0>m?0:m>255?255:m,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[v+8]=m,e[v+9]=h,e[v+10]=d,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+12],c=e[v+13],f=e[v+14],h=~~(0+.299*u+.587*c+.114*f),d=~~(128-.168736*u-.331264*c+.5*f),m=~~(128+.5*u-.418688*c-.081312*f),m=0>m?0:m>255?255:m,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[v+12]=m,e[v+13]=h,e[v+14]=d,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+16],c=e[v+17],f=e[v+18],h=~~(0+.299*u+.587*c+.114*f),d=~~(128-.168736*u-.331264*c+.5*f),m=~~(128+.5*u-.418688*c-.081312*f),m=0>m?0:m>255?255:m,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[v+16]=m,e[v+17]=h,e[v+18]=d,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+20],c=e[v+21],f=e[v+22],h=~~(0+.299*u+.587*c+.114*f),d=~~(128-.168736*u-.331264*c+.5*f),m=~~(128+.5*u-.418688*c-.081312*f),m=0>m?0:m>255?255:m,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[v+20]=m,e[v+21]=h,e[v+22]=d,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+24],c=e[v+25],f=e[v+26],h=~~(0+.299*u+.587*c+.114*f),d=~~(128-.168736*u-.331264*c+.5*f),m=~~(128+.5*u-.418688*c-.081312*f),m=0>m?0:m>255?255:m,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[v+24]=m,e[v+25]=h,e[v+26]=d,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+28],c=e[v+29],f=e[v+30],h=~~(0+.299*u+.587*c+.114*f),d=~~(128-.168736*u-.331264*c+.5*f),m=~~(128+.5*u-.418688*c-.081312*f),m=0>m?0:m>255?255:m,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[v+28]=m,e[v+29]=h,e[v+30]=d,_[h]+=I,y=s(h,y),O=i(h,O);if(Y)for(v=C-Y;C>v;v+=4)u=e[v],c=e[v+1],f=e[v+2],h=~~(0+.299*u+.587*c+.114*f),d=~~(128-.168736*u-.331264*c+.5*f),m=~~(128+.5*u-.418688*c-.081312*f),m=0>m?0:m>255?255:m,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[v]=m,e[v+1]=h,e[v+2]=d,_[h]+=I,y=s(h,y),O=i(h,O)}for(g=0,v=0;256>v;v+=32)g+=_[v],_[v]=g,g+=_[v+1],_[v+1]=g,g+=_[v+2],_[v+2]=g,g+=_[v+3],_[v+3]=g,g+=_[v+4],_[v+4]=g,g+=_[v+5],_[v+5]=g,g+=_[v+6],_[v+6]=g,g+=_[v+7],_[v+7]=g,g+=_[v+8],_[v+8]=g,g+=_[v+9],_[v+9]=g,g+=_[v+10],_[v+10]=g,g+=_[v+11],_[v+11]=g,g+=_[v+12],_[v+12]=g,g+=_[v+13],_[v+13]=g,g+=_[v+14],_[v+14]=g,g+=_[v+15],_[v+15]=g,g+=_[v+16],_[v+16]=g,g+=_[v+17],_[v+17]=g,g+=_[v+18],_[v+18]=g,g+=_[v+19],_[v+19]=g,g+=_[v+20],_[v+20]=g,g+=_[v+21],_[v+21]=g,g+=_[v+22],_[v+22]=g,g+=_[v+23],_[v+23]=g,g+=_[v+24],_[v+24]=g,g+=_[v+25],_[v+25]=g,g+=_[v+26],_[v+26]=g,g+=_[v+27],_[v+27]=g,g+=_[v+28],_[v+28]=g,g+=_[v+29],_[v+29]=g,g+=_[v+30],_[v+30]=g,g+=_[v+31],_[v+31]=g;if(p=y-O,n)if(w){for(v=0;C>v;v+=32)u=~~(_[e[v]]*p+O),u=0>u?0:u>255?255:u,e[v]=u,e[v+1]=u,e[v+2]=u,u=~~(_[e[v+4]]*p+O),u=0>u?0:u>255?255:u,e[v+4]=u,e[v+5]=u,e[v+6]=u,u=~~(_[e[v+8]]*p+O),u=0>u?0:u>255?255:u,e[v+8]=u,e[v+9]=u,e[v+10]=u,u=~~(_[e[v+12]]*p+O),u=0>u?0:u>255?255:u,e[v+12]=u,e[v+13]=u,e[v+14]=u,u=~~(_[e[v+16]]*p+O),u=0>u?0:u>255?255:u,e[v+16]=u,e[v+17]=u,e[v+18]=u,u=~~(_[e[v+20]]*p+O),u=0>u?0:u>255?255:u,e[v+20]=u,e[v+21]=u,e[v+22]=u,u=~~(_[e[v+24]]*p+O),u=0>u?0:u>255?255:u,e[v+24]=u,e[v+25]=u,e[v+26]=u,u=~~(_[e[v+28]]*p+O),u=0>u?0:u>255?255:u,e[v+28]=u,e[v+29]=u,e[v+30]=u;if(Y)for(v=C-Y;C>v;v+=4)u=~~(_[e[v]]*p+O),u=0>u?0:u>255?255:u,e[v]=u,e[v+1]=u,e[v+2]=u}else{for(v=0;C>v;v+=32)h=_[e[v+1]]*p+O,d=e[v+2],m=e[v],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v]=u,e[v+1]=c,e[v+2]=f,h=_[e[v+5]]*p+O,d=e[v+6],m=e[v+4],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+4]=u,e[v+5]=c,e[v+6]=f,h=_[e[v+9]]*p+O,d=e[v+10],m=e[v+8],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+8]=u,e[v+9]=c,e[v+10]=f,h=_[e[v+13]]*p+O,d=e[v+14],m=e[v+12],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+12]=u,e[v+13]=c,e[v+14]=f,h=_[e[v+17]]*p+O,d=e[v+18],m=e[v+16],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+16]=u,e[v+17]=c,e[v+18]=f,h=_[e[v+21]]*p+O,d=e[v+22],m=e[v+20],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+20]=u,e[v+21]=c,e[v+22]=f,h=_[e[v+25]]*p+O,d=e[v+26],m=e[v+24],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+24]=u,e[v+25]=c,e[v+26]=f,h=_[e[v+29]]*p+O,d=e[v+30],m=e[v+28],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+28]=u,e[v+29]=c,e[v+30]=f;if(Y)for(v=C-Y;C>v;v+=4)h=_[e[v+1]]*p+O,d=e[v+2],m=e[v],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v]=u,e[v+1]=c,e[v+2]=f}else if(w){for(v=0;C>v;v+=32)u=~~(_[e[v]]*p+O),e[v]=u,e[v+1]=u,e[v+2]=u,u=~~(_[e[v+4]]*p+O),e[v+4]=u,e[v+5]=u,e[v+6]=u,u=~~(_[e[v+8]]*p+O),e[v+8]=u,e[v+9]=u,e[v+10]=u,u=~~(_[e[v+12]]*p+O),e[v+12]=u,e[v+13]=u,e[v+14]=u,u=~~(_[e[v+16]]*p+O),e[v+16]=u,e[v+17]=u,e[v+18]=u,u=~~(_[e[v+20]]*p+O),e[v+20]=u,e[v+21]=u,e[v+22]=u,u=~~(_[e[v+24]]*p+O),e[v+24]=u,e[v+25]=u,e[v+26]=u,u=~~(_[e[v+28]]*p+O),e[v+28]=u,e[v+29]=u,e[v+30]=u;if(Y)for(v=C-Y;C>v;v+=4)u=~~(_[e[v]]*p+O),e[v]=u,e[v+1]=u,e[v+2]=u}else{for(v=0;C>v;v+=32)h=_[e[v+1]]*p+O,d=e[v+2],m=e[v],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),e[v]=u,e[v+1]=c,e[v+2]=f,h=_[e[v+5]]*p+O,d=e[v+6],m=e[v+4],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),e[v+4]=u,e[v+5]=c,e[v+6]=f,h=_[e[v+9]]*p+O,d=e[v+10],m=e[v+8],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),e[v+8]=u,e[v+9]=c,e[v+10]=f,h=_[e[v+13]]*p+O,d=e[v+14],m=e[v+12],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),e[v+12]=u,e[v+13]=c,e[v+14]=f,h=_[e[v+17]]*p+O,d=e[v+18],m=e[v+16],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),e[v+16]=u,e[v+17]=c,e[v+18]=f,h=_[e[v+21]]*p+O,d=e[v+22],m=e[v+20],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),e[v+20]=u,e[v+21]=c,e[v+22]=f,h=_[e[v+25]]*p+O,d=e[v+26],m=e[v+24],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),e[v+24]=u,e[v+25]=c,e[v+26]=f,h=_[e[v+29]]*p+O,d=e[v+30],m=e[v+28],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),e[v+28]=u,e[v+29]=c,e[v+30]=f;if(Y)for(v=C-Y;C>v;v+=4)h=_[e[v+1]]*p+O,d=e[v+2],m=e[v],u=~~(h+1.402*(m-128)),c=~~(h-.34414*(d-128)-.71414*(m-128)),f=~~(h+1.772*(d-128)),e[v]=u,e[v+1]=c,e[v+2]=f}return e}})}(n),!function(e){var n=e.ImArray,t=Math.sqrt,a=Math.min;Math.max,t(3);e.Create({name:"PixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.scale=n.scale),r},apply:function(e,r,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,c,f,h,d,m,p,_,g,v,y,O,C,b,I,w,Y,M,X,A=e.length,z=A>>>2,x=r-1,R=z-r;for(o=new n(A),l=~~(t(z)*s.scale*.01),u=l-1,c=r*u,y=O=C=b=I=0,v=0;A>v;v+=4)w=y-C,Y=O-I,M=a(x,w+u),X=a(R,Y+c),f=w+Y<<2,h=w+X<<2,d=M+Y<<2,m=M+X<<2,p=e[f]+e[h]+e[d]+e[m],_=e[f+1]+e[h+1]+e[d+1]+e[m+1],g=e[f+2]+e[h+2]+e[d+2]+e[m+2],o[v]=~~(.25*p),o[v+1]=~~(.25*_),o[v+2]=~~(.25*g),o[v+3]=e[v+3],y++,C++,y>=r&&(C=0,y=0,b++,I+=r,O+=r,b>=l&&(b=0,I=0)),C>=l&&(C=0);return o}}),e.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.scale=n.scale),r},apply:function(e,r,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,c,f,h,d,m,p,_,g,v,y,O,C,b,I,w,Y,M,X=e.length,A=X>>>2,z=r-1,x=A-r;for(o=new n(X),l=~~(t(A)*s.scale*.01),u=l-1,c=r*u,v=y=O=C=b=0,g=0;X>g;g+=4)I=v-O,w=y-b,Y=a(z,I+u),M=a(x,w+c),O+C>u?(f=Y+w<<2,h=Y+M<<2,d=I+w<<2):(f=I+w<<2,h=I+M<<2,d=Y+w<<2),m=e[f]+e[h]+e[d],p=e[f+1]+e[h+1]+e[d+1],_=e[f+2]+e[h+2]+e[d+2],o[g]=~~(.333*m),o[g+1]=~~(.333*p),o[g+2]=~~(.333*_),o[g+3]=e[g+3],v++,O++,v>=r&&(O=0,v=0,C++,b+=r,y+=r,C>=l&&(C=0,b=0)),O>=l&&(O=0);return o}})}(n),!function(e,n){var t=7/16,a=3/16,i=5/16,s=1/16,o=e.MODE,l=e.Array32F,u=e.Color.clamp,c=e.Color.RGB2YCbCr,f=e.Color.YCbCr2RGB;e.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:o.GRAY,init:function(e,n,r){var t=this;t.size=e||1,t.thresh=u(null==n?.4:n,0,1),t.mode=r||o.GRAY},path:r,threshold:function(e){return this.thresh=u(e,0,1),this},grayscale:function(e){return arguments.length||(e=!0),this.mode=e?o.GRAY:o.RGB,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{size:e.size,thresh:e.thresh,mode:e.mode}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.size=n.size,r.thresh=n.thresh,r.mode=n.mode),r},apply:function(e,n,r){var h,d,m,p,_,g,v,y,O,C,b,I,w,Y,M,X,A,z=this,x=e.length,R=x>>>2,F=new l(3*R),S=z.size,E=S*S,L=1/E,N=255*z.thresh,k=k<<1,T=o.RGB===z.mode,D=S*n,P=t,H=a,U=i,G=s;for(v=0,y=0,g=0;r>v;){for(I=w=Y=0,O=0,C=0,b=0;S>C;)h=g+y+O+b<<2,d=3*(g+y+O+b),I+=e[h]+F[d],w+=e[h+1]+F[d+1],Y+=e[h+2]+F[d+2],O++,O>=S&&(O=0,C++,b+=n);if(I*=L,w*=L,Y*=L,_=T?c([I,w,Y],0):[I,w,Y],m=_[0],m>N?T?(_[0]=u(~~m,0,255),p=f(_,0)):p=[255,255,255]:p=[0,0,0],h=g+y<<2,M=e[h]-p[0],X=e[h+1]-p[1],A=e[h+2]-p[2],n>g+S)for(O=S,C=0,b=0;S>C;)d=3*(g+y+O+b),F[d]+=P*M,F[d+1]+=P*X,F[d+2]+=P*A,O++,O>=k&&(O=S,C++,b+=n);if(r>v+S&&g>S)for(O=-S,C=S,b=0;k>C;)d=3*(g+y+O+b),F[d]+=H*M,F[d+1]+=H*X,F[d+2]+=H*A,O++,O>=0&&(O=-S,C++,b+=n);if(r>v+S)for(O=0,C=S,b=0;k>C;)d=3*(g+y+O+b),F[d]+=U*M,F[d+1]+=U*X,F[d+2]+=U*A,O++,O>=S&&(O=0,C++,b+=n);if(r>v+S&&n>g+S)for(O=S,C=S,b=0;k>C;)d=3*(g+y+O+b),F[d]+=G*M,F[d+1]+=G*X,F[d+2]+=G*A,O++,O>=k&&(O=S,C++,b+=n);for(O=0,C=0,b=0;S>C;)h=g+y+O+b<<2,e[h]=p[0],e[h+1]=p[1],e[h+2]=p[2],O++,O>=S&&(O=0,C++,b+=n);g+=S,g>=n&&(g=0,v+=S,y+=D)}return e}})}(n),!function(e,n){var t="hasOwnProperty",a=Math.min,i=Math.round,s=e._notSupportClamp,o=e.Color.Combine;e.Create({name:"BlendFilter",_blendImage:null,blendImage:null,mode:null,startX:0,startY:0,path:r,init:function(e,n){var r=this;r.startX=0,r.startY=0,r._blendImage=null,r.blendImage=null,r.mode=null,e&&r.setImage(e),n&&r.setMode(n)},dispose:function(){var e=this;return e.blendImage=null,e._blendImage=null,e.mode=null,e.$super("dispose"),e},setImage:function(e){var n=this;return e&&(n.blendImage=e,n._blendImage=null),n},setMode:function(e){var n=this;return e?(n.mode=(""+e).toLowerCase(),o[t](n.mode)||(n.mode=null)):n.mode=null,n},serialize:function(){var e=this,n=e.blendImage;return{filter:e.name,_isOn:!!e._isOn,params:{_blendImage:e._blendImage||(n?{data:n.getData(),width:n.width,height:n.height}:null),mode:e.mode,startX:e.startX,startY:e.startY}}},unserialize:function(n){var r,t=this;return n&&t.name===n.filter&&(t._isOn=!!n._isOn,r=n.params,t.startX=r.startX,t.startY=r.startY,t.blendImage=null,t._blendImage=r._blendImage,t._blendImage&&(t._blendImage.data=e.Util.Array.typed(t._blendImage.data,e.ImArray)),t.setMode(r.mode)),t},reset:function(){var e=this;return e.startX=0,e.startY=0,e.mode=null,e},apply:function(e,n,r){var t=this,l=t.blendImage;if(!t._isOn||!t.mode||!l&&!t._blendImage)return e;var u,c,f,h,d,m,p,_,g,v,y,O,C,b,I=t._blendImage||{data:l.getData(),width:l.width,height:l.height},w=t.startX||0,Y=t.startY||0,M=0,X=0,A=o[t.mode];if(0>w&&(M=-w,w=0),0>Y&&(X=-Y,Y=0),h=I.width,d=I.height,w>=n||Y>=r)return e;if(M>=h||X>=d)return e;if(w=i(w),Y=i(Y),M=i(M),X=i(X),u=a(n-w,h-M),c=a(r-Y,d-X),0>=u||0>=c)return e;for(f=I.data,v=w,y=Y*n,O=M,C=X*h,m=w+u,p=M+u,_=0,g=c*u;g>_;_++)b=O+C<<2,0<f[b+3]&&A(e,f,v+y<<2,b,s),v++,v>=m&&(v=w,y+=n),O++,O>=p&&(O=M,C+=h);return e}})}(n),!function(e,n){var t=e.ImArray,a=e.Util.Filter.integral_convolution,i=new e.ConvolutionMatrix([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]);e.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:3,path:r,init:function(e,n,r,t,a){var i=this;i.offsetX=e||0,i.offsetY=n||0,i.color=r||0,i.opacity=null==t?1:+t,i.quality=a||3},dispose:function(){var e=this;return e.offsetX=null,e.offsetY=null,e.color=null,e.opacity=null,e.quality=null,e.$super("dispose"),e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{offsetX:e.offsetX,offsetY:e.offsetY,color:e.color,opacity:e.opacity,quality:e.quality}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.offsetX=n.offsetX,r.offsetY=n.offsetY,r.color=n.color,r.opacity=n.opacity,r.quality=n.quality),r},apply:function(e,n,r){var s=this;if(!s._isOn)return e;var o,l,u,c,f,h,d,m,p=s.color||0,_=~~s.quality,g=s.offsetX||0,v=s.offsetY||0,y=s.opacity,O=p>>>16&255,C=p>>>8&255,b=255&p,I=e.length,w=I>>>2;if(0>y&&(y=0),y>1&&(y=1),0===y)return e;for(0>=_&&(_=1),_>3&&(_=3),m=new t(I),o=0;I>o;o+=4)d=e[o+3],d>0?(m[o]=O,m[o+1]=C,m[o+2]=b,m[o+3]=~~(y*d)):(m[o]=0,m[o+1]=0,m[o+2]=0,m[o+3]=0);for(m=a(!1,m,n,r,i,null,3,3,1,0,_),v*=n,l=0,u=0,h=0;I>h;h+=4,l++)l>=n&&(l=0,u+=n),c=l+g,f=u+v,0>c||c>=n||0>f||f>=w||(o=c+f<<2,d=e[o+3],y=m[h+3],255!==d&&0!==y&&(y/=255,O=~~(e[o]+(m[h]-e[o])*y),C=~~(e[o+1]+(m[h+1]-e[o+1])*y),b=~~(e[o+2]+(m[h+2]-e[o+2])*y),e[o]=O,e[o+1]=C,e[o+2]=b));return e}})}(n),!function(e){var n=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=e._notSupportClamp,s=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,n,r,t){var a=this;a.centerX=e||0,a.centerY=n||0,a.radius=r||10,a.amount=t||10},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.centerX=n.centerX,r.centerY=n.centerY,r.radius=n.radius,r.amount=n.amount),r},apply:function(e,r,o){var l=this;if(!l._isOn)return e;var u,c,f,h,d,m,p,_,g,v,y,O,C,b,I,w,Y,M,X,A,z,x,R,F,S,E,L,N,k,T,D,P,H,U=e.length,G=l.centerX||0,q=l.centerY||0,$=l.radius,j=l.amount;if(0>=j)return e;for(u=U>>>2,T=0,D=r-1,P=0,H=u-r,G=a(G*(r-1)),q=a(q*(o-1)),f=(u<<1)+u,p=(r<<1)+r,c=new s(f),_=0,g=0,v=0,h=d=m=0,v=0;r>v;v++,_+=4,g+=3)h+=e[_],d+=e[_+1],m+=e[_+2],c[g]=h,c[g+1]=d,c[g+2]=m;for(_=p+r,g=0,v=0,h=d=m=0,_=p+r;U>_;_+=4,g+=3,v++)v>=r&&(v=0,h=d=m=0),h+=e[_],d+=e[_+1],m+=e[_+2],c[g+p]=c[g]+h,c[g+p+1]=c[g+1]+d,c[g+p+2]=c[g+2]+m;for(v=0,y=0,O=0,_=0;U>_;_+=4,v++)v>=r&&(v=0,y++,O+=r),b=v-G,I=y-q,C=t(b)+t(I),w=C>$?~~n((C-$)*j):~~(C/$+.5),w>0&&(Y=w*r,M=.25/(w*w),X=v-w,A=O-Y,z=v+w,x=O+Y,T>X?X=T:z>D&&(z=D),P>A?A=P:x>H&&(x=H),R=X+A,E=z+x,F=z+A,S=X+x,R=(R<<1)+R,F=(F<<1)+F,S=(S<<1)+S,E=(E<<1)+E,L=M*(c[E]-c[F]-c[S]+c[R]),N=M*(c[E+1]-c[F+1]-c[S+1]+c[R+1]),k=M*(c[E+2]-c[F+2]-c[S+2]+c[R+2]),i&&(L=0>L?0:L>255?255:L,N=0>N?0:N>255?255:N,k=0>k?0:k>255?255:k),e[_]=~~L,e[_+1]=~~N,e[_+2]=~~k);return e}})}(n),!function(e){e.Create({name:"SeamlessTileFilter",type:2,init:function(e){var n=this;n.type=null==e?2:e||0},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{type:e.type}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.type=n.type),r},apply:function(n,r,t){var a,i,s,o,l,u,c,f,h,d,m,p,_,g,v,y=this,O=y.type,C=e.Interpolation.bilinear,b=e.ImArray,I=e.Array8U,w=Math.sqrt;for(r!==t?n=C(n,r,t,p=r>t?r:t,p):p=r,_=Math.round(p/2),g=p*p,v=n.length,a=new b(v),i=new b(v),s=new I(g),f=0,h=0,d=0;v>d;d+=4,f++)f>=p&&(f=0,h++),m=(f+_)%p+(h+_)%p*p<<2,a[m]=n[d],a[m+1]=n[d+1],a[m+2]=n[d+2],a[m+3]=n[d+3];if(0===O)for(f=0,h=0;_>f;h++)h>=_&&(h=0,f++),c=255-255*w((f-_)*(f-_)+(h-_)*(h-_))/_,c=1>c?1:c>255?255:c,s[f+h*p]=c,s[f+(p-1-h)*p]=c,s[p-1-f+h*p]=c,s[p-1-f+(p-1-h)*p]=c;else if(1===O)for(f=0,h=0;_>f;h++)h>=_&&(h=0,f++),c=255-255*(_+f>_+h?(h-_)/_:(f-p/2)/_),c=1>c?1:c>255?255:c,s[f+h*p]=c,s[f+(p-1-h)*p]=c,s[p-1-f+h*p]=c,s[p-1-f+(p-1-h)*p]=c;else for(f=0,h=0;_>f;h++)h>=_&&(h=0,f++),c=255-255*(_+f>_+h?w((h-p)*(h-p)+(f-p)*(f-p))/(1.13*p):w((f-p)*(f-p)+(h-p)*(h-p))/(1.13*p)),c=1>c?1:c>255?255:c,s[f+h*p]=c,s[f+(p-1-h)*p]=c,s[p-1-f+h*p]=c,s[p-1-f+(p-1-h)*p]=c;for(h=0,f=0;p>h;f++)f>=p&&(f=0,h++),m=f+h*p,o=s[m],l=s[(f+_)%p+(h+_)%p*p],u=o+l,o/=u,l/=u,m<<=2,i[m]=~~(o*n[m]+l*a[m]),i[m+1]=~~(o*n[m+1]+l*a[m+1]),i[m+2]=~~(o*n[m+2]+l*a[m+2]),i[m+3]=n[m+3];return r!==t&&(i=C(i,p,p,r,t)),i}})}(n),!function(e){var n=e.Util.Array.typed,t=Math.abs,a=(Math.min,Math.max,Math.ceil),i=e.MODE,s=e.Array8U,o=e.Array32U;e.Create({name:"FloodFillFilter",x:0,y:0,color:null,borderColor:null,tolerance:0,path:r,init:function(e,n,r,t,a){var i=this;i.x=e||0,i.y=n||0,i.color=r||0,i.tolerance=t||0,i.borderColor=a===+a?+a:null;
},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{color:e.color,borderColor:e.borderColor,x:e.x,y:e.y,tolerance:e.tolerance}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.color=n.color,r.borderColor=n.borderColor,r.x=n.x,r.y=n.y,r.tolerance=n.tolerance),r},apply:function(e,n,r){var a,i,o,l,u,c,f,h,d,m,p,_,g=this,v=~~(255*(g.tolerance>=1?.999:g.tolerance)),y=g.color||0,O=g.borderColor,C=O===+O,b=n<<2,I=g.x,w=g.y,Y=e.length,M=0,X=Y-b,A=0,z=n-1<<2;if(h=w*n<<2,I<<=2,A>I||I>z||M>h||h>X)return e;if(a=new s(3),i=new s(3),i[0]=y>>>16&255,i[1]=y>>>8&255,i[2]=255&y,C){if(a[0]=O>>>16&255,a[1]=O>>>8&255,a[2]=255&O,t(a[0]-e[I+h])<=v&&t(a[1]-e[I+h+1])<=v&&t(a[2]-e[I+h+2])<=v)return e}else{if(e[I+h]===i[0]&&e[I+h+1]===i[1]&&e[I+h+2]===i[2])return e;a[0]=e[I+h],a[1]=e[I+h+1],a[2]=e[I+h+2]}for(d=new Array(Y>>>2),m=0,h+b>=M&&X>=h+b&&(d[m++]=[h,I,I,b]),d[m++]=[h+b,I,I,-b];m>0;){if(p=d[--m],h=p[0]+(b=p[3]),c=p[1],f=p[2],C)for(u=c;u>=A&&(l=u+h,!(t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v));u-=4)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];else for(u=c;u>=A&&(l=u+h,t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v);u-=4)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];if(u>=c){if(l=u+h,C)for(;f>=u&&t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v;)u+=4,l=u+h;else for(;f>=u&&!(t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v);)u+=4,l=u+h;o=u,_=f>=u}else o=u+4,c>o&&h-b>=M&&X>=h-b&&(d[m++]=[h,o,c-4,-b]),u=c+4,_=!0;for(;_;){if(l=u+h,C)for(;z>=u&&!(t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v);)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],u+=4,l=u+h;else for(;z>=u&&t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v;)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],u+=4,l=u+h;if(h+b>=M&&X>=h+b&&(d[m++]=[h,o,u-4,b]),u>f+4&&h-b>=M&&X>=h-b&&(d[m++]=[h,f+4,u-4,-b]),l=u+h,C)for(;f>=u&&t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v;)u+=4,l=u+h;else for(;f>=u&&!(t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v);)u+=4,l=u+h;o=u,_=f>=u}}return e}}),e.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:0,pattern:null,_pattern:null,mode:i.TILE,borderColor:null,path:r,init:function(e,n,r,t,a,s,o,l){var u=this;u.x=e||0,u.y=n||0,u.offsetX=t||0,u.offsetY=a||0,r&&u.setPattern(r),u.mode=s||i.TILE,u.tolerance=o||0,u.borderColor=l===+l?+l:null},dispose:function(){var e=this;return e.pattern=null,e._pattern=null,e.x=null,e.y=null,e.offsetX=null,e.offsetY=null,e.tolerance=null,e.mode=null,e.borderColor=null,e.$super("dispose"),e},setPattern:function(e){var n=this;return e&&(n.pattern=e,n._pattern=null),n},serialize:function(){var e=this,n=e.pattern;return{filter:e.name,_isOn:!!e._isOn,params:{x:e.x,y:e.y,offsetX:e.offsetX,offsetY:e.offsetY,tolerance:e.tolerance,mode:e.mode,borderColor:e.borderColor,_pattern:e._pattern||(n?{data:n.getData(),width:n.width,height:n.height}:null)}}},unserialize:function(r){var t,a=this;return r&&a.name===r.filter&&(a._isOn=!!r._isOn,t=r.params,a.x=t.x,a.y=t.y,a.offsetX=t.offsetX,a.offsetY=t.offsetY,a.tolerance=t.tolerance,a.mode=t.mode,a.borderColor=t.borderColor,a.pattern=null,a._pattern=t._pattern,a._pattern&&(a._pattern.data=n(a._pattern.data,e.ImArray))),a},apply:function(e,n,r){var l=this,u=l.pattern;if(!l._isOn||!u&&!l._pattern)return e;var c,f,h,d,m,p,_,g,v,y,O,C,b,I,w,Y,M=l._pattern||{data:u.getData(),width:u.width,height:u.height},X=~~(255*(l.tolerance>=1?.999:l.tolerance)),A=l.mode,z=l.borderColor,x=z===+z,R=n<<2,F=M.data,S=M.width,E=M.height,L=l.x,N=l.y,k=l.offsetX||0,T=l.offsetY||0,D=e.length,P=D>>>2,H=0,U=D-R,G=0,q=n-1<<2,$=i.STRETCH;if(0>k&&(k+=S),0>T&&(T+=E),m=N,g=N*n<<2,L<<=2,G>L||L>q||H>g||g>U)return e;if(c=new s(3),x){if(c[0]=z>>>16&255,c[1]=z>>>8&255,c[2]=255&z,t(c[0]-e[L+g])<=X&&t(c[1]-e[L+g+1])<=X&&t(c[2]-e[L+g+2])<=X)return e}else c[0]=e[L+g],c[1]=e[L+g+1],c[2]=e[L+g+2];for(C=new Array(P),b=0,I=new o(a(P/32)),g+R>=H&&U>=g+R&&(C[b++]=[g,L,L,R,m+1]),C[b++]=[g+R,L,L,-R,m];b>0;){if(w=C[--b],g=w[0]+(R=w[3]),p=w[1],_=w[2],m=w[4],x)for(d=p;d>=G&&(h=d+g,!(I[h>>>7]&1<<(h>>>2&31)||t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X));d-=4)I[h>>>7]|=1<<(h>>>2&31),$===A?(y=~~(S*(d>>>2)/n),O=~~(E*m/r)):(y=((d>>>2)+k)%S,O=(m+T)%E),v=y+O*S<<2,e[h]=F[v],e[h+1]=F[v+1],e[h+2]=F[v+2];else for(d=p;d>=G&&(h=d+g,!(I[h>>>7]&1<<(h>>>2&31))&&t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X);d-=4)I[h>>>7]|=1<<(h>>>2&31),$===A?(y=~~(S*(d>>>2)/n),O=~~(E*m/r)):(y=((d>>>2)+k)%S,O=(m+T)%E),v=y+O*S<<2,e[h]=F[v],e[h+1]=F[v+1],e[h+2]=F[v+2];if(d>=p){if(h=d+g,x)for(;_>=d&&I[h>>>7]&1<<(h>>>2&31)||t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X;)d+=4,h=d+g;else for(;_>=d&&!(!(I[h>>>7]&1<<(h>>>2&31))&&t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X);)d+=4,h=d+g;f=d,Y=_>=d}else f=d+4,p>f&&g-R>=H&&U>=g-R&&(C[b++]=[g,f,p-4,-R,R>0?m-1:m+1]),d=p+4,Y=!0;for(;Y;){if(h=d+g,x)for(;q>=d&&!(I[h>>>7]&1<<(h>>>2&31))&&!(t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X);)I[h>>>7]|=1<<(h>>>2&31),$===A?(y=~~(S*(d>>>2)/n),O=~~(E*m/r)):(y=((d>>>2)+k)%S,O=(m+T)%E),v=y+O*S<<2,e[h]=F[v],e[h+1]=F[v+1],e[h+2]=F[v+2],d+=4,h=d+g;else for(;q>=d&&!(I[h>>>7]&1<<(h>>>2&31))&&t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X;)I[h>>>7]|=1<<(h>>>2&31),$===A?(y=~~(S*(d>>>2)/n),O=~~(E*m/r)):(y=((d>>>2)+k)%S,O=(m+T)%E),v=y+O*S<<2,e[h]=F[v],e[h+1]=F[v+1],e[h+2]=F[v+2],d+=4,h=d+g;if(g+R>=H&&U>=g+R&&(C[b++]=[g,f,d-4,R,R>0?m+1:m-1]),d>_+4&&g-R>=H&&U>=g-R&&(C[b++]=[g,_+4,d-4,-R,R>0?m-1:m+1]),h=d+g,x)for(;_>=d&&I[h>>>7]&1<<(h>>>2&31)||t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X;)d+=4,h=d+g;else for(;_>=d&&!(!(I[h>>>7]&1<<(h>>>2&31))&&t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X);)d+=4,h=d+g;f=d,Y=_>=d}}return e}})}(n),!function(e){function n(e,n,r,t,a,i){var s,o,l,c,p,y=e.length,O=new u(y),C=new u(y),b=new u(y),I=new u(y),w=new u(i),Y=new u(i),M=a*a,X=2*M,A=_*M;for(s=0;i>s&&(o=v(-(s*s)/X),!(f>=o&&s>=2));s++)l=v(-((p=s-.5)*p)/X),c=v(-((p=s+.5)*p)/X),w[s]=(o+l+c)/3/A,Y[s]=c-l;var p,z,x,R,F,S,E,L,N,k=s-1,T=n-(s-1),D=n*(s-1),P=n*(r-(s-1));for(p=k,z=D;T>p;z+=n){for(z>=P&&(z=D,p++),x=p+z,R=e[x]*w[0],F=R,S=1,E=n;s>S;)F+=w[S]*(e[x-E]+e[x+E]),R+=w[S]*(e[x-S]+e[x+S]),E+=n,S++;C[x]=F,O[x]=R}for(p=k,z=D;T>p;z+=n){for(z>=P&&(z=D,p++),L=0,x=p+z,N=1;s>N;N++)L+=Y[N]*(C[x-N]-C[x+N]);b[x]=L}for(T=n-s,p=s,z=D;T>p;z+=n){for(z>=P&&(z=D,p++),L=0,x=p+z,E=n,N=1;s>N;N++)L+=Y[N]*(O[x-E]-O[x+E]),E+=n;I[x]=L}k=s,T=n-s,D=n*s,P=n*(r-s);var H,U,G,q,$,j,W,B,J,K,Q,V,Z,ee,ne,re,te,ae,ie,se;for(p=k,z=D;T>p;z+=n)z>=P&&(z=D,p++),x=p+z,H=x-n,U=x+n,q=x-1,G=x+1,$=H-1,j=H+1,W=U-1,B=U+1,J=b[x],K=I[x],Q=g(J)+g(K),Z=g(b[H])+g(I[H]),ee=g(b[U])+g(I[U]),re=g(b[q])+g(I[q]),ne=g(b[G])+g(I[G]),ae=g(b[j])+g(I[j]),se=g(b[B])+g(I[B]),ie=g(b[W])+g(I[W]),te=g(b[$])+g(I[$]),(0>=J*K?g(J)>=g(K)?(V=g(J*Q))>=g(K*ae-(J+K)*ne)&&V>g(K*ie-(J+K)*re):(V=g(K*Q))>=g(J*ae-(K+J)*Z)&&V>g(J*ie-(K+J)*ee):g(J)>=g(K)?(V=g(J*Q))>=g(K*se+(J-K)*ne)&&V>g(K*te+(J-K)*re):(V=g(K*Q))>=g(J*se+(K-J)*ee)&&V>g(J*te+(K-J)*Z))?t[x]=Q>=d?m:Math.floor(h*Q):t[x]=0}function t(e,n,r,t,i,s){var o,l,u,c=0,f=e.length;for(o=0;f>o;o++)e[o]=0;for(u=0,l=0,c=0;f>c;c++,u++)u>=n&&(u=0,l++),0===e[c]&&t[c]>=s&&a(e,n,r,t,u,l,c,i)}function a(e,n,r,t,i,s,o,l){var u,c,f,h=0===i?i:i-1,d=i===n-1?i:i+1,m=0===s?s:s-1,p=s===r-1?s:s+1;for(e[o]=t[o],u=h,c=m;d>=u&&p>=c;){if(f=u+c*n,(c!=s||u!=i)&&0===e[f]&&t[f]>=l)return void a(e,n,r,t,u,c,f,l);c++,c>p&&(c=m,u++)}}function i(e,n){var r,t,a,i,s,o=e.length,l=p[0],u=p[1],c=p[2];for(r=0,t=0;o>r;r+=4,t++)a=e[r],i=e[r+1],s=e[r+2],n[t]=~~(l*a+u*i+c*s+.5)}function s(e){var n,r,t,a,i,s=new c(256),o=new c(256),l=e.length;for(n=0;l>n;n++)s[e[n]]++;for(r=0,t=0,n=0;256>n;n++){for(r+=s[n],i=255*r/l,a=t+1;i>=a;a++)o[a]=n;t=i}for(n=0;l>n;n++)e[n]=o[e[n]]}function o(e,n){var r,t,a,i=e.length;for(r=0,t=0;i>r;r+=4,t++)a=n[t]>0?255:0,e[r]=e[r+1]=e[r+2]=a}var l,u=e.Array32F,c=e.Array32I,f=.005,h=100,d=1e3,m=h*d,p=e.LUMA,_=e.CONST.PI2,g=Math.abs,v=Math.exp;l=Math.hypot?Math.hypot:function(e,n){return g(e)+g(n)},e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,gaussRadius:2,gaussWidth:16,contrastNormalized:!1,path:r,init:function(e,n,r,t,a){var i=this;i.low=arguments.length<1?2.5:e,i.high=arguments.length<2?7.5:n,i.gaussRadius=arguments.length<3?2:r,i.gaussWidth=arguments.length<4?16:t,i.contrastNormalized=!!a},thresholds:function(e,n){var r=this;return r.low=e,r.high=n,r},kernel:function(e,n){var r=this;return r.gaussRadius=e,r.gaussWidth=n,r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{low:e.low,high:e.high,gaussRadius:e.gaussRadius,gaussWidth:e.gaussWidth,contrastNormalized:e.contrastNormalized}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.low=n.low,r.high=n.high,r.gaussRadius=n.gaussRadius,r.gaussWidth=n.gaussWidth,r.contrastNormalized=n.contrastNormalized),r},apply:function(e,r,a){var l,u,f,d,m=this,p=e.length>>2;return f=new c(p),d=new c(p),l=Math.round(m.low*h),u=Math.round(m.high*h),i(e,f),m.contrastNormalized&&s(f),n(f,r,a,d,m.gaussRadius,m.gaussWidth),t(f,r,a,d,l,u),o(e,f),e}})}(n),!function(e,n){function t(e,n,r,t){var a,i,s,o,l,u,c,d,m,p,_,g=t.length,v=new f(g),y=n-1,O=r-1,C=n-2,b=r-2,I=n<<1,w=n<<2;for(a=0;n>a;a++)v[a]=0,v[a+n]=0,v[a+g-n]=0,v[a+g-n-n]=0,t[a]=0,t[a+g-n]=0;for(i=0,s=0;r>i;i++,s+=n)v[0+s]=0,v[1+s]=0,v[n-1+s]=0,v[n-2+s]=0,t[0+s]=0,t[n-1+s]=0;for(a=2,i=2,s=I;C>a;i++,s+=n)i>=b&&(i=2,s=I,a++),c=a+s<<2,d=c+w,m=d+w,p=c-w,_=p-w,o=(e[_-8]<<1)+(e[p-8]<<2)+(e[c-8]<<2)+e[c-8]+(e[d-8]<<2)+(e[m-8]<<1)+(e[_-4]<<2)+(e[p-4]<<3)+e[p-4]+(e[c-4]<<4)-(e[c-4]<<2)+(e[d-4]<<3)+e[d-4]+(e[m-4]<<2)+(e[_]<<2)+e[_]+(e[p]<<4)-(e[p]<<2)+(e[c]<<4)-e[c]+(e[d]<<4)-(e[d]<<2)+(e[m]<<2)+e[m]+(e[_+4]<<2)+(e[p+4]<<3)+e[p+4]+(e[c+4]<<4)-(e[c+4]<<2)+(e[d+4]<<3)+e[d+4]+(e[m+4]<<2)+(e[_+8]<<1)+(e[p+8]<<2)+(e[c+8]<<2)+e[c+8]+(e[d+8]<<2)+(e[m+8]<<1),v[c]=((103*o+8192&4294967295)>>>14&255)>>>0;for(a=1,i=1,s=n;y>a;i++,s+=n)i>=O&&(i=1,s=n,a++),c=s+a,d=c+n,p=c-n,l=0-v[p-1]+v[p+1]-v[c-1]-v[c-1]+v[c+1]+v[c+1]-v[d-1]+v[d+1],u=0+v[p-1]+v[p]+v[p]+v[p+1]-v[d-1]-v[d]-v[d]-v[d+1],t[c]=h(l)+h(u);for(a=0,o=0;n>a;a++)o+=t[a],t[a]=o;for(a=n,s=0,o=0;g>a;a++,s++)s>=n&&(s=0,o=0),o+=t[a],t[a]=t[a-n]+o}function a(e,n,r,t,a,i,s,o,l,u,c,f,h,d,_,g,v){var C,b,I,w,Y,M,X,A,z,x,R,F,S,E,L,N,k,T,D,P,H,U,G,q,$,j,W,B,J,K,Q,V,Z,ee,D,ne,re,te,ae,ie,se,oe,le,ue,ce,fe,he,de,me,pe,_e,ge,ve,ye=null!=_,Oe=i-t+1,Ce=s-a+1,be=Oe*Ce,Ie=be-1,we=o.stages,Ye=we.length,Me=o.size1,Xe=o.size2,Ae=m(Oe/Me,Ce/Xe),ze=t,xe=a;for(P=0,H=Oe-1,U=0,G=be-Oe,C=l,C=l;Ae>=C;C*=u)for(w=~~(C*Me),b=~~(w*c),Y=~~(C*Xe),I=~~(Y*c),x=Y*Oe,R=I*Oe,M=xe*R,N=Oe-w,k=Ce-Y,q=w*Y,$=1/q,A=xe,z=M;k>A;A+=I,z+=R)for(X=ze;N>X;X+=b)if(F=X-1+z-Oe,S=F+w,E=F+x,L=E+w,F=0>F?0:F>Ie?Ie:F,S=0>S?0:S>Ie?Ie:S,E=0>E?0:E>Ie?Ie:E,L=0>L?0:L>Ie?Ie:L,!(ye&&(J=$*(_[L]-_[E]-_[S]+_[F]),g>J||J>v))){for(j=$*(f[L]-f[E]-f[S]+f[F]),W=$*(d[L]-d[E]-d[S]+d[F]),B=W-j*j,B=B>1?p(B):1,K=!1,T=0;Ye>T;T++){for(Q=we[T],V=Q.thres,Z=Q.trees,ee=Z.length,ve=0,D=0;ee>D;D++)for(re=Z[D].feats,ne=0;;){if(te=re[ne],ae=te.rects,ie=ae.length,se=te.thres,oe=0,te.tilt)for(le=0;ie>le;le++)ue=ae[le],ce=X+~~(C*ue[0]),fe=(A-1+~~(C*ue[1]))*Oe,he=X+~~(C*(ue[0]+ue[2])),de=(A-1+~~(C*(ue[1]+ue[2])))*Oe,me=X+~~(C*(ue[0]-ue[3])),pe=(A-1+~~(C*(ue[1]+ue[3])))*Oe,_e=X+~~(C*(ue[0]+ue[2]-ue[3])),ge=(A-1+~~(C*(ue[1]+ue[2]+ue[3])))*Oe,ce=P>ce?P:ce>H?H:ce,he=P>he?P:he>H?H:he,me=P>me?P:me>H?H:me,_e=P>_e?P:_e>H?H:_e,fe=U>fe?U:fe>G?G:fe,de=U>de?U:de>G?G:de,pe=U>pe?U:pe>G?G:pe,ge=U>ge?U:ge>G?G:ge,oe+=ue[4]*(h[_e+ge]-h[me+pe]-h[he+de]+h[ce+fe]);else for(le=0;ie>le;le++)ue=ae[le],ce=X-1+~~(C*ue[0]),he=X-1+~~(C*(ue[0]+ue[2])),fe=Oe*(A-1+~~(C*ue[1])),de=Oe*(A-1+~~(C*(ue[1]+ue[3]))),ce=P>ce?P:ce>H?H:ce,he=P>he?P:he>H?H:he,fe=U>fe?U:fe>G?G:fe,de=U>de?U:de>G?G:de,oe+=ue[4]*(f[he+de]-f[ce+de]-f[he+fe]+f[ce+fe]);if(se*B>oe*$){if(te.has_l){ve+=te.l_val;break}ne=te.l_node}else{if(te.has_r){ve+=te.r_val;break}ne=te.r_node}}if(K=ve>V,!K)break}K&&(e.count===e.length&&O.apply(e,new Array(y)),e[e.count++]=[X,A,w,Y])}}function i(e,n,r){var t=d(n[2],e[2])*r,a=d(n[3],e[3])*r;return h(e[0]-n[0])<=t&&h(e[1]-n[1])<=a&&h(e[2]-n[2])<=t&&h(e[3]-n[3])<=a}function s(e,n){return e.x1>=n.x1&&e.y1>=n.y1&&e.x2<=n.x2&&e.y2<=n.y2}function o(e){e.x1=~~(e.x1+.5),e.y1=~~(e.y1+.5),e.x2=~~(e.x2+.5),e.y2=~~(e.y2+.5)}function l(e,n){return n.area-e.area}function u(e,n,r){var t,a,u,c,f,h,d,m,p,_,g,v=e.length,y=new Array(v),O=[],C=0,b=!1;for(u=0;v>u;u++)y[u]=0;for(u=0;v>u;u++){for(b=!1,c=0;u>c;c++)i(e[c],e[u],r)&&(b=!0,y[u]=y[c]);b||(y[u]=C,C++)}for(t=new Array(C),a=new Array(C),u=0;C>u;u++)t[u]=0,a[u]=[0,0,0,0];for(u=0;v>u;u++)d=y[u],t[d]++,a[d][0]+=e[u][0],a[d][1]+=e[u][1],a[d][2]+=e[u][2],a[d][3]+=e[u][3];for(u=0;C>u;u++)f=t[u],f>=n&&(h=1/(f+f),m=h*(2*a[u][0]+f),p=h*(2*a[u][1]+f),_=h*(2*a[u][2]+f),g=h*(2*a[u][3]+f),O.push({x1:m,y1:p,x2:m+_-1,y2:p+g-1,x:m,y:p,width:_,height:g,area:0,inside:0}));for(v=O.length,u=0;v>u;u++)for(c=u+1;v>c;c++)!O[u].inside&&s(O[u],O[c])?O[u].inside=1:!O[c].inside&&s(O[c],O[u])&&(O[c].inside=1);for(u=v;--u>=0;)O[u].inside?O.splice(u,1):(o(O[u]),O[u].area=O[u].width*O[u].height);return O.sort(l)}var c=e.Array32F,f=e.Array8U,h=Math.abs,d=Math.max,m=Math.min,p=(Math.floor,Math.round,Math.sqrt),_=e.Util.Array.typed,g=e.Util.Array.typed_obj,v="hasOwnProperty",y=10,O=Array.prototype.push,C=e.Util.Filter.SAT;e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,selection:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,r,t,a,i,s,o){var l=this;l.objects=null,l.haardata=e||null,l.baseScale=n===r?1:r,l.scaleIncrement=n===t?1.25:t,l.stepIncrement=n===a?.5:a,l.minNeighbors=n===i?1:i,l.doCannyPruning=n===s?!0:!!s,l.tolerance=null==o?.2:+o,l._haarchanged=!!l.haardata},path:r,dispose:function(){var e=this;return e.selection=null,e.objects=null,e.haardata=null,e.$super("dispose"),e},haar:function(e){var n=this;return n.haardata=e,n._haarchanged=!0,n},select:function(e,n,r,t){var a=this;return!1===e?a.selection=null:a.selection=[m(1,d(0,e||0)),m(1,d(0,n||0)),m(1,d(0,r||0)),m(1,d(0,t||0))],a},params:function(e){var n=this;return e&&(e[v]("haardata")&&(n.haardata=e.haardata,n._haarchanged=!0),e[v]("baseScale")&&(n.baseScale=e.baseScale),e[v]("scaleIncrement")&&(n.scaleIncrement=e.scaleIncrement),e[v]("stepIncrement")&&(n.stepIncrement=e.stepIncrement),e[v]("minNeighbors")&&(n.minNeighbors=e.minNeighbors),e[v]("doCannyPruning")&&(n.doCannyPruning=e.doCannyPruning),e[v]("tolerance")&&(n.tolerance=e.tolerance),e[v]("cannyLow")&&(n.cannyLow=e.cannyLow),e[v]("cannyHigh")&&(n.cannyHigh=e.cannyHigh),e[v]("selection")&&(n.selection=e.selection||null)),n},serialize:function(){var e=this,n={filter:e.name,_isOn:!!e._isOn,_update:e._update,params:{baseScale:e.baseScale,scaleIncrement:e.scaleIncrement,stepIncrement:e.stepIncrement,minNeighbors:e.minNeighbors,doCannyPruning:e.doCannyPruning,tolerance:e.tolerance,cannyLow:e.cannyLow,cannyHigh:e.cannyHigh,selection:e.selection}};return e._haarchanged&&(n.params.haardata=g(e.haardata),e._haarchanged=!1),n},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=e._isOn,r._update=e._update,n=e.params,n[v]("haardata")&&(r.haardata=g(n.haardata,1)),r.baseScale=n.baseScale,r.scaleIncrement=n.scaleIncrement,r.stepIncrement=n.stepIncrement,r.minNeighbors=n.minNeighbors,r.doCannyPruning=n.doCannyPruning,r.tolerance=n.tolerance,r.cannyLow=n.cannyLow,r.cannyHigh=n.cannyHigh,r.selection=_(n.selection,Array)),r},getMeta:function(){return e.isWorker?g(this.objects):this.objects},setMeta:function(e){return this.objects="string"==typeof e?g(e,1):e,this},apply:function(e,n,r,i,s){var o=this;if(!o._isOn||!o.haardata)return e;var l,f,h,p,_,g=e.length>>>2,v=o.selection||null,O=null,b=null,I=null,w=null;return v?(l=m(n-1,d(0,v[0]*(n-1))),f=m(r-1,d(0,v[1]*(r-1))),h=m(n-1,d(0,v[2]*(n-1))),p=m(r-1,d(0,v[3]*(r-1)))):(l=0,f=0,h=n-1,p=r-1),s&&s.SAT?(O=s.SAT,b=s.SAT2,I=s.RSAT):(C(e,n,r,O=new c(g),b=new c(g),I=new c(g)),s&&(s.SAT=O,s.SAT2=b,s.RSAT=I)),o.doCannyPruning&&(s&&s.EDGES?w=s.EDGES:(t(e,n,r,w=new c(g)),s&&(s.EDGES=w))),_=new Array(y),_.count=0,a(_,n,r,l,f,h,p,o.haardata,o.baseScale,o.scaleIncrement,o.stepIncrement,O,I,b,w,o.cannyLow,o.cannyHigh),_.length>_.count&&(_.length=_.count),o.objects=u(_,o.minNeighbors,o.tolerance),e}}),e.HaarDetectorFilter.detect=a,e.HaarDetectorFilter.merge=u}(n),!function(e,n){function t(e,n){for(;n[e][1]!==e;)n[e][1]=n[n[e][1]][1],e=n[e][1];return e}function a(e,n,r){var a=t(e,r),i=t(n,r);a!==i&&(r[a][1]=i)}function i(e,n,r){var t=r.next;return t+1>r.length&&Array.prototype.push.apply(r,new Array(O)),r[t]=[t,t,0],++r.next,t}function s(e,n,r,t){return e}function o(e,n,r,t,a){return 0===e[n+3]&&0===e[r+3]||y(e[n]-e[r])<=t&&y(e[n+1]-e[r+1])<=t&&y(e[n+2]-e[r+2])<=t}function l(e,n,r,t,a){return y(n[r]-e[0])<=t&&y(n[r+1]-e[1])<=t&&y(n[r+2]-e[2])<=t}function u(e,n,r,t,a){if(0===e[n+3]&&0===e[r+3])return!0;var i=n>>>2,s=r>>>2;return null==a[i]&&(a[i]=_(e[n],e[n+1],e[n+2])),null==a[s]&&(a[s]=_(e[r],e[r+1],e[r+2])),y(a[i],a[s])<=t}function c(e,n,r,t,a){var i=r>>>2;return null==a[i]&&(a[i]=_(n[r],n[r+1],n[r+2])),y(a[i],e)<=t}function f(e,n,r,t,a){if(0===e[n+3]&&0===e[r+3])return!0;var i=n>>>2,s=r>>>2;return null==a[i]&&(a[i]=p(e[n],e[n+1],e[n+2])),null==a[s]&&(a[s]=p(e[r],e[r+1],e[r+2])),y(a[i],a[s])<=t}function h(e,n,r,t,a){var i=r>>>2;return null==a[i]&&(a[i]=p(n[r],n[r+1],n[r+2])),y(a[i],e)<=t}var d=e.Array32U,m=e.MODE,p=e.Color.hue,_=e.Color.intensity,g=Math.min,v=Math.max,y=Math.abs,O=20;e.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:0,mode:m.COLOR,color:null,invert:!1,box:null,init:function(e,n,r,t,a){var i=this;i.connectivity=8===e?8:4,i.tolerance=n||0,i.mode=r||m.COLOR,i.color=null==t?null:t,i.invert=!!a},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{connectivity:e.connectivity,tolerance:e.tolerance,mode:e.mode,color:e.color,invert:e.invert}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.connectivity=n.connectivity,r.tolerance=n.tolerance,r.mode=n.mode,r.color=n.color,r.invert=n.invert),r},apply:function(e,n,r){var p=this;if(!p._isOn)return e;var _,y,C,b,I,w,Y,M,X,A,z,x,R=e.length,F=R>>>2,S=n<<2,E=p.mode||m.COLOR,L=p.invert,N=p.color,k=g(.999,v(0,p.tolerance||0)),T=8===p.connectivity?8:4,D=8===T,P=D?-1:0,H=P<<2,U=null,G=null,q=null,$=null,j=null!=N;for(X=new Array(O),X.next=0,A=new d(F),m.HUE===E?(k*=360,U=f,G=new Array(F),j&&(q=h)):m.INTENSITY===E?(k*=255,U=u,G=new Array(F),j&&(q=c)):(k*=255,U=o,j&&(N=[N>>>16&255,N>>>8&255,255&N],q=l)),$=j?i(0,0,X):null,A[0]=j&&!q(N,e,0,k,G)?$:i(0,0,X),I=1,_=4;n>I;I++,_+4)A[I]=j&&!q(N,e,_,k,G)?$:U(e,_,_-4,k,G)?s(A[I-1],I,0,X):i(I,0,X);for(w=1,M=n,_=S;r>w;w++,M+=n,_+=S)for(A[M]=j&&!q(N,e,_,k,G)?$:U(e,_,_-S,k,G)?s(A[M-n],0,w,X):i(0,w,X),I=1,y=4;n>I;I++,y+=4)if(!j||q(N,e,_+y,k,G)){for(b=$===A[M+I-1]?-1:U(e,_+y,_+y-4,k,G)?s(A[M+I-1],I,w,X):-1,Y=P,C=H;1>Y;Y++,C+=4)$!==A[M-n+I+Y]&&U(e,_+y,_-S+y+C,k,G)&&(b>=0?a(b,A[M-n+I+Y],X):b=s(A[M-n+I+Y],I+Y,w,X));A[M+I]=b>=0?s(b,I,w,X):i(I,w,X),D&&$!==A[M+I-1]&&$!==A[M-n+I]&&U(e,_+y-4,_-S+y,k,G)&&a(A[M+I-1],A[M-n+I],X)}else A[M+I]=$;if(0===$)for(_=0,z=X.next,x=0;z>_;_++)_===X[_][1]&&(X[_][2]=0===X[_][1]?0:++x);else for(_=0,z=X.next,x=0;z>_;_++)_===X[_][1]&&(X[_][2]=x++);if(x=x>0?x:1,L)for(I=0,_=0;R>_;_+=4,I++)N=X[t(A[I],X)][2],N=~~(255-255*N/x),e[_]=N,e[_+1]=N,e[_+2]=N;else for(I=0,_=0;R>_;_+=4,I++)N=X[t(A[I],X)][2],N=~~(255*N/x),e[_]=N,e[_+1]=N,e[_+2]=N;return e}})}(n),n});