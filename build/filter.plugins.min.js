/**
*
*   FILTER.js Plugins
*   @version: 0.6.9
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e,r,n,a){var i="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),l=!i&&"undefined"!=typeof navigator,s="function"==typeof importScripts&&navigator instanceof WorkerNavigator,o=Array,u=o.prototype,h=function(){var t=null;if(i)return t=__filename,{path:__dirname,file:__filename};if(s)t=self.location.href;else if(l){var e;(e=document.getElementsByTagName("script"))&&e.length&&(t=e[e.length-1].src)}return t?{path:t.split("/").slice(0,-1).join("/"),file:t}:{path:null,file:null}},c=h(),f=function(t,e){if(i)return e;if("."==e.charAt(0)){t=t.split("/"),e=e.split("/");var r,n=0,a=0,l=e.length,s=t.length;for(r=0;l>r;r++)if(/^\.\./.test(e[r]))n++,a++;else{if(!/^\./.test(e[r]))break;a++}n=n>=s?0:s-n,e=t.slice(0,n).concat(e.slice(a)).join("/")}return e};r=r?[].concat(r):[];var p,m,d,g=r.length,v=new o(g),C=new o(g),b=new o(g),_=new o(g);for(p=0;g>p;p++)v[p]=r[p][0],C[p]=r[p][1],b[p]=/\.js$/i.test(C[p])?f(c.path,C[p]):f(c.path,C[p]+".js");if("object"==typeof module&&module.exports){if(a===module.exports[e]){for(p=0;g>p;p++)_[p]=module.exports[v[p]]||require(b[p])[v[p]];m=n.apply(t,_),module.exports[e]=m||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(C),function(r){if(a===r[e]){for(var i=u.slice.call(arguments,1),l=i.length,s=0;l>s;s++)_[s]=r[v[s]]||i[s];m=n.apply(t,_),r[e]=m||1}});else if(s){for(p=0;g>p;p++)self[v[p]]||importScripts(b[p]),_[p]=self[v[p]];m=n.apply(t,_),self[e]=m||1}else if(a===t[e]){var M=function(t,e){d=d||document.getElementsByTagName("head")[0];var r=0,n=document.createElement("script");n.type="text/javascript",n.language="javascript",n.onload=n.onreadystatechange=function(){r||n.readyState&&"loaded"!=n.readyState&&"complete"!=n.readyState||(r=1,n.onload=n.onreadystatechange=null,d.removeChild(n),n=null,e&&e())},n.src=t,d.appendChild(n)},y=function(e,r,n){t[e]?n():M(r,n)},F=function(r){return function(){g>r&&(_[r]=t[v[r]]),++r<g?y(v[r],b[r],F(r)):(m=n.apply(t,_),t[e]=m||1)}};g?y(v[0],b[0],F(0)):(m=n.apply(t,_),t[e]=m||1)}}(this,"FILTER_PLUGINS",[["FILTER","./filter"]],function(t){var e=null;return!function(t){"use strict";var e=t._notSupportClamp,r=Math.random;t.NoiseFilter=t.Create({name:"NoiseFilter",min:-127,max:127,init:function(t,e){this.min=t||-127,this.max=e||127},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,params:{min:t.min,max:t.max}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r.min=e.min,r.max=e.max),r},apply:function(t){var n,a,i,l,s,o,u,h,c=this.max-this.min,f=this.min,p=t.length;if(e)for(n=0;p>n;n+=4)i=t[n],l=t[n+1],s=t[n+2],a=c*r()+f,o=i+a,u=l+a,h=s+a,0>o?o=0:o>255&&(o=255),0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),t[n]=~~o,t[n+1]=~~u,t[n+2]=~~h;else for(n=0;p>n;n+=4)i=t[n],l=t[n+1],s=t[n+2],a=c*r()+f,o=i+a,u=l+a,h=s+a,t[n]=~~o,t[n+1]=~~u,t[n+2]=~~h;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F,n=t.Color.RGB2YCbCr,a=t.Color.YCbCr2RGB;t.HistogramEqualizeFilter=t.Create({name:"HistogramEqualizeFilter",path:t.getPath(),apply:function(t){var i,l,s,o,u,h,c,f,p,m,d,g=0,v=255,C=0,b=t.length,_=b>>2,M=1/_;for(u=new r(256),p=0;256>p;p+=4)u[p]=0,u[p+1]=0,u[p+2]=0,u[p+3]=0;for(p=0;b>p;p+=4)i=t[p],l=t[p+1],s=t[p+2],m=n({r:i,g:l,b:s}),i=t[p]=~~m.cr,l=t[p+1]=~~m.y,s=t[p+2]=~~m.cb,u[l]+=M,l>g?g=l:v>l&&(v=l);for(C=0,p=0;256>p;p+=4)C+=u[p],u[p]=C,C+=u[p+1],u[p+1]=C,C+=u[p+2],u[p+2]=C,C+=u[p+3],u[p+3]=C;if(o=g-v,e)for(p=0;b>p;p+=4)m={cr:t[p],y:t[p+1],cb:t[p+2]},m.y=u[m.y]*o+v,d=a(m),h=d.r,c=d.g,f=d.b,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,t[p]=~~h,t[p+1]=~~c,t[p+2]=~~f;else for(p=0;b>p;p+=4)m={cr:t[p],y:t[p+1],cb:t[p+2]},m.y=u[m.y]*o+v,d=a(m),t[p]=~~d.r,t[p+1]=~~d.g,t[p+2]=~~d.b;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F;t.GrayscaleHistogramEqualizeFilter=t.Create({name:"GrayscaleHistogramEqualizeFilter",path:t.getPath(),apply:function(t){var n,a,i,l,s,o=0,u=255,h=0,c=t.length,f=c>>2,p=1/f;for(l=new r(256),s=0;256>s;s+=4)l[s]=0,l[s+1]=0,l[s+2]=0,l[s+3]=0;for(s=0;c>s;s+=4)n=t[s],l[n]+=p,n>o?o=n:u>n&&(u=n);for(h=0,s=0;256>s;s+=4)h+=l[s],l[s]=h,h+=l[s+1],l[s+1]=h,h+=l[s+2],l[s+2]=h,h+=l[s+3],l[s+3]=h;if(i=o-u,e)for(s=0;c>s;s+=4)n=t[s],a=l[n]*i+u,a=0>a?0:a>255?255:a,a=~~a,t[s]=a,t[s+1]=a,t[s+2]=a;else for(s=0;c>s;s+=4)n=t[s],a=~~(l[n]*i+u),t[s]=a,t[s+1]=a,t[s+2]=a;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F;t.RGBHistogramEqualizeFilter=t.Create({name:"RGBHistogramEqualizeFilter",path:t.getPath(),apply:function(t){var n,a,i,l,s,o,u,h,c,f,p,m,d,g,v,C,b=0,_=0,M=0,y=255,F=255,z=255,I=t.length,Y=I>>2,k=1/Y;for(u=new r(256),h=new r(256),c=new r(256),C=0;256>C;C+=4)u[C]=0,h[C]=0,c[C]=0,u[C+1]=0,h[C+1]=0,c[C+1]=0,u[C+2]=0,h[C+2]=0,c[C+2]=0,u[C+3]=0,h[C+3]=0,c[C+3]=0;for(C=0;I>C;C+=4)n=t[C],a=t[C+1],i=t[C+2],u[n]+=k,h[a]+=k,c[i]+=k,n>b?b=n:y>n&&(y=n),a>_?_=a:F>a&&(F=a),i>M?M=i:z>i&&(z=i);for(f=p=m=0,C=0;256>C;C+=4)f+=u[C],u[C]=f,p+=h[C],h[C]=p,m+=c[C],c[C]=m,f+=u[C+1],u[C+1]=f,p+=h[C+1],h[C+1]=p,m+=c[C+1],c[C+1]=m,f+=u[C+2],u[C+2]=f,p+=h[C+2],h[C+2]=p,m+=c[C+2],c[C+2]=m,f+=u[C+3],u[C+3]=f,p+=h[C+3],h[C+3]=p,m+=c[C+3],c[C+3]=m;if(l=b-y,s=_-F,o=M-z,e)for(C=0;I>C;C+=4)n=t[C],a=t[C+1],i=t[C+2],d=u[n]*l+y,g=h[a]*s+F,v=c[i]*o+z,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,t[C]=~~d,t[C+1]=~~g,t[C+2]=~~v;else for(C=0;I>C;C+=4)n=t[C],a=t[C+1],i=t[C+2],d=u[n]*l+y,g=h[a]*s+F,v=c[i]*o+z,t[C]=~~d,t[C+1]=~~g,t[C+2]=~~v;return t}})}(t),!function(t){"use strict";var e=Math.sqrt,r=t._notSupportClamp,n=t.Array32F;t.PixelateFilter=t.Create({name:"PixelateFilter",scale:1,init:function(t){this.scale=t||1},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,params:{scale:t.scale}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r.scale=e.scale),r},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var l,s,o,u,h,c,f,p,m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L,T,j,V,D,U,Q,W,$,J,K,O=t.length,Z=O>>2,te=(a<<1)+a;for(l=~~(.01*e(Z)*this.scale),s=a*l,o=i%l,u=a%l,h=(o-1)*a,m=1/(l*l),d=1/(u*l),g=1/(o*l),v=1/(u*o),C=m,b=d,_=g,M=v,Y=l-1,k=(l-1)*a,L=0,j=a-1,T=0,V=Z-a,y=new n(3*Z),X=0,S=0,x=0,F=z=I=0,x=0;a>x;x++,X+=4,S+=3)F+=t[X],z+=t[X+1],I+=t[X+2],y[S]=F,y[S+1]=z,y[S+2]=I;for(S=0,x=0,F=z=I=0,X=te+a;O>X;X+=4,S+=3,x++)x>=a&&(x=0,F=z=I=0),F+=t[X],z+=t[X+1],I+=t[X+2],y[S+te]=y[S]+F,y[S+te+1]=y[S+1]+z,y[S+te+2]=y[S+2]+I;for(x=0,w=0,E=0,B=x,N=E,R=B+Y,G=N+k,R=R>j?j:R,G=G>V?V:G,D=B+N,W=R+G,U=R+N,Q=B+G,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,p=C,$=p*(y[W]-y[U]-y[Q]+y[D]),J=p*(y[W+1]-y[U+1]-y[Q+1]+y[D+1]),K=p*(y[W+2]-y[U+2]-y[Q+2]+y[D+2]),r&&($=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),$=~~$,J=~~J,K=~~K,A=0,P=0,q=0,X=0;O>X;X+=4)H=A+x+q+E<<2,t[H]=$,t[H+1]=J,t[H+2]=K,A++,(A+x>=a||A>=l)&&(A=0,P++,q+=a),(P+w>=i||P>=l)&&(x+=l,x>=a&&(x=0,w+=l,E+=s),A=0,P=0,q=0,B=x,N=E,R=B+Y,G=N+k,R=R>j?j:R,G=G>V?V:G,D=B+N,W=R+G,U=R+N,Q=B+G,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,c=0==R-B-u+1,f=0==G-N-h,p=c&&f?M:c?b:f?_:C,$=p*(y[W]-y[U]-y[Q]+y[D]),J=p*(y[W+1]-y[U+1]-y[Q+1]+y[D+1]),K=p*(y[W+2]-y[U+2]-y[Q+2]+y[D+2]),r&&($=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),$=~~$,J=~~J,K=~~K);return t}})}(t),!function(t){"use strict";var e=Math.sqrt,r=(Math.SQRT2,Math.min,t._notSupportClamp),n=t.Array32F;t.TriangularPixelateFilter=t.Create({name:"TriangularPixelateFilter",scale:1,init:function(t){this.scale=t||1},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,params:{scale:t.scale}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r.scale=e.scale),r},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var l,s,o,u,h,c,f,p,m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L,T,j,V,D,U,Q,W,$,J,K,O,Z,te,ee,re,ne,ae,ie,le=t.length,se=le>>2,oe=(a<<1)+a;for(l=~~(.01*e(se)*this.scale),s=l>>1,o=l-1,u=a*l,h=i%l,c=a%l,f=(h-1)*a,g=1/(l*l),v=1/(c*l),C=1/(h*l),b=1/(c*h),_=2*g,M=2*v,y=2*C,F=2*b,X=o,S=o*a,j=0,D=a-1,V=0,U=se-a,z=new n(3*se),x=0,w=0,E=0,I=Y=k=0,E=0;a>E;E++,x+=4,w+=3)I+=t[x],Y+=t[x+1],k+=t[x+2],z[w]=I,z[w+1]=Y,z[w+2]=k;for(w=0,E=0,I=Y=k=0,x=oe+a;le>x;x+=4,w+=3,E++)E>=a&&(E=0,I=Y=k=0),I+=t[x],Y+=t[x+1],k+=t[x+2],z[w+oe]=z[w]+I,z[w+oe+1]=z[w+1]+Y,z[w+oe+2]=z[w+2]+k;for(E=0,A=0,P=0,R=E,G=P,L=E-s+X,T=P+S,L=L>D?D:L,T=T>U?U:T,Q=R+G,J=L+T,W=L+G,$=R+T,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,d=_,te=d*(z[J]-z[W]-z[$]+z[Q]),ee=d*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),re=d*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),R=E+s,L=E+X,L=L>D?D:L,Q=R+G,J=L+T,W=L+G,$=R+T,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,ne=d*(z[J]-z[W]-z[$]+z[Q]),ae=d*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),ie=d*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),r&&(te=0>te?0:te>255?255:te,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie),te=~~te,ee=~~ee,re=~~re,ne=~~ne,ae=~~ae,ie=~~ie,K=te,O=ee,Z=re,q=0,H=0,B=0,x=0;le>x;x+=4)N=q+E+B+P<<2,t[N]=K,t[N+1]=O,t[N+2]=Z,q++,(q+E>=a||q>=l)&&(q=0,H++,B+=a,K=te,O=ee,Z=re),q>o-H&&(K=ne,O=ae,Z=ie),(H+A>=i||H>=l)&&(E+=l,E>=a&&(E=0,A+=l,P+=u),q=0,H=0,B=0,R=E,G=P,L=E-s+X,T=P+S,L=L>D?D:L,T=T>U?U:T,Q=R+G,J=L+T,W=L+G,$=R+T,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,p=0==L-R+s-c+1,m=0==T-G-f,d=p&&m?F:p?M:m?y:_,te=d*(z[J]-z[W]-z[$]+z[Q]),ee=d*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),re=d*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),R=E+s,L=E+X,L=L>D?D:L,Q=R+G,J=L+T,W=L+G,$=R+T,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,p=0==L-R+s-c+1,d=p&&m?F:p?M:m?y:_,ne=d*(z[J]-z[W]-z[$]+z[Q]),ae=d*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),ie=d*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),r&&(te=0>te?0:te>255?255:te,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie),te=~~te,ee=~~ee,re=~~re,ne=~~ne,ae=~~ae,ie=~~ie,K=te,O=ee,Z=re);return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Color.RGB2HSV,n=.7083333333333334;t.HSVConverterFilter=t.Create({name:"HSVConverterFilter",path:t.getPath(),apply:function(t){var a,i,l,s,o,u,h,c,f=t.length;if(e)for(s=0;f>s;s+=4)a=t[s],i=t[s+1],l=t[s+2],o=r({r:a,g:i,b:l}),u=o.h*n,c=255*o.s,h=o.v,0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),0>c?c=0:c>255&&(c=255),t[s]=~~u,t[s+1]=~~h,t[s+2]=~~c;else for(s=0;f>s;s+=4)a=t[s],i=t[s+1],l=t[s+2],o=r({r:a,g:i,b:l}),u=o.h*n,c=255*o.s,h=o.v,t[s]=~~u,t[s+1]=~~h,t[s+2]=~~c;return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,t.ImArray,t.Color.clampPixel),r=t.Color.RGB2HSV,n=(t.Color.HSV2RGB,t.Color.Color2RGBA);t.HueExtractorFilter=t.Create({name:"HueExtractorFilter",range:null,background:0,init:function(t,e){this.range=t,this.background=e||0},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,params:{range:t.range,background:t.background}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r.range=e.range,r.background=e.background),r},apply:function(t){if(!this.range||!this.range.length)return t;var a,i,l,s,o,u,h,c,f,p,m=t.length,d=this.range[0],g=this.range[this.range.length-1];for(f=n(this.background||0),s=~~e(f.r),o=~~e(f.g),u=~~e(f.b),h=~~e(f.a),c=0;m>c;c+=4)a=t[c],i=t[c+1],l=t[c+2],p=r({r:a,g:i,b:l}).h,(d>p||p>g)&&(t[c]=s,t[c+1]=o,t[c+2]=u,t[c+3]=h);return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,Math.min),r=Math.floor,n=t.CHANNEL.RED;t.CHANNEL.GREEN,t.CHANNEL.BLUE,t.CHANNEL.ALPHA,t.ChannelCopyFilter=t.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,init:function(t,e,r,a,i){this._srcImg=null,this.srcImg=null,this.srcChannel=e||n,this.dstChannel=r||n,this.centerX=a||0,this.centerY=i||0,t&&this.setSrc(t)},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,params:{_srcImg:t._srcImg,centerX:t.centerX,centerY:t.centerY,srcChannel:t.srcChannel,dstChannel:t.dstChannel}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r._srcImg=e._srcImg,r.centerX=e.centerX,r.centerY=e.centerY,r.srcChannel=e.srcChannel,r.dstChannel=e.dstChannel),r},setSrc:function(t){return t&&(this.srcImg=t,this._srcImg={data:t.getData(),width:t.width,height:t.height}),this},apply:function(t,n,a){if(!this._srcImg)return t;var i,l,s,o,u,h,c=this._srcImg.data,f=t.length,p=(c.length,this._srcImg.width),m=this._srcImg.height,d=this.srcChannel,g=this.dstChannel,v=e(n,p),C=e(a,m),b=this.centerX||0,_=this.centerY||0,M=p>>1,y=m>>1;for(b=r(b*(n-1))-M,_=r(_*(a-1))-y,i=0,l=0,s=0,i=0;f>i;i+=4,l++)l>=n&&(l=0,s++),u=l-b,h=s-_,u>=0&&v>u&&h>=0&&C>h&&(o=u+h*p<<2,t[i+g]=c[o+d]);return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,Math.min),r=Math.floor;t.AlphaMaskFilter=t.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,init:function(t,e,r){this.centerX=e||0,this.centerY=r||0,this._alphaMask=null,this.alphaMask=null,t&&this.setMask(t)},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,params:{_alphaMask:t._alphaMask,centerX:t.centerX,centerY:t.centerY}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r._alphaMask=e._alphaMask,r.centerX=e.centerX,r.centerY=e.centerY),r},setMask:function(t){return t&&(this.alphaMask=t,this._alphaMask={data:t.getData(),width:t.width,height:t.height}),this},apply:function(t,n,a){if(!this._alphaMask)return t;var i,l,s,o,u,h,c=this._alphaMask.data,f=this._alphaMask.width,p=this._alphaMask.height,m=t.length,d=(c.length,e(n,f)),g=e(a,p),v=this.centerX||0,C=this.centerY||0,b=f>>1,_=p>>1;for(v=r(v*(n-1))-b,C=r(C*(a-1))-_,l=0,s=0,i=0;m>i;i+=4,l++)l>=n&&(l=0,s++),u=l-v,h=s-C,u>=0&&d>u&&h>=0&&g>h?(o=u+h*f<<2,t[i+3]=c[o+3]):t[i+3]=0;return t}})}(t),!function(t,e){"use strict";var r,n=Math.min,a=Math.max,i=Math.round,l=(Math.floor,Math.abs),s=t._notSupportClamp;t.BlendFilter=t.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendMode:null,blendImage:null,startX:0,startY:0,amount:1,init:function(t,e,r){this.startX=0,this.startY=0,this.amount=1,this._blendImage=null,this.blendImage=null,this._blendMode=null,this.blendMode=null,t&&this.setImage(t),e&&this.setMode(e,r)},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,params:{_blendImage:t._blendImage,_blendMode:t._blendMode,startX:t.startX,startY:t.startY,amount:t.amount}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r._blendImage=e._blendImage,r.startX=e.startX,r.startY=e.startY,r.setMode(e._blendMode,e.amount)),r},setImage:function(t){return t&&(this.blendImage=t,this._blendImage={data:t.getData(),width:t.width,height:t.height}),this},setMode:function(t,i){return t?(this._blendMode=(""+t).toLowerCase(),this.blendMode=r[this._blendMode]||null,this.amount=a(0,n(1,e===i?1:i))):(this._blendMode=null,this.blendMode=null),this},reset:function(){return this.startX=0,this.startY=0,this.amount=1,this._blendMode=null,this.blendMode=null,this},apply:function(t,e,r){if(!this.blendMode||!this._blendImage)return t;var a,l,s,o,u,h=this.startX||0,c=this.startY||0,f=0,p=0,m=this._blendImage,d=this.amount||1;return o=m.width,u=m.height,0>h&&(f=-h,h=0),0>c&&(p=-c,c=0),h>=e||c>=r?t:f>=o||p>=u?t:(h=i(h),c=i(c),f=i(f),p=i(p),a=n(e-h,o-f),l=n(r-c,u-p),0>=a||0>=l?t:(s=m.data,this.blendMode(t,e,r,s,o,u,h,c,f,p,a,l,d)))}}),r={normal:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=k,w=X,E=S,z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},lighten:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=z>k?z:k,w=I>X?I:X,E=Y>S?Y:S,z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},darken:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=z>k?k:z,w=I>X?X:I,E=Y>S?S:Y,z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},multiply:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=.003921568627451*z*k,w=.003921568627451*I*X,E=.003921568627451*Y*S,z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},average:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=.5*(z+k),w=.5*(I+X),E=.5*(Y+S),z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},add:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=z+k,w=I+X,E=Y+S,z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},subtract:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=255>z+k?0:z+k-255,w=255>I+X?0:I+X-255,E=255>Y+S?0:Y+S-255,z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},difference:function(t,e,r,n,a,i,o,u,h,c,f,p,m){var d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A,P;for(P=1-m,M=o,y=u*e,F=h,z=c*a,d=o+f,g=h+f,v=0,C=p*f;C>v;)b=M+y<<2,_=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=n[_],S=n[_+1],x=n[_+2],w=l(X-I),E=l(S-Y),A=l(x-k),I=w*m+I*P,Y=E*m+Y*P,k=A*m+k*P,s&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,M++,M>=d&&(M=o,y+=e),F++,F>=g&&(F=h,z+=a);return t},negation:function(t,e,r,n,a,i,o,u,h,c,f,p,m){var d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A,P;for(P=1-m,M=o,y=u*e,F=h,z=c*a,d=o+f,g=h+f,v=0,C=p*f;C>v;)b=M+y<<2,_=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=n[_],S=n[_+1],x=n[_+2],w=255-l(255-X-I),E=255-l(255-S-Y),A=255-l(255-x-k),I=w*m+I*P,Y=E*m+Y*P,k=A*m+k*P,s&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,M++,M>=d&&(M=o,y+=e),F++,F>=g&&(F=h,z+=a);return t},screen:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=255-((255-k)*(255-z)>>8),w=255-((255-X)*(255-I)>>8),E=255-((255-S)*(255-Y)>>8),z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},exclusion:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=k+z-.003921568627451*2*k*z,w=X+I-.003921568627451*2*X*I,E=S+Y-.003921568627451*2*S*Y,z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},overlay:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=128>z?.003921568627451*2*k*z:255-.003921568627451*2*(255-k)*(255-z),w=128>I?.003921568627451*2*X*I:255-.003921568627451*2*(255-X)*(255-I),x=128>Y?.003921568627451*2*S*Y:255-.003921568627451*2*(255-S)*(255-Y),z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},softlight:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=128>z?2*((k>>1)+64)*.003921568627451*z:255-.003921568627451*2*(255-((k>>1)+64))*(255-z),w=128>I?2*((X>>1)+64)*.003921568627451*I:255-.003921568627451*2*(255-((X>>1)+64))*(255-I),E=128>Y?2*((S>>1)+64)*.003921568627451*Y:255-.003921568627451*2*(255-((S>>1)+64))*(255-Y),z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},hardlight:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=128>k?.003921568627451*2*z*k:255-.003921568627451*2*(255-z)*(255-k),w=128>X?.003921568627451*2*I*X:255-.003921568627451*2*(255-I)*(255-X),E=128>S?.003921568627451*2*Y*S:255-.003921568627451*2*(255-Y)*(255-S),z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},colordodge:function(t,e,r,a,i,l,o,u,h,c,f,p,m){var d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A,P;for(P=1-m,M=o,y=u*e,F=h,z=c*i,d=o+f,g=h+f,v=0,C=p*f;C>v;)b=M+y<<2,_=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=a[_],S=a[_+1],x=a[_+2],w=255==I?I:n(255,(X<<8)/(255-I)),E=255==Y?Y:n(255,(S<<8)/(255-Y)),A=255==k?I:n(255,(x<<8)/(255-k)),I=w*m+I*P,Y=E*m+Y*P,k=A*m+k*P,s&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,M++,M>=d&&(M=o,y+=e),F++,F>=g&&(F=h,z+=i);return t},colorburn:function(t,e,r,n,i,l,o,u,h,c,f,p,m){var d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A,P;for(P=1-m,M=o,y=u*e,F=h,z=c*i,d=o+f,g=h+f,v=0,C=p*f;C>v;)b=M+y<<2,_=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=n[_],S=n[_+1],x=n[_+2],w=0==I?I:a(0,255-(255-X<<8)/I),E=0==Y?Y:a(0,255-(255-S<<8)/Y),A=0==k?k:a(0,255-(255-x<<8)/k),I=w*m+I*P,Y=E*m+Y*P,k=A*m+k*P,s&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,M++,M>=d&&(M=o,y+=e),F++,F>=g&&(F=h,z+=i);return t},linearlight:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;for(var P;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],128>z?(P=2*z,x=255>P+k?0:P+k-255):(P=2*(z-128),x=P+k),128>I?(P=2*I,w=255>P+X?0:P+X-255):(P=2*(I-128),w=P+X),128>Y?(P=2*Y,E=255>P+S?0:P+S-255):(P=2*(Y-128),E=P+S),z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},reflect:function(t,e,r,a,i,l,o,u,h,c,f,p,m){var d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A,P;for(P=1-m,M=o,y=u*e,F=h,z=c*i,d=o+f,g=h+f,v=0,C=p*f;C>v;)b=M+y<<2,_=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=a[_],S=a[_+1],x=a[_+2],w=255==I?I:n(255,X*X/(255-I)),E=255==Y?Y:n(255,S*S/(255-Y)),A=255==k?k:n(255,x*x/(255-k)),I=w*m+I*P,Y=E*m+Y*P,k=A*m+k*P,s&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,M++,M>=d&&(M=o,y+=e),F++,F>=g&&(F=h,z+=i);return t},glow:function(t,e,r,a,i,l,o,u,h,c,f,p,m){var d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A,P;for(P=1-m,M=o,y=u*e,F=h,z=c*i,d=o+f,g=h+f,v=0,C=p*f;C>v;)b=M+y<<2,_=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=a[_],S=a[_+1],x=a[_+2],w=255==X?X:n(255,I*I/(255-X)),E=255==S?S:n(255,Y*Y/(255-S)),A=255==x?x:n(255,k*k/(255-x)),I=w*m+I*P,Y=E*m+Y*P,k=A*m+k*P,s&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,M++,M>=d&&(M=o,y+=e),F++,F>=g&&(F=h,z+=i);return t},phoenix:function(t,e,r,i,l,o,u,h,c,f,p,m,d){var g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A,P,q;for(q=1-d,y=u,F=h*e,z=c,I=f*l,g=u+p,v=c+p,C=0,b=m*p;b>C;)_=y+F<<2,M=z+I<<2,Y=t[_],k=t[_+1],X=t[_+2],S=i[M],x=i[M+1],w=i[M+2],E=n(S,Y)-a(S,Y)+255,A=n(x,k)-a(x,k)+255,P=n(w,X)-a(w,X)+255,Y=E*d+Y*q,k=A*d+k*q,X=P*d+X*q,s&&(Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k,X=0>X?0:X>255?255:X),t[_]=~~Y,t[_+1]=~~k,t[_+2]=~~X,C++,y++,y>=g&&(y=u,F+=e),z++,z>=v&&(z=c,I+=l);return t},vividlight:function(t,e,r,i,l,o,u,h,c,f,p,m,d){var g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A,P,q;q=1-d,y=u,F=h*e,z=c,I=f*l,g=u+p,v=c+p,C=0,b=m*p;for(var H;b>C;)_=y+F<<2,M=z+I<<2,Y=t[_],k=t[_+1],X=t[_+2],S=i[M],x=i[M+1],w=i[M+2],128>Y?(H=2*Y,E=0==H?H:a(0,255-(255-S<<8)/H)):(H=2*(Y-128),E=255==H?H:n(255,(S<<8)/(255-H))),128>k?(H=2*k,A=0==H?H:a(0,255-(255-x<<8)/H)):(H=2*(k-128),A=255==H?H:n(255,(x<<8)/(255-H))),128>X?(H=2*X,P=0==H?H:a(0,255-(255-w<<8)/H)):(H=2*(k-128),P=255==H?H:n(255,(w<<8)/(255-H))),Y=E*d+Y*q,k=A*d+k*q,X=P*d+X*q,s&&(Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k,X=0>X?0:X>255?255:X),t[_]=~~Y,t[_+1]=~~k,t[_+2]=~~X,C++,y++,y>=g&&(y=u,F+=e),z++,z>=v&&(z=c,I+=l);return t},pinlight:function(t,e,r,n,a,i,l,o,u,h,c,f,p){var m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A;A=1-p,_=l,M=o*e,y=u,F=h*a,m=l+c,d=u+c,g=0,v=f*c;for(var P;v>g;)C=_+M<<2,b=y+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],128>z?(P=2*z,x=P>k?P:k):(P=2*(z-128),x=P>k?k:P),128>I?(P=2*I,w=P>X?P:X):(P=2*(z-128),w=P>X?X:P),128>Y?(P=2*Y,E=P>S?P:S):(P=2*(Y-128),E=P>S?S:P),z=x*p+z*A,I=w*p+I*A,Y=E*p+Y*A,s&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,g++,_++,_>=m&&(_=l,M+=e),y++,y>=d&&(y=u,F+=a);return t},hardmix:function(t,e,r,i,l,o,u,h,c,f,p,m,d){var g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A,P,q;q=1-d,y=u,F=h*e,z=c,I=f*l,g=u+p,v=c+p,C=0,b=m*p;for(var H;b>C;)_=y+F<<2,M=z+I<<2,Y=t[_],k=t[_+1],X=t[_+2],S=i[M],x=i[M+1],w=i[M+2],128>Y?(H=2*Y,E=0==H?H:a(0,255-(255-S<<8)/H)):(H=2*(Y-128),E=255==H?H:n(255,(S<<8)/(255-H))),E=128>E?0:255,128>k?(H=2*k,A=0==H?H:a(0,255-(255-x<<8)/H)):(H=2*(k-128),A=255==H?H:n(255,(x<<8)/(255-H))),A=128>A?0:255,128>X?(H=2*X,P=0==H?H:a(0,255-(255-w<<8)/H)):(H=2*(X-128),P=255==H?H:n(255,(w<<8)/(255-H))),P=128>P?0:255,Y=E*d+Y*q,k=A*d+k*q,X=P*d+X*q,s&&(Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k,X=0>X?0:X>255?255:X),t[_]=~~Y,t[_+1]=~~k,t[_+2]=~~X,C++,y++,y>=g&&(y=u,F+=e),z++,z>=v&&(z=c,I+=l);return t}},r.lineardodge=r.add,r.linearburn=r.subtract}(t),!function(t){"use strict";var e=(t._notSupportClamp,t.Color.RGBA2Color),r=t.Color.Color2RGBA;t.ThresholdFilter=t.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(t,e){this.thresholds=t,this.quantizedColors=e||null},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,params:{thresholds:t.thresholds,quantizedColors:t.quantizedColors}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r.thresholds=e.thresholds,r.quantizedColors=e.quantizedColors),r},apply:function(t){if(!this.thresholds||!this.thresholds.length)return t;if(!this.quantizedColors||!this.quantizedColors.length)return t;var n,a,i,l,s,o,u,h,c=t.length,f=this.thresholds,p=f.length,m=this.quantizedColors,d=m.length;for(u=0;c>u;u+=4){for(s=e({r:t[u],g:t[u+1],b:t[u+2],a:t[u+3]}),h=0;p>h&&s>f[h];)h++;s=d>h?m[h]:255,o=r(s),n=o.r,a=o.g,i=o.b,l=o.a,t[u]=n,t[u+1]=a,t[u+2]=i,t[u+3]=l}return t}})}(t),!function(t){"use strict";var e=(Math.sqrt,Math.exp,Math.log),r=Math.abs,n=Math.floor,a=t._notSupportClamp,i=t.Array32F;t.BokehFilter=t.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(t,e,r,n){this.centerX=t||0,this.centerY=e||0,this.radius=r||10,this.amount=n||10},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,params:{centerX:t.centerX,centerY:t.centerY,radius:t.radius,amount:t.amount}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(e=t.params,r.centerX=e.centerX,r.centerY=e.centerY,r.radius=e.radius,r.amount=e.amount),r},apply:function(t,l,s){var o,u,h,c,f,p,m,d,g,v,C,b,_,M,y,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L=t.length,T=this.centerX||0,j=this.centerY||0,V=this.radius,D=this.amount;if(0>=D)return t;for(o=L>>2,B=0,N=l-1,R=0,G=o-l,T=n(T*(l-1)),j=n(j*(s-1)),h=(o<<1)+o,m=(l<<1)+l,u=new i(h),d=0,g=0,v=0,c=f=p=0,v=0;l>v;v++,d+=4,g+=3)c+=t[d],f+=t[d+1],p+=t[d+2],u[g]=c,u[g+1]=f,u[g+2]=p;for(d=m+l,g=0,v=0,c=f=p=0,d=m+l;L>d;d+=4,g+=3,v++)v>=l&&(v=0,c=f=p=0),c+=t[d],f+=t[d+1],p+=t[d+2],u[g+m]=u[g]+c,u[g+m+1]=u[g+1]+f,u[g+m+2]=u[g+2]+p;for(v=0,C=0,b=0,d=0;L>d;d+=4,v++)v>=l&&(v=0,C++,b+=l),M=v-T,y=C-j,_=r(M)+r(y),F=_>V?~~e((_-V)*D):~~(_/V+.5),F>0&&(z=F*l,I=.25/(F*F),Y=v-F,k=b-z,X=v+F,S=b+z,B>Y?Y=B:X>N&&(X=N),R>k?k=R:S>G&&(S=G),x=Y+k,A=X+S,w=X+k,E=Y+S,x=(x<<1)+x,w=(w<<1)+w,E=(E<<1)+E,A=(A<<1)+A,P=I*(u[A]-u[w]-u[E]+u[x]),q=I*(u[A+1]-u[w+1]-u[E+1]+u[x+1]),H=I*(u[A+2]-u[w+2]-u[E+2]+u[x+2]),a&&(P=0>P?0:P>255?255:P,q=0>q?0:q>255?255:q,H=0>H?0:H>255?255:H),t[d]=~~P,t[d+1]=~~q,t[d+2]=~~H);return t}})}(t),e});