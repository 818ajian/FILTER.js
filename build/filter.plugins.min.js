/**
*
*   FILTER.js Plugins
*   @version: 0.6.8
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(r,t,n,e){n=n?[].concat(n):[];var a,i=n.length,o=new Array(i),l=new Array(i),u=new Array(i);for(a=0;i>a;a++)o[a]=n[a][0],l[a]=n[a][1];if("object"==typeof module&&module.exports){if("undefined"==typeof module.exports[t]){for(a=0;i>a;a++)u[a]=module.exports[o[a]]||require(l[a])[o[a]];module.exports[t]=e.apply(r,u)}}else if("function"==typeof define&&define.amd)define(["exports"].concat(l),function(n){if("undefined"==typeof n[t]){for(var a=Array.prototype.slice.call(arguments,1),i=0,l=a.length;l>i;i++)u[i]=n[o[i]];n[t]=e.apply(r,u)}});else if("undefined"==typeof r[t]){for(a=0;i>a;a++)u[a]=r[o[a]];r[t]=e.apply(r,u)}}(this,"FILTER_PLUGINS",[["FILTER","./filter"]],function(r){var t=r;return function(r){var t=r._notSupportClamp,n=Math.random;r.NoiseFilter=r.Create({min:-127,max:127,name:"NoiseFilter",init:function(r,t){this.min=r||-127,this.max=t||127},apply:function(r){var e,a,i,o,l,u,s,h,f=this.max-this.min,c=this.min,p=r.length;if(t)for(e=0;p>e;e+=4)i=r[e],o=r[e+1],l=r[e+2],a=f*n()+c,u=i+a,s=o+a,h=l+a,0>u?u=0:u>255&&(u=255),0>s?s=0:s>255&&(s=255),0>h?h=0:h>255&&(h=255),r[e]=~~u,r[e+1]=~~s,r[e+2]=~~h;else for(e=0;p>e;e+=4)i=r[e],o=r[e+1],l=r[e+2],a=f*n()+c,u=i+a,s=o+a,h=l+a,r[e]=~~u,r[e+1]=~~s,r[e+2]=~~h;return r}})}(r),function(r){var t=r._notSupportClamp,n=r.Array32F,e=r.Color.RGB2YCbCr,a=r.Color.YCbCr2RGB;r.HistogramEqualizeFilter=r.Create({name:"HistogramEqualizeFilter",apply:function(r){var i,o,l,u,s,h,f,c,p,g,m,d=0,v=255,C=0,y=r.length,b=y>>2,F=1/b;for(s=new n(256),p=0;256>p;p+=4)s[p]=0,s[p+1]=0,s[p+2]=0,s[p+3]=0;for(p=0;y>p;p+=4)i=r[p],o=r[p+1],l=r[p+2],g=e({r:i,g:o,b:l}),i=r[p]=~~g.cr,o=r[p+1]=~~g.y,l=r[p+2]=~~g.cb,s[o]+=F,o>d?d=o:v>o&&(v=o);for(C=0,p=0;256>p;p+=4)C+=s[p],s[p]=C,C+=s[p+1],s[p+1]=C,C+=s[p+2],s[p+2]=C,C+=s[p+3],s[p+3]=C;if(u=d-v,t)for(p=0;y>p;p+=4)g={cr:r[p],y:r[p+1],cb:r[p+2]},g.y=s[g.y]*u+v,m=a(g),h=m.r,f=m.g,c=m.b,h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c,r[p]=~~h,r[p+1]=~~f,r[p+2]=~~c;else for(p=0;y>p;p+=4)g={cr:r[p],y:r[p+1],cb:r[p+2]},g.y=s[g.y]*u+v,m=a(g),r[p]=~~m.r,r[p+1]=~~m.g,r[p+2]=~~m.b;return r}})}(r),function(r){var t=r._notSupportClamp,n=r.Array32F;r.GrayscaleHistogramEqualizeFilter=r.Create({name:"GrayscaleHistogramEqualizeFilter",apply:function(r){var e,a,i,o,l,u=0,s=255,h=0,f=r.length,c=f>>2,p=1/c;for(o=new n(256),l=0;256>l;l+=4)o[l]=0,o[l+1]=0,o[l+2]=0,o[l+3]=0;for(l=0;f>l;l+=4)e=r[l],o[e]+=p,e>u?u=e:s>e&&(s=e);for(h=0,l=0;256>l;l+=4)h+=o[l],o[l]=h,h+=o[l+1],o[l+1]=h,h+=o[l+2],o[l+2]=h,h+=o[l+3],o[l+3]=h;if(i=u-s,t)for(l=0;f>l;l+=4)e=r[l],a=o[e]*i+s,a=0>a?0:a>255?255:a,a=~~a,r[l]=a,r[l+1]=a,r[l+2]=a;else for(l=0;f>l;l+=4)e=r[l],a=~~(o[e]*i+s),r[l]=a,r[l+1]=a,r[l+2]=a;return r}})}(r),function(r){var t=r._notSupportClamp,n=r.Array32F;r.RGBHistogramEqualizeFilter=r.Create({name:"RGBHistogramEqualizeFilter",apply:function(r){var e,a,i,o,l,u,s,h,f,c,p,g,m,d,v,C,y=0,b=0,F=0,M=255,A=255,x=255,S=r.length,_=S>>2,E=1/_;for(s=new n(256),h=new n(256),f=new n(256),C=0;256>C;C+=4)s[C]=0,h[C]=0,f[C]=0,s[C+1]=0,h[C+1]=0,f[C+1]=0,s[C+2]=0,h[C+2]=0,f[C+2]=0,s[C+3]=0,h[C+3]=0,f[C+3]=0;for(C=0;S>C;C+=4)e=r[C],a=r[C+1],i=r[C+2],s[e]+=E,h[a]+=E,f[i]+=E,e>y?y=e:M>e&&(M=e),a>b?b=a:A>a&&(A=a),i>F?F=i:x>i&&(x=i);for(c=p=g=0,C=0;256>C;C+=4)c+=s[C],s[C]=c,p+=h[C],h[C]=p,g+=f[C],f[C]=g,c+=s[C+1],s[C+1]=c,p+=h[C+1],h[C+1]=p,g+=f[C+1],f[C+1]=g,c+=s[C+2],s[C+2]=c,p+=h[C+2],h[C+2]=p,g+=f[C+2],f[C+2]=g,c+=s[C+3],s[C+3]=c,p+=h[C+3],h[C+3]=p,g+=f[C+3],f[C+3]=g;if(o=y-M,l=b-A,u=F-x,t)for(C=0;S>C;C+=4)e=r[C],a=r[C+1],i=r[C+2],m=s[e]*o+M,d=h[a]*l+A,v=f[i]*u+x,m=0>m?0:m>255?255:m,d=0>d?0:d>255?255:d,v=0>v?0:v>255?255:v,r[C]=~~m,r[C+1]=~~d,r[C+2]=~~v;else for(C=0;S>C;C+=4)e=r[C],a=r[C+1],i=r[C+2],m=s[e]*o+M,d=h[a]*l+A,v=f[i]*u+x,r[C]=~~m,r[C+1]=~~d,r[C+2]=~~v;return r}})}(r),function(r){var t=Math.sqrt,n=r._notSupportClamp,e=r.Array32F;r.PixelateFilter=r.Create({scale:1,name:"PixelateFilter",init:function(r){this.scale=r||1},apply:function(r,a,i){if(this.scale<=1)return r;this.scale>100&&(this.scale=100);var o,l,u,s,h,f,c,p,g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R,Y,k,G,X,N,z,L,P,T,V,D,U,j,Q,J,K,O,W,Z=r.length,$=Z>>2,rt=(a<<1)+a;for(o=~~(.01*t($)*this.scale),l=a*o,u=i%o,s=a%o,h=(u-1)*a,g=1/(o*o),m=1/(s*o),d=1/(u*o),v=1/(s*u),C=g,y=m,b=d,F=v,_=o-1,E=(o-1)*a,P=0,V=a-1,T=0,D=$-a,M=new e(3*$),H=0,w=0,q=0,A=x=S=0,q=0;a>q;q++,H+=4,w+=3)A+=r[H],x+=r[H+1],S+=r[H+2],M[w]=A,M[w+1]=x,M[w+2]=S;for(w=0,q=0,A=x=S=0,H=rt+a;Z>H;H+=4,w+=3,q++)q>=a&&(q=0,A=x=S=0),A+=r[H],x+=r[H+1],S+=r[H+2],M[w+rt]=M[w]+A,M[w+rt+1]=M[w+1]+x,M[w+rt+2]=M[w+2]+S;for(q=0,B=0,I=0,X=q,N=I,z=X+_,L=N+E,z=z>V?V:z,L=L>D?D:L,U=X+N,J=z+L,j=z+N,Q=X+L,U=(U<<1)+U,j=(j<<1)+j,Q=(Q<<1)+Q,J=(J<<1)+J,p=C,K=p*(M[J]-M[j]-M[Q]+M[U]),O=p*(M[J+1]-M[j+1]-M[Q+1]+M[U+1]),W=p*(M[J+2]-M[j+2]-M[Q+2]+M[U+2]),n&&(K=0>K?0:K>255?255:K,O=0>O?0:O>255?255:O,W=0>W?0:W>255?255:W),K=~~K,O=~~O,W=~~W,R=0,Y=0,k=0,H=0;Z>H;H+=4)G=R+q+k+I<<2,r[G]=K,r[G+1]=O,r[G+2]=W,R++,(R+q>=a||R>=o)&&(R=0,Y++,k+=a),(Y+B>=i||Y>=o)&&(q+=o,q>=a&&(q=0,B+=o,I+=l),R=0,Y=0,k=0,X=q,N=I,z=X+_,L=N+E,z=z>V?V:z,L=L>D?D:L,U=X+N,J=z+L,j=z+N,Q=X+L,U=(U<<1)+U,j=(j<<1)+j,Q=(Q<<1)+Q,J=(J<<1)+J,f=0==z-X-s+1,c=0==L-N-h,p=f&&c?F:f?y:c?b:C,K=p*(M[J]-M[j]-M[Q]+M[U]),O=p*(M[J+1]-M[j+1]-M[Q+1]+M[U+1]),W=p*(M[J+2]-M[j+2]-M[Q+2]+M[U+2]),n&&(K=0>K?0:K>255?255:K,O=0>O?0:O>255?255:O,W=0>W?0:W>255?255:W),K=~~K,O=~~O,W=~~W);return r}})}(r),function(r){var t=Math.sqrt,n=(Math.SQRT2,Math.min,r._notSupportClamp),e=r.Array32F;r.TriangularPixelateFilter=r.Create({scale:1,name:"TriangularPixelateFilter",init:function(r){this.scale=r||1},apply:function(r,a,i){if(this.scale<=1)return r;this.scale>100&&(this.scale=100);var o,l,u,s,h,f,c,p,g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R,Y,k,G,X,N,z,L,P,T,V,D,U,j,Q,J,K,O,W,Z,$,rt,tt,nt,et,at,it,ot=r.length,lt=ot>>2,ut=(a<<1)+a;for(o=~~(.01*t(lt)*this.scale),l=o>>1,u=o-1,s=a*o,h=i%o,f=a%o,c=(h-1)*a,d=1/(o*o),v=1/(f*o),C=1/(h*o),y=1/(f*h),b=2*d,F=2*v,M=2*C,A=2*y,H=u,w=u*a,V=0,U=a-1,D=0,j=lt-a,x=new e(3*lt),q=0,B=0,I=0,S=_=E=0,I=0;a>I;I++,q+=4,B+=3)S+=r[q],_+=r[q+1],E+=r[q+2],x[B]=S,x[B+1]=_,x[B+2]=E;for(B=0,I=0,S=_=E=0,q=ut+a;ot>q;q+=4,B+=3,I++)I>=a&&(I=0,S=_=E=0),S+=r[q],_+=r[q+1],E+=r[q+2],x[B+ut]=x[B]+S,x[B+ut+1]=x[B+1]+_,x[B+ut+2]=x[B+2]+E;for(I=0,R=0,Y=0,z=I,L=Y,P=I-l+H,T=Y+w,P=P>U?U:P,T=T>j?j:T,Q=z+L,O=P+T,J=P+L,K=z+T,Q=(Q<<1)+Q,J=(J<<1)+J,K=(K<<1)+K,O=(O<<1)+O,m=b,rt=m*(x[O]-x[J]-x[K]+x[Q]),tt=m*(x[O+1]-x[J+1]-x[K+1]+x[Q+1]),nt=m*(x[O+2]-x[J+2]-x[K+2]+x[Q+2]),z=I+l,P=I+H,P=P>U?U:P,Q=z+L,O=P+T,J=P+L,K=z+T,Q=(Q<<1)+Q,J=(J<<1)+J,K=(K<<1)+K,O=(O<<1)+O,et=m*(x[O]-x[J]-x[K]+x[Q]),at=m*(x[O+1]-x[J+1]-x[K+1]+x[Q+1]),it=m*(x[O+2]-x[J+2]-x[K+2]+x[Q+2]),n&&(rt=0>rt?0:rt>255?255:rt,tt=0>tt?0:tt>255?255:tt,nt=0>nt?0:nt>255?255:nt,et=0>et?0:et>255?255:et,at=0>at?0:at>255?255:at,it=0>it?0:it>255?255:it),rt=~~rt,tt=~~tt,nt=~~nt,et=~~et,at=~~at,it=~~it,W=rt,Z=tt,$=nt,k=0,G=0,X=0,q=0;ot>q;q+=4)N=k+I+X+Y<<2,r[N]=W,r[N+1]=Z,r[N+2]=$,k++,(k+I>=a||k>=o)&&(k=0,G++,X+=a,W=rt,Z=tt,$=nt),k>u-G&&(W=et,Z=at,$=it),(G+R>=i||G>=o)&&(I+=o,I>=a&&(I=0,R+=o,Y+=s),k=0,G=0,X=0,z=I,L=Y,P=I-l+H,T=Y+w,P=P>U?U:P,T=T>j?j:T,Q=z+L,O=P+T,J=P+L,K=z+T,Q=(Q<<1)+Q,J=(J<<1)+J,K=(K<<1)+K,O=(O<<1)+O,p=0==P-z+l-f+1,g=0==T-L-c,m=p&&g?A:p?F:g?M:b,rt=m*(x[O]-x[J]-x[K]+x[Q]),tt=m*(x[O+1]-x[J+1]-x[K+1]+x[Q+1]),nt=m*(x[O+2]-x[J+2]-x[K+2]+x[Q+2]),z=I+l,P=I+H,P=P>U?U:P,Q=z+L,O=P+T,J=P+L,K=z+T,Q=(Q<<1)+Q,J=(J<<1)+J,K=(K<<1)+K,O=(O<<1)+O,p=0==P-z+l-f+1,m=p&&g?A:p?F:g?M:b,et=m*(x[O]-x[J]-x[K]+x[Q]),at=m*(x[O+1]-x[J+1]-x[K+1]+x[Q+1]),it=m*(x[O+2]-x[J+2]-x[K+2]+x[Q+2]),n&&(rt=0>rt?0:rt>255?255:rt,tt=0>tt?0:tt>255?255:tt,nt=0>nt?0:nt>255?255:nt,et=0>et?0:et>255?255:et,at=0>at?0:at>255?255:at,it=0>it?0:it>255?255:it),rt=~~rt,tt=~~tt,nt=~~nt,et=~~et,at=~~at,it=~~it,W=rt,Z=tt,$=nt);return r}})}(r),function(r){var t=r._notSupportClamp,n=r.Color.RGB2HSV,e=.7083333333333334;r.HSVConverterFilter=r.Create({name:"HSVConverterFilter",apply:function(r){var a,i,o,l,u,s,h,f,c=r.length;if(t)for(l=0;c>l;l+=4)a=r[l],i=r[l+1],o=r[l+2],u=n({r:a,g:i,b:o}),s=u.h*e,f=255*u.s,h=u.v,0>s?s=0:s>255&&(s=255),0>h?h=0:h>255&&(h=255),0>f?f=0:f>255&&(f=255),r[l]=~~s,r[l+1]=~~h,r[l+2]=~~f;else for(l=0;c>l;l+=4)a=r[l],i=r[l+1],o=r[l+2],u=n({r:a,g:i,b:o}),s=u.h*e,f=255*u.s,h=u.v,r[l]=~~s,r[l+1]=~~h,r[l+2]=~~f;return r}})}(r),function(r){var t=(r._notSupportClamp,r.ImArray,r.Color.clampPixel),n=r.Color.RGB2HSV,e=(r.Color.HSV2RGB,r.Color.Color2RGBA);r.HueExtractorFilter=r.Create({range:null,background:0,name:"HueExtractorFilter",init:function(r,t){this.range=r,this.background=t||0},apply:function(r){if(!this.range||!this.range.length)return r;var a,i,o,l,u,s,h,f,c,p,g=r.length,m=this.range[0],d=this.range[this.range.length-1];for(c=e(this.background||0),l=~~t(c.r),u=~~t(c.g),s=~~t(c.b),h=~~t(c.a),f=0;g>f;f+=4)a=r[f],i=r[f+1],o=r[f+2],p=n({r:a,g:i,b:o}).h,(m>p||p>d)&&(r[f]=l,r[f+1]=u,r[f+2]=s,r[f+3]=h);return r}})}(r),function(r){var t=(r._notSupportClamp,Math.min),n=Math.floor,e=r.CHANNEL.RED;r.CHANNEL.GREEN,r.CHANNEL.BLUE,r.CHANNEL.ALPHA,r.ChannelCopyFilter=r.Create({srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,name:"ChannelCopyFilter",init:function(r,t,n,a,i){this.srcImg=r||null,this.srcChannel=t||e,this.dstChannel=n||e,this.centerX=a||0,this.centerY=i||0},apply:function(r,e,a){if(!this.srcImg)return r;var i,o,l,u,s,h,f=this.srcImg.getData(),c=r.length,p=(f.length,this.srcImg.width),g=this.srcImg.height,m=this.srcChannel,d=this.dstChannel,v=t(e,p),C=t(a,g),y=this.centerX||0,b=this.centerY||0,F=p>>1,M=g>>1;for(y=n(y*(e-1))-F,b=n(b*(a-1))-M,i=0,o=0,l=0,i=0;c>i;i+=4,o++)o>=e&&(o=0,l++),s=o-y,h=l-b,s>=0&&v>s&&h>=0&&C>h&&(u=s+h*p<<2,r[i+d]=f[u+m]);return r}})}(r),function(r){var t=(r._notSupportClamp,Math.min),n=Math.floor;r.AlphaMaskFilter=r.Create({alphaMask:null,centerX:0,centerY:0,name:"AlphaMaskFilter",init:function(r,t,n){this.alphaMask=r||null,this.centerX=t||0,this.centerY=n||0},apply:function(r,e,a){if(!this.alphaMask)return r;var i,o,l,u,s,h,f=this.alphaMask.getData(),c=this.alphaMask.width,p=this.alphaMask.height,g=r.length,m=(f.length,t(e,c)),d=t(a,p),v=this.centerX||0,C=this.centerY||0,y=c>>1,b=p>>1;for(v=n(v*(e-1))-y,C=n(C*(a-1))-b,o=0,l=0,i=0;g>i;i+=4,o++)o>=e&&(o=0,l++),s=o-v,h=l-C,s>=0&&m>s&&h>=0&&d>h?(u=s+h*c<<2,r[i+3]=f[u+3]):r[i+3]=0;return r}})}(r),function(r,t){var n,e=Math.min,a=Math.max,i=Math.round,o=(Math.floor,Math.abs),l=r._notSupportClamp;r.BlendFilter=r.Create({_blendMode:null,blendImage:null,startX:0,startY:0,amount:1,name:"BlendFilter",init:function(r,t,n){this.startX=0,this.startY=0,this.amount=1,this.blendImage=r||null,this._blendMode=null,t&&this.mode(t,n)},image:function(r){return this.blendImage=r||null,this},mode:function(r,i){return this._blendMode=n[(""+r).toLowerCase()]||null,this.amount=a(0,e(1,t===i?1:i)),this},reset:function(){return this.startX=0,this.startY=0,this.amount=1,this._blendMode=null,this},apply:function(r,t,n){if(!this._blendMode||!this.blendImage)return r;var a,o,l,u,s,h=this.startX||0,f=this.startY||0,c=0,p=0,g=this.blendImage,m=this.amount||1;return u=g.width,s=g.height,0>h&&(c=-h,h=0),0>f&&(p=-f,f=0),h>=t||f>=n?r:c>=u||p>=s?r:(h=i(h),f=i(f),c=i(c),p=i(p),a=e(t-h,u-c),o=e(n-f,s-p),0>=a||0>=o?r:(l=g.getData(),this._blendMode(r,t,n,l,u,s,h,f,c,p,a,o,m)))}}),n={normal:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],q=E,B=H,I=w,x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},lighten:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],q=x>E?x:E,B=S>H?S:H,I=_>w?_:w,x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},darken:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],q=x>E?E:x,B=S>H?H:S,I=_>w?w:_,x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},multiply:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],q=.003921568627451*x*E,B=.003921568627451*S*H,I=.003921568627451*_*w,x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},average:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],q=.5*(x+E),B=.5*(S+H),I=.5*(_+w),x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},add:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],q=x+E,B=S+H,I=_+w,x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},subtract:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],q=255>x+E?0:x+E-255,B=255>S+H?0:S+H-255,I=255>_+w?0:_+w-255,x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},difference:function(r,t,n,e,a,i,u,s,h,f,c,p,g){var m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R,Y;for(Y=1-g,F=u,M=s*t,A=h,x=f*a,m=u+c,d=h+c,v=0,C=p*c;C>v;)y=F+M<<2,b=A+x<<2,S=r[y],_=r[y+1],E=r[y+2],H=e[b],w=e[b+1],q=e[b+2],B=o(H-S),I=o(w-_),R=o(q-E),S=B*g+S*Y,_=I*g+_*Y,E=R*g+E*Y,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,E=0>E?0:E>255?255:E),r[y]=~~S,r[y+1]=~~_,r[y+2]=~~E,v++,F++,F>=m&&(F=u,M+=t),A++,A>=d&&(A=h,x+=a);return r},negation:function(r,t,n,e,a,i,u,s,h,f,c,p,g){var m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R,Y;for(Y=1-g,F=u,M=s*t,A=h,x=f*a,m=u+c,d=h+c,v=0,C=p*c;C>v;)y=F+M<<2,b=A+x<<2,S=r[y],_=r[y+1],E=r[y+2],H=e[b],w=e[b+1],q=e[b+2],B=255-o(255-H-S),I=255-o(255-w-_),R=255-o(255-q-E),S=B*g+S*Y,_=I*g+_*Y,E=R*g+E*Y,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,E=0>E?0:E>255?255:E),r[y]=~~S,r[y+1]=~~_,r[y+2]=~~E,v++,F++,F>=m&&(F=u,M+=t),A++,A>=d&&(A=h,x+=a);return r},screen:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],q=255-((255-E)*(255-x)>>8),B=255-((255-H)*(255-S)>>8),I=255-((255-w)*(255-_)>>8),x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},exclusion:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],q=E+x-.003921568627451*2*E*x,B=H+S-.003921568627451*2*H*S,I=w+_-.003921568627451*2*w*_,x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},overlay:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],q=128>x?.003921568627451*2*E*x:255-.003921568627451*2*(255-E)*(255-x),B=128>S?.003921568627451*2*H*S:255-.003921568627451*2*(255-H)*(255-S),q=128>_?.003921568627451*2*w*_:255-.003921568627451*2*(255-w)*(255-_),x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},softlight:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],q=128>x?2*((E>>1)+64)*.003921568627451*x:255-.003921568627451*2*(255-((E>>1)+64))*(255-x),B=128>S?2*((H>>1)+64)*.003921568627451*S:255-.003921568627451*2*(255-((H>>1)+64))*(255-S),I=128>_?2*((w>>1)+64)*.003921568627451*_:255-.003921568627451*2*(255-((w>>1)+64))*(255-_),x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},hardlight:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],q=128>E?.003921568627451*2*x*E:255-.003921568627451*2*(255-x)*(255-E),B=128>H?.003921568627451*2*S*H:255-.003921568627451*2*(255-S)*(255-H),I=128>w?.003921568627451*2*_*w:255-.003921568627451*2*(255-_)*(255-w),x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},colordodge:function(r,t,n,a,i,o,u,s,h,f,c,p,g){var m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R,Y;for(Y=1-g,F=u,M=s*t,A=h,x=f*i,m=u+c,d=h+c,v=0,C=p*c;C>v;)y=F+M<<2,b=A+x<<2,S=r[y],_=r[y+1],E=r[y+2],H=a[b],w=a[b+1],q=a[b+2],B=255==S?S:e(255,(H<<8)/(255-S)),I=255==_?_:e(255,(w<<8)/(255-_)),R=255==E?S:e(255,(q<<8)/(255-E)),S=B*g+S*Y,_=I*g+_*Y,E=R*g+E*Y,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,E=0>E?0:E>255?255:E),r[y]=~~S,r[y+1]=~~_,r[y+2]=~~E,v++,F++,F>=m&&(F=u,M+=t),A++,A>=d&&(A=h,x+=i);return r},colorburn:function(r,t,n,e,i,o,u,s,h,f,c,p,g){var m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R,Y;for(Y=1-g,F=u,M=s*t,A=h,x=f*i,m=u+c,d=h+c,v=0,C=p*c;C>v;)y=F+M<<2,b=A+x<<2,S=r[y],_=r[y+1],E=r[y+2],H=e[b],w=e[b+1],q=e[b+2],B=0==S?S:a(0,255-(255-H<<8)/S),I=0==_?_:a(0,255-(255-w<<8)/_),R=0==E?E:a(0,255-(255-q<<8)/E),S=B*g+S*Y,_=I*g+_*Y,E=R*g+E*Y,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,E=0>E?0:E>255?255:E),r[y]=~~S,r[y+1]=~~_,r[y+2]=~~E,v++,F++,F>=m&&(F=u,M+=t),A++,A>=d&&(A=h,x+=i);return r},linearlight:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;for(var Y;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],128>x?(Y=2*x,q=255>Y+E?0:Y+E-255):(Y=2*(x-128),q=Y+E),128>S?(Y=2*S,B=255>Y+H?0:Y+H-255):(Y=2*(S-128),B=Y+H),128>_?(Y=2*_,I=255>Y+w?0:Y+w-255):(Y=2*(_-128),I=Y+w),x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},reflect:function(r,t,n,a,i,o,u,s,h,f,c,p,g){var m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R,Y;for(Y=1-g,F=u,M=s*t,A=h,x=f*i,m=u+c,d=h+c,v=0,C=p*c;C>v;)y=F+M<<2,b=A+x<<2,S=r[y],_=r[y+1],E=r[y+2],H=a[b],w=a[b+1],q=a[b+2],B=255==S?S:e(255,H*H/(255-S)),I=255==_?_:e(255,w*w/(255-_)),R=255==E?E:e(255,q*q/(255-E)),S=B*g+S*Y,_=I*g+_*Y,E=R*g+E*Y,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,E=0>E?0:E>255?255:E),r[y]=~~S,r[y+1]=~~_,r[y+2]=~~E,v++,F++,F>=m&&(F=u,M+=t),A++,A>=d&&(A=h,x+=i);return r},glow:function(r,t,n,a,i,o,u,s,h,f,c,p,g){var m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R,Y;for(Y=1-g,F=u,M=s*t,A=h,x=f*i,m=u+c,d=h+c,v=0,C=p*c;C>v;)y=F+M<<2,b=A+x<<2,S=r[y],_=r[y+1],E=r[y+2],H=a[b],w=a[b+1],q=a[b+2],B=255==H?H:e(255,S*S/(255-H)),I=255==w?w:e(255,_*_/(255-w)),R=255==q?q:e(255,E*E/(255-q)),S=B*g+S*Y,_=I*g+_*Y,E=R*g+E*Y,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,E=0>E?0:E>255?255:E),r[y]=~~S,r[y+1]=~~_,r[y+2]=~~E,v++,F++,F>=m&&(F=u,M+=t),A++,A>=d&&(A=h,x+=i);return r},phoenix:function(r,t,n,i,o,u,s,h,f,c,p,g,m){var d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R,Y,k;for(k=1-m,M=s,A=h*t,x=f,S=c*o,d=s+p,v=f+p,C=0,y=g*p;y>C;)b=M+A<<2,F=x+S<<2,_=r[b],E=r[b+1],H=r[b+2],w=i[F],q=i[F+1],B=i[F+2],I=e(w,_)-a(w,_)+255,R=e(q,E)-a(q,E)+255,Y=e(B,H)-a(B,H)+255,_=I*m+_*k,E=R*m+E*k,H=Y*m+H*k,l&&(_=0>_?0:_>255?255:_,E=0>E?0:E>255?255:E,H=0>H?0:H>255?255:H),r[b]=~~_,r[b+1]=~~E,r[b+2]=~~H,C++,M++,M>=d&&(M=s,A+=t),x++,x>=v&&(x=f,S+=o);return r},vividlight:function(r,t,n,i,o,u,s,h,f,c,p,g,m){var d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R,Y,k;k=1-m,M=s,A=h*t,x=f,S=c*o,d=s+p,v=f+p,C=0,y=g*p;for(var G;y>C;)b=M+A<<2,F=x+S<<2,_=r[b],E=r[b+1],H=r[b+2],w=i[F],q=i[F+1],B=i[F+2],128>_?(G=2*_,I=0==G?G:a(0,255-(255-w<<8)/G)):(G=2*(_-128),I=255==G?G:e(255,(w<<8)/(255-G))),128>E?(G=2*E,R=0==G?G:a(0,255-(255-q<<8)/G)):(G=2*(E-128),R=255==G?G:e(255,(q<<8)/(255-G))),128>H?(G=2*H,Y=0==G?G:a(0,255-(255-B<<8)/G)):(G=2*(E-128),Y=255==G?G:e(255,(B<<8)/(255-G))),_=I*m+_*k,E=R*m+E*k,H=Y*m+H*k,l&&(_=0>_?0:_>255?255:_,E=0>E?0:E>255?255:E,H=0>H?0:H>255?255:H),r[b]=~~_,r[b+1]=~~E,r[b+2]=~~H,C++,M++,M>=d&&(M=s,A+=t),x++,x>=v&&(x=f,S+=o);return r},pinlight:function(r,t,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R;R=1-p,b=o,F=u*t,M=s,A=h*a,g=o+f,m=s+f,d=0,v=c*f;for(var Y;v>d;)C=b+F<<2,y=M+A<<2,x=r[C],S=r[C+1],_=r[C+2],E=e[y],H=e[y+1],w=e[y+2],128>x?(Y=2*x,q=Y>E?Y:E):(Y=2*(x-128),q=Y>E?E:Y),128>S?(Y=2*S,B=Y>H?Y:H):(Y=2*(x-128),B=Y>H?H:Y),128>_?(Y=2*_,I=Y>w?Y:w):(Y=2*(_-128),I=Y>w?w:Y),x=q*p+x*R,S=B*p+S*R,_=I*p+_*R,l&&(x=0>x?0:x>255?255:x,S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_),r[C]=~~x,r[C+1]=~~S,r[C+2]=~~_,d++,b++,b>=g&&(b=o,F+=t),M++,M>=m&&(M=s,A+=a);return r},hardmix:function(r,t,n,i,o,u,s,h,f,c,p,g,m){var d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R,Y,k;k=1-m,M=s,A=h*t,x=f,S=c*o,d=s+p,v=f+p,C=0,y=g*p;for(var G;y>C;)b=M+A<<2,F=x+S<<2,_=r[b],E=r[b+1],H=r[b+2],w=i[F],q=i[F+1],B=i[F+2],128>_?(G=2*_,I=0==G?G:a(0,255-(255-w<<8)/G)):(G=2*(_-128),I=255==G?G:e(255,(w<<8)/(255-G))),I=128>I?0:255,128>E?(G=2*E,R=0==G?G:a(0,255-(255-q<<8)/G)):(G=2*(E-128),R=255==G?G:e(255,(q<<8)/(255-G))),R=128>R?0:255,128>H?(G=2*H,Y=0==G?G:a(0,255-(255-B<<8)/G)):(G=2*(H-128),Y=255==G?G:e(255,(B<<8)/(255-G))),Y=128>Y?0:255,_=I*m+_*k,E=R*m+E*k,H=Y*m+H*k,l&&(_=0>_?0:_>255?255:_,E=0>E?0:E>255?255:E,H=0>H?0:H>255?255:H),r[b]=~~_,r[b+1]=~~E,r[b+2]=~~H,C++,M++,M>=d&&(M=s,A+=t),x++,x>=v&&(x=f,S+=o);return r}},n.lineardodge=n.add,n.linearburn=n.subtract}(r),function(r){var t=(r._notSupportClamp,r.Color.RGBA2Color),n=r.Color.Color2RGBA;r.ThresholdFilter=r.Create({thresholds:null,quantizedColors:null,name:"ThresholdFilter",init:function(r,t){this.thresholds=r,this.quantizedColors=t||null},apply:function(r){if(!this.thresholds||!this.thresholds.length)return r;if(!this.quantizedColors||!this.quantizedColors.length)return r;var e,a,i,o,l,u,s,h,f=r.length,c=this.thresholds,p=c.length,g=this.quantizedColors,m=g.length;for(s=0;f>s;s+=4){for(l=t({r:r[s],g:r[s+1],b:r[s+2],a:r[s+3]}),h=0;p>h&&l>c[h];)h++;l=m>h?g[h]:255,u=n(l),e=u.r,a=u.g,i=u.b,o=u.a,r[s]=e,r[s+1]=a,r[s+2]=i,r[s+3]=o}return r}})}(r),function(r){var t=(Math.sqrt,Math.exp,Math.log),n=Math.abs,e=Math.floor,a=r._notSupportClamp,i=r.Array32F;r.BokehFilter=r.Create({centerX:0,centerY:0,radius:10,amount:10,name:"BokehFilter",init:function(r,t,n,e){this.centerX=r||0,this.centerY=t||0,this.radius=n||10,this.amount=e||10},apply:function(r,o,l){var u,s,h,f,c,p,g,m,d,v,C,y,b,F,M,A,x,S,_,E,H,w,q,B,I,R,Y,k,G,X,N,z,L,P=r.length,T=this.centerX||0,V=this.centerY||0,D=this.radius,U=this.amount;if(0>=U)return r;for(u=P>>2,X=0,N=o-1,z=0,L=u-o,T=e(T*(o-1)),V=e(V*(l-1)),h=(u<<1)+u,g=(o<<1)+o,s=new i(h),m=0,d=0,v=0,f=c=p=0,v=0;o>v;v++,m+=4,d+=3)f+=r[m],c+=r[m+1],p+=r[m+2],s[d]=f,s[d+1]=c,s[d+2]=p;for(m=g+o,d=0,v=0,f=c=p=0,m=g+o;P>m;m+=4,d+=3,v++)v>=o&&(v=0,f=c=p=0),f+=r[m],c+=r[m+1],p+=r[m+2],s[d+g]=s[d]+f,s[d+g+1]=s[d+1]+c,s[d+g+2]=s[d+2]+p;for(v=0,C=0,y=0,m=0;P>m;m+=4,v++)v>=o&&(v=0,C++,y+=o),F=v-T,M=C-V,b=n(F)+n(M),A=b>D?~~t((b-D)*U):~~(b/D+.5),A>0&&(x=A*o,S=.25/(A*A),_=v-A,E=y-x,H=v+A,w=y+x,X>_?_=X:H>N&&(H=N),z>E?E=z:w>L&&(w=L),q=_+E,R=H+w,B=H+E,I=_+w,q=(q<<1)+q,B=(B<<1)+B,I=(I<<1)+I,R=(R<<1)+R,Y=S*(s[R]-s[B]-s[I]+s[q]),k=S*(s[R+1]-s[B+1]-s[I+1]+s[q+1]),G=S*(s[R+2]-s[B+2]-s[I+2]+s[q+2]),a&&(Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k,G=0>G?0:G>255?255:G),r[m]=~~Y,r[m+1]=~~k,r[m+2]=~~G);return r}})}(r),t});