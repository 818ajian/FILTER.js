/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
* 
* PLUGINS Package  (needs BASIC package)
*
* @version 0.6.2
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/(function(c){var v=c._notSupportTypedArrays;c.NoiseFilter=c.Create({min:-127,max:127,init:function(b,a){this.min=b||-127;this.max=a||127},apply:function(b){var a=this.max-this.min,d=Math.random,e=this.min,h,i=b.length,g,c,l,q;for(h=0;h<i;)c=b[h],l=b[h+1],q=b[h+2],g=a*d()+e,c+=g,l+=g,g=q+g,v&&(c<0?c=0:c>255&&(c=255),l<0?l=0:l>255&&(l=255),g<0?g=0:g>255&&(g=255)),b[h]=~~c,b[h+1]=~~l,b[h+2]=~~g,h+=4;return b}})})(FILTER);
(function(c){var v=c._notSupportTypedArrays;c.HistogramEqualizeFilter=c.Create({apply:function(b){var a,d,e,h;h=0;var i=255,g=new c.Array32F(256),p=new c.Array32F(256),l=0,q,j,f,m=b.length;f=m>>2;q=1/f;var o=Array(f);j=c.Color.RGB2YCbCr;var s=c.Color.YCbCr2RGB;for(f=0;f<256;)g[f]=0,p[f]=0,f++;for(l=f=0;f<m;){a=b[f];d=b[f+1];e=b[f+2];a=j({r:a,g:d,b:e});g[a.y]+=q;if(a.y>h)h=a.y;if(a.y<i)i=a.y;o[l]=a;f+=4;l++}for(f=l=0;f<256;)l+=g[f],p[f]=l,f++;h-=i;for(l=f=0;f<m;)a=o[l],a.y=p[a.y]*h+i,j=s(a),g=j.r,
q=j.g,j=j.b,v&&(g<0?g=0:g>255&&(g=255),q<0?q=0:q>255&&(q=255),j<0?j=0:j>255&&(j=255)),b[f]=~~g,b[f+1]=~~q,b[f+2]=~~j,f+=4,l++;return b}})})(FILTER);
(function(c){var v=c._notSupportTypedArrays;c.RGBHistogramEqualizeFilter=c.Create({apply:function(b){var a,d,e,h,i,g;g=i=h=0;var p=255,l=255,q=255,j=new c.Array32F(256),f=new c.Array32F(256),m=new c.Array32F(256),o=new c.Array32F(256),s=new c.Array32F(256),x=new c.Array32F(256),k,n=b.length,r=1/(n>>2);for(k=0;k<256;)j[k]=0,f[k]=0,m[k]=0,o[k]=0,s[k]=0,x[k]=0,k++;for(k=0;k<n;)a=b[k],d=b[k+1],e=b[k+2],j[a]+=r,f[d]+=r,m[e]+=r,a>h&&(h=a),a<p&&(p=a),d>i&&(i=d),d<l&&(l=d),e>g&&(g=e),e<q&&(q=e),k+=4;for(k=
e=d=a=0;k<256;)e+=j[k],o[k]=e,d+=f[k],s[k]=d,a+=m[k],x[k]=a,k++;h-=p;i-=l;g-=q;for(k=0;k<n;)a=b[k],d=b[k+1],e=b[k+2],a=o[a]*h+p,d=s[d]*i+l,e=x[e]*g+q,v&&(a<0?a=0:a>255&&(a=255),d<0?d=0:d>255&&(d=255),e<0?e=0:e>255&&(e=255)),b[k]=~~a,b[k+1]=~~d,b[k+2]=~~e,k+=4;return b}})})(FILTER);
(function(c){var v=Math.sqrt,b=c._notSupportTypedArrays;c.PixelateFilter=c.Create({scale:1,init:function(a){this.scale=a||1},apply:function(a,d,e){if(this.scale<=1)return a;if(this.scale>100)this.scale=100;var h=a.length,i=d*e,e=~~(v(i)*this.scale*0.01),g=e*e,p=1/g,l=e<<2,q=d*e;g<<=2;var j=new c.Array32F(i*3),f,m,o,s=(d<<1)+d,x,k,n,r,t,u,y,B,z,A,w;x=e-1;k=(e-1)*d;z=d-1;A=i-d;for(f=m=o=r=n=i=0;r<d;)f+=a[i],m+=a[i+1],o+=a[i+2],j[n]=f,j[n+1]=m,j[n+2]=o,i+=4,n+=3,r++;i=s+d;n=s;for(f=m=o=r=0;i<h;)f+=a[i],
m+=a[i+1],o+=a[i+2],j[n]=j[n-s]+f,j[n+1]=j[n-s+1]+m,j[n+2]=j[n-s+2]+o,i+=4,n+=3,r++,r>=d&&(f=m=o=r=0);for(s=r=i=0;i<h;){f=r;t=s;u=r+x;m=s+k;u>z&&(u=z);m>A&&(m=A);n=f+t;o=u+m;t=u+t;u=f+m;n=(n<<1)+n;t=(t<<1)+t;u=(u<<1)+u;o=(o<<1)+o;f=p*(j[o]-j[t]-j[u]+j[n]);m=p*(j[o+1]-j[t+1]-j[u+1]+j[n+1]);w=p*(j[o+2]-j[t+2]-j[u+2]+j[n+2]);b&&(f<0?f=0:f>255&&(f=255),m<0?m=0:m>255&&(m=255),w<0?w=0:w>255&&(w=255));f=~~f;m=~~m;w=~~w;n=i;t=r;u=s;B=r+e;o=i+g;for(o>h&&(o=h);n<o;)if(y=t+u<<2,a[y]=f,a[y+1]=m,a[y+2]=w,n+=4,
t++,t>=d||t>=B)t=r,u+=d;i+=l;r+=e;r>=d&&(r=0,s+=q)}return a}})})(FILTER);(function(c){var v=c._notSupportTypedArrays;c.HSVConverterFilter=c.Create({apply:function(b,a,d){for(var e,h,i=b.length,g=c.Color.RGB2HSV,a=0;a<i;)e=b[a],d=b[a+1],h=b[a+2],h=g({r:e,g:d,b:h}),d=h.h*0.7083333333333334,e=h.s*255,h=h.v,v&&(d<0?d=0:d>255&&(d=255),h<0?h=0:h>255&&(h=255),e<0?e=0:e>255&&(e=255)),b[a]=~~d,b[a+1]=~~h,b[a+2]=~~e,a+=4;return b}})})(FILTER);
(function(c){var v=c._notSupportTypedArrays;c.HueExtractorFilter=c.Create({range:null,background:0,init:function(b,a){this.range=b;this.range.sort();this.background=a||0},apply:function(b){if(!this.range||!this.range.length)return b;var a,d,e,h,i,g,p=b.length,l,q=c.Color.RGB2HSV,j=this.range[0],f=this.range[this.range.length-1];h=new c.ImArray(p);l=c.Color.Color2RGBA(this.background||0);for(g=0;g<p;)a=b[g],d=b[g+1],e=b[g+2],a=q({r:a,g:d,b:e}).h,a>=j&&a<=f?(a=b[g],d=b[g+1],e=b[g+2],i=b[g+3]):(a=l.r,
d=l.g,e=l.b,i=l.a),v&&(a<0?a=0:a>255&&(a=255),d<0?d=0:d>255&&(d=255),e<0?e=0:e>255&&(e=255),i<0?i=0:i>255&&(i=255)),h[g]=~~a,h[g+1]=~~d,h[g+2]=~~e,h[g+3]=~~i,g+=4;return h}})})(FILTER);
(function(c){c.AlphaMaskFilter=c.Create({alphaMask:null,centerX:0,centerY:0,init:function(c,b,a){this.alphaMask=c||null;this.centerX=b||0;this.centerY=a||0},apply:function(c,b,a){if(!this.alphaMask)return c;var d=this.alphaMask.getData(),e=c.length,h=this.alphaMask.width,i=this.alphaMask.height,g,p,l,q=Math.min(b,h),j=Math.min(a,i),f,m;f=this.centerX+(b-h>>1);m=this.centerY+(a-i>>1);for(g=i=a=0;a<e;)p=i-f,l=g-m,p>=0&&p<q&&l>=0&&l<j?(p=p+l*h<<2,c[a+3]=d[p+3]):c[a+3]=0,a+=4,i++,i>=b&&(i=0,g++);return c}})})(FILTER);
