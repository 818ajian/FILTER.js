/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
* 
* PLUGINS Package  (needs BASIC package)
*
* @version 0.6.4
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/(function(f){var t=f._notSupportTypedArrays;f.NoiseFilter=f.Create({min:-127,max:127,init:function(b,a){this.min=b||-127;this.max=a||127},apply:function(b){var a=this.max-this.min,c=Math.random,d=this.min,h,i=b.length,e,f,k,n;for(h=0;h<i;)f=b[h],k=b[h+1],n=b[h+2],e=a*c()+d,f+=e,k+=e,e=n+e,t&&(f<0?f=0:f>255&&(f=255),k<0?k=0:k>255&&(k=255),e<0?e=0:e>255&&(e=255)),b[h]=~~f,b[h+1]=~~k,b[h+2]=~~e,h+=4;return b}})})(FILTER);
(function(f){var t=f._notSupportTypedArrays;f.HistogramEqualizeFilter=f.Create({apply:function(b){var a,c,d,h;h=0;var i=255,e=new f.Array32F(256),m=new f.Array32F(256),k=0,n,l,g,j=b.length;g=j>>2;n=1/g;var o=Array(g);l=f.Color.RGB2YCbCr;var v=f.Color.YCbCr2RGB;for(g=0;g<256;)e[g]=0,m[g]=0,g++;for(k=g=0;g<j;){a=b[g];c=b[g+1];d=b[g+2];a=l({r:a,g:c,b:d});e[a.y]+=n;if(a.y>h)h=a.y;if(a.y<i)i=a.y;o[k]=a;g+=4;k++}for(g=k=0;g<256;)k+=e[g],m[g]=k,g++;h-=i;for(k=g=0;g<j;)a=o[k],a.y=m[a.y]*h+i,l=v(a),e=l.r,
n=l.g,l=l.b,t&&(e<0?e=0:e>255&&(e=255),n<0?n=0:n>255&&(n=255),l<0?l=0:l>255&&(l=255)),b[g]=~~e,b[g+1]=~~n,b[g+2]=~~l,g+=4,k++;return b}})})(FILTER);
(function(f){var t=f._notSupportTypedArrays;f.RGBHistogramEqualizeFilter=f.Create({apply:function(b){var a,c,d,h,i,e;e=i=h=0;var m=255,k=255,n=255,l=new f.Array32F(256),g=new f.Array32F(256),j=new f.Array32F(256),o=new f.Array32F(256),v=new f.Array32F(256),x=new f.Array32F(256),p,q=b.length,u=1/(q>>2);for(p=0;p<256;)l[p]=0,g[p]=0,j[p]=0,o[p]=0,v[p]=0,x[p]=0,p++;for(p=0;p<q;)a=b[p],c=b[p+1],d=b[p+2],l[a]+=u,g[c]+=u,j[d]+=u,a>h&&(h=a),a<m&&(m=a),c>i&&(i=c),c<k&&(k=c),d>e&&(e=d),d<n&&(n=d),p+=4;for(p=
d=c=a=0;p<256;)d+=l[p],o[p]=d,c+=g[p],v[p]=c,a+=j[p],x[p]=a,p++;h-=m;i-=k;e-=n;for(p=0;p<q;)a=b[p],c=b[p+1],d=b[p+2],a=o[a]*h+m,c=v[c]*i+k,d=x[d]*e+n,t&&(a<0?a=0:a>255&&(a=255),c<0?c=0:c>255&&(c=255),d<0?d=0:d>255&&(d=255)),b[p]=~~a,b[p+1]=~~c,b[p+2]=~~d,p+=4;return b}})})(FILTER);
(function(f){var t=Math.sqrt,b=f._notSupportTypedArrays;f.PixelateFilter=f.Create({scale:1,init:function(a){this.scale=a||1},apply:function(a,c,d){if(this.scale<=1)return a;if(this.scale>100)this.scale=100;var h=a.length,i=c*d,d=~~(t(i)*this.scale*0.01),e=d*d,m=1/e,k=d<<2,n=c*d;e<<=2;var l=new f.Array32F(i*3),g,j,o,v=(c<<1)+c,x,p,q,u,r,s,w,z,A,B,y;x=d-1;p=(d-1)*c;A=c-1;B=i-c;for(g=j=o=u=q=i=0;u<c;)g+=a[i],j+=a[i+1],o+=a[i+2],l[q]=g,l[q+1]=j,l[q+2]=o,i+=4,q+=3,u++;i=v+c;q=v;for(g=j=o=u=0;i<h;)g+=a[i],
j+=a[i+1],o+=a[i+2],l[q]=l[q-v]+g,l[q+1]=l[q-v+1]+j,l[q+2]=l[q-v+2]+o,i+=4,q+=3,u++,u>=c&&(g=j=o=u=0);for(v=u=i=0;i<h;){g=u;r=v;s=u+x;j=v+p;s>A&&(s=A);j>B&&(j=B);q=g+r;o=s+j;r=s+r;s=g+j;q=(q<<1)+q;r=(r<<1)+r;s=(s<<1)+s;o=(o<<1)+o;g=m*(l[o]-l[r]-l[s]+l[q]);j=m*(l[o+1]-l[r+1]-l[s+1]+l[q+1]);y=m*(l[o+2]-l[r+2]-l[s+2]+l[q+2]);b&&(g<0?g=0:g>255&&(g=255),j<0?j=0:j>255&&(j=255),y<0?y=0:y>255&&(y=255));g=~~g;j=~~j;y=~~y;q=i;r=u;s=v;z=u+d;o=i+e;for(o>h&&(o=h);q<o;)if(w=r+s<<2,a[w]=g,a[w+1]=j,a[w+2]=y,q+=4,
r++,r>=c||r>=z)r=u,s+=c;i+=k;u+=d;u>=c&&(u=0,v+=n)}return a}})})(FILTER);(function(f){var t=f._notSupportTypedArrays;f.HSVConverterFilter=f.Create({apply:function(b,a,c){for(var d,h,i=b.length,e=f.Color.RGB2HSV,a=0;a<i;)d=b[a],c=b[a+1],h=b[a+2],h=e({r:d,g:c,b:h}),c=h.h*0.7083333333333334,d=h.s*255,h=h.v,t&&(c<0?c=0:c>255&&(c=255),h<0?h=0:h>255&&(h=255),d<0?d=0:d>255&&(d=255)),b[a]=~~c,b[a+1]=~~h,b[a+2]=~~d,a+=4;return b}})})(FILTER);
(function(f){var t=f._notSupportTypedArrays;f.HueExtractorFilter=f.Create({range:null,background:0,init:function(b,a){this.range=b;this.background=a||0},apply:function(b){if(!this.range||!this.range.length)return b;var a,c,d,h,i,e,m=b.length,k,n=f.Color.RGB2HSV,l=this.range[0],g=this.range[this.range.length-1];h=new f.ImArray(m);k=f.Color.Color2RGBA(this.background||0);for(e=0;e<m;)a=b[e],c=b[e+1],d=b[e+2],a=n({r:a,g:c,b:d}).h,a>=l&&a<=g?(a=b[e],c=b[e+1],d=b[e+2],i=b[e+3]):(a=k.r,c=k.g,d=k.b,i=k.a),
t&&(a<0?a=0:a>255&&(a=255),c<0?c=0:c>255&&(c=255),d<0?d=0:d>255&&(d=255),i<0?i=0:i>255&&(i=255)),h[e]=~~a,h[e+1]=~~c,h[e+2]=~~d,h[e+3]=~~i,e+=4;return h}})})(FILTER);
(function(f){f.AlphaMaskFilter=f.Create({alphaMask:null,centerX:0,centerY:0,init:function(f,b,a){this.alphaMask=f||null;this.centerX=b||0;this.centerY=a||0},apply:function(f,b,a){if(!this.alphaMask)return f;var c=this.alphaMask.getData(),d=f.length,h=this.alphaMask.width,i=this.alphaMask.height,e,m,k,n=Math.min(b,h),l=Math.min(a,i),g,j;g=this.centerX+(b-h>>1);j=this.centerY+(a-i>>1);for(e=i=a=0;a<d;)m=i-g,k=e-j,m>=0&&m<n&&k>=0&&k<l?(m=m+k*h<<2,f[a+3]=c[m+3]):f[a+3]=0,a+=4,i++,i>=b&&(i=0,e++);return f}})})(FILTER);
(function(f){var t=f._notSupportTypedArrays;f.ThresholdFilter=f.Create({thresholds:null,quantizedColors:null,init:function(b,a){this.thresholds=b;this.quantizedColors=a||null},apply:function(b){if(!this.thresholds||!this.thresholds.length)return b;else if(!this.quantizedColors||!this.quantizedColors.length)return b;var a,c,d,h,i,e=b.length,m=f.Color.RGBA2Color,k=f.Color.Color2RGBA,n=this.thresholds,l=n.length,g=this.quantizedColors,j=g.length;for(i=0;i<e;){a=m({r:b[i],g:b[i+1],b:b[i+2],a:b[i+3]});
for(c=0;c<l&&a>n[c];)c++;a=c<j?g[c]:255;h=k(a);a=h.r;c=h.g;d=h.b;h=h.a;t&&(a<0?a=0:a>255&&(a=255),c<0?c=0:c>255&&(c=255),d<0?d=0:d>255&&(d=255),h<0?h=0:h>255&&(h=255));b[i]=~~a;b[i+1]=~~c;b[i+2]=~~d;b[i+3]=~~h;i+=4}return b}})})(FILTER);(function(f){f.YCbCrConverterFilter=f.Create({apply:function(t){var b,a,c,d,h=t.length,i=f.Color.RGB2YCbCr;for(d=0;d<h;)b=t[d],a=t[d+1],c=t[d+2],b=i({r:b,g:a,b:c}),t[d]=b.cr,t[d+1]=b.y,t[d+2]=b.cb,d+=4;return t}})})(FILTER);
(function(f){var t=Math.log,b=Math.abs,a=f._notSupportTypedArrays;f.BokehFilter=f.Create({centerX:0,centerY:0,radius:10,amount:10,init:function(a,b,f,i){this.centerX=a||0;this.centerY=b||0;this.radius=f||10;this.amount=i||10},apply:function(c,d,h){var i=c.length,e,m,k,n,l,g,j,o,v,x=this.centerX,p=this.centerY,q=this.radius,u=this.amount,r,s,w,z;if(u<=0)return c;v=new f.ImArray(c);e=d*h;h=d-1;z=e-d;l=(d<<1)+d;e=new f.Array32F((e<<1)+e);for(m=k=n=o=j=g=0;o<d;)m+=c[g],k+=c[g+1],n+=c[g+2],e[j]=m,e[j+
1]=k,e[j+2]=n,g+=4,j+=3,o++;g=l+d;j=l;for(m=k=n=o=0;g<i;)m+=c[g],k+=c[g+1],n+=c[g+2],e[j]=e[j-l]+m,e[j+1]=e[j-l+1]+k,e[j+2]=e[j-l+2]+n,g+=4,j+=3,o++,o>=d&&(m=k=n=o=0);for(l=c=o=g=0;g<i;)m=o-x,k=c-p,m=b(m)+b(k),n=m>q?~~t((m-q)*u):~~(m/q+0.5),n>0&&(k=n*d,m=0.25/(n*n),j=o-n,r=l-k,s=o+n,w=l+k,j<0?j=0:s>h&&(s=h),r<0?r=0:w>z&&(w=z),k=j+r,n=s+w,r=s+r,w=j+w,k=(k<<1)+k,r=(r<<1)+r,w=(w<<1)+w,n=(n<<1)+n,j=m*(e[n]-e[r]-e[w]+e[k]),s=m*(e[n+1]-e[r+1]-e[w+1]+e[k+1]),m*=e[n+2]-e[r+2]-e[w+2]+e[k+2],a&&(j<0?j=0:j>
255&&(j=255),s<0?s=0:s>255&&(s=255),m<0?m=0:m>255&&(m=255)),v[g]=~~j,v[g+1]=~~s,v[g+2]=~~m),g+=4,o++,o>=d&&(o=0,c++,l+=d);return v}})})(FILTER);
