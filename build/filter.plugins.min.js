/**
*
*   FILTER.js Plugins
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,n){"use strict";"object"==typeof module&&module.exports?module.exports=n.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(r,t){return n.moduleUri=r.uri,n.call(e,t),t}):(n.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(n){"use strict";var r=n.getPath(e.moduleUri);return!function(e){var n=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,n){var r=this;r.min=e||-127,r.max=n||127},path:r,serialize:function(){var e=this;return{min:e.min,max:e.max}},unserialize:function(e){var n=this;return n.min=e.min,n.max=e.max,n},apply:function(e,r,i){var a=this;if(!a._isOn)return e;var o,l,s,c,u,f,h,d,p=a.max-a.min,y=a.min,v=e.length;if(n)for(o=0;v>o;o+=4)s=e[o],c=e[o+1],u=e[o+2],l=p*t()+y,f=s+l,h=c+l,d=u+l,0>f?f=0:f>255&&(f=255),0>h?h=0:h>255&&(h=255),0>d?d=0:d>255&&(d=255),e[o]=~~f,e[o+1]=~~h,e[o+2]=~~d;else for(o=0;v>o;o+=4)s=e[o],c=e[o+1],u=e[o+2],l=p*t()+y,f=s+l,h=c+l,d=u+l,e[o]=~~f,e[o+1]=~~h,e[o+2]=~~d;return e}})}(n),!function(e){var n=e.Util.Image.perlin,t=e.MODE;e.Create({name:"PerlinNoiseFilter",_baseX:1,_baseY:1,_octaves:1,_offsets:null,_mode:t.GRAY,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:r,init:function(e,n,r,i,a,o,l,s){var c=this;c._mode=t.GRAY,c._baseX=e||1,c._baseY=n||1,c._seed=l||0,c._stitch=!!i,c._fractal=!1!==a,c._perlin=!!s,c.octaves(r||1,o)},seed:function(e){var n=this;return n._seed=e||0,n},octaves:function(e,n){var r=this;for(r._octaves=e||1,r._offsets=n?n.slice(0):[];r._offsets.length<r._octaves;)r._offsets.push([0,0]);return r},seamless:function(e){return arguments.length||(e=!0),this._stitch=!!e,this},colors:function(e){return arguments.length||(e=!0),this._mode=e?t.COLOR:t.GRAY,this},turbulence:function(e){return arguments.length||(e=!0),this._fractal=!e,this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var e=this;return{_baseX:e._baseX,_baseY:e._baseY,_octaves:e._octaves,_offsets:e._offsets,_seed:e._seed||0,_stitch:e._stitch,_mode:e._mode,_fractal:e._fractal,_perlin:e._perlin}},unserialize:function(e){var n=this;return n._baseX=e._baseX,n._baseY=e._baseY,n._octaves=e._octaves,n._offsets=e._offsets,n._seed=e._seed||0,n._stitch=e._stitch,n._mode=e._mode,n._fractal=e._fractal,n._perlin=e._perlin,n},apply:function(e,r,i){var a=this;return a._isOn&&n?(a._seed&&(n.seed(a._seed),a._seed=0),n(e,r,i,a._stitch,t.COLOR!==a._mode,a._baseX,a._baseY,a._octaves,a._offsets,1,.5,a._perlin)):e}})}(n),!function(e,n){var t=e.Color.Gradient,i=e.Util.Array.typed,a=Math.floor;e.Create({name:"GradientFilter",colors:null,stops:null,angle:0,path:r,init:function(e,n,r){var t=this;t.setColors(e,n),t.angle=r||0},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.angle=null,e.$super("dispose"),e},setColors:function(e,n){var r=this;if(e&&e.length){var i=t.stops(e,n);r.colors=i[0],r.stops=i[1]}return r},serialize:function(){var e=this;return{angle:e.angle,colors:e.colors,stops:e.stops}},unserialize:function(e){var n=this;return n.angle=e.angle,n.colors=i(e.colors,Array),n.stops=i(e.stops,Array),n},apply:function(e,n,r){var i=this;return i._isOn&&i.colors?t.linear(e,n,r,i.colors,i.stops,i.angle,t.interpolate):e}}),e.Create({name:"RadialGradientFilter",colors:null,stops:null,centerX:0,centerY:0,radiusX:1,radiusY:1,init:function(e,n,r,t,i,a){var o=this;o.setColors(e,n),o.centerX=r||0,o.centerY=t||0,o.radiusX=i||1,o.radiusY=a||1},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.centerX=null,e.centerY=null,e.radiusX=null,e.radiusY=null,e.$super("dispose"),e},setColors:function(e,n){var r=this;if(e&&e.length){var i=t.stops(e,n);r.colors=i[0],r.stops=i[1]}return r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radiusX:e.radiusX,radiusY:e.radiusY,colors:e.colors,stops:e.stops}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.centerX=n.centerX||0,r.centerY=n.centerY||0,r.radiusX=n.radiusX||1,r.radiusY=n.radiusY||1,r.colors=i(n.colors,Array),r.stops=i(n.stops,Array)),r},apply:function(e,n,r){var i=this;return i._isOn&&i.colors?t.radial(e,n,r,i.colors,i.stops,a((i.centerX||0)*(n-1)),a((i.centerY||0)*(r-1)),i.radiusX,i.radiusY,t.interpolate):e}})}(n),!function(e){var n=Math.min,t=Math.floor,i=e.CHANNEL;e.Create({name:"ChannelCopyFilter",centerX:0,centerY:0,srcChannel:i.RED,dstChannel:i.RED,hasInputs:!0,path:r,init:function(e,n,r,t,a){var o=this;o._srcImg=null,o.srcImg=null,o.srcChannel=n||i.RED,o.dstChannel=r||i.RED,o.centerX=t||0,o.centerY=a||0,e&&o.setInput("source",e)},dispose:function(){var e=this;return e.srcChannel=null,e.dstChannel=null,e.centerX=null,e.centerY=null,e.$super("dispose"),e},serialize:function(){var e=this;return{centerX:e.centerX,centerY:e.centerY,srcChannel:e.srcChannel,dstChannel:e.dstChannel}},unserialize:function(e){var n=this;return n.centerX=e.centerX,n.centerY=e.centerY,n.srcChannel=e.srcChannel,n.dstChannel=e.dstChannel,n},apply:function(e,r,i){var a,o=this;if(!o._isOn)return e;if(a=o.input("source"),!a)return e;var l,s,c,u,f,h,d=a[0],p=a[1],y=a[2],v=e.length,m=(d.length,o.srcChannel),_=o.dstChannel,g=n(r,p),C=n(i,y),Y=o.centerX||0,b=o.centerY||0,w=p>>>1,A=y>>>1;for(Y=t(Y*(r-1))-w,b=t(b*(i-1))-A,l=0,s=0,c=0,l=0;v>l;l+=4,s++)s>=r&&(s=0,c++),f=s-Y,h=c-b,f>=0&&g>f&&h>=0&&C>h&&(u=f+h*p<<2,e[l+_]=d[u+m]);return e}})}(n),!function(e){var n=(e._notSupportClamp,e.CHANNEL),t=Math.min,i=Math.floor;e.Create({name:"AlphaMaskFilter",centerX:0,centerY:0,channel:n.ALPHA,hasInputs:!0,path:r,init:function(e,r,t,i){var a=this;a.centerX=r||0,a.centerY=t||0,a.channel=null==i?n.ALPHA:i||n.RED,a._alphaMask=null,a.alphaMask=null,e&&a.setInput("mask",e)},dispose:function(){var e=this;return e.centerX=null,e.centerY=null,e.channel=null,e.$super("dispose"),e},serialize:function(){var e=this;return{centerX:e.centerX,centerY:e.centerY,channel:e.channel}},unserialize:function(e){var n=this;return n.centerX=e.centerX,n.centerY=e.centerY,n.channel=e.channel,n},apply:function(e,r,a){var o,l=this;if(!l._isOn)return e;if(o=l.input("mask"),!o)return e;var s,c,u,f,h,d,p=o[0],y=o[1],v=o[2],m=e.length,_=(p.length,t(r,y)),g=t(a,v),C=null==l.channel?n.ALPHA:l.channel||n.RED,Y=l.centerX||0,b=l.centerY||0,w=y>>>1,A=v>>>1;for(Y=i(Y*(r-1))-w,b=i(b*(a-1))-A,c=0,u=0,s=0;m>s;s+=4,c++)c>=r&&(c=0,u++),h=c-Y,d=u-b,h>=0&&_>h&&d>=0&&g>d?(f=h+d*y<<2,e[s+3]=p[f+C]):(e[s]=0,e[s+1]=0,e[s+2]=0,e[s+3]=0);return e}})}(n),!function(e){var n=e._notSupportClamp,t=e.Array32F,i=e.MODE,a=Math.min,o=Math.max;e.Create({name:"HistogramEqualizeFilter",path:r,mode:i.INTENSITY,init:function(e){var n=this;n.mode=e||i.INTENSITY},serialize:function(){var e=this;return{mode:e.mode}},unserialize:function(e){var n=this;return n.mode=e.mode,n},_apply_rgb:function(e,r,i){var l,s,c,u,f,h,d,p,y,v,m,_,g,C,Y,b,w=0,A=0,X=0,x=255,I=255,M=255,z=e.length,F=z>>>2,S=(7&F)<<2;for(d=new t(256),p=new t(256),y=new t(256),b=0;z>b;b+=32)l=e[b],s=e[b+1],c=e[b+2],d[l]++,p[s]++,y[c]++,w=o(l,w),A=o(s,A),X=o(c,X),x=a(l,x),I=a(s,I),M=a(c,M),l=e[b+4],s=e[b+5],c=e[b+6],d[l]++,p[s]++,y[c]++,w=o(l,w),A=o(s,A),X=o(c,X),x=a(l,x),I=a(s,I),M=a(c,M),l=e[b+8],s=e[b+9],c=e[b+10],d[l]++,p[s]++,y[c]++,w=o(l,w),A=o(s,A),X=o(c,X),x=a(l,x),I=a(s,I),M=a(c,M),l=e[b+12],s=e[b+13],c=e[b+14],d[l]++,p[s]++,y[c]++,w=o(l,w),A=o(s,A),X=o(c,X),x=a(l,x),I=a(s,I),M=a(c,M),l=e[b+16],s=e[b+17],c=e[b+18],d[l]++,p[s]++,y[c]++,w=o(l,w),A=o(s,A),X=o(c,X),x=a(l,x),I=a(s,I),M=a(c,M),l=e[b+20],s=e[b+21],c=e[b+22],d[l]++,p[s]++,y[c]++,w=o(l,w),A=o(s,A),X=o(c,X),x=a(l,x),I=a(s,I),M=a(c,M),l=e[b+24],s=e[b+25],c=e[b+26],d[l]++,p[s]++,y[c]++,w=o(l,w),A=o(s,A),X=o(c,X),x=a(l,x),I=a(s,I),M=a(c,M),l=e[b+28],s=e[b+29],c=e[b+30],d[l]++,p[s]++,y[c]++,w=o(l,w),A=o(s,A),X=o(c,X),x=a(l,x),I=a(s,I),M=a(c,M);if(S)for(b=z-S;z>b;b+=4)l=e[b],s=e[b+1],c=e[b+2],d[l]++,p[s]++,y[c]++,w=o(l,w),A=o(s,A),X=o(c,X),x=a(l,x),I=a(s,I),M=a(c,M);for(v=m=_=0,b=0;256>b;b+=32)v+=d[b],d[b]=v,v+=d[b+1],d[b+1]=v,v+=d[b+2],d[b+2]=v,v+=d[b+3],d[b+3]=v,v+=d[b+4],d[b+4]=v,v+=d[b+5],d[b+5]=v,v+=d[b+6],d[b+6]=v,v+=d[b+7],d[b+7]=v,v+=d[b+8],d[b+8]=v,v+=d[b+9],d[b+9]=v,v+=d[b+10],d[b+10]=v,v+=d[b+11],d[b+11]=v,v+=d[b+12],d[b+12]=v,v+=d[b+13],d[b+13]=v,v+=d[b+14],d[b+14]=v,v+=d[b+15],d[b+15]=v,v+=d[b+16],d[b+16]=v,v+=d[b+17],d[b+17]=v,v+=d[b+18],d[b+18]=v,v+=d[b+19],d[b+19]=v,v+=d[b+20],d[b+20]=v,v+=d[b+21],d[b+21]=v,v+=d[b+22],d[b+22]=v,v+=d[b+23],d[b+23]=v,v+=d[b+24],d[b+24]=v,v+=d[b+25],d[b+25]=v,v+=d[b+26],d[b+26]=v,v+=d[b+27],d[b+27]=v,v+=d[b+28],d[b+28]=v,v+=d[b+29],d[b+29]=v,v+=d[b+30],d[b+30]=v,v+=d[b+31],d[b+31]=v,m+=p[b],p[b]=m,m+=p[b+1],p[b+1]=m,m+=p[b+2],p[b+2]=m,m+=p[b+3],p[b+3]=m,m+=p[b+4],p[b+4]=m,m+=p[b+5],p[b+5]=m,m+=p[b+6],p[b+6]=m,m+=p[b+7],p[b+7]=m,m+=p[b+8],p[b+8]=m,m+=p[b+9],p[b+9]=m,m+=p[b+10],p[b+10]=m,m+=p[b+11],p[b+11]=m,m+=p[b+12],p[b+12]=m,m+=p[b+13],p[b+13]=m,m+=p[b+14],p[b+14]=m,m+=p[b+15],p[b+15]=m,m+=p[b+16],p[b+16]=m,m+=p[b+17],p[b+17]=m,m+=p[b+18],p[b+18]=m,m+=p[b+19],p[b+19]=m,m+=p[b+20],p[b+20]=m,m+=p[b+21],p[b+21]=m,m+=p[b+22],p[b+22]=m,m+=p[b+23],p[b+23]=m,m+=p[b+24],p[b+24]=m,m+=p[b+25],p[b+25]=m,m+=p[b+26],p[b+26]=m,m+=p[b+27],p[b+27]=m,m+=p[b+28],p[b+28]=m,m+=p[b+29],p[b+29]=m,m+=p[b+30],p[b+30]=m,m+=p[b+31],p[b+31]=m,_+=y[b],y[b]=_,_+=y[b+1],y[b+1]=_,_+=y[b+2],y[b+2]=_,_+=y[b+3],y[b+3]=_,_+=y[b+4],y[b+4]=_,_+=y[b+5],y[b+5]=_,_+=y[b+6],y[b+6]=_,_+=y[b+7],y[b+7]=_,_+=y[b+8],y[b+8]=_,_+=y[b+9],y[b+9]=_,_+=y[b+10],y[b+10]=_,_+=y[b+11],y[b+11]=_,_+=y[b+12],y[b+12]=_,_+=y[b+13],y[b+13]=_,_+=y[b+14],y[b+14]=_,_+=y[b+15],y[b+15]=_,_+=y[b+16],y[b+16]=_,_+=y[b+17],y[b+17]=_,_+=y[b+18],y[b+18]=_,_+=y[b+19],y[b+19]=_,_+=y[b+20],y[b+20]=_,_+=y[b+21],y[b+21]=_,_+=y[b+22],y[b+22]=_,_+=y[b+23],y[b+23]=_,_+=y[b+24],y[b+24]=_,_+=y[b+25],y[b+25]=_,_+=y[b+26],y[b+26]=_,_+=y[b+27],y[b+27]=_,_+=y[b+28],y[b+28]=_,_+=y[b+29],y[b+29]=_,_+=y[b+30],y[b+30]=_,_+=y[b+31],y[b+31]=_;if(u=(w-x)/F,f=(A-I)/F,h=(X-M)/F,n){for(b=0;z>b;b+=32)l=e[b],s=e[b+1],c=e[b+2],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,Y=0>Y?0:Y>255?255:Y,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~Y,l=e[b+4],s=e[b+5],c=e[b+6],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,Y=0>Y?0:Y>255?255:Y,e[b+4]=~~g,e[b+5]=~~C,e[b+6]=~~Y,l=e[b+8],s=e[b+9],c=e[b+10],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,Y=0>Y?0:Y>255?255:Y,e[b+8]=~~g,e[b+9]=~~C,e[b+10]=~~Y,l=e[b+12],s=e[b+13],c=e[b+14],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,Y=0>Y?0:Y>255?255:Y,e[b+12]=~~g,e[b+13]=~~C,e[b+14]=~~Y,l=e[b+16],s=e[b+17],c=e[b+18],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,Y=0>Y?0:Y>255?255:Y,e[b+16]=~~g,e[b+17]=~~C,e[b+18]=~~Y,l=e[b+20],s=e[b+21],c=e[b+22],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,Y=0>Y?0:Y>255?255:Y,e[b+20]=~~g,e[b+21]=~~C,e[b+22]=~~Y,l=e[b+24],s=e[b+25],c=e[b+26],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,Y=0>Y?0:Y>255?255:Y,e[b+24]=~~g,e[b+25]=~~C,e[b+26]=~~Y,l=e[b+28],s=e[b+29],c=e[b+30],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,Y=0>Y?0:Y>255?255:Y,e[b+28]=~~g,e[b+29]=~~C,e[b+30]=~~Y;if(S)for(b=z-S;z>b;b+=4)l=e[b],s=e[b+1],c=e[b+2],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,Y=0>Y?0:Y>255?255:Y,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~Y}else{for(b=0;z>b;b+=32)l=e[b],s=e[b+1],c=e[b+2],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~Y,l=e[b+4],s=e[b+5],c=e[b+6],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,e[b+4]=~~g,e[b+5]=~~C,e[b+6]=~~Y,l=e[b+8],s=e[b+9],c=e[b+10],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,e[b+8]=~~g,e[b+9]=~~C,e[b+10]=~~Y,l=e[b+12],s=e[b+13],c=e[b+14],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,e[b+12]=~~g,e[b+13]=~~C,e[b+14]=~~Y,l=e[b+16],s=e[b+17],c=e[b+18],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,e[b+16]=~~g,e[b+17]=~~C,e[b+18]=~~Y,l=e[b+20],s=e[b+21],c=e[b+22],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,e[b+20]=~~g,e[b+21]=~~C,e[b+22]=~~Y,l=e[b+24],s=e[b+25],c=e[b+26],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,e[b+24]=~~g,e[b+25]=~~C,e[b+26]=~~Y,l=e[b+28],s=e[b+29],c=e[b+30],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,e[b+28]=~~g,e[b+29]=~~C,e[b+30]=~~Y;if(S)for(b=z-S;z>b;b+=4)l=e[b],s=e[b+1],c=e[b+2],g=d[l]*u+x,C=p[s]*f+I,Y=y[c]*h+M,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~Y}return e},apply:function(e,r,l){var s=this;if(!s._isOn)return e;if(i.RGB===s.mode)return s._apply_rgb(e,r,l);var c,u,f,h,d,p,y,v,m,_,g=0,C=255,Y=e.length,b=Y>>>2,w=i.GRAY===s.mode,A=(7&b)<<2;if(v=new t(256),w){for(_=0;Y>_;_+=32)c=e[_],v[c]++,g=o(c,g),C=a(c,C),c=e[_+4],v[c]++,g=o(c,g),C=a(c,C),c=e[_+8],v[c]++,g=o(c,g),C=a(c,C),c=e[_+12],v[c]++,g=o(c,g),C=a(c,C),c=e[_+16],v[c]++,g=o(c,g),C=a(c,C),c=e[_+20],v[c]++,g=o(c,g),C=a(c,C),c=e[_+24],v[c]++,g=o(c,g),C=a(c,C),c=e[_+28],v[c]++,g=o(c,g),C=a(c,C);if(A)for(_=Y-A;Y>_;_+=4)c=e[_],v[c]++,g=o(c,g),C=a(c,C)}else{for(_=0;Y>_;_+=32)c=e[_],u=e[_+1],f=e[_+2],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_]=p,e[_+1]=h,e[_+2]=d,v[h]++,g=o(h,g),C=a(h,C),c=e[_+4],u=e[_+5],f=e[_+6],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+4]=p,e[_+5]=h,e[_+6]=d,v[h]++,g=o(h,g),C=a(h,C),c=e[_+8],u=e[_+9],f=e[_+10],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+8]=p,e[_+9]=h,e[_+10]=d,v[h]++,g=o(h,g),C=a(h,C),c=e[_+12],u=e[_+13],f=e[_+14],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+12]=p,e[_+13]=h,e[_+14]=d,v[h]++,g=o(h,g),C=a(h,C),c=e[_+16],u=e[_+17],f=e[_+18],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+16]=p,e[_+17]=h,e[_+18]=d,v[h]++,g=o(h,g),C=a(h,C),c=e[_+20],u=e[_+21],f=e[_+22],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+20]=p,e[_+21]=h,e[_+22]=d,v[h]++,g=o(h,g),C=a(h,C),c=e[_+24],u=e[_+25],f=e[_+26],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+24]=p,e[_+25]=h,e[_+26]=d,v[h]++,g=o(h,g),C=a(h,C),c=e[_+28],u=e[_+29],f=e[_+30],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+28]=p,e[_+29]=h,e[_+30]=d,v[h]++,g=o(h,g),C=a(h,C);if(A)for(_=Y-A;Y>_;_+=4)c=e[_],u=e[_+1],f=e[_+2],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_]=p,e[_+1]=h,e[_+2]=d,v[h]++,g=o(h,g),C=a(h,C)}for(m=0,_=0;256>_;_+=32)m+=v[_],v[_]=m,m+=v[_+1],v[_+1]=m,m+=v[_+2],v[_+2]=m,m+=v[_+3],v[_+3]=m,m+=v[_+4],v[_+4]=m,m+=v[_+5],v[_+5]=m,m+=v[_+6],v[_+6]=m,m+=v[_+7],v[_+7]=m,m+=v[_+8],v[_+8]=m,m+=v[_+9],v[_+9]=m,m+=v[_+10],v[_+10]=m,m+=v[_+11],v[_+11]=m,m+=v[_+12],v[_+12]=m,m+=v[_+13],v[_+13]=m,m+=v[_+14],v[_+14]=m,m+=v[_+15],v[_+15]=m,m+=v[_+16],v[_+16]=m,m+=v[_+17],v[_+17]=m,m+=v[_+18],v[_+18]=m,m+=v[_+19],v[_+19]=m,m+=v[_+20],v[_+20]=m,m+=v[_+21],v[_+21]=m,m+=v[_+22],v[_+22]=m,m+=v[_+23],v[_+23]=m,m+=v[_+24],v[_+24]=m,m+=v[_+25],v[_+25]=m,m+=v[_+26],v[_+26]=m,m+=v[_+27],v[_+27]=m,m+=v[_+28],v[_+28]=m,m+=v[_+29],v[_+29]=m,m+=v[_+30],v[_+30]=m,m+=v[_+31],v[_+31]=m;if(y=(g-C)/b,n)if(w){for(_=0;Y>_;_+=32)c=~~(v[e[_]]*y+C),c=0>c?0:c>255?255:c,e[_]=c,e[_+1]=c,e[_+2]=c,c=~~(v[e[_+4]]*y+C),c=0>c?0:c>255?255:c,e[_+4]=c,e[_+5]=c,e[_+6]=c,c=~~(v[e[_+8]]*y+C),c=0>c?0:c>255?255:c,e[_+8]=c,e[_+9]=c,e[_+10]=c,c=~~(v[e[_+12]]*y+C),c=0>c?0:c>255?255:c,e[_+12]=c,e[_+13]=c,e[_+14]=c,c=~~(v[e[_+16]]*y+C),c=0>c?0:c>255?255:c,e[_+16]=c,e[_+17]=c,e[_+18]=c,c=~~(v[e[_+20]]*y+C),c=0>c?0:c>255?255:c,e[_+20]=c,e[_+21]=c,e[_+22]=c,c=~~(v[e[_+24]]*y+C),c=0>c?0:c>255?255:c,e[_+24]=c,e[_+25]=c,e[_+26]=c,c=~~(v[e[_+28]]*y+C),c=0>c?0:c>255?255:c,e[_+28]=c,e[_+29]=c,e[_+30]=c;if(A)for(_=Y-A;Y>_;_+=4)c=~~(v[e[_]]*y+C),c=0>c?0:c>255?255:c,e[_]=c,e[_+1]=c,e[_+2]=c}else{for(_=0;Y>_;_+=32)h=v[e[_+1]]*y+C,d=e[_+2],p=e[_],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_]=c,e[_+1]=u,e[_+2]=f,h=v[e[_+5]]*y+C,d=e[_+6],p=e[_+4],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+4]=c,e[_+5]=u,e[_+6]=f,h=v[e[_+9]]*y+C,d=e[_+10],p=e[_+8],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+8]=c,e[_+9]=u,e[_+10]=f,h=v[e[_+13]]*y+C,d=e[_+14],p=e[_+12],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+12]=c,e[_+13]=u,e[_+14]=f,h=v[e[_+17]]*y+C,d=e[_+18],p=e[_+16],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+16]=c,e[_+17]=u,e[_+18]=f,h=v[e[_+21]]*y+C,d=e[_+22],p=e[_+20],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+20]=c,e[_+21]=u,e[_+22]=f,h=v[e[_+25]]*y+C,d=e[_+26],p=e[_+24],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+24]=c,e[_+25]=u,e[_+26]=f,h=v[e[_+29]]*y+C,d=e[_+30],p=e[_+28],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+28]=c,e[_+29]=u,e[_+30]=f;if(A)for(_=Y-A;Y>_;_+=4)h=v[e[_+1]]*y+C,d=e[_+2],p=e[_],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_]=c,e[_+1]=u,e[_+2]=f}else if(w){for(_=0;Y>_;_+=32)c=~~(v[e[_]]*y+C),e[_]=c,e[_+1]=c,e[_+2]=c,c=~~(v[e[_+4]]*y+C),e[_+4]=c,e[_+5]=c,e[_+6]=c,c=~~(v[e[_+8]]*y+C),e[_+8]=c,e[_+9]=c,e[_+10]=c,c=~~(v[e[_+12]]*y+C),e[_+12]=c,e[_+13]=c,e[_+14]=c,c=~~(v[e[_+16]]*y+C),e[_+16]=c,e[_+17]=c,e[_+18]=c,c=~~(v[e[_+20]]*y+C),e[_+20]=c,e[_+21]=c,e[_+22]=c,c=~~(v[e[_+24]]*y+C),e[_+24]=c,e[_+25]=c,e[_+26]=c,c=~~(v[e[_+28]]*y+C),e[_+28]=c,e[_+29]=c,e[_+30]=c;if(A)for(_=Y-A;Y>_;_+=4)c=~~(v[e[_]]*y+C),e[_]=c,e[_+1]=c,e[_+2]=c}else{for(_=0;Y>_;_+=32)h=v[e[_+1]]*y+C,d=e[_+2],p=e[_],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_]=c,e[_+1]=u,e[_+2]=f,h=v[e[_+5]]*y+C,d=e[_+6],p=e[_+4],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+4]=c,e[_+5]=u,e[_+6]=f,h=v[e[_+9]]*y+C,d=e[_+10],p=e[_+8],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+8]=c,e[_+9]=u,e[_+10]=f,h=v[e[_+13]]*y+C,d=e[_+14],p=e[_+12],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+12]=c,e[_+13]=u,e[_+14]=f,h=v[e[_+17]]*y+C,d=e[_+18],p=e[_+16],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+16]=c,e[_+17]=u,e[_+18]=f,h=v[e[_+21]]*y+C,d=e[_+22],p=e[_+20],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+20]=c,e[_+21]=u,e[_+22]=f,h=v[e[_+25]]*y+C,d=e[_+26],p=e[_+24],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+24]=c,e[_+25]=u,e[_+26]=f,h=v[e[_+29]]*y+C,d=e[_+30],p=e[_+28],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+28]=c,e[_+29]=u,e[_+30]=f;if(A)for(_=Y-A;Y>_;_+=4)h=v[e[_+1]]*y+C,d=e[_+2],p=e[_],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_]=c,e[_+1]=u,e[_+2]=f}return e}})}(n),!function(e){var n=e.ImArray,t=Math.sqrt,i=Math.min;Math.max,t(3);e.Create({name:"PixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:r,serialize:function(){var e=this;return{scale:e.scale}},unserialize:function(e){var n=this;return n.scale=e.scale,n},apply:function(e,r,a){var o=this;if(!o._isOn||o.scale<=1)return e;o.scale>100&&(o.scale=100);var l,s,c,u,f,h,d,p,y,v,m,_,g,C,Y,b,w,A,X,x,I,M=e.length,z=M>>>2,F=r-1,S=z-r;for(l=new n(M),s=~~(t(z)*o.scale*.01),c=s-1,u=r*c,g=C=Y=b=w=0,_=0;M>_;_+=4)A=g-Y,X=C-w,x=i(F,A+c),I=i(S,X+u),f=A+X<<2,h=A+I<<2,d=x+X<<2,p=x+I<<2,y=e[f]+e[h]+e[d]+e[p],v=e[f+1]+e[h+1]+e[d+1]+e[p+1],m=e[f+2]+e[h+2]+e[d+2]+e[p+2],l[_]=~~(.25*y),l[_+1]=~~(.25*v),l[_+2]=~~(.25*m),l[_+3]=e[_+3],g++,Y++,g>=r&&(Y=0,g=0,b++,w+=r,C+=r,b>=s&&(b=0,w=0)),Y>=s&&(Y=0);return l}}),e.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:r,serialize:function(){var e=this;return{scale:e.scale}},unserialize:function(e){var n=this;return n.scale=e.scale,n},apply:function(e,r,a){var o=this;if(!o._isOn||o.scale<=1)return e;o.scale>100&&(o.scale=100);var l,s,c,u,f,h,d,p,y,v,m,_,g,C,Y,b,w,A,X,x,I=e.length,M=I>>>2,z=r-1,F=M-r;for(l=new n(I),s=~~(t(M)*o.scale*.01),c=s-1,u=r*c,_=g=C=Y=b=0,m=0;I>m;m+=4)w=_-C,A=g-b,X=i(z,w+c),x=i(F,A+u),C+Y>c?(f=X+A<<2,h=X+x<<2,d=w+A<<2):(f=w+A<<2,h=w+x<<2,d=X+A<<2),p=e[f]+e[h]+e[d],y=e[f+1]+e[h+1]+e[d+1],v=e[f+2]+e[h+2]+e[d+2],l[m]=~~(.333*p),l[m+1]=~~(.333*y),l[m+2]=~~(.333*v),l[m+3]=e[m+3],_++,C++,_>=r&&(C=0,_=0,Y++,b+=r,g+=r,Y>=s&&(Y=0,b=0)),C>=s&&(C=0);return l}})}(n),!function(e,n){var t=7/16,i=3/16,a=5/16,o=1/16,l=e.MODE,s=e.Array32F,c=e.Color.clamp,u=e.Color.intensity;e.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:l.GRAY,inverse:!1,init:function(e,n,r,t){var i=this;i.size=e||1,i.thresh=c(null==n?.4:n,0,1),i.mode=r||l.GRAY,i.inverse=!!t},path:r,threshold:function(e){return this.thresh=c(e,0,1),this},grayscale:function(e){return arguments.length||(e=!0),this.mode=e?l.GRAY:l.RGB,this},invert:function(e){return arguments.length||(e=!0),this.inverse=!!e,this},serialize:function(){var e=this;return{size:e.size,thresh:e.thresh,mode:e.mode,inverse:e.inverse}},unserialize:function(e){var n=this;return n.size=e.size,n.thresh=e.thresh,n.mode=e.mode,n.inverse=e.inverse,n},apply:function(e,n,r){var c,f,h,d,p,y,v,m,_,g,C,Y,b,w,A,X,x,I,M,z,F,S=this,E=e.length,O=E>>>2,R=new s(3*O),L=S.size,T=L*L,U=1/T,N=S.inverse,P=255*S.thresh,G=G<<1,H=l.RGB===S.mode,D=L*n,q=N?0:255,k=N?255:0,j=t,$=i,B=a,W=o;for(p=0,y=0,d=0;r>p;){if(g=C=Y=0,H){for(v=0,m=0,_=0;L>m;)c=d+y+v+_<<2,f=3*(d+y+v+_),g+=e[c]+R[f],C+=e[c+1]+R[f+1],Y+=e[c+2]+R[f+2],++v>=L&&(v=0,m++,_+=n);g*=U,C*=U,Y*=U,h=u(g,C,Y),h>P?(b=~~g,w=~~C,A=~~Y):(b=k,w=k,A=k)}else{for(v=0,m=0,_=0;L>m;)c=d+y+v+_<<2,f=3*(d+y+v+_),g+=e[c]+R[f],++v>=L&&(v=0,m++,_+=n);h=g*U,h>P?(b=q,w=q,A=q):(b=k,w=k,A=k)}if(c=d+y<<2,X=e[c]-b,x=e[c+1]-w,I=e[c+2]-A,n>d+L)for(M=j*X,z=j*x,F=j*I,v=L,m=0,_=0;L>m;)f=3*(d+y+v+_),R[f]+=M,R[f+1]+=z,R[f+2]+=F,++v>=G&&(v=L,m++,_+=n);if(r>p+L&&d>L)for(M=$*X,z=$*x,F=$*I,v=-L,m=L,_=0;G>m;)f=3*(d+y+v+_),R[f]+=M,R[f+1]+=z,R[f+2]+=F,++v>=0&&(v=-L,m++,_+=n);if(r>p+L)for(M=B*X,z=B*x,F=B*I,v=0,m=L,_=0;G>m;)f=3*(d+y+v+_),R[f]+=M,R[f+1]+=z,R[f+2]+=F,++v>=L&&(v=0,m++,_+=n);if(r>p+L&&n>d+L)for(M=W*X,z=W*x,F=W*I,v=L,m=L,_=0;G>m;)f=3*(d+y+v+_),R[f]+=M,R[f+1]+=z,R[f+2]+=F,++v>=G&&(v=L,m++,_+=n);for(v=0,m=0,_=0;L>m;)c=d+y+v+_<<2,e[c]=b,e[c+1]=w,e[c+2]=A,++v>=L&&(v=0,m++,_+=n);d+=L,d>=n&&(d=0,p+=L,y+=D)}return e}})}(n),!function(e,n){var t=e.ImArray,i=e.Util.Filter.integral_convolution,a=new e.ConvolutionMatrix([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]);e.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:1,onlyShadow:!1,path:r,init:function(e,n,r,t,i,a){var o=this;o.offsetX=e||0,o.offsetY=n||0,o.color=r||0,o.opacity=null==t?1:+t,o.quality=~~(i||1),o.onlyShadow=!!a},dispose:function(){var e=this;return e.offsetX=null,e.offsetY=null,e.color=null,e.opacity=null,e.quality=null,e.onlyShadow=null,e.$super("dispose"),e},serialize:function(){var e=this;return{offsetX:e.offsetX,offsetY:e.offsetY,color:e.color,opacity:e.opacity,quality:e.quality,onlyShadow:e.onlyShadow}},unserialize:function(e){var n=this;return n.offsetX=e.offsetX,n.offsetY=e.offsetY,n.color=e.color,n.opacity=e.opacity,n.quality=e.quality,n.onlyShadow=e.onlyShadow,n},apply:function(e,n,r){var o=this;if(!o._isOn)return e;var l,s,c,u,f,h,d,p,y,v,m,_=o.color||0,g=o.opacity,C=o.quality,Y=o.onlyShadow,b=o.offsetX||0,w=o.offsetY||0,A=e.length,X=A>>>2;if(0>g&&(g=0),g>1&&(g=1),0===g)return e;for(l=_>>>16&255,s=_>>>8&255,c=255&_,0>=C&&(C=1),C>3&&(C=3),m=new t(A),u=0;A>u;u+=4)v=e[u+3],v>0&&(m[u]=l,m[u+1]=s,m[u+2]=c,m[u+3]=~~(g*v));if(m=i(!1,m,n,r,a,null,3,3,1,0,C),w*=n,Y)for(f=0,h=0,y=0;A>y;y+=4,f++)f>=n&&(f=0,h+=n),d=f+b,p=h+w,0>d||d>=n||0>p||p>=X||(u=d+p<<2,e[u]=m[y],e[u+1]=m[y+1],e[u+2]=m[y+2]);else for(f=0,h=0,y=0;A>y;y+=4,f++)f>=n&&(f=0,h+=n),d=f+b,p=h+w,0>d||d>=n||0>p||p>=X||(u=d+p<<2,v=e[u+3],g=m[y+3],255!==v&&0!==g&&(g/=255,l=~~(e[u]+(m[y]-e[u])*g),s=~~(e[u+1]+(m[y+1]-e[u+1])*g),c=~~(e[u+2]+(m[y+2]-e[u+2])*g),e[u]=l,e[u+1]=s,e[u+2]=c));return e}})}(n),!function(e){var n=(Math.sqrt,Math.exp,Math.log),t=Math.abs,i=Math.floor,a=e._notSupportClamp,o=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,n,r,t){var i=this;i.centerX=e||0,i.centerY=n||0,i.radius=r||10,i.amount=t||10},path:r,serialize:function(){var e=this;return{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}},unserialize:function(e){var n=this;return n.centerX=e.centerX,n.centerY=e.centerY,n.radius=e.radius,n.amount=e.amount,n},apply:function(e,r,l){var s=this;if(!s._isOn)return e;var c,u,f,h,d,p,y,v,m,_,g,C,Y,b,w,A,X,x,I,M,z,F,S,E,O,R,L,T,U,N,P,G,H,D=e.length,q=s.centerX||0,k=s.centerY||0,j=s.radius,$=s.amount;if(0>=$)return e;for(c=D>>>2,N=0,P=r-1,G=0,H=c-r,q=i(q*(r-1)),k=i(k*(l-1)),f=(c<<1)+c,y=(r<<1)+r,u=new o(f),v=0,m=0,_=0,h=d=p=0,_=0;r>_;_++,v+=4,m+=3)h+=e[v],d+=e[v+1],p+=e[v+2],u[m]=h,u[m+1]=d,u[m+2]=p;for(v=y+r,m=0,_=0,h=d=p=0,v=y+r;D>v;v+=4,m+=3,_++)_>=r&&(_=0,h=d=p=0),h+=e[v],d+=e[v+1],p+=e[v+2],u[m+y]=u[m]+h,u[m+y+1]=u[m+1]+d,u[m+y+2]=u[m+2]+p;for(_=0,g=0,C=0,v=0;D>v;v+=4,_++)_>=r&&(_=0,g++,C+=r),b=_-q,w=g-k,Y=t(b)+t(w),A=Y>j?~~n((Y-j)*$):~~(Y/j+.5),A>0&&(X=A*r,x=.25/(A*A),I=_-A,M=C-X,z=_+A,F=C+X,N>I?I=N:z>P&&(z=P),G>M?M=G:F>H&&(F=H),S=I+M,R=z+F,E=z+M,O=I+F,S=(S<<1)+S,E=(E<<1)+E,O=(O<<1)+O,R=(R<<1)+R,L=x*(u[R]-u[E]-u[O]+u[S]),T=x*(u[R+1]-u[E+1]-u[O+1]+u[S+1]),U=x*(u[R+2]-u[E+2]-u[O+2]+u[S+2]),a&&(L=0>L?0:L>255?255:L,T=0>T?0:T>255?255:T,U=0>U?0:U>255?255:U),e[v]=~~L,e[v+1]=~~T,e[v+2]=~~U);return e}})}(n),!function(e){e.Create({name:"SeamlessTileFilter",type:2,init:function(e){var n=this;n.type=null==e?2:e||0},path:r,serialize:function(){var e=this;return{type:e.type}},unserialize:function(e){var n=this;return n.type=e.type,n},apply:function(n,r,t){var i,a,o,l,s,c,u,f,h,d,p,y,v,m,_,g=this,C=g.type,Y=e.Interpolation.bilinear,b=e.ImArray,w=e.Array8U,A=Math.sqrt;for(r!==t?n=Y(n,r,t,y=r>t?r:t,y):y=r,v=Math.round(y/2),m=y*y,_=n.length,i=new b(_),a=new b(_),o=new w(m),f=0,h=0,d=0;_>d;d+=4,f++)f>=y&&(f=0,h++),p=(f+v)%y+(h+v)%y*y<<2,i[p]=n[d],i[p+1]=n[d+1],i[p+2]=n[d+2],i[p+3]=n[d+3];if(0===C)for(f=0,h=0;v>f;h++)h>=v&&(h=0,f++),u=255-255*A((f-v)*(f-v)+(h-v)*(h-v))/v,u=1>u?1:u>255?255:u,o[f+h*y]=u,o[f+(y-1-h)*y]=u,o[y-1-f+h*y]=u,o[y-1-f+(y-1-h)*y]=u;else if(1===C)for(f=0,h=0;v>f;h++)h>=v&&(h=0,f++),u=255-255*(v+f>v+h?(h-v)/v:(f-y/2)/v),u=1>u?1:u>255?255:u,o[f+h*y]=u,o[f+(y-1-h)*y]=u,o[y-1-f+h*y]=u,o[y-1-f+(y-1-h)*y]=u;else for(f=0,h=0;v>f;h++)h>=v&&(h=0,f++),u=255-255*(v+f>v+h?A((h-y)*(h-y)+(f-y)*(f-y))/(1.13*y):A((f-y)*(f-y)+(h-y)*(h-y))/(1.13*y)),u=1>u?1:u>255?255:u,o[f+h*y]=u,o[f+(y-1-h)*y]=u,o[y-1-f+h*y]=u,o[y-1-f+(y-1-h)*y]=u;for(h=0,f=0;y>h;f++)f>=y&&(f=0,h++),p=f+h*y,l=o[p],s=o[(f+v)%y+(h+v)%y*y],c=l+s,l/=c,s/=c,p<<=2,a[p]=~~(l*n[p]+s*i[p]),a[p+1]=~~(l*n[p+1]+s*i[p+1]),a[p+2]=~~(l*n[p+2]+s*i[p+2]),a[p+3]=n[p+3];return r!==t&&(a=Y(a,y,y,r,t)),a}})}(n),!function(e){var n=(e.Util.Array.typed,Math.abs),t=(Math.min,Math.max,Math.ceil),i=e.MODE,a=e.Array8U,o=e.Array32U;e.Create({name:"FloodFillFilter",x:0,y:0,color:null,borderColor:null,tolerance:0,path:r,init:function(e,n,r,t,i){var a=this;a.x=e||0,a.y=n||0,a.color=r||0,a.tolerance=t||0,a.borderColor=i===+i?+i:null},serialize:function(){var e=this;return{color:e.color,borderColor:e.borderColor,x:e.x,y:e.y,tolerance:e.tolerance}},unserialize:function(e){var n=this;return n.color=e.color,n.borderColor=e.borderColor,n.x=e.x,n.y=e.y,n.tolerance=e.tolerance,n},apply:function(e,r,t){var i,o,l,s,c,u,f,h,d,p,y,v,m=this,_=~~(255*(m.tolerance>=1?.999:m.tolerance)),g=m.color||0,C=m.borderColor,Y=C===+C,b=r<<2,w=m.x,A=m.y,X=e.length,x=0,I=X-b,M=0,z=r-1<<2;if(h=A*r<<2,w<<=2,M>w||w>z||x>h||h>I)return e;if(i=new a(3),o=new a(3),o[0]=g>>>16&255,o[1]=g>>>8&255,o[2]=255&g,Y){if(i[0]=C>>>16&255,i[1]=C>>>8&255,i[2]=255&C,n(i[0]-e[w+h])<=_&&n(i[1]-e[w+h+1])<=_&&n(i[2]-e[w+h+2])<=_)return e}else{if(e[w+h]===o[0]&&e[w+h+1]===o[1]&&e[w+h+2]===o[2])return e;i[0]=e[w+h],i[1]=e[w+h+1],i[2]=e[w+h+2]}for(d=new Array(X>>>2),p=0,h+b>=x&&I>=h+b&&(d[p++]=[h,w,w,b]),d[p++]=[h+b,w,w,-b];p>0;){if(y=d[--p],h=y[0]+(b=y[3]),u=y[1],f=y[2],Y)for(c=u;c>=M&&(s=c+h,!(n(i[0]-e[s])<=_&&n(i[1]-e[s+1])<=_&&n(i[2]-e[s+2])<=_));c-=4)e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2];else for(c=u;c>=M&&(s=c+h,n(i[0]-e[s])<=_&&n(i[1]-e[s+1])<=_&&n(i[2]-e[s+2])<=_);c-=4)e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2];if(c>=u){if(s=c+h,Y)for(;f>=c&&n(i[0]-e[s])<=_&&n(i[1]-e[s+1])<=_&&n(i[2]-e[s+2])<=_;)c+=4,s=c+h;else for(;f>=c&&!(n(i[0]-e[s])<=_&&n(i[1]-e[s+1])<=_&&n(i[2]-e[s+2])<=_);)c+=4,s=c+h;l=c,v=f>=c}else l=c+4,u>l&&h-b>=x&&I>=h-b&&(d[p++]=[h,l,u-4,-b]),c=u+4,v=!0;for(;v;){if(s=c+h,Y)for(;z>=c&&!(n(i[0]-e[s])<=_&&n(i[1]-e[s+1])<=_&&n(i[2]-e[s+2])<=_);)e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],c+=4,s=c+h;else for(;z>=c&&n(i[0]-e[s])<=_&&n(i[1]-e[s+1])<=_&&n(i[2]-e[s+2])<=_;)e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],c+=4,s=c+h;if(h+b>=x&&I>=h+b&&(d[p++]=[h,l,c-4,b]),c>f+4&&h-b>=x&&I>=h-b&&(d[p++]=[h,f+4,c-4,-b]),s=c+h,Y)for(;f>=c&&n(i[0]-e[s])<=_&&n(i[1]-e[s+1])<=_&&n(i[2]-e[s+2])<=_;)c+=4,s=c+h;else for(;f>=c&&!(n(i[0]-e[s])<=_&&n(i[1]-e[s+1])<=_&&n(i[2]-e[s+2])<=_);)c+=4,s=c+h;l=c,v=f>=c}}return e}}),e.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:0,mode:i.TILE,borderColor:null,hasInputs:!0,path:r,init:function(e,n,r,t,a,o,l,s){var c=this;c.x=e||0,c.y=n||0,c.offsetX=t||0,c.offsetY=a||0,r&&c.setInput("pattern",r),c.mode=o||i.TILE,c.tolerance=l||0,c.borderColor=s===+s?+s:null},dispose:function(){var e=this;return e.x=null,e.y=null,e.offsetX=null,e.offsetY=null,e.tolerance=null,e.mode=null,e.borderColor=null,e.$super("dispose"),e},serialize:function(){var e=this;return{x:e.x,y:e.y,offsetX:e.offsetX,offsetY:e.offsetY,tolerance:e.tolerance,mode:e.mode,borderColor:e.borderColor}},unserialize:function(e){var n=this;return n.x=e.x,n.y=e.y,n.offsetX=e.offsetX,n.offsetY=e.offsetY,n.tolerance=e.tolerance,n.mode=e.mode,n.borderColor=e.borderColor,n},apply:function(e,r,l){var s,c=this;if(!c._isOn)return e;if(s=c.input("pattern"),!s)return e;var u,f,h,d,p,y,v,m,_,g,C,Y,b,w,A,X,x=~~(255*(c.tolerance>=1?.999:c.tolerance)),I=c.mode,M=c.borderColor,z=M===+M,F=r<<2,S=s[0],E=s[1],O=s[2],R=c.x,L=c.y,T=c.offsetX||0,U=c.offsetY||0,N=e.length,P=N>>>2,G=0,H=N-F,D=0,q=r-1<<2,k=i.STRETCH;if(0>T&&(T+=E),0>U&&(U+=O),p=L,m=L*r<<2,R<<=2,D>R||R>q||G>m||m>H)return e;if(u=new a(3),z){if(u[0]=M>>>16&255,u[1]=M>>>8&255,u[2]=255&M,n(u[0]-e[R+m])<=x&&n(u[1]-e[R+m+1])<=x&&n(u[2]-e[R+m+2])<=x)return e;
}else u[0]=e[R+m],u[1]=e[R+m+1],u[2]=e[R+m+2];for(Y=new Array(P),b=0,w=new o(t(P/32)),m+F>=G&&H>=m+F&&(Y[b++]=[m,R,R,F,p+1]),Y[b++]=[m+F,R,R,-F,p];b>0;){if(A=Y[--b],m=A[0]+(F=A[3]),y=A[1],v=A[2],p=A[4],z)for(d=y;d>=D&&(h=d+m,!(w[h>>>7]&1<<(h>>>2&31)||n(u[0]-e[h])<=x&&n(u[1]-e[h+1])<=x&&n(u[2]-e[h+2])<=x));d-=4)w[h>>>7]|=1<<(h>>>2&31),k===I?(g=~~(E*(d>>>2)/r),C=~~(O*p/l)):(g=((d>>>2)+T)%E,C=(p+U)%O),_=g+C*E<<2,e[h]=S[_],e[h+1]=S[_+1],e[h+2]=S[_+2];else for(d=y;d>=D&&(h=d+m,!(w[h>>>7]&1<<(h>>>2&31))&&n(u[0]-e[h])<=x&&n(u[1]-e[h+1])<=x&&n(u[2]-e[h+2])<=x);d-=4)w[h>>>7]|=1<<(h>>>2&31),k===I?(g=~~(E*(d>>>2)/r),C=~~(O*p/l)):(g=((d>>>2)+T)%E,C=(p+U)%O),_=g+C*E<<2,e[h]=S[_],e[h+1]=S[_+1],e[h+2]=S[_+2];if(d>=y){if(h=d+m,z)for(;v>=d&&w[h>>>7]&1<<(h>>>2&31)||n(u[0]-e[h])<=x&&n(u[1]-e[h+1])<=x&&n(u[2]-e[h+2])<=x;)d+=4,h=d+m;else for(;v>=d&&!(!(w[h>>>7]&1<<(h>>>2&31))&&n(u[0]-e[h])<=x&&n(u[1]-e[h+1])<=x&&n(u[2]-e[h+2])<=x);)d+=4,h=d+m;f=d,X=v>=d}else f=d+4,y>f&&m-F>=G&&H>=m-F&&(Y[b++]=[m,f,y-4,-F,F>0?p-1:p+1]),d=y+4,X=!0;for(;X;){if(h=d+m,z)for(;q>=d&&!(w[h>>>7]&1<<(h>>>2&31))&&!(n(u[0]-e[h])<=x&&n(u[1]-e[h+1])<=x&&n(u[2]-e[h+2])<=x);)w[h>>>7]|=1<<(h>>>2&31),k===I?(g=~~(E*(d>>>2)/r),C=~~(O*p/l)):(g=((d>>>2)+T)%E,C=(p+U)%O),_=g+C*E<<2,e[h]=S[_],e[h+1]=S[_+1],e[h+2]=S[_+2],d+=4,h=d+m;else for(;q>=d&&!(w[h>>>7]&1<<(h>>>2&31))&&n(u[0]-e[h])<=x&&n(u[1]-e[h+1])<=x&&n(u[2]-e[h+2])<=x;)w[h>>>7]|=1<<(h>>>2&31),k===I?(g=~~(E*(d>>>2)/r),C=~~(O*p/l)):(g=((d>>>2)+T)%E,C=(p+U)%O),_=g+C*E<<2,e[h]=S[_],e[h+1]=S[_+1],e[h+2]=S[_+2],d+=4,h=d+m;if(m+F>=G&&H>=m+F&&(Y[b++]=[m,f,d-4,F,F>0?p+1:p-1]),d>v+4&&m-F>=G&&H>=m-F&&(Y[b++]=[m,v+4,d-4,-F,F>0?p-1:p+1]),h=d+m,z)for(;v>=d&&w[h>>>7]&1<<(h>>>2&31)||n(u[0]-e[h])<=x&&n(u[1]-e[h+1])<=x&&n(u[2]-e[h+2])<=x;)d+=4,h=d+m;else for(;v>=d&&!(!(w[h>>>7]&1<<(h>>>2&31))&&n(u[0]-e[h])<=x&&n(u[1]-e[h+1])<=x&&n(u[2]-e[h+2])<=x);)d+=4,h=d+m;f=d,X=v>=d}}return e}})}(n),!function(e){function n(e,n,r,t){var i,o,y,v,m,_=2,g=14,C=(e.length,t.length),Y=new a(C),b=new a(C),w=new a(C),A=new a(C),X=new a(g),x=new a(g),I=_*_,M=2*I,z=f*I;for(i=0;g>i&&(o=h(-(i*i)/M),!(l>=o&&i>=2));i++)y=h(-((m=i-.5)*m)/M),v=h(-((m=i+.5)*m)/M),X[i]=(o+y+v)/3/z,x[i]=v-y;var m,F,S,E,O,R,L,T,U,N=i-1,P=n-(i-1),G=n*(i-1),H=n*(r-(i-1));for(m=N,F=G;P>m;F+=n){for(F>=H&&(F=G,m++),S=m+F,E=e[S<<2]*X[0],O=E,R=1,L=n;i>R;)O+=X[R]*(e[S-L<<2]+e[S+L<<2]),E+=X[R]*(e[S-R<<2]+e[S+R<<2]),L+=n,R++;b[S]=O,Y[S]=E}for(m=N,F=G;P>m;F+=n){for(F>=H&&(F=G,m++),T=0,S=m+F,U=1;i>U;U++)T+=x[U]*(b[S-U]-b[S+U]);w[S]=T}for(P=n-i,m=i,F=G;P>m;F+=n){for(F>=H&&(F=G,m++),T=0,S=m+F,L=n,U=1;i>U;U++)T+=x[U]*(Y[S-L]-Y[S+L]),L+=n;A[S]=T}N=i,P=n-i,G=n*i,H=n*(r-i);var D,q,k,j,$,B,W,J,K,Q,V,Z,ee,ne,re,te,ie,ae,oe,le;for(m=N,F=G;P>m;F+=n)F>=H&&(F=G,m++),S=m+F,D=S-n,q=S+n,j=S-1,k=S+1,$=D-1,B=D+1,W=q-1,J=q+1,K=w[S],Q=A[S],V=d(K)+d(Q),ee=d(w[D])+d(A[D]),ne=d(w[q])+d(A[q]),te=d(w[j])+d(A[j]),re=d(w[k])+d(A[k]),ae=d(w[B])+d(A[B]),le=d(w[J])+d(A[J]),oe=d(w[W])+d(A[W]),ie=d(w[$])+d(A[$]),(0>=K*Q?d(K)>=d(Q)?(Z=d(K*V))>=d(Q*ae-(K+Q)*re)&&Z>d(Q*oe-(K+Q)*te):(Z=d(Q*V))>=d(K*ae-(Q+K)*ee)&&Z>d(K*oe-(Q+K)*ne):d(K)>=d(Q)?(Z=d(K*V))>=d(Q*le+(K-Q)*re)&&Z>d(Q*ie+(K-Q)*te):(Z=d(Q*V))>=d(K*le+(Q-K)*ne)&&Z>d(K*ie+(Q-K)*ee))?t[S]=V>=c?u:p(s*V):t[S]=0}function t(e,n,r,t,a,o){var l,s,c,u,f=e.length,h=f>>>2;for(l=0;f>l;l+=4)e[l]=e[l+1]=e[l+2]=0;for(u=0,c=0,s=0,l=0;h>s;s++,l=s<<2,u++)u>=n&&(u=0,c++),0===e[l]&&t[s]>=o&&i(e,n,r,t,u,c,l,a)}function i(e,n,r,t,a,o,l,s){var c,u,f,h,d,p=0===a?a:a-1,y=a===n-1?a:a+1,v=0===o?o:o-1,m=o===r-1?o:o+1,_=v*n;for(e[l]=e[l+1]=e[l+2]=255,c=p,u=v,f=_;y>=c&&m>=u;){if(d=c+f,h=d<<2,(u!==o||c!==a)&&0===e[h]&&t[d]>=s)return void i(e,n,r,t,c,u,h,s);u++,f+=n,u>m&&(u=v,f=_,c++)}}var a=e.Array32F,o=e.Array32I,l=(e.Util.Filter.GRAD,.005),s=100,c=1e3,u=s*c,f=2*Math.PI,h=Math.exp,d=Math.abs,p=Math.floor,y=Math.round;e.Util.Filter.canny_gradient=n,e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,path:r,init:function(e,n){var r=this;r.low=arguments.length<1?2.5:e,r.high=arguments.length<2?7.5:n},thresholds:function(e,n){var r=this;return r.low=e,r.high=n,r},serialize:function(){var e=this;return{low:e.low,high:e.high}},unserialize:function(e){var n=this;return n.low=e.low,n.high=e.high,n},apply:function(n,r,i){var a,l=this,c=n.length>>2,u=e.Util.Filter.canny_gradient;return u(n,r,i,a=new o(c)),t(n,r,i,a,y(l.low*s),y(l.high*s)),n}})}(n),!function(e,n){function t(e,n,r,t,i,a,o,l,s,c,u,f,p,y,v,g,C){var Y,b,w,A,X,x,I,M,z,F,S,E,O,R,L,T,U,N,P,G,H,D,q,k,j,$,B,W,J,K,Q,V,Z,ee,P,ne,re,te,ie,ae,oe,le,se,ce,ue,fe,he,de,pe,ye,ve,me,_e,ge=null!=v,Ce=a-t+1,Ye=o-i+1,be=Ce*Ye,we=be-1,Ae=l.stages,Xe=Ae.length,xe=l.size1,Ie=l.size2,Me=h(Ce/xe,Ye/Ie),ze=t,Fe=i;for(G=0,H=Ce-1,D=0,q=be-Ce,Y=s,Y=s;Me>=Y;Y*=c)for(A=~~(Y*xe),b=~~(A*u),X=~~(Y*Ie),w=~~(X*u),F=X*Ce,S=w*Ce,x=Fe*S,T=Ce-A,U=Ye-X,k=A*X,j=1/k,M=Fe,z=x;U>M;M+=w,z+=S)for(I=ze;T>I;I+=b)if(E=I-1+z-Ce,O=E+A,R=E+F,L=R+A,E=0>E?0:E>we?we:E,O=0>O?0:O>we?we:O,R=0>R?0:R>we?we:R,L=0>L?0:L>we?we:L,!(ge&&(J=j*(v[L]-v[R]-v[O]+v[E]),g>J||J>C))){for($=j*(f[L]-f[R]-f[O]+f[E]),B=j*(y[L]-y[R]-y[O]+y[E]),W=B-$*$,W=W>1?d(W):1,K=!1,N=0;Xe>N;N++){for(Q=Ae[N],V=Q.thres,Z=Q.trees,ee=Z.length,_e=0,P=0;ee>P;P++)for(re=Z[P].feats,ne=0;;){if(te=re[ne],ie=te.rects,ae=ie.length,oe=te.thres,le=0,te.tilt)for(se=0;ae>se;se++)ce=ie[se],ue=I+~~(Y*ce[0]),fe=(M-1+~~(Y*ce[1]))*Ce,he=I+~~(Y*(ce[0]+ce[2])),de=(M-1+~~(Y*(ce[1]+ce[2])))*Ce,pe=I+~~(Y*(ce[0]-ce[3])),ye=(M-1+~~(Y*(ce[1]+ce[3])))*Ce,ve=I+~~(Y*(ce[0]+ce[2]-ce[3])),me=(M-1+~~(Y*(ce[1]+ce[2]+ce[3])))*Ce,ue=G>ue?G:ue>H?H:ue,he=G>he?G:he>H?H:he,pe=G>pe?G:pe>H?H:pe,ve=G>ve?G:ve>H?H:ve,fe=D>fe?D:fe>q?q:fe,de=D>de?D:de>q?q:de,ye=D>ye?D:ye>q?q:ye,me=D>me?D:me>q?q:me,le+=ce[4]*(p[ve+me]-p[pe+ye]-p[he+de]+p[ue+fe]);else for(se=0;ae>se;se++)ce=ie[se],ue=I-1+~~(Y*ce[0]),he=I-1+~~(Y*(ce[0]+ce[2])),fe=Ce*(M-1+~~(Y*ce[1])),de=Ce*(M-1+~~(Y*(ce[1]+ce[3]))),ue=G>ue?G:ue>H?H:ue,he=G>he?G:he>H?H:he,fe=D>fe?D:fe>q?q:fe,de=D>de?D:de>q?q:de,le+=ce[4]*(f[he+de]-f[ue+de]-f[he+fe]+f[ue+fe]);if(oe*W>le*j){if(te.has_l){_e+=te.l_val;break}ne=te.l_node}else{if(te.has_r){_e+=te.r_val;break}ne=te.r_node}}if(K=_e>V,!K)break}K&&(e.count===e.length&&_.apply(e,new Array(m)),e[e.count++]=[I,M,A,X])}}function i(e,n,r){var t=f(n[2],e[2])*r,i=f(n[3],e[3])*r;return u(e[0]-n[0])<=t&&u(e[1]-n[1])<=i&&u(e[2]-n[2])<=t&&u(e[3]-n[3])<=i}function a(e,n){return e.x1>=n.x1&&e.y1>=n.y1&&e.x2<=n.x2&&e.y2<=n.y2}function o(e){e.x1=~~(e.x1+.5),e.y1=~~(e.y1+.5),e.x2=~~(e.x2+.5),e.y2=~~(e.y2+.5)}function l(e,n){return n.area-e.area}function s(e,n,r){var t,s,c,u,f,h,d,p,y,v,m,_=e.length,g=new Array(_),C=[],Y=0,b=!1;for(c=0;_>c;c++)g[c]=0;for(c=0;_>c;c++){for(b=!1,u=0;c>u;u++)i(e[u],e[c],r)&&(b=!0,g[c]=g[u]);b||(g[c]=Y,Y++)}for(t=new Array(Y),s=new Array(Y),c=0;Y>c;c++)t[c]=0,s[c]=[0,0,0,0];for(c=0;_>c;c++)d=g[c],t[d]++,s[d][0]+=e[c][0],s[d][1]+=e[c][1],s[d][2]+=e[c][2],s[d][3]+=e[c][3];for(c=0;Y>c;c++)f=t[c],f>=n&&(h=1/(f+f),p=h*(2*s[c][0]+f),y=h*(2*s[c][1]+f),v=h*(2*s[c][2]+f),m=h*(2*s[c][3]+f),C.push({x1:p,y1:y,x2:p+v-1,y2:y+m-1,x:p,y:y,width:v,height:m,area:0,inside:0}));for(_=C.length,c=0;_>c;c++)for(u=c+1;_>u;u++)!C[c].inside&&a(C[c],C[u])?C[c].inside=1:!C[u].inside&&a(C[u],C[c])&&(C[u].inside=1);for(c=_;--c>=0;)C[c].inside?C.splice(c,1):(o(C[c]),C[c].area=C[c].width*C[c].height);return C.sort(l)}var c=e.Array32F,u=(e.Array8U,Math.abs),f=Math.max,h=Math.min,d=(Math.floor,Math.round,Math.sqrt),p=e.Util.Array.typed,y=e.Util.Array.typed_obj,v="hasOwnProperty",m=10,_=Array.prototype.push,g=e.Util.Filter.SAT,C=e.Util.Filter.GRAD;e.Util.Filter.haar_detect=t,e.Util.Filter.merge_features=s,e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,selection:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,r,t,i,a,o,l){var s=this;s.objects=null,s.haardata=e||null,s.baseScale=n===r?1:r,s.scaleIncrement=n===t?1.25:t,s.stepIncrement=n===i?.5:i,s.minNeighbors=n===a?1:a,s.doCannyPruning=n===o?!0:!!o,s.tolerance=null==l?.2:+l,s._haarchanged=!!s.haardata},path:r,dispose:function(){var e=this;return e.selection=null,e.objects=null,e.haardata=null,e.$super("dispose"),e},haar:function(e){var n=this;return n.haardata=e,n._haarchanged=!0,n},select:function(e,n,r,t){var i=this;return!1===e?i.selection=null:i.selection=[h(1,f(0,e||0)),h(1,f(0,n||0)),h(1,f(0,r||0)),h(1,f(0,t||0))],i},params:function(e){var n=this;return e&&(e[v]("haardata")&&(n.haardata=e.haardata,n._haarchanged=!0),e[v]("baseScale")&&(n.baseScale=e.baseScale),e[v]("scaleIncrement")&&(n.scaleIncrement=e.scaleIncrement),e[v]("stepIncrement")&&(n.stepIncrement=e.stepIncrement),e[v]("minNeighbors")&&(n.minNeighbors=e.minNeighbors),e[v]("doCannyPruning")&&(n.doCannyPruning=e.doCannyPruning),e[v]("tolerance")&&(n.tolerance=e.tolerance),e[v]("cannyLow")&&(n.cannyLow=e.cannyLow),e[v]("cannyHigh")&&(n.cannyHigh=e.cannyHigh),e[v]("selection")&&(n.selection=e.selection||null)),n},serialize:function(){var e,n=this;return e={baseScale:n.baseScale,scaleIncrement:n.scaleIncrement,stepIncrement:n.stepIncrement,minNeighbors:n.minNeighbors,doCannyPruning:n.doCannyPruning,tolerance:n.tolerance,cannyLow:n.cannyLow,cannyHigh:n.cannyHigh,selection:n.selection},n._haarchanged&&(e.haardata=y(n.haardata),n._haarchanged=!1),e},unserialize:function(e){var n=this;return e[v]("haardata")&&(n.haardata=y(e.haardata,1)),n.baseScale=e.baseScale,n.scaleIncrement=e.scaleIncrement,n.stepIncrement=e.stepIncrement,n.minNeighbors=e.minNeighbors,n.doCannyPruning=e.doCannyPruning,n.tolerance=e.tolerance,n.cannyLow=e.cannyLow,n.cannyHigh=e.cannyHigh,n.selection=p(e.selection,Array),n},getMeta:function(){return e.isWorker?y(this.objects):this.objects},setMeta:function(e){return this.objects="string"==typeof e?y(e,1):e,this},apply:function(n,r,t,i,a){var o=this;if(!o._isOn||!o.haardata)return n;var l,s,u,d,p,y=n.length>>>2,v=o.selection||null,_=null,Y=null,b=null,w=null,A=e.Util.Filter.haar_detect,X=e.Util.Filter.merge_features;return v?(l=h(r-1,f(0,v[0]*(r-1))),s=h(t-1,f(0,v[1]*(t-1))),u=h(r-1,f(0,v[2]*(r-1))),d=h(t-1,f(0,v[3]*(t-1)))):(l=0,s=0,u=r-1,d=t-1),a&&a.SAT?(_=a.SAT,Y=a.SAT2,b=a.RSAT):(g(n,r,t,_=new c(y),Y=new c(y),b=new c(y)),a&&(a.SAT=_,a.SAT2=Y,a.RSAT=b)),o.doCannyPruning&&(a&&a.EDGES?w=a.EDGES:(C(n,r,t,w=new c(y),null,1),a&&(a.EDGES=w))),p=new Array(m),p.count=0,A(p,r,t,l,s,u,d,o.haardata,o.baseScale,o.scaleIncrement,o.stepIncrement,_,b,Y,w,o.cannyLow,o.cannyHigh),p.length>p.count&&(p.length=p.count),o.objects=X(p,o.minNeighbors,o.tolerance),n}})}(n),!function(e,n){function t(e,n){for(;n[e][1]!==e;)n[e][1]=n[n[e][1]][1],e=n[e][1];return e}function i(e,n,r){var i=t(e,r),a=t(n,r);i!==a&&(r[i][1]=a)}function a(e,n,r){var t=r.next;return t+1>r.length&&Array.prototype.push.apply(r,new Array(C)),r[t]=[t,t,0],++r.next,t}function o(e,n,r,t){return e}function l(e,n,r,t,i){return 0===e[n+3]&&0===e[r+3]||g(e[n]-e[r])<=t&&g(e[n+1]-e[r+1])<=t&&g(e[n+2]-e[r+2])<=t}function s(e,n,r,t,i){return g(n[r]-e[0])<=t&&g(n[r+1]-e[1])<=t&&g(n[r+2]-e[2])<=t}function c(e,n,r,t,i){if(0===e[n+3]&&0===e[r+3])return!0;var a=n>>>2,o=r>>>2;return null==i[a]&&(i[a]=v(e[n],e[n+1],e[n+2])),null==i[o]&&(i[o]=v(e[r],e[r+1],e[r+2])),g(i[a],i[o])<=t}function u(e,n,r,t,i){var a=r>>>2;return null==i[a]&&(i[a]=v(n[r],n[r+1],n[r+2])),g(i[a],e)<=t}function f(e,n,r,t,i){if(0===e[n+3]&&0===e[r+3])return!0;var a=n>>>2,o=r>>>2;return null==i[a]&&(i[a]=y(e[n],e[n+1],e[n+2])),null==i[o]&&(i[o]=y(e[r],e[r+1],e[r+2])),g(i[a],i[o])<=t}function h(e,n,r,t,i){var a=r>>>2;return null==i[a]&&(i[a]=y(n[r],n[r+1],n[r+2])),g(i[a],e)<=t}var d=e.Array32U,p=e.MODE,y=e.Color.hue,v=e.Color.intensity,m=Math.min,_=Math.max,g=Math.abs,C=20;e.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:0,mode:p.COLOR,color:null,invert:!1,box:null,init:function(e,n,r,t,i){var a=this;a.connectivity=8===e?8:4,a.tolerance=n||0,a.mode=r||p.COLOR,a.color=null==t?null:t,a.invert=!!i},path:r,serialize:function(){var e=this;return{connectivity:e.connectivity,tolerance:e.tolerance,mode:e.mode,color:e.color,invert:e.invert}},unserialize:function(e){var n=this;return n.connectivity=e.connectivity,n.tolerance=e.tolerance,n.mode=e.mode,n.color=e.color,n.invert=e.invert,n},apply:function(e,n,r){var y=this;if(!y._isOn)return e;var v,g,Y,b,w,A,X,x,I,M,z,F,S=e.length,E=S>>>2,O=n<<2,R=y.mode||p.COLOR,L=y.invert,T=y.color,U=m(.999,_(0,y.tolerance||0)),N=8===y.connectivity?8:4,P=8===N,G=P?-1:0,H=G<<2,D=null,q=null,k=null,j=null,$=null!=T;for(I=new Array(C),I.next=0,M=new d(E),p.HUE===R?(U*=360,D=f,q=new Array(E),$&&(k=h)):p.INTENSITY===R?(U*=255,D=c,q=new Array(E),$&&(k=u)):(U*=255,D=l,$&&(T=[T>>>16&255,T>>>8&255,255&T],k=s)),j=$?a(0,0,I):null,M[0]=$&&!k(T,e,0,U,q)?j:a(0,0,I),w=1,v=4;n>w;w++,v+4)M[w]=$&&!k(T,e,v,U,q)?j:D(e,v,v-4,U,q)?o(M[w-1],w,0,I):a(w,0,I);for(A=1,x=n,v=O;r>A;A++,x+=n,v+=O)for(M[x]=$&&!k(T,e,v,U,q)?j:D(e,v,v-O,U,q)?o(M[x-n],0,A,I):a(0,A,I),w=1,g=4;n>w;w++,g+=4)if(!$||k(T,e,v+g,U,q)){for(b=j===M[x+w-1]?-1:D(e,v+g,v+g-4,U,q)?o(M[x+w-1],w,A,I):-1,X=G,Y=H;1>X;X++,Y+=4)j!==M[x-n+w+X]&&D(e,v+g,v-O+g+Y,U,q)&&(b>=0?i(b,M[x-n+w+X],I):b=o(M[x-n+w+X],w+X,A,I));M[x+w]=b>=0?o(b,w,A,I):a(w,A,I),P&&j!==M[x+w-1]&&j!==M[x-n+w]&&D(e,v+g-4,v-O+g,U,q)&&i(M[x+w-1],M[x-n+w],I)}else M[x+w]=j;if(0===j)for(v=0,z=I.next,F=0;z>v;v++)v===I[v][1]&&(I[v][2]=0===I[v][1]?0:++F);else for(v=0,z=I.next,F=0;z>v;v++)v===I[v][1]&&(I[v][2]=F++);if(F=F>0?F:1,L)for(w=0,v=0;S>v;v+=4,w++)T=I[t(M[w],I)][2],T=~~(255-255*T/F),e[v]=T,e[v+1]=T,e[v+2]=T;else for(w=0,v=0;S>v;v+=4,w++)T=I[t(M[w],I)][2],T=~~(255*T/F),e[v]=T,e[v+1]=T,e[v+2]=T;return e}})}(n),n});