/** 
*
* FILTER.js  PLUGINS Package  (needs BASIC package)
* JavaScript Image Processing Library
*
* http://github.com/foo123/FILTER.js
*
* @version 0.6.6
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/!function(t){var r=t._notSupportClamp,n=Math.random;t.NoiseFilter=t.Create({min:-127,max:127,init:function(t,r){this.min=t||-127,this.max=r||127},apply:function(t){var e,a,o,i,l,h,s,u,p=this.max-this.min,f=this.min,c=t.length;for(e=0;c>e;)o=t[e],i=t[e+1],l=t[e+2],a=p*n()+f,h=o+a,s=i+a,u=l+a,r&&(0>h?h=0:h>255&&(h=255),0>s?s=0:s>255&&(s=255),0>u?u=0:u>255&&(u=255)),t[e]=~~h,t[e+1]=~~s,t[e+2]=~~u,e+=4;return t}})}(FILTER),function(t){var r=t._notSupportClamp,n=t.Array32F,e=t.Color.RGB2YCbCr,a=t.Color.YCbCr2RGB;t.HistogramEqualizeFilter=t.Create({apply:function(t){var o,i,l,h,s,u,p,f,c,C,g,m=0,y=255,F=new n(256),v=new n(256),R=0,d=t.length,b=d>>2,M=1/b,E=new Array(b);for(f=0;256>f;)F[f]=0,v[f]=0,f++;for(f=0,c=0;d>f;)o=t[f],i=t[f+1],l=t[f+2],C=e({r:o,g:i,b:l}),F[C.y]+=M,C.y>m&&(m=C.y),C.y<y&&(y=C.y),E[c]=C,f+=4,c++;for(R=0,f=0;256>f;)R+=F[f],v[f]=R,f++;for(F=null,h=m-y,f=0,c=0;d>f;)C=E[c],C.y=v[C.y]*h+y,g=a(C),s=g.r,u=g.g,p=g.b,r&&(0>s?s=0:s>255&&(s=255),0>u?u=0:u>255&&(u=255),0>p?p=0:p>255&&(p=255)),t[f]=~~s,t[f+1]=~~u,t[f+2]=~~p,f+=4,c++;return t}})}(FILTER),function(t){var r=t._notSupportClamp,n=t.Array32F;t.RGBHistogramEqualizeFilter=t.Create({apply:function(t){var e,a,o,i,l,h,s,u,p,f,c,C,g,m=0,y=0,F=0,v=255,R=255,d=255,b=new n(256),M=new n(256),E=new n(256),S=new n(256),w=new n(256),k=new n(256),B=t.length,I=B>>2,T=1/I;for(g=0;256>g;)b[g]=0,M[g]=0,E[g]=0,S[g]=0,w[g]=0,k[g]=0,g++;for(g=0;B>g;)e=t[g],a=t[g+1],o=t[g+2],b[e]+=T,M[a]+=T,E[o]+=T,e>m&&(m=e),v>e&&(v=e),a>y&&(y=a),R>a&&(R=a),o>F&&(F=o),d>o&&(d=o),g+=4;for(s=u=p=0,g=0;256>g;)s+=b[g],S[g]=s,u+=M[g],w[g]=u,p+=E[g],k[g]=p,g++;for(b=null,M=null,E=null,i=m-v,l=y-R,h=F-d,g=0;B>g;)e=t[g],a=t[g+1],o=t[g+2],f=S[e]*i+v,c=w[a]*l+R,C=k[o]*h+d,r&&(0>f?f=0:f>255&&(f=255),0>c?c=0:c>255&&(c=255),0>C?C=0:C>255&&(C=255)),t[g]=~~f,t[g+1]=~~c,t[g+2]=~~C,g+=4;return t}})}(FILTER),function(t){var r=Math.sqrt,n=t._notSupportClamp,e=t.Array32F;t.PixelateFilter=t.Create({scale:1,init:function(t){this.scale=t||1},apply:function(t,a,o){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var i,l,h,s,u,p,f,c,C,g,m,y,F,v,R,d,b,M,E,S,w,k,B,I,T,A,G,L,Y=t.length,q=a*o,_=~~(.01*r(q)*this.scale),x=_*_,z=1/x,H=a*_,X=new e(3*q),V=_,P=_,D=(a<<1)+a;for(s=V-1,u=(P-1)*a,M=0,S=a-1,E=0,w=q-a,p=0,f=0,c=0,i=l=h=0;a>c;)i+=t[p],l+=t[p+1],h+=t[p+2],X[f]=i,X[f+1]=l,X[f+2]=h,p+=4,f+=3,c++;for(p=D+a,f=D,c=0,i=l=h=0;Y>p;)i+=t[p],l+=t[p+1],h+=t[p+2],X[f]=X[f-D]+i,X[f+1]=X[f-D+1]+l,X[f+2]=X[f-D+2]+h,p+=4,f+=3,c++,c>=a&&(c=0,i=l=h=0);for(v=0,R=0,d=s,b=u,d>S&&(d=S),b>w&&(b=w),k=v+R,T=d+b,B=d+R,I=v+b,k=(k<<1)+k,B=(B<<1)+B,I=(I<<1)+I,T=(T<<1)+T,A=z*(X[T]-X[B]-X[I]+X[k]),G=z*(X[T+1]-X[B+1]-X[I+1]+X[k+1]),L=z*(X[T+2]-X[B+2]-X[I+2]+X[k+2]),n&&(0>A?A=0:A>255&&(A=255),0>G?G=0:G>255&&(G=255),0>L?L=0:L>255&&(L=255)),A=~~A,G=~~G,L=~~L,p=0,c=0,C=0,g=0,m=0,F=0;Y>p;)y=g+c+m+C<<2,t[y]=A,t[y+1]=G,t[y+2]=L,g++,(g+c>=a||g>=_)&&(g=0,F++,m+=a),(m+C>=q||F>=_)&&(c+=_,c>=a&&(c=0,C+=H),g=0,m=0,F=0,v=c,R=C,d=c+s,b=C+u,d>S&&(d=S),b>w&&(b=w),k=v+R,T=d+b,B=d+R,I=v+b,k=(k<<1)+k,B=(B<<1)+B,I=(I<<1)+I,T=(T<<1)+T,A=z*(X[T]-X[B]-X[I]+X[k]),G=z*(X[T+1]-X[B+1]-X[I+1]+X[k+1]),L=z*(X[T+2]-X[B+2]-X[I+2]+X[k+2]),n&&(0>A?A=0:A>255&&(A=255),0>G?G=0:G>255&&(G=255),0>L?L=0:L>255&&(L=255)),A=~~A,G=~~G,L=~~L),p+=4;return t}})}(FILTER),function(t){var r=t._notSupportClamp,n=t.Color.RGB2HSV,e=.7083333333333334;t.HSVConverterFilter=t.Create({apply:function(t,a,o){var i,l,h,s,u,o,p,f,c,C,g,m=t.length;for(s=0;m>s;)i=t[s],l=t[s+1],h=t[s+2],u=n({r:i,g:l,b:h}),o=u.h*e,p=255*u.s,f=u.v,c=o,C=f,g=p,r&&(0>c?c=0:c>255&&(c=255),0>C?C=0:C>255&&(C=255),0>g?g=0:g>255&&(g=255)),t[s]=~~c,t[s+1]=~~C,t[s+2]=~~g,s+=4;return t}})}(FILTER),function(t){var r=(t._notSupportClamp,t.ImArray,t.Color.clampPixel),n=t.Color.RGB2HSV,e=(t.Color.HSV2RGB,t.Color.Color2RGBA);t.HueExtractorFilter=t.Create({range:null,background:0,init:function(t,r){this.range=t,this.background=r||0},apply:function(t){if(!this.range||!this.range.length)return t;var a,o,i,l,h,s,u,p,f,c,C=t.length,g=this.range[0],m=this.range[this.range.length-1];for(f=e(this.background||0),l=~~r(f.r),h=~~r(f.g),s=~~r(f.b),u=~~r(f.a),p=0;C>p;)a=t[p],o=t[p+1],i=t[p+2],c=n({r:a,g:o,b:i}).h,(g>c||c>m)&&(t[p]=l,t[p+1]=h,t[p+2]=s,t[p+3]=u),p+=4;return t}})}(FILTER),function(t){var r=(t._notSupportClamp,Math.min);t.AlphaMaskFilter=t.Create({alphaMask:null,centerX:0,centerY:0,init:function(t,r,n){this.alphaMask=t||null,this.centerX=r||0,this.centerY=n||0},apply:function(t,n,e){if(!this.alphaMask)return t;var a,o,i,l,h,s,u,p,f=this.alphaMask.getData(),c=t.length,C=(f.length,this.alphaMask.width),g=this.alphaMask.height,m=r(n,C),y=r(e,g),F=n-C>>1,v=e-g>>1;for(u=this.centerX+F,p=this.centerY+v,a=0,o=0,i=0;c>a;)h=o-u,s=i-p,h>=0&&m>h&&s>=0&&y>s?(l=h+s*C<<2,t[a+3]=f[l+3]):t[a+3]=0,a+=4,o++,o>=n&&(o=0,i++);return t}})}(FILTER),function(t){var r=t._notSupportClamp,n=t.Color.RGBA2Color,e=t.Color.Color2RGBA;t.ThresholdFilter=t.Create({thresholds:null,quantizedColors:null,init:function(t,r){this.thresholds=t,this.quantizedColors=r||null},apply:function(t){if(!this.thresholds||!this.thresholds.length)return t;if(!this.quantizedColors||!this.quantizedColors.length)return t;var a,o,i,l,h,s,u,p,f=t.length,c=this.thresholds,C=c.length,g=this.quantizedColors,m=g.length;for(u=0;f>u;){for(h=n({r:t[u],g:t[u+1],b:t[u+2],a:t[u+3]}),p=0;C>p&&h>c[p];)p++;h=m>p?g[p]:255,s=e(h),a=s.r,o=s.g,i=s.b,l=s.a,r&&(0>a?a=0:a>255&&(a=255),0>o?o=0:o>255&&(o=255),0>i?i=0:i>255&&(i=255),0>l?l=0:l>255&&(l=255)),t[u]=~~a,t[u+1]=~~o,t[u+2]=~~i,t[u+3]=~~l,u+=4}return t}})}(FILTER),function(t){var r=t.Color.RGB2YCbCr;t.YCbCrConverterFilter=t.Create({apply:function(t){var n,e,a,o,i,l=t.length;for(o=0;l>o;)n=t[o],e=t[o+1],a=t[o+2],i=r({r:n,g:e,b:a}),t[o]=i.cr,t[o+1]=i.y,t[o+2]=i.cb,o+=4;return t}})}(FILTER),function(t){var r=(Math.sqrt,Math.exp,Math.log),n=Math.abs,e=t._notSupportClamp,a=t.Array32F;t.BokehFilter=t.Create({centerX:0,centerY:0,radius:10,amount:10,init:function(t,r,n,e){this.centerX=t||0,this.centerY=r||0,this.radius=n||10,this.amount=e||10},apply:function(t,o,i){var l,h,s,u,p,f,c,C,g,m,y,F,v,R,d,b,M,E,S,w,k,B,I,T,A,G,L,Y,q,_,x,z,H,X=t.length,V=this.centerX,P=this.centerY,D=this.radius,N=this.amount;if(0>=N)return t;for(l=o*i,_=0,x=o-1,z=0,H=l-o,s=(l<<1)+l,c=(o<<1)+o,h=new a(s),C=0,g=0,m=0,u=p=f=0;o>m;)u+=t[C],p+=t[C+1],f+=t[C+2],h[g]=u,h[g+1]=p,h[g+2]=f,C+=4,g+=3,m++;for(C=c+o,g=c,m=0,u=p=f=0;X>C;)u+=t[C],p+=t[C+1],f+=t[C+2],h[g]=h[g-c]+u,h[g+1]=h[g-c+1]+p,h[g+2]=h[g-c+2]+f,C+=4,g+=3,m++,m>=o&&(m=0,u=p=f=0);for(C=0,m=0,y=0,F=0;X>C;)R=m-V,d=y-P,v=n(R)+n(d),b=v>D?~~r((v-D)*N):~~(v/D+.5),b>0&&(M=b*o,E=.25/(b*b),S=m-b,w=F-M,k=m+b,B=F+M,_>S?S=_:k>x&&(k=x),z>w?w=z:B>H&&(B=H),I=S+w,G=k+B,T=k+w,A=S+B,I=(I<<1)+I,T=(T<<1)+T,A=(A<<1)+A,G=(G<<1)+G,L=E*(h[G]-h[T]-h[A]+h[I]),Y=E*(h[G+1]-h[T+1]-h[A+1]+h[I+1]),q=E*(h[G+2]-h[T+2]-h[A+2]+h[I+2]),e&&(0>L?L=0:L>255&&(L=255),0>Y?Y=0:Y>255&&(Y=255),0>q?q=0:q>255&&(q=255)),t[C]=~~L,t[C+1]=~~Y,t[C+2]=~~q),C+=4,m++,m>=o&&(m=0,y++,F+=o);return t}})}(FILTER);