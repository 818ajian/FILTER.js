/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
* 
* PLUGINS Package  (needs BASIC package)
*
* @version 0.6.5
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/!function(r){var t=r._notSupportTypedArrays,n=Math.random;r.NoiseFilter=r.Create({min:-127,max:127,init:function(r,t){this.min=r||-127,this.max=t||127},apply:function(r){var e,a,o,i,l,h,s,u,p=this.max-this.min,f=this.min,c=r.length;for(e=0;c>e;)o=r[e],i=r[e+1],l=r[e+2],a=p*n()+f,h=o+a,s=i+a,u=l+a,t&&(0>h?h=0:h>255&&(h=255),0>s?s=0:s>255&&(s=255),0>u?u=0:u>255&&(u=255)),r[e]=~~h,r[e+1]=~~s,r[e+2]=~~u,e+=4;return r}})}(FILTER),function(r){var t=r._notSupportTypedArrays,n=r.Array32F,e=r.Color.RGB2YCbCr,a=r.Color.YCbCr2RGB;r.HistogramEqualizeFilter=r.Create({apply:function(r){var o,i,l,h,s,u,p,f,c,y,g,C=0,d=255,F=new n(256),v=new n(256),A=0,R=r.length,T=R>>2,b=1/T,m=new Array(T);for(f=0;256>f;)F[f]=0,v[f]=0,f++;for(f=0,c=0;R>f;)o=r[f],i=r[f+1],l=r[f+2],y=e({r:o,g:i,b:l}),F[y.y]+=b,y.y>C&&(C=y.y),y.y<d&&(d=y.y),m[c]=y,f+=4,c++;for(A=0,f=0;256>f;)A+=F[f],v[f]=A,f++;for(F=null,h=C-d,f=0,c=0;R>f;)y=m[c],y.y=v[y.y]*h+d,g=a(y),s=g.r,u=g.g,p=g.b,t&&(0>s?s=0:s>255&&(s=255),0>u?u=0:u>255&&(u=255),0>p?p=0:p>255&&(p=255)),r[f]=~~s,r[f+1]=~~u,r[f+2]=~~p,f+=4,c++;return r}})}(FILTER),function(r){var t=r._notSupportTypedArrays,n=r.Array32F;r.RGBHistogramEqualizeFilter=r.Create({apply:function(r){var e,a,o,i,l,h,s,u,p,f,c,y,g,C=0,d=0,F=0,v=255,A=255,R=255,T=new n(256),b=new n(256),m=new n(256),w=new n(256),M=new n(256),E=new n(256),S=r.length,I=S>>2,k=1/I;for(g=0;256>g;)T[g]=0,b[g]=0,m[g]=0,w[g]=0,M[g]=0,E[g]=0,g++;for(g=0;S>g;)e=r[g],a=r[g+1],o=r[g+2],T[e]+=k,b[a]+=k,m[o]+=k,e>C&&(C=e),v>e&&(v=e),a>d&&(d=a),A>a&&(A=a),o>F&&(F=o),R>o&&(R=o),g+=4;for(s=u=p=0,g=0;256>g;)s+=T[g],w[g]=s,u+=b[g],M[g]=u,p+=m[g],E[g]=p,g++;for(T=null,b=null,m=null,i=C-v,l=d-A,h=F-R,g=0;S>g;)e=r[g],a=r[g+1],o=r[g+2],f=w[e]*i+v,c=M[a]*l+A,y=E[o]*h+R,t&&(0>f?f=0:f>255&&(f=255),0>c?c=0:c>255&&(c=255),0>y?y=0:y>255&&(y=255)),r[g]=~~f,r[g+1]=~~c,r[g+2]=~~y,g+=4;return r}})}(FILTER),function(r){var t=Math.sqrt,n=r._notSupportTypedArrays,e=r.Array32F;r.PixelateFilter=r.Create({scale:1,init:function(r){this.scale=r||1},apply:function(r,a,o){if(this.scale<=1)return r;this.scale>100&&(this.scale=100);var i,l,h,s,u,p,f,c,y,g,C,d,F,v,A,R,T,b,m,w,M,E,S,I,k,B,G,L,Y,q=r.length,_=a*o,z=~~(.01*t(_)*this.scale),H=z*z,x=1/H,X=z<<2,V=a*z,D=H<<2,N=new e(3*_),P=z,j=z,J=(a<<1)+a;for(s=P-1,u=(j-1)*a,m=0,M=a-1,w=0,E=_-a,p=0,f=0,y=0,i=l=h=0;a>y;)i+=r[p],l+=r[p+1],h+=r[p+2],N[f]=i,N[f+1]=l,N[f+2]=h,p+=4,f+=3,y++;for(p=J+a,f=J,y=0,i=l=h=0;q>p;)i+=r[p],l+=r[p+1],h+=r[p+2],N[f]=N[f-J]+i,N[f+1]=N[f-J+1]+l,N[f+2]=N[f-J+2]+h,p+=4,f+=3,y++,y>=a&&(y=0,i=l=h=0);for(p=0,y=0,g=0;q>p;){for(A=y,R=g,T=y+s,b=g+u,T>M&&(T=M),b>E&&(b=E),S=A+R,B=T+b,I=T+R,k=A+b,S=(S<<1)+S,I=(I<<1)+I,k=(k<<1)+k,B=(B<<1)+B,G=x*(N[B]-N[I]-N[k]+N[S]),L=x*(N[B+1]-N[I+1]-N[k+1]+N[S+1]),Y=x*(N[B+2]-N[I+2]-N[k+2]+N[S+2]),n&&(0>G?G=0:G>255&&(G=255),0>L?L=0:L>255&&(L=255),0>Y?Y=0:Y>255&&(Y=255)),G=~~G,L=~~L,Y=~~Y,f=p,C=y,d=g,v=y+z,c=p+D,c>q&&(c=q);c>f;)F=C+d<<2,r[F]=G,r[F+1]=L,r[F+2]=Y,f+=4,C++,(C>=a||C>=v)&&(C=y,d+=a);p+=X,y+=z,y>=a&&(y=0,g+=V)}return r}})}(FILTER),function(r){var t=r._notSupportTypedArrays,n=r.Color.RGB2HSV,e=.7083333333333334;r.HSVConverterFilter=r.Create({apply:function(r,a,o){var i,l,h,s,u,o,p,f,c,y,g,C=r.length;for(s=0;C>s;)i=r[s],l=r[s+1],h=r[s+2],u=n({r:i,g:l,b:h}),o=u.h*e,p=255*u.s,f=u.v,c=o,y=f,g=p,t&&(0>c?c=0:c>255&&(c=255),0>y?y=0:y>255&&(y=255),0>g?g=0:g>255&&(g=255)),r[s]=~~c,r[s+1]=~~y,r[s+2]=~~g,s+=4;return r}})}(FILTER),function(r){var t=r._notSupportTypedArrays,n=r.ImArray,e=r.Color.RGB2HSV,a=(r.Color.HSV2RGB,r.Color.Color2RGBA);r.HueExtractorFilter=r.Create({range:null,background:0,init:function(r,t){this.range=r,this.background=t||0},apply:function(r){if(!this.range||!this.range.length)return r;var o,i,l,h,s,u,p,f,c,y,g,C=r.length,d=this.range[0],F=this.range[this.range.length-1];for(h=new n(C),y=a(this.background||0),c=0;C>c;)o=r[c],i=r[c+1],l=r[c+2],g=e({r:o,g:i,b:l}).h,g>=d&&F>=g?(s=r[c],u=r[c+1],p=r[c+2],f=r[c+3]):(s=y.r,u=y.g,p=y.b,f=y.a),t&&(0>s?s=0:s>255&&(s=255),0>u?u=0:u>255&&(u=255),0>p?p=0:p>255&&(p=255),0>f?f=0:f>255&&(f=255)),h[c]=~~s,h[c+1]=~~u,h[c+2]=~~p,h[c+3]=~~f,c+=4;return h}})}(FILTER),function(r){var t=(r._notSupportTypedArrays,Math.min);r.AlphaMaskFilter=r.Create({alphaMask:null,centerX:0,centerY:0,init:function(r,t,n){this.alphaMask=r||null,this.centerX=t||0,this.centerY=n||0},apply:function(r,n,e){if(!this.alphaMask)return r;var a,o,i,l,h,s,u,p,f=this.alphaMask.getData(),c=r.length,y=(f.length,this.alphaMask.width),g=this.alphaMask.height,C=t(n,y),d=t(e,g),F=n-y>>1,v=e-g>>1;for(u=this.centerX+F,p=this.centerY+v,a=0,o=0,i=0;c>a;)h=o-u,s=i-p,h>=0&&C>h&&s>=0&&d>s?(l=h+s*y<<2,r[a+3]=f[l+3]):r[a+3]=0,a+=4,o++,o>=n&&(o=0,i++);return r}})}(FILTER),function(r){var t=r._notSupportTypedArrays,n=r.Color.RGBA2Color,e=r.Color.Color2RGBA;r.ThresholdFilter=r.Create({thresholds:null,quantizedColors:null,init:function(r,t){this.thresholds=r,this.quantizedColors=t||null},apply:function(r){if(!this.thresholds||!this.thresholds.length)return r;if(!this.quantizedColors||!this.quantizedColors.length)return r;var a,o,i,l,h,s,u,p,f=r.length,c=this.thresholds,y=c.length,g=this.quantizedColors,C=g.length;for(u=0;f>u;){for(h=n({r:r[u],g:r[u+1],b:r[u+2],a:r[u+3]}),p=0;y>p&&h>c[p];)p++;h=C>p?g[p]:255,s=e(h),a=s.r,o=s.g,i=s.b,l=s.a,t&&(0>a?a=0:a>255&&(a=255),0>o?o=0:o>255&&(o=255),0>i?i=0:i>255&&(i=255),0>l?l=0:l>255&&(l=255)),r[u]=~~a,r[u+1]=~~o,r[u+2]=~~i,r[u+3]=~~l,u+=4}return r}})}(FILTER),function(r){var t=r.Color.RGB2YCbCr;r.YCbCrConverterFilter=r.Create({apply:function(r){var n,e,a,o,i,l=r.length;for(o=0;l>o;)n=r[o],e=r[o+1],a=r[o+2],i=t({r:n,g:e,b:a}),r[o]=i.cr,r[o+1]=i.y,r[o+2]=i.cb,o+=4;return r}})}(FILTER),function(r){var t=(Math.sqrt,Math.exp,Math.log),n=Math.abs,e=r._notSupportTypedArrays,a=r.ImArray,o=r.Array32F;r.BokehFilter=r.Create({centerX:0,centerY:0,radius:10,amount:10,init:function(r,t,n,e){this.centerX=r||0,this.centerY=t||0,this.radius=n||10,this.amount=e||10},apply:function(r,i,l){var h,s,u,p,f,c,y,g,C,d,F,v,A,R,T,b,m,w,M,E,S,I,k,B,G,L,Y,q,_,z,H,x,X,V,D=r.length,N=this.centerX,P=this.centerY,j=this.radius,J=this.amount;if(0>=J)return r;for(A=new a(r),h=i*l,H=0,x=i-1,X=0,V=h-i,u=(h<<1)+h,y=(i<<1)+i,s=new o(u),g=0,C=0,d=0,p=f=c=0;i>d;)p+=r[g],f+=r[g+1],c+=r[g+2],s[C]=p,s[C+1]=f,s[C+2]=c,g+=4,C+=3,d++;for(g=y+i,C=y,d=0,p=f=c=0;D>g;)p+=r[g],f+=r[g+1],c+=r[g+2],s[C]=s[C-y]+p,s[C+1]=s[C-y+1]+f,s[C+2]=s[C-y+2]+c,g+=4,C+=3,d++,d>=i&&(d=0,p=f=c=0);for(g=0,d=0,F=0,v=0;D>g;)T=d-N,b=F-P,R=n(T)+n(b),m=R>j?~~t((R-j)*J):~~(R/j+.5),m>0&&(w=m*i,M=.25/(m*m),E=d-m,S=v-w,I=d+m,k=v+w,H>E?E=H:I>x&&(I=x),X>S?S=X:k>V&&(k=V),B=E+S,Y=I+k,G=I+S,L=E+k,B=(B<<1)+B,G=(G<<1)+G,L=(L<<1)+L,Y=(Y<<1)+Y,q=M*(s[Y]-s[G]-s[L]+s[B]),_=M*(s[Y+1]-s[G+1]-s[L+1]+s[B+1]),z=M*(s[Y+2]-s[G+2]-s[L+2]+s[B+2]),e&&(0>q?q=0:q>255&&(q=255),0>_?_=0:_>255&&(_=255),0>z?z=0:z>255&&(z=255)),A[g]=~~q,A[g+1]=~~_,A[g+2]=~~z),g+=4,d++,d>=i&&(d=0,F++,v+=i);return A}})}(FILTER);