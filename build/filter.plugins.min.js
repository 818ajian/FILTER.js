/** 
*
* FILTER.js  PLUGINS Package  (needs BASIC package)
* JavaScript Image Processing Library
*
* http://github.com/foo123/FILTER.js
*
* @version 0.6.6
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/!function(t){var r=t._notSupportClamp,n=Math.random;t.NoiseFilter=t.Create({min:-127,max:127,name:"NoiseFilter",init:function(t,r){this.min=t||-127,this.max=r||127},apply:function(t){var e,a,i,o,l,h,s,u,p=this.max-this.min,f=this.min,c=t.length;for(e=0;c>e;)i=t[e],o=t[e+1],l=t[e+2],a=p*n()+f,h=i+a,s=o+a,u=l+a,r&&(0>h?h=0:h>255&&(h=255),0>s?s=0:s>255&&(s=255),0>u?u=0:u>255&&(u=255)),t[e]=~~h,t[e+1]=~~s,t[e+2]=~~u,e+=4;return t}})}(FILTER),function(t){var r=t._notSupportClamp,n=t.Array32F,e=t.Color.RGB2YCbCr,a=t.Color.YCbCr2RGB;t.HistogramEqualizeFilter=t.Create({name:"HistogramEqualizeFilter",apply:function(t){var i,o,l,h,s,u,p,f,c,C,g,m=0,F=255,v=new n(256),y=new n(256),R=0,d=t.length,b=d>>2,E=1/b,M=new Array(b);for(f=0;256>f;)v[f]=0,y[f]=0,f++;for(f=0,c=0;d>f;)i=t[f],o=t[f+1],l=t[f+2],C=e({r:i,g:o,b:l}),v[C.y]+=E,C.y>m&&(m=C.y),C.y<F&&(F=C.y),M[c]=C,f+=4,c++;for(R=0,f=0;256>f;)R+=v[f],y[f]=R,f++;for(v=null,h=m-F,f=0,c=0;d>f;)C=M[c],C.y=y[C.y]*h+F,g=a(C),s=~~g.r,u=~~g.g,p=~~g.b,r&&(0>s?s=0:s>255&&(s=255),0>u?u=0:u>255&&(u=255),0>p?p=0:p>255&&(p=255)),t[f]=~~s,t[f+1]=~~u,t[f+2]=~~p,f+=4,c++;return t}})}(FILTER),function(t){var r=t._notSupportClamp,n=t.Array32F;t.RGBHistogramEqualizeFilter=t.Create({name:"RGBHistogramEqualizeFilter",apply:function(t){var e,a,i,o,l,h,s,u,p,f,c,C,g,m=0,F=0,v=0,y=255,R=255,d=255,b=new n(256),E=new n(256),M=new n(256),S=new n(256),k=new n(256),B=new n(256),w=t.length,T=w>>2,q=1/T;for(g=0;256>g;)b[g]=0,E[g]=0,M[g]=0,S[g]=0,k[g]=0,B[g]=0,g++;for(g=0;w>g;)e=t[g],a=t[g+1],i=t[g+2],b[e]+=q,E[a]+=q,M[i]+=q,e>m&&(m=e),y>e&&(y=e),a>F&&(F=a),R>a&&(R=a),i>v&&(v=i),d>i&&(d=i),g+=4;for(s=u=p=0,g=0;256>g;)s+=b[g],S[g]=s,u+=E[g],k[g]=u,p+=M[g],B[g]=p,g++;for(b=null,E=null,M=null,o=m-y,l=F-R,h=v-d,g=0;w>g;)e=t[g],a=t[g+1],i=t[g+2],f=S[e]*o+y,c=k[a]*l+R,C=B[i]*h+d,r&&(0>f?f=0:f>255&&(f=255),0>c?c=0:c>255&&(c=255),0>C?C=0:C>255&&(C=255)),t[g]=~~f,t[g+1]=~~c,t[g+2]=~~C,g+=4;return t}})}(FILTER),function(t){var r=Math.sqrt,n=t._notSupportClamp,e=t.Array32F;t.PixelateFilter=t.Create({scale:1,name:"PixelateFilter",init:function(t){this.scale=t||1},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var o,l,h,s,u,p,f,c,C,g,m,F,v,y,R,d,b,E,M,S,k,B,w,T,q,A,G,H,I=t.length,Y=a*i,L=~~(.01*r(Y)*this.scale),x=L*L,z=1/x,_=a*L,X=new e(3*Y),V=L,P=L,N=(a<<1)+a;for(s=V-1,u=(P-1)*a,E=0,S=a-1,M=0,k=Y-a,p=0,f=0,c=0,o=l=h=0;a>c;)o+=t[p],l+=t[p+1],h+=t[p+2],X[f]=o,X[f+1]=l,X[f+2]=h,p+=4,f+=3,c++;for(p=N+a,f=N,c=0,o=l=h=0;I>p;)o+=t[p],l+=t[p+1],h+=t[p+2],X[f]=X[f-N]+o,X[f+1]=X[f-N+1]+l,X[f+2]=X[f-N+2]+h,p+=4,f+=3,c++,c>=a&&(c=0,o=l=h=0);for(y=0,R=0,d=s,b=u,d>S&&(d=S),b>k&&(b=k),B=y+R,q=d+b,w=d+R,T=y+b,B=(B<<1)+B,w=(w<<1)+w,T=(T<<1)+T,q=(q<<1)+q,A=z*(X[q]-X[w]-X[T]+X[B]),G=z*(X[q+1]-X[w+1]-X[T+1]+X[B+1]),H=z*(X[q+2]-X[w+2]-X[T+2]+X[B+2]),n&&(0>A?A=0:A>255&&(A=255),0>G?G=0:G>255&&(G=255),0>H?H=0:H>255&&(H=255)),A=~~A,G=~~G,H=~~H,p=0,c=0,C=0,g=0,m=0,v=0;I>p;)F=g+c+m+C<<2,t[F]=A,t[F+1]=G,t[F+2]=H,g++,(g+c>=a||g>=L)&&(g=0,v++,m+=a),(m+C>=Y||v>=L)&&(c+=L,c>=a&&(c=0,C+=_),g=0,m=0,v=0,y=c,R=C,d=c+s,b=C+u,d>S&&(d=S),b>k&&(b=k),B=y+R,q=d+b,w=d+R,T=y+b,B=(B<<1)+B,w=(w<<1)+w,T=(T<<1)+T,q=(q<<1)+q,A=z*(X[q]-X[w]-X[T]+X[B]),G=z*(X[q+1]-X[w+1]-X[T+1]+X[B+1]),H=z*(X[q+2]-X[w+2]-X[T+2]+X[B+2]),n&&(0>A?A=0:A>255&&(A=255),0>G?G=0:G>255&&(G=255),0>H?H=0:H>255&&(H=255)),A=~~A,G=~~G,H=~~H),p+=4;return t}})}(FILTER),function(t){var r=t._notSupportClamp,n=t.Color.RGB2HSV,e=.7083333333333334;t.HSVConverterFilter=t.Create({name:"HSVConverterFilter",apply:function(t,a,i){var o,l,h,s,u,i,p,f,c,C,g,m=t.length;for(s=0;m>s;)o=t[s],l=t[s+1],h=t[s+2],u=n({r:o,g:l,b:h}),i=u.h*e,p=255*u.s,f=u.v,c=i,C=f,g=p,r&&(0>c?c=0:c>255&&(c=255),0>C?C=0:C>255&&(C=255),0>g?g=0:g>255&&(g=255)),t[s]=~~c,t[s+1]=~~C,t[s+2]=~~g,s+=4;return t}})}(FILTER),function(t){var r=(t._notSupportClamp,t.ImArray,t.Color.clampPixel),n=t.Color.RGB2HSV,e=(t.Color.HSV2RGB,t.Color.Color2RGBA);t.HueExtractorFilter=t.Create({range:null,background:0,name:"HueExtractorFilter",init:function(t,r){this.range=t,this.background=r||0},apply:function(t){if(!this.range||!this.range.length)return t;var a,i,o,l,h,s,u,p,f,c,C=t.length,g=this.range[0],m=this.range[this.range.length-1];for(f=e(this.background||0),l=~~r(f.r),h=~~r(f.g),s=~~r(f.b),u=~~r(f.a),p=0;C>p;)a=t[p],i=t[p+1],o=t[p+2],c=n({r:a,g:i,b:o}).h,(g>c||c>m)&&(t[p]=l,t[p+1]=h,t[p+2]=s,t[p+3]=u),p+=4;return t}})}(FILTER),function(t){var r=(t._notSupportClamp,Math.min);t.AlphaMaskFilter=t.Create({alphaMask:null,centerX:0,centerY:0,name:"AlphaMaskFilter",init:function(t,r,n){this.alphaMask=t||null,this.centerX=r||0,this.centerY=n||0},apply:function(t,n,e){if(!this.alphaMask)return t;var a,i,o,l,h,s,u,p,f=this.alphaMask.getData(),c=t.length,C=(f.length,this.alphaMask.width),g=this.alphaMask.height,m=r(n,C),F=r(e,g),v=n-C>>1,y=e-g>>1;for(u=this.centerX+v,p=this.centerY+y,a=0,i=0,o=0;c>a;)h=i-u,s=o-p,h>=0&&m>h&&s>=0&&F>s?(l=h+s*C<<2,t[a+3]=f[l+3]):t[a+3]=0,a+=4,i++,i>=n&&(i=0,o++);return t}})}(FILTER),function(t){var r=(t._notSupportClamp,t.Color.RGBA2Color),n=t.Color.Color2RGBA;t.ThresholdFilter=t.Create({thresholds:null,quantizedColors:null,name:"ThresholdFilter",init:function(t,r){this.thresholds=t,this.quantizedColors=r||null},apply:function(t){if(!this.thresholds||!this.thresholds.length)return t;if(!this.quantizedColors||!this.quantizedColors.length)return t;var e,a,i,o,l,h,s,u,p=t.length,f=this.thresholds,c=f.length,C=this.quantizedColors,g=C.length;for(s=0;p>s;){for(l=r({r:t[s],g:t[s+1],b:t[s+2],a:t[s+3]}),u=0;c>u&&l>f[u];)u++;l=g>u?C[u]:l=255,h=n(l),e=h.r,a=h.g,i=h.b,o=h.a,t[s]=e,t[s+1]=a,t[s+2]=i,t[s+3]=o,s+=4}return t}})}(FILTER),function(t){var r=t.Color.RGB2YCbCr;t.YCbCrConverterFilter=t.Create({name:"YCbCrConverterFilter",apply:function(t){var n,e,a,i,o,l=t.length;for(i=0;l>i;)n=t[i],e=t[i+1],a=t[i+2],o=r({r:n,g:e,b:a}),t[i]=o.cr,t[i+1]=o.y,t[i+2]=o.cb,i+=4;return t}})}(FILTER),function(t){var r=(Math.sqrt,Math.exp,Math.log),n=Math.abs,e=t._notSupportClamp,a=t.Array32F;t.BokehFilter=t.Create({centerX:0,centerY:0,radius:10,amount:10,name:"BokehFilter",init:function(t,r,n,e){this.centerX=t||0,this.centerY=r||0,this.radius=n||10,this.amount=e||10},apply:function(t,i,o){var l,h,s,u,p,f,c,C,g,m,F,v,y,R,d,b,E,M,S,k,B,w,T,q,A,G,H,I,Y,L,x,z,_,X=t.length,V=this.centerX,P=this.centerY,N=this.radius,D=this.amount;if(0>=D)return t;for(l=i*o,L=0,x=i-1,z=0,_=l-i,s=(l<<1)+l,c=(i<<1)+i,h=new a(s),C=0,g=0,m=0,u=p=f=0;i>m;)u+=t[C],p+=t[C+1],f+=t[C+2],h[g]=u,h[g+1]=p,h[g+2]=f,C+=4,g+=3,m++;for(C=c+i,g=c,m=0,u=p=f=0;X>C;)u+=t[C],p+=t[C+1],f+=t[C+2],h[g]=h[g-c]+u,h[g+1]=h[g-c+1]+p,h[g+2]=h[g-c+2]+f,C+=4,g+=3,m++,m>=i&&(m=0,u=p=f=0);for(C=0,m=0,F=0,v=0;X>C;)R=m-V,d=F-P,y=n(R)+n(d),b=y>N?~~r((y-N)*D):~~(y/N+.5),b>0&&(E=b*i,M=.25/(b*b),S=m-b,k=v-E,B=m+b,w=v+E,L>S?S=L:B>x&&(B=x),z>k?k=z:w>_&&(w=_),T=S+k,G=B+w,q=B+k,A=S+w,T=(T<<1)+T,q=(q<<1)+q,A=(A<<1)+A,G=(G<<1)+G,H=M*(h[G]-h[q]-h[A]+h[T]),I=M*(h[G+1]-h[q+1]-h[A+1]+h[T+1]),Y=M*(h[G+2]-h[q+2]-h[A+2]+h[T+2]),e&&(0>H?H=0:H>255&&(H=255),0>I?I=0:I>255&&(I=255),0>Y?Y=0:Y>255&&(Y=255)),t[C]=~~H,t[C+1]=~~I,t[C+2]=~~Y),C+=4,m++,m>=i&&(m=0,F++,v+=i);return t}})}(FILTER);