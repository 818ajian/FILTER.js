/**
*
*   FILTER.js Plugins
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,n){"use strict";"object"==typeof module&&module.exports?module.exports=n.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(r,t){return n.moduleUri=r.uri,n.call(e,t),t}):(n.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(n){"use strict";var r=n.getPath(e.moduleUri);return!function(e){var n=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,n){var r=this;r.min=e||-127,r.max=n||127},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{min:e.min,max:e.max}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.min=n.min,r.max=n.max),r},apply:function(e,r,a){var i=this;if(!i._isOn)return e;var s,l,o,u,c,f,h,m,d=i.max-i.min,p=i.min,_=e.length;if(n)for(s=0;_>s;s+=4)o=e[s],u=e[s+1],c=e[s+2],l=d*t()+p,f=o+l,h=u+l,m=c+l,0>f?f=0:f>255&&(f=255),0>h?h=0:h>255&&(h=255),0>m?m=0:m>255&&(m=255),e[s]=~~f,e[s+1]=~~h,e[s+2]=~~m;else for(s=0;_>s;s+=4)o=e[s],u=e[s+1],c=e[s+2],l=d*t()+p,f=o+l,h=u+l,m=c+l,e[s]=~~f,e[s+1]=~~h,e[s+2]=~~m;return e}})}(n),!function(e){var n=e.Util.Image.perlin,t=e.MODE;e.Create({name:"PerlinNoiseFilter",_baseX:1,_baseY:1,_octaves:1,_offsets:null,_mode:t.GRAY,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:r,init:function(e,n,r,a,i,s,l,o){var u=this;u._mode=t.GRAY,u._baseX=e||1,u._baseY=n||1,u._seed=l||0,u._stitch=!!a,u._fractal=!1!==i,u._perlin=!!o,u.octaves(r||1,s)},seed:function(e){var n=this;return n._seed=e||0,n},octaves:function(e,n){var r=this;for(r._octaves=e||1,r._offsets=n?n.slice(0):[];r._offsets.length<r._octaves;)r._offsets.push([0,0]);return r},seamless:function(e){return arguments.length||(e=!0),this._stitch=!!e,this},colors:function(e){return arguments.length||(e=!0),this._mode=e?t.COLOR:t.GRAY,this},turbulence:function(e){return arguments.length||(e=!0),this._fractal=!e,this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_baseX:e._baseX,_baseY:e._baseY,_octaves:e._octaves,_offsets:e._offsets,_seed:e._seed||0,_stitch:e._stitch,_mode:e._mode,_fractal:e._fractal,_perlin:e._perlin}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r._baseX=n._baseX,r._baseY=n._baseY,r._octaves=n._octaves,r._offsets=n._offsets,r._seed=n._seed||0,r._stitch=n._stitch,r._mode=n._mode,r._fractal=n._fractal,r._perlin=n._perlin),r},apply:function(e,r,a){var i=this;return i._isOn&&n?(i._seed&&(n.seed(i._seed),i._seed=0),n(e,r,a,i._stitch,t.COLOR!==i._mode,i._baseX,i._baseY,i._octaves,i._offsets,1,.5,i._perlin)):e}})}(n),!function(e,n){var t=e.Color.Gradient,a=e.Util.Array.typed,i=Math.floor;e.Create({name:"GradientFilter",colors:null,stops:null,angle:0,path:r,init:function(e,n,r){var t=this;t.setColors(e,n),t.angle=r||0},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.angle=null,e.$super("dispose"),e},setColors:function(e,n){var r=this;if(e&&e.length){var a=t.stops(e,n);r.colors=a[0],r.stops=a[1]}return r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{angle:e.angle,colors:e.colors,stops:e.stops}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.angle=n.angle,r.colors=a(n.colors,Array),r.stops=a(n.stops,Array)),r},apply:function(e,n,r){var a=this;return a._isOn&&a.colors?t.linear(e,n,r,a.colors,a.stops,a.angle,t.interpolate):e}}),e.Create({name:"RadialGradientFilter",colors:null,stops:null,centerX:0,centerY:0,radiusX:1,radiusY:1,init:function(e,n,r,t,a,i){var s=this;s.setColors(e,n),s.centerX=r||0,s.centerY=t||0,s.radiusX=a||1,s.radiusY=i||1},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.centerX=null,e.centerY=null,e.radiusX=null,e.radiusY=null,e.$super("dispose"),e},setColors:function(e,n){var r=this;if(e&&e.length){var a=t.stops(e,n);r.colors=a[0],r.stops=a[1]}return r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radiusX:e.radiusX,radiusY:e.radiusY,colors:e.colors,stops:e.stops}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.centerX=n.centerX||0,r.centerY=n.centerY||0,r.radiusX=n.radiusX||1,r.radiusY=n.radiusY||1,r.colors=a(n.colors,Array),r.stops=a(n.stops,Array)),r},apply:function(e,n,r){var a=this;return a._isOn&&a.colors?t.radial(e,n,r,a.colors,a.stops,i((a.centerX||0)*(n-1)),i((a.centerY||0)*(r-1)),a.radiusX,a.radiusY,t.interpolate):e}})}(n),!function(e){var n=Math.min,t=Math.floor,a=e.CHANNEL;e.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:a.RED,dstChannel:a.RED,path:r,init:function(e,n,r,t,i){var s=this;s._srcImg=null,s.srcImg=null,s.srcChannel=n||a.RED,s.dstChannel=r||a.RED,s.centerX=t||0,s.centerY=i||0,e&&s.setSrc(e)},dispose:function(){var e=this;return e.srcChannel=null,e.dstChannel=null,e.centerX=null,e.centerY=null,e.srcImg=null,e._srcImg=null,e.$super("dispose"),e},setSrc:function(e){var n=this;return e&&(n.srcImg=e,n._srcImg=null),n},serialize:function(){var e=this,n=e.srcImg;return{filter:e.name,_isOn:!!e._isOn,params:{_srcImg:e._srcImg||(n?{data:n.getData(),width:n.width,height:n.height}:null),centerX:e.centerX,centerY:e.centerY,srcChannel:e.srcChannel,dstChannel:e.dstChannel}}},unserialize:function(n){var r,t=this;return n&&t.name===n.filter&&(t._isOn=!!n._isOn,r=n.params,t.srcImg=null,t._srcImg=r._srcImg,t._srcImg&&(t._srcImg.data=e.Util.Array.typed(t._srcImg.data,e.ImArray)),t.centerX=r.centerX,t.centerY=r.centerY,t.srcChannel=r.srcChannel,t.dstChannel=r.dstChannel),t},apply:function(e,r,a){var i=this,s=i.srcImg;if(!i._isOn||!s&&!i._srcImg)return e;var l,o,u,c,f,h,m=i._srcImg||{data:s.getData(),width:s.width,height:s.height},d=m.data,p=m.width,_=m.height,g=e.length,v=(d.length,i.srcChannel),y=i.dstChannel,O=n(r,p),C=n(a,_),b=i.centerX||0,I=i.centerY||0,w=p>>>1,Y=_>>>1;for(b=t(b*(r-1))-w,I=t(I*(a-1))-Y,l=0,o=0,u=0,l=0;g>l;l+=4,o++)o>=r&&(o=0,u++),f=o-b,h=u-I,f>=0&&O>f&&h>=0&&C>h&&(c=f+h*p<<2,e[l+y]=d[c+v]);return e}})}(n),!function(e){var n=(e._notSupportClamp,e.CHANNEL),t=Math.min,a=Math.floor;e.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,channel:n.ALPHA,path:r,init:function(e,r,t,a){var i=this;i.centerX=r||0,i.centerY=t||0,i.channel=null==a?n.ALPHA:a||n.RED,i._alphaMask=null,i.alphaMask=null,e&&i.setMask(e)},dispose:function(){var e=this;return e.centerX=null,e.centerY=null,e.channel=null,e.alphaMask=null,e._alphaMask=null,e.$super("dispose"),e},setMask:function(e){var n=this;return e&&(n.alphaMask=e,n._alphaMask=null),n},serialize:function(){var e=this,n=e.alphaMask;return{filter:e.name,_isOn:!!e._isOn,params:{_alphaMask:e._alphaMask||(n?{data:n.getData(),width:n.width,height:n.height}:null),centerX:e.centerX,centerY:e.centerY,channel:e.channel}}},unserialize:function(n){var r,t=this;return n&&t.name===n.filter&&(t._isOn=!!n._isOn,r=n.params,t.alphaMask=null,t._alphaMask=r._alphaMask,t._alphaMask&&(t._alphaMask.data=e.Util.Array.typed(t._alphaMask.data,e.ImArray)),t.centerX=r.centerX,t.centerY=r.centerY,t.channel=r.channel),t},apply:function(e,r,i){var s=this,l=s.alphaMask;if(!s._isOn||!l&&!s._alphaMask)return e;var o,u,c,f,h,m,d=s._alphaMask||{data:l.getData(),width:l.width,height:l.height},p=d.data,_=d.width,g=d.height,v=e.length,y=(p.length,t(r,_)),O=t(i,g),C=null==s.channel?n.ALPHA:s.channel||n.RED,b=s.centerX||0,I=s.centerY||0,w=_>>>1,Y=g>>>1;for(b=a(b*(r-1))-w,I=a(I*(i-1))-Y,u=0,c=0,o=0;v>o;o+=4,u++)u>=r&&(u=0,c++),h=u-b,m=c-I,h>=0&&y>h&&m>=0&&O>m?(f=h+m*_<<2,e[o+3]=p[f+C]):(e[o]=0,e[o+1]=0,e[o+2]=0,e[o+3]=0);return e}})}(n),!function(e){var n=e._notSupportClamp,t=e.Array32F,a=e.MODE,i=Math.min,s=Math.max;e.Create({name:"HistogramEqualizeFilter",path:r,mode:a.INTENSITY,init:function(e){var n=this;n.mode=e||a.INTENSITY},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{mode:e.mode}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.mode=n.mode),r},_apply_rgb:function(e,r,a){var l,o,u,c,f,h,m,d,p,_,g,v,y,O,C,b,I=0,w=0,Y=0,M=255,X=255,A=255,z=e.length,x=z>>>2,F=(7&x)<<2,S=1/x;for(m=new t(256),d=new t(256),p=new t(256),b=0;z>b;b+=32)l=e[b],o=e[b+1],u=e[b+2],m[l]+=S,d[o]+=S,p[u]+=S,I=s(l,I),w=s(o,w),Y=s(u,Y),M=i(l,M),X=i(o,X),A=i(u,A),l=e[b+4],o=e[b+5],u=e[b+6],m[l]+=S,d[o]+=S,p[u]+=S,I=s(l,I),w=s(o,w),Y=s(u,Y),M=i(l,M),X=i(o,X),A=i(u,A),l=e[b+8],o=e[b+9],u=e[b+10],m[l]+=S,d[o]+=S,p[u]+=S,I=s(l,I),w=s(o,w),Y=s(u,Y),M=i(l,M),X=i(o,X),A=i(u,A),l=e[b+12],o=e[b+13],u=e[b+14],m[l]+=S,d[o]+=S,p[u]+=S,I=s(l,I),w=s(o,w),Y=s(u,Y),M=i(l,M),X=i(o,X),A=i(u,A),l=e[b+16],o=e[b+17],u=e[b+18],m[l]+=S,d[o]+=S,p[u]+=S,I=s(l,I),w=s(o,w),Y=s(u,Y),M=i(l,M),X=i(o,X),A=i(u,A),l=e[b+20],o=e[b+21],u=e[b+22],m[l]+=S,d[o]+=S,p[u]+=S,I=s(l,I),w=s(o,w),Y=s(u,Y),M=i(l,M),X=i(o,X),A=i(u,A),l=e[b+24],o=e[b+25],u=e[b+26],m[l]+=S,d[o]+=S,p[u]+=S,I=s(l,I),w=s(o,w),Y=s(u,Y),M=i(l,M),X=i(o,X),A=i(u,A),l=e[b+28],o=e[b+29],u=e[b+30],m[l]+=S,d[o]+=S,p[u]+=S,I=s(l,I),w=s(o,w),Y=s(u,Y),M=i(l,M),X=i(o,X),A=i(u,A);if(F)for(b=z-F;z>b;b+=4)l=e[b],o=e[b+1],u=e[b+2],m[l]+=S,d[o]+=S,p[u]+=S,I=s(l,I),w=s(o,w),Y=s(u,Y),M=i(l,M),X=i(o,X),A=i(u,A);for(_=g=v=0,b=0;256>b;b+=32)_+=m[b],m[b]=_,_+=m[b+1],m[b+1]=_,_+=m[b+2],m[b+2]=_,_+=m[b+3],m[b+3]=_,_+=m[b+4],m[b+4]=_,_+=m[b+5],m[b+5]=_,_+=m[b+6],m[b+6]=_,_+=m[b+7],m[b+7]=_,_+=m[b+8],m[b+8]=_,_+=m[b+9],m[b+9]=_,_+=m[b+10],m[b+10]=_,_+=m[b+11],m[b+11]=_,_+=m[b+12],m[b+12]=_,_+=m[b+13],m[b+13]=_,_+=m[b+14],m[b+14]=_,_+=m[b+15],m[b+15]=_,_+=m[b+16],m[b+16]=_,_+=m[b+17],m[b+17]=_,_+=m[b+18],m[b+18]=_,_+=m[b+19],m[b+19]=_,_+=m[b+20],m[b+20]=_,_+=m[b+21],m[b+21]=_,_+=m[b+22],m[b+22]=_,_+=m[b+23],m[b+23]=_,_+=m[b+24],m[b+24]=_,_+=m[b+25],m[b+25]=_,_+=m[b+26],m[b+26]=_,_+=m[b+27],m[b+27]=_,_+=m[b+28],m[b+28]=_,_+=m[b+29],m[b+29]=_,_+=m[b+30],m[b+30]=_,_+=m[b+31],m[b+31]=_,g+=d[b],d[b]=g,g+=d[b+1],d[b+1]=g,g+=d[b+2],d[b+2]=g,g+=d[b+3],d[b+3]=g,g+=d[b+4],d[b+4]=g,g+=d[b+5],d[b+5]=g,g+=d[b+6],d[b+6]=g,g+=d[b+7],d[b+7]=g,g+=d[b+8],d[b+8]=g,g+=d[b+9],d[b+9]=g,g+=d[b+10],d[b+10]=g,g+=d[b+11],d[b+11]=g,g+=d[b+12],d[b+12]=g,g+=d[b+13],d[b+13]=g,g+=d[b+14],d[b+14]=g,g+=d[b+15],d[b+15]=g,g+=d[b+16],d[b+16]=g,g+=d[b+17],d[b+17]=g,g+=d[b+18],d[b+18]=g,g+=d[b+19],d[b+19]=g,g+=d[b+20],d[b+20]=g,g+=d[b+21],d[b+21]=g,g+=d[b+22],d[b+22]=g,g+=d[b+23],d[b+23]=g,g+=d[b+24],d[b+24]=g,g+=d[b+25],d[b+25]=g,g+=d[b+26],d[b+26]=g,g+=d[b+27],d[b+27]=g,g+=d[b+28],d[b+28]=g,g+=d[b+29],d[b+29]=g,g+=d[b+30],d[b+30]=g,g+=d[b+31],d[b+31]=g,v+=p[b],p[b]=v,v+=p[b+1],p[b+1]=v,v+=p[b+2],p[b+2]=v,v+=p[b+3],p[b+3]=v,v+=p[b+4],p[b+4]=v,v+=p[b+5],p[b+5]=v,v+=p[b+6],p[b+6]=v,v+=p[b+7],p[b+7]=v,v+=p[b+8],p[b+8]=v,v+=p[b+9],p[b+9]=v,v+=p[b+10],p[b+10]=v,v+=p[b+11],p[b+11]=v,v+=p[b+12],p[b+12]=v,v+=p[b+13],p[b+13]=v,v+=p[b+14],p[b+14]=v,v+=p[b+15],p[b+15]=v,v+=p[b+16],p[b+16]=v,v+=p[b+17],p[b+17]=v,v+=p[b+18],p[b+18]=v,v+=p[b+19],p[b+19]=v,v+=p[b+20],p[b+20]=v,v+=p[b+21],p[b+21]=v,v+=p[b+22],p[b+22]=v,v+=p[b+23],p[b+23]=v,v+=p[b+24],p[b+24]=v,v+=p[b+25],p[b+25]=v,v+=p[b+26],p[b+26]=v,v+=p[b+27],p[b+27]=v,v+=p[b+28],p[b+28]=v,v+=p[b+29],p[b+29]=v,v+=p[b+30],p[b+30]=v,v+=p[b+31],p[b+31]=v;if(c=I-M,f=w-X,h=Y-A,n){for(b=0;z>b;b+=32)l=e[b],o=e[b+1],u=e[b+2],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b]=~~y,e[b+1]=~~O,e[b+2]=~~C,l=e[b+4],o=e[b+5],u=e[b+6],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+4]=~~y,e[b+5]=~~O,e[b+6]=~~C,l=e[b+8],o=e[b+9],u=e[b+10],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+8]=~~y,e[b+9]=~~O,e[b+10]=~~C,l=e[b+12],o=e[b+13],u=e[b+14],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+12]=~~y,e[b+13]=~~O,e[b+14]=~~C,l=e[b+16],o=e[b+17],u=e[b+18],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+16]=~~y,e[b+17]=~~O,e[b+18]=~~C,l=e[b+20],o=e[b+21],u=e[b+22],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+20]=~~y,e[b+21]=~~O,e[b+22]=~~C,l=e[b+24],o=e[b+25],u=e[b+26],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+24]=~~y,e[b+25]=~~O,e[b+26]=~~C,l=e[b+28],o=e[b+29],u=e[b+30],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b+28]=~~y,e[b+29]=~~O,e[b+30]=~~C;if(F)for(b=z-F;z>b;b+=4)l=e[b],o=e[b+1],u=e[b+2],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,y=0>y?0:y>255?255:y,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,e[b]=~~y,e[b+1]=~~O,e[b+2]=~~C}else{for(b=0;z>b;b+=32)l=e[b],o=e[b+1],u=e[b+2],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,e[b]=~~y,e[b+1]=~~O,e[b+2]=~~C,l=e[b+4],o=e[b+5],u=e[b+6],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,e[b+4]=~~y,e[b+5]=~~O,e[b+6]=~~C,l=e[b+8],o=e[b+9],u=e[b+10],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,e[b+8]=~~y,e[b+9]=~~O,e[b+10]=~~C,l=e[b+12],o=e[b+13],u=e[b+14],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,e[b+12]=~~y,e[b+13]=~~O,e[b+14]=~~C,l=e[b+16],o=e[b+17],u=e[b+18],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,e[b+16]=~~y,e[b+17]=~~O,e[b+18]=~~C,l=e[b+20],o=e[b+21],u=e[b+22],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,e[b+20]=~~y,e[b+21]=~~O,e[b+22]=~~C,l=e[b+24],o=e[b+25],u=e[b+26],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,e[b+24]=~~y,e[b+25]=~~O,e[b+26]=~~C,l=e[b+28],o=e[b+29],u=e[b+30],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,e[b+28]=~~y,e[b+29]=~~O,e[b+30]=~~C;if(F)for(b=z-F;z>b;b+=4)l=e[b],o=e[b+1],u=e[b+2],y=m[l]*c+M,O=d[o]*f+X,C=p[u]*h+A,e[b]=~~y,e[b+1]=~~O,e[b+2]=~~C}return e},apply:function(e,r,l){var o=this;if(!o._isOn)return e;if(a.RGB===o.mode)return o._apply_rgb(e,r,l);var u,c,f,h,m,d,p,_,g,v,y=0,O=255,C=e.length,b=C>>>2,I=1/b,w=a.GRAY===o.mode,Y=(7&b)<<2;if(_=new t(256),w){for(v=0;C>v;v+=32)u=e[v],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+4],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+8],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+12],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+16],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+20],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+24],_[u]+=I,y=s(u,y),O=i(u,O),u=e[v+28],_[u]+=I,y=s(u,y),O=i(u,O);if(Y)for(v=C-Y;C>v;v+=4)u=e[v],_[u]+=I,y=s(u,y),O=i(u,O)}else{for(v=0;C>v;v+=32)u=e[v],c=e[v+1],f=e[v+2],h=~~(0+.299*u+.587*c+.114*f),m=~~(128-.168736*u-.331264*c+.5*f),d=~~(128+.5*u-.418688*c-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,m=0>m?0:m>255?255:m,e[v]=d,e[v+1]=h,e[v+2]=m,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+4],c=e[v+5],f=e[v+6],h=~~(0+.299*u+.587*c+.114*f),m=~~(128-.168736*u-.331264*c+.5*f),d=~~(128+.5*u-.418688*c-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,m=0>m?0:m>255?255:m,e[v+4]=d,e[v+5]=h,e[v+6]=m,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+8],c=e[v+9],f=e[v+10],h=~~(0+.299*u+.587*c+.114*f),m=~~(128-.168736*u-.331264*c+.5*f),d=~~(128+.5*u-.418688*c-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,m=0>m?0:m>255?255:m,e[v+8]=d,e[v+9]=h,e[v+10]=m,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+12],c=e[v+13],f=e[v+14],h=~~(0+.299*u+.587*c+.114*f),m=~~(128-.168736*u-.331264*c+.5*f),d=~~(128+.5*u-.418688*c-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,m=0>m?0:m>255?255:m,e[v+12]=d,e[v+13]=h,e[v+14]=m,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+16],c=e[v+17],f=e[v+18],h=~~(0+.299*u+.587*c+.114*f),m=~~(128-.168736*u-.331264*c+.5*f),d=~~(128+.5*u-.418688*c-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,m=0>m?0:m>255?255:m,e[v+16]=d,e[v+17]=h,e[v+18]=m,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+20],c=e[v+21],f=e[v+22],h=~~(0+.299*u+.587*c+.114*f),m=~~(128-.168736*u-.331264*c+.5*f),d=~~(128+.5*u-.418688*c-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,m=0>m?0:m>255?255:m,e[v+20]=d,e[v+21]=h,e[v+22]=m,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+24],c=e[v+25],f=e[v+26],h=~~(0+.299*u+.587*c+.114*f),m=~~(128-.168736*u-.331264*c+.5*f),d=~~(128+.5*u-.418688*c-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,m=0>m?0:m>255?255:m,e[v+24]=d,e[v+25]=h,e[v+26]=m,_[h]+=I,y=s(h,y),O=i(h,O),u=e[v+28],c=e[v+29],f=e[v+30],h=~~(0+.299*u+.587*c+.114*f),m=~~(128-.168736*u-.331264*c+.5*f),d=~~(128+.5*u-.418688*c-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,m=0>m?0:m>255?255:m,e[v+28]=d,e[v+29]=h,e[v+30]=m,_[h]+=I,y=s(h,y),O=i(h,O);if(Y)for(v=C-Y;C>v;v+=4)u=e[v],c=e[v+1],f=e[v+2],h=~~(0+.299*u+.587*c+.114*f),m=~~(128-.168736*u-.331264*c+.5*f),d=~~(128+.5*u-.418688*c-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,m=0>m?0:m>255?255:m,e[v]=d,e[v+1]=h,e[v+2]=m,_[h]+=I,y=s(h,y),O=i(h,O)}for(g=0,v=0;256>v;v+=32)g+=_[v],_[v]=g,g+=_[v+1],_[v+1]=g,g+=_[v+2],_[v+2]=g,g+=_[v+3],_[v+3]=g,g+=_[v+4],_[v+4]=g,g+=_[v+5],_[v+5]=g,g+=_[v+6],_[v+6]=g,g+=_[v+7],_[v+7]=g,g+=_[v+8],_[v+8]=g,g+=_[v+9],_[v+9]=g,g+=_[v+10],_[v+10]=g,g+=_[v+11],_[v+11]=g,g+=_[v+12],_[v+12]=g,g+=_[v+13],_[v+13]=g,g+=_[v+14],_[v+14]=g,g+=_[v+15],_[v+15]=g,g+=_[v+16],_[v+16]=g,g+=_[v+17],_[v+17]=g,g+=_[v+18],_[v+18]=g,g+=_[v+19],_[v+19]=g,g+=_[v+20],_[v+20]=g,g+=_[v+21],_[v+21]=g,g+=_[v+22],_[v+22]=g,g+=_[v+23],_[v+23]=g,g+=_[v+24],_[v+24]=g,g+=_[v+25],_[v+25]=g,g+=_[v+26],_[v+26]=g,g+=_[v+27],_[v+27]=g,g+=_[v+28],_[v+28]=g,g+=_[v+29],_[v+29]=g,g+=_[v+30],_[v+30]=g,g+=_[v+31],_[v+31]=g;if(p=y-O,n)if(w){for(v=0;C>v;v+=32)u=~~(_[e[v]]*p+O),u=0>u?0:u>255?255:u,e[v]=u,e[v+1]=u,e[v+2]=u,u=~~(_[e[v+4]]*p+O),u=0>u?0:u>255?255:u,e[v+4]=u,e[v+5]=u,e[v+6]=u,u=~~(_[e[v+8]]*p+O),u=0>u?0:u>255?255:u,e[v+8]=u,e[v+9]=u,e[v+10]=u,u=~~(_[e[v+12]]*p+O),u=0>u?0:u>255?255:u,e[v+12]=u,e[v+13]=u,e[v+14]=u,u=~~(_[e[v+16]]*p+O),u=0>u?0:u>255?255:u,e[v+16]=u,e[v+17]=u,e[v+18]=u,u=~~(_[e[v+20]]*p+O),u=0>u?0:u>255?255:u,e[v+20]=u,e[v+21]=u,e[v+22]=u,u=~~(_[e[v+24]]*p+O),u=0>u?0:u>255?255:u,e[v+24]=u,e[v+25]=u,e[v+26]=u,u=~~(_[e[v+28]]*p+O),u=0>u?0:u>255?255:u,e[v+28]=u,e[v+29]=u,e[v+30]=u;if(Y)for(v=C-Y;C>v;v+=4)u=~~(_[e[v]]*p+O),u=0>u?0:u>255?255:u,e[v]=u,e[v+1]=u,e[v+2]=u}else{for(v=0;C>v;v+=32)h=_[e[v+1]]*p+O,m=e[v+2],d=e[v],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v]=u,e[v+1]=c,e[v+2]=f,h=_[e[v+5]]*p+O,m=e[v+6],d=e[v+4],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+4]=u,e[v+5]=c,e[v+6]=f,h=_[e[v+9]]*p+O,m=e[v+10],d=e[v+8],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+8]=u,e[v+9]=c,e[v+10]=f,h=_[e[v+13]]*p+O,m=e[v+14],d=e[v+12],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+12]=u,e[v+13]=c,e[v+14]=f,h=_[e[v+17]]*p+O,m=e[v+18],d=e[v+16],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+16]=u,e[v+17]=c,e[v+18]=f,h=_[e[v+21]]*p+O,m=e[v+22],d=e[v+20],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+20]=u,e[v+21]=c,e[v+22]=f,h=_[e[v+25]]*p+O,m=e[v+26],d=e[v+24],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+24]=u,e[v+25]=c,e[v+26]=f,h=_[e[v+29]]*p+O,m=e[v+30],d=e[v+28],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v+28]=u,e[v+29]=c,e[v+30]=f;if(Y)for(v=C-Y;C>v;v+=4)h=_[e[v+1]]*p+O,m=e[v+2],d=e[v],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[v]=u,e[v+1]=c,e[v+2]=f}else if(w){for(v=0;C>v;v+=32)u=~~(_[e[v]]*p+O),e[v]=u,e[v+1]=u,e[v+2]=u,u=~~(_[e[v+4]]*p+O),e[v+4]=u,e[v+5]=u,e[v+6]=u,u=~~(_[e[v+8]]*p+O),e[v+8]=u,e[v+9]=u,e[v+10]=u,u=~~(_[e[v+12]]*p+O),e[v+12]=u,e[v+13]=u,e[v+14]=u,u=~~(_[e[v+16]]*p+O),e[v+16]=u,e[v+17]=u,e[v+18]=u,u=~~(_[e[v+20]]*p+O),e[v+20]=u,e[v+21]=u,e[v+22]=u,u=~~(_[e[v+24]]*p+O),e[v+24]=u,e[v+25]=u,e[v+26]=u,u=~~(_[e[v+28]]*p+O),e[v+28]=u,e[v+29]=u,e[v+30]=u;if(Y)for(v=C-Y;C>v;v+=4)u=~~(_[e[v]]*p+O),e[v]=u,e[v+1]=u,e[v+2]=u}else{for(v=0;C>v;v+=32)h=_[e[v+1]]*p+O,m=e[v+2],d=e[v],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),e[v]=u,e[v+1]=c,e[v+2]=f,h=_[e[v+5]]*p+O,m=e[v+6],d=e[v+4],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),e[v+4]=u,e[v+5]=c,e[v+6]=f,h=_[e[v+9]]*p+O,m=e[v+10],d=e[v+8],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),e[v+8]=u,e[v+9]=c,e[v+10]=f,h=_[e[v+13]]*p+O,m=e[v+14],d=e[v+12],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),e[v+12]=u,e[v+13]=c,e[v+14]=f,h=_[e[v+17]]*p+O,m=e[v+18],d=e[v+16],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),e[v+16]=u,e[v+17]=c,e[v+18]=f,h=_[e[v+21]]*p+O,m=e[v+22],d=e[v+20],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),e[v+20]=u,e[v+21]=c,e[v+22]=f,h=_[e[v+25]]*p+O,m=e[v+26],d=e[v+24],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),e[v+24]=u,e[v+25]=c,e[v+26]=f,h=_[e[v+29]]*p+O,m=e[v+30],d=e[v+28],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),e[v+28]=u,e[v+29]=c,e[v+30]=f;if(Y)for(v=C-Y;C>v;v+=4)h=_[e[v+1]]*p+O,m=e[v+2],d=e[v],u=~~(h+1.402*(d-128)),c=~~(h-.34414*(m-128)-.71414*(d-128)),f=~~(h+1.772*(m-128)),e[v]=u,e[v+1]=c,e[v+2]=f}return e}})}(n),!function(e){var n=e.ImArray,t=Math.sqrt,a=Math.min;Math.max,t(3);e.Create({name:"PixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.scale=n.scale),r},apply:function(e,r,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var l,o,u,c,f,h,m,d,p,_,g,v,y,O,C,b,I,w,Y,M,X,A=e.length,z=A>>>2,x=r-1,F=z-r;for(l=new n(A),o=~~(t(z)*s.scale*.01),u=o-1,c=r*u,y=O=C=b=I=0,v=0;A>v;v+=4)w=y-C,Y=O-I,M=a(x,w+u),X=a(F,Y+c),f=w+Y<<2,h=w+X<<2,m=M+Y<<2,d=M+X<<2,p=e[f]+e[h]+e[m]+e[d],_=e[f+1]+e[h+1]+e[m+1]+e[d+1],g=e[f+2]+e[h+2]+e[m+2]+e[d+2],l[v]=~~(.25*p),l[v+1]=~~(.25*_),l[v+2]=~~(.25*g),l[v+3]=e[v+3],y++,C++,y>=r&&(C=0,y=0,b++,I+=r,O+=r,b>=o&&(b=0,I=0)),C>=o&&(C=0);return l}}),e.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.scale=n.scale),r},apply:function(e,r,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var l,o,u,c,f,h,m,d,p,_,g,v,y,O,C,b,I,w,Y,M,X=e.length,A=X>>>2,z=r-1,x=A-r;for(l=new n(X),o=~~(t(A)*s.scale*.01),u=o-1,c=r*u,v=y=O=C=b=0,g=0;X>g;g+=4)I=v-O,w=y-b,Y=a(z,I+u),M=a(x,w+c),O+C>u?(f=Y+w<<2,h=Y+M<<2,m=I+w<<2):(f=I+w<<2,h=I+M<<2,m=Y+w<<2),d=e[f]+e[h]+e[m],p=e[f+1]+e[h+1]+e[m+1],_=e[f+2]+e[h+2]+e[m+2],l[g]=~~(.333*d),l[g+1]=~~(.333*p),l[g+2]=~~(.333*_),l[g+3]=e[g+3],v++,O++,v>=r&&(O=0,v=0,C++,b+=r,y+=r,C>=o&&(C=0,b=0)),O>=o&&(O=0);return l}})}(n),!function(e,n){var t=7/16,a=3/16,i=5/16,s=1/16,l=e.MODE,o=e.Array32F,u=e.Color.clamp,c=e.Color.RGB2YCbCr,f=e.Color.YCbCr2RGB;e.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:l.GRAY,init:function(e,n,r){var t=this;t.size=e||1,t.thresh=u(null==n?.4:n,0,1),t.mode=r||l.GRAY},path:r,threshold:function(e){return this.thresh=u(e,0,1),this},grayscale:function(e){return arguments.length||(e=!0),this.mode=e?l.GRAY:l.RGB,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{size:e.size,thresh:e.thresh,mode:e.mode}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.size=n.size,r.thresh=n.thresh,r.mode=n.mode),r},apply:function(e,n,r){var h,m,d,p,_,g,v,y,O,C,b,I,w,Y,M,X,A,z=this,x=e.length,F=x>>>2,S=new o(3*F),E=z.size,R=E*E,L=1/R,N=255*z.thresh,k=k<<1,D=l.RGB===z.mode,T=E*n,P=t,G=a,H=i,U=s;for(v=0,y=0,g=0;r>v;){for(I=w=Y=0,O=0,C=0,b=0;E>C;)h=g+y+O+b<<2,m=3*(g+y+O+b),I+=e[h]+S[m],w+=e[h+1]+S[m+1],Y+=e[h+2]+S[m+2],O++,O>=E&&(O=0,C++,b+=n);if(I*=L,w*=L,Y*=L,_=D?c([I,w,Y],0):[I,w,Y],d=_[0],d>N?D?(_[0]=u(~~d,0,255),p=f(_,0)):p=[255,255,255]:p=[0,0,0],h=g+y<<2,M=e[h]-p[0],X=e[h+1]-p[1],A=e[h+2]-p[2],n>g+E)for(O=E,C=0,b=0;E>C;)m=3*(g+y+O+b),S[m]+=P*M,S[m+1]+=P*X,S[m+2]+=P*A,O++,O>=k&&(O=E,C++,b+=n);if(r>v+E&&g>E)for(O=-E,C=E,b=0;k>C;)m=3*(g+y+O+b),S[m]+=G*M,S[m+1]+=G*X,S[m+2]+=G*A,O++,O>=0&&(O=-E,C++,b+=n);if(r>v+E)for(O=0,C=E,b=0;k>C;)m=3*(g+y+O+b),S[m]+=H*M,S[m+1]+=H*X,S[m+2]+=H*A,O++,O>=E&&(O=0,C++,b+=n);if(r>v+E&&n>g+E)for(O=E,C=E,b=0;k>C;)m=3*(g+y+O+b),S[m]+=U*M,S[m+1]+=U*X,S[m+2]+=U*A,O++,O>=k&&(O=E,C++,b+=n);for(O=0,C=0,b=0;E>C;)h=g+y+O+b<<2,e[h]=p[0],e[h+1]=p[1],e[h+2]=p[2],O++,O>=E&&(O=0,C++,b+=n);g+=E,g>=n&&(g=0,v+=E,y+=T)}return e}})}(n),!function(e,n){var t="hasOwnProperty",a=Math.min,i=Math.round,s=e._notSupportClamp,l=e.Color.Combine;e.Create({name:"BlendFilter",_blendImage:null,blendImage:null,mode:null,startX:0,startY:0,path:r,init:function(e,n){var r=this;r.startX=0,r.startY=0,r._blendImage=null,r.blendImage=null,r.mode=null,e&&r.setImage(e),n&&r.setMode(n)},dispose:function(){var e=this;return e.blendImage=null,e._blendImage=null,e.mode=null,e.$super("dispose"),e},setImage:function(e){var n=this;return e&&(n.blendImage=e,n._blendImage=null),n},setMode:function(e){var n=this;return e?(n.mode=(""+e).toLowerCase(),l[t](n.mode)||(n.mode=null)):n.mode=null,n},serialize:function(){var e=this,n=e.blendImage;return{filter:e.name,_isOn:!!e._isOn,params:{_blendImage:e._blendImage||(n?{data:n.getData(),width:n.width,height:n.height}:null),mode:e.mode,startX:e.startX,startY:e.startY}}},unserialize:function(n){var r,t=this;return n&&t.name===n.filter&&(t._isOn=!!n._isOn,r=n.params,t.startX=r.startX,t.startY=r.startY,t.blendImage=null,t._blendImage=r._blendImage,t._blendImage&&(t._blendImage.data=e.Util.Array.typed(t._blendImage.data,e.ImArray)),t.setMode(r.mode)),t},reset:function(){var e=this;return e.startX=0,e.startY=0,e.mode=null,e},apply:function(e,n,r){var t=this,o=t.blendImage;if(!t._isOn||!t.mode||!o&&!t._blendImage)return e;var u,c,f,h,m,d,p,_,g,v,y,O,C,b,I=t._blendImage||{data:o.getData(),width:o.width,height:o.height},w=t.startX||0,Y=t.startY||0,M=0,X=0,A=l[t.mode];if(0>w&&(M=-w,w=0),0>Y&&(X=-Y,Y=0),h=I.width,m=I.height,w>=n||Y>=r)return e;if(M>=h||X>=m)return e;if(w=i(w),Y=i(Y),M=i(M),X=i(X),u=a(n-w,h-M),c=a(r-Y,m-X),0>=u||0>=c)return e;for(f=I.data,v=w,y=Y*n,O=M,C=X*h,d=w+u,p=M+u,_=0,g=c*u;g>_;_++)b=O+C<<2,0<f[b+3]&&A(e,f,v+y<<2,b,s),v++,v>=d&&(v=w,y+=n),O++,O>=p&&(O=M,C+=h);return e}})}(n),!function(e,n){var t=e.ImArray,a=e.Util.Filter.integral_convolution,i=new e.ConvolutionMatrix([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]);e.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:3,path:r,init:function(e,n,r,t,a){var i=this;i.offsetX=e||0,i.offsetY=n||0,i.color=r||0,i.opacity=null==t?1:+t,i.quality=a||3},dispose:function(){var e=this;return e.offsetX=null,e.offsetY=null,e.color=null,e.opacity=null,e.quality=null,e.$super("dispose"),e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{offsetX:e.offsetX,offsetY:e.offsetY,color:e.color,opacity:e.opacity,quality:e.quality}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.offsetX=n.offsetX,r.offsetY=n.offsetY,r.color=n.color,r.opacity=n.opacity,r.quality=n.quality),r},apply:function(e,n,r){var s=this;if(!s._isOn)return e;var l,o,u,c,f,h,m,d,p=s.color||0,_=~~s.quality,g=s.offsetX||0,v=s.offsetY||0,y=s.opacity,O=p>>>16&255,C=p>>>8&255,b=255&p,I=e.length,w=I>>>2;if(0>y&&(y=0),y>1&&(y=1),0===y)return e;for(0>=_&&(_=1),_>3&&(_=3),d=new t(I),l=0;I>l;l+=4)m=e[l+3],m>0?(d[l]=O,d[l+1]=C,d[l+2]=b,d[l+3]=~~(y*m)):(d[l]=0,d[l+1]=0,d[l+2]=0,d[l+3]=0);for(d=a(!1,d,n,r,i,null,3,3,1,0,_),v*=n,o=0,u=0,h=0;I>h;h+=4,o++)o>=n&&(o=0,u+=n),c=o+g,f=u+v,0>c||c>=n||0>f||f>=w||(l=c+f<<2,m=e[l+3],y=d[h+3],255!==m&&0!==y&&(y/=255,O=~~(e[l]+(d[h]-e[l])*y),C=~~(e[l+1]+(d[h+1]-e[l+1])*y),b=~~(e[l+2]+(d[h+2]-e[l+2])*y),e[l]=O,e[l+1]=C,e[l+2]=b));return e}})}(n),!function(e){var n=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=e._notSupportClamp,s=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,n,r,t){var a=this;a.centerX=e||0,a.centerY=n||0,a.radius=r||10,a.amount=t||10},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.centerX=n.centerX,r.centerY=n.centerY,r.radius=n.radius,r.amount=n.amount),r},apply:function(e,r,l){var o=this;if(!o._isOn)return e;var u,c,f,h,m,d,p,_,g,v,y,O,C,b,I,w,Y,M,X,A,z,x,F,S,E,R,L,N,k,D,T,P,G,H=e.length,U=o.centerX||0,q=o.centerY||0,$=o.radius,j=o.amount;if(0>=j)return e;for(u=H>>>2,D=0,T=r-1,P=0,G=u-r,U=a(U*(r-1)),q=a(q*(l-1)),f=(u<<1)+u,p=(r<<1)+r,c=new s(f),_=0,g=0,v=0,h=m=d=0,v=0;r>v;v++,_+=4,g+=3)h+=e[_],m+=e[_+1],d+=e[_+2],c[g]=h,c[g+1]=m,c[g+2]=d;for(_=p+r,g=0,v=0,h=m=d=0,_=p+r;H>_;_+=4,g+=3,v++)v>=r&&(v=0,h=m=d=0),h+=e[_],m+=e[_+1],d+=e[_+2],c[g+p]=c[g]+h,c[g+p+1]=c[g+1]+m,c[g+p+2]=c[g+2]+d;for(v=0,y=0,O=0,_=0;H>_;_+=4,v++)v>=r&&(v=0,y++,O+=r),b=v-U,I=y-q,C=t(b)+t(I),w=C>$?~~n((C-$)*j):~~(C/$+.5),w>0&&(Y=w*r,M=.25/(w*w),X=v-w,A=O-Y,z=v+w,x=O+Y,D>X?X=D:z>T&&(z=T),P>A?A=P:x>G&&(x=G),F=X+A,R=z+x,S=z+A,E=X+x,F=(F<<1)+F,S=(S<<1)+S,E=(E<<1)+E,R=(R<<1)+R,L=M*(c[R]-c[S]-c[E]+c[F]),N=M*(c[R+1]-c[S+1]-c[E+1]+c[F+1]),k=M*(c[R+2]-c[S+2]-c[E+2]+c[F+2]),i&&(L=0>L?0:L>255?255:L,N=0>N?0:N>255?255:N,k=0>k?0:k>255?255:k),e[_]=~~L,e[_+1]=~~N,e[_+2]=~~k);return e}})}(n),!function(e){e.Create({name:"SeamlessTileFilter",type:2,init:function(e){var n=this;n.type=null==e?2:e||0},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{type:e.type}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.type=n.type),r},apply:function(n,r,t){var a,i,s,l,o,u,c,f,h,m,d,p,_,g,v,y=this,O=y.type,C=e.Interpolation.bilinear,b=e.ImArray,I=e.Array8U,w=Math.sqrt;for(r!==t?n=C(n,r,t,p=r>t?r:t,p):p=r,_=Math.round(p/2),g=p*p,v=n.length,a=new b(v),i=new b(v),s=new I(g),f=0,h=0,m=0;v>m;m+=4,f++)f>=p&&(f=0,h++),d=(f+_)%p+(h+_)%p*p<<2,a[d]=n[m],a[d+1]=n[m+1],a[d+2]=n[m+2],a[d+3]=n[m+3];if(0===O)for(f=0,h=0;_>f;h++)h>=_&&(h=0,f++),c=255-255*w((f-_)*(f-_)+(h-_)*(h-_))/_,c=1>c?1:c>255?255:c,s[f+h*p]=c,s[f+(p-1-h)*p]=c,s[p-1-f+h*p]=c,s[p-1-f+(p-1-h)*p]=c;else if(1===O)for(f=0,h=0;_>f;h++)h>=_&&(h=0,f++),c=255-255*(_+f>_+h?(h-_)/_:(f-p/2)/_),c=1>c?1:c>255?255:c,s[f+h*p]=c,s[f+(p-1-h)*p]=c,s[p-1-f+h*p]=c,s[p-1-f+(p-1-h)*p]=c;else for(f=0,h=0;_>f;h++)h>=_&&(h=0,f++),c=255-255*(_+f>_+h?w((h-p)*(h-p)+(f-p)*(f-p))/(1.13*p):w((f-p)*(f-p)+(h-p)*(h-p))/(1.13*p)),c=1>c?1:c>255?255:c,s[f+h*p]=c,s[f+(p-1-h)*p]=c,s[p-1-f+h*p]=c,s[p-1-f+(p-1-h)*p]=c;for(h=0,f=0;p>h;f++)f>=p&&(f=0,h++),d=f+h*p,l=s[d],o=s[(f+_)%p+(h+_)%p*p],u=l+o,l/=u,o/=u,d<<=2,i[d]=~~(l*n[d]+o*a[d]),i[d+1]=~~(l*n[d+1]+o*a[d+1]),i[d+2]=~~(l*n[d+2]+o*a[d+2]),i[d+3]=n[d+3];return r!==t&&(i=C(i,p,p,r,t)),i}})}(n),!function(e){var n=e.Util.Array.typed,t=Math.abs,a=(Math.min,Math.max,Math.ceil),i=e.MODE,s=e.Array8U,l=e.Array32U;e.Create({name:"FloodFillFilter",x:0,y:0,color:null,borderColor:null,tolerance:0,path:r,init:function(e,n,r,t,a){var i=this;i.x=e||0,i.y=n||0,i.color=r||0,i.tolerance=t||0,i.borderColor=a===+a?+a:null;
},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{color:e.color,borderColor:e.borderColor,x:e.x,y:e.y,tolerance:e.tolerance}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.color=n.color,r.borderColor=n.borderColor,r.x=n.x,r.y=n.y,r.tolerance=n.tolerance),r},apply:function(e,n,r){var a,i,l,o,u,c,f,h,m,d,p,_,g=this,v=~~(255*(g.tolerance>=1?.999:g.tolerance)),y=g.color||0,O=g.borderColor,C=O===+O,b=n<<2,I=g.x,w=g.y,Y=e.length,M=0,X=Y-b,A=0,z=n-1<<2;if(h=w*n<<2,I<<=2,A>I||I>z||M>h||h>X)return e;if(a=new s(3),i=new s(3),i[0]=y>>>16&255,i[1]=y>>>8&255,i[2]=255&y,C){if(a[0]=O>>>16&255,a[1]=O>>>8&255,a[2]=255&O,t(a[0]-e[I+h])<=v&&t(a[1]-e[I+h+1])<=v&&t(a[2]-e[I+h+2])<=v)return e}else{if(e[I+h]===i[0]&&e[I+h+1]===i[1]&&e[I+h+2]===i[2])return e;a[0]=e[I+h],a[1]=e[I+h+1],a[2]=e[I+h+2]}for(m=new Array(Y>>>2),d=0,h+b>=M&&X>=h+b&&(m[d++]=[h,I,I,b]),m[d++]=[h+b,I,I,-b];d>0;){if(p=m[--d],h=p[0]+(b=p[3]),c=p[1],f=p[2],C)for(u=c;u>=A&&(o=u+h,!(t(a[0]-e[o])<=v&&t(a[1]-e[o+1])<=v&&t(a[2]-e[o+2])<=v));u-=4)e[o]=i[0],e[o+1]=i[1],e[o+2]=i[2];else for(u=c;u>=A&&(o=u+h,t(a[0]-e[o])<=v&&t(a[1]-e[o+1])<=v&&t(a[2]-e[o+2])<=v);u-=4)e[o]=i[0],e[o+1]=i[1],e[o+2]=i[2];if(u>=c){if(o=u+h,C)for(;f>=u&&t(a[0]-e[o])<=v&&t(a[1]-e[o+1])<=v&&t(a[2]-e[o+2])<=v;)u+=4,o=u+h;else for(;f>=u&&!(t(a[0]-e[o])<=v&&t(a[1]-e[o+1])<=v&&t(a[2]-e[o+2])<=v);)u+=4,o=u+h;l=u,_=f>=u}else l=u+4,c>l&&h-b>=M&&X>=h-b&&(m[d++]=[h,l,c-4,-b]),u=c+4,_=!0;for(;_;){if(o=u+h,C)for(;z>=u&&!(t(a[0]-e[o])<=v&&t(a[1]-e[o+1])<=v&&t(a[2]-e[o+2])<=v);)e[o]=i[0],e[o+1]=i[1],e[o+2]=i[2],u+=4,o=u+h;else for(;z>=u&&t(a[0]-e[o])<=v&&t(a[1]-e[o+1])<=v&&t(a[2]-e[o+2])<=v;)e[o]=i[0],e[o+1]=i[1],e[o+2]=i[2],u+=4,o=u+h;if(h+b>=M&&X>=h+b&&(m[d++]=[h,l,u-4,b]),u>f+4&&h-b>=M&&X>=h-b&&(m[d++]=[h,f+4,u-4,-b]),o=u+h,C)for(;f>=u&&t(a[0]-e[o])<=v&&t(a[1]-e[o+1])<=v&&t(a[2]-e[o+2])<=v;)u+=4,o=u+h;else for(;f>=u&&!(t(a[0]-e[o])<=v&&t(a[1]-e[o+1])<=v&&t(a[2]-e[o+2])<=v);)u+=4,o=u+h;l=u,_=f>=u}}return e}}),e.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:0,pattern:null,_pattern:null,mode:i.TILE,borderColor:null,path:r,init:function(e,n,r,t,a,s,l,o){var u=this;u.x=e||0,u.y=n||0,u.offsetX=t||0,u.offsetY=a||0,r&&u.setPattern(r),u.mode=s||i.TILE,u.tolerance=l||0,u.borderColor=o===+o?+o:null},dispose:function(){var e=this;return e.pattern=null,e._pattern=null,e.x=null,e.y=null,e.offsetX=null,e.offsetY=null,e.tolerance=null,e.mode=null,e.borderColor=null,e.$super("dispose"),e},setPattern:function(e){var n=this;return e&&(n.pattern=e,n._pattern=null),n},serialize:function(){var e=this,n=e.pattern;return{filter:e.name,_isOn:!!e._isOn,params:{x:e.x,y:e.y,offsetX:e.offsetX,offsetY:e.offsetY,tolerance:e.tolerance,mode:e.mode,borderColor:e.borderColor,_pattern:e._pattern||(n?{data:n.getData(),width:n.width,height:n.height}:null)}}},unserialize:function(r){var t,a=this;return r&&a.name===r.filter&&(a._isOn=!!r._isOn,t=r.params,a.x=t.x,a.y=t.y,a.offsetX=t.offsetX,a.offsetY=t.offsetY,a.tolerance=t.tolerance,a.mode=t.mode,a.borderColor=t.borderColor,a.pattern=null,a._pattern=t._pattern,a._pattern&&(a._pattern.data=n(a._pattern.data,e.ImArray))),a},apply:function(e,n,r){var o=this,u=o.pattern;if(!o._isOn||!u&&!o._pattern)return e;var c,f,h,m,d,p,_,g,v,y,O,C,b,I,w,Y,M=o._pattern||{data:u.getData(),width:u.width,height:u.height},X=~~(255*(o.tolerance>=1?.999:o.tolerance)),A=o.mode,z=o.borderColor,x=z===+z,F=n<<2,S=M.data,E=M.width,R=M.height,L=o.x,N=o.y,k=o.offsetX||0,D=o.offsetY||0,T=e.length,P=T>>>2,G=0,H=T-F,U=0,q=n-1<<2,$=i.STRETCH;if(0>k&&(k+=E),0>D&&(D+=R),d=N,g=N*n<<2,L<<=2,U>L||L>q||G>g||g>H)return e;if(c=new s(3),x){if(c[0]=z>>>16&255,c[1]=z>>>8&255,c[2]=255&z,t(c[0]-e[L+g])<=X&&t(c[1]-e[L+g+1])<=X&&t(c[2]-e[L+g+2])<=X)return e}else c[0]=e[L+g],c[1]=e[L+g+1],c[2]=e[L+g+2];for(C=new Array(P),b=0,I=new l(a(P/32)),g+F>=G&&H>=g+F&&(C[b++]=[g,L,L,F,d+1]),C[b++]=[g+F,L,L,-F,d];b>0;){if(w=C[--b],g=w[0]+(F=w[3]),p=w[1],_=w[2],d=w[4],x)for(m=p;m>=U&&(h=m+g,!(I[h>>>7]&1<<(h>>>2&31)||t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X));m-=4)I[h>>>7]|=1<<(h>>>2&31),$===A?(y=~~(E*(m>>>2)/n),O=~~(R*d/r)):(y=((m>>>2)+k)%E,O=(d+D)%R),v=y+O*E<<2,e[h]=S[v],e[h+1]=S[v+1],e[h+2]=S[v+2];else for(m=p;m>=U&&(h=m+g,!(I[h>>>7]&1<<(h>>>2&31))&&t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X);m-=4)I[h>>>7]|=1<<(h>>>2&31),$===A?(y=~~(E*(m>>>2)/n),O=~~(R*d/r)):(y=((m>>>2)+k)%E,O=(d+D)%R),v=y+O*E<<2,e[h]=S[v],e[h+1]=S[v+1],e[h+2]=S[v+2];if(m>=p){if(h=m+g,x)for(;_>=m&&I[h>>>7]&1<<(h>>>2&31)||t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X;)m+=4,h=m+g;else for(;_>=m&&!(!(I[h>>>7]&1<<(h>>>2&31))&&t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X);)m+=4,h=m+g;f=m,Y=_>=m}else f=m+4,p>f&&g-F>=G&&H>=g-F&&(C[b++]=[g,f,p-4,-F,F>0?d-1:d+1]),m=p+4,Y=!0;for(;Y;){if(h=m+g,x)for(;q>=m&&!(I[h>>>7]&1<<(h>>>2&31))&&!(t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X);)I[h>>>7]|=1<<(h>>>2&31),$===A?(y=~~(E*(m>>>2)/n),O=~~(R*d/r)):(y=((m>>>2)+k)%E,O=(d+D)%R),v=y+O*E<<2,e[h]=S[v],e[h+1]=S[v+1],e[h+2]=S[v+2],m+=4,h=m+g;else for(;q>=m&&!(I[h>>>7]&1<<(h>>>2&31))&&t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X;)I[h>>>7]|=1<<(h>>>2&31),$===A?(y=~~(E*(m>>>2)/n),O=~~(R*d/r)):(y=((m>>>2)+k)%E,O=(d+D)%R),v=y+O*E<<2,e[h]=S[v],e[h+1]=S[v+1],e[h+2]=S[v+2],m+=4,h=m+g;if(g+F>=G&&H>=g+F&&(C[b++]=[g,f,m-4,F,F>0?d+1:d-1]),m>_+4&&g-F>=G&&H>=g-F&&(C[b++]=[g,_+4,m-4,-F,F>0?d-1:d+1]),h=m+g,x)for(;_>=m&&I[h>>>7]&1<<(h>>>2&31)||t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X;)m+=4,h=m+g;else for(;_>=m&&!(!(I[h>>>7]&1<<(h>>>2&31))&&t(c[0]-e[h])<=X&&t(c[1]-e[h+1])<=X&&t(c[2]-e[h+2])<=X);)m+=4,h=m+g;f=m,Y=_>=m}}return e}})}(n),!function(e){function n(e){var n,r,t,a,i,s=new l(256),o=new l(256),u=e.length,c=u>>>2;for(n=0;u>n;n+=4)s[e[n]]++;for(r=0,t=0,n=0;256>n;n++){for(r+=s[n],i=255*r/c,a=t+1;i>=a;a++)o[a]=n;t=i}for(n=0;u>n;n+=4)a=o[e[n]],e[n]=a,e[n+1]=a,e[n+2]=a}function t(e,n,r,t){var a,i,l,_,g,v=2,y=14,O=(e.length,t.length),C=new s(O),b=new s(O),I=new s(O),w=new s(O),Y=new s(y),M=new s(y),X=v*v,A=2*X,z=h*X;for(a=0;y>a&&(i=m(-(a*a)/A),!(o>=i&&a>=2));a++)l=m(-((g=a-.5)*g)/A),_=m(-((g=a+.5)*g)/A),Y[a]=(i+l+_)/3/z,M[a]=_-l;var g,x,F,S,E,R,L,N,k,D=a-1,T=n-(a-1),P=n*(a-1),G=n*(r-(a-1));for(g=D,x=P;T>g;x+=n){for(x>=G&&(x=P,g++),F=g+x,S=e[F<<2]*Y[0],E=S,R=1,L=n;a>R;)E+=Y[R]*(e[F-L<<2]+e[F+L<<2]),S+=Y[R]*(e[F-R<<2]+e[F+R<<2]),L+=n,R++;b[F]=E,C[F]=S}for(g=D,x=P;T>g;x+=n){for(x>=G&&(x=P,g++),N=0,F=g+x,k=1;a>k;k++)N+=M[k]*(b[F-k]-b[F+k]);I[F]=N}for(T=n-a,g=a,x=P;T>g;x+=n){for(x>=G&&(x=P,g++),N=0,F=g+x,L=n,k=1;a>k;k++)N+=M[k]*(C[F-L]-C[F+L]),L+=n;w[F]=N}D=a,T=n-a,P=n*a,G=n*(r-a);var H,U,q,$,j,B,W,J,K,Q,V,Z,ee,ne,re,te,ae,ie,se,le;for(g=D,x=P;T>g;x+=n)x>=G&&(x=P,g++),F=g+x,H=F-n,U=F+n,$=F-1,q=F+1,j=H-1,B=H+1,W=U-1,J=U+1,K=I[F],Q=w[F],V=d(K)+d(Q),ee=d(I[H])+d(w[H]),ne=d(I[U])+d(w[U]),te=d(I[$])+d(w[$]),re=d(I[q])+d(w[q]),ie=d(I[B])+d(w[B]),le=d(I[J])+d(w[J]),se=d(I[W])+d(w[W]),ae=d(I[j])+d(w[j]),(0>=K*Q?d(K)>=d(Q)?(Z=d(K*V))>=d(Q*ie-(K+Q)*re)&&Z>d(Q*se-(K+Q)*te):(Z=d(Q*V))>=d(K*ie-(Q+K)*ee)&&Z>d(K*se-(Q+K)*ne):d(K)>=d(Q)?(Z=d(K*V))>=d(Q*le+(K-Q)*re)&&Z>d(Q*ae+(K-Q)*te):(Z=d(Q*V))>=d(K*le+(Q-K)*ne)&&Z>d(K*ae+(Q-K)*ee))?t[F]=V>=c?f:p(u*V):t[F]=0}function a(e,n,r,t,a,s){var l,o,u,c,f=e.length,h=f>>>2;for(l=0;f>l;l+=4)e[l]=e[l+1]=e[l+2]=0;for(c=0,u=0,o=0,l=0;h>o;o++,l=o<<2,c++)c>=n&&(c=0,u++),0===e[l]&&t[o]>=s&&i(e,n,r,t,c,u,l,a)}function i(e,n,r,t,a,s,l,o){var u,c,f,h,m,d=0===a?a:a-1,p=a===n-1?a:a+1,_=0===s?s:s-1,g=s===r-1?s:s+1,v=_*n;for(e[l]=e[l+1]=e[l+2]=255,u=d,c=_,f=v;p>=u&&g>=c;){if(m=u+f,h=m<<2,(c!==s||u!==a)&&0===e[h]&&t[m]>=o)return void i(e,n,r,t,u,c,h,o);c++,f+=n,c>g&&(c=_,f=v,u++)}}var s=e.Array32F,l=e.Array32I,o=.005,u=100,c=1e3,f=u*c,h=2*Math.PI,m=Math.exp,d=Math.abs,p=Math.floor,_=Math.round;e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,contrastNormalized:!1,path:r,init:function(e,n,r){var t=this;t.low=arguments.length<1?2.5:e,t.high=arguments.length<2?7.5:n,t.contrastNormalized=!!r},thresholds:function(e,n){var r=this;return r.low=e,r.high=n,r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{low:e.low,high:e.high,contrastNormalized:e.contrastNormalized}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.low=n.low,r.high=n.high,r.contrastNormalized=n.contrastNormalized),r},apply:function(e,r,i){var s,o=this,c=e.length>>2;return o.contrastNormalized&&n(e),t(e,r,i,s=new l(c)),a(e,r,i,s,_(o.low*u),_(o.high*u)),e}})}(n),!function(e,n){function t(e,n,r,t,a,i,s,l,o,u,c,f,d,p,_,y,O){var C,b,I,w,Y,M,X,A,z,x,F,S,E,R,L,N,k,D,T,P,G,H,U,q,$,j,B,W,J,K,Q,V,Z,ee,T,ne,re,te,ae,ie,se,le,oe,ue,ce,fe,he,me,de,pe,_e,ge,ve,ye=null!=_,Oe=i-t+1,Ce=s-a+1,be=Oe*Ce,Ie=be-1,we=l.stages,Ye=we.length,Me=l.size1,Xe=l.size2,Ae=h(Oe/Me,Ce/Xe),ze=t,xe=a;for(P=0,G=Oe-1,H=0,U=be-Oe,C=o,C=o;Ae>=C;C*=u)for(w=~~(C*Me),b=~~(w*c),Y=~~(C*Xe),I=~~(Y*c),x=Y*Oe,F=I*Oe,M=xe*F,N=Oe-w,k=Ce-Y,q=w*Y,$=1/q,A=xe,z=M;k>A;A+=I,z+=F)for(X=ze;N>X;X+=b)if(S=X-1+z-Oe,E=S+w,R=S+x,L=R+w,S=0>S?0:S>Ie?Ie:S,E=0>E?0:E>Ie?Ie:E,R=0>R?0:R>Ie?Ie:R,L=0>L?0:L>Ie?Ie:L,!(ye&&(J=$*(_[L]-_[R]-_[E]+_[S]),y>J||J>O))){for(j=$*(f[L]-f[R]-f[E]+f[S]),B=$*(p[L]-p[R]-p[E]+p[S]),W=B-j*j,W=W>1?m(W):1,K=!1,D=0;Ye>D;D++){for(Q=we[D],V=Q.thres,Z=Q.trees,ee=Z.length,ve=0,T=0;ee>T;T++)for(re=Z[T].feats,ne=0;;){if(te=re[ne],ae=te.rects,ie=ae.length,se=te.thres,le=0,te.tilt)for(oe=0;ie>oe;oe++)ue=ae[oe],ce=X+~~(C*ue[0]),fe=(A-1+~~(C*ue[1]))*Oe,he=X+~~(C*(ue[0]+ue[2])),me=(A-1+~~(C*(ue[1]+ue[2])))*Oe,de=X+~~(C*(ue[0]-ue[3])),pe=(A-1+~~(C*(ue[1]+ue[3])))*Oe,_e=X+~~(C*(ue[0]+ue[2]-ue[3])),ge=(A-1+~~(C*(ue[1]+ue[2]+ue[3])))*Oe,ce=P>ce?P:ce>G?G:ce,he=P>he?P:he>G?G:he,de=P>de?P:de>G?G:de,_e=P>_e?P:_e>G?G:_e,fe=H>fe?H:fe>U?U:fe,me=H>me?H:me>U?U:me,pe=H>pe?H:pe>U?U:pe,ge=H>ge?H:ge>U?U:ge,le+=ue[4]*(d[_e+ge]-d[de+pe]-d[he+me]+d[ce+fe]);else for(oe=0;ie>oe;oe++)ue=ae[oe],ce=X-1+~~(C*ue[0]),he=X-1+~~(C*(ue[0]+ue[2])),fe=Oe*(A-1+~~(C*ue[1])),me=Oe*(A-1+~~(C*(ue[1]+ue[3]))),ce=P>ce?P:ce>G?G:ce,he=P>he?P:he>G?G:he,fe=H>fe?H:fe>U?U:fe,me=H>me?H:me>U?U:me,le+=ue[4]*(f[he+me]-f[ce+me]-f[he+fe]+f[ce+fe]);if(se*W>le*$){if(te.has_l){ve+=te.l_val;break}ne=te.l_node}else{if(te.has_r){ve+=te.r_val;break}ne=te.r_node}}if(K=ve>V,!K)break}K&&(e.count===e.length&&v.apply(e,new Array(g)),e[e.count++]=[X,A,w,Y])}}function a(e,n,r){var t=f(n[2],e[2])*r,a=f(n[3],e[3])*r;return c(e[0]-n[0])<=t&&c(e[1]-n[1])<=a&&c(e[2]-n[2])<=t&&c(e[3]-n[3])<=a}function i(e,n){return e.x1>=n.x1&&e.y1>=n.y1&&e.x2<=n.x2&&e.y2<=n.y2}function s(e){e.x1=~~(e.x1+.5),e.y1=~~(e.y1+.5),e.x2=~~(e.x2+.5),e.y2=~~(e.y2+.5)}function l(e,n){return n.area-e.area}function o(e,n,r){var t,o,u,c,f,h,m,d,p,_,g,v=e.length,y=new Array(v),O=[],C=0,b=!1;for(u=0;v>u;u++)y[u]=0;for(u=0;v>u;u++){for(b=!1,c=0;u>c;c++)a(e[c],e[u],r)&&(b=!0,y[u]=y[c]);b||(y[u]=C,C++)}for(t=new Array(C),o=new Array(C),u=0;C>u;u++)t[u]=0,o[u]=[0,0,0,0];for(u=0;v>u;u++)m=y[u],t[m]++,o[m][0]+=e[u][0],o[m][1]+=e[u][1],o[m][2]+=e[u][2],o[m][3]+=e[u][3];for(u=0;C>u;u++)f=t[u],f>=n&&(h=1/(f+f),d=h*(2*o[u][0]+f),p=h*(2*o[u][1]+f),_=h*(2*o[u][2]+f),g=h*(2*o[u][3]+f),O.push({x1:d,y1:p,x2:d+_-1,y2:p+g-1,x:d,y:p,width:_,height:g,area:0,inside:0}));for(v=O.length,u=0;v>u;u++)for(c=u+1;v>c;c++)!O[u].inside&&i(O[u],O[c])?O[u].inside=1:!O[c].inside&&i(O[c],O[u])&&(O[c].inside=1);for(u=v;--u>=0;)O[u].inside?O.splice(u,1):(s(O[u]),O[u].area=O[u].width*O[u].height);return O.sort(l)}var u=e.Array32F,c=(e.Array8U,Math.abs),f=Math.max,h=Math.min,m=(Math.floor,Math.round,Math.sqrt),d=e.Util.Array.typed,p=e.Util.Array.typed_obj,_="hasOwnProperty",g=10,v=Array.prototype.push,y=e.Util.Filter.SAT,O=e.Util.Filter.GRAD;e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,selection:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,r,t,a,i,s,l){var o=this;o.objects=null,o.haardata=e||null,o.baseScale=n===r?1:r,o.scaleIncrement=n===t?1.25:t,o.stepIncrement=n===a?.5:a,o.minNeighbors=n===i?1:i,o.doCannyPruning=n===s?!0:!!s,o.tolerance=null==l?.2:+l,o._haarchanged=!!o.haardata},path:r,dispose:function(){var e=this;return e.selection=null,e.objects=null,e.haardata=null,e.$super("dispose"),e},haar:function(e){var n=this;return n.haardata=e,n._haarchanged=!0,n},select:function(e,n,r,t){var a=this;return!1===e?a.selection=null:a.selection=[h(1,f(0,e||0)),h(1,f(0,n||0)),h(1,f(0,r||0)),h(1,f(0,t||0))],a},params:function(e){var n=this;return e&&(e[_]("haardata")&&(n.haardata=e.haardata,n._haarchanged=!0),e[_]("baseScale")&&(n.baseScale=e.baseScale),e[_]("scaleIncrement")&&(n.scaleIncrement=e.scaleIncrement),e[_]("stepIncrement")&&(n.stepIncrement=e.stepIncrement),e[_]("minNeighbors")&&(n.minNeighbors=e.minNeighbors),e[_]("doCannyPruning")&&(n.doCannyPruning=e.doCannyPruning),e[_]("tolerance")&&(n.tolerance=e.tolerance),e[_]("cannyLow")&&(n.cannyLow=e.cannyLow),e[_]("cannyHigh")&&(n.cannyHigh=e.cannyHigh),e[_]("selection")&&(n.selection=e.selection||null)),n},serialize:function(){var e,n=this;return e={filter:n.name,_isOn:!!n._isOn,_update:n._update,params:{baseScale:n.baseScale,scaleIncrement:n.scaleIncrement,stepIncrement:n.stepIncrement,minNeighbors:n.minNeighbors,doCannyPruning:n.doCannyPruning,tolerance:n.tolerance,cannyLow:n.cannyLow,cannyHigh:n.cannyHigh,selection:n.selection}},n._haarchanged&&(e.params.haardata=p(n.haardata),n._haarchanged=!1),e},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=e._isOn,r._update=e._update,n=e.params,n[_]("haardata")&&(r.haardata=p(n.haardata,1)),r.baseScale=n.baseScale,r.scaleIncrement=n.scaleIncrement,r.stepIncrement=n.stepIncrement,r.minNeighbors=n.minNeighbors,r.doCannyPruning=n.doCannyPruning,r.tolerance=n.tolerance,r.cannyLow=n.cannyLow,r.cannyHigh=n.cannyHigh,r.selection=d(n.selection,Array)),r},getMeta:function(){return e.isWorker?p(this.objects):this.objects},setMeta:function(e){return this.objects="string"==typeof e?p(e,1):e,this},apply:function(e,n,r,a,i){var s=this;if(!s._isOn||!s.haardata)return e;var l,c,m,d,p,_=e.length>>>2,v=s.selection||null,C=null,b=null,I=null,w=null;return v?(l=h(n-1,f(0,v[0]*(n-1))),c=h(r-1,f(0,v[1]*(r-1))),m=h(n-1,f(0,v[2]*(n-1))),d=h(r-1,f(0,v[3]*(r-1)))):(l=0,c=0,m=n-1,d=r-1),i&&i.SAT?(C=i.SAT,b=i.SAT2,I=i.RSAT):(y(e,n,r,C=new u(_),b=new u(_),I=new u(_)),i&&(i.SAT=C,i.SAT2=b,i.RSAT=I)),s.doCannyPruning&&(i&&i.EDGES?w=i.EDGES:(O(e,n,r,w=new u(_),1),i&&(i.EDGES=w))),p=new Array(g),p.count=0,t(p,n,r,l,c,m,d,s.haardata,s.baseScale,s.scaleIncrement,s.stepIncrement,C,I,b,w,s.cannyLow,s.cannyHigh),p.length>p.count&&(p.length=p.count),s.objects=o(p,s.minNeighbors,s.tolerance),e}}),e.HaarDetectorFilter.detect=t,e.HaarDetectorFilter.merge=o}(n),!function(e,n){function t(e,n){for(;n[e][1]!==e;)n[e][1]=n[n[e][1]][1],e=n[e][1];return e}function a(e,n,r){var a=t(e,r),i=t(n,r);a!==i&&(r[a][1]=i)}function i(e,n,r){var t=r.next;return t+1>r.length&&Array.prototype.push.apply(r,new Array(O)),r[t]=[t,t,0],++r.next,t}function s(e,n,r,t){return e}function l(e,n,r,t,a){return 0===e[n+3]&&0===e[r+3]||y(e[n]-e[r])<=t&&y(e[n+1]-e[r+1])<=t&&y(e[n+2]-e[r+2])<=t}function o(e,n,r,t,a){return y(n[r]-e[0])<=t&&y(n[r+1]-e[1])<=t&&y(n[r+2]-e[2])<=t}function u(e,n,r,t,a){if(0===e[n+3]&&0===e[r+3])return!0;var i=n>>>2,s=r>>>2;return null==a[i]&&(a[i]=_(e[n],e[n+1],e[n+2])),null==a[s]&&(a[s]=_(e[r],e[r+1],e[r+2])),y(a[i],a[s])<=t}function c(e,n,r,t,a){var i=r>>>2;return null==a[i]&&(a[i]=_(n[r],n[r+1],n[r+2])),y(a[i],e)<=t}function f(e,n,r,t,a){if(0===e[n+3]&&0===e[r+3])return!0;var i=n>>>2,s=r>>>2;return null==a[i]&&(a[i]=p(e[n],e[n+1],e[n+2])),null==a[s]&&(a[s]=p(e[r],e[r+1],e[r+2])),y(a[i],a[s])<=t}function h(e,n,r,t,a){var i=r>>>2;return null==a[i]&&(a[i]=p(n[r],n[r+1],n[r+2])),y(a[i],e)<=t}var m=e.Array32U,d=e.MODE,p=e.Color.hue,_=e.Color.intensity,g=Math.min,v=Math.max,y=Math.abs,O=20;e.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:0,mode:d.COLOR,color:null,invert:!1,box:null,init:function(e,n,r,t,a){var i=this;i.connectivity=8===e?8:4,i.tolerance=n||0,i.mode=r||d.COLOR,i.color=null==t?null:t,i.invert=!!a},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{connectivity:e.connectivity,tolerance:e.tolerance,mode:e.mode,color:e.color,invert:e.invert}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.connectivity=n.connectivity,r.tolerance=n.tolerance,r.mode=n.mode,r.color=n.color,r.invert=n.invert),r},apply:function(e,n,r){var p=this;if(!p._isOn)return e;var _,y,C,b,I,w,Y,M,X,A,z,x,F=e.length,S=F>>>2,E=n<<2,R=p.mode||d.COLOR,L=p.invert,N=p.color,k=g(.999,v(0,p.tolerance||0)),D=8===p.connectivity?8:4,T=8===D,P=T?-1:0,G=P<<2,H=null,U=null,q=null,$=null,j=null!=N;for(X=new Array(O),X.next=0,A=new m(S),d.HUE===R?(k*=360,H=f,U=new Array(S),j&&(q=h)):d.INTENSITY===R?(k*=255,H=u,U=new Array(S),j&&(q=c)):(k*=255,H=l,j&&(N=[N>>>16&255,N>>>8&255,255&N],q=o)),$=j?i(0,0,X):null,A[0]=j&&!q(N,e,0,k,U)?$:i(0,0,X),I=1,_=4;n>I;I++,_+4)A[I]=j&&!q(N,e,_,k,U)?$:H(e,_,_-4,k,U)?s(A[I-1],I,0,X):i(I,0,X);for(w=1,M=n,_=E;r>w;w++,M+=n,_+=E)for(A[M]=j&&!q(N,e,_,k,U)?$:H(e,_,_-E,k,U)?s(A[M-n],0,w,X):i(0,w,X),I=1,y=4;n>I;I++,y+=4)if(!j||q(N,e,_+y,k,U)){for(b=$===A[M+I-1]?-1:H(e,_+y,_+y-4,k,U)?s(A[M+I-1],I,w,X):-1,Y=P,C=G;1>Y;Y++,C+=4)$!==A[M-n+I+Y]&&H(e,_+y,_-E+y+C,k,U)&&(b>=0?a(b,A[M-n+I+Y],X):b=s(A[M-n+I+Y],I+Y,w,X));A[M+I]=b>=0?s(b,I,w,X):i(I,w,X),T&&$!==A[M+I-1]&&$!==A[M-n+I]&&H(e,_+y-4,_-E+y,k,U)&&a(A[M+I-1],A[M-n+I],X)}else A[M+I]=$;if(0===$)for(_=0,z=X.next,x=0;z>_;_++)_===X[_][1]&&(X[_][2]=0===X[_][1]?0:++x);else for(_=0,z=X.next,x=0;z>_;_++)_===X[_][1]&&(X[_][2]=x++);if(x=x>0?x:1,L)for(I=0,_=0;F>_;_+=4,I++)N=X[t(A[I],X)][2],N=~~(255-255*N/x),e[_]=N,e[_+1]=N,e[_+2]=N;else for(I=0,_=0;F>_;_+=4,I++)N=X[t(A[I],X)][2],N=~~(255*N/x),e[_]=N,e[_+1]=N,e[_+2]=N;return e}})}(n),n});