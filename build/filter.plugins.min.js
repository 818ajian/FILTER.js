/**
*
*   FILTER.js Plugins
*   @version: 0.6.8
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,r,n,e,a){n=n?[].concat(n):[];var i,o,l=Array,u=l.prototype,s=n.length,h=new l(s),f=new l(s),c=new l(s);for(i=0;s>i;i++)h[i]=n[i][0],f[i]=n[i][1];if("object"==typeof module&&module.exports){if(a===module.exports[r]){for(i=0;s>i;i++)c[i]=module.exports[h[i]]||require(f[i])[h[i]];o=e.apply(t,c),module.exports[r]=o||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(f),function(n){if(a===n[r]){for(var i=u.slice.call(arguments,1),l=i.length,s=0;l>s;s++)c[s]=n[h[s]]||i[s];o=e.apply(t,c),n[r]=o||1}});else if(a===t[r]){for(i=0;s>i;i++)c[i]=t[h[i]];o=e.apply(t,c),t[r]=o||1}}(this,"FILTER_PLUGINS",[["FILTER","./filter"]],function(t){var r=null;return function(t){var r=t._notSupportClamp,n=Math.random;t.NoiseFilter=t.Create({min:-127,max:127,name:"NoiseFilter",init:function(t,r){this.min=t||-127,this.max=r||127},apply:function(t){var e,a,i,o,l,u,s,h,f=this.max-this.min,c=this.min,p=t.length;if(r)for(e=0;p>e;e+=4)i=t[e],o=t[e+1],l=t[e+2],a=f*n()+c,u=i+a,s=o+a,h=l+a,0>u?u=0:u>255&&(u=255),0>s?s=0:s>255&&(s=255),0>h?h=0:h>255&&(h=255),t[e]=~~u,t[e+1]=~~s,t[e+2]=~~h;else for(e=0;p>e;e+=4)i=t[e],o=t[e+1],l=t[e+2],a=f*n()+c,u=i+a,s=o+a,h=l+a,t[e]=~~u,t[e+1]=~~s,t[e+2]=~~h;return t}})}(t),function(t){var r=t._notSupportClamp,n=t.Array32F,e=t.Color.RGB2YCbCr,a=t.Color.YCbCr2RGB;t.HistogramEqualizeFilter=t.Create({name:"HistogramEqualizeFilter",apply:function(t){var i,o,l,u,s,h,f,c,p,g,m,d=0,v=255,C=0,y=t.length,b=y>>2,F=1/b;for(s=new n(256),p=0;256>p;p+=4)s[p]=0,s[p+1]=0,s[p+2]=0,s[p+3]=0;for(p=0;y>p;p+=4)i=t[p],o=t[p+1],l=t[p+2],g=e({r:i,g:o,b:l}),i=t[p]=~~g.cr,o=t[p+1]=~~g.y,l=t[p+2]=~~g.cb,s[o]+=F,o>d?d=o:v>o&&(v=o);for(C=0,p=0;256>p;p+=4)C+=s[p],s[p]=C,C+=s[p+1],s[p+1]=C,C+=s[p+2],s[p+2]=C,C+=s[p+3],s[p+3]=C;if(u=d-v,r)for(p=0;y>p;p+=4)g={cr:t[p],y:t[p+1],cb:t[p+2]},g.y=s[g.y]*u+v,m=a(g),h=m.r,f=m.g,c=m.b,h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c,t[p]=~~h,t[p+1]=~~f,t[p+2]=~~c;else for(p=0;y>p;p+=4)g={cr:t[p],y:t[p+1],cb:t[p+2]},g.y=s[g.y]*u+v,m=a(g),t[p]=~~m.r,t[p+1]=~~m.g,t[p+2]=~~m.b;return t}})}(t),function(t){var r=t._notSupportClamp,n=t.Array32F;t.GrayscaleHistogramEqualizeFilter=t.Create({name:"GrayscaleHistogramEqualizeFilter",apply:function(t){var e,a,i,o,l,u=0,s=255,h=0,f=t.length,c=f>>2,p=1/c;for(o=new n(256),l=0;256>l;l+=4)o[l]=0,o[l+1]=0,o[l+2]=0,o[l+3]=0;for(l=0;f>l;l+=4)e=t[l],o[e]+=p,e>u?u=e:s>e&&(s=e);for(h=0,l=0;256>l;l+=4)h+=o[l],o[l]=h,h+=o[l+1],o[l+1]=h,h+=o[l+2],o[l+2]=h,h+=o[l+3],o[l+3]=h;if(i=u-s,r)for(l=0;f>l;l+=4)e=t[l],a=o[e]*i+s,a=0>a?0:a>255?255:a,a=~~a,t[l]=a,t[l+1]=a,t[l+2]=a;else for(l=0;f>l;l+=4)e=t[l],a=~~(o[e]*i+s),t[l]=a,t[l+1]=a,t[l+2]=a;return t}})}(t),function(t){var r=t._notSupportClamp,n=t.Array32F;t.RGBHistogramEqualizeFilter=t.Create({name:"RGBHistogramEqualizeFilter",apply:function(t){var e,a,i,o,l,u,s,h,f,c,p,g,m,d,v,C,y=0,b=0,F=0,M=255,x=255,S=255,_=t.length,A=_>>2,E=1/A;for(s=new n(256),h=new n(256),f=new n(256),C=0;256>C;C+=4)s[C]=0,h[C]=0,f[C]=0,s[C+1]=0,h[C+1]=0,f[C+1]=0,s[C+2]=0,h[C+2]=0,f[C+2]=0,s[C+3]=0,h[C+3]=0,f[C+3]=0;for(C=0;_>C;C+=4)e=t[C],a=t[C+1],i=t[C+2],s[e]+=E,h[a]+=E,f[i]+=E,e>y?y=e:M>e&&(M=e),a>b?b=a:x>a&&(x=a),i>F?F=i:S>i&&(S=i);for(c=p=g=0,C=0;256>C;C+=4)c+=s[C],s[C]=c,p+=h[C],h[C]=p,g+=f[C],f[C]=g,c+=s[C+1],s[C+1]=c,p+=h[C+1],h[C+1]=p,g+=f[C+1],f[C+1]=g,c+=s[C+2],s[C+2]=c,p+=h[C+2],h[C+2]=p,g+=f[C+2],f[C+2]=g,c+=s[C+3],s[C+3]=c,p+=h[C+3],h[C+3]=p,g+=f[C+3],f[C+3]=g;if(o=y-M,l=b-x,u=F-S,r)for(C=0;_>C;C+=4)e=t[C],a=t[C+1],i=t[C+2],m=s[e]*o+M,d=h[a]*l+x,v=f[i]*u+S,m=0>m?0:m>255?255:m,d=0>d?0:d>255?255:d,v=0>v?0:v>255?255:v,t[C]=~~m,t[C+1]=~~d,t[C+2]=~~v;else for(C=0;_>C;C+=4)e=t[C],a=t[C+1],i=t[C+2],m=s[e]*o+M,d=h[a]*l+x,v=f[i]*u+S,t[C]=~~m,t[C+1]=~~d,t[C+2]=~~v;return t}})}(t),function(t){var r=Math.sqrt,n=t._notSupportClamp,e=t.Array32F;t.PixelateFilter=t.Create({scale:1,name:"PixelateFilter",init:function(t){this.scale=t||1},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var o,l,u,s,h,f,c,p,g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R,Y,k,G,X,N,z,L,P,T,V,D,U,j,Q,J,K,O,W,Z=t.length,$=Z>>2,tr=(a<<1)+a;for(o=~~(.01*r($)*this.scale),l=a*o,u=i%o,s=a%o,h=(u-1)*a,g=1/(o*o),m=1/(s*o),d=1/(u*o),v=1/(s*u),C=g,y=m,b=d,F=v,A=o-1,E=(o-1)*a,P=0,V=a-1,T=0,D=$-a,M=new e(3*$),H=0,w=0,q=0,x=S=_=0,q=0;a>q;q++,H+=4,w+=3)x+=t[H],S+=t[H+1],_+=t[H+2],M[w]=x,M[w+1]=S,M[w+2]=_;for(w=0,q=0,x=S=_=0,H=tr+a;Z>H;H+=4,w+=3,q++)q>=a&&(q=0,x=S=_=0),x+=t[H],S+=t[H+1],_+=t[H+2],M[w+tr]=M[w]+x,M[w+tr+1]=M[w+1]+S,M[w+tr+2]=M[w+2]+_;for(q=0,B=0,I=0,X=q,N=I,z=X+A,L=N+E,z=z>V?V:z,L=L>D?D:L,U=X+N,J=z+L,j=z+N,Q=X+L,U=(U<<1)+U,j=(j<<1)+j,Q=(Q<<1)+Q,J=(J<<1)+J,p=C,K=p*(M[J]-M[j]-M[Q]+M[U]),O=p*(M[J+1]-M[j+1]-M[Q+1]+M[U+1]),W=p*(M[J+2]-M[j+2]-M[Q+2]+M[U+2]),n&&(K=0>K?0:K>255?255:K,O=0>O?0:O>255?255:O,W=0>W?0:W>255?255:W),K=~~K,O=~~O,W=~~W,R=0,Y=0,k=0,H=0;Z>H;H+=4)G=R+q+k+I<<2,t[G]=K,t[G+1]=O,t[G+2]=W,R++,(R+q>=a||R>=o)&&(R=0,Y++,k+=a),(Y+B>=i||Y>=o)&&(q+=o,q>=a&&(q=0,B+=o,I+=l),R=0,Y=0,k=0,X=q,N=I,z=X+A,L=N+E,z=z>V?V:z,L=L>D?D:L,U=X+N,J=z+L,j=z+N,Q=X+L,U=(U<<1)+U,j=(j<<1)+j,Q=(Q<<1)+Q,J=(J<<1)+J,f=0==z-X-s+1,c=0==L-N-h,p=f&&c?F:f?y:c?b:C,K=p*(M[J]-M[j]-M[Q]+M[U]),O=p*(M[J+1]-M[j+1]-M[Q+1]+M[U+1]),W=p*(M[J+2]-M[j+2]-M[Q+2]+M[U+2]),n&&(K=0>K?0:K>255?255:K,O=0>O?0:O>255?255:O,W=0>W?0:W>255?255:W),K=~~K,O=~~O,W=~~W);return t}})}(t),function(t){var r=Math.sqrt,n=(Math.SQRT2,Math.min,t._notSupportClamp),e=t.Array32F;t.TriangularPixelateFilter=t.Create({scale:1,name:"TriangularPixelateFilter",init:function(t){this.scale=t||1},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var o,l,u,s,h,f,c,p,g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R,Y,k,G,X,N,z,L,P,T,V,D,U,j,Q,J,K,O,W,Z,$,tr,rr,nr,er,ar,ir,or=t.length,lr=or>>2,ur=(a<<1)+a;for(o=~~(.01*r(lr)*this.scale),l=o>>1,u=o-1,s=a*o,h=i%o,f=a%o,c=(h-1)*a,d=1/(o*o),v=1/(f*o),C=1/(h*o),y=1/(f*h),b=2*d,F=2*v,M=2*C,x=2*y,H=u,w=u*a,V=0,U=a-1,D=0,j=lr-a,S=new e(3*lr),q=0,B=0,I=0,_=A=E=0,I=0;a>I;I++,q+=4,B+=3)_+=t[q],A+=t[q+1],E+=t[q+2],S[B]=_,S[B+1]=A,S[B+2]=E;for(B=0,I=0,_=A=E=0,q=ur+a;or>q;q+=4,B+=3,I++)I>=a&&(I=0,_=A=E=0),_+=t[q],A+=t[q+1],E+=t[q+2],S[B+ur]=S[B]+_,S[B+ur+1]=S[B+1]+A,S[B+ur+2]=S[B+2]+E;for(I=0,R=0,Y=0,z=I,L=Y,P=I-l+H,T=Y+w,P=P>U?U:P,T=T>j?j:T,Q=z+L,O=P+T,J=P+L,K=z+T,Q=(Q<<1)+Q,J=(J<<1)+J,K=(K<<1)+K,O=(O<<1)+O,m=b,tr=m*(S[O]-S[J]-S[K]+S[Q]),rr=m*(S[O+1]-S[J+1]-S[K+1]+S[Q+1]),nr=m*(S[O+2]-S[J+2]-S[K+2]+S[Q+2]),z=I+l,P=I+H,P=P>U?U:P,Q=z+L,O=P+T,J=P+L,K=z+T,Q=(Q<<1)+Q,J=(J<<1)+J,K=(K<<1)+K,O=(O<<1)+O,er=m*(S[O]-S[J]-S[K]+S[Q]),ar=m*(S[O+1]-S[J+1]-S[K+1]+S[Q+1]),ir=m*(S[O+2]-S[J+2]-S[K+2]+S[Q+2]),n&&(tr=0>tr?0:tr>255?255:tr,rr=0>rr?0:rr>255?255:rr,nr=0>nr?0:nr>255?255:nr,er=0>er?0:er>255?255:er,ar=0>ar?0:ar>255?255:ar,ir=0>ir?0:ir>255?255:ir),tr=~~tr,rr=~~rr,nr=~~nr,er=~~er,ar=~~ar,ir=~~ir,W=tr,Z=rr,$=nr,k=0,G=0,X=0,q=0;or>q;q+=4)N=k+I+X+Y<<2,t[N]=W,t[N+1]=Z,t[N+2]=$,k++,(k+I>=a||k>=o)&&(k=0,G++,X+=a,W=tr,Z=rr,$=nr),k>u-G&&(W=er,Z=ar,$=ir),(G+R>=i||G>=o)&&(I+=o,I>=a&&(I=0,R+=o,Y+=s),k=0,G=0,X=0,z=I,L=Y,P=I-l+H,T=Y+w,P=P>U?U:P,T=T>j?j:T,Q=z+L,O=P+T,J=P+L,K=z+T,Q=(Q<<1)+Q,J=(J<<1)+J,K=(K<<1)+K,O=(O<<1)+O,p=0==P-z+l-f+1,g=0==T-L-c,m=p&&g?x:p?F:g?M:b,tr=m*(S[O]-S[J]-S[K]+S[Q]),rr=m*(S[O+1]-S[J+1]-S[K+1]+S[Q+1]),nr=m*(S[O+2]-S[J+2]-S[K+2]+S[Q+2]),z=I+l,P=I+H,P=P>U?U:P,Q=z+L,O=P+T,J=P+L,K=z+T,Q=(Q<<1)+Q,J=(J<<1)+J,K=(K<<1)+K,O=(O<<1)+O,p=0==P-z+l-f+1,m=p&&g?x:p?F:g?M:b,er=m*(S[O]-S[J]-S[K]+S[Q]),ar=m*(S[O+1]-S[J+1]-S[K+1]+S[Q+1]),ir=m*(S[O+2]-S[J+2]-S[K+2]+S[Q+2]),n&&(tr=0>tr?0:tr>255?255:tr,rr=0>rr?0:rr>255?255:rr,nr=0>nr?0:nr>255?255:nr,er=0>er?0:er>255?255:er,ar=0>ar?0:ar>255?255:ar,ir=0>ir?0:ir>255?255:ir),tr=~~tr,rr=~~rr,nr=~~nr,er=~~er,ar=~~ar,ir=~~ir,W=tr,Z=rr,$=nr);return t}})}(t),function(t){var r=t._notSupportClamp,n=t.Color.RGB2HSV,e=.7083333333333334;t.HSVConverterFilter=t.Create({name:"HSVConverterFilter",apply:function(t){var a,i,o,l,u,s,h,f,c=t.length;if(r)for(l=0;c>l;l+=4)a=t[l],i=t[l+1],o=t[l+2],u=n({r:a,g:i,b:o}),s=u.h*e,f=255*u.s,h=u.v,0>s?s=0:s>255&&(s=255),0>h?h=0:h>255&&(h=255),0>f?f=0:f>255&&(f=255),t[l]=~~s,t[l+1]=~~h,t[l+2]=~~f;else for(l=0;c>l;l+=4)a=t[l],i=t[l+1],o=t[l+2],u=n({r:a,g:i,b:o}),s=u.h*e,f=255*u.s,h=u.v,t[l]=~~s,t[l+1]=~~h,t[l+2]=~~f;return t}})}(t),function(t){var r=(t._notSupportClamp,t.ImArray,t.Color.clampPixel),n=t.Color.RGB2HSV,e=(t.Color.HSV2RGB,t.Color.Color2RGBA);t.HueExtractorFilter=t.Create({range:null,background:0,name:"HueExtractorFilter",init:function(t,r){this.range=t,this.background=r||0},apply:function(t){if(!this.range||!this.range.length)return t;var a,i,o,l,u,s,h,f,c,p,g=t.length,m=this.range[0],d=this.range[this.range.length-1];for(c=e(this.background||0),l=~~r(c.r),u=~~r(c.g),s=~~r(c.b),h=~~r(c.a),f=0;g>f;f+=4)a=t[f],i=t[f+1],o=t[f+2],p=n({r:a,g:i,b:o}).h,(m>p||p>d)&&(t[f]=l,t[f+1]=u,t[f+2]=s,t[f+3]=h);return t}})}(t),function(t){var r=(t._notSupportClamp,Math.min),n=Math.floor,e=t.CHANNEL.RED;t.CHANNEL.GREEN,t.CHANNEL.BLUE,t.CHANNEL.ALPHA,t.ChannelCopyFilter=t.Create({srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,name:"ChannelCopyFilter",init:function(t,r,n,a,i){this.srcImg=t||null,this.srcChannel=r||e,this.dstChannel=n||e,this.centerX=a||0,this.centerY=i||0},apply:function(t,e,a){if(!this.srcImg)return t;var i,o,l,u,s,h,f=this.srcImg.getData(),c=t.length,p=(f.length,this.srcImg.width),g=this.srcImg.height,m=this.srcChannel,d=this.dstChannel,v=r(e,p),C=r(a,g),y=this.centerX||0,b=this.centerY||0,F=p>>1,M=g>>1;for(y=n(y*(e-1))-F,b=n(b*(a-1))-M,i=0,o=0,l=0,i=0;c>i;i+=4,o++)o>=e&&(o=0,l++),s=o-y,h=l-b,s>=0&&v>s&&h>=0&&C>h&&(u=s+h*p<<2,t[i+d]=f[u+m]);return t}})}(t),function(t){var r=(t._notSupportClamp,Math.min),n=Math.floor;t.AlphaMaskFilter=t.Create({alphaMask:null,centerX:0,centerY:0,name:"AlphaMaskFilter",init:function(t,r,n){this.alphaMask=t||null,this.centerX=r||0,this.centerY=n||0},apply:function(t,e,a){if(!this.alphaMask)return t;var i,o,l,u,s,h,f=this.alphaMask.getData(),c=this.alphaMask.width,p=this.alphaMask.height,g=t.length,m=(f.length,r(e,c)),d=r(a,p),v=this.centerX||0,C=this.centerY||0,y=c>>1,b=p>>1;for(v=n(v*(e-1))-y,C=n(C*(a-1))-b,o=0,l=0,i=0;g>i;i+=4,o++)o>=e&&(o=0,l++),s=o-v,h=l-C,s>=0&&m>s&&h>=0&&d>h?(u=s+h*c<<2,t[i+3]=f[u+3]):t[i+3]=0;return t}})}(t),function(t,r){var n,e=Math.min,a=Math.max,i=Math.round,o=(Math.floor,Math.abs),l=t._notSupportClamp;t.BlendFilter=t.Create({_blendMode:null,blendImage:null,startX:0,startY:0,amount:1,name:"BlendFilter",init:function(t,r,n){this.startX=0,this.startY=0,this.amount=1,this.blendImage=t||null,this._blendMode=null,r&&this.mode(r,n)},image:function(t){return this.blendImage=t||null,this},mode:function(t,i){return this._blendMode=n[(""+t).toLowerCase()]||null,this.amount=a(0,e(1,r===i?1:i)),this},reset:function(){return this.startX=0,this.startY=0,this.amount=1,this._blendMode=null,this},apply:function(t,r,n){if(!this._blendMode||!this.blendImage)return t;var a,o,l,u,s,h=this.startX||0,f=this.startY||0,c=0,p=0,g=this.blendImage,m=this.amount||1;return u=g.width,s=g.height,0>h&&(c=-h,h=0),0>f&&(p=-f,f=0),h>=r||f>=n?t:c>=u||p>=s?t:(h=i(h),f=i(f),c=i(c),p=i(p),a=e(r-h,u-c),o=e(n-f,s-p),0>=a||0>=o?t:(l=g.getData(),this._blendMode(t,r,n,l,u,s,h,f,c,p,a,o,m)))}}),n={normal:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],q=E,B=H,I=w,S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},lighten:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],q=S>E?S:E,B=_>H?_:H,I=A>w?A:w,S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},darken:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],q=S>E?E:S,B=_>H?H:_,I=A>w?w:A,S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},multiply:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],q=.003921568627451*S*E,B=.003921568627451*_*H,I=.003921568627451*A*w,S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},average:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],q=.5*(S+E),B=.5*(_+H),I=.5*(A+w),S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},add:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],q=S+E,B=_+H,I=A+w,S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},subtract:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],q=255>S+E?0:S+E-255,B=255>_+H?0:_+H-255,I=255>A+w?0:A+w-255,S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},difference:function(t,r,n,e,a,i,u,s,h,f,c,p,g){var m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R,Y;for(Y=1-g,F=u,M=s*r,x=h,S=f*a,m=u+c,d=h+c,v=0,C=p*c;C>v;)y=F+M<<2,b=x+S<<2,_=t[y],A=t[y+1],E=t[y+2],H=e[b],w=e[b+1],q=e[b+2],B=o(H-_),I=o(w-A),R=o(q-E),_=B*g+_*Y,A=I*g+A*Y,E=R*g+E*Y,l&&(_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A,E=0>E?0:E>255?255:E),t[y]=~~_,t[y+1]=~~A,t[y+2]=~~E,v++,F++,F>=m&&(F=u,M+=r),x++,x>=d&&(x=h,S+=a);return t},negation:function(t,r,n,e,a,i,u,s,h,f,c,p,g){var m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R,Y;for(Y=1-g,F=u,M=s*r,x=h,S=f*a,m=u+c,d=h+c,v=0,C=p*c;C>v;)y=F+M<<2,b=x+S<<2,_=t[y],A=t[y+1],E=t[y+2],H=e[b],w=e[b+1],q=e[b+2],B=255-o(255-H-_),I=255-o(255-w-A),R=255-o(255-q-E),_=B*g+_*Y,A=I*g+A*Y,E=R*g+E*Y,l&&(_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A,E=0>E?0:E>255?255:E),t[y]=~~_,t[y+1]=~~A,t[y+2]=~~E,v++,F++,F>=m&&(F=u,M+=r),x++,x>=d&&(x=h,S+=a);return t},screen:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],q=255-((255-E)*(255-S)>>8),B=255-((255-H)*(255-_)>>8),I=255-((255-w)*(255-A)>>8),S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},exclusion:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],q=E+S-.003921568627451*2*E*S,B=H+_-.003921568627451*2*H*_,I=w+A-.003921568627451*2*w*A,S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},overlay:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],q=128>S?.003921568627451*2*E*S:255-.003921568627451*2*(255-E)*(255-S),B=128>_?.003921568627451*2*H*_:255-.003921568627451*2*(255-H)*(255-_),q=128>A?.003921568627451*2*w*A:255-.003921568627451*2*(255-w)*(255-A),S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},softlight:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],q=128>S?2*((E>>1)+64)*.003921568627451*S:255-.003921568627451*2*(255-((E>>1)+64))*(255-S),B=128>_?2*((H>>1)+64)*.003921568627451*_:255-.003921568627451*2*(255-((H>>1)+64))*(255-_),I=128>A?2*((w>>1)+64)*.003921568627451*A:255-.003921568627451*2*(255-((w>>1)+64))*(255-A),S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},hardlight:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;for(R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],q=128>E?.003921568627451*2*S*E:255-.003921568627451*2*(255-S)*(255-E),B=128>H?.003921568627451*2*_*H:255-.003921568627451*2*(255-_)*(255-H),I=128>w?.003921568627451*2*A*w:255-.003921568627451*2*(255-A)*(255-w),S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},colordodge:function(t,r,n,a,i,o,u,s,h,f,c,p,g){var m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R,Y;for(Y=1-g,F=u,M=s*r,x=h,S=f*i,m=u+c,d=h+c,v=0,C=p*c;C>v;)y=F+M<<2,b=x+S<<2,_=t[y],A=t[y+1],E=t[y+2],H=a[b],w=a[b+1],q=a[b+2],B=255==_?_:e(255,(H<<8)/(255-_)),I=255==A?A:e(255,(w<<8)/(255-A)),R=255==E?_:e(255,(q<<8)/(255-E)),_=B*g+_*Y,A=I*g+A*Y,E=R*g+E*Y,l&&(_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A,E=0>E?0:E>255?255:E),t[y]=~~_,t[y+1]=~~A,t[y+2]=~~E,v++,F++,F>=m&&(F=u,M+=r),x++,x>=d&&(x=h,S+=i);return t},colorburn:function(t,r,n,e,i,o,u,s,h,f,c,p,g){var m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R,Y;for(Y=1-g,F=u,M=s*r,x=h,S=f*i,m=u+c,d=h+c,v=0,C=p*c;C>v;)y=F+M<<2,b=x+S<<2,_=t[y],A=t[y+1],E=t[y+2],H=e[b],w=e[b+1],q=e[b+2],B=0==_?_:a(0,255-(255-H<<8)/_),I=0==A?A:a(0,255-(255-w<<8)/A),R=0==E?E:a(0,255-(255-q<<8)/E),_=B*g+_*Y,A=I*g+A*Y,E=R*g+E*Y,l&&(_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A,E=0>E?0:E>255?255:E),t[y]=~~_,t[y+1]=~~A,t[y+2]=~~E,v++,F++,F>=m&&(F=u,M+=r),x++,x>=d&&(x=h,S+=i);return t},linearlight:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;for(var Y;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],128>S?(Y=2*S,q=255>Y+E?0:Y+E-255):(Y=2*(S-128),q=Y+E),128>_?(Y=2*_,B=255>Y+H?0:Y+H-255):(Y=2*(_-128),B=Y+H),128>A?(Y=2*A,I=255>Y+w?0:Y+w-255):(Y=2*(A-128),I=Y+w),S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},reflect:function(t,r,n,a,i,o,u,s,h,f,c,p,g){var m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R,Y;for(Y=1-g,F=u,M=s*r,x=h,S=f*i,m=u+c,d=h+c,v=0,C=p*c;C>v;)y=F+M<<2,b=x+S<<2,_=t[y],A=t[y+1],E=t[y+2],H=a[b],w=a[b+1],q=a[b+2],B=255==_?_:e(255,H*H/(255-_)),I=255==A?A:e(255,w*w/(255-A)),R=255==E?E:e(255,q*q/(255-E)),_=B*g+_*Y,A=I*g+A*Y,E=R*g+E*Y,l&&(_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A,E=0>E?0:E>255?255:E),t[y]=~~_,t[y+1]=~~A,t[y+2]=~~E,v++,F++,F>=m&&(F=u,M+=r),x++,x>=d&&(x=h,S+=i);return t},glow:function(t,r,n,a,i,o,u,s,h,f,c,p,g){var m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R,Y;for(Y=1-g,F=u,M=s*r,x=h,S=f*i,m=u+c,d=h+c,v=0,C=p*c;C>v;)y=F+M<<2,b=x+S<<2,_=t[y],A=t[y+1],E=t[y+2],H=a[b],w=a[b+1],q=a[b+2],B=255==H?H:e(255,_*_/(255-H)),I=255==w?w:e(255,A*A/(255-w)),R=255==q?q:e(255,E*E/(255-q)),_=B*g+_*Y,A=I*g+A*Y,E=R*g+E*Y,l&&(_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A,E=0>E?0:E>255?255:E),t[y]=~~_,t[y+1]=~~A,t[y+2]=~~E,v++,F++,F>=m&&(F=u,M+=r),x++,x>=d&&(x=h,S+=i);return t},phoenix:function(t,r,n,i,o,u,s,h,f,c,p,g,m){var d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R,Y,k;for(k=1-m,M=s,x=h*r,S=f,_=c*o,d=s+p,v=f+p,C=0,y=g*p;y>C;)b=M+x<<2,F=S+_<<2,A=t[b],E=t[b+1],H=t[b+2],w=i[F],q=i[F+1],B=i[F+2],I=e(w,A)-a(w,A)+255,R=e(q,E)-a(q,E)+255,Y=e(B,H)-a(B,H)+255,A=I*m+A*k,E=R*m+E*k,H=Y*m+H*k,l&&(A=0>A?0:A>255?255:A,E=0>E?0:E>255?255:E,H=0>H?0:H>255?255:H),t[b]=~~A,t[b+1]=~~E,t[b+2]=~~H,C++,M++,M>=d&&(M=s,x+=r),S++,S>=v&&(S=f,_+=o);return t},vividlight:function(t,r,n,i,o,u,s,h,f,c,p,g,m){var d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R,Y,k;k=1-m,M=s,x=h*r,S=f,_=c*o,d=s+p,v=f+p,C=0,y=g*p;for(var G;y>C;)b=M+x<<2,F=S+_<<2,A=t[b],E=t[b+1],H=t[b+2],w=i[F],q=i[F+1],B=i[F+2],128>A?(G=2*A,I=0==G?G:a(0,255-(255-w<<8)/G)):(G=2*(A-128),I=255==G?G:e(255,(w<<8)/(255-G))),128>E?(G=2*E,R=0==G?G:a(0,255-(255-q<<8)/G)):(G=2*(E-128),R=255==G?G:e(255,(q<<8)/(255-G))),128>H?(G=2*H,Y=0==G?G:a(0,255-(255-B<<8)/G)):(G=2*(E-128),Y=255==G?G:e(255,(B<<8)/(255-G))),A=I*m+A*k,E=R*m+E*k,H=Y*m+H*k,l&&(A=0>A?0:A>255?255:A,E=0>E?0:E>255?255:E,H=0>H?0:H>255?255:H),t[b]=~~A,t[b+1]=~~E,t[b+2]=~~H,C++,M++,M>=d&&(M=s,x+=r),S++,S>=v&&(S=f,_+=o);return t},pinlight:function(t,r,n,e,a,i,o,u,s,h,f,c,p){var g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R;R=1-p,b=o,F=u*r,M=s,x=h*a,g=o+f,m=s+f,d=0,v=c*f;for(var Y;v>d;)C=b+F<<2,y=M+x<<2,S=t[C],_=t[C+1],A=t[C+2],E=e[y],H=e[y+1],w=e[y+2],128>S?(Y=2*S,q=Y>E?Y:E):(Y=2*(S-128),q=Y>E?E:Y),128>_?(Y=2*_,B=Y>H?Y:H):(Y=2*(S-128),B=Y>H?H:Y),128>A?(Y=2*A,I=Y>w?Y:w):(Y=2*(A-128),I=Y>w?w:Y),S=q*p+S*R,_=B*p+_*R,A=I*p+A*R,l&&(S=0>S?0:S>255?255:S,_=0>_?0:_>255?255:_,A=0>A?0:A>255?255:A),t[C]=~~S,t[C+1]=~~_,t[C+2]=~~A,d++,b++,b>=g&&(b=o,F+=r),M++,M>=m&&(M=s,x+=a);return t},hardmix:function(t,r,n,i,o,u,s,h,f,c,p,g,m){var d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R,Y,k;k=1-m,M=s,x=h*r,S=f,_=c*o,d=s+p,v=f+p,C=0,y=g*p;for(var G;y>C;)b=M+x<<2,F=S+_<<2,A=t[b],E=t[b+1],H=t[b+2],w=i[F],q=i[F+1],B=i[F+2],128>A?(G=2*A,I=0==G?G:a(0,255-(255-w<<8)/G)):(G=2*(A-128),I=255==G?G:e(255,(w<<8)/(255-G))),I=128>I?0:255,128>E?(G=2*E,R=0==G?G:a(0,255-(255-q<<8)/G)):(G=2*(E-128),R=255==G?G:e(255,(q<<8)/(255-G))),R=128>R?0:255,128>H?(G=2*H,Y=0==G?G:a(0,255-(255-B<<8)/G)):(G=2*(H-128),Y=255==G?G:e(255,(B<<8)/(255-G))),Y=128>Y?0:255,A=I*m+A*k,E=R*m+E*k,H=Y*m+H*k,l&&(A=0>A?0:A>255?255:A,E=0>E?0:E>255?255:E,H=0>H?0:H>255?255:H),t[b]=~~A,t[b+1]=~~E,t[b+2]=~~H,C++,M++,M>=d&&(M=s,x+=r),S++,S>=v&&(S=f,_+=o);return t}},n.lineardodge=n.add,n.linearburn=n.subtract}(t),function(t){var r=(t._notSupportClamp,t.Color.RGBA2Color),n=t.Color.Color2RGBA;t.ThresholdFilter=t.Create({thresholds:null,quantizedColors:null,name:"ThresholdFilter",init:function(t,r){this.thresholds=t,this.quantizedColors=r||null},apply:function(t){if(!this.thresholds||!this.thresholds.length)return t;if(!this.quantizedColors||!this.quantizedColors.length)return t;var e,a,i,o,l,u,s,h,f=t.length,c=this.thresholds,p=c.length,g=this.quantizedColors,m=g.length;for(s=0;f>s;s+=4){for(l=r({r:t[s],g:t[s+1],b:t[s+2],a:t[s+3]}),h=0;p>h&&l>c[h];)h++;l=m>h?g[h]:255,u=n(l),e=u.r,a=u.g,i=u.b,o=u.a,t[s]=e,t[s+1]=a,t[s+2]=i,t[s+3]=o}return t}})}(t),function(t){var r=(Math.sqrt,Math.exp,Math.log),n=Math.abs,e=Math.floor,a=t._notSupportClamp,i=t.Array32F;t.BokehFilter=t.Create({centerX:0,centerY:0,radius:10,amount:10,name:"BokehFilter",init:function(t,r,n,e){this.centerX=t||0,this.centerY=r||0,this.radius=n||10,this.amount=e||10},apply:function(t,o,l){var u,s,h,f,c,p,g,m,d,v,C,y,b,F,M,x,S,_,A,E,H,w,q,B,I,R,Y,k,G,X,N,z,L,P=t.length,T=this.centerX||0,V=this.centerY||0,D=this.radius,U=this.amount;if(0>=U)return t;for(u=P>>2,X=0,N=o-1,z=0,L=u-o,T=e(T*(o-1)),V=e(V*(l-1)),h=(u<<1)+u,g=(o<<1)+o,s=new i(h),m=0,d=0,v=0,f=c=p=0,v=0;o>v;v++,m+=4,d+=3)f+=t[m],c+=t[m+1],p+=t[m+2],s[d]=f,s[d+1]=c,s[d+2]=p;for(m=g+o,d=0,v=0,f=c=p=0,m=g+o;P>m;m+=4,d+=3,v++)v>=o&&(v=0,f=c=p=0),f+=t[m],c+=t[m+1],p+=t[m+2],s[d+g]=s[d]+f,s[d+g+1]=s[d+1]+c,s[d+g+2]=s[d+2]+p;for(v=0,C=0,y=0,m=0;P>m;m+=4,v++)v>=o&&(v=0,C++,y+=o),F=v-T,M=C-V,b=n(F)+n(M),x=b>D?~~r((b-D)*U):~~(b/D+.5),x>0&&(S=x*o,_=.25/(x*x),A=v-x,E=y-S,H=v+x,w=y+S,X>A?A=X:H>N&&(H=N),z>E?E=z:w>L&&(w=L),q=A+E,R=H+w,B=H+E,I=A+w,q=(q<<1)+q,B=(B<<1)+B,I=(I<<1)+I,R=(R<<1)+R,Y=_*(s[R]-s[B]-s[I]+s[q]),k=_*(s[R+1]-s[B+1]-s[I+1]+s[q+1]),G=_*(s[R+2]-s[B+2]-s[I+2]+s[q+2]),a&&(Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k,G=0>G?0:G>255?255:G),t[m]=~~Y,t[m+1]=~~k,t[m+2]=~~G);return t}})}(t),r});