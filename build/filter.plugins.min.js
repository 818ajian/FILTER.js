/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
* 
* PLUGINS Package  (needs BASIC package)
*
* @version 0.6.1
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/(function(f){f.NoiseFilter=f.Create({min:-127,max:127,init:function(b,a){this.min=b||-127;this.max=a||127},apply:function(b){var a=this.max-this.min,d=Math.random,i=this.min,e,c=b.length,f,p,l,g;for(e=0;e<c;)p=b[e],l=b[e+1],g=b[e+2],f=a*d()+i,b[e]=p+f,b[e+1]=l+f,b[e+2]=g+f,e+=4;return b}})})(FILTER);
(function(f){f.HistogramEqualizeFilter=f.Create({apply:function(b){var a,d,i,e;e=0;var c=255,k=new f.Array32F(256),p=new f.Array32F(256),l=0,g,j=b.length;g=j>>2;var q=1/g,o=Array(g),m=f.Color.RGB2YCbCr,s=f.Color.YCbCr2RGB;for(g=0;g<256;)k[g]=0,p[g]=0,g++;for(l=g=0;g<j;){a=b[g];d=b[g+1];i=b[g+2];a=m({r:a,g:d,b:i});k[a.y]+=q;if(a.y>e)e=a.y;if(a.y<c)c=a.y;o[l]=a;g+=4;l++}for(g=l=0;g<256;)l+=k[g],p[g]=l,g++;e-=c;for(l=g=0;g<j;)a=o[l],a.y=p[a.y]*e+c,k=s(a),b[g]=k.r,b[g+1]=k.g,b[g+2]=k.b,g+=4,l++;return b}})})(FILTER);
(function(f){f.RGBHistogramEqualizeFilter=f.Create({apply:function(b){var a,d,i,e,c,k;k=c=e=0;var p=255,l=255,g=255,j=new f.Array32F(256),q=new f.Array32F(256),o=new f.Array32F(256),m=new f.Array32F(256),s=new f.Array32F(256),v=new f.Array32F(256),h,n=b.length,r=1/(n>>2);for(h=0;h<256;)j[h]=0,q[h]=0,o[h]=0,m[h]=0,s[h]=0,v[h]=0,h++;for(h=0;h<n;)a=b[h],d=b[h+1],i=b[h+2],j[a]+=r,q[d]+=r,o[i]+=r,a>e&&(e=a),a<p&&(p=a),d>c&&(c=d),d<l&&(l=d),i>k&&(k=i),i<g&&(g=i),h+=4;for(h=a=d=i=0;h<256;)a+=j[h],m[h]=a,
d+=q[h],s[h]=d,i+=o[h],v[h]=i,h++;e-=p;c-=l;k-=g;for(h=0;h<n;)a=b[h],d=b[h+1],i=b[h+2],b[h]=m[a]*e+p,b[h+1]=s[d]*c+l,b[h+2]=v[i]*k+g,h+=4;return b}})})(FILTER);
(function(f){var b=Math.sqrt;f.PixelateFilter=f.Create({scale:1,init:function(a){this.scale=a||1},apply:function(a,d,i){if(this.scale<=1)return a;if(this.scale>100)this.scale=100;var e=a.length,c=d*i,i=~~(b(c)*this.scale*0.01),k=i*i,p=1/k,l=i<<2,g=d*i;k<<=2;var j=new f.Array32F(c*3),q,o,m,s=(d<<1)+d,v,h,n,r,t,u,w,A,y,z,x;v=i-1;h=(i-1)*d;y=d-1;z=c-d;for(q=o=m=r=n=c=0;r<d;)q+=a[c],o+=a[c+1],m+=a[c+2],j[n]=q,j[n+1]=o,j[n+2]=m,c+=4,n+=3,r++;c=s+d;n=s;for(q=o=m=r=0;c<e;)q+=a[c],o+=a[c+1],m+=a[c+2],j[n]=
j[n-s]+q,j[n+1]=j[n-s+1]+o,j[n+2]=j[n-s+2]+m,c+=4,n+=3,r++,r>=d&&(q=o=m=r=0);for(s=r=c=0;c<e;){q=r;t=s;u=r+v;o=s+h;u>y&&(u=y);o>z&&(o=z);n=q+t;m=u+o;t=u+t;u=q+o;n=(n<<1)+n;t=(t<<1)+t;u=(u<<1)+u;m=(m<<1)+m;q=p*(j[m]-j[t]-j[u]+j[n]);o=p*(j[m+1]-j[t+1]-j[u+1]+j[n+1]);x=p*(j[m+2]-j[t+2]-j[u+2]+j[n+2]);q=~~q;o=~~o;x=~~x;n=c;t=r;u=s;A=r+i;m=c+k;for(m>e&&(m=e);n<m;)if(w=t+u<<2,a[w]=q,a[w+1]=o,a[w+2]=x,n+=4,t++,t>=d||t>=A)t=r,u+=d;c+=l;r+=i;r>=d&&(r=0,s+=g)}return a}})})(FILTER);
(function(f){f.HSVConverterFilter=f.Create({apply:function(b,a,d){for(var i,e,c=b.length,k=f.Color.RGB2HSV,a=0;a<c;)d=b[a],i=b[a+1],e=b[a+2],e=k({r:d,g:i,b:e}),d=e.h*0.7083333333333334,i=e.s*255,e=e.v,b[a]=d,b[a+1]=e,b[a+2]=i,a+=4;return b}})})(FILTER);
(function(f){f.HueExtractorFilter=f.Create({range:null,background:0,init:function(b,a){this.range=b;this.range.sort();this.background=a||0},apply:function(b){if(!this.range||!this.range.length)return b;var a,d,i,e,c,k=b.length,p,l=f.Color.RGB2HSV,g=this.range[0],j=this.range[this.range.length-1];e=new f.ImArray(k);p=f.Color.Color2RGBA(this.background||0);for(c=0;c<k;)a=b[c],d=b[c+1],i=b[c+2],a=l({r:a,g:d,b:i}).h,a>=g&&a<=j?(e[c]=b[c],e[c+1]=b[c+1],e[c+2]=b[c+2],e[c+3]=b[c+3]):(e[c]=p.r,e[c+1]=p.g,
e[c+2]=p.b,e[c+3]=p.a),c+=4;return e}})})(FILTER);
(function(f){f.AlphaMaskFilter=f.Create({alphaMask:null,centerX:0,centerY:0,init:function(b,a,d){this.alphaMask=b||null;this.centerX=a||0;this.centerY=d||0},apply:function(b,a,d){if(!this.alphaMask)return b;var f=this.alphaMask.getData(),e=b.length,c=this.alphaMask.width,k=this.alphaMask.height,p,l,g,j=Math.min(a,c),q=Math.min(d,k),o,m;o=this.centerX+(a-c>>1);m=this.centerY+(d-k>>1);for(p=k=d=0;d<e;)l=k-o,g=p-m,l>=0&&l<j&&g>=0&&g<q?(l=l+g*c<<2,b[d+3]=f[l+3]):b[d+3]=0,d+=4,k++,k>=a&&(k=0,p++);return b}})})(FILTER);
