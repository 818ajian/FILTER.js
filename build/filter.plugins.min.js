/**
*
*   FILTER.js Plugins
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,n){"use strict";"object"==typeof module&&module.exports?module.exports=n.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(r,t){return n.moduleUri=r.uri,n.call(e,t),t}):(n.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(n){"use strict";var r=n.getPath(e.moduleUri);return!function(e){var n=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,n){var r=this;r.min=e||-127,r.max=n||127},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{min:e.min,max:e.max}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.min=n.min,r.max=n.max),r},apply:function(e,r,a){var i=this;if(!i._isOn)return e;var s,o,l,u,h,f,c,d,m=i.max-i.min,p=i.min,_=e.length;if(n)for(s=0;_>s;s+=4)l=e[s],u=e[s+1],h=e[s+2],o=m*t()+p,f=l+o,c=u+o,d=h+o,0>f?f=0:f>255&&(f=255),0>c?c=0:c>255&&(c=255),0>d?d=0:d>255&&(d=255),e[s]=~~f,e[s+1]=~~c,e[s+2]=~~d;else for(s=0;_>s;s+=4)l=e[s],u=e[s+1],h=e[s+2],o=m*t()+p,f=l+o,c=u+o,d=h+o,e[s]=~~f,e[s+1]=~~c,e[s+2]=~~d;return e}})}(n),!function(e){var n=e.Util.Image.perlin,t=e.MODE;e.Create({name:"PerlinNoiseFilter",_baseX:1,_baseY:1,_octaves:1,_offsets:null,_mode:t.GRAY,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:r,init:function(e,n,r,a,i,s,o,l){var u=this;u._mode=t.GRAY,u._baseX=e||1,u._baseY=n||1,u._seed=o||0,u._stitch=!!a,u._fractal=!1!==i,u._perlin=!!l,u.octaves(r||1,s)},seed:function(e){var n=this;return n._seed=e||0,n},octaves:function(e,n){var r=this;for(r._octaves=e||1,r._offsets=n?n.slice(0):[];r._offsets.length<r._octaves;)r._offsets.push([0,0]);return r},seamless:function(e){return arguments.length||(e=!0),this._stitch=!!e,this},colors:function(e){return arguments.length||(e=!0),this._mode=e?t.COLOR:t.GRAY,this},turbulence:function(e){return arguments.length||(e=!0),this._fractal=!e,this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_baseX:e._baseX,_baseY:e._baseY,_octaves:e._octaves,_offsets:e._offsets,_seed:e._seed||0,_stitch:e._stitch,_mode:e._mode,_fractal:e._fractal,_perlin:e._perlin}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r._baseX=n._baseX,r._baseY=n._baseY,r._octaves=n._octaves,r._offsets=n._offsets,r._seed=n._seed||0,r._stitch=n._stitch,r._mode=n._mode,r._fractal=n._fractal,r._perlin=n._perlin),r},apply:function(e,r,a){var i=this;return i._isOn&&n?(i._seed&&(n.seed(i._seed),i._seed=0),n(e,r,a,i._stitch,t.COLOR!==i._mode,i._baseX,i._baseY,i._octaves,i._offsets,1,.5,i._perlin)):e}})}(n),!function(e,n){var t=e.Util.Image,a=e.Util.Array.typed,i=Math.floor;e.Create({name:"GradientFilter",colors:null,stops:null,angle:0,path:r,init:function(e,n,r){var t=this;t.setColors(e,n),t.angle=r||0},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.angle=null,e.$super("dispose"),e},setColors:function(e,n){var r=this;if(e&&e.length){var a=t.colors_stops(e,n);r.colors=a[0],r.stops=a[1]}return r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{angle:e.angle,colors:e.colors,stops:e.stops}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.angle=n.angle,r.colors=a(n.colors,Array),r.stops=a(n.stops,Array)),r},apply:function(e,n,r){var a=this;return a._isOn&&a.colors?t.gradient(e,n,r,a.colors,a.stops,a.angle,t.lerp):e}}),e.Create({name:"RadialGradientFilter",colors:null,stops:null,centerX:0,centerY:0,radiusX:1,radiusY:1,init:function(e,n,r,t,a,i){var s=this;s.setColors(e,n),s.centerX=r||0,s.centerY=t||0,s.radiusX=a||1,s.radiusY=i||1},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.centerX=null,e.centerY=null,e.radiusX=null,e.radiusY=null,e.$super("dispose"),e},setColors:function(e,n){var r=this;if(e&&e.length){var a=t.colors_stops(e,n);r.colors=a[0],r.stops=a[1]}return r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radiusX:e.radiusX,radiusY:e.radiusY,colors:e.colors,stops:e.stops}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.centerX=n.centerX||0,r.centerY=n.centerY||0,r.radiusX=n.radiusX||1,r.radiusY=n.radiusY||1,r.colors=a(n.colors,Array),r.stops=a(n.stops,Array)),r},apply:function(e,n,r){var a=this;return a._isOn&&a.colors?t.radial_gradient(e,n,r,a.colors,a.stops,i((a.centerX||0)*(n-1)),i((a.centerY||0)*(r-1)),a.radiusX,a.radiusY,t.lerp):e}})}(n),!function(e){var n=Math.min,t=Math.floor,a=e.CHANNEL;e.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:a.RED,dstChannel:a.RED,path:r,init:function(e,n,r,t,i){var s=this;s._srcImg=null,s.srcImg=null,s.srcChannel=n||a.RED,s.dstChannel=r||a.RED,s.centerX=t||0,s.centerY=i||0,e&&s.setSrc(e)},dispose:function(){var e=this;return e.srcChannel=null,e.dstChannel=null,e.centerX=null,e.centerY=null,e.srcImg=null,e._srcImg=null,e.$super("dispose"),e},setSrc:function(e){var n=this;return e&&(n.srcImg=e,n._srcImg=null),n},serialize:function(){var e=this,n=e.srcImg;return{filter:e.name,_isOn:!!e._isOn,params:{_srcImg:e._srcImg||(n?{data:n.getData(),width:n.width,height:n.height}:null),centerX:e.centerX,centerY:e.centerY,srcChannel:e.srcChannel,dstChannel:e.dstChannel}}},unserialize:function(n){var r,t=this;return n&&t.name===n.filter&&(t._isOn=!!n._isOn,r=n.params,t.srcImg=null,t._srcImg=r._srcImg,t._srcImg&&(t._srcImg.data=e.Util.Array.typed(t._srcImg.data,e.ImArray)),t.centerX=r.centerX,t.centerY=r.centerY,t.srcChannel=r.srcChannel,t.dstChannel=r.dstChannel),t},apply:function(e,r,a){var i=this,s=i.srcImg;if(!i._isOn||!s&&!i._srcImg)return e;var o,l,u,h,f,c,d=i._srcImg||{data:s.getData(),width:s.width,height:s.height},m=d.data,p=d.width,_=d.height,g=e.length,v=(m.length,i.srcChannel),y=i.dstChannel,O=n(r,p),C=n(a,_),b=i.centerX||0,w=i.centerY||0,I=p>>1,Y=_>>1;for(b=t(b*(r-1))-I,w=t(w*(a-1))-Y,o=0,l=0,u=0,o=0;g>o;o+=4,l++)l>=r&&(l=0,u++),f=l-b,c=u-w,f>=0&&O>f&&c>=0&&C>c&&(h=f+c*p<<2,e[o+y]=m[h+v]);return e}})}(n),!function(e){var n=(e._notSupportClamp,e.CHANNEL),t=Math.min,a=Math.floor;e.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,channel:n.ALPHA,path:r,init:function(e,r,t,a){var i=this;i.centerX=r||0,i.centerY=t||0,i.channel=null==a?n.ALPHA:a||n.RED,i._alphaMask=null,i.alphaMask=null,e&&i.setMask(e)},dispose:function(){var e=this;return e.centerX=null,e.centerY=null,e.channel=null,e.alphaMask=null,e._alphaMask=null,e.$super("dispose"),e},setMask:function(e){var n=this;return e&&(n.alphaMask=e,n._alphaMask=null),n},serialize:function(){var e=this,n=e.alphaMask;return{filter:e.name,_isOn:!!e._isOn,params:{_alphaMask:e._alphaMask||(n?{data:n.getData(),width:n.width,height:n.height}:null),centerX:e.centerX,centerY:e.centerY,channel:e.channel}}},unserialize:function(n){var r,t=this;return n&&t.name===n.filter&&(t._isOn=!!n._isOn,r=n.params,t.alphaMask=null,t._alphaMask=r._alphaMask,t._alphaMask&&(t._alphaMask.data=e.Util.Array.typed(t._alphaMask.data,e.ImArray)),t.centerX=r.centerX,t.centerY=r.centerY,t.channel=r.channel),t},apply:function(e,r,i){var s=this,o=s.alphaMask;if(!s._isOn||!o&&!s._alphaMask)return e;var l,u,h,f,c,d,m=s._alphaMask||{data:o.getData(),width:o.width,height:o.height},p=m.data,_=m.width,g=m.height,v=e.length,y=(p.length,t(r,_)),O=t(i,g),C=null==s.channel?n.ALPHA:s.channel||n.RED,b=s.centerX||0,w=s.centerY||0,I=_>>1,Y=g>>1;for(b=a(b*(r-1))-I,w=a(w*(i-1))-Y,u=0,h=0,l=0;v>l;l+=4,u++)u>=r&&(u=0,h++),c=u-b,d=h-w,c>=0&&y>c&&d>=0&&O>d?(f=c+d*_<<2,e[l+3]=p[f+C]):e[l+3]=0;return e}})}(n),!function(e){var n=e._notSupportClamp,t=e.Array32F,a=e.MODE,i=Math.min,s=Math.max;e.Util.Array.subarray;e.Create({name:"HistogramEqualizeFilter",path:r,mode:a.COLOR,init:function(e){var n=this;n.mode=e||a.COLOR},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{mode:e.mode}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.mode=n.mode),r},_apply_rgb:function(e,r,a){var o=this;if(!o._isOn)return e;var l,u,h,f,c,d,m,p,_,g,v,y,O,C,b,w,I=0,Y=0,M=0,z=255,X=255,A=255,x=e.length,R=x>>2,H=1/R;for(m=new t(256),p=new t(256),_=new t(256),w=0;x>w;w+=4)l=e[w],u=e[w+1],h=e[w+2],m[l]+=H,p[u]+=H,_[h]+=H,I=s(l,I),Y=s(u,Y),M=s(h,M),z=i(l,z),X=i(u,X),A=i(h,A);for(g=v=y=0,w=0;256>w;w+=32)g+=m[w],m[w]=g,g+=m[w+1],m[w+1]=g,g+=m[w+2],m[w+2]=g,g+=m[w+3],m[w+3]=g,g+=m[w+4],m[w+4]=g,g+=m[w+5],m[w+5]=g,g+=m[w+6],m[w+6]=g,g+=m[w+7],m[w+7]=g,g+=m[w+8],m[w+8]=g,g+=m[w+9],m[w+9]=g,g+=m[w+10],m[w+10]=g,g+=m[w+11],m[w+11]=g,g+=m[w+12],m[w+12]=g,g+=m[w+13],m[w+13]=g,g+=m[w+14],m[w+14]=g,g+=m[w+15],m[w+15]=g,g+=m[w+16],m[w+16]=g,g+=m[w+17],m[w+17]=g,g+=m[w+18],m[w+18]=g,g+=m[w+19],m[w+19]=g,g+=m[w+20],m[w+20]=g,g+=m[w+21],m[w+21]=g,g+=m[w+22],m[w+22]=g,g+=m[w+23],m[w+23]=g,g+=m[w+24],m[w+24]=g,g+=m[w+25],m[w+25]=g,g+=m[w+26],m[w+26]=g,g+=m[w+27],m[w+27]=g,g+=m[w+28],m[w+28]=g,g+=m[w+29],m[w+29]=g,g+=m[w+30],m[w+30]=g,g+=m[w+31],m[w+31]=g,v+=p[w],p[w]=v,v+=p[w+1],p[w+1]=v,v+=p[w+2],p[w+2]=v,v+=p[w+3],p[w+3]=v,v+=p[w+4],p[w+4]=v,v+=p[w+5],p[w+5]=v,v+=p[w+6],p[w+6]=v,v+=p[w+7],p[w+7]=v,v+=p[w+8],p[w+8]=v,v+=p[w+9],p[w+9]=v,v+=p[w+10],p[w+10]=v,v+=p[w+11],p[w+11]=v,v+=p[w+12],p[w+12]=v,v+=p[w+13],p[w+13]=v,v+=p[w+14],p[w+14]=v,v+=p[w+15],p[w+15]=v,v+=p[w+16],p[w+16]=v,v+=p[w+17],p[w+17]=v,v+=p[w+18],p[w+18]=v,v+=p[w+19],p[w+19]=v,v+=p[w+20],p[w+20]=v,v+=p[w+21],p[w+21]=v,v+=p[w+22],p[w+22]=v,v+=p[w+23],p[w+23]=v,v+=p[w+24],p[w+24]=v,v+=p[w+25],p[w+25]=v,v+=p[w+26],p[w+26]=v,v+=p[w+27],p[w+27]=v,v+=p[w+28],p[w+28]=v,v+=p[w+29],p[w+29]=v,v+=p[w+30],p[w+30]=v,v+=p[w+31],p[w+31]=v,y+=_[w],_[w]=y,y+=_[w+1],_[w+1]=y,y+=_[w+2],_[w+2]=y,y+=_[w+3],_[w+3]=y,y+=_[w+4],_[w+4]=y,y+=_[w+5],_[w+5]=y,y+=_[w+6],_[w+6]=y,y+=_[w+7],_[w+7]=y,y+=_[w+8],_[w+8]=y,y+=_[w+9],_[w+9]=y,y+=_[w+10],_[w+10]=y,y+=_[w+11],_[w+11]=y,y+=_[w+12],_[w+12]=y,y+=_[w+13],_[w+13]=y,y+=_[w+14],_[w+14]=y,y+=_[w+15],_[w+15]=y,y+=_[w+16],_[w+16]=y,y+=_[w+17],_[w+17]=y,y+=_[w+18],_[w+18]=y,y+=_[w+19],_[w+19]=y,y+=_[w+20],_[w+20]=y,y+=_[w+21],_[w+21]=y,y+=_[w+22],_[w+22]=y,y+=_[w+23],_[w+23]=y,y+=_[w+24],_[w+24]=y,y+=_[w+25],_[w+25]=y,y+=_[w+26],_[w+26]=y,y+=_[w+27],_[w+27]=y,y+=_[w+28],_[w+28]=y,y+=_[w+29],_[w+29]=y,y+=_[w+30],_[w+30]=y,y+=_[w+31],_[w+31]=y;if(f=I-z,c=Y-X,d=M-A,n)for(w=0;x>w;w+=4)l=e[w],u=e[w+1],h=e[w+2],O=m[l]*f+z,C=p[u]*c+X,b=_[h]*d+A,O=0>O?0:O>255?255:O,C=0>C?0:C>255?255:C,b=0>b?0:b>255?255:b,e[w]=~~O,e[w+1]=~~C,e[w+2]=~~b;else for(w=0;x>w;w+=4)l=e[w],u=e[w+1],h=e[w+2],O=m[l]*f+z,C=p[u]*c+X,b=_[h]*d+A,e[w]=~~O,e[w+1]=~~C,e[w+2]=~~b;return e},apply:function(e,r,o){var l=this;if(!l._isOn)return e;if(a.RGB===l.mode)return l._apply_rgb(e,r,o);var u,h,f,c,d,m,p,_,g,v,y=0,O=255,C=e.length,b=C>>2,w=1/b,I=a.GRAY===l.mode;if(_=new t(256),I)for(v=0;C>v;v+=4)u=e[v],_[u]+=w,y=s(u,y),O=i(u,O);else for(v=0;C>v;v+=4)u=e[v],h=e[v+1],f=e[v+2],c=~~(0+.299*u+.587*h+.114*f),d=~~(128-.168736*u-.331264*h+.5*f),m=~~(128+.5*u-.418688*h-.081312*f),m=0>m?0:m>255?255:m,c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d,e[v]=m,e[v+1]=c,e[v+2]=d,_[c]+=w,y=s(c,y),O=i(c,O);for(g=0,v=0;256>v;v+=32)g+=_[v],_[v]=g,g+=_[v+1],_[v+1]=g,g+=_[v+2],_[v+2]=g,g+=_[v+3],_[v+3]=g,g+=_[v+4],_[v+4]=g,g+=_[v+5],_[v+5]=g,g+=_[v+6],_[v+6]=g,g+=_[v+7],_[v+7]=g,g+=_[v+8],_[v+8]=g,g+=_[v+9],_[v+9]=g,g+=_[v+10],_[v+10]=g,g+=_[v+11],_[v+11]=g,g+=_[v+12],_[v+12]=g,g+=_[v+13],_[v+13]=g,g+=_[v+14],_[v+14]=g,g+=_[v+15],_[v+15]=g,g+=_[v+16],_[v+16]=g,g+=_[v+17],_[v+17]=g,g+=_[v+18],_[v+18]=g,g+=_[v+19],_[v+19]=g,g+=_[v+20],_[v+20]=g,g+=_[v+21],_[v+21]=g,g+=_[v+22],_[v+22]=g,g+=_[v+23],_[v+23]=g,g+=_[v+24],_[v+24]=g,g+=_[v+25],_[v+25]=g,g+=_[v+26],_[v+26]=g,g+=_[v+27],_[v+27]=g,g+=_[v+28],_[v+28]=g,g+=_[v+29],_[v+29]=g,g+=_[v+30],_[v+30]=g,g+=_[v+31],_[v+31]=g;if(p=y-O,n)if(I)for(v=0;C>v;v+=4)u=~~(_[e[v]]*p+O),u=0>u?0:u>255?255:u,e[v]=u,e[v+1]=u,e[v+2]=u;else for(v=0;C>v;v+=4)c=_[e[v+1]]*p+O,d=e[v+2],m=e[v],u=~~(c+1.402*(m-128)),h=~~(c-.34414*(d-128)-.71414*(m-128)),f=~~(c+1.772*(d-128)),u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,e[v]=u,e[v+1]=h,e[v+2]=f;else if(I)for(v=0;C>v;v+=4)u=~~(_[e[v]]*p+O),e[v]=u,e[v+1]=u,e[v+2]=u;else for(v=0;C>v;v+=4)c=_[e[v+1]]*p+O,d=e[v+2],m=e[v],u=~~(c+1.402*(m-128)),h=~~(c-.34414*(d-128)-.71414*(m-128)),f=~~(c+1.772*(d-128)),e[v]=u,e[v+1]=h,e[v+2]=f;return e}})}(n),!function(e){var n=e.ImArray,t=Math.sqrt,a=Math.min;Math.max,t(3);e.Create({name:"PixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.scale=n.scale),r},apply:function(e,r,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,h,f,c,d,m,p,_,g,v,y,O,C,b,w,I,Y,M,z,X,A,x,R,H,L,F,k,E,N,S,U,q=e.length,P=q>>>2,D=r-1,T=P-r;for(o=new n(q),l=~~(t(P)*s.scale*.01),u=l-1,h=r*u,_=g=v=y=O=0,p=0;q>p;p+=4)C=_-v,b=g-O,w=a(D,C+u),I=a(T,b+h),f=C+b<<2,c=C+I<<2,d=w+b<<2,m=w+I<<2,X=e[f],A=e[f+1],x=e[f+2],R=e[c],H=e[c+1],L=e[c+2],F=e[d],k=e[d+1],E=e[d+2],N=e[m],S=e[m+1],U=e[m+2],Y=~~((X+R+F+N)/4),M=~~((A+H+k+S)/4),z=~~((x+L+E+U)/4),o[p]=Y,o[p+1]=M,o[p+2]=z,o[p+3]=e[p+3],_++,v++,_>=r&&(v=0,_=0,y++,O+=r,g+=r,y>=l&&(y=0,O=0)),v>=l&&(v=0);return o}}),e.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.scale=n.scale),r},apply:function(e,r,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,h,f,c,d,m,p,_,g,v,y,O,C,b,w,I,Y,M,z,X,A,x,R,H,L,F,k,E=e.length,N=E>>>2,S=r-1,U=N-r;for(o=new n(E),l=~~(t(N)*s.scale*.01),u=l-1,h=r*u,p=_=g=v=y=0,m=0;E>m;m+=4)O=p-g,C=_-y,b=a(S,O+u),w=a(U,C+h),g+v>u?(f=b+C<<2,c=b+w<<2,d=O+C<<2):(f=O+C<<2,c=O+w<<2,d=b+C<<2),z=e[f],X=e[f+1],A=e[f+2],x=e[c],R=e[c+1],H=e[c+2],L=e[d],F=e[d+1],k=e[d+2],I=~~((z+x+L)/3),Y=~~((X+R+F)/3),M=~~((A+H+k)/3),o[m]=I,o[m+1]=Y,o[m+2]=M,o[m+3]=e[m+3],p++,g++,p>=r&&(g=0,p=0,v++,y+=r,_+=r,v>=l&&(v=0,y=0)),g>=l&&(g=0);return o}})}(n),!function(e,n){var t=7/16,a=3/16,i=5/16,s=1/16,o=e.MODE,l=e.Array32F,u=e.Color.clamp,h=e.Color.RGB2YCbCr,f=e.Color.YCbCr2RGB;e.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:o.GRAY,init:function(e,n,r){var t=this;t.size=e||1,t.thresh=u(null==n?.4:n,0,1),t.mode=r||o.GRAY},path:r,threshold:function(e){return this.thresh=u(e,0,1),this},grayscale:function(e){return arguments.length||(e=!0),this.mode=e?o.GRAY:o.RGB,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{size:e.size,thresh:e.thresh,mode:e.mode}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.size=n.size,r.thresh=n.thresh,r.mode=n.mode),r},apply:function(e,n,r){var c,d,m,p,_,g,v,y,O,C,b,w,I,Y,M,z,X,A=this,x=e.length,R=x>>>2,H=new l(3*R),L=A.size,F=L*L,k=1/F,E=255*A.thresh,N=N<<1,S=o.RGB===A.mode,U=L*n,q=t,P=a,D=i,T=s;for(v=0,y=0,g=0;r>v;){for(w=I=Y=0,O=0,C=0,b=0;L>C;)c=g+y+O+b<<2,d=3*(g+y+O+b),w+=e[c]+H[d],I+=e[c+1]+H[d+1],Y+=e[c+2]+H[d+2],O++,O>=L&&(O=0,C++,b+=n);if(w*=k,I*=k,Y*=k,_=S?h([w,I,Y]):[w,I,Y],m=_[0],m>E?S?(_[0]=u(~~m,0,255),p=f(_)):p=[255,255,255]:p=[0,0,0],c=g+y<<2,M=e[c]-p[0],z=e[c+1]-p[1],X=e[c+2]-p[2],n>g+L)for(O=L,C=0,b=0;L>C;)d=3*(g+y+O+b),H[d]+=q*M,H[d+1]+=q*z,H[d+2]+=q*X,O++,O>=N&&(O=L,C++,b+=n);if(r>v+L&&g>L)for(O=-L,C=L,b=0;N>C;)d=3*(g+y+O+b),H[d]+=P*M,H[d+1]+=P*z,H[d+2]+=P*X,O++,O>=0&&(O=-L,C++,b+=n);if(r>v+L)for(O=0,C=L,b=0;N>C;)d=3*(g+y+O+b),H[d]+=D*M,H[d+1]+=D*z,H[d+2]+=D*X,O++,O>=L&&(O=0,C++,b+=n);if(r>v+L&&n>g+L)for(O=L,C=L,b=0;N>C;)d=3*(g+y+O+b),H[d]+=T*M,H[d+1]+=T*z,H[d+2]+=T*X,O++,O>=N&&(O=L,C++,b+=n);for(O=0,C=0,b=0;L>C;)c=g+y+O+b<<2,e[c]=p[0],e[c+1]=p[1],e[c+2]=p[2],O++,O>=L&&(O=0,C++,b+=n);g+=L,g>=n&&(g=0,v+=L,y+=U)}return e}})}(n),!function(e,n){var t="hasOwnProperty",a=Math.min,i=Math.round,s=e._notSupportClamp,o=e.Color.Combine;e.Create({name:"BlendFilter",_blendImage:null,blendImage:null,mode:null,startX:0,startY:0,path:r,init:function(e,n){var r=this;r.startX=0,r.startY=0,r._blendImage=null,r.blendImage=null,r.mode=null,e&&r.setImage(e),n&&r.setMode(n)},dispose:function(){var e=this;return e.blendImage=null,e._blendImage=null,e.mode=null,e.$super("dispose"),e},setImage:function(e){var n=this;return e&&(n.blendImage=e,n._blendImage=null),n},setMode:function(e){var n=this;return e?(n.mode=(""+e).toLowerCase(),o[t](n.mode)||(n.mode=null)):n.mode=null,n},serialize:function(){var e=this,n=e.blendImage;return{filter:e.name,_isOn:!!e._isOn,params:{_blendImage:e._blendImage||(n?{data:n.getData(),width:n.width,height:n.height}:null),mode:e.mode,startX:e.startX,startY:e.startY}}},unserialize:function(n){var r,t=this;return n&&t.name===n.filter&&(t._isOn=!!n._isOn,r=n.params,t.startX=r.startX,t.startY=r.startY,t.blendImage=null,t._blendImage=r._blendImage,t._blendImage&&(t._blendImage.data=e.Util.Array.typed(t._blendImage.data,e.ImArray)),t.setMode(r.mode)),t},reset:function(){var e=this;return e.startX=0,e.startY=0,e.mode=null,e},apply:function(e,n,r){var t=this,l=t.blendImage;if(!t._isOn||!t.mode||!l&&!t._blendImage)return e;var u,h,f,c,d,m,p,_,g,v,y,O,C,b,w=t._blendImage||{data:l.getData(),width:l.width,height:l.height},I=t.startX||0,Y=t.startY||0,M=0,z=0,X=o[t.mode];if(0>I&&(M=-I,I=0),0>Y&&(z=-Y,Y=0),c=w.width,d=w.height,I>=n||Y>=r)return e;if(M>=c||z>=d)return e;if(I=i(I),Y=i(Y),M=i(M),z=i(z),u=a(n-I,c-M),h=a(r-Y,d-z),0>=u||0>=h)return e;for(f=w.data,v=I,y=Y*n,O=M,C=z*c,m=I+u,p=M+u,_=0,g=h*u;g>_;_++)b=O+C<<2,0<f[b+3]&&X(e,f,v+y<<2,b,s),v++,v>=m&&(v=I,y+=n),O++,O>=p&&(O=M,C+=c);return e}})}(n),!function(e,n){var t=e.ImArray,a=e.Util.Filter.integral_convolution,i=new e.Array32F([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]);e.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:3,path:r,init:function(e,n,r,t,a){var i=this;i.offsetX=e||0,i.offsetY=n||0,i.color=r||0,i.opacity=null==t?1:+t,i.quality=a||3},dispose:function(){var e=this;return e.offsetX=null,e.offsetY=null,e.color=null,e.opacity=null,e.quality=null,e.$super("dispose"),e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{offsetX:e.offsetX,offsetY:e.offsetY,color:e.color,opacity:e.opacity,quality:e.quality}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.offsetX=n.offsetX,r.offsetY=n.offsetY,r.color=n.color,r.opacity=n.opacity,r.quality=n.quality),r},apply:function(e,n,r){var s=this;if(!s._isOn)return e;var o,l,u,h,f,c,d,m,p=s.color||0,_=~~s.quality,g=s.offsetX||0,v=s.offsetY||0,y=s.opacity,O=p>>>16&255,C=p>>>8&255,b=255&p,w=e.length,I=w>>>2;if(0>y&&(y=0),y>1&&(y=1),0===y)return e;for(0>=_&&(_=1),_>3&&(_=3),m=new t(w),o=0;w>o;o+=4)d=e[o+3],d>0?(m[o]=O,m[o+1]=C,m[o+2]=b,m[o+3]=~~(y*d)):(m[o]=0,m[o+1]=0,m[o+2]=0,m[o+3]=0);for(m=a(!1,m,n,r,i,null,3,3,1,0,_),v*=n,l=0,u=0,c=0;w>c;c+=4,l++)l>=n&&(l=0,u+=n),h=l+g,f=u+v,0>h||h>=n||0>f||f>=I||(o=h+f<<2,d=e[o+3],y=m[c+3],255!==d&&0!==y&&(y/=255,O=~~(e[o]+(m[c]-e[o])*y),C=~~(e[o+1]+(m[c+1]-e[o+1])*y),b=~~(e[o+2]+(m[c+2]-e[o+2])*y),e[o]=O,e[o+1]=C,e[o+2]=b));return e}})}(n),!function(e){var n=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=e._notSupportClamp,s=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,n,r,t){var a=this;a.centerX=e||0,a.centerY=n||0,a.radius=r||10,a.amount=t||10},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.centerX=n.centerX,r.centerY=n.centerY,r.radius=n.radius,r.amount=n.amount),r},apply:function(e,r,o){var l=this;if(!l._isOn)return e;var u,h,f,c,d,m,p,_,g,v,y,O,C,b,w,I,Y,M,z,X,A,x,R,H,L,F,k,E,N,S,U,q,P,D=e.length,T=l.centerX||0,G=l.centerY||0,$=l.radius,j=l.amount;if(0>=j)return e;for(u=D>>2,S=0,U=r-1,q=0,P=u-r,T=a(T*(r-1)),G=a(G*(o-1)),f=(u<<1)+u,p=(r<<1)+r,h=new s(f),_=0,g=0,v=0,c=d=m=0,v=0;r>v;v++,_+=4,g+=3)c+=e[_],d+=e[_+1],m+=e[_+2],h[g]=c,h[g+1]=d,h[g+2]=m;for(_=p+r,g=0,v=0,c=d=m=0,_=p+r;D>_;_+=4,g+=3,v++)v>=r&&(v=0,c=d=m=0),c+=e[_],d+=e[_+1],m+=e[_+2],h[g+p]=h[g]+c,h[g+p+1]=h[g+1]+d,h[g+p+2]=h[g+2]+m;for(v=0,y=0,O=0,_=0;D>_;_+=4,v++)v>=r&&(v=0,y++,O+=r),b=v-T,w=y-G,C=t(b)+t(w),I=C>$?~~n((C-$)*j):~~(C/$+.5),I>0&&(Y=I*r,M=.25/(I*I),z=v-I,X=O-Y,A=v+I,x=O+Y,S>z?z=S:A>U&&(A=U),q>X?X=q:x>P&&(x=P),R=z+X,F=A+x,H=A+X,L=z+x,R=(R<<1)+R,H=(H<<1)+H,L=(L<<1)+L,F=(F<<1)+F,k=M*(h[F]-h[H]-h[L]+h[R]),E=M*(h[F+1]-h[H+1]-h[L+1]+h[R+1]),N=M*(h[F+2]-h[H+2]-h[L+2]+h[R+2]),i&&(k=0>k?0:k>255?255:k,E=0>E?0:E>255?255:E,N=0>N?0:N>255?255:N),e[_]=~~k,e[_+1]=~~E,e[_+2]=~~N);return e}})}(n),!function(e){e.Create({name:"SeamlessTileFilter",type:2,init:function(e){var n=this;n.type=null==e?2:e||0},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{type:e.type}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.type=n.type),r},apply:function(n,r,t){var a,i,s,o,l,u,h,f,c,d,m,p,_,g,v,y=this,O=y.type,C=e.Interpolation.bilinear,b=e.ImArray,w=e.Array8U,I=Math.sqrt;for(r!==t?n=C(n,r,t,p=r>t?r:t,p):p=r,_=Math.round(p/2),g=p*p,v=n.length,a=new b(v),i=new b(v),s=new w(g),f=0,c=0,d=0;v>d;d+=4,f++)f>=p&&(f=0,c++),m=(f+_)%p+(c+_)%p*p<<2,a[m]=n[d],a[m+1]=n[d+1],a[m+2]=n[d+2],a[m+3]=n[d+3];if(0===O)for(f=0,c=0;_>f;c++)c>=_&&(c=0,f++),h=255-255*I((f-_)*(f-_)+(c-_)*(c-_))/_,h=1>h?1:h>255?255:h,s[f+c*p]=h,s[f+(p-1-c)*p]=h,s[p-1-f+c*p]=h,s[p-1-f+(p-1-c)*p]=h;else if(1===O)for(f=0,c=0;_>f;c++)c>=_&&(c=0,f++),h=255-255*(_+f>_+c?(c-_)/_:(f-p/2)/_),h=1>h?1:h>255?255:h,s[f+c*p]=h,s[f+(p-1-c)*p]=h,s[p-1-f+c*p]=h,s[p-1-f+(p-1-c)*p]=h;else for(f=0,c=0;_>f;c++)c>=_&&(c=0,f++),h=255-255*(_+f>_+c?I((c-p)*(c-p)+(f-p)*(f-p))/(1.13*p):I((f-p)*(f-p)+(c-p)*(c-p))/(1.13*p)),h=1>h?1:h>255?255:h,s[f+c*p]=h,s[f+(p-1-c)*p]=h,s[p-1-f+c*p]=h,s[p-1-f+(p-1-c)*p]=h;for(c=0,f=0;p>c;f++)f>=p&&(f=0,c++),m=f+c*p,o=s[m],l=s[(f+_)%p+(c+_)%p*p],u=o+l,o/=u,l/=u,m<<=2,i[m]=~~(o*n[m]+l*a[m]),i[m+1]=~~(o*n[m+1]+l*a[m+1]),i[m+2]=~~(o*n[m+2]+l*a[m+2]),i[m+3]=n[m+3];return r!==t&&(i=C(i,p,p,r,t)),i}})}(n),!function(e){var n=e.Util.Array.typed,t=Math.abs,a=(Math.min,Math.max,Math.ceil),i=e.MODE,s=e.Array8U,o=e.Array32U;e.Create({name:"FloodFillFilter",x:0,y:0,color:null,borderColor:null,tolerance:0,path:r,init:function(e,n,r,t,a){var i=this;i.x=e||0,i.y=n||0,i.color=r||0,i.tolerance=t||0,i.borderColor=a===+a?+a:null},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{color:e.color,borderColor:e.borderColor,x:e.x,y:e.y,tolerance:e.tolerance}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.color=n.color,r.borderColor=n.borderColor,r.x=n.x,r.y=n.y,r.tolerance=n.tolerance),r},apply:function(e,n,r){var a,i,o,l,u,h,f,c,d,m,p,_,g=this,v=~~(255*(g.tolerance>=1?.999:g.tolerance)),y=g.color||0,O=g.borderColor,C=O===+O,b=n<<2,w=g.x,I=g.y,Y=e.length,M=0,z=Y-b,X=0,A=n-1<<2;if(c=I*n<<2,w<<=2,X>w||w>A||M>c||c>z)return e;if(a=new s(3),i=new s(3),i[0]=y>>>16&255,i[1]=y>>>8&255,i[2]=255&y,C){if(a[0]=O>>>16&255,a[1]=O>>>8&255,a[2]=255&O,t(a[0]-e[w+c])<=v&&t(a[1]-e[w+c+1])<=v&&t(a[2]-e[w+c+2])<=v)return e}else{if(e[w+c]===i[0]&&e[w+c+1]===i[1]&&e[w+c+2]===i[2])return e;a[0]=e[w+c],a[1]=e[w+c+1],a[2]=e[w+c+2]}for(d=new Array(Y>>>2),m=0,c+b>=M&&z>=c+b&&(d[m++]=[c,w,w,b]),d[m++]=[c+b,w,w,-b];m>0;){if(p=d[--m],c=p[0]+(b=p[3]),h=p[1],f=p[2],C)for(u=h;u>=X&&(l=u+c,!(t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v));u-=4)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];else for(u=h;u>=X&&(l=u+c,t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v);u-=4)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];if(u>=h){if(l=u+c,C)for(;f>=u&&t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v;)u+=4,l=u+c;else for(;f>=u&&!(t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v);)u+=4,l=u+c;o=u,_=f>=u}else o=u+4,h>o&&c-b>=M&&z>=c-b&&(d[m++]=[c,o,h-4,-b]),u=h+4,_=!0;for(;_;){if(l=u+c,C)for(;A>=u&&!(t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v);)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],u+=4,l=u+c;else for(;A>=u&&t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v;)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],u+=4,l=u+c;if(c+b>=M&&z>=c+b&&(d[m++]=[c,o,u-4,b]),u>f+4&&c-b>=M&&z>=c-b&&(d[m++]=[c,f+4,u-4,-b]),l=u+c,C)for(;f>=u&&t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v;)u+=4,l=u+c;else for(;f>=u&&!(t(a[0]-e[l])<=v&&t(a[1]-e[l+1])<=v&&t(a[2]-e[l+2])<=v);)u+=4,l=u+c;o=u,_=f>=u}}return e}}),e.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:0,pattern:null,_pattern:null,mode:i.TILE,borderColor:null,path:r,init:function(e,n,r,t,a,s,o,l){var u=this;u.x=e||0,u.y=n||0,u.offsetX=t||0,u.offsetY=a||0,r&&u.setPattern(r),u.mode=s||i.TILE,u.tolerance=o||0,u.borderColor=l===+l?+l:null},dispose:function(){var e=this;return e.pattern=null,e._pattern=null,e.x=null,e.y=null,e.offsetX=null,e.offsetY=null,e.tolerance=null,e.mode=null,e.borderColor=null,e.$super("dispose"),e},setPattern:function(e){var n=this;return e&&(n.pattern=e,n._pattern=null),n},serialize:function(){var e=this,n=e.pattern;return{filter:e.name,_isOn:!!e._isOn,params:{x:e.x,y:e.y,offsetX:e.offsetX,offsetY:e.offsetY,tolerance:e.tolerance,mode:e.mode,borderColor:e.borderColor,_pattern:e._pattern||(n?{data:n.getData(),width:n.width,height:n.height}:null)}}},unserialize:function(r){var t,a=this;return r&&a.name===r.filter&&(a._isOn=!!r._isOn,t=r.params,a.x=t.x,a.y=t.y,a.offsetX=t.offsetX,a.offsetY=t.offsetY,a.tolerance=t.tolerance,a.mode=t.mode,a.borderColor=t.borderColor,a.pattern=null,a._pattern=t._pattern,a._pattern&&(a._pattern.data=n(a._pattern.data,e.ImArray))),a},apply:function(e,n,r){var l=this,u=l.pattern;if(!l._isOn||!u&&!l._pattern)return e;var h,f,c,d,m,p,_,g,v,y,O,C,b,w,I,Y,M=l._pattern||{data:u.getData(),width:u.width,height:u.height},z=~~(255*(l.tolerance>=1?.999:l.tolerance)),X=l.mode,A=l.borderColor,x=A===+A,R=n<<2,H=M.data,L=M.width,F=M.height,k=l.x,E=l.y,N=l.offsetX||0,S=l.offsetY||0,U=e.length,q=U>>>2,P=0,D=U-R,T=0,G=n-1<<2,$=i.STRETCH;if(0>N&&(N+=L),0>S&&(S+=F),m=E,g=E*n<<2,k<<=2,T>k||k>G||P>g||g>D)return e;if(h=new s(3),x){if(h[0]=A>>>16&255,h[1]=A>>>8&255,h[2]=255&A,t(h[0]-e[k+g])<=z&&t(h[1]-e[k+g+1])<=z&&t(h[2]-e[k+g+2])<=z)return e}else h[0]=e[k+g],h[1]=e[k+g+1],h[2]=e[k+g+2];for(C=new Array(q),b=0,w=new o(a(q/32)),g+R>=P&&D>=g+R&&(C[b++]=[g,k,k,R,m+1]),C[b++]=[g+R,k,k,-R,m];b>0;){if(I=C[--b],g=I[0]+(R=I[3]),p=I[1],_=I[2],m=I[4],x)for(d=p;d>=T&&(c=d+g,!(w[c>>>7]&1<<(c>>>2&31)||t(h[0]-e[c])<=z&&t(h[1]-e[c+1])<=z&&t(h[2]-e[c+2])<=z));d-=4)w[c>>>7]|=1<<(c>>>2&31),$===X?(y=~~(L*(d>>>2)/n),O=~~(F*m/r)):(y=((d>>>2)+N)%L,O=(m+S)%F),v=y+O*L<<2,e[c]=H[v],e[c+1]=H[v+1],e[c+2]=H[v+2];else for(d=p;d>=T&&(c=d+g,!(w[c>>>7]&1<<(c>>>2&31))&&t(h[0]-e[c])<=z&&t(h[1]-e[c+1])<=z&&t(h[2]-e[c+2])<=z);d-=4)w[c>>>7]|=1<<(c>>>2&31),$===X?(y=~~(L*(d>>>2)/n),O=~~(F*m/r)):(y=((d>>>2)+N)%L,O=(m+S)%F),v=y+O*L<<2,e[c]=H[v],e[c+1]=H[v+1],e[c+2]=H[v+2];if(d>=p){if(c=d+g,x)for(;_>=d&&w[c>>>7]&1<<(c>>>2&31)||t(h[0]-e[c])<=z&&t(h[1]-e[c+1])<=z&&t(h[2]-e[c+2])<=z;)d+=4,c=d+g;else for(;_>=d&&!(!(w[c>>>7]&1<<(c>>>2&31))&&t(h[0]-e[c])<=z&&t(h[1]-e[c+1])<=z&&t(h[2]-e[c+2])<=z);)d+=4,c=d+g;f=d,Y=_>=d}else f=d+4,p>f&&g-R>=P&&D>=g-R&&(C[b++]=[g,f,p-4,-R,R>0?m-1:m+1]),d=p+4,Y=!0;for(;Y;){if(c=d+g,x)for(;G>=d&&!(w[c>>>7]&1<<(c>>>2&31))&&!(t(h[0]-e[c])<=z&&t(h[1]-e[c+1])<=z&&t(h[2]-e[c+2])<=z);)w[c>>>7]|=1<<(c>>>2&31),$===X?(y=~~(L*(d>>>2)/n),O=~~(F*m/r)):(y=((d>>>2)+N)%L,O=(m+S)%F),v=y+O*L<<2,e[c]=H[v],e[c+1]=H[v+1],e[c+2]=H[v+2],d+=4,c=d+g;else for(;G>=d&&!(w[c>>>7]&1<<(c>>>2&31))&&t(h[0]-e[c])<=z&&t(h[1]-e[c+1])<=z&&t(h[2]-e[c+2])<=z;)w[c>>>7]|=1<<(c>>>2&31),$===X?(y=~~(L*(d>>>2)/n),O=~~(F*m/r)):(y=((d>>>2)+N)%L,O=(m+S)%F),v=y+O*L<<2,e[c]=H[v],e[c+1]=H[v+1],e[c+2]=H[v+2],d+=4,c=d+g;if(g+R>=P&&D>=g+R&&(C[b++]=[g,f,d-4,R,R>0?m+1:m-1]),d>_+4&&g-R>=P&&D>=g-R&&(C[b++]=[g,_+4,d-4,-R,R>0?m-1:m+1]),c=d+g,x)for(;_>=d&&w[c>>>7]&1<<(c>>>2&31)||t(h[0]-e[c])<=z&&t(h[1]-e[c+1])<=z&&t(h[2]-e[c+2])<=z;)d+=4,c=d+g;else for(;_>=d&&!(!(w[c>>>7]&1<<(c>>>2&31))&&t(h[0]-e[c])<=z&&t(h[1]-e[c+1])<=z&&t(h[2]-e[c+2])<=z);)d+=4,c=d+g;f=d,Y=_>=d}}return e}})}(n),!function(e){var n=e._notSupportClamp,t=e.MODE,a=e.CHANNEL,i=e.Color.hue,s=e.Color.RGB2HSV,o=e.Util.Array.subarray;e.Create({name:"HSVConverterFilter",path:r,mode:t.HSV,init:function(e){var n=this;n.mode=e||t.HSV},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{mode:e.mode}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.mode=n.mode),r},apply:function(e,r,l){var u=this;if(!u._isOn)return e;var h,f,c,d,m,p=e.length,_=u.mode,g=a.H,v=a.S,y=a.V;if(n)if(t.HUE===_)for(h=0;p>h;h+=4)f=~~(.7083333333333334*i(e[h],e[h+1],e[h+2])),f=0>f?0:f>255?255:f,e[h]=f,e[h+1]=f,e[h+2]=f;else for(h=0;p>h;h+=4)f=s(o(e,h,h+3)),c=.7083333333333334*f[0],m=255*f[1],d=f[2],c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m,e[h+g]=~~c,e[h+v]=~~d,e[h+y]=~~m;else if(t.HUE===_)for(h=0;p>h;h+=4)f=~~(.7083333333333334*i(e[h],e[h+1],e[h+2])),e[h]=f,e[h+1]=f,e[h+2]=f;else for(h=0;p>h;h+=4)f=s(o(e,h,h+3)),c=.7083333333333334*f[0],m=255*f[1],d=f[2],e[h+g]=~~c,e[h+v]=~~d,e[h+y]=~~m;return e}})}(n),!function(e){var n=e.Util.Array.typed,t=e.MODE,a=e.Color.hue,i=e.Color.intensity;e.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,mode:t.COLOR,init:function(e,n,r){var a=this;a.thresholds=e,a.quantizedColors=n||null,a.mode=r||t.COLOR},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{thresholds:e.thresholds,quantizedColors:e.quantizedColors,mode:e.mode}}},unserialize:function(e){var r,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,r=e.params,t.thresholds=n(r.thresholds,Array),t.quantizedColors=n(r.quantizedColors,Array),t.mode=r.mode),t},apply:function(e,n,r){var s=this;if(!(s._isOn&&s.thresholds&&s.thresholds.length&&s.quantizedColors&&s.quantizedColors.length))return e;var o,l,u,h,f=e.length,c=s.mode||t.COLOR,d=s.thresholds,m=d.length,p=s.quantizedColors,_=p.length;if(t.HUE===c){for(u=0;f>u;u+=4)if(0!==e[u+3]){for(l=a(e[u],e[u+1],e[u+2]),h=0;m>h&&l>d[h];)h++;o=_>h?p[h]:16777215,e[u]=o>>>16&255,e[u+1]=o>>>8&255,e[u+2]=255&o}}else if(t.INTENSITY===c){for(u=0;f>u;u+=4)if(0!==e[u+3]){for(l=i(e[u],e[u+1],e[u+2]),h=0;m>h&&l>d[h];)h++;o=_>h?p[h]:16777215,e[u]=o>>>16&255,e[u+1]=o>>>8&255,e[u+2]=255&o}}else for(u=0;f>u;u+=4)if(0!==e[u+3]){for(l=e[u]<<16|e[u+1]<<8|255&e[u+2],h=0;m>h&&l>d[h];)h++;o=_>h?p[h]:16777215,e[u]=o>>>16&255,e[u+1]=o>>>8&255,e[u+2]=255&o}return e}})}(n),!function(e){var n=e.Color.hue;e.Create({name:"HueExtractorFilter",minHue:0,maxHue:360,background:0,init:function(e,n,r){var t=this;t.minHue=e,t.maxHue=n,t.background=r||0},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{minHue:e.minHue,maxHue:e.maxHue,background:e.background}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.minHue=n.minHue,r.maxHue=n.maxHue,r.background=n.background),r},apply:function(e,r,t){var a=this;if(!a._isOn)return e;var i,s,o,l,u,h,f=a.background||0,c=e.length,d=a.minHue,m=a.maxHue;for(i=f>>>16&255,s=f>>>8&255,o=255&f,l=f>>>24&255,u=0;c>u;u+=4)h=n(e[u],e[u+1],e[u+2]),(d>h||h>m)&&(e[u]=i,e[u+1]=s,e[u+2]=o,e[u+3]=l);return e}})}(n),!function(e){function n(e,n,r,t,a,i){var s,o,h,v,y,O=e.length,C=new u(O),b=new u(O),w=new u(O),I=new u(O),Y=new u(i),M=new u(i),z=a*a,X=2*z,A=p*z;
for(s=0;i>s&&(o=g(-(s*s)/X),!(f>=o&&s>=2));s++)h=g(-((y=s-.5)*y)/X),v=g(-((y=s+.5)*y)/X),Y[s]=(o+h+v)/3/A,M[s]=v-h;var y,x,R,H,L,F,k,E,N,S=s-1,U=n-(s-1),q=n*(s-1),P=n*(r-(s-1));for(y=S;U>y;y++)for(x=q;P>x;x+=n){for(R=y+x,H=e[R]*Y[0],L=H,F=1,k=n;s>F;)L+=Y[F]*(e[R-k]+e[R+k]),H+=Y[F]*(e[R-F]+e[R+F]),k+=n,F++;b[R]=L,C[R]=H}for(y=S;U>y;y++)for(x=q;P>x;x+=n){for(E=0,R=y+x,N=1;s>N;N++)E+=M[N]*(b[R-N]-b[R+N]);w[R]=E}for(y=s;n-s>y;y++)for(x=q;P>x;x+=n){for(E=0,R=y+x,k=n,N=1;s>N;N++)E+=M[N]*(C[R-k]-C[R+k]),k+=n;I[R]=E}S=s,U=n-s,q=n*s,P=n*(r-s);var D,T,G,$,j,W,B,V,J,K,Q,Z,ee,ne,re,te,ae,ie,se,oe;for(y=S;U>y;y++)for(x=q;P>x;x+=n)R=y+x,D=R-n,T=R+n,$=R-1,G=R+1,j=D-1,W=D+1,B=T-1,V=T+1,J=w[R],K=I[R],Q=l(J,K),ee=l(w[D],I[D]),ne=l(w[T],I[T]),te=l(w[$],I[$]),re=l(w[G],I[G]),ie=l(w[W],I[W]),oe=l(w[V],I[V]),se=l(w[B],I[B]),ae=l(w[j],I[j]),(0>=J*K?_(J)>=_(K)?(Z=_(J*Q))>=_(K*ie-(J+K)*re)&&Z>_(K*se-(J+K)*te):(Z=_(K*Q))>=_(J*ie-(K+J)*ee)&&Z>_(J*se-(K+J)*ne):_(J)>=Math.abs(K)?(Z=_(J*Q))>=_(K*oe+(J-K)*re)&&Z>_(K*ae+(J-K)*te):(Z=_(K*Q))>=_(J*oe+(K-J)*ne)&&Z>_(J*ae+(K-J)*ee))?t[R]=Q>=d?m:Math.floor(c*Q):t[R]=0}function t(e,n,r,t,i,s){var o,l,u,h=0,f=e.length;for(o=0;f>o;o++)e[o]=0;for(u=0,l=0,h=0;f>h;h++,u++)u>=n&&(u=0,l++),0===e[h]&&t[h]>=s&&a(e,n,r,t,u,l,h,i)}function a(e,n,r,t,i,s,o,l){var u,h,f,c=0==i?i:i-1,d=i==n-1?i:i+1,m=0==s?s:s-1,p=s==r-1?s:s+1;for(e[o]=t[o],u=c,h=m;d>=u&&p>=h;){if(f=u+h*n,(h!=s||u!=i)&&0===e[f]&&t[f]>=l)return void a(e,n,r,t,u,h,f,l);h++,h>p&&(h=m,u++)}}function i(n,r){var t,a,i,s,o,l=n.length,u=e.LUMA[0],h=e.LUMA[1],f=e.LUMA[2];for(t=0,a=0;l>t;t+=4,a++)i=n[t],s=n[t+1],o=n[t+2],r[a]=~~(u*i+h*s+f*o+.5)}function s(e){var n,r,t,a,i,s=new h(256),o=new h(256),l=e.length;for(n=0;l>n;n++)s[e[n]]++;for(r=0,t=0,n=0;256>n;n++){for(r+=s[n],i=255*r/l,a=t+1;i>=a;a++)o[a]=n;t=i}for(n=0;l>n;n++)e[n]=o[e[n]]}function o(e,n){var r,t,a,i=e.length;for(r=0,t=0;i>r;r+=4,t++)a=n[t]>0?255:0,e[r]=e[r+1]=e[r+2]=a}var l,u=e.Array32F,h=e.Array32I,f=.005,c=100,d=1e3,m=c*d,p=e.CONST.PI2,_=Math.abs,g=Math.exp;l=Math.hypot?Math.hypot:function(e,n){return _(e)+_(n)},e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,gaussRadius:2,gaussWidth:16,contrastNormalized:!1,path:r,init:function(e,n,r,t,a){var i=this;i.low=arguments.length<1?2.5:e,i.high=arguments.length<2?7.5:n,i.gaussRadius=arguments.length<3?2:r,i.gaussWidth=arguments.length<4?16:t,i.contrastNormalized=!!a},thresholds:function(e,n){var r=this;return r.low=e,r.high=n,r},kernel:function(e,n){var r=this;return r.gaussRadius=e,r.gaussWidth=n,r},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{low:e.low,high:e.high,gaussRadius:e.gaussRadius,gaussWidth:e.gaussWidth,contrastNormalized:e.contrastNormalized}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.low=n.low,r.high=n.high,r.gaussRadius=n.gaussRadius,r.gaussWidth=n.gaussWidth,r.contrastNormalized=n.contrastNormalized),r},apply:function(e,r,a){var l,u,f,d,m=this,p=e.length>>2;return f=new h(p),d=new h(p),l=Math.round(m.low*c),u=Math.round(m.high*c),i(e,f),m.contrastNormalized&&s(f),n(f,r,a,d,m.gaussRadius,m.gaussWidth),t(f,r,a,d,l,u),o(e,f),e}})}(n),!function(e,n){function t(e,n,r,t,a,i,s){var o,l,u,h,f,c,d,m=e.length;for(h=0,u=0,o=l=0;n>h;)d=4899*e[u]+9617*e[u+1]+1868*e[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[h]=d,a[h]=o,i[h]=l,s[h]=d,h++,u+=4;for(f=0,c=1,h=n,u=n<<2,o=l=0;m>u;)d=4899*e[u]+9617*e[u+1]+1868*e[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[h]=d,a[h]=a[h-n]+o,i[h]=i[h-n]+l,s[h]=s[h+1-n]+(d+t[h-n])+(c>1?s[h-n-n]:0)+(f>0?s[h-1-n]:0),f++,h++,u+=4,f>=n&&(f=0,c++,o=l=0)}function a(e,n,r,t){var a,i,s,o,l,u,h,f,m,p,_,g=e.length,v=new c(g);for(a=0;n>a;a++)v[a]=0,v[a+n]=0,v[a+g-n]=0,v[a+g-n-n]=0,t[a]=0,t[a+g-n]=0;for(i=0,s=0;r>i;i++,s+=n)v[0+s]=0,v[1+s]=0,v[n-1+s]=0,v[n-2+s]=0,t[0+s]=0,t[n-1+s]=0;for(a=2;n-2>a;a++)for(o=0,i=2,s=n<<1;r-2>i;i++,s+=n)h=a+s,f=h+n,m=f+n,p=h-n,_=p-n,o=0+(e[_-2]<<1)+(e[p-2]<<2)+(e[h-2]<<2)+e[h-2]+(e[f-2]<<2)+(e[m-2]<<1)+(e[_-1]<<2)+(e[p-1]<<3)+e[p-1]+(e[h-1]<<4)-(e[h-1]<<2)+(e[f-1]<<3)+e[f-1]+(e[m-1]<<2)+(e[_]<<2)+e[_]+(e[p]<<4)-(e[p]<<2)+(e[h]<<4)-e[h]+(e[f]<<4)-(e[f]<<2)+(e[m]<<2)+e[m]+(e[_+1]<<2)+(e[p+1]<<3)+e[p+1]+(e[h+1]<<4)-(e[h+1]<<2)+(e[f+1]<<3)+e[f+1]+(e[m+1]<<2)+(e[_+2]<<1)+(e[p+2]<<2)+(e[h+2]<<2)+e[h+2]+(e[f+2]<<2)+(e[m+2]<<1),v[h]=((103*o+8192&4294967295)>>>14&255)>>>0;for(a=1;n-1>a;a++)for(i=1,s=n;r-1>i;i++,s+=n)h=s+a,f=h+n,p=h-n,l=0-v[p-1]+v[p+1]-v[h-1]-v[h-1]+v[h+1]+v[h+1]-v[f-1]+v[f+1],u=0+v[p-1]+v[p]+v[p]+v[p+1]-v[f-1]-v[f]-v[f]-v[f+1],t[h]=d(l)+d(u);for(a=0,o=0;n>a;)o+=t[a],t[a]=o,a++;for(a=n,s=0,o=0;g>a;)o+=t[a],t[a]=t[a-n]+o,a++,s++,s>=n&&(s=0,o=0);return t}function i(e,n){var r=.2*m(n.width,e.width),t=.2*m(n.height,e.height);return!!(d(e.x-n.x)<=r&&d(e.y-n.y)<=t&&d(e.width-n.width)<=r&&d(e.height-n.height)<=t)}function s(e,n){e.x+=n.x,e.y+=n.y,e.width+=n.width,e.height+=n.height}function o(e,n){return!!(e.x>=n.x&&e.y>=n.y&&e.x+e.width<=n.x+n.width&&e.y+e.height<=n.y+n.height)}function l(e){e.x=~~(e.x+.5),e.y=~~(e.y+.5),e.width=~~(e.width+.5),e.height=~~(e.height+.5)}function u(e,n){return n.area-e.area}function h(e,n){var r,t,a,h,f,c,d,m=e.length,p=new Array(m),_=[],g=0,v=!1;for(a=0;m>a;a++)p[a]=0;for(a=0;m>a;a++){for(v=!1,h=0;a>h;h++)i(e[h],e[a])&&(v=!0,p[a]=p[h]);v||(p[a]=g,g++)}for(r=new Array(g),t=new Array(g),a=0;g>a;a++)r[a]=0,t[a]={x:0,y:0,width:0,height:0};for(a=0;m>a;a++)d=p[a],r[d]++,s(t[d],e[a]);for(a=0;g>a;a++)f=r[a],f>=n&&(c=1/(f+f),d={x:c*(2*t[a].x+f),y:c*(2*t[a].y+f),width:c*(2*t[a].width+f),height:c*(2*t[a].height+f)},_.push(d));for(m=_.length,a=0;m>a;a++)for(h=a+1;m>h;h++)!_[a].inside&&o(_[a],_[h])?_[a].inside=!0:!_[h].inside&&o(_[h],_[a])&&(_[h].inside=!0);for(a=m;--a>=0;)_[a].inside?_.splice(a,1):(l(_[a]),_[a].area=_[a].width*_[a].height);return _.sort(u)}var f=e.Array32F,c=e.Array8U,d=Math.abs,m=Math.max,p=Math.min,_=(Math.floor,Math.round,Math.sqrt),g=e.Util.Array.typed_obj,v="hasOwnProperty";e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,r,t,a,i,s){var o=this;o.objects=null,o.haardata=e||null,o.baseScale=n===r?1:r,o.scaleIncrement=n===t?1.25:t,o.stepIncrement=n===a?.5:a,o.minNeighbors=n===i?1:i,o.doCannyPruning=n===s?!0:!!s,o._haarchanged=!!o.haardata},path:r,dispose:function(){var e=this;return e.objects=null,e.haardata=null,e.$super("dispose"),e},haar:function(e){var n=this;return n.haardata=e,n._haarchanged=!0,n},params:function(e){var n=this;return e&&(e[v]("haardata")&&(n.haardata=e.haardata,n._haarchanged=!0),e[v]("baseScale")&&(n.baseScale=e.baseScale),e[v]("scaleIncrement")&&(n.scaleIncrement=e.scaleIncrement),e[v]("stepIncrement")&&(n.stepIncrement=e.stepIncrement),e[v]("minNeighbors")&&(n.minNeighbors=e.minNeighbors),e[v]("doCannyPruning")&&(n.doCannyPruning=e.doCannyPruning),e[v]("cannyLow")&&(n.cannyLow=e.cannyLow),e[v]("cannyHigh")&&(n.cannyHigh=e.cannyHigh)),n},serialize:function(){var e=this,n={filter:e.name,_isOn:!!e._isOn,params:{baseScale:e.baseScale,scaleIncrement:e.scaleIncrement,stepIncrement:e.stepIncrement,minNeighbors:e.minNeighbors,doCannyPruning:e.doCannyPruning,cannyLow:e.cannyLow,cannyHigh:e.cannyHigh}};return e._haarchanged&&(n.params.haardata=g(e.haardata),e._haarchanged=!1),n},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,n[v]("haardata")&&(r.haardata=g(n.haardata,1)),r.baseScale=n.baseScale,r.scaleIncrement=n.scaleIncrement,r.stepIncrement=n.stepIncrement,r.minNeighbors=n.minNeighbors,r.doCannyPruning=n.doCannyPruning,r.cannyLow=n.cannyLow,r.cannyHigh=n.cannyHigh),r},getMeta:function(){return e.isWorker?g(this.objects):this.objects},setMeta:function(e){return this.objects="string"==typeof e?g(e,1):e,this},apply:function(e,n,r){var i,s,o,l,u,d,m,g,v,y,O,C,b,w,I,Y,M,z,X,A,x,R,H,L,F,k,E,N,S,U,q,P,D,T,G,$,j,W,B,L,V,J,K,Q,Z,ee,ne,re,te,ae,ie,se,oe,le,ue,he,fe,ce,de,me=this,pe=e.length>>>2,_e=me.haardata,ge=_e.stages,ve=me.baseScale,ye=me.scaleIncrement,Oe=me.stepIncrement,Ce=me.minNeighbors,be=me.doCannyPruning,we=me.cannyLow,Ie=me.cannyHigh,Ye=_e.size1,Me=_e.size2,ze=p(n/Ye,r/Me),Xe=[],Ae=pe-1,xe=0,Re=0,He=ge.length;for(t(e,n,r,s=new c(pe),o=new f(pe),l=new f(pe),u=new f(pe)),be&&a(s,n,r,d=new f(pe)),F=0,k=n-1,E=0,N=pe-n,i=ve;ze>=i;){for(v=~~(i*Ye),m=~~(v*Oe),y=~~(i*Me),g=~~(y*Oe),I=y*n,Y=g*n,O=Re*Y,x=n-v,R=r-y,S=v*y,U=1/S,b=Re,w=O;R>b;b+=g,w+=Y)for(C=xe;x>C;C+=m)if(M=C-1+w-n,z=M+v,X=M+I,A=X+v,M=0>M?0:M>Ae?Ae:M,z=0>z?0:z>Ae?Ae:z,X=0>X?0:X>Ae?Ae:X,A=0>A?0:A>Ae?Ae:A,!(be&&(T=U*(d[A]-d[X]-d[z]+d[M]),we>T||T>Ie))){for(q=U*(o[A]-o[X]-o[z]+o[M]),P=U*(l[A]-l[X]-l[z]+l[M]),D=P-q*q,D=D>1?_(D):1,G=!0,H=0;He>H;H++){for($=ge[H],j=$.thres,W=$.trees,B=W.length,de=0,L=0;B>L;L++)for(K=W[L].feats,V=0;;){if(Q=K[V],Z=Q.rects,ee=Z.length,ne=Q.thres,re=0,Q.tilt)for(te=0;ee>te;te++)ae=Z[te],ie=C+~~(i*ae[0]),se=(b-1+~~(i*ae[1]))*n,oe=C+~~(i*(ae[0]+ae[2])),le=(b-1+~~(i*(ae[1]+ae[2])))*n,ue=C+~~(i*(ae[0]-ae[3])),he=(b-1+~~(i*(ae[1]+ae[3])))*n,fe=C+~~(i*(ae[0]+ae[2]-ae[3])),ce=(b-1+~~(i*(ae[1]+ae[2]+ae[3])))*n,ie=F>ie?F:ie>k?k:ie,oe=F>oe?F:oe>k?k:oe,ue=F>ue?F:ue>k?k:ue,fe=F>fe?F:fe>k?k:fe,se=E>se?E:se>N?N:se,le=E>le?E:le>N?N:le,he=E>he?E:he>N?N:he,ce=E>ce?E:ce>N?N:ce,re+=ae[4]*(u[fe+ce]-u[ue+he]-u[oe+le]+u[ie+se]);else for(te=0;ee>te;te++)ae=Z[te],ie=C-1+~~(i*ae[0]),oe=C-1+~~(i*(ae[0]+ae[2])),se=n*(b-1+~~(i*ae[1])),le=n*(b-1+~~(i*(ae[1]+ae[3]))),ie=F>ie?F:ie>k?k:ie,oe=F>oe?F:oe>k?k:oe,se=E>se?E:se>N?N:se,le=E>le?E:le>N?N:le,re+=ae[4]*(o[oe+le]-o[ie+le]-o[oe+se]+o[ie+se]);if(J=ne*D>re*U?0:1){if(Q.has_r){de+=Q.r_val;break}V=Q.r_node}else{if(Q.has_l){de+=Q.l_val;break}V=Q.l_node}}if(G=de>j,!G)break}G&&Xe.push({x:C,y:b,width:v,height:y})}i*=ye}return me.objects=h(Xe,Ce),e}})}(n),!function(e,n){function t(e,n){for(;n[e][1]!==e;)n[e][1]=n[n[e][1]][1],e=n[e][1];return e}function a(e,n,r){var a=t(e,r),i=t(n,r);a!==i&&(r[a][1]=i)}function i(e,n,r){var t=r.next;return t+1>r.length&&Array.prototype.push.apply(r,new Array(O)),r[t]=[t,t,0],++r.next,t}function s(e,n,r,t){return e}function o(e,n,r,t,a){return 0===e[n+3]&&0===e[r+3]||y(e[n]-e[r])<=t&&y(e[n+1]-e[r+1])<=t&&y(e[n+2]-e[r+2])<=t}function l(e,n,r,t,a){return y(n[r]-e[0])<=t&&y(n[r+1]-e[1])<=t&&y(n[r+2]-e[2])<=t}function u(e,n,r,t,a){if(0===e[n+3]&&0===e[r+3])return!0;var i=n>>>2,s=r>>>2;return null==a[i]&&(a[i]=_(e[n],e[n+1],e[n+2])),null==a[s]&&(a[s]=_(e[r],e[r+1],e[r+2])),y(a[i],a[s])<=t}function h(e,n,r,t,a){var i=r>>>2;return null==a[i]&&(a[i]=_(n[r],n[r+1],n[r+2])),y(a[i],e)<=t}function f(e,n,r,t,a){if(0===e[n+3]&&0===e[r+3])return!0;var i=n>>>2,s=r>>>2;return null==a[i]&&(a[i]=p(e[n],e[n+1],e[n+2])),null==a[s]&&(a[s]=p(e[r],e[r+1],e[r+2])),y(a[i],a[s])<=t}function c(e,n,r,t,a){var i=r>>>2;return null==a[i]&&(a[i]=p(n[r],n[r+1],n[r+2])),y(a[i],e)<=t}var d=e.Array32U,m=e.MODE,p=e.Color.hue,_=e.Color.intensity,g=Math.min,v=Math.max,y=Math.abs,O=20;e.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:0,mode:m.COLOR,color:null,invert:!1,box:null,init:function(e,n,r,t,a){var i=this;i.connectivity=8===e?8:4,i.tolerance=n||0,i.mode=r||m.COLOR,i.color=null==t?null:t,i.invert=!!a},path:r,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{connectivity:e.connectivity,tolerance:e.tolerance,mode:e.mode,color:e.color,invert:e.invert}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r.connectivity=n.connectivity,r.tolerance=n.tolerance,r.mode=n.mode,r.color=n.color,r.invert=n.invert),r},apply:function(e,n,r){var p=this;if(!p._isOn)return e;var _,y,C,b,w,I,Y,M,z,X,A,x,R=e.length,H=R>>>2,L=n<<2,F=p.mode||m.COLOR,k=p.invert,E=p.color,N=g(.999,v(0,p.tolerance||0)),S=8===p.connectivity?8:4,U=8===S,q=U?-1:0,P=q<<2,D=null,T=null,G=null,$=null,j=null!=E;for(z=new Array(O),z.next=0,X=new d(H),m.HUE===F?(N*=360,D=f,T=new Array(H),j&&(G=c)):m.INTENSITY===F?(N*=255,D=u,T=new Array(H),j&&(G=h)):(N*=255,D=o,j&&(E=[E>>>16&255,E>>>8&255,255&E],G=l)),$=j?i(0,0,z):null,X[0]=j&&!G(E,e,0,N,T)?$:i(0,0,z),w=1,_=4;n>w;w++,_+4)X[w]=j&&!G(E,e,_,N,T)?$:D(e,_,_-4,N,T)?s(X[w-1],w,0,z):i(w,0,z);for(I=1,M=n,_=L;r>I;I++,M+=n,_+=L)for(X[M]=j&&!G(E,e,_,N,T)?$:D(e,_,_-L,N,T)?s(X[M-n],0,I,z):i(0,I,z),w=1,y=4;n>w;w++,y+=4)if(!j||G(E,e,_+y,N,T)){for(b=$===X[M+w-1]?-1:D(e,_+y,_+y-4,N,T)?s(X[M+w-1],w,I,z):-1,Y=q,C=P;1>Y;Y++,C+=4)$!==X[M-n+w+Y]&&D(e,_+y,_-L+y+C,N,T)&&(b>=0?a(b,X[M-n+w+Y],z):b=s(X[M-n+w+Y],w+Y,I,z));X[M+w]=b>=0?s(b,w,I,z):i(w,I,z),U&&$!==X[M+w-1]&&$!==X[M-n+w]&&D(e,_+y-4,_-L+y,N,T)&&a(X[M+w-1],X[M-n+w],z)}else X[M+w]=$;if(0===$)for(_=0,A=z.next,x=0;A>_;_++)_===z[_][1]&&(z[_][2]=0===z[_][1]?0:++x);else for(_=0,A=z.next,x=0;A>_;_++)_===z[_][1]&&(z[_][2]=x++);if(x=x>0?x:1,k)for(w=0,_=0;R>_;_+=4,w++)E=z[t(X[w],z)][2],E=~~(255-255*E/x),e[_]=E,e[_+1]=E,e[_+2]=E;else for(w=0,_=0;R>_;_+=4,w++)E=z[t(X[w],z)][2],E=~~(255*E/x),e[_]=E,e[_+1]=E,e[_+2]=E;return e}})}(n),n});