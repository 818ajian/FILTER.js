/**
*
*   FILTER.js Plugins
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,r){"use strict";"object"==typeof module&&module.exports?module.exports=r.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(n,t){return r.moduleUri=n.uri,r.call(e,t),t}):(r.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(r){"use strict";var n=r.getPath(e.moduleUri);return!function(e){var r=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,r){var n=this;n.min=e||-127,n.max=r||127},path:n,serialize:function(){var e=this;return{min:e.min,max:e.max}},unserialize:function(e){var r=this;return r.min=e.min,r.max=e.max,r},apply:function(e,n,a){var o=this;if(!o._isOn)return e;var i,l,s,c,u,f,h,d,p=o.max-o.min,y=o.min,m=e.length;if(r)for(i=0;m>i;i+=4)s=e[i],c=e[i+1],u=e[i+2],l=p*t()+y,f=s+l,h=c+l,d=u+l,0>f?f=0:f>255&&(f=255),0>h?h=0:h>255&&(h=255),0>d?d=0:d>255&&(d=255),e[i]=0|f,e[i+1]=0|h,e[i+2]=0|d;else for(i=0;m>i;i+=4)s=e[i],c=e[i+1],u=e[i+2],l=p*t()+y,f=s+l,h=c+l,d=u+l,e[i]=0|f,e[i+1]=0|h,e[i+2]=0|d;return e}})}(r),!function(e){var r=e.Util.Image.perlin,t=e.MODE;e.Create({name:"PerlinNoiseFilter",_baseX:1,_baseY:1,_octaves:1,_offsets:null,_mode:t.GRAY,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:n,init:function(e,r,n,a,o,i,l,s){var c=this;c._mode=t.GRAY,c._baseX=e||1,c._baseY=r||1,c._seed=l||0,c._stitch=!!a,c._fractal=!1!==o,c._perlin=!!s,c.octaves(n||1,i)},seed:function(e){var r=this;return r._seed=e||0,r},octaves:function(e,r){var n=this;for(n._octaves=e||1,n._offsets=r?r.slice(0):[];n._offsets.length<n._octaves;)n._offsets.push([0,0]);return n},seamless:function(e){return arguments.length||(e=!0),this._stitch=!!e,this},colors:function(e){return arguments.length||(e=!0),this._mode=e?t.COLOR:t.GRAY,this},turbulence:function(e){return arguments.length||(e=!0),this._fractal=!e,this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var e=this;return{_baseX:e._baseX,_baseY:e._baseY,_octaves:e._octaves,_offsets:e._offsets,_seed:e._seed||0,_stitch:e._stitch,_mode:e._mode,_fractal:e._fractal,_perlin:e._perlin}},unserialize:function(e){var r=this;return r._baseX=e._baseX,r._baseY=e._baseY,r._octaves=e._octaves,r._offsets=e._offsets,r._seed=e._seed||0,r._stitch=e._stitch,r._mode=e._mode,r._fractal=e._fractal,r._perlin=e._perlin,r},apply:function(e,n,a){var o=this;return o._isOn&&r?(o._seed&&(r.seed(o._seed),o._seed=0),r(e,n,a,o._stitch,t.COLOR!==o._mode,o._baseX,o._baseY,o._octaves,o._offsets,1,.5,o._perlin)):e}})}(r),!function(e,r){var t=e.Color.Gradient,a=e.Util.Array.typed,o=Math.floor;e.Create({name:"GradientFilter",colors:null,stops:null,angle:0,path:n,init:function(e,r,n){var t=this;t.setColors(e,r),t.angle=n||0},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.angle=null,e.$super("dispose"),e},setColors:function(e,r){var n=this;if(e&&e.length){var a=t.stops(e,r);n.colors=a[0],n.stops=a[1]}return n},serialize:function(){var e=this;return{angle:e.angle,colors:e.colors,stops:e.stops}},unserialize:function(e){var r=this;return r.angle=e.angle,r.colors=a(e.colors,Array),r.stops=a(e.stops,Array),r},apply:function(e,r,n){var a=this;return a.colors?t.linear(e,r,n,a.colors,a.stops,a.angle,t.interpolate):e}}),e.Create({name:"RadialGradientFilter",colors:null,stops:null,centerX:0,centerY:0,radiusX:1,radiusY:1,init:function(e,r,n,t,a,o){var i=this;i.setColors(e,r),i.centerX=n||0,i.centerY=t||0,i.radiusX=a||1,i.radiusY=o||1},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.centerX=null,e.centerY=null,e.radiusX=null,e.radiusY=null,e.$super("dispose"),e},setColors:function(e,r){var n=this;if(e&&e.length){var a=t.stops(e,r);n.colors=a[0],n.stops=a[1]}return n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radiusX:e.radiusX,radiusY:e.radiusY,colors:e.colors,stops:e.stops}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.centerX=r.centerX||0,n.centerY=r.centerY||0,n.radiusX=r.radiusX||1,n.radiusY=r.radiusY||1,n.colors=a(r.colors,Array),n.stops=a(r.stops,Array)),n},apply:function(e,r,n){var a=this;return a.colors?t.radial(e,r,n,a.colors,a.stops,o((a.centerX||0)*(r-1)),o((a.centerY||0)*(n-1)),a.radiusX,a.radiusY,t.interpolate):e}})}(r),!function(e){var r=Math.min,t=Math.floor,a=e.CHANNEL,o=e.MODE;e.Create({name:"ChannelCopyFilter",centerX:0,centerY:0,srcChannel:a.R,dstChannel:a.R,color:0,mode:o.IGNORE,hasInputs:!0,path:n,init:function(e,r,n,t,o){var i=this;i.srcChannel=e||a.R,i.dstChannel=r||a.R,i.centerX=n||0,i.centerY=t||0,i.color=o||0},dispose:function(){var e=this;return e.srcChannel=null,e.dstChannel=null,e.centerX=null,e.centerY=null,e.color=null,e.$super("dispose"),e},serialize:function(){var e=this;return{centerX:e.centerX,centerY:e.centerY,srcChannel:e.srcChannel,dstChannel:e.dstChannel,color:e.color}},unserialize:function(e){var r=this;return r.centerX=e.centerX,r.centerY=e.centerY,r.srcChannel=e.srcChannel,r.dstChannel=e.dstChannel,r.color=e.color,r},apply:function(e,n,a){var i,l=this;if(i=l.input("source"),!i)return e;var s,c,u,f,h,d,p,y,m,v,_=i[0],g=i[1],C=i[2],w=e.length,b=(_.length,l.srcChannel),Y=l.dstChannel,A=l.centerX||0,X=l.centerY||0,x=g>>>1,I=C>>>1,F=r(n,g),z=r(a,C),M=l.color||0,S=l.mode,O=o.COLOR,R=o.COLOR_CHANNEL,E=o.COLOR_MASK;for(O===S||E===S?(v=M>>>24&255,p=M>>>16&255,y=M>>>8&255,m=255&M):R===S&&(M&=255),A=t(A*(n-1))-x,X=t(X*(a-1))-I,c=0,u=0,s=0;w>s;s+=4,c++)c>=n&&(c=0,u++),h=c-A,d=u-X,0>h||h>=F||0>d||d>=z?O===S?(e[s]=p,e[s+1]=y,e[s+2]=m,e[s+3]=v):E===S?(e[s]=p&e[s],e[s+1]=y&e[s+1],e[s+2]=m&e[s+2],e[s+3]=v&e[s+3]):R===S&&(e[s+Y]=M):(f=h+d*g<<2,e[s+Y]=_[f+b]);return e}})}(r),!function(e){var r=e._notSupportClamp,t=e.Array32F,a=e.MODE,o=Math.min,i=Math.max;e.Create({name:"HistogramEqualizeFilter",path:n,mode:a.INTENSITY,init:function(e){var r=this;r.mode=e||a.INTENSITY},serialize:function(){var e=this;return{mode:e.mode}},unserialize:function(e){var r=this;return r.mode=e.mode,r},_apply_rgb:function(e,n,a){var l,s,c,u,f,h,d,p,y,m,v,_,g,C,w,b,Y=0,A=0,X=0,x=255,I=255,F=255,z=e.length,M=z>>>2,S=(7&M)<<2;for(d=new t(256),p=new t(256),y=new t(256),b=0;z>b;b+=32)l=e[b],s=e[b+1],c=e[b+2],d[l]++,p[s]++,y[c]++,Y=i(l,Y),A=i(s,A),X=i(c,X),x=o(l,x),I=o(s,I),F=o(c,F),l=e[b+4],s=e[b+5],c=e[b+6],d[l]++,p[s]++,y[c]++,Y=i(l,Y),A=i(s,A),X=i(c,X),x=o(l,x),I=o(s,I),F=o(c,F),l=e[b+8],s=e[b+9],c=e[b+10],d[l]++,p[s]++,y[c]++,Y=i(l,Y),A=i(s,A),X=i(c,X),x=o(l,x),I=o(s,I),F=o(c,F),l=e[b+12],s=e[b+13],c=e[b+14],d[l]++,p[s]++,y[c]++,Y=i(l,Y),A=i(s,A),X=i(c,X),x=o(l,x),I=o(s,I),F=o(c,F),l=e[b+16],s=e[b+17],c=e[b+18],d[l]++,p[s]++,y[c]++,Y=i(l,Y),A=i(s,A),X=i(c,X),x=o(l,x),I=o(s,I),F=o(c,F),l=e[b+20],s=e[b+21],c=e[b+22],d[l]++,p[s]++,y[c]++,Y=i(l,Y),A=i(s,A),X=i(c,X),x=o(l,x),I=o(s,I),F=o(c,F),l=e[b+24],s=e[b+25],c=e[b+26],d[l]++,p[s]++,y[c]++,Y=i(l,Y),A=i(s,A),X=i(c,X),x=o(l,x),I=o(s,I),F=o(c,F),l=e[b+28],s=e[b+29],c=e[b+30],d[l]++,p[s]++,y[c]++,Y=i(l,Y),A=i(s,A),X=i(c,X),x=o(l,x),I=o(s,I),F=o(c,F);if(S)for(b=z-S;z>b;b+=4)l=e[b],s=e[b+1],c=e[b+2],d[l]++,p[s]++,y[c]++,Y=i(l,Y),A=i(s,A),X=i(c,X),x=o(l,x),I=o(s,I),F=o(c,F);for(m=v=_=0,b=0;256>b;b+=32)m+=d[b],d[b]=m,m+=d[b+1],d[b+1]=m,m+=d[b+2],d[b+2]=m,m+=d[b+3],d[b+3]=m,m+=d[b+4],d[b+4]=m,m+=d[b+5],d[b+5]=m,m+=d[b+6],d[b+6]=m,m+=d[b+7],d[b+7]=m,m+=d[b+8],d[b+8]=m,m+=d[b+9],d[b+9]=m,m+=d[b+10],d[b+10]=m,m+=d[b+11],d[b+11]=m,m+=d[b+12],d[b+12]=m,m+=d[b+13],d[b+13]=m,m+=d[b+14],d[b+14]=m,m+=d[b+15],d[b+15]=m,m+=d[b+16],d[b+16]=m,m+=d[b+17],d[b+17]=m,m+=d[b+18],d[b+18]=m,m+=d[b+19],d[b+19]=m,m+=d[b+20],d[b+20]=m,m+=d[b+21],d[b+21]=m,m+=d[b+22],d[b+22]=m,m+=d[b+23],d[b+23]=m,m+=d[b+24],d[b+24]=m,m+=d[b+25],d[b+25]=m,m+=d[b+26],d[b+26]=m,m+=d[b+27],d[b+27]=m,m+=d[b+28],d[b+28]=m,m+=d[b+29],d[b+29]=m,m+=d[b+30],d[b+30]=m,m+=d[b+31],d[b+31]=m,v+=p[b],p[b]=v,v+=p[b+1],p[b+1]=v,v+=p[b+2],p[b+2]=v,v+=p[b+3],p[b+3]=v,v+=p[b+4],p[b+4]=v,v+=p[b+5],p[b+5]=v,v+=p[b+6],p[b+6]=v,v+=p[b+7],p[b+7]=v,v+=p[b+8],p[b+8]=v,v+=p[b+9],p[b+9]=v,v+=p[b+10],p[b+10]=v,v+=p[b+11],p[b+11]=v,v+=p[b+12],p[b+12]=v,v+=p[b+13],p[b+13]=v,v+=p[b+14],p[b+14]=v,v+=p[b+15],p[b+15]=v,v+=p[b+16],p[b+16]=v,v+=p[b+17],p[b+17]=v,v+=p[b+18],p[b+18]=v,v+=p[b+19],p[b+19]=v,v+=p[b+20],p[b+20]=v,v+=p[b+21],p[b+21]=v,v+=p[b+22],p[b+22]=v,v+=p[b+23],p[b+23]=v,v+=p[b+24],p[b+24]=v,v+=p[b+25],p[b+25]=v,v+=p[b+26],p[b+26]=v,v+=p[b+27],p[b+27]=v,v+=p[b+28],p[b+28]=v,v+=p[b+29],p[b+29]=v,v+=p[b+30],p[b+30]=v,v+=p[b+31],p[b+31]=v,_+=y[b],y[b]=_,_+=y[b+1],y[b+1]=_,_+=y[b+2],y[b+2]=_,_+=y[b+3],y[b+3]=_,_+=y[b+4],y[b+4]=_,_+=y[b+5],y[b+5]=_,_+=y[b+6],y[b+6]=_,_+=y[b+7],y[b+7]=_,_+=y[b+8],y[b+8]=_,_+=y[b+9],y[b+9]=_,_+=y[b+10],y[b+10]=_,_+=y[b+11],y[b+11]=_,_+=y[b+12],y[b+12]=_,_+=y[b+13],y[b+13]=_,_+=y[b+14],y[b+14]=_,_+=y[b+15],y[b+15]=_,_+=y[b+16],y[b+16]=_,_+=y[b+17],y[b+17]=_,_+=y[b+18],y[b+18]=_,_+=y[b+19],y[b+19]=_,_+=y[b+20],y[b+20]=_,_+=y[b+21],y[b+21]=_,_+=y[b+22],y[b+22]=_,_+=y[b+23],y[b+23]=_,_+=y[b+24],y[b+24]=_,_+=y[b+25],y[b+25]=_,_+=y[b+26],y[b+26]=_,_+=y[b+27],y[b+27]=_,_+=y[b+28],y[b+28]=_,_+=y[b+29],y[b+29]=_,_+=y[b+30],y[b+30]=_,_+=y[b+31],y[b+31]=_;if(u=(Y-x)/M,f=(A-I)/M,h=(X-F)/M,r){for(b=0;z>b;b+=32)l=e[b],s=e[b+1],c=e[b+2],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~w,l=e[b+4],s=e[b+5],c=e[b+6],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+4]=~~g,e[b+5]=~~C,e[b+6]=~~w,l=e[b+8],s=e[b+9],c=e[b+10],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+8]=~~g,e[b+9]=~~C,e[b+10]=~~w,l=e[b+12],s=e[b+13],c=e[b+14],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+12]=~~g,e[b+13]=~~C,e[b+14]=~~w,l=e[b+16],s=e[b+17],c=e[b+18],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+16]=~~g,e[b+17]=~~C,e[b+18]=~~w,l=e[b+20],s=e[b+21],c=e[b+22],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+20]=~~g,e[b+21]=~~C,e[b+22]=~~w,l=e[b+24],s=e[b+25],c=e[b+26],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+24]=~~g,e[b+25]=~~C,e[b+26]=~~w,l=e[b+28],s=e[b+29],c=e[b+30],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+28]=~~g,e[b+29]=~~C,e[b+30]=~~w;if(S)for(b=z-S;z>b;b+=4)l=e[b],s=e[b+1],c=e[b+2],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~w}else{for(b=0;z>b;b+=32)l=e[b],s=e[b+1],c=e[b+2],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~w,l=e[b+4],s=e[b+5],c=e[b+6],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,e[b+4]=~~g,e[b+5]=~~C,e[b+6]=~~w,l=e[b+8],s=e[b+9],c=e[b+10],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,e[b+8]=~~g,e[b+9]=~~C,e[b+10]=~~w,l=e[b+12],s=e[b+13],c=e[b+14],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,e[b+12]=~~g,e[b+13]=~~C,e[b+14]=~~w,l=e[b+16],s=e[b+17],c=e[b+18],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,e[b+16]=~~g,e[b+17]=~~C,e[b+18]=~~w,l=e[b+20],s=e[b+21],c=e[b+22],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,e[b+20]=~~g,e[b+21]=~~C,e[b+22]=~~w,l=e[b+24],s=e[b+25],c=e[b+26],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,e[b+24]=~~g,e[b+25]=~~C,e[b+26]=~~w,l=e[b+28],s=e[b+29],c=e[b+30],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,e[b+28]=~~g,e[b+29]=~~C,e[b+30]=~~w;if(S)for(b=z-S;z>b;b+=4)l=e[b],s=e[b+1],c=e[b+2],g=d[l]*u+x,C=p[s]*f+I,w=y[c]*h+F,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~w}return e},apply:function(e,n,l){var s=this;if(!s._isOn)return e;if(a.RGB===s.mode)return s._apply_rgb(e,n,l);var c,u,f,h,d,p,y,m,v,_,g=0,C=255,w=e.length,b=w>>>2,Y=a.GRAY===s.mode,A=(7&b)<<2;if(m=new t(256),Y){for(_=0;w>_;_+=32)c=e[_],m[c]++,g=i(c,g),C=o(c,C),c=e[_+4],m[c]++,g=i(c,g),C=o(c,C),c=e[_+8],m[c]++,g=i(c,g),C=o(c,C),c=e[_+12],m[c]++,g=i(c,g),C=o(c,C),c=e[_+16],m[c]++,g=i(c,g),C=o(c,C),c=e[_+20],m[c]++,g=i(c,g),C=o(c,C),c=e[_+24],m[c]++,g=i(c,g),C=o(c,C),c=e[_+28],m[c]++,g=i(c,g),C=o(c,C);if(A)for(_=w-A;w>_;_+=4)c=e[_],m[c]++,g=i(c,g),C=o(c,C)}else{for(_=0;w>_;_+=32)c=e[_],u=e[_+1],f=e[_+2],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_]=p,e[_+1]=h,e[_+2]=d,m[h]++,g=i(h,g),C=o(h,C),c=e[_+4],u=e[_+5],f=e[_+6],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+4]=p,e[_+5]=h,e[_+6]=d,m[h]++,g=i(h,g),C=o(h,C),c=e[_+8],u=e[_+9],f=e[_+10],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+8]=p,e[_+9]=h,e[_+10]=d,m[h]++,g=i(h,g),C=o(h,C),c=e[_+12],u=e[_+13],f=e[_+14],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+12]=p,e[_+13]=h,e[_+14]=d,m[h]++,g=i(h,g),C=o(h,C),c=e[_+16],u=e[_+17],f=e[_+18],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+16]=p,e[_+17]=h,e[_+18]=d,m[h]++,g=i(h,g),C=o(h,C),c=e[_+20],u=e[_+21],f=e[_+22],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+20]=p,e[_+21]=h,e[_+22]=d,m[h]++,g=i(h,g),C=o(h,C),c=e[_+24],u=e[_+25],f=e[_+26],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+24]=p,e[_+25]=h,e[_+26]=d,m[h]++,g=i(h,g),C=o(h,C),c=e[_+28],u=e[_+29],f=e[_+30],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_+28]=p,e[_+29]=h,e[_+30]=d,m[h]++,g=i(h,g),C=o(h,C);if(A)for(_=w-A;w>_;_+=4)c=e[_],u=e[_+1],f=e[_+2],h=~~(0+.299*c+.587*u+.114*f),d=~~(128-.168736*c-.331264*u+.5*f),p=~~(128+.5*c-.418688*u-.081312*f),p=0>p?0:p>255?255:p,h=0>h?0:h>255?255:h,d=0>d?0:d>255?255:d,e[_]=p,e[_+1]=h,e[_+2]=d,m[h]++,g=i(h,g),C=o(h,C)}for(v=0,_=0;256>_;_+=32)v+=m[_],m[_]=v,v+=m[_+1],m[_+1]=v,v+=m[_+2],m[_+2]=v,v+=m[_+3],m[_+3]=v,v+=m[_+4],m[_+4]=v,v+=m[_+5],m[_+5]=v,v+=m[_+6],m[_+6]=v,v+=m[_+7],m[_+7]=v,v+=m[_+8],m[_+8]=v,v+=m[_+9],m[_+9]=v,v+=m[_+10],m[_+10]=v,v+=m[_+11],m[_+11]=v,v+=m[_+12],m[_+12]=v,v+=m[_+13],m[_+13]=v,v+=m[_+14],m[_+14]=v,v+=m[_+15],m[_+15]=v,v+=m[_+16],m[_+16]=v,v+=m[_+17],m[_+17]=v,v+=m[_+18],m[_+18]=v,v+=m[_+19],m[_+19]=v,v+=m[_+20],m[_+20]=v,v+=m[_+21],m[_+21]=v,v+=m[_+22],m[_+22]=v,v+=m[_+23],m[_+23]=v,v+=m[_+24],m[_+24]=v,v+=m[_+25],m[_+25]=v,v+=m[_+26],m[_+26]=v,v+=m[_+27],m[_+27]=v,v+=m[_+28],m[_+28]=v,v+=m[_+29],m[_+29]=v,v+=m[_+30],m[_+30]=v,v+=m[_+31],m[_+31]=v;if(y=(g-C)/b,r)if(Y){for(_=0;w>_;_+=32)c=~~(m[e[_]]*y+C),c=0>c?0:c>255?255:c,e[_]=c,e[_+1]=c,e[_+2]=c,c=~~(m[e[_+4]]*y+C),c=0>c?0:c>255?255:c,e[_+4]=c,e[_+5]=c,e[_+6]=c,c=~~(m[e[_+8]]*y+C),c=0>c?0:c>255?255:c,e[_+8]=c,e[_+9]=c,e[_+10]=c,c=~~(m[e[_+12]]*y+C),c=0>c?0:c>255?255:c,e[_+12]=c,e[_+13]=c,e[_+14]=c,c=~~(m[e[_+16]]*y+C),c=0>c?0:c>255?255:c,e[_+16]=c,e[_+17]=c,e[_+18]=c,c=~~(m[e[_+20]]*y+C),c=0>c?0:c>255?255:c,e[_+20]=c,e[_+21]=c,e[_+22]=c,c=~~(m[e[_+24]]*y+C),c=0>c?0:c>255?255:c,e[_+24]=c,e[_+25]=c,e[_+26]=c,c=~~(m[e[_+28]]*y+C),c=0>c?0:c>255?255:c,e[_+28]=c,e[_+29]=c,e[_+30]=c;if(A)for(_=w-A;w>_;_+=4)c=~~(m[e[_]]*y+C),c=0>c?0:c>255?255:c,e[_]=c,e[_+1]=c,e[_+2]=c}else{for(_=0;w>_;_+=32)h=m[e[_+1]]*y+C,d=e[_+2],p=e[_],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_]=c,e[_+1]=u,e[_+2]=f,h=m[e[_+5]]*y+C,d=e[_+6],p=e[_+4],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+4]=c,e[_+5]=u,e[_+6]=f,h=m[e[_+9]]*y+C,d=e[_+10],p=e[_+8],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+8]=c,e[_+9]=u,e[_+10]=f,h=m[e[_+13]]*y+C,d=e[_+14],p=e[_+12],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+12]=c,e[_+13]=u,e[_+14]=f,h=m[e[_+17]]*y+C,d=e[_+18],p=e[_+16],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+16]=c,e[_+17]=u,e[_+18]=f,h=m[e[_+21]]*y+C,d=e[_+22],p=e[_+20],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+20]=c,e[_+21]=u,e[_+22]=f,h=m[e[_+25]]*y+C,d=e[_+26],p=e[_+24],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+24]=c,e[_+25]=u,e[_+26]=f,h=m[e[_+29]]*y+C,d=e[_+30],p=e[_+28],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+28]=c,e[_+29]=u,e[_+30]=f;if(A)for(_=w-A;w>_;_+=4)h=m[e[_+1]]*y+C,d=e[_+2],p=e[_],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_]=c,e[_+1]=u,e[_+2]=f}else if(Y){for(_=0;w>_;_+=32)c=~~(m[e[_]]*y+C),e[_]=c,e[_+1]=c,e[_+2]=c,c=~~(m[e[_+4]]*y+C),e[_+4]=c,e[_+5]=c,e[_+6]=c,c=~~(m[e[_+8]]*y+C),e[_+8]=c,e[_+9]=c,e[_+10]=c,c=~~(m[e[_+12]]*y+C),e[_+12]=c,e[_+13]=c,e[_+14]=c,c=~~(m[e[_+16]]*y+C),e[_+16]=c,e[_+17]=c,e[_+18]=c,c=~~(m[e[_+20]]*y+C),e[_+20]=c,e[_+21]=c,e[_+22]=c,c=~~(m[e[_+24]]*y+C),e[_+24]=c,e[_+25]=c,e[_+26]=c,c=~~(m[e[_+28]]*y+C),e[_+28]=c,e[_+29]=c,e[_+30]=c;if(A)for(_=w-A;w>_;_+=4)c=~~(m[e[_]]*y+C),e[_]=c,e[_+1]=c,e[_+2]=c}else{for(_=0;w>_;_+=32)h=m[e[_+1]]*y+C,d=e[_+2],p=e[_],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_]=c,e[_+1]=u,e[_+2]=f,h=m[e[_+5]]*y+C,d=e[_+6],p=e[_+4],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+4]=c,e[_+5]=u,e[_+6]=f,h=m[e[_+9]]*y+C,d=e[_+10],p=e[_+8],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+8]=c,e[_+9]=u,e[_+10]=f,h=m[e[_+13]]*y+C,d=e[_+14],p=e[_+12],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+12]=c,e[_+13]=u,e[_+14]=f,h=m[e[_+17]]*y+C,d=e[_+18],p=e[_+16],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+16]=c,e[_+17]=u,e[_+18]=f,h=m[e[_+21]]*y+C,d=e[_+22],p=e[_+20],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+20]=c,e[_+21]=u,e[_+22]=f,h=m[e[_+25]]*y+C,d=e[_+26],p=e[_+24],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+24]=c,e[_+25]=u,e[_+26]=f,h=m[e[_+29]]*y+C,d=e[_+30],p=e[_+28],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_+28]=c,e[_+29]=u,e[_+30]=f;if(A)for(_=w-A;w>_;_+=4)h=m[e[_+1]]*y+C,d=e[_+2],p=e[_],c=~~(h+1.402*(p-128)),u=~~(h-.34414*(d-128)-.71414*(p-128)),f=~~(h+1.772*(d-128)),e[_]=c,e[_+1]=u,e[_+2]=f}return e}})}(r),!function(e){var r=e.ImArray,t=Math.sqrt,a=Math.min;Math.max,t(3);e.Create({name:"PixelateFilter",scale:1,init:function(e){var r=this;r.scale=e||1},path:n,serialize:function(){var e=this;return{scale:e.scale}},unserialize:function(e){var r=this;return r.scale=e.scale,r},apply:function(e,n,o){var i=this;if(!i._isOn||i.scale<=1)return e;i.scale>100&&(i.scale=100);var l,s,c,u,f,h,d,p,y,m,v,_,g,C,w,b,Y,A,X,x,I,F=e.length,z=F>>>2,M=n-1,S=z-n;for(l=new r(F),s=t(z)*i.scale*.01|0,c=s-1,u=n*c,g=C=w=b=Y=0,_=0;F>_;_+=4)A=g-w,X=C-Y,x=a(M,A+c),I=a(S,X+u),f=A+X<<2,h=A+I<<2,d=x+X<<2,p=x+I<<2,y=e[f]+e[h]+e[d]+e[p],m=e[f+1]+e[h+1]+e[d+1]+e[p+1],v=e[f+2]+e[h+2]+e[d+2]+e[p+2],l[_]=.25*y|0,l[_+1]=.25*m|0,l[_+2]=.25*v|0,l[_+3]=e[_+3],g++,w++,g>=n&&(w=0,g=0,b++,Y+=n,C+=n,b>=s&&(b=0,Y=0)),w>=s&&(w=0);return l}}),e.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var r=this;r.scale=e||1},path:n,serialize:function(){var e=this;return{scale:e.scale}},unserialize:function(e){var r=this;return r.scale=e.scale,r},apply:function(e,n,o){var i=this;if(!i._isOn||i.scale<=1)return e;i.scale>100&&(i.scale=100);var l,s,c,u,f,h,d,p,y,m,v,_,g,C,w,b,Y,A,X,x,I=e.length,F=I>>>2,z=n-1,M=F-n;for(l=new r(I),s=t(F)*i.scale*.01|0,c=s-1,u=n*c,_=g=C=w=b=0,v=0;I>v;v+=4)Y=_-C,A=g-b,X=a(z,Y+c),x=a(M,A+u),C+w>c?(f=X+A<<2,h=X+x<<2,d=Y+A<<2):(f=Y+A<<2,h=Y+x<<2,d=X+A<<2),p=e[f]+e[h]+e[d],y=e[f+1]+e[h+1]+e[d+1],m=e[f+2]+e[h+2]+e[d+2],l[v]=.333*p|0,l[v+1]=.333*y|0,l[v+2]=.333*m|0,l[v+3]=e[v+3],_++,C++,_>=n&&(C=0,_=0,w++,b+=n,g+=n,w>=s&&(w=0,b=0)),C>=s&&(C=0);return l}})}(r),!function(e,r){var t=7/16,a=3/16,o=5/16,i=1/16,l=e.MODE,s=e.Array32F,c=e.Color.clamp,u=e.Color.intensity;e.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:l.GRAY,init:function(e,r,n){var t=this;t.size=e||1,t.thresh=c(null==r?.4:r,0,1),t.mode=n||l.GRAY},path:n,threshold:function(e){return this.thresh=c(e,0,1),this},grayscale:function(e){return arguments.length||(e=!0),this.mode=e?l.GRAY:l.RGB,this},serialize:function(){var e=this;return{size:e.size,thresh:e.thresh,mode:e.mode}},unserialize:function(e){var r=this;return r.size=e.size,r.thresh=e.thresh,r.mode=e.mode,r},apply:function(e,r,n){var c,f,h,d,p,y,m,v,_,g,C,w,b,Y,A,X,x,I,F,z,M,S=this,O=e.length,R=O>>>2,E=new s(3*R),L=S.size,T=L*L,N=1/T,U=255*S.thresh,G=G<<1,P=l.RGB===S.mode,q=L*r,H=t,D=a,$=o,k=i;for(p=0,y=0,d=0;n>p;){if(g=C=w=0,P){for(m=0,v=0,_=0;L>v;)c=d+y+m+_<<2,f=3*(d+y+m+_),g+=e[c]+E[f],C+=e[c+1]+E[f+1],w+=e[c+2]+E[f+2],++m>=L&&(m=0,v++,_+=r);g*=N,C*=N,w*=N,h=u(g,C,w),h>U?(b=0|g,Y=0|C,A=0|w):(b=0,Y=0,A=0)}else{for(m=0,v=0,_=0;L>v;)c=d+y+m+_<<2,f=3*(d+y+m+_),g+=e[c]+E[f],++m>=L&&(m=0,v++,_+=r);h=g*N,h>U?(b=255,Y=255,A=255):(b=0,Y=0,A=0)}if(c=d+y<<2,X=e[c]-b,x=e[c+1]-Y,I=e[c+2]-A,r>d+L)for(F=H*X,z=H*x,M=H*I,m=L,v=0,_=0;L>v;)f=3*(d+y+m+_),E[f]+=F,E[f+1]+=z,E[f+2]+=M,++m>=G&&(m=L,v++,_+=r);if(n>p+L&&d>L)for(F=D*X,z=D*x,M=D*I,m=-L,v=L,_=0;G>v;)f=3*(d+y+m+_),E[f]+=F,E[f+1]+=z,E[f+2]+=M,++m>=0&&(m=-L,v++,_+=r);if(n>p+L)for(F=$*X,z=$*x,M=$*I,m=0,v=L,_=0;G>v;)f=3*(d+y+m+_),E[f]+=F,E[f+1]+=z,E[f+2]+=M,++m>=L&&(m=0,v++,_+=r);if(n>p+L&&r>d+L)for(F=k*X,z=k*x,M=k*I,m=L,v=L,_=0;G>v;)f=3*(d+y+m+_),E[f]+=F,E[f+1]+=z,E[f+2]+=M,++m>=G&&(m=L,v++,_+=r);for(m=0,v=0,_=0;L>v;)c=d+y+m+_<<2,e[c]=b,e[c+1]=Y,e[c+2]=A,++m>=L&&(m=0,v++,_+=r);d+=L,d>=r&&(d=0,p+=L,y+=q)}return e}})}(r),!function(e,r){var t=e.ImArray,a=e.Util.Filter.integral_convolution,o=new e.ConvolutionMatrix([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]);e.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:1,onlyShadow:!1,path:n,init:function(e,r,n,t,a,o){var i=this;i.offsetX=e||0,i.offsetY=r||0,i.color=n||0,i.opacity=null==t?1:+t,i.quality=0|(a||1),i.onlyShadow=!!o},dispose:function(){var e=this;return e.offsetX=null,e.offsetY=null,e.color=null,e.opacity=null,e.quality=null,e.onlyShadow=null,e.$super("dispose"),e},serialize:function(){var e=this;return{offsetX:e.offsetX,offsetY:e.offsetY,color:e.color,opacity:e.opacity,quality:e.quality,onlyShadow:e.onlyShadow}},unserialize:function(e){var r=this;return r.offsetX=e.offsetX,r.offsetY=e.offsetY,r.color=e.color,r.opacity=e.opacity,r.quality=e.quality,r.onlyShadow=e.onlyShadow,r},apply:function(e,r,n){var i=this;if(!i._isOn)return e;var l,s,c,u,f,h,d,p,y,m,v,_=i.color||0,g=i.opacity,C=i.quality,w=i.onlyShadow,b=i.offsetX||0,Y=i.offsetY||0,A=e.length,X=A>>>2;if(0>g&&(g=0),g>1&&(g=1),0===g)return e;for(l=_>>>16&255,s=_>>>8&255,c=255&_,0>=C&&(C=1),C>3&&(C=3),v=new t(A),u=0;A>u;u+=4)m=e[u+3],m>0&&(v[u]=l,v[u+1]=s,v[u+2]=c,v[u+3]=g*m|0);if(v=a(!1,v,r,n,o,null,3,3,1,0,C),Y*=r,w)for(f=0,h=0,y=0;A>y;y+=4,f++)f>=r&&(f=0,h+=r),d=f+b,p=h+Y,0>d||d>=r||0>p||p>=X||(u=d+p<<2,e[u]=v[y],e[u+1]=v[y+1],e[u+2]=v[y+2],e[u+3]=v[y+3]);else for(f=0,h=0,y=0;A>y;y+=4,f++)f>=r&&(f=0,h+=r),d=f+b,p=h+Y,0>d||d>=r||0>p||p>=X||(u=d+p<<2,m=e[u+3],g=v[y+3],255!==m&&0!==g&&(g/=255,l=e[u]+(v[y]-e[u])*g,s=e[u+1]+(v[y+1]-e[u+1])*g,c=e[u+2]+(v[y+2]-e[u+2])*g,e[u]=0|l,e[u+1]=0|s,e[u+2]=0|c));return e}})}(r),!function(e){var r=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,o=e._notSupportClamp,i=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,r,n,t){var a=this;a.centerX=e||0,a.centerY=r||0,a.radius=n||10,a.amount=t||10},path:n,serialize:function(){var e=this;return{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}},unserialize:function(e){var r=this;return r.centerX=e.centerX,r.centerY=e.centerY,r.radius=e.radius,r.amount=e.amount,r},apply:function(e,n,l){var s=this;if(!s._isOn)return e;var c,u,f,h,d,p,y,m,v,_,g,C,w,b,Y,A,X,x,I,F,z,M,S,O,R,E,L,T,N,U,G,P,q,H=e.length,D=s.centerX||0,$=s.centerY||0,k=s.radius,j=s.amount;if(0>=j)return e;for(c=H>>>2,U=0,G=n-1,P=0,q=c-n,D=a(D*(n-1)),$=a($*(l-1)),f=(c<<1)+c,y=(n<<1)+n,u=new i(f),m=0,v=0,_=0,h=d=p=0,_=0;n>_;_++,m+=4,v+=3)h+=e[m],d+=e[m+1],p+=e[m+2],u[v]=h,u[v+1]=d,u[v+2]=p;for(m=y+n,v=0,_=0,h=d=p=0,m=y+n;H>m;m+=4,v+=3,_++)_>=n&&(_=0,h=d=p=0),h+=e[m],d+=e[m+1],p+=e[m+2],u[v+y]=u[v]+h,u[v+y+1]=u[v+1]+d,u[v+y+2]=u[v+2]+p;for(_=0,g=0,C=0,m=0;H>m;m+=4,_++)_>=n&&(_=0,g++,C+=n),b=_-D,Y=g-$,w=t(b)+t(Y),A=w>k?0|r((w-k)*j):w/k+.5|0,A>0&&(X=A*n,x=.25/(A*A),I=_-A,F=C-X,z=_+A,M=C+X,U>I?I=U:z>G&&(z=G),P>F?F=P:M>q&&(M=q),S=I+F,E=z+M,O=z+F,R=I+M,S=(S<<1)+S,O=(O<<1)+O,R=(R<<1)+R,E=(E<<1)+E,L=x*(u[E]-u[O]-u[R]+u[S]),T=x*(u[E+1]-u[O+1]-u[R+1]+u[S+1]),N=x*(u[E+2]-u[O+2]-u[R+2]+u[S+2]),o&&(L=0>L?0:L>255?255:L,T=0>T?0:T>255?255:T,N=0>N?0:N>255?255:N),e[m]=0|L,e[m+1]=0|T,e[m+2]=0|N);return e}})}(r),!function(e){e.Create({name:"SeamlessTileFilter",type:2,init:function(e){var r=this;r.type=null==e?2:e||0},path:n,serialize:function(){var e=this;return{type:e.type}},unserialize:function(e){var r=this;return r.type=e.type,r},apply:function(r,n,t){var a,o,i,l,s,c,u,f,h,d,p,y,m,v,_,g=this,C=g.type,w=e.Interpolation.bilinear,b=e.ImArray,Y=e.Array8U,A=Math.sqrt;for(n!==t?r=w(r,n,t,y=n>t?n:t,y):y=n,m=Math.round(y/2),v=y*y,_=r.length,a=new b(_),o=new b(_),i=new Y(v),f=0,h=0,d=0;_>d;d+=4,f++)f>=y&&(f=0,h++),p=(f+m)%y+(h+m)%y*y<<2,a[p]=r[d],a[p+1]=r[d+1],a[p+2]=r[d+2],a[p+3]=r[d+3];if(0===C)for(f=0,h=0;m>f;h++)h>=m&&(h=0,f++),u=255-255*A((f-m)*(f-m)+(h-m)*(h-m))/m,u=1>u?1:u>255?255:u,i[f+h*y]=u,i[f+(y-1-h)*y]=u,i[y-1-f+h*y]=u,i[y-1-f+(y-1-h)*y]=u;else if(1===C)for(f=0,h=0;m>f;h++)h>=m&&(h=0,f++),u=255-255*(m+f>m+h?(h-m)/m:(f-y/2)/m),u=1>u?1:u>255?255:u,i[f+h*y]=u,i[f+(y-1-h)*y]=u,i[y-1-f+h*y]=u,i[y-1-f+(y-1-h)*y]=u;else for(f=0,h=0;m>f;h++)h>=m&&(h=0,f++),u=255-255*(m+f>m+h?A((h-y)*(h-y)+(f-y)*(f-y))/(1.13*y):A((f-y)*(f-y)+(h-y)*(h-y))/(1.13*y)),u=1>u?1:u>255?255:u,i[f+h*y]=u,i[f+(y-1-h)*y]=u,i[y-1-f+h*y]=u,i[y-1-f+(y-1-h)*y]=u;for(h=0,f=0;y>h;f++)f>=y&&(f=0,h++),p=f+h*y,l=i[p],s=i[(f+m)%y+(h+m)%y*y],c=l+s,l/=c,s/=c,p<<=2,o[p]=~~(l*r[p]+s*a[p]),o[p+1]=~~(l*r[p+1]+s*a[p+1]),o[p+2]=~~(l*r[p+2]+s*a[p+2]),o[p+3]=r[p+3];return n!==t&&(o=w(o,y,y,n,t)),o}})}(r),!function(e){var r=(e.Util.Array.typed,Math.abs),t=(Math.min,Math.max,Math.ceil),a=e.MODE,o=e.Array8U,i=e.Array32U;e.Create({name:"FloodFillFilter",x:0,y:0,color:null,borderColor:null,tolerance:0,path:n,init:function(e,r,n,t,a){var o=this;o.x=e||0,o.y=r||0,o.color=n||0,o.tolerance=t||0,o.borderColor=a===+a?+a:null},serialize:function(){var e=this;return{color:e.color,borderColor:e.borderColor,x:e.x,y:e.y,tolerance:e.tolerance}},unserialize:function(e){var r=this;return r.color=e.color,r.borderColor=e.borderColor,r.x=e.x,r.y=e.y,r.tolerance=e.tolerance,r},apply:function(e,n,t){var a,i,l,s,c,u,f,h,d,p,y,m,v=this,_=255*(v.tolerance>=1?.999:v.tolerance)|0,g=v.color||0,C=v.borderColor,w=C===+C,b=n<<2,Y=v.x,A=v.y,X=e.length,x=0,I=X-b,F=0,z=n-1<<2;if(h=A*n<<2,Y<<=2,F>Y||Y>z||x>h||h>I)return e;if(a=new o(3),i=new o(3),i[0]=g>>>16&255,i[1]=g>>>8&255,i[2]=255&g,w){if(a[0]=C>>>16&255,a[1]=C>>>8&255,a[2]=255&C,r(a[0]-e[Y+h])<=_&&r(a[1]-e[Y+h+1])<=_&&r(a[2]-e[Y+h+2])<=_)return e}else{if(e[Y+h]===i[0]&&e[Y+h+1]===i[1]&&e[Y+h+2]===i[2])return e;a[0]=e[Y+h],a[1]=e[Y+h+1],a[2]=e[Y+h+2]}for(d=new Array(X>>>2),p=0,h+b>=x&&I>=h+b&&(d[p++]=[h,Y,Y,b]),d[p++]=[h+b,Y,Y,-b];p>0;){if(y=d[--p],h=y[0]+(b=y[3]),u=y[1],f=y[2],w)for(c=u;c>=F&&(s=c+h,!(r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_));c-=4)e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2];else for(c=u;c>=F&&(s=c+h,r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_);c-=4)e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2];if(c>=u){if(s=c+h,w)for(;f>=c&&r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_;)c+=4,s=c+h;else for(;f>=c&&!(r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_);)c+=4,s=c+h;l=c,m=f>=c}else l=c+4,u>l&&h-b>=x&&I>=h-b&&(d[p++]=[h,l,u-4,-b]),c=u+4,m=!0;for(;m;){if(s=c+h,w)for(;z>=c&&!(r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_);)e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2],c+=4,s=c+h;else for(;z>=c&&r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_;)e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2],c+=4,s=c+h;if(h+b>=x&&I>=h+b&&(d[p++]=[h,l,c-4,b]),c>f+4&&h-b>=x&&I>=h-b&&(d[p++]=[h,f+4,c-4,-b]),s=c+h,w)for(;f>=c&&r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_;)c+=4,s=c+h;else for(;f>=c&&!(r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_);)c+=4,s=c+h;l=c,m=f>=c}}return e}}),e.ColorFillFilter=e.FloodFillFilter,e.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:0,mode:a.TILE,borderColor:null,hasInputs:!0,path:n,init:function(e,r,n,t,o,i,l,s){var c=this;c.x=e||0,c.y=r||0,c.offsetX=t||0,c.offsetY=o||0,n&&c.setInput("pattern",n),c.mode=i||a.TILE,c.tolerance=l||0,c.borderColor=s===+s?+s:null},dispose:function(){var e=this;return e.x=null,e.y=null,e.offsetX=null,e.offsetY=null,e.tolerance=null,e.mode=null,e.borderColor=null,e.$super("dispose"),e},serialize:function(){var e=this;return{x:e.x,y:e.y,offsetX:e.offsetX,offsetY:e.offsetY,tolerance:e.tolerance,mode:e.mode,borderColor:e.borderColor}},unserialize:function(e){var r=this;return r.x=e.x,r.y=e.y,r.offsetX=e.offsetX,r.offsetY=e.offsetY,r.tolerance=e.tolerance,r.mode=e.mode,r.borderColor=e.borderColor,r},apply:function(e,n,l){var s,c=this;if(!c._isOn)return e;if(s=c.input("pattern"),!s)return e;var u,f,h,d,p,y,m,v,_,g,C,w,b,Y,A,X,x=255*(c.tolerance>=1?.999:c.tolerance)|0,I=c.mode,F=c.borderColor,z=F===+F,M=n<<2,S=s[0],O=s[1],R=s[2],E=c.x,L=c.y,T=c.offsetX||0,N=c.offsetY||0,U=e.length,G=U>>>2,P=0,q=U-M,H=0,D=n-1<<2,$=a.STRETCH;if(0>T&&(T+=O),0>N&&(N+=R),p=L,v=L*n<<2,E<<=2,H>E||E>D||P>v||v>q)return e;if(u=new o(3),z){if(u[0]=F>>>16&255,u[1]=F>>>8&255,u[2]=255&F,r(u[0]-e[E+v])<=x&&r(u[1]-e[E+v+1])<=x&&r(u[2]-e[E+v+2])<=x)return e}else u[0]=e[E+v],u[1]=e[E+v+1],u[2]=e[E+v+2];for(w=new Array(G),b=0,Y=new i(t(G/32)),v+M>=P&&q>=v+M&&(w[b++]=[v,E,E,M,p+1]),w[b++]=[v+M,E,E,-M,p];b>0;){if(A=w[--b],v=A[0]+(M=A[3]),y=A[1],m=A[2],p=A[4],z)for(d=y;d>=H&&(h=d+v,!(Y[h>>>7]&1<<(h>>>2&31)||r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x));d-=4)Y[h>>>7]|=1<<(h>>>2&31),$===I?(g=O*(d>>>2)/n|0,C=R*p/l|0):(g=((d>>>2)+T)%O,C=(p+N)%R),_=g+C*O<<2,e[h]=S[_],e[h+1]=S[_+1],e[h+2]=S[_+2];else for(d=y;d>=H&&(h=d+v,!(Y[h>>>7]&1<<(h>>>2&31))&&r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x);d-=4)Y[h>>>7]|=1<<(h>>>2&31),$===I?(g=O*(d>>>2)/n|0,C=R*p/l|0):(g=((d>>>2)+T)%O,C=(p+N)%R),_=g+C*O<<2,e[h]=S[_],e[h+1]=S[_+1],e[h+2]=S[_+2];if(d>=y){if(h=d+v,z)for(;m>=d&&Y[h>>>7]&1<<(h>>>2&31)||r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x;)d+=4,h=d+v;else for(;m>=d&&!(!(Y[h>>>7]&1<<(h>>>2&31))&&r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x);)d+=4,h=d+v;f=d,X=m>=d;
}else f=d+4,y>f&&v-M>=P&&q>=v-M&&(w[b++]=[v,f,y-4,-M,M>0?p-1:p+1]),d=y+4,X=!0;for(;X;){if(h=d+v,z)for(;D>=d&&!(Y[h>>>7]&1<<(h>>>2&31))&&!(r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x);)Y[h>>>7]|=1<<(h>>>2&31),$===I?(g=O*(d>>>2)/n|0,C=R*p/l|0):(g=((d>>>2)+T)%O,C=(p+N)%R),_=g+C*O<<2,e[h]=S[_],e[h+1]=S[_+1],e[h+2]=S[_+2],d+=4,h=d+v;else for(;D>=d&&!(Y[h>>>7]&1<<(h>>>2&31))&&r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x;)Y[h>>>7]|=1<<(h>>>2&31),$===I?(g=O*(d>>>2)/n|0,C=R*p/l|0):(g=((d>>>2)+T)%O,C=(p+N)%R),_=g+C*O<<2,e[h]=S[_],e[h+1]=S[_+1],e[h+2]=S[_+2],d+=4,h=d+v;if(v+M>=P&&q>=v+M&&(w[b++]=[v,f,d-4,M,M>0?p+1:p-1]),d>m+4&&v-M>=P&&q>=v-M&&(w[b++]=[v,m+4,d-4,-M,M>0?p-1:p+1]),h=d+v,z)for(;m>=d&&Y[h>>>7]&1<<(h>>>2&31)||r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x;)d+=4,h=d+v;else for(;m>=d&&!(!(Y[h>>>7]&1<<(h>>>2&31))&&r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x);)d+=4,h=d+v;f=d,X=m>=d}}return e}})}(r),!function(e){function r(e,r,n,t){var a,i,y,m,v,_=2,g=14,C=(e.length,t.length),w=new o(C),b=new o(C),Y=new o(C),A=new o(C),X=new o(g),x=new o(g),I=_*_,F=2*I,z=f*I;for(a=0;g>a&&(i=h(-(a*a)/F),!(l>=i&&a>=2));a++)y=h(-((v=a-.5)*v)/F),m=h(-((v=a+.5)*v)/F),X[a]=(i+y+m)/3/z,x[a]=m-y;var v,M,S,O,R,E,L,T,N,U=a-1,G=r-(a-1),P=r*(a-1),q=r*(n-(a-1));for(v=U,M=P;G>v;M+=r){for(M>=q&&(M=P,v++),S=v+M,O=e[S<<2]*X[0],R=O,E=1,L=r;a>E;)R+=X[E]*(e[S-L<<2]+e[S+L<<2]),O+=X[E]*(e[S-E<<2]+e[S+E<<2]),L+=r,E++;b[S]=R,w[S]=O}for(v=U,M=P;G>v;M+=r){for(M>=q&&(M=P,v++),T=0,S=v+M,N=1;a>N;N++)T+=x[N]*(b[S-N]-b[S+N]);Y[S]=T}for(G=r-a,v=a,M=P;G>v;M+=r){for(M>=q&&(M=P,v++),T=0,S=v+M,L=r,N=1;a>N;N++)T+=x[N]*(w[S-L]-w[S+L]),L+=r;A[S]=T}U=a,G=r-a,P=r*a,q=r*(n-a);var H,D,$,k,j,B,K,W,J,Q,V,Z,ee,re,ne,te,ae,oe,ie,le;for(v=U,M=P;G>v;M+=r)M>=q&&(M=P,v++),S=v+M,H=S-r,D=S+r,k=S-1,$=S+1,j=H-1,B=H+1,K=D-1,W=D+1,J=Y[S],Q=A[S],V=d(J)+d(Q),ee=d(Y[H])+d(A[H]),re=d(Y[D])+d(A[D]),te=d(Y[k])+d(A[k]),ne=d(Y[$])+d(A[$]),oe=d(Y[B])+d(A[B]),le=d(Y[W])+d(A[W]),ie=d(Y[K])+d(A[K]),ae=d(Y[j])+d(A[j]),(0>=J*Q?d(J)>=d(Q)?(Z=d(J*V))>=d(Q*oe-(J+Q)*ne)&&Z>d(Q*ie-(J+Q)*te):(Z=d(Q*V))>=d(J*oe-(Q+J)*ee)&&Z>d(J*ie-(Q+J)*re):d(J)>=d(Q)?(Z=d(J*V))>=d(Q*le+(J-Q)*ne)&&Z>d(Q*ae+(J-Q)*te):(Z=d(Q*V))>=d(J*le+(Q-J)*re)&&Z>d(J*ae+(Q-J)*ee))?t[S]=V>=c?u:p(s*V):t[S]=0}function t(e,r,n,t,o,i){var l,s,c,u,f=e.length,h=f>>>2;for(l=0;f>l;l+=4)e[l]=e[l+1]=e[l+2]=0;for(u=0,c=0,s=0,l=0;h>s;s++,l=s<<2,u++)u>=r&&(u=0,c++),0===e[l]&&t[s]>=i&&a(e,r,n,t,u,c,l,o)}function a(e,r,n,t,o,i,l,s){var c,u,f,h,d,p=0===o?o:o-1,y=o===r-1?o:o+1,m=0===i?i:i-1,v=i===n-1?i:i+1,_=m*r;for(e[l]=e[l+1]=e[l+2]=255,c=p,u=m,f=_;y>=c&&v>=u;){if(d=c+f,h=d<<2,(u!==i||c!==o)&&0===e[h]&&t[d]>=s)return void a(e,r,n,t,c,u,h,s);u++,f+=r,u>v&&(u=m,f=_,c++)}}var o=e.Array32F,i=e.Array32I,l=(e.Util.Filter.GRAD,.005),s=100,c=1e3,u=s*c,f=2*Math.PI,h=Math.exp,d=Math.abs,p=Math.floor,y=Math.round;e.Util.Filter.canny_gradient=r,e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,path:n,init:function(e,r){var n=this;n.low=arguments.length<1?2.5:e,n.high=arguments.length<2?7.5:r},thresholds:function(e,r){var n=this;return n.low=e,n.high=r,n},serialize:function(){var e=this;return{low:e.low,high:e.high}},unserialize:function(e){var r=this;return r.low=e.low,r.high=e.high,r},apply:function(r,n,a){var o,l=this,c=r.length>>2,u=e.Util.Filter.canny_gradient;return u(r,n,a,o=new i(c)),t(r,n,a,o,y(l.low*s),y(l.high*s)),r}})}(r),!function(e,r){function t(e,r,n,t,a,o,i,l,s,c,u,f,p,y,m,g,C){var w,b,Y,A,X,x,I,F,z,M,S,O,R,E,L,T,N,U,G,P,q,H,D,$,k,j,B,K,W,J,Q,V,Z,ee,G,re,ne,te,ae,oe,ie,le,se,ce,ue,fe,he,de,pe,ye,me,ve,_e,ge=null!=m,Ce=o-t+1,we=i-a+1,be=Ce*we,Ye=be-1,Ae=l.stages,Xe=Ae.length,xe=l.size1,Ie=l.size2,Fe=h(Ce/xe,we/Ie),ze=t,Me=a;for(P=0,q=Ce-1,H=0,D=be-Ce,w=s,w=s;Fe>=w;w*=c)for(A=w*xe|0,b=A*u|0,X=w*Ie|0,Y=X*u|0,M=X*Ce,S=Y*Ce,x=Me*S,T=Ce-A,N=we-X,$=A*X,k=1/$,F=Me,z=x;N>F;F+=Y,z+=S)for(I=ze;T>I;I+=b)if(O=I-1+z-Ce,R=O+A,E=O+M,L=E+A,O=0>O?0:O>Ye?Ye:O,R=0>R?0:R>Ye?Ye:R,E=0>E?0:E>Ye?Ye:E,L=0>L?0:L>Ye?Ye:L,!(ge&&(W=k*(m[L]-m[E]-m[R]+m[O]),g>W||W>C))){for(j=k*(f[L]-f[E]-f[R]+f[O]),B=k*(y[L]-y[E]-y[R]+y[O]),K=B-j*j,K=K>1?d(K):1,J=!1,U=0;Xe>U;U++){for(Q=Ae[U],V=Q.thres,Z=Q.trees,ee=Z.length,_e=0,G=0;ee>G;G++)for(ne=Z[G].feats,re=0;;){if(te=ne[re],ae=te.rects,oe=ae.length,ie=te.thres,le=0,te.tilt)for(se=0;oe>se;se++)ce=ae[se],ue=I+w*ce[0]|0,fe=(F-1+w*ce[1]|0)*Ce,he=I+w*(ce[0]+ce[2])|0,de=(F-1+w*(ce[1]+ce[2])|0)*Ce,pe=I+w*(ce[0]-ce[3])|0,ye=(F-1+w*(ce[1]+ce[3])|0)*Ce,me=I+w*(ce[0]+ce[2]-ce[3])|0,ve=(F-1+w*(ce[1]+ce[2]+ce[3])|0)*Ce,ue=P>ue?P:ue>q?q:ue,he=P>he?P:he>q?q:he,pe=P>pe?P:pe>q?q:pe,me=P>me?P:me>q?q:me,fe=H>fe?H:fe>D?D:fe,de=H>de?H:de>D?D:de,ye=H>ye?H:ye>D?D:ye,ve=H>ve?H:ve>D?D:ve,le+=ce[4]*(p[me+ve]-p[pe+ye]-p[he+de]+p[ue+fe]);else for(se=0;oe>se;se++)ce=ae[se],ue=I-1+w*ce[0]|0,he=I-1+w*(ce[0]+ce[2])|0,fe=Ce*(F-1+w*ce[1]|0),de=Ce*(F-1+w*(ce[1]+ce[3])|0),ue=P>ue?P:ue>q?q:ue,he=P>he?P:he>q?q:he,fe=H>fe?H:fe>D?D:fe,de=H>de?H:de>D?D:de,le+=ce[4]*(f[he+de]-f[ue+de]-f[he+fe]+f[ue+fe]);if(ie*K>le*k){if(te.has_l){_e+=te.l_val;break}re=te.l_node}else{if(te.has_r){_e+=te.r_val;break}re=te.r_node}}if(J=_e>V,!J)break}J&&(e.count===e.length&&_.apply(e,new Array(v)),e[e.count++]=[I,F,A,X])}}function a(e,r,n){var t=f(r[2],e[2])*n,a=f(r[3],e[3])*n;return u(e[0]-r[0])<=t&&u(e[1]-r[1])<=a&&u(e[2]-r[2])<=t&&u(e[3]-r[3])<=a}function o(e,r){return e.x1>=r.x1&&e.y1>=r.y1&&e.x2<=r.x2&&e.y2<=r.y2}function i(e){e.x1=e.x1+.5|0,e.y1=e.y1+.5|0,e.x2=e.x2+.5|0,e.y2=e.y2+.5|0}function l(e,r){return r.area-e.area}function s(e,r,n){var t,s,c,u,f,h,d,p,y,m,v,_=e.length,g=new Array(_),C=[],w=0,b=!1;for(c=0;_>c;c++)g[c]=0;for(c=0;_>c;c++){for(b=!1,u=0;c>u;u++)a(e[u],e[c],n)&&(b=!0,g[c]=g[u]);b||(g[c]=w,w++)}for(t=new Array(w),s=new Array(w),c=0;w>c;c++)t[c]=0,s[c]=[0,0,0,0];for(c=0;_>c;c++)d=g[c],t[d]++,s[d][0]+=e[c][0],s[d][1]+=e[c][1],s[d][2]+=e[c][2],s[d][3]+=e[c][3];for(c=0;w>c;c++)f=t[c],f>=r&&(h=1/(f+f),p=h*(2*s[c][0]+f),y=h*(2*s[c][1]+f),m=h*(2*s[c][2]+f),v=h*(2*s[c][3]+f),C.push({x1:p,y1:y,x2:p+m-1,y2:y+v-1,x:p,y:y,width:m,height:v,area:0,inside:0}));for(_=C.length,c=0;_>c;c++)for(u=c+1;_>u;u++)!C[c].inside&&o(C[c],C[u])?C[c].inside=1:!C[u].inside&&o(C[u],C[c])&&(C[u].inside=1);for(c=_;--c>=0;)C[c].inside?C.splice(c,1):(i(C[c]),C[c].area=C[c].width*C[c].height);return C.sort(l)}var c=e.Array32F,u=(e.Array8U,Math.abs),f=Math.max,h=Math.min,d=(Math.floor,Math.round,Math.sqrt),p=e.Util.Array.typed,y=e.Util.Array.typed_obj,m="hasOwnProperty",v=10,_=Array.prototype.push,g=e.Util.Filter.SAT,C=e.Util.Filter.GRAD;e.Util.Filter.haar_detect=t,e.Util.Filter.merge_features=s,e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,selection:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,n,t,a,o,i,l){var s=this;s.haardata=e||null,s.baseScale=r===n?1:n,s.scaleIncrement=r===t?1.25:t,s.stepIncrement=r===a?.5:a,s.minNeighbors=r===o?1:o,s.doCannyPruning=r===i?!0:!!i,s.tolerance=null==l?.2:+l,s._haarchanged=!!s.haardata},path:n,dispose:function(){var e=this;return e.selection=null,e.objects=null,e.haardata=null,e.$super("dispose"),e},haar:function(e){var r=this;return r.haardata=e,r._haarchanged=!0,r},select:function(e,r,n,t){var a=this;return!1===e?a.selection=null:a.selection=[h(1,f(0,e||0)),h(1,f(0,r||0)),h(1,f(0,n||0)),h(1,f(0,t||0))],a},params:function(e){var r=this;return e&&(e[m]("haardata")&&(r.haardata=e.haardata,r._haarchanged=!0),e[m]("baseScale")&&(r.baseScale=e.baseScale),e[m]("scaleIncrement")&&(r.scaleIncrement=e.scaleIncrement),e[m]("stepIncrement")&&(r.stepIncrement=e.stepIncrement),e[m]("minNeighbors")&&(r.minNeighbors=e.minNeighbors),e[m]("doCannyPruning")&&(r.doCannyPruning=e.doCannyPruning),e[m]("tolerance")&&(r.tolerance=e.tolerance),e[m]("cannyLow")&&(r.cannyLow=e.cannyLow),e[m]("cannyHigh")&&(r.cannyHigh=e.cannyHigh),e[m]("selection")&&(r.selection=e.selection||null)),r},serialize:function(){var e,r=this;return e={baseScale:r.baseScale,scaleIncrement:r.scaleIncrement,stepIncrement:r.stepIncrement,minNeighbors:r.minNeighbors,doCannyPruning:r.doCannyPruning,tolerance:r.tolerance,cannyLow:r.cannyLow,cannyHigh:r.cannyHigh,selection:r.selection},r._haarchanged&&(e.haardata=y(r.haardata),r._haarchanged=!1),e},unserialize:function(e){var r=this;return e[m]("haardata")&&(r.haardata=y(e.haardata,1)),r.baseScale=e.baseScale,r.scaleIncrement=e.scaleIncrement,r.stepIncrement=e.stepIncrement,r.minNeighbors=e.minNeighbors,r.doCannyPruning=e.doCannyPruning,r.tolerance=e.tolerance,r.cannyLow=e.cannyLow,r.cannyHigh=e.cannyHigh,r.selection=p(e.selection,Array),r},meta:function(r){return r&&e.isWorker?y(this._meta):this._meta},setMeta:function(e,r){return this._meta=r&&"string"==typeof e?y(e,1):e,this},apply:function(r,n,t,a){var o=this;if(!o.haardata)return r;var i,l,s,u,d,p=r.length>>>2,y=o.selection||null,m=null,_=null,w=null,b=null,Y=e.Util.Filter.haar_detect,A=e.Util.Filter.merge_features;return y?(i=h(n-1,f(0,y[0]*(n-1))),l=h(t-1,f(0,y[1]*(t-1))),s=h(n-1,f(0,y[2]*(n-1))),u=h(t-1,f(0,y[3]*(t-1)))):(i=0,l=0,s=n-1,u=t-1),a&&a.haarfilter_SAT?(m=a.haarfilter_SAT,_=a.haarfilter_SAT2,w=a.haarfilter_RSAT):(g(r,n,t,m=new c(p),_=new c(p),w=new c(p)),a&&(a.haarfilter_SAT=m,a.haarfilter_SAT2=_,a.haarfilter_RSAT=w)),o.doCannyPruning&&(a&&a.haarfilter_EDGES?b=a.haarfilter_EDGES:(C(r,n,t,b=new c(p),null,1),a&&(a.haarfilter_EDGES=b))),d=new Array(v),d.count=0,Y(d,n,t,i,l,s,u,o.haardata,o.baseScale,o.scaleIncrement,o.stepIncrement,m,w,_,b,o.cannyLow,o.cannyHigh),d.length>d.count&&(d.length=d.count),o._meta={objects:A(d,o.minNeighbors,o.tolerance)},r}})}(r),!function(e,r){function t(e,r){for(;r[e][1]!==e;)r[e][1]=r[r[e][1]][1],e=r[e][1];return e}function a(e,r,n){var a=t(e,n),o=t(r,n);a!==o&&(n[a][1]=o)}function o(e,r,n){var t=n.next;return t+1>n.length&&Array.prototype.push.apply(n,new Array(C)),n[t]=[t,t,0],++n.next,t}function i(e,r,n,t){return e}function l(e,r,n,t,a){return 0===e[r+3]&&0===e[n+3]||g(e[r]-e[n])<=t&&g(e[r+1]-e[n+1])<=t&&g(e[r+2]-e[n+2])<=t}function s(e,r,n,t,a){return g(r[n]-e[0])<=t&&g(r[n+1]-e[1])<=t&&g(r[n+2]-e[2])<=t}function c(e,r,n,t,a){if(0===e[r+3]&&0===e[n+3])return!0;var o=r>>>2,i=n>>>2;return null==a[o]&&(a[o]=m(e[r],e[r+1],e[r+2])),null==a[i]&&(a[i]=m(e[n],e[n+1],e[n+2])),g(a[o],a[i])<=t}function u(e,r,n,t,a){var o=n>>>2;return null==a[o]&&(a[o]=m(r[n],r[n+1],r[n+2])),g(a[o],e)<=t}function f(e,r,n,t,a){if(0===e[r+3]&&0===e[n+3])return!0;var o=r>>>2,i=n>>>2;return null==a[o]&&(a[o]=y(e[r],e[r+1],e[r+2])),null==a[i]&&(a[i]=y(e[n],e[n+1],e[n+2])),g(a[o],a[i])<=t}function h(e,r,n,t,a){var o=n>>>2;return null==a[o]&&(a[o]=y(r[n],r[n+1],r[n+2])),g(a[o],e)<=t}var d=e.Array32U,p=e.MODE,y=e.Color.hue,m=e.Color.intensity,v=Math.min,_=Math.max,g=Math.abs,C=20;e.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:0,mode:p.COLOR,color:null,invert:!1,box:null,init:function(e,r,n,t,a){var o=this;o.connectivity=8===e?8:4,o.tolerance=r||0,o.mode=n||p.COLOR,o.color=null==t?null:t,o.invert=!!a},path:n,serialize:function(){var e=this;return{connectivity:e.connectivity,tolerance:e.tolerance,mode:e.mode,color:e.color,invert:e.invert}},unserialize:function(e){var r=this;return r.connectivity=e.connectivity,r.tolerance=e.tolerance,r.mode=e.mode,r.color=e.color,r.invert=e.invert,r},apply:function(e,r,n){var y=this;if(!y._isOn)return e;var m,g,w,b,Y,A,X,x,I,F,z,M,S=e.length,O=S>>>2,R=r<<2,E=y.mode||p.COLOR,L=y.invert,T=y.color,N=v(.999,_(0,y.tolerance||0)),U=8===y.connectivity?8:4,G=8===U,P=G?-1:0,q=P<<2,H=null,D=null,$=null,k=null,j=null!=T;for(I=new Array(C),I.next=0,F=new d(O),p.HUE===E?(N*=360,H=f,D=new Array(O),j&&($=h)):p.INTENSITY===E?(N*=255,H=c,D=new Array(O),j&&($=u)):(N*=255,H=l,j&&(T=[T>>>16&255,T>>>8&255,255&T],$=s)),k=j?o(0,0,I):null,F[0]=j&&!$(T,e,0,N,D)?k:o(0,0,I),Y=1,m=4;r>Y;Y++,m+4)F[Y]=j&&!$(T,e,m,N,D)?k:H(e,m,m-4,N,D)?i(F[Y-1],Y,0,I):o(Y,0,I);for(A=1,x=r,m=R;n>A;A++,x+=r,m+=R)for(F[x]=j&&!$(T,e,m,N,D)?k:H(e,m,m-R,N,D)?i(F[x-r],0,A,I):o(0,A,I),Y=1,g=4;r>Y;Y++,g+=4)if(!j||$(T,e,m+g,N,D)){for(b=k===F[x+Y-1]?-1:H(e,m+g,m+g-4,N,D)?i(F[x+Y-1],Y,A,I):-1,X=P,w=q;1>X;X++,w+=4)k!==F[x-r+Y+X]&&H(e,m+g,m-R+g+w,N,D)&&(b>=0?a(b,F[x-r+Y+X],I):b=i(F[x-r+Y+X],Y+X,A,I));F[x+Y]=b>=0?i(b,Y,A,I):o(Y,A,I),G&&k!==F[x+Y-1]&&k!==F[x-r+Y]&&H(e,m+g-4,m-R+g,N,D)&&a(F[x+Y-1],F[x-r+Y],I)}else F[x+Y]=k;if(0===k)for(m=0,z=I.next,M=0;z>m;m++)m===I[m][1]&&(I[m][2]=0===I[m][1]?0:++M);else for(m=0,z=I.next,M=0;z>m;m++)m===I[m][1]&&(I[m][2]=M++);if(M=M>0?M:1,L)for(Y=0,m=0;S>m;m+=4,Y++)T=I[t(F[Y],I)][2],T=255-255*T/M|0,e[m]=T,e[m+1]=T,e[m+2]=T;else for(Y=0,m=0;S>m;m+=4,Y++)T=I[t(F[Y],I)][2],T=255*T/M|0,e[m]=T,e[m+1]=T,e[m+2]=T;return e}})}(r),r});