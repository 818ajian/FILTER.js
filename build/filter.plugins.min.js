/**
*
*   FILTER.js Plugins
*   @version: 0.9.0
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(r,e){"use strict";"object"==typeof module&&module.exports?module.exports=e.call(r,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(n,t){return e.moduleUri=n.uri,e.call(r,t),t}):(e.call(r,r.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return r.FILTER})}(this,function r(e){return!function(e){"use strict";var n=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(r,e){var n=this;n.min=r||-127,n.max=e||127},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{min:r.min,max:r.max}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.min=e.min,n.max=e.max),n},apply:function(r,e,a){var i=this;if(!i._isOn)return r;var s,o,l,h,u,c,f,d,g=i.max-i.min,m=i.min,p=r.length;if(n)for(s=0;p>s;s+=4)l=r[s],h=r[s+1],u=r[s+2],o=g*t()+m,c=l+o,f=h+o,d=u+o,0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),0>d?d=0:d>255&&(d=255),r[s]=~~c,r[s+1]=~~f,r[s+2]=~~d;else for(s=0;p>s;s+=4)l=r[s],h=r[s+1],u=r[s+2],o=g*t()+m,c=l+o,f=h+o,d=u+o,r[s]=~~c,r[s+1]=~~f,r[s+2]=~~d;return r}})}(e),!function(e){"use strict";var n=e._notSupportClamp,t=e.Array32F,a=e.Color.RGB2YCbCr,i=e.Color.YCbCr2RGB;e.Create({name:"HistogramEqualizeFilter",path:e.getPath(r.moduleUri),apply:function(r,e,s){var o=this;if(!o._isOn)return r;var l,h,u,c,f,d,g,m,p,_,v,y=0,C=255,b=0,w=r.length,M=w>>2,I=1/M;for(f=new t(256),p=0;256>p;p+=8)f[p]=0,f[p+1]=0,f[p+2]=0,f[p+3]=0,f[p+4]=0,f[p+5]=0,f[p+6]=0,f[p+7]=0;for(p=0;w>p;p+=4)_=a(r.subarray(p,p+3)),l=r[p]=~~_[2],h=r[p+1]=~~_[0],u=r[p+2]=~~_[1],f[h]+=I,h>y?y=h:C>h&&(C=h);for(b=0,p=0;256>p;p+=8)b+=f[p],f[p]=b,b+=f[p+1],f[p+1]=b,b+=f[p+2],f[p+2]=b,b+=f[p+3],f[p+3]=b,b+=f[p+4],f[p+4]=b,b+=f[p+5],f[p+5]=b,b+=f[p+6],f[p+6]=b,b+=f[p+7],f[p+7]=b;if(c=y-C,n)for(p=0;w>p;p+=4)_=[r[p+1],r[p+2],r[p]],_[0]=f[_[0]]*c+C,v=i(_),d=v[0],g=v[1],m=v[2],d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,m=0>m?0:m>255?255:m,r[p]=~~d,r[p+1]=~~g,r[p+2]=~~m;else for(p=0;w>p;p+=4)_=[r[p+1],r[p+2],r[p]],_[0]=f[_[0]]*c+C,v=i(_),r[p]=~~v[0],r[p+1]=~~v[1],r[p+2]=~~v[2];return r}}),e.Create({name:"GrayscaleHistogramEqualizeFilter",path:e.getPath(r.moduleUri),apply:function(r,e,a){var i=this;if(!i._isOn)return r;var s,o,l,h,u,c=0,f=255,d=0,g=r.length,m=g>>2,p=1/m;for(h=new t(256),u=0;256>u;u+=8)h[u]=0,h[u+1]=0,h[u+2]=0,h[u+3]=0,h[u+4]=0,h[u+5]=0,h[u+6]=0,h[u+7]=0;for(u=0;g>u;u+=4)s=r[u],h[s]+=p,s>c?c=s:f>s&&(f=s);for(d=0,u=0;256>u;u+=8)d+=h[u],h[u]=d,d+=h[u+1],h[u+1]=d,d+=h[u+2],h[u+2]=d,d+=h[u+3],h[u+3]=d,d+=h[u+4],h[u+4]=d,d+=h[u+5],h[u+5]=d,d+=h[u+6],h[u+6]=d,d+=h[u+7],h[u+7]=d;if(l=c-f,n)for(u=0;g>u;u+=4)s=r[u],o=h[s]*l+f,o=0>o?0:o>255?255:o,o=~~o,r[u]=o,r[u+1]=o,r[u+2]=o;else for(u=0;g>u;u+=4)s=r[u],o=~~(h[s]*l+f),r[u]=o,r[u+1]=o,r[u+2]=o;return r}}),e.Create({name:"RGBHistogramEqualizeFilter",path:e.getPath(r.moduleUri),apply:function(r,e,a){var i=this;if(!i._isOn)return r;var s,o,l,h,u,c,f,d,g,m,p,_,v,y,C,b,w=0,M=0,I=0,O=255,z=255,A=255,x=r.length,k=x>>2,P=1/k;for(f=new t(256),d=new t(256),g=new t(256),b=0;256>b;b+=8)f[b]=0,d[b]=0,g[b]=0,f[b+1]=0,d[b+1]=0,g[b+1]=0,f[b+2]=0,d[b+2]=0,g[b+2]=0,f[b+3]=0,d[b+3]=0,g[b+3]=0,f[b+4]=0,d[b+4]=0,g[b+4]=0,f[b+5]=0,d[b+5]=0,g[b+5]=0,f[b+6]=0,d[b+6]=0,g[b+6]=0,f[b+7]=0,d[b+7]=0,g[b+7]=0;for(b=0;x>b;b+=4)s=r[b],o=r[b+1],l=r[b+2],f[s]+=P,d[o]+=P,g[l]+=P,s>w?w=s:O>s&&(O=s),o>M?M=o:z>o&&(z=o),l>I?I=l:A>l&&(A=l);for(m=p=_=0,b=0;256>b;b+=8)m+=f[b],f[b]=m,p+=d[b],d[b]=p,_+=g[b],g[b]=_,m+=f[b+1],f[b+1]=m,p+=d[b+1],d[b+1]=p,_+=g[b+1],g[b+1]=_,m+=f[b+2],f[b+2]=m,p+=d[b+2],d[b+2]=p,_+=g[b+2],g[b+2]=_,m+=f[b+3],f[b+3]=m,p+=d[b+3],d[b+3]=p,_+=g[b+3],g[b+3]=_,m+=f[b+4],f[b+4]=m,p+=d[b+4],d[b+4]=p,_+=g[b+4],g[b+4]=_,m+=f[b+5],f[b+5]=m,p+=d[b+5],d[b+5]=p,_+=g[b+5],g[b+5]=_,m+=f[b+6],f[b+6]=m,p+=d[b+6],d[b+6]=p,_+=g[b+6],g[b+6]=_,m+=f[b+7],f[b+7]=m,p+=d[b+7],d[b+7]=p,_+=g[b+7],g[b+7]=_;if(h=w-O,u=M-z,c=I-A,n)for(b=0;x>b;b+=4)s=r[b],o=r[b+1],l=r[b+2],v=f[s]*h+O,y=d[o]*u+z,C=g[l]*c+A,v=0>v?0:v>255?255:v,y=0>y?0:y>255?255:y,C=0>C?0:C>255?255:C,r[b]=~~v,r[b+1]=~~y,r[b+2]=~~C;else for(b=0;x>b;b+=4)s=r[b],o=r[b+1],l=r[b+2],v=f[s]*h+O,y=d[o]*u+z,C=g[l]*c+A,r[b]=~~v,r[b+1]=~~y,r[b+2]=~~C;return r}})}(e),!function(e){"use strict";var n=Math.sqrt,t=e._notSupportClamp,a=e.Array32F;e.Create({name:"PixelateFilter",scale:1,init:function(r){var e=this;e.scale=r||1},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.scale=e.scale),n},apply:function(r,e,i){var s=this;if(!s._isOn||s.scale<=1)return r;s.scale>100&&(s.scale=100);var o,l,h,u,c,f,d,g,m,p,_,v,y,C,b,w,M,I,O,z,A,x,k,P,F,Y,S,N,L,R,X,U,H,q,E,T,G,B,j,W,D,$,V,Q,J,K,Z=r.length,rr=Z>>>2,er=(e<<1)+e;for(o=~~(n(rr)*s.scale*.01),l=e*o,h=i%o,u=e%o,c=(h-1)*e,m=1/(o*o),p=1/(u*o),_=1/(h*o),v=1/(u*h),y=m,C=p,b=_,w=v,A=o-1,x=(o-1)*e,T=0,B=e-1,G=0,j=rr-e,M=new a(3*rr),k=0,P=0,F=0,I=O=z=0,F=0;e>F;F++,k+=4,P+=3)I+=r[k],O+=r[k+1],z+=r[k+2],M[P]=I,M[P+1]=O,M[P+2]=z;for(P=0,F=0,I=O=z=0,k=er+e;Z>k;k+=4,P+=3,F++)F>=e&&(F=0,I=O=z=0),I+=r[k],O+=r[k+1],z+=r[k+2],M[P+er]=M[P]+I,M[P+er+1]=M[P+1]+O,M[P+er+2]=M[P+2]+z;for(F=0,Y=0,S=0,U=F,H=S,q=U+A,E=H+x,q=q>B?B:q,E=E>j?j:E,W=U+H,V=q+E,D=q+H,$=U+E,W=(W<<1)+W,D=(D<<1)+D,$=($<<1)+$,V=(V<<1)+V,g=y,Q=g*(M[V]-M[D]-M[$]+M[W]),J=g*(M[V+1]-M[D+1]-M[$+1]+M[W+1]),K=g*(M[V+2]-M[D+2]-M[$+2]+M[W+2]),t&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K,N=0,L=0,R=0,k=0;Z>k;k+=4)X=N+F+R+S<<2,r[X]=Q,r[X+1]=J,r[X+2]=K,N++,(N+F>=e||N>=o)&&(N=0,L++,R+=e),(L+Y>=i||L>=o)&&(F+=o,F>=e&&(F=0,Y+=o,S+=l),N=0,L=0,R=0,U=F,H=S,q=U+A,E=H+x,q=q>B?B:q,E=E>j?j:E,W=U+H,V=q+E,D=q+H,$=U+E,W=(W<<1)+W,D=(D<<1)+D,$=($<<1)+$,V=(V<<1)+V,f=0==q-U-u+1,d=0==E-H-c,g=f&&d?w:f?C:d?b:y,Q=g*(M[V]-M[D]-M[$]+M[W]),J=g*(M[V+1]-M[D+1]-M[$+1]+M[W+1]),K=g*(M[V+2]-M[D+2]-M[$+2]+M[W+2]),t&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K);return r}})}(e),!function(e){"use strict";var n=Math.sqrt,t=(Math.SQRT2,Math.min,e._notSupportClamp),a=e.Array32F;e.Create({name:"TriangularPixelateFilter",scale:1,init:function(r){var e=this;e.scale=r||1},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.scale=e.scale),n},apply:function(r,e,i){var s=this;if(!s._isOn||s.scale<=1)return r;s.scale>100&&(s.scale=100);var o,l,h,u,c,f,d,g,m,p,_,v,y,C,b,w,M,I,O,z,A,x,k,P,F,Y,S,N,L,R,X,U,H,q,E,T,G,B,j,W,D,$,V,Q,J,K,Z,rr,er,nr,tr,ar,ir,sr,or=r.length,lr=or>>>2,hr=(e<<1)+e;for(o=~~(n(lr)*s.scale*.01),l=o>>1,h=o-1,u=e*o,c=i%o,f=e%o,d=(c-1)*e,_=1/(o*o),v=1/(f*o),y=1/(c*o),C=1/(f*c),b=2*_,w=2*v,M=2*y,I=2*C,k=h,P=h*e,B=0,W=e-1,j=0,D=lr-e,O=new a(3*lr),F=0,Y=0,S=0,z=A=x=0,S=0;e>S;S++,F+=4,Y+=3)z+=r[F],A+=r[F+1],x+=r[F+2],O[Y]=z,O[Y+1]=A,O[Y+2]=x;for(Y=0,S=0,z=A=x=0,F=hr+e;or>F;F+=4,Y+=3,S++)S>=e&&(S=0,z=A=x=0),z+=r[F],A+=r[F+1],x+=r[F+2],O[Y+hr]=O[Y]+z,O[Y+hr+1]=O[Y+1]+A,O[Y+hr+2]=O[Y+2]+x;for(S=0,N=0,L=0,q=S,E=L,T=S-l+k,G=L+P,T=T>W?W:T,G=G>D?D:G,$=q+E,J=T+G,V=T+E,Q=q+G,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,p=b,er=p*(O[J]-O[V]-O[Q]+O[$]),nr=p*(O[J+1]-O[V+1]-O[Q+1]+O[$+1]),tr=p*(O[J+2]-O[V+2]-O[Q+2]+O[$+2]),q=S+l,T=S+k,T=T>W?W:T,$=q+E,J=T+G,V=T+E,Q=q+G,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,ar=p*(O[J]-O[V]-O[Q]+O[$]),ir=p*(O[J+1]-O[V+1]-O[Q+1]+O[$+1]),sr=p*(O[J+2]-O[V+2]-O[Q+2]+O[$+2]),t&&(er=0>er?0:er>255?255:er,nr=0>nr?0:nr>255?255:nr,tr=0>tr?0:tr>255?255:tr,ar=0>ar?0:ar>255?255:ar,ir=0>ir?0:ir>255?255:ir,sr=0>sr?0:sr>255?255:sr),er=~~er,nr=~~nr,tr=~~tr,ar=~~ar,ir=~~ir,sr=~~sr,K=er,Z=nr,rr=tr,R=0,X=0,U=0,F=0;or>F;F+=4)H=R+S+U+L<<2,r[H]=K,r[H+1]=Z,r[H+2]=rr,R++,(R+S>=e||R>=o)&&(R=0,X++,U+=e,K=er,Z=nr,rr=tr),R>h-X&&(K=ar,Z=ir,rr=sr),(X+N>=i||X>=o)&&(S+=o,S>=e&&(S=0,N+=o,L+=u),R=0,X=0,U=0,q=S,E=L,T=S-l+k,G=L+P,T=T>W?W:T,G=G>D?D:G,$=q+E,J=T+G,V=T+E,Q=q+G,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,g=0==T-q+l-f+1,m=0==G-E-d,p=g&&m?I:g?w:m?M:b,er=p*(O[J]-O[V]-O[Q]+O[$]),nr=p*(O[J+1]-O[V+1]-O[Q+1]+O[$+1]),tr=p*(O[J+2]-O[V+2]-O[Q+2]+O[$+2]),q=S+l,T=S+k,T=T>W?W:T,$=q+E,J=T+G,V=T+E,Q=q+G,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,g=0==T-q+l-f+1,p=g&&m?I:g?w:m?M:b,ar=p*(O[J]-O[V]-O[Q]+O[$]),ir=p*(O[J+1]-O[V+1]-O[Q+1]+O[$+1]),sr=p*(O[J+2]-O[V+2]-O[Q+2]+O[$+2]),t&&(er=0>er?0:er>255?255:er,nr=0>nr?0:nr>255?255:nr,tr=0>tr?0:tr>255?255:tr,ar=0>ar?0:ar>255?255:ar,ir=0>ir?0:ir>255?255:ir,sr=0>sr?0:sr>255?255:sr),er=~~er,nr=~~nr,tr=~~tr,ar=~~ar,ir=~~ir,sr=~~sr,K=er,Z=nr,rr=tr);return r}})}(e),!function(e,n){"use strict";var t=7/16,a=3/16,i=5/16,s=1/16,o=e.Array32F,l=e.Color.clamp,h=e.Color.RGB2YCbCr,u=e.Color.YCbCr2RGB;e.Create({name:"HalftoneFilter",_threshold:.4,_size:1,_grayscale:!1,init:function(r,e,t){var a=this;a._size=r||1,a._threshold=l(n===e?.4:e,0,1),a._grayscale=!!t},path:e.getPath(r.moduleUri),size:function(r){return this._size=r,this},threshold:function(r){return this._threshold=l(r,0,1),this},grayscale:function(r){return arguments.length||(r=!0),this._grayscale=!!r,this},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_size:r._size,_threshold:r._threshold,_grayscale:r._grayscale}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n._size=e._size,n._threshold=e._threshold,n._grayscale=e._grayscale),n},apply:function(r,e,n){var c,f,d,g,m,p,_,v,y,C,b,w,M,I,O,z,A,x=this,k=r.length,P=k>>>2,F=new o(3*P),Y=x._size,S=Y*Y,N=1/S,L=255*x._threshold,R=R<<1,X=!x._grayscale,U=Y*e,H=t,q=a,E=i,T=s;for(_=0,v=0,p=0;n>_;){for(w=M=I=0,y=0,C=0,b=0;Y>C;)c=p+v+y+b<<2,f=3*(p+v+y+b),w+=r[c]+F[f],M+=r[c+1]+F[f+1],I+=r[c+2]+F[f+2],y++,y>=Y&&(y=0,C++,b+=e);if(w*=N,M*=N,I*=N,m=X?h([w,M,I]):[w,M,I],d=m[0],d>L?X?(m[0]=l(~~d,0,255),g=u(m)):g=[255,255,255]:g=[0,0,0],c=p+v<<2,O=r[c]-g[0],z=r[c+1]-g[1],A=r[c+2]-g[2],e>p+Y)for(y=Y,C=0,b=0;Y>C;)f=3*(p+v+y+b),F[f]+=H*O,F[f+1]+=H*z,F[f+2]+=H*A,y++,y>=R&&(y=Y,C++,b+=e);if(n>_+Y&&p>Y)for(y=-Y,C=Y,b=0;R>C;)f=3*(p+v+y+b),F[f]+=q*O,F[f+1]+=q*z,F[f+2]+=q*A,y++,y>=0&&(y=-Y,C++,b+=e);if(n>_+Y)for(y=0,C=Y,b=0;R>C;)f=3*(p+v+y+b),F[f]+=E*O,F[f+1]+=E*z,F[f+2]+=E*A,y++,y>=Y&&(y=0,C++,b+=e);if(n>_+Y&&e>p+Y)for(y=Y,C=Y,b=0;R>C;)f=3*(p+v+y+b),F[f]+=T*O,F[f+1]+=T*z,F[f+2]+=T*A,y++,y>=R&&(y=Y,C++,b+=e);for(y=0,C=0,b=0;Y>C;)c=p+v+y+b<<2,r[c]=g[0],r[c+1]=g[1],r[c+2]=g[2],y++,y>=Y&&(y=0,C++,b+=e);p+=Y,p>=e&&(p=0,_+=Y,v+=U)}return r}})}(e),!function(e){"use strict";var n=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=e._notSupportClamp,s=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(r,e,n,t){var a=this;a.centerX=r||0,a.centerY=e||0,a.radius=n||10,a.amount=t||10},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{centerX:r.centerX,centerY:r.centerY,radius:r.radius,amount:r.amount}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.centerX=e.centerX,n.centerY=e.centerY,n.radius=e.radius,n.amount=e.amount),n},apply:function(r,e,o){var l=this;if(!l._isOn)return r;var h,u,c,f,d,g,m,p,_,v,y,C,b,w,M,I,O,z,A,x,k,P,F,Y,S,N,L,R,X,U,H,q,E,T=r.length,G=l.centerX||0,B=l.centerY||0,j=l.radius,W=l.amount;if(0>=W)return r;for(h=T>>2,U=0,H=e-1,q=0,E=h-e,G=a(G*(e-1)),B=a(B*(o-1)),c=(h<<1)+h,m=(e<<1)+e,u=new s(c),p=0,_=0,v=0,f=d=g=0,v=0;e>v;v++,p+=4,_+=3)f+=r[p],d+=r[p+1],g+=r[p+2],u[_]=f,u[_+1]=d,u[_+2]=g;for(p=m+e,_=0,v=0,f=d=g=0,p=m+e;T>p;p+=4,_+=3,v++)v>=e&&(v=0,f=d=g=0),f+=r[p],d+=r[p+1],g+=r[p+2],u[_+m]=u[_]+f,u[_+m+1]=u[_+1]+d,u[_+m+2]=u[_+2]+g;for(v=0,y=0,C=0,p=0;T>p;p+=4,v++)v>=e&&(v=0,y++,C+=e),w=v-G,M=y-B,b=t(w)+t(M),I=b>j?~~n((b-j)*W):~~(b/j+.5),I>0&&(O=I*e,z=.25/(I*I),A=v-I,x=C-O,k=v+I,P=C+O,U>A?A=U:k>H&&(k=H),q>x?x=q:P>E&&(P=E),F=A+x,N=k+P,Y=k+x,S=A+P,F=(F<<1)+F,Y=(Y<<1)+Y,S=(S<<1)+S,N=(N<<1)+N,L=z*(u[N]-u[Y]-u[S]+u[F]),R=z*(u[N+1]-u[Y+1]-u[S+1]+u[F+1]),X=z*(u[N+2]-u[Y+2]-u[S+2]+u[F+2]),i&&(L=0>L?0:L>255?255:L,R=0>R?0:R>255?255:R,X=0>X?0:X>255?255:X),r[p]=~~L,r[p+1]=~~R,r[p+2]=~~X);return r}})}(e),!function(e){"use strict";e.Create({name:"SeamlessTileFilter",type:0,init:function(r){var e=this;e.type=r||0},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{type:r.type}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.type=e.type),n},apply:function(r,n,t){var a,i,s,o,l,h,u,c,f,d,g,m,p,_,v,y=this,C=y.type,b=e.Image.resize,w=e.ImArray,M=Math.sqrt;for(n!==t?r=b(r,n,t,m=n>t?n:t,m):m=n,p=Math.round(m/2),_=m*m,v=r.length,a=new w(v),i=new w(v),s=new e.Array8U(_),c=0,f=0,d=0;v>d;d+=4,c++)c>=m&&(c=0,f++),g=(c+p)%m+(f+p)%m*m<<2,a[g]=r[d],a[g+1]=r[d+1],a[g+2]=r[d+2],a[g+3]=r[d+3];for(c=0,f=0;p>c;f++){switch(f>=p&&(f=0,c++),C){case 0:u=M((c-p)*(c-p)+(f-p)*(f-p))/p;break;case 1:u=p-f>p-c?(f-p)/p:(c-m/2)/p;break;case 2:default:u=p-f>p-c?M((f-m)*(f-m)+(c-m)*(c-m))/(1.13*m):M((c-m)*(c-m)+(f-m)*(f-m))/(1.13*m)}u=255-255*u,1>u?u=1:u>255&&(u=255),s[c+f*m]=u,s[c+(m-1-f)*m]=u,s[m-1-c+f*m]=u,s[m-1-c+(m-1-f)*m]=u}for(f=0,c=0;m>f;c++)c>=m&&(c=0,f++),g=c+f*m,o=s[g],l=s[(c+p)%m+(f+p)%m*m],h=o+l,o/=h,l/=h,g<<=2,i[g]=~~(o*r[g]+l*a[g]),i[g+1]=~~(o*r[g+1]+l*a[g+1]),i[g+2]=~~(o*r[g+2]+l*a[g+2]),i[g+3]=r[g+3];return n!==t&&(i=b(i,m,m,n,t)),i}})}(e),!function(e){"use strict";var n=e.TypedArray;e.Create({name:"FloodFillFilter",x:0,y:0,color:null,tolerance:0,path:e.getPath(r.moduleUri),init:function(r,e,n,t){var a=this;a.x=r||0,a.y=e||0,a.color=n||[0,0,0],a.tolerance=t||0},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{color:r.color,x:r.x,y:r.y,tolerance:r.tolerance}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.color=n(e.color,Array),t.x=e.x,t.y=e.y,t.tolerance=e.tolerance),t},apply:function(r,e,n){var t,a,i,s,o,l,h,u,c,f,d,g=this,m=~~(255*(g.tolerance>=1?.999:g.tolerance)),p=g.color,_=e<<2,v=g.x,y=g.y,C=r.length,b=0,w=C-_,M=0,I=e-1<<2,O=Math.abs;if(h=y*e<<2,v<<=2,M>v||v>I||b>h||h>w||r[v+h]===p[0]&&r[v+h+1]===p[1]&&r[v+h+2]===p[2])return r;for(t=[r[v+h],r[v+h+1],r[v+h+2]],u=new Array(n*e),c=0,h+_>=b&&w>=h+_&&(u[c++]=[h,v,v,_]),u[c++]=[h+_,v,v,-_];c>0;){for(f=u[--c],h=f[0]+(_=f[3]),o=f[1],l=f[2],s=o;s>=M&&(i=s+h,O(t[0]-r[i])<=m&&O(t[1]-r[i+1])<=m&&O(t[2]-r[i+2])<=m);s-=4)r[i]=p[0],r[i+1]=p[1],r[i+2]=p[2];if(s>=o){for(;l>=s&&!(O(t[0]-r[s+h])<=m&&O(t[1]-r[s+h+1])<=m&&O(t[2]-r[s+h+2])<=m);)s+=4;a=s,d=l>=s}else a=s+4,o>a&&h-_>=b&&w>=h-_&&(u[c++]=[h,a,o-4,-_]),s=o+4,d=!0;for(;d;){for(i=s+h;I>=s&&O(t[0]-r[i])<=m&&O(t[1]-r[i+1])<=m&&O(t[2]-r[i+2])<=m;)r[i]=p[0],r[i+1]=p[1],r[i+2]=p[2],s+=4,i=s+h;for(h+_>=b&&w>=h+_&&(u[c++]=[h,a,s-4,_]),s>l+4&&h-_>=b&&w>=h-_&&(u[c++]=[h,l+4,s-4,-_]);l>=s&&!(O(t[0]-r[s+h])<=m&&O(t[1]-r[s+h+1])<=m&&O(t[2]-r[s+h+2])<=m);)s+=4;a=s,d=l>=s}}return r}})}(e),!function(e){"use strict";var n=e._notSupportClamp,t=e.Color.RGB2HSV,a=.7083333333333334;e.Create({name:"HSVConverterFilter",path:e.getPath(r.moduleUri),apply:function(r,e,i){var s=this;if(!s._isOn)return r;var o,l,h,u,c,f=r.length;if(n)for(o=0;f>o;o+=4)l=t(r.subarray(o,o+3)),h=l[0]*a,c=255*l[1],u=l[2],0>h?h=0:h>255&&(h=255),0>u?u=0:u>255&&(u=255),0>c?c=0:c>255&&(c=255),r[o]=~~h,r[o+1]=~~u,r[o+2]=~~c;else for(o=0;f>o;o+=4)l=t(r.subarray(o,o+3)),h=l[0]*a,c=255*l[1],u=l[2],r[o]=~~h,r[o+1]=~~u,r[o+2]=~~c;return r}})}(e),!function(e){"use strict";var n=(e._notSupportClamp,e.TypedArray),t=e.Color.RGBA2Color,a=e.Color.Color2RGBA;e.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(r,e){var n=this;n.thresholds=r,n.quantizedColors=e||null},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{thresholds:r.thresholds,quantizedColors:r.quantizedColors}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.thresholds=n(e.thresholds,Array),t.quantizedColors=n(e.quantizedColors,Array)),t},apply:function(r,e,n){var i=this;if(!(i._isOn&&i.thresholds&&i.thresholds.length&&i.quantizedColors&&i.quantizedColors.length))return r;var s,o,l,h,u=r.length,c=i.thresholds,f=c.length,d=i.quantizedColors,g=d.length;for(l=0;u>l;l+=4){for(s=t(r.subarray[l+4]),h=0;f>h&&s>c[h];)h++;s=g>h?d[h]:255,o=a(s),r[l]=o[0],r[l+1]=o[1],r[l+2]=o[2],r[l+3]=o[3]}return r}})}(e),!function(e){"use strict";var n=(e._notSupportClamp,e.ImArray,e.Color.clampPixel),t=e.TypedArray,a=e.Color.RGB2HSV,i=(e.Color.HSV2RGB,e.Color.Color2RGBA);e.Create({name:"HueExtractorFilter",range:null,background:0,init:function(r,e){var n=this;n.range=r,n.background=e||0},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{range:r.range,background:r.background}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.range=t(e.range,Array),n.background=e.background),n},apply:function(r,e,t){var s=this;if(!s._isOn||!s.range||!s.range.length)return r;var o,l,h,u,c,f,d,g=r.length,m=s.range[0],p=s.range[s.range.length-1];for(f=i(s.background||0),o=~~n(f[0]),l=~~n(f[1]),h=~~n(f[2]),u=~~n(f[3]),c=0;g>c;c+=4)d=a(r.subarray(c,c+3))[0],(m>d||d>p)&&(r[c]=o,r[c+1]=l,r[c+2]=h,r[c+3]=u);return r}})}(e),!function(e){"use strict";function n(r,e,n,t,a,i){var s,o,u,v,y,C=r.length,b=new h(C),w=new h(C),M=new h(C),I=new h(C),O=new h(i),z=new h(i),A=a*a,x=2*A,k=m*A;for(s=0;i>s&&(o=_(-(s*s)/x),!(c>=o&&s>=2));s++)u=_(-((y=s-.5)*y)/x),v=_(-((y=s+.5)*y)/x),O[s]=(o+u+v)/3/k,z[s]=v-u;var y,P,F,Y,S,N,L,R,X,U=s-1,H=e-(s-1),q=e*(s-1),E=e*(n-(s-1));for(y=U;H>y;y++)for(P=q;E>P;P+=e){for(F=y+P,Y=r[F]*O[0],S=Y,N=1,L=e;s>N;)S+=O[N]*(r[F-L]+r[F+L]),Y+=O[N]*(r[F-N]+r[F+N]),L+=e,N++;w[F]=S,b[F]=Y}for(y=U;H>y;y++)for(P=q;E>P;P+=e){for(R=0,F=y+P,X=1;s>X;X++)R+=z[X]*(w[F-X]-w[F+X]);M[F]=R}for(y=s;e-s>y;y++)for(P=q;E>P;P+=e){for(R=0,F=y+P,L=e,X=1;s>X;X++)R+=z[X]*(b[F-L]-b[F+L]),L+=e;I[F]=R}U=s,H=e-s,q=e*s,E=e*(n-s);var T,G,B,j,W,D,$,V,Q,J,K,Z,rr,er,nr,tr,ar,ir,sr,or;for(y=U;H>y;y++)for(P=q;E>P;P+=e)F=y+P,T=F-e,G=F+e,j=F-1,B=F+1,W=T-1,D=T+1,$=G-1,V=G+1,Q=M[F],J=I[F],K=l(Q,J),rr=l(M[T],I[T]),er=l(M[G],I[G]),tr=l(M[j],I[j]),nr=l(M[B],I[B]),ir=l(M[D],I[D]),or=l(M[V],I[V]),sr=l(M[$],I[$]),ar=l(M[W],I[W]),(0>=Q*J?p(Q)>=p(J)?(Z=p(Q*K))>=p(J*ir-(Q+J)*nr)&&Z>p(J*sr-(Q+J)*tr):(Z=p(J*K))>=p(Q*ir-(J+Q)*rr)&&Z>p(Q*sr-(J+Q)*er):p(Q)>=Math.abs(J)?(Z=p(Q*K))>=p(J*or+(Q-J)*nr)&&Z>p(J*ar+(Q-J)*tr):(Z=p(J*K))>=p(Q*or+(J-Q)*er)&&Z>p(Q*ar+(J-Q)*rr))?t[F]=K>=d?g:Math.floor(f*K):t[F]=0}function t(r,e,n,t,i,s){var o,l,h,u=0,c=r.length;for(o=0;c>o;o++)r[o]=0;for(h=0,l=0,u=0;c>u;u++,h++)h>=e&&(h=0,l++),0===r[u]&&t[u]>=s&&a(r,e,n,t,h,l,u,i)}function a(r,e,n,t,i,s,o,l){var h,u,c,f=0==i?i:i-1,d=i==e-1?i:i+1,g=0==s?s:s-1,m=s==n-1?s:s+1;for(r[o]=t[o],h=f,u=g;d>=h&&m>=u;){if(c=h+u*e,(u!=s||h!=i)&&0===r[c]&&t[c]>=l)return void a(r,e,n,t,h,u,c,l);u++,u>m&&(u=g,h++)}}function i(r,n){var t,a,i,s,o,l=r.length,h=e.LUMA[0],u=e.LUMA[1],c=e.LUMA[2];for(t=0,a=0;l>t;t+=4,a++)i=r[t],s=r[t+1],o=r[t+2],n[a]=~~(h*i+u*s+c*o+.5)}function s(r){var e,n,t,a,i,s=new u(256),o=new u(256),l=r.length;for(e=0;l>e;e++)s[r[e]]++;for(n=0,t=0,e=0;256>e;e++){for(n+=s[e],i=255*n/l,a=t+1;i>=a;a++)o[a]=e;t=i}for(e=0;l>e;e++)r[e]=o[r[e]]}function o(r,e){var n,t,a,i=r.length;for(n=0,t=0;i>n;n+=4,t++)a=e[t]>0?255:0,r[n]=r[n+1]=r[n+2]=a}var l,h=e.Array32F,u=e.Array32I,c=.005,f=100,d=1e3,g=f*d,m=e.CONST.PI2,p=Math.abs,_=Math.exp;l=Math.hypot?Math.hypot:function(r,e){return p(r)+p(e)},e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,gaussRadius:2,gaussWidth:16,contrastNormalized:!1,path:e.getPath(r.moduleUri),init:function(r,e,n,t,a){var i=this;i.low=arguments.length<1?2.5:r,i.high=arguments.length<2?7.5:e,i.gaussRadius=arguments.length<3?2:n,i.gaussWidth=arguments.length<4?16:t,i.contrastNormalized=!!a},thresholds:function(r,e){var n=this;return n.low=r,n.high=e,n},kernel:function(r,e){var n=this;return n.gaussRadius=r,n.gaussWidth=e,n},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{low:r.low,high:r.high,gaussRadius:r.gaussRadius,gaussWidth:r.gaussWidth,contrastNormalized:r.contrastNormalized}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.low=e.low,n.high=e.high,n.gaussRadius=e.gaussRadius,n.gaussWidth=e.gaussWidth,n.contrastNormalized=e.contrastNormalized),n},apply:function(r,e,a){var l,h,c,d,g=this,m=r.length>>2;return c=new u(m),d=new u(m),l=Math.round(g.low*f),h=Math.round(g.high*f),i(r,c),g.contrastNormalized&&s(c),n(c,e,a,d,g.gaussRadius,g.gaussWidth),t(c,e,a,d,l,h),o(r,c),r}})}(e),!function(e,n){"use strict";function t(r,e,n,t,a,i,s){var o,l,h,u,c,f,d,g=r.length;for(u=0,h=0,o=l=0;e>u;)d=4899*r[h]+9617*r[h+1]+1868*r[h+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[u]=d,a[u]=o,i[u]=l,s[u]=d,u++,h+=4;for(c=0,f=1,u=e,h=e<<2,o=l=0;g>h;)d=4899*r[h]+9617*r[h+1]+1868*r[h+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[u]=d,a[u]=a[u-e]+o,i[u]=i[u-e]+l,s[u]=s[u+1-e]+(d+t[u-e])+(f>1?s[u-e-e]:0)+(c>0?s[u-1-e]:0),c++,u++,h+=4,c>=e&&(c=0,f++,o=l=0)}function a(r,e,n,t){var a,i,s,o,l,h,u,c,g,m,p,_=r.length,v=new f(_);for(a=0;e>a;a++)v[a]=0,v[a+e]=0,v[a+_-e]=0,v[a+_-e-e]=0,t[a]=0,t[a+_-e]=0;for(i=0,s=0;n>i;i++,s+=e)v[0+s]=0,v[1+s]=0,v[e-1+s]=0,v[e-2+s]=0,t[0+s]=0,t[e-1+s]=0;for(a=2;e-2>a;a++)for(o=0,i=2,s=e<<1;n-2>i;i++,s+=e)u=a+s,c=u+e,g=c+e,m=u-e,p=m-e,o=0+(r[p-2]<<1)+(r[m-2]<<2)+(r[u-2]<<2)+r[u-2]+(r[c-2]<<2)+(r[g-2]<<1)+(r[p-1]<<2)+(r[m-1]<<3)+r[m-1]+(r[u-1]<<4)-(r[u-1]<<2)+(r[c-1]<<3)+r[c-1]+(r[g-1]<<2)+(r[p]<<2)+r[p]+(r[m]<<4)-(r[m]<<2)+(r[u]<<4)-r[u]+(r[c]<<4)-(r[c]<<2)+(r[g]<<2)+r[g]+(r[p+1]<<2)+(r[m+1]<<3)+r[m+1]+(r[u+1]<<4)-(r[u+1]<<2)+(r[c+1]<<3)+r[c+1]+(r[g+1]<<2)+(r[p+2]<<1)+(r[m+2]<<2)+(r[u+2]<<2)+r[u+2]+(r[c+2]<<2)+(r[g+2]<<1),v[u]=((103*o+8192&4294967295)>>>14&255)>>>0;for(a=1;e-1>a;a++)for(i=1,s=e;n-1>i;i++,s+=e)u=s+a,c=u+e,m=u-e,l=0-v[m-1]+v[m+1]-v[u-1]-v[u-1]+v[u+1]+v[u+1]-v[c-1]+v[c+1],h=0+v[m-1]+v[m]+v[m]+v[m+1]-v[c-1]-v[c]-v[c]-v[c+1],t[u]=d(l)+d(h);for(a=0,o=0;e>a;)o+=t[a],t[a]=o,a++;for(a=e,s=0,o=0;_>a;)o+=t[a],t[a]=t[a-e]+o,a++,s++,s>=e&&(s=0,o=0);return t}function i(r,e){var n=.2*g(e.width,r.width),t=.2*g(e.height,r.height);return!!(d(r.x-e.x)<=n&&d(r.y-e.y)<=t&&d(r.width-e.width)<=n&&d(r.height-e.height)<=t)}function s(r,e){r.x+=e.x,r.y+=e.y,r.width+=e.width,r.height+=e.height}function o(r,e){return!!(r.x>=e.x&&r.y>=e.y&&r.x+r.width<=e.x+e.width&&r.y+r.height<=e.y+e.height)}function l(r){r.x=~~(r.x+.5),r.y=~~(r.y+.5),r.width=~~(r.width+.5),r.height=~~(r.height+.5)}function h(r,e){return e.area-r.area}function u(r,e){var n,t,a,u,c,f,d,g=r.length,m=new Array(g),p=[],_=0,v=!1;for(a=0;g>a;a++)m[a]=0;for(a=0;g>a;a++){for(v=!1,u=0;a>u;u++)i(r[u],r[a])&&(v=!0,m[a]=m[u]);v||(m[a]=_,_++)}for(n=new Array(_),t=new Array(_),a=0;_>a;a++)n[a]=0,t[a]={x:0,y:0,width:0,height:0};for(a=0;g>a;a++)d=m[a],n[d]++,s(t[d],r[a]);for(a=0;_>a;a++)c=n[a],c>=e&&(f=1/(c+c),d={x:f*(2*t[a].x+c),y:f*(2*t[a].y+c),width:f*(2*t[a].width+c),height:f*(2*t[a].height+c)},p.push(d));for(g=p.length,a=0;g>a;a++)for(u=a+1;g>u;u++)!p[a].inside&&o(p[a],p[u])?p[a].inside=!0:!p[u].inside&&o(p[u],p[a])&&(p[u].inside=!0);for(a=g;--a>=0;)p[a].inside?p.splice(a,1):(l(p[a]),p[a].area=p[a].width*p[a].height);return p.sort(h)}var c=e.Array32F,f=e.Array8U,d=Math.abs,g=Math.max,m=Math.min,p=(Math.floor,Math.round,Math.sqrt),_=e.TypedObj,v="hasOwnProperty";e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(r,e,t,a,i,s){var o=this;o.objects=null,o.haardata=r||null,o.baseScale=n===e?1:e,o.scaleIncrement=n===t?1.25:t,o.stepIncrement=n===a?.5:a,o.minNeighbors=n===i?1:i,o.doCannyPruning=n===s?!0:!!s,o._haarchanged=!!o.haardata},path:e.getPath(r.moduleUri),dispose:function(){var r=this;return r.objects=null,r.haardata=null,r.$super("dispose"),r},haar:function(r){var e=this;return e.haardata=r,e._haarchanged=!0,e},params:function(r){var e=this;return r&&(r[v]("haardata")&&(e.haardata=r.haardata,e._haarchanged=!0),r[v]("baseScale")&&(e.baseScale=r.baseScale),r[v]("scaleIncrement")&&(e.scaleIncrement=r.scaleIncrement),r[v]("stepIncrement")&&(e.stepIncrement=r.stepIncrement),r[v]("minNeighbors")&&(e.minNeighbors=r.minNeighbors),r[v]("doCannyPruning")&&(e.doCannyPruning=r.doCannyPruning),r[v]("cannyLow")&&(e.cannyLow=r.cannyLow),r[v]("cannyHigh")&&(e.cannyHigh=r.cannyHigh)),e},serialize:function(){var r=this,e={filter:r.name,_isOn:!!r._isOn,params:{baseScale:r.baseScale,scaleIncrement:r.scaleIncrement,stepIncrement:r.stepIncrement,minNeighbors:r.minNeighbors,doCannyPruning:r.doCannyPruning,cannyLow:r.cannyLow,cannyHigh:r.cannyHigh}};return r._haarchanged&&(e.params.haardata=_(r.haardata),r._haarchanged=!1),e},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,e[v]("haardata")&&(n.haardata=_(e.haardata)),n.baseScale=e.baseScale,n.scaleIncrement=e.scaleIncrement,n.stepIncrement=e.stepIncrement,n.minNeighbors=e.minNeighbors,n.doCannyPruning=e.doCannyPruning,n.cannyLow=e.cannyLow,n.cannyHigh=e.cannyHigh),n},getMeta:function(){return e.isWorker?_(this.objects):this.objects},setMeta:function(r){return this.objects="string"==typeof r?_(r):r,this},apply:function(r,e,n){var i,s,o,l,h,d,g,_,v,y,C,b,w,M,I,O,z,A,x,k,P,F,Y,S,N,L,R,X,U,H,q,E,T,G,B,j,W,D,$,S,V,Q,J,K,Z,rr,er,nr,tr,ar,ir,sr,or,lr,hr,ur,cr,fr,dr,gr=this,mr=r.length>>>2,pr=gr.haardata,_r=pr.stages,vr=gr.baseScale,yr=gr.scaleIncrement,Cr=gr.stepIncrement,br=gr.minNeighbors,wr=gr.doCannyPruning,Mr=gr.cannyLow,Ir=gr.cannyHigh,Or=pr.size1,zr=pr.size2,Ar=m(e/Or,n/zr),xr=[],kr=mr-1,Pr=0,Fr=0,Yr=_r.length;for(t(r,e,n,s=new f(mr),o=new c(mr),l=new c(mr),h=new c(mr)),wr&&a(s,e,n,d=new c(mr)),N=0,L=e-1,R=0,X=mr-e,i=vr;Ar>=i;){for(v=~~(i*Or),g=~~(v*Cr),y=~~(i*zr),_=~~(y*Cr),I=y*e,O=_*e,C=Fr*O,P=e-v,F=n-y,U=v*y,H=1/U,w=Fr,M=C;F>w;w+=_,M+=O)for(b=Pr;P>b;b+=g)if(z=b-1+M-e,A=z+v,x=z+I,k=x+v,z=0>z?0:z>kr?kr:z,A=0>A?0:A>kr?kr:A,x=0>x?0:x>kr?kr:x,k=0>k?0:k>kr?kr:k,!(wr&&(G=H*(d[k]-d[x]-d[A]+d[z]),Mr>G||G>Ir))){for(q=H*(o[k]-o[x]-o[A]+o[z]),E=H*(l[k]-l[x]-l[A]+l[z]),T=E-q*q,T=T>1?p(T):1,B=!0,Y=0;Yr>Y;Y++){for(j=_r[Y],W=j.thres,D=j.trees,$=D.length,dr=0,S=0;$>S;S++)for(J=D[S].feats,V=0;;){if(K=J[V],Z=K.rects,rr=Z.length,er=K.thres,nr=0,K.tilt)for(tr=0;rr>tr;tr++)ar=Z[tr],ir=b+~~(i*ar[0]),sr=(w-1+~~(i*ar[1]))*e,or=b+~~(i*(ar[0]+ar[2])),lr=(w-1+~~(i*(ar[1]+ar[2])))*e,hr=b+~~(i*(ar[0]-ar[3])),ur=(w-1+~~(i*(ar[1]+ar[3])))*e,cr=b+~~(i*(ar[0]+ar[2]-ar[3])),fr=(w-1+~~(i*(ar[1]+ar[2]+ar[3])))*e,ir=N>ir?N:ir>L?L:ir,or=N>or?N:or>L?L:or,hr=N>hr?N:hr>L?L:hr,cr=N>cr?N:cr>L?L:cr,sr=R>sr?R:sr>X?X:sr,lr=R>lr?R:lr>X?X:lr,ur=R>ur?R:ur>X?X:ur,fr=R>fr?R:fr>X?X:fr,nr+=ar[4]*(h[cr+fr]-h[hr+ur]-h[or+lr]+h[ir+sr]);else for(tr=0;rr>tr;tr++)ar=Z[tr],ir=b-1+~~(i*ar[0]),or=b-1+~~(i*(ar[0]+ar[2])),sr=e*(w-1+~~(i*ar[1])),lr=e*(w-1+~~(i*(ar[1]+ar[3]))),ir=N>ir?N:ir>L?L:ir,or=N>or?N:or>L?L:or,sr=R>sr?R:sr>X?X:sr,lr=R>lr?R:lr>X?X:lr,nr+=ar[4]*(o[or+lr]-o[ir+lr]-o[or+sr]+o[ir+sr]);if(Q=er*T>nr*H?0:1){if(K.has_r){dr+=K.r_val;break}V=K.r_node}else{if(K.has_l){dr+=K.l_val;break}V=K.l_node}}if(B=dr>W,!B)break}B&&xr.push({x:b,y:w,width:v,height:y})}i*=yr}return gr.objects=u(xr,br),r}})}(e),!function(e){"use strict";var n=(e._notSupportClamp,Math.min),t=Math.floor,a=e.CHANNEL.RED;e.CHANNEL.GREEN,e.CHANNEL.BLUE,e.CHANNEL.ALPHA;e.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,path:e.getPath(r.moduleUri),init:function(r,e,n,t,i){var s=this;s._srcImg=null,s.srcImg=null,s.srcChannel=e||a,s.dstChannel=n||a,s.centerX=t||0,s.centerY=i||0,r&&s.setSrc(r)},dispose:function(){var r=this;return r.srcImg=null,r._srcImg=null,r.$super("dispose"),r},setSrc:function(r){var e=this;return r&&(e.srcImg=r,e._srcImg=null),e},serialize:function(){var r=this,e=r.srcImg;return{filter:r.name,_isOn:!!r._isOn,params:{_srcImg:r._srcImg||(e?{data:e.getData(),width:e.width,height:e.height}:null),centerX:r.centerX,centerY:r.centerY,srcChannel:r.srcChannel,dstChannel:r.dstChannel}}},unserialize:function(r){var n,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,n=r.params,t.srcImg=null,t._srcImg=n._srcImg,t._srcImg&&(t._srcImg.data=e.TypedArray(t._srcImg.data,e.ImArray)),t.centerX=n.centerX,t.centerY=n.centerY,t.srcChannel=n.srcChannel,t.dstChannel=n.dstChannel),t},apply:function(r,e,a){var i=this,s=i.srcImg;if(!i._isOn||!s&&!i._srcImg)return r;var o,l,h,u,c,f,d=i._srcImg||{data:s.getData(),width:s.width,height:s.height},g=d.data,m=d.width,p=d.height,_=r.length,v=(g.length,i.srcChannel),y=i.dstChannel,C=n(e,m),b=n(a,p),w=i.centerX||0,M=i.centerY||0,I=m>>1,O=p>>1;for(w=t(w*(e-1))-I,M=t(M*(a-1))-O,o=0,l=0,h=0,o=0;_>o;o+=4,l++)l>=e&&(l=0,h++),c=l-w,f=h-M,c>=0&&C>c&&f>=0&&b>f&&(u=c+f*m<<2,r[o+y]=g[u+v]);return r}})}(e),!function(e){"use strict";var n=(e._notSupportClamp,Math.min),t=Math.floor;e.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,path:e.getPath(r.moduleUri),init:function(r,e,n){var t=this;t.centerX=e||0,t.centerY=n||0,t._alphaMask=null,t.alphaMask=null,r&&t.setMask(r)},dispose:function(){var r=this;return r.alphaMask=null,r._alphaMask=null,r.$super("dispose"),r},setMask:function(r){var e=this;return r&&(e.alphaMask=r,e._alphaMask=null),e},serialize:function(){var r=this,e=r.alphaMask;return{filter:r.name,_isOn:!!r._isOn,params:{_alphaMask:r._alphaMask||(e?{data:e.getData(),width:e.width,height:e.height}:null),centerX:r.centerX,centerY:r.centerY}}},unserialize:function(r){var n,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,n=r.params,t.alphaMask=null,t._alphaMask=n._alphaMask,t._alphaMask&&(t._alphaMask.data=e.TypedArray(t._alphaMask.data,e.ImArray)),t.centerX=n.centerX,t.centerY=n.centerY),t},apply:function(r,e,a){var i=this,s=i.alphaMask;if(!i._isOn||!s&&!i._alphaMask)return r;var o,l,h,u,c,f,d=i._alphaMask||{data:s.getData(),width:s.width,height:s.height},g=d.data,m=d.width,p=d.height,_=r.length,v=(g.length,n(e,m)),y=n(a,p),C=i.centerX||0,b=i.centerY||0,w=m>>1,M=p>>1;for(C=t(C*(e-1))-w,b=t(b*(a-1))-M,l=0,h=0,o=0;_>o;o+=4,l++)l>=e&&(l=0,h++),c=l-C,f=h-b,c>=0&&v>c&&f>=0&&y>f?(u=c+f*m<<2,r[o+3]=g[u+3]):r[o+3]=0;return r}})}(e),!function(e,n){"use strict";var t,a="hasOwnProperty",i=Math.min,s=Math.max,o=Math.round,l=(Math.floor,Math.abs),h=e._notSupportClamp;t={normal:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=r[e],c=r[e+1],f=r[e+2],d=n[t],g=n[t+1],m=n[t+2];a=d,i=g,s=m,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~u,r[e+1]=~~c,r[e+2]=~~f},lighten:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=r[e],c=r[e+1],f=r[e+2],d=n[t],g=n[t+1],m=n[t+2];a=u>d?u:d,i=c>g?c:g,s=f>m?f:m,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~u,r[e+1]=~~c,r[e+2]=~~f},darken:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=r[e],c=r[e+1],f=r[e+2],d=n[t],g=n[t+1],m=n[t+2];a=u>d?d:u,i=c>g?g:c,s=f>m?m:f,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~u,r[e+1]=~~c,r[e+2]=~~f},multiply:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=r[e],c=r[e+1],f=r[e+2],d=n[t],g=n[t+1],m=n[t+2];a=u*d*.003921568627451,i=c*g*.003921568627451,s=f*m*.003921568627451,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~u,r[e+1]=~~c,r[e+2]=~~f},average:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=r[e],c=r[e+1],f=r[e+2],d=n[t],g=n[t+1],m=n[t+2];a=.5*(u+d),i=.5*(c+g),s=.5*(f+m),u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~u,
r[e+1]=~~c,r[e+2]=~~f},add:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=r[e],c=r[e+1],f=r[e+2],d=n[t],g=n[t+1],m=n[t+2];a=u+d,i=c+g,s=f+m,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~u,r[e+1]=~~c,r[e+2]=~~f},subtract:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=r[e],c=r[e+1],f=r[e+2],d=n[t],g=n[t+1],m=n[t+2];a=255>u+d?0:u+d-255,i=255>c+g?0:c+g-255,s=255>f+m?0:f+m-255,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~u,r[e+1]=~~c,r[e+2]=~~f},difference:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],u=1-o,c=r[e],f=r[e+1],d=r[e+2],g=n[t],m=n[t+1],p=n[t+2];a=l(g-c),i=l(m-f),s=l(p-d),c=a*o+c*u,f=i*o+f*u,d=s*o+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},negation:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],u=1-o,c=r[e],f=r[e+1],d=r[e+2],g=n[t],m=n[t+1],p=n[t+2];a=255-l(255-g-c),i=255-l(255-m-f),s=255-l(255-p-d),c=a*o+c*u,f=i*o+f*u,d=s*o+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},screen:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=r[e],c=r[e+1],f=r[e+2],d=n[t],g=n[t+1],m=n[t+2];a=255-((255-d)*(255-u)>>8),i=255-((255-g)*(255-c)>>8),s=255-((255-m)*(255-f)>>8),u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~u,r[e+1]=~~c,r[e+2]=~~f},exclusion:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=r[e],c=r[e+1],f=r[e+2],d=n[t],g=n[t+1],m=n[t+2];a=d+u-2*d*u*.003921568627451,i=g+c-2*g*c*.003921568627451,s=m+f-2*m*f*.003921568627451,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~u,r[e+1]=~~c,r[e+2]=~~f},overlay:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=r[e],c=r[e+1],f=r[e+2],d=n[t],g=n[t+1],m=n[t+2];a=128>u?2*d*u*.003921568627451:255-2*(255-d)*(255-u)*.003921568627451,i=128>c?2*g*c*.003921568627451:255-2*(255-g)*(255-c)*.003921568627451,a=128>f?2*m*f*.003921568627451:255-2*(255-m)*(255-f)*.003921568627451,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~u,r[e+1]=~~c,r[e+2]=~~f},softlight:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=r[e],c=r[e+1],f=r[e+2],d=n[t],g=n[t+1],m=n[t+2];a=128>u?2*((d>>1)+64)*(.003921568627451*u):255-2*(255-((d>>1)+64))*(255-u)*.003921568627451,i=128>c?2*((g>>1)+64)*(.003921568627451*c):255-2*(255-((g>>1)+64))*(255-c)*.003921568627451,s=128>f?2*((m>>1)+64)*(.003921568627451*f):255-2*(255-((m>>1)+64))*(255-f)*.003921568627451,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~u,r[e+1]=~~c,r[e+2]=~~f},hardlight:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,u=r[e],c=r[e+1],f=r[e+2],d=n[t],g=n[t+1],m=n[t+2];a=128>d?2*u*d*.003921568627451:255-2*(255-u)*(255-d)*.003921568627451,i=128>g?2*c*g*.003921568627451:255-2*(255-c)*(255-g)*.003921568627451,s=128>m?2*f*m*.003921568627451:255-2*(255-f)*(255-m)*.003921568627451,u=a*o+u*l,c=i*o+c*l,f=s*o+f*l,h&&(u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~u,r[e+1]=~~c,r[e+2]=~~f},colordodge:function(r,e,n,t){var a,s,o,l=.003921568627451*n[t+3],u=1-l,c=r[e],f=r[e+1],d=r[e+2],g=n[t],m=n[t+1],p=n[t+2];a=255==c?c:i(255,(g<<8)/(255-c)),s=255==f?f:i(255,(m<<8)/(255-f)),o=255==d?c:i(255,(p<<8)/(255-d)),c=a*l+c*u,f=s*l+f*u,d=o*l+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},colorburn:function(r,e,n,t){var a,i,o,l=.003921568627451*n[t+3],u=1-l,c=r[e],f=r[e+1],d=r[e+2],g=n[t],m=n[t+1],p=n[t+2];a=0==c?c:s(0,255-(255-g<<8)/c),i=0==f?f:s(0,255-(255-m<<8)/f),o=0==d?d:s(0,255-(255-p<<8)/d),c=a*l+c*u,f=i*l+f*u,d=o*l+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},linearlight:function(r,e,n,t){var a,i,s,o,l=.003921568627451*n[t+3],u=1-l,c=r[e],f=r[e+1],d=r[e+2],g=n[t],m=n[t+1],p=n[t+2];128>c?(o=2*c,a=255>o+g?0:o+g-255):(o=2*(c-128),a=o+g),128>f?(o=2*f,i=255>o+m?0:o+m-255):(o=2*(f-128),i=o+m),128>d?(o=2*d,s=255>o+p?0:o+p-255):(o=2*(d-128),s=o+p),c=a*l+c*u,f=i*l+f*u,d=s*l+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},reflect:function(r,e,n,t){var a,s,o,l=.003921568627451*n[t+3],u=1-l,c=r[e],f=r[e+1],d=r[e+2],g=n[t],m=n[t+1],p=n[t+2];a=255==c?c:i(255,g*g/(255-c)),s=255==f?f:i(255,m*m/(255-f)),o=255==d?d:i(255,p*p/(255-d)),c=a*l+c*u,f=s*l+f*u,d=o*l+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},glow:function(r,e,n,t){var a,s,o,l=.003921568627451*n[t+3],u=1-l,c=r[e],f=r[e+1],d=r[e+2],g=n[t],m=n[t+1],p=n[t+2];a=255==g?g:i(255,c*c/(255-g)),s=255==m?m:i(255,f*f/(255-m)),o=255==p?p:i(255,d*d/(255-p)),c=a*l+c*u,f=s*l+f*u,d=o*l+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},phoenix:function(r,e,n,t){var a,o,l,u=.003921568627451*n[t+3],c=1-u,f=r[e],d=r[e+1],g=r[e+2],m=n[t],p=n[t+1],_=n[t+2];a=i(m,f)-s(m,f)+255,o=i(p,d)-s(p,d)+255,l=i(_,g)-s(_,g)+255,f=a*u+f*c,d=o*u+d*c,g=l*u+g*c,h&&(f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g),r[e]=~~f,r[e+1]=~~d,r[e+2]=~~g},vividlight:function(r,e,n,t){var a,o,l,u,c=.003921568627451*n[t+3],f=1-c,d=r[e],g=r[e+1],m=r[e+2],p=n[t],_=n[t+1],v=n[t+2];128>d?(u=2*d,a=0==u?u:s(0,255-(255-p<<8)/u)):(u=2*(d-128),a=255==u?u:i(255,(p<<8)/(255-u))),128>g?(u=2*g,o=0==u?u:s(0,255-(255-_<<8)/u)):(u=2*(g-128),o=255==u?u:i(255,(_<<8)/(255-u))),128>m?(u=2*m,l=0==u?u:s(0,255-(255-v<<8)/u)):(u=2*(g-128),l=255==u?u:i(255,(v<<8)/(255-u))),d=a*c+d*f,g=o*c+g*f,m=l*c+m*f,h&&(d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,m=0>m?0:m>255?255:m),r[e]=~~d,r[e+1]=~~g,r[e+2]=~~m},pinlight:function(r,e,n,t){var a,i,s,o,l=.003921568627451*n[t+3],u=1-l,c=r[e],f=r[e+1],d=r[e+2],g=n[t],m=n[t+1],p=n[t+2];128>c?(o=2*c,a=o>g?o:g):(o=2*(c-128),a=o>g?g:o),128>f?(o=2*f,i=o>m?o:m):(o=2*(c-128),i=o>m?m:o),128>d?(o=2*d,s=o>p?o:p):(o=2*(d-128),s=o>p?p:o),c=a*l+c*u,f=i*l+f*u,d=s*l+d*u,h&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},hardmix:function(r,e,n,t){var a,o,l,u,c=.003921568627451*n[t+3],f=1-c,d=r[e],g=r[e+1],m=r[e+2],p=n[t],_=n[t+1],v=n[t+2];128>d?(u=2*d,a=0==u?u:s(0,255-(255-p<<8)/u)):(u=2*(d-128),a=255==u?u:i(255,(p<<8)/(255-u))),a=128>a?0:255,128>g?(u=2*g,o=0==u?u:s(0,255-(255-_<<8)/u)):(u=2*(g-128),o=255==u?u:i(255,(_<<8)/(255-u))),o=128>o?0:255,128>m?(u=2*m,l=0==u?u:s(0,255-(255-v<<8)/u)):(u=2*(m-128),l=255==u?u:i(255,(v<<8)/(255-u))),l=128>l?0:255,d=a*c+d*f,g=o*c+g*f,m=l*c+m*f,h&&(d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,m=0>m?0:m>255?255:m),r[e]=~~d,r[e+1]=~~g,r[e+2]=~~m}},t.lineardodge=t.add,t.linearburn=t.subtract,e.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendImage:null,startX:0,startY:0,path:e.getPath(r.moduleUri),init:function(r,e){var n=this;n.startX=0,n.startY=0,n._blendImage=null,n.blendImage=null,n._blendMode=null,r&&n.setImage(r),e&&n.setMode(e)},dispose:function(){var r=this;return r.blendImage=null,r._blendImage=null,r._blendMode=null,r.$super("dispose"),r},setImage:function(r){var e=this;return r&&(e.blendImage=r,e._blendImage=null),e},setMode:function(r){var e=this;return r?(e._blendMode=(""+r).toLowerCase(),t[a](e._blendMode)||(e._blendMode=null)):e._blendMode=null,e},serialize:function(){var r=this,e=r.blendImage;return{filter:r.name,_isOn:!!r._isOn,params:{_blendImage:r._blendImage||(e?{data:e.getData(),width:e.width,height:e.height}:null),_blendMode:r._blendMode,startX:r.startX,startY:r.startY}}},unserialize:function(r){var n,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,n=r.params,t.startX=n.startX,t.startY=n.startY,t.blendImage=null,t._blendImage=n._blendImage,t._blendImage&&(t._blendImage.data=e.TypedArray(t._blendImage.data,e.ImArray)),t.setMode(n._blendMode)),t},reset:function(){var r=this;return r.startX=0,r.startY=0,r._blendMode=null,r},apply:function(r,e,n){var a=this,s=a.blendImage;if(!a._isOn||!a._blendMode||!s&&!a._blendImage)return r;var l,h,u,c,f,d,g,m,p,_,v,y,C,b,w=a._blendImage||{data:s.getData(),width:s.width,height:s.height},M=a.startX||0,I=a.startY||0,O=0,z=0,A=t[a._blendMode];if(0>M&&(O=-M,M=0),0>I&&(z=-I,I=0),c=w.width,f=w.height,M>=e||I>=n)return r;if(O>=c||z>=f)return r;if(M=o(M),I=o(I),O=o(O),z=o(z),l=i(e-M,c-O),h=i(n-I,f-z),0>=l||0>=h)return r;for(u=w.data,_=M,v=I*e,y=O,C=z*c,d=M+l,g=O+l,m=0,p=h*l;p>m;)b=y+C<<2,u[b+3]&&A(r,_+v<<2,u,b),m++,_++,_>=d&&(_=M,v+=e),y++,y>=g&&(y=O,C+=c);return r}})}(e),e});