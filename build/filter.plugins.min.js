/**
*
*   FILTER.js Plugins
*   @version: 0.6.12
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e,r,n,a){var i="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),s=!i&&"undefined"!=typeof navigator,l="function"==typeof importScripts&&navigator instanceof WorkerNavigator,o=Array,u=o.prototype,h=function(){var t=null;if(i)return t=__filename,{path:__dirname,file:__filename};if(l)t=self.location.href;else if(s){var e;(e=document.getElementsByTagName("script"))&&e.length&&(t=e[e.length-1].src)}return t?{path:t.split("/").slice(0,-1).join("/"),file:t}:{path:null,file:null}},c=h(),f=function(t,e){if(i)return e;if("."==e.charAt(0)){t=t.split("/"),e=e.split("/");var r,n=0,a=0,s=e.length,l=t.length;for(r=0;s>r;r++)if(/^\.\./.test(e[r]))n++,a++;else{if(!/^\./.test(e[r]))break;a++}n=n>=l?0:l-n,e=t.slice(0,n).concat(e.slice(a)).join("/")}return e};r=r?[].concat(r):[];var p,m,d,g=r.length,_=new o(g),v=new o(g),C=new o(g),b=new o(g);for(p=0;g>p;p++)_[p]=r[p][0],v[p]=r[p][1],C[p]=/\.js$/i.test(v[p])?f(c.path,v[p]):f(c.path,v[p]+".js");if("object"==typeof module&&module.exports){if(a===module.exports[e]){for(p=0;g>p;p++)b[p]=module.exports[_[p]]||require(C[p])[_[p]];m=n.apply(t,b),module.exports[e]=m||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(v),function(r){if(a===r[e]){for(var i=u.slice.call(arguments,1),s=i.length,l=0;s>l;l++)b[l]=r[_[l]]||i[l];m=n.apply(t,b),r[e]=m||1}});else if(l){for(p=0;g>p;p++)self[_[p]]||importScripts(C[p]),b[p]=self[_[p]];m=n.apply(t,b),self[e]=m||1}else if(a===t[e]){var M=function(t,e){d=d||document.getElementsByTagName("head")[0];var r=0,n=document.createElement("script");n.type="text/javascript",n.language="javascript",n.onload=n.onreadystatechange=function(){r||n.readyState&&"loaded"!=n.readyState&&"complete"!=n.readyState||(r=1,n.onload=n.onreadystatechange=null,d.removeChild(n),n=null,e&&e())},n.src=t,d.appendChild(n)},y=function(e,r,n){t[e]?n():M(r,n)},O=function(r){return function(){g>r&&(b[r]=t[_[r]]),++r<g?y(_[r],C[r],O(r)):(m=n.apply(t,b),t[e]=m||1)}};g?y(_[0],C[0],O(0)):(m=n.apply(t,b),t[e]=m||1)}}(this,"FILTER_PLUGINS",[["FILTER","./filter"]],function(t){var e=null;return!function(t){"use strict";var e=t._notSupportClamp,r=Math.random;t.NoiseFilter=t.Create({name:"NoiseFilter",min:-127,max:127,init:function(t,e){this.min=t||-127,this.max=e||127},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{min:t.min,max:t.max}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.min=e.min,r.max=e.max),r},apply:function(t){var n,a,i,s,l,o,u,h,c=this.max-this.min,f=this.min,p=t.length;if(e)for(n=0;p>n;n+=4)i=t[n],s=t[n+1],l=t[n+2],a=c*r()+f,o=i+a,u=s+a,h=l+a,0>o?o=0:o>255&&(o=255),0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),t[n]=~~o,t[n+1]=~~u,t[n+2]=~~h;else for(n=0;p>n;n+=4)i=t[n],s=t[n+1],l=t[n+2],a=c*r()+f,o=i+a,u=s+a,h=l+a,t[n]=~~o,t[n+1]=~~u,t[n+2]=~~h;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F,n=t.Color.RGB2YCbCr,a=t.Color.YCbCr2RGB;t.HistogramEqualizeFilter=t.Create({name:"HistogramEqualizeFilter",path:t.getPath(),apply:function(t){var i,s,l,o,u,h,c,f,p,m,d,g=0,_=255,v=0,C=t.length,b=C>>2,M=1/b;for(u=new r(256),p=0;256>p;p+=4)u[p]=0,u[p+1]=0,u[p+2]=0,u[p+3]=0;for(p=0;C>p;p+=4)i=t[p],s=t[p+1],l=t[p+2],m=n({r:i,g:s,b:l}),i=t[p]=~~m.cr,s=t[p+1]=~~m.y,l=t[p+2]=~~m.cb,u[s]+=M,s>g?g=s:_>s&&(_=s);for(v=0,p=0;256>p;p+=4)v+=u[p],u[p]=v,v+=u[p+1],u[p+1]=v,v+=u[p+2],u[p+2]=v,v+=u[p+3],u[p+3]=v;if(o=g-_,e)for(p=0;C>p;p+=4)m={cr:t[p],y:t[p+1],cb:t[p+2]},m.y=u[m.y]*o+_,d=a(m),h=d.r,c=d.g,f=d.b,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,t[p]=~~h,t[p+1]=~~c,t[p+2]=~~f;else for(p=0;C>p;p+=4)m={cr:t[p],y:t[p+1],cb:t[p+2]},m.y=u[m.y]*o+_,d=a(m),t[p]=~~d.r,t[p+1]=~~d.g,t[p+2]=~~d.b;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F;t.GrayscaleHistogramEqualizeFilter=t.Create({name:"GrayscaleHistogramEqualizeFilter",path:t.getPath(),apply:function(t){var n,a,i,s,l,o=0,u=255,h=0,c=t.length,f=c>>2,p=1/f;for(s=new r(256),l=0;256>l;l+=4)s[l]=0,s[l+1]=0,s[l+2]=0,s[l+3]=0;for(l=0;c>l;l+=4)n=t[l],s[n]+=p,n>o?o=n:u>n&&(u=n);for(h=0,l=0;256>l;l+=4)h+=s[l],s[l]=h,h+=s[l+1],s[l+1]=h,h+=s[l+2],s[l+2]=h,h+=s[l+3],s[l+3]=h;if(i=o-u,e)for(l=0;c>l;l+=4)n=t[l],a=s[n]*i+u,a=0>a?0:a>255?255:a,a=~~a,t[l]=a,t[l+1]=a,t[l+2]=a;else for(l=0;c>l;l+=4)n=t[l],a=~~(s[n]*i+u),t[l]=a,t[l+1]=a,t[l+2]=a;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F;t.RGBHistogramEqualizeFilter=t.Create({name:"RGBHistogramEqualizeFilter",path:t.getPath(),apply:function(t){var n,a,i,s,l,o,u,h,c,f,p,m,d,g,_,v,C=0,b=0,M=0,y=255,O=255,F=255,z=t.length,I=z>>2,Y=1/I;for(u=new r(256),h=new r(256),c=new r(256),v=0;256>v;v+=4)u[v]=0,h[v]=0,c[v]=0,u[v+1]=0,h[v+1]=0,c[v+1]=0,u[v+2]=0,h[v+2]=0,c[v+2]=0,u[v+3]=0,h[v+3]=0,c[v+3]=0;for(v=0;z>v;v+=4)n=t[v],a=t[v+1],i=t[v+2],u[n]+=Y,h[a]+=Y,c[i]+=Y,n>C?C=n:y>n&&(y=n),a>b?b=a:O>a&&(O=a),i>M?M=i:F>i&&(F=i);for(f=p=m=0,v=0;256>v;v+=4)f+=u[v],u[v]=f,p+=h[v],h[v]=p,m+=c[v],c[v]=m,f+=u[v+1],u[v+1]=f,p+=h[v+1],h[v+1]=p,m+=c[v+1],c[v+1]=m,f+=u[v+2],u[v+2]=f,p+=h[v+2],h[v+2]=p,m+=c[v+2],c[v+2]=m,f+=u[v+3],u[v+3]=f,p+=h[v+3],h[v+3]=p,m+=c[v+3],c[v+3]=m;if(s=C-y,l=b-O,o=M-F,e)for(v=0;z>v;v+=4)n=t[v],a=t[v+1],i=t[v+2],d=u[n]*s+y,g=h[a]*l+O,_=c[i]*o+F,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,_=0>_?0:_>255?255:_,t[v]=~~d,t[v+1]=~~g,t[v+2]=~~_;else for(v=0;z>v;v+=4)n=t[v],a=t[v+1],i=t[v+2],d=u[n]*s+y,g=h[a]*l+O,_=c[i]*o+F,t[v]=~~d,t[v+1]=~~g,t[v+2]=~~_;return t}})}(t),!function(t){"use strict";var e=Math.sqrt,r=t._notSupportClamp,n=t.Array32F;t.PixelateFilter=t.Create({name:"PixelateFilter",scale:1,init:function(t){this.scale=t||1},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{scale:t.scale}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.scale=e.scale),r},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var s,l,o,u,h,c,f,p,m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L,T,j,V,D,U,Q,W,$,J,K=t.length,Z=K>>2,te=(a<<1)+a;for(s=~~(.01*e(Z)*this.scale),l=a*s,o=i%s,u=a%s,h=(o-1)*a,m=1/(s*s),d=1/(u*s),g=1/(o*s),_=1/(u*o),v=m,C=d,b=g,M=_,I=s-1,Y=(s-1)*a,G=0,T=a-1,L=0,j=Z-a,y=new n(3*Z),k=0,X=0,S=0,O=F=z=0,S=0;a>S;S++,k+=4,X+=3)O+=t[k],F+=t[k+1],z+=t[k+2],y[X]=O,y[X+1]=F,y[X+2]=z;for(X=0,S=0,O=F=z=0,k=te+a;K>k;k+=4,X+=3,S++)S>=a&&(S=0,O=F=z=0),O+=t[k],F+=t[k+1],z+=t[k+2],y[X+te]=y[X]+O,y[X+te+1]=y[X+1]+F,y[X+te+2]=y[X+2]+z;for(S=0,x=0,w=0,H=S,B=w,N=H+I,R=B+Y,N=N>T?T:N,R=R>j?j:R,V=H+B,Q=N+R,D=N+B,U=H+R,V=(V<<1)+V,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,p=v,W=p*(y[Q]-y[D]-y[U]+y[V]),$=p*(y[Q+1]-y[D+1]-y[U+1]+y[V+1]),J=p*(y[Q+2]-y[D+2]-y[U+2]+y[V+2]),r&&(W=0>W?0:W>255?255:W,$=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J),W=~~W,$=~~$,J=~~J,E=0,A=0,P=0,k=0;K>k;k+=4)q=E+S+P+w<<2,t[q]=W,t[q+1]=$,t[q+2]=J,E++,(E+S>=a||E>=s)&&(E=0,A++,P+=a),(A+x>=i||A>=s)&&(S+=s,S>=a&&(S=0,x+=s,w+=l),E=0,A=0,P=0,H=S,B=w,N=H+I,R=B+Y,N=N>T?T:N,R=R>j?j:R,V=H+B,Q=N+R,D=N+B,U=H+R,V=(V<<1)+V,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,c=0==N-H-u+1,f=0==R-B-h,p=c&&f?M:c?C:f?b:v,W=p*(y[Q]-y[D]-y[U]+y[V]),$=p*(y[Q+1]-y[D+1]-y[U+1]+y[V+1]),J=p*(y[Q+2]-y[D+2]-y[U+2]+y[V+2]),r&&(W=0>W?0:W>255?255:W,$=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J),W=~~W,$=~~$,J=~~J);return t}})}(t),!function(t){"use strict";var e=Math.sqrt,r=(Math.SQRT2,Math.min,t._notSupportClamp),n=t.Array32F;t.TriangularPixelateFilter=t.Create({name:"TriangularPixelateFilter",scale:1,init:function(t){this.scale=t||1},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{scale:t.scale}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.scale=e.scale),r},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var s,l,o,u,h,c,f,p,m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L,T,j,V,D,U,Q,W,$,J,K,Z,te,ee,re,ne,ae,ie,se=t.length,le=se>>2,oe=(a<<1)+a;for(s=~~(.01*e(le)*this.scale),l=s>>1,o=s-1,u=a*s,h=i%s,c=a%s,f=(h-1)*a,g=1/(s*s),_=1/(c*s),v=1/(h*s),C=1/(c*h),b=2*g,M=2*_,y=2*v,O=2*C,k=o,X=o*a,T=0,V=a-1,j=0,D=le-a,F=new n(3*le),S=0,x=0,w=0,z=I=Y=0,w=0;a>w;w++,S+=4,x+=3)z+=t[S],I+=t[S+1],Y+=t[S+2],F[x]=z,F[x+1]=I,F[x+2]=Y;for(x=0,w=0,z=I=Y=0,S=oe+a;se>S;S+=4,x+=3,w++)w>=a&&(w=0,z=I=Y=0),z+=t[S],I+=t[S+1],Y+=t[S+2],F[x+oe]=F[x]+z,F[x+oe+1]=F[x+1]+I,F[x+oe+2]=F[x+2]+Y;for(w=0,E=0,A=0,N=w,R=A,G=w-l+k,L=A+X,G=G>V?V:G,L=L>D?D:L,U=N+R,$=G+L,Q=G+R,W=N+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,d=b,te=d*(F[$]-F[Q]-F[W]+F[U]),ee=d*(F[$+1]-F[Q+1]-F[W+1]+F[U+1]),re=d*(F[$+2]-F[Q+2]-F[W+2]+F[U+2]),N=w+l,G=w+k,G=G>V?V:G,U=N+R,$=G+L,Q=G+R,W=N+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,ne=d*(F[$]-F[Q]-F[W]+F[U]),ae=d*(F[$+1]-F[Q+1]-F[W+1]+F[U+1]),ie=d*(F[$+2]-F[Q+2]-F[W+2]+F[U+2]),r&&(te=0>te?0:te>255?255:te,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie),te=~~te,ee=~~ee,re=~~re,ne=~~ne,ae=~~ae,ie=~~ie,J=te,K=ee,Z=re,P=0,q=0,H=0,S=0;se>S;S+=4)B=P+w+H+A<<2,t[B]=J,t[B+1]=K,t[B+2]=Z,P++,(P+w>=a||P>=s)&&(P=0,q++,H+=a,J=te,K=ee,Z=re),P>o-q&&(J=ne,K=ae,Z=ie),(q+E>=i||q>=s)&&(w+=s,w>=a&&(w=0,E+=s,A+=u),P=0,q=0,H=0,N=w,R=A,G=w-l+k,L=A+X,G=G>V?V:G,L=L>D?D:L,U=N+R,$=G+L,Q=G+R,W=N+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,p=0==G-N+l-c+1,m=0==L-R-f,d=p&&m?O:p?M:m?y:b,te=d*(F[$]-F[Q]-F[W]+F[U]),ee=d*(F[$+1]-F[Q+1]-F[W+1]+F[U+1]),re=d*(F[$+2]-F[Q+2]-F[W+2]+F[U+2]),N=w+l,G=w+k,G=G>V?V:G,U=N+R,$=G+L,Q=G+R,W=N+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,p=0==G-N+l-c+1,d=p&&m?O:p?M:m?y:b,ne=d*(F[$]-F[Q]-F[W]+F[U]),ae=d*(F[$+1]-F[Q+1]-F[W+1]+F[U+1]),ie=d*(F[$+2]-F[Q+2]-F[W+2]+F[U+2]),r&&(te=0>te?0:te>255?255:te,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie),te=~~te,ee=~~ee,re=~~re,ne=~~ne,ae=~~ae,ie=~~ie,J=te,K=ee,Z=re);return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Color.RGB2HSV,n=.7083333333333334;t.HSVConverterFilter=t.Create({name:"HSVConverterFilter",path:t.getPath(),apply:function(t){var a,i,s,l,o,u,h,c,f=t.length;if(e)for(l=0;f>l;l+=4)a=t[l],i=t[l+1],s=t[l+2],o=r({r:a,g:i,b:s}),u=o.h*n,c=255*o.s,h=o.v,0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),0>c?c=0:c>255&&(c=255),t[l]=~~u,t[l+1]=~~h,t[l+2]=~~c;else for(l=0;f>l;l+=4)a=t[l],i=t[l+1],s=t[l+2],o=r({r:a,g:i,b:s}),u=o.h*n,c=255*o.s,h=o.v,t[l]=~~u,t[l+1]=~~h,t[l+2]=~~c;return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,t.ImArray,t.Color.clampPixel),r=t.Color.RGB2HSV,n=(t.Color.HSV2RGB,t.Color.Color2RGBA);t.HueExtractorFilter=t.Create({name:"HueExtractorFilter",range:null,background:0,init:function(t,e){this.range=t,this.background=e||0},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{range:t.range,background:t.background}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.range=e.range,r.background=e.background),r},apply:function(t){if(!this.range||!this.range.length)return t;var a,i,s,l,o,u,h,c,f,p,m=t.length,d=this.range[0],g=this.range[this.range.length-1];for(f=n(this.background||0),l=~~e(f.r),o=~~e(f.g),u=~~e(f.b),h=~~e(f.a),c=0;m>c;c+=4)a=t[c],i=t[c+1],s=t[c+2],p=r({r:a,g:i,b:s}).h,(d>p||p>g)&&(t[c]=l,t[c+1]=o,t[c+2]=u,t[c+3]=h);return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,Math.min),r=Math.floor,n=t.CHANNEL.RED;t.CHANNEL.GREEN,t.CHANNEL.BLUE,t.CHANNEL.ALPHA,t.ChannelCopyFilter=t.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,init:function(t,e,r,a,i){this._srcImg=null,this.srcImg=null,this.srcChannel=e||n,this.dstChannel=r||n,this.centerX=a||0,this.centerY=i||0,t&&this.setSrc(t)},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_srcImg:t._srcImg,centerX:t.centerX,centerY:t.centerY,srcChannel:t.srcChannel,dstChannel:t.dstChannel}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r._srcImg=e._srcImg,r.centerX=e.centerX,r.centerY=e.centerY,r.srcChannel=e.srcChannel,r.dstChannel=e.dstChannel),r},setSrc:function(t){return t&&(this.srcImg=t,this._srcImg={data:t.getData(),width:t.width,height:t.height}),this},apply:function(t,n,a){if(!this._srcImg)return t;var i,s,l,o,u,h,c=this._srcImg.data,f=t.length,p=(c.length,this._srcImg.width),m=this._srcImg.height,d=this.srcChannel,g=this.dstChannel,_=e(n,p),v=e(a,m),C=this.centerX||0,b=this.centerY||0,M=p>>1,y=m>>1;for(C=r(C*(n-1))-M,b=r(b*(a-1))-y,i=0,s=0,l=0,i=0;f>i;i+=4,s++)s>=n&&(s=0,l++),u=s-C,h=l-b,u>=0&&_>u&&h>=0&&v>h&&(o=u+h*p<<2,t[i+g]=c[o+d]);return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,Math.min),r=Math.floor;t.AlphaMaskFilter=t.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,init:function(t,e,r){this.centerX=e||0,this.centerY=r||0,this._alphaMask=null,this.alphaMask=null,t&&this.setMask(t)},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_alphaMask:t._alphaMask,centerX:t.centerX,centerY:t.centerY}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r._alphaMask=e._alphaMask,r.centerX=e.centerX,r.centerY=e.centerY),r},setMask:function(t){return t&&(this.alphaMask=t,this._alphaMask={data:t.getData(),width:t.width,height:t.height}),this},apply:function(t,n,a){if(!this._alphaMask)return t;var i,s,l,o,u,h,c=this._alphaMask.data,f=this._alphaMask.width,p=this._alphaMask.height,m=t.length,d=(c.length,e(n,f)),g=e(a,p),_=this.centerX||0,v=this.centerY||0,C=f>>1,b=p>>1;for(_=r(_*(n-1))-C,v=r(v*(a-1))-b,s=0,l=0,i=0;m>i;i+=4,s++)s>=n&&(s=0,l++),u=s-_,h=l-v,u>=0&&d>u&&h>=0&&g>h?(o=u+h*f<<2,t[i+3]=c[o+3]):t[i+3]=0;return t}})}(t),!function(t,e){"use strict";var r,n=Math.min,a=Math.max,i=Math.round,s=(Math.floor,Math.abs),l=t._notSupportClamp;t.BlendFilter=t.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendMode:null,blendImage:null,startX:0,startY:0,amount:1,init:function(t,e,r){this.startX=0,this.startY=0,this.amount=1,this._blendImage=null,this.blendImage=null,this._blendMode=null,this.blendMode=null,t&&this.setImage(t),e&&this.setMode(e,r)},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_blendImage:t._blendImage,_blendMode:t._blendMode,startX:t.startX,startY:t.startY,amount:t.amount}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r._blendImage=e._blendImage,r.startX=e.startX,r.startY=e.startY,r.setMode(e._blendMode,e.amount)),r},setImage:function(t){return t&&(this.blendImage=t,this._blendImage={data:t.getData(),width:t.width,height:t.height}),this},setMode:function(t,i){return t?(this._blendMode=(""+t).toLowerCase(),this.blendMode=r[this._blendMode]||null,this.amount=a(0,n(1,e===i?1:i))):(this._blendMode=null,this.blendMode=null),this},reset:function(){return this.startX=0,this.startY=0,this.amount=1,this._blendMode=null,this.blendMode=null,this},apply:function(t,e,r){if(!this.blendMode||!this._blendImage)return t;var a,s,l,o,u,h=this.startX||0,c=this.startY||0,f=0,p=0,m=this._blendImage,d=this.amount||1;return o=m.width,u=m.height,0>h&&(f=-h,h=0),0>c&&(p=-c,c=0),h>=e||c>=r?t:f>=o||p>=u?t:(h=i(h),c=i(c),f=i(f),p=i(p),a=n(e-h,o-f),s=n(r-c,u-p),0>=a||0>=s?t:(l=m.data,this.blendMode(t,e,r,l,o,u,h,c,f,p,a,s,d)))}}),r={normal:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=Y,x=k,w=X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},lighten:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=F>Y?F:Y,x=z>k?z:k,w=I>X?I:X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},darken:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=F>Y?Y:F,x=z>k?k:z,w=I>X?X:I,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},multiply:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=.003921568627451*F*Y,x=.003921568627451*z*k,w=.003921568627451*I*X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},average:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=.5*(F+Y),x=.5*(z+k),w=.5*(I+X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},add:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=F+Y,x=z+k,w=I+X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},subtract:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=255>F+Y?0:F+Y-255,x=255>z+k?0:z+k-255,w=255>I+X?0:I+X-255,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},difference:function(t,e,r,n,a,i,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*a,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=s(k-z),w=s(X-I),E=s(S-Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=a);return t},negation:function(t,e,r,n,a,i,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*a,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=255-s(255-k-z),w=255-s(255-X-I),E=255-s(255-S-Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=a);return t},screen:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=255-((255-Y)*(255-F)>>8),x=255-((255-k)*(255-z)>>8),w=255-((255-X)*(255-I)>>8),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},exclusion:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=Y+F-.003921568627451*2*Y*F,x=k+z-.003921568627451*2*k*z,w=X+I-.003921568627451*2*X*I,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},overlay:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>F?.003921568627451*2*Y*F:255-.003921568627451*2*(255-Y)*(255-F),x=128>z?.003921568627451*2*k*z:255-.003921568627451*2*(255-k)*(255-z),S=128>I?.003921568627451*2*X*I:255-.003921568627451*2*(255-X)*(255-I),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},softlight:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>F?2*((Y>>1)+64)*.003921568627451*F:255-.003921568627451*2*(255-((Y>>1)+64))*(255-F),x=128>z?2*((k>>1)+64)*.003921568627451*z:255-.003921568627451*2*(255-((k>>1)+64))*(255-z),w=128>I?2*((X>>1)+64)*.003921568627451*I:255-.003921568627451*2*(255-((X>>1)+64))*(255-I),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},hardlight:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>Y?.003921568627451*2*F*Y:255-.003921568627451*2*(255-F)*(255-Y),x=128>k?.003921568627451*2*z*k:255-.003921568627451*2*(255-z)*(255-k),w=128>X?.003921568627451*2*I*X:255-.003921568627451*2*(255-I)*(255-X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},colordodge:function(t,e,r,a,i,s,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*i,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==z?z:n(255,(k<<8)/(255-z)),w=255==I?I:n(255,(X<<8)/(255-I)),E=255==Y?z:n(255,(S<<8)/(255-Y)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=i);return t},colorburn:function(t,e,r,n,i,s,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*i,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=0==z?z:a(0,255-(255-k<<8)/z),w=0==I?I:a(0,255-(255-X<<8)/I),E=0==Y?Y:a(0,255-(255-S<<8)/Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=i);return t},linearlight:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;for(var A;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],128>F?(A=2*F,S=255>A+Y?0:A+Y-255):(A=2*(F-128),S=A+Y),128>z?(A=2*z,x=255>A+k?0:A+k-255):(A=2*(z-128),x=A+k),128>I?(A=2*I,w=255>A+X?0:A+X-255):(A=2*(I-128),w=A+X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},reflect:function(t,e,r,a,i,s,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*i,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==z?z:n(255,k*k/(255-z)),w=255==I?I:n(255,X*X/(255-I)),E=255==Y?Y:n(255,S*S/(255-Y)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=i);return t},glow:function(t,e,r,a,i,s,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*i,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==k?k:n(255,z*z/(255-k)),w=255==X?X:n(255,I*I/(255-X)),E=255==S?S:n(255,Y*Y/(255-S)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=i);return t},phoenix:function(t,e,r,i,s,o,u,h,c,f,p,m,d){var g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;for(P=1-d,y=u,O=h*e,F=c,z=f*s,g=u+p,_=c+p,v=0,C=m*p;C>v;)b=y+O<<2,M=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=i[M],S=i[M+1],x=i[M+2],w=n(X,I)-a(X,I)+255,E=n(S,Y)-a(S,Y)+255,A=n(x,k)-a(x,k)+255,I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,l&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,y++,y>=g&&(y=u,O+=e),F++,F>=_&&(F=c,z+=s);return t},vividlight:function(t,e,r,i,s,o,u,h,c,f,p,m,d){var g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;P=1-d,y=u,O=h*e,F=c,z=f*s,g=u+p,_=c+p,v=0,C=m*p;for(var q;C>v;)b=y+O<<2,M=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=i[M],S=i[M+1],x=i[M+2],128>I?(q=2*I,w=0==q?q:a(0,255-(255-X<<8)/q)):(q=2*(I-128),w=255==q?q:n(255,(X<<8)/(255-q))),128>Y?(q=2*Y,E=0==q?q:a(0,255-(255-S<<8)/q)):(q=2*(Y-128),E=255==q?q:n(255,(S<<8)/(255-q))),128>k?(q=2*k,A=0==q?q:a(0,255-(255-x<<8)/q)):(q=2*(Y-128),A=255==q?q:n(255,(x<<8)/(255-q))),I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,l&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,y++,y>=g&&(y=u,O+=e),F++,F>=_&&(F=c,z+=s);return t},pinlight:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;for(var A;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],128>F?(A=2*F,S=A>Y?A:Y):(A=2*(F-128),S=A>Y?Y:A),128>z?(A=2*z,x=A>k?A:k):(A=2*(F-128),x=A>k?k:A),128>I?(A=2*I,w=A>X?A:X):(A=2*(I-128),w=A>X?X:A),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},hardmix:function(t,e,r,i,s,o,u,h,c,f,p,m,d){var g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;P=1-d,y=u,O=h*e,F=c,z=f*s,g=u+p,_=c+p,v=0,C=m*p;for(var q;C>v;)b=y+O<<2,M=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=i[M],S=i[M+1],x=i[M+2],128>I?(q=2*I,w=0==q?q:a(0,255-(255-X<<8)/q)):(q=2*(I-128),w=255==q?q:n(255,(X<<8)/(255-q))),w=128>w?0:255,128>Y?(q=2*Y,E=0==q?q:a(0,255-(255-S<<8)/q)):(q=2*(Y-128),E=255==q?q:n(255,(S<<8)/(255-q))),E=128>E?0:255,128>k?(q=2*k,A=0==q?q:a(0,255-(255-x<<8)/q)):(q=2*(k-128),A=255==q?q:n(255,(x<<8)/(255-q))),A=128>A?0:255,I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,l&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,y++,y>=g&&(y=u,O+=e),F++,F>=_&&(F=c,z+=s);return t}},r.lineardodge=r.add,r.linearburn=r.subtract}(t),!function(t){"use strict";var e=(t._notSupportClamp,t.Color.RGBA2Color),r=t.Color.Color2RGBA;t.ThresholdFilter=t.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(t,e){this.thresholds=t,this.quantizedColors=e||null},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{thresholds:t.thresholds,quantizedColors:t.quantizedColors}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.thresholds=e.thresholds,r.quantizedColors=e.quantizedColors),r},apply:function(t){if(!this.thresholds||!this.thresholds.length)return t;if(!this.quantizedColors||!this.quantizedColors.length)return t;var n,a,i,s,l,o,u,h,c=t.length,f=this.thresholds,p=f.length,m=this.quantizedColors,d=m.length;for(u=0;c>u;u+=4){for(l=e({r:t[u],g:t[u+1],b:t[u+2],a:t[u+3]}),h=0;p>h&&l>f[h];)h++;l=d>h?m[h]:255,o=r(l),n=o.r,a=o.g,i=o.b,s=o.a,t[u]=n,t[u+1]=a,t[u+2]=i,t[u+3]=s}return t}})}(t),!function(t){"use strict";var e=(Math.sqrt,Math.exp,Math.log),r=Math.abs,n=Math.floor,a=t._notSupportClamp,i=t.Array32F;t.BokehFilter=t.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(t,e,r,n){this.centerX=t||0,this.centerY=e||0,this.radius=r||10,this.amount=n||10},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{centerX:t.centerX,centerY:t.centerY,radius:t.radius,amount:t.amount}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.centerX=e.centerX,r.centerY=e.centerY,r.radius=e.radius,r.amount=e.amount),r},apply:function(t,s,l){var o,u,h,c,f,p,m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G=t.length,L=this.centerX||0,T=this.centerY||0,j=this.radius,V=this.amount;if(0>=V)return t;for(o=G>>2,H=0,B=s-1,N=0,R=o-s,L=n(L*(s-1)),T=n(T*(l-1)),h=(o<<1)+o,m=(s<<1)+s,u=new i(h),d=0,g=0,_=0,c=f=p=0,_=0;s>_;_++,d+=4,g+=3)c+=t[d],f+=t[d+1],p+=t[d+2],u[g]=c,u[g+1]=f,u[g+2]=p;for(d=m+s,g=0,_=0,c=f=p=0,d=m+s;G>d;d+=4,g+=3,_++)_>=s&&(_=0,c=f=p=0),c+=t[d],f+=t[d+1],p+=t[d+2],u[g+m]=u[g]+c,u[g+m+1]=u[g+1]+f,u[g+m+2]=u[g+2]+p;for(_=0,v=0,C=0,d=0;G>d;d+=4,_++)_>=s&&(_=0,v++,C+=s),M=_-L,y=v-T,b=r(M)+r(y),O=b>j?~~e((b-j)*V):~~(b/j+.5),O>0&&(F=O*s,z=.25/(O*O),I=_-O,Y=C-F,k=_+O,X=C+F,H>I?I=H:k>B&&(k=B),N>Y?Y=N:X>R&&(X=R),S=I+Y,E=k+X,x=k+Y,w=I+X,S=(S<<1)+S,x=(x<<1)+x,w=(w<<1)+w,E=(E<<1)+E,A=z*(u[E]-u[x]-u[w]+u[S]),P=z*(u[E+1]-u[x+1]-u[w+1]+u[S+1]),q=z*(u[E+2]-u[x+2]-u[w+2]+u[S+2]),a&&(A=0>A?0:A>255?255:A,P=0>P?0:P>255?255:P,q=0>q?0:q>255?255:q),t[d]=~~A,t[d+1]=~~P,t[d+2]=~~q);return t}})}(t),e});