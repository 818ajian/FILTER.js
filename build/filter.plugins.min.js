/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
* 
* PLUGINS Package  (needs BASIC package)
*
* @version 0.6.3
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/(function(d){var v=d._notSupportTypedArrays;d.NoiseFilter=d.Create({min:-127,max:127,init:function(b,a){this.min=b||-127;this.max=a||127},apply:function(b){var a=this.max-this.min,c=Math.random,g=this.min,e,f=b.length,i,d,k,o;for(e=0;e<f;)d=b[e],k=b[e+1],o=b[e+2],i=a*c()+g,d+=i,k+=i,i=o+i,v&&(d<0?d=0:d>255&&(d=255),k<0?k=0:k>255&&(k=255),i<0?i=0:i>255&&(i=255)),b[e]=~~d,b[e+1]=~~k,b[e+2]=~~i,e+=4;return b}})})(FILTER);
(function(d){var v=d._notSupportTypedArrays;d.HistogramEqualizeFilter=d.Create({apply:function(b){var a,c,g,e;e=0;var f=255,i=new d.Array32F(256),q=new d.Array32F(256),k=0,o,j,h,m=b.length;h=m>>2;o=1/h;var p=Array(h);j=d.Color.RGB2YCbCr;var s=d.Color.YCbCr2RGB;for(h=0;h<256;)i[h]=0,q[h]=0,h++;for(k=h=0;h<m;){a=b[h];c=b[h+1];g=b[h+2];a=j({r:a,g:c,b:g});i[a.y]+=o;if(a.y>e)e=a.y;if(a.y<f)f=a.y;p[k]=a;h+=4;k++}for(h=k=0;h<256;)k+=i[h],q[h]=k,h++;e-=f;for(k=h=0;h<m;)a=p[k],a.y=q[a.y]*e+f,j=s(a),i=j.r,
o=j.g,j=j.b,v&&(i<0?i=0:i>255&&(i=255),o<0?o=0:o>255&&(o=255),j<0?j=0:j>255&&(j=255)),b[h]=~~i,b[h+1]=~~o,b[h+2]=~~j,h+=4,k++;return b}})})(FILTER);
(function(d){var v=d._notSupportTypedArrays;d.RGBHistogramEqualizeFilter=d.Create({apply:function(b){var a,c,g,e,f,i;i=f=e=0;var q=255,k=255,o=255,j=new d.Array32F(256),h=new d.Array32F(256),m=new d.Array32F(256),p=new d.Array32F(256),s=new d.Array32F(256),x=new d.Array32F(256),l,n=b.length,r=1/(n>>2);for(l=0;l<256;)j[l]=0,h[l]=0,m[l]=0,p[l]=0,s[l]=0,x[l]=0,l++;for(l=0;l<n;)a=b[l],c=b[l+1],g=b[l+2],j[a]+=r,h[c]+=r,m[g]+=r,a>e&&(e=a),a<q&&(q=a),c>f&&(f=c),c<k&&(k=c),g>i&&(i=g),g<o&&(o=g),l+=4;for(l=
g=c=a=0;l<256;)g+=j[l],p[l]=g,c+=h[l],s[l]=c,a+=m[l],x[l]=a,l++;e-=q;f-=k;i-=o;for(l=0;l<n;)a=b[l],c=b[l+1],g=b[l+2],a=p[a]*e+q,c=s[c]*f+k,g=x[g]*i+o,v&&(a<0?a=0:a>255&&(a=255),c<0?c=0:c>255&&(c=255),g<0?g=0:g>255&&(g=255)),b[l]=~~a,b[l+1]=~~c,b[l+2]=~~g,l+=4;return b}})})(FILTER);
(function(d){var v=Math.sqrt,b=d._notSupportTypedArrays;d.PixelateFilter=d.Create({scale:1,init:function(a){this.scale=a||1},apply:function(a,c,g){if(this.scale<=1)return a;if(this.scale>100)this.scale=100;var e=a.length,f=c*g,g=~~(v(f)*this.scale*0.01),i=g*g,q=1/i,k=g<<2,o=c*g;i<<=2;var j=new d.Array32F(f*3),h,m,p,s=(c<<1)+c,x,l,n,r,t,u,y,B,z,A,w;x=g-1;l=(g-1)*c;z=c-1;A=f-c;for(h=m=p=r=n=f=0;r<c;)h+=a[f],m+=a[f+1],p+=a[f+2],j[n]=h,j[n+1]=m,j[n+2]=p,f+=4,n+=3,r++;f=s+c;n=s;for(h=m=p=r=0;f<e;)h+=a[f],
m+=a[f+1],p+=a[f+2],j[n]=j[n-s]+h,j[n+1]=j[n-s+1]+m,j[n+2]=j[n-s+2]+p,f+=4,n+=3,r++,r>=c&&(h=m=p=r=0);for(s=r=f=0;f<e;){h=r;t=s;u=r+x;m=s+l;u>z&&(u=z);m>A&&(m=A);n=h+t;p=u+m;t=u+t;u=h+m;n=(n<<1)+n;t=(t<<1)+t;u=(u<<1)+u;p=(p<<1)+p;h=q*(j[p]-j[t]-j[u]+j[n]);m=q*(j[p+1]-j[t+1]-j[u+1]+j[n+1]);w=q*(j[p+2]-j[t+2]-j[u+2]+j[n+2]);b&&(h<0?h=0:h>255&&(h=255),m<0?m=0:m>255&&(m=255),w<0?w=0:w>255&&(w=255));h=~~h;m=~~m;w=~~w;n=f;t=r;u=s;B=r+g;p=f+i;for(p>e&&(p=e);n<p;)if(y=t+u<<2,a[y]=h,a[y+1]=m,a[y+2]=w,n+=4,
t++,t>=c||t>=B)t=r,u+=c;f+=k;r+=g;r>=c&&(r=0,s+=o)}return a}})})(FILTER);(function(d){var v=d._notSupportTypedArrays;d.HSVConverterFilter=d.Create({apply:function(b,a,c){for(var g,e,f=b.length,i=d.Color.RGB2HSV,a=0;a<f;)g=b[a],c=b[a+1],e=b[a+2],e=i({r:g,g:c,b:e}),c=e.h*0.7083333333333334,g=e.s*255,e=e.v,v&&(c<0?c=0:c>255&&(c=255),e<0?e=0:e>255&&(e=255),g<0?g=0:g>255&&(g=255)),b[a]=~~c,b[a+1]=~~e,b[a+2]=~~g,a+=4;return b}})})(FILTER);
(function(d){var v=d._notSupportTypedArrays;d.HueExtractorFilter=d.Create({range:null,background:0,init:function(b,a){this.range=b;this.background=a||0},apply:function(b){if(!this.range||!this.range.length)return b;var a,c,g,e,f,i,q=b.length,k,o=d.Color.RGB2HSV,j=this.range[0],h=this.range[this.range.length-1];e=new d.ImArray(q);k=d.Color.Color2RGBA(this.background||0);for(i=0;i<q;)a=b[i],c=b[i+1],g=b[i+2],a=o({r:a,g:c,b:g}).h,a>=j&&a<=h?(a=b[i],c=b[i+1],g=b[i+2],f=b[i+3]):(a=k.r,c=k.g,g=k.b,f=k.a),
v&&(a<0?a=0:a>255&&(a=255),c<0?c=0:c>255&&(c=255),g<0?g=0:g>255&&(g=255),f<0?f=0:f>255&&(f=255)),e[i]=~~a,e[i+1]=~~c,e[i+2]=~~g,e[i+3]=~~f,i+=4;return e}})})(FILTER);
(function(d){d.AlphaMaskFilter=d.Create({alphaMask:null,centerX:0,centerY:0,init:function(d,b,a){this.alphaMask=d||null;this.centerX=b||0;this.centerY=a||0},apply:function(d,b,a){if(!this.alphaMask)return d;var c=this.alphaMask.getData(),g=d.length,e=this.alphaMask.width,f=this.alphaMask.height,i,q,k,o=Math.min(b,e),j=Math.min(a,f),h,m;h=this.centerX+(b-e>>1);m=this.centerY+(a-f>>1);for(i=f=a=0;a<g;)q=f-h,k=i-m,q>=0&&q<o&&k>=0&&k<j?(q=q+k*e<<2,d[a+3]=c[q+3]):d[a+3]=0,a+=4,f++,f>=b&&(f=0,i++);return d}})})(FILTER);
(function(d){var v=d._notSupportTypedArrays;d.ThresholdFilter=d.Create({thresholds:null,quantizedColors:null,init:function(b,a){this.thresholds=b;this.quantizedColors=a||null},apply:function(b){if(!this.thresholds||!this.thresholds.length)return b;else if(!this.quantizedColors||!this.quantizedColors.length)return b;var a,c,g,e,f,i=b.length,q=d.Color.RGBA2Color,k=d.Color.Color2RGBA,o=this.thresholds,j=o.length,h=this.quantizedColors,m=h.length;for(f=0;f<i;){a=q({r:b[f],g:b[f+1],b:b[f+2],a:b[f+3]});
for(c=0;c<j&&a>o[c];)c++;a=c<m?h[c]:255;e=k(a);a=e.r;c=e.g;g=e.b;e=e.a;v&&(a<0?a=0:a>255&&(a=255),c<0?c=0:c>255&&(c=255),g<0?g=0:g>255&&(g=255),e<0?e=0:e>255&&(e=255));b[f]=~~a;b[f+1]=~~c;b[f+2]=~~g;b[f+3]=~~e;f+=4}return b}})})(FILTER);
