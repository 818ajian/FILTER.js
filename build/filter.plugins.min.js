/**
*
*   FILTER.js Plugins
*   @version: 0.9.0
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(r,e){"use strict";"object"==typeof module&&module.exports?module.exports=e.call(r,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(n,t){return e.moduleUri=n.uri,e.call(r,t),t}):(e.call(r,r.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return r.FILTER})}(this,function r(e){return!function(e){"use strict";var n=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(r,e){var n=this;n.min=r||-127,n.max=e||127},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{min:r.min,max:r.max}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.min=e.min,n.max=e.max),n},apply:function(r,e,a){var i=this;if(!i._isOn)return r;var s,o,l,u,h,c,f,d,m=i.max-i.min,g=i.min,p=r.length;if(n)for(s=0;p>s;s+=4)l=r[s],u=r[s+1],h=r[s+2],o=m*t()+g,c=l+o,f=u+o,d=h+o,0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),0>d?d=0:d>255&&(d=255),r[s]=~~c,r[s+1]=~~f,r[s+2]=~~d;else for(s=0;p>s;s+=4)l=r[s],u=r[s+1],h=r[s+2],o=m*t()+g,c=l+o,f=u+o,d=h+o,r[s]=~~c,r[s+1]=~~f,r[s+2]=~~d;return r}})}(e),!function(e){"use strict";var n=e._notSupportClamp,t=e.Array32F,a=e.Color.RGB2YCbCr,i=e.Color.YCbCr2RGB;e.Create({name:"HistogramEqualizeFilter",path:e.getPath(r.moduleUri),apply:function(r,e,s){var o=this;if(!o._isOn)return r;var l,u,h,c,f,d,m,g,p,_,v,y=0,C=255,b=0,M=r.length,I=M>>2,w=1/I;for(f=new t(256),p=0;256>p;p+=8)f[p]=0,f[p+1]=0,f[p+2]=0,f[p+3]=0,f[p+4]=0,f[p+5]=0,f[p+6]=0,f[p+7]=0;for(p=0;M>p;p+=4)_=a(r.subarray(p,p+3)),l=r[p]=~~_[2],u=r[p+1]=~~_[0],h=r[p+2]=~~_[1],f[u]+=w,u>y?y=u:C>u&&(C=u);for(b=0,p=0;256>p;p+=8)b+=f[p],f[p]=b,b+=f[p+1],f[p+1]=b,b+=f[p+2],f[p+2]=b,b+=f[p+3],f[p+3]=b,b+=f[p+4],f[p+4]=b,b+=f[p+5],f[p+5]=b,b+=f[p+6],f[p+6]=b,b+=f[p+7],f[p+7]=b;if(c=y-C,n)for(p=0;M>p;p+=4)_=[r[p+1],r[p+2],r[p]],_[0]=f[_[0]]*c+C,v=i(_),d=v[0],m=v[1],g=v[2],d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m,g=0>g?0:g>255?255:g,r[p]=~~d,r[p+1]=~~m,r[p+2]=~~g;else for(p=0;M>p;p+=4)_=[r[p+1],r[p+2],r[p]],_[0]=f[_[0]]*c+C,v=i(_),r[p]=~~v[0],r[p+1]=~~v[1],r[p+2]=~~v[2];return r}}),e.Create({name:"GrayscaleHistogramEqualizeFilter",path:e.getPath(r.moduleUri),apply:function(r,e,a){var i=this;if(!i._isOn)return r;var s,o,l,u,h,c=0,f=255,d=0,m=r.length,g=m>>2,p=1/g;for(u=new t(256),h=0;256>h;h+=8)u[h]=0,u[h+1]=0,u[h+2]=0,u[h+3]=0,u[h+4]=0,u[h+5]=0,u[h+6]=0,u[h+7]=0;for(h=0;m>h;h+=4)s=r[h],u[s]+=p,s>c?c=s:f>s&&(f=s);for(d=0,h=0;256>h;h+=8)d+=u[h],u[h]=d,d+=u[h+1],u[h+1]=d,d+=u[h+2],u[h+2]=d,d+=u[h+3],u[h+3]=d,d+=u[h+4],u[h+4]=d,d+=u[h+5],u[h+5]=d,d+=u[h+6],u[h+6]=d,d+=u[h+7],u[h+7]=d;if(l=c-f,n)for(h=0;m>h;h+=4)s=r[h],o=u[s]*l+f,o=0>o?0:o>255?255:o,o=~~o,r[h]=o,r[h+1]=o,r[h+2]=o;else for(h=0;m>h;h+=4)s=r[h],o=~~(u[s]*l+f),r[h]=o,r[h+1]=o,r[h+2]=o;return r}}),e.Create({name:"RGBHistogramEqualizeFilter",path:e.getPath(r.moduleUri),apply:function(r,e,a){var i=this;if(!i._isOn)return r;var s,o,l,u,h,c,f,d,m,g,p,_,v,y,C,b,M=0,I=0,w=0,O=255,z=255,A=255,x=r.length,k=x>>2,P=1/k;for(f=new t(256),d=new t(256),m=new t(256),b=0;256>b;b+=8)f[b]=0,d[b]=0,m[b]=0,f[b+1]=0,d[b+1]=0,m[b+1]=0,f[b+2]=0,d[b+2]=0,m[b+2]=0,f[b+3]=0,d[b+3]=0,m[b+3]=0,f[b+4]=0,d[b+4]=0,m[b+4]=0,f[b+5]=0,d[b+5]=0,m[b+5]=0,f[b+6]=0,d[b+6]=0,m[b+6]=0,f[b+7]=0,d[b+7]=0,m[b+7]=0;for(b=0;x>b;b+=4)s=r[b],o=r[b+1],l=r[b+2],f[s]+=P,d[o]+=P,m[l]+=P,s>M?M=s:O>s&&(O=s),o>I?I=o:z>o&&(z=o),l>w?w=l:A>l&&(A=l);for(g=p=_=0,b=0;256>b;b+=8)g+=f[b],f[b]=g,p+=d[b],d[b]=p,_+=m[b],m[b]=_,g+=f[b+1],f[b+1]=g,p+=d[b+1],d[b+1]=p,_+=m[b+1],m[b+1]=_,g+=f[b+2],f[b+2]=g,p+=d[b+2],d[b+2]=p,_+=m[b+2],m[b+2]=_,g+=f[b+3],f[b+3]=g,p+=d[b+3],d[b+3]=p,_+=m[b+3],m[b+3]=_,g+=f[b+4],f[b+4]=g,p+=d[b+4],d[b+4]=p,_+=m[b+4],m[b+4]=_,g+=f[b+5],f[b+5]=g,p+=d[b+5],d[b+5]=p,_+=m[b+5],m[b+5]=_,g+=f[b+6],f[b+6]=g,p+=d[b+6],d[b+6]=p,_+=m[b+6],m[b+6]=_,g+=f[b+7],f[b+7]=g,p+=d[b+7],d[b+7]=p,_+=m[b+7],m[b+7]=_;if(u=M-O,h=I-z,c=w-A,n)for(b=0;x>b;b+=4)s=r[b],o=r[b+1],l=r[b+2],v=f[s]*u+O,y=d[o]*h+z,C=m[l]*c+A,v=0>v?0:v>255?255:v,y=0>y?0:y>255?255:y,C=0>C?0:C>255?255:C,r[b]=~~v,r[b+1]=~~y,r[b+2]=~~C;else for(b=0;x>b;b+=4)s=r[b],o=r[b+1],l=r[b+2],v=f[s]*u+O,y=d[o]*h+z,C=m[l]*c+A,r[b]=~~v,r[b+1]=~~y,r[b+2]=~~C;return r}})}(e),!function(e){"use strict";var n=Math.sqrt,t=e._notSupportClamp,a=e.Array32F;e.Create({name:"PixelateFilter",scale:1,init:function(r){var e=this;e.scale=r||1},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.scale=e.scale),n},apply:function(r,e,i){var s=this;if(!s._isOn||s.scale<=1)return r;s.scale>100&&(s.scale=100);var o,l,u,h,c,f,d,m,g,p,_,v,y,C,b,M,I,w,O,z,A,x,k,P,F,Y,S,N,L,R,X,U,H,q,E,T,G,B,W,j,$,D,V,Q,J,K,Z=r.length,rr=Z>>>2,er=(e<<1)+e;for(o=~~(n(rr)*s.scale*.01),l=e*o,u=i%o,h=e%o,c=(u-1)*e,g=1/(o*o),p=1/(h*o),_=1/(u*o),v=1/(h*u),y=g,C=p,b=_,M=v,A=o-1,x=(o-1)*e,T=0,B=e-1,G=0,W=rr-e,I=new a(3*rr),k=0,P=0,F=0,w=O=z=0,F=0;e>F;F++,k+=4,P+=3)w+=r[k],O+=r[k+1],z+=r[k+2],I[P]=w,I[P+1]=O,I[P+2]=z;for(P=0,F=0,w=O=z=0,k=er+e;Z>k;k+=4,P+=3,F++)F>=e&&(F=0,w=O=z=0),w+=r[k],O+=r[k+1],z+=r[k+2],I[P+er]=I[P]+w,I[P+er+1]=I[P+1]+O,I[P+er+2]=I[P+2]+z;for(F=0,Y=0,S=0,U=F,H=S,q=U+A,E=H+x,q=q>B?B:q,E=E>W?W:E,j=U+H,V=q+E,$=q+H,D=U+E,j=(j<<1)+j,$=($<<1)+$,D=(D<<1)+D,V=(V<<1)+V,m=y,Q=m*(I[V]-I[$]-I[D]+I[j]),J=m*(I[V+1]-I[$+1]-I[D+1]+I[j+1]),K=m*(I[V+2]-I[$+2]-I[D+2]+I[j+2]),t&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K,N=0,L=0,R=0,k=0;Z>k;k+=4)X=N+F+R+S<<2,r[X]=Q,r[X+1]=J,r[X+2]=K,N++,(N+F>=e||N>=o)&&(N=0,L++,R+=e),(L+Y>=i||L>=o)&&(F+=o,F>=e&&(F=0,Y+=o,S+=l),N=0,L=0,R=0,U=F,H=S,q=U+A,E=H+x,q=q>B?B:q,E=E>W?W:E,j=U+H,V=q+E,$=q+H,D=U+E,j=(j<<1)+j,$=($<<1)+$,D=(D<<1)+D,V=(V<<1)+V,f=0==q-U-h+1,d=0==E-H-c,m=f&&d?M:f?C:d?b:y,Q=m*(I[V]-I[$]-I[D]+I[j]),J=m*(I[V+1]-I[$+1]-I[D+1]+I[j+1]),K=m*(I[V+2]-I[$+2]-I[D+2]+I[j+2]),t&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K);return r}})}(e),!function(e){"use strict";var n=Math.sqrt,t=(Math.SQRT2,Math.min,e._notSupportClamp),a=e.Array32F;e.Create({name:"TriangularPixelateFilter",scale:1,init:function(r){var e=this;e.scale=r||1},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.scale=e.scale),n},apply:function(r,e,i){var s=this;if(!s._isOn||s.scale<=1)return r;s.scale>100&&(s.scale=100);var o,l,u,h,c,f,d,m,g,p,_,v,y,C,b,M,I,w,O,z,A,x,k,P,F,Y,S,N,L,R,X,U,H,q,E,T,G,B,W,j,$,D,V,Q,J,K,Z,rr,er,nr,tr,ar,ir,sr,or=r.length,lr=or>>>2,ur=(e<<1)+e;for(o=~~(n(lr)*s.scale*.01),l=o>>1,u=o-1,h=e*o,c=i%o,f=e%o,d=(c-1)*e,_=1/(o*o),v=1/(f*o),y=1/(c*o),C=1/(f*c),b=2*_,M=2*v,I=2*y,w=2*C,k=u,P=u*e,B=0,j=e-1,W=0,$=lr-e,O=new a(3*lr),F=0,Y=0,S=0,z=A=x=0,S=0;e>S;S++,F+=4,Y+=3)z+=r[F],A+=r[F+1],x+=r[F+2],O[Y]=z,O[Y+1]=A,O[Y+2]=x;for(Y=0,S=0,z=A=x=0,F=ur+e;or>F;F+=4,Y+=3,S++)S>=e&&(S=0,z=A=x=0),z+=r[F],A+=r[F+1],x+=r[F+2],O[Y+ur]=O[Y]+z,O[Y+ur+1]=O[Y+1]+A,O[Y+ur+2]=O[Y+2]+x;for(S=0,N=0,L=0,q=S,E=L,T=S-l+k,G=L+P,T=T>j?j:T,G=G>$?$:G,D=q+E,J=T+G,V=T+E,Q=q+G,D=(D<<1)+D,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,p=b,er=p*(O[J]-O[V]-O[Q]+O[D]),nr=p*(O[J+1]-O[V+1]-O[Q+1]+O[D+1]),tr=p*(O[J+2]-O[V+2]-O[Q+2]+O[D+2]),q=S+l,T=S+k,T=T>j?j:T,D=q+E,J=T+G,V=T+E,Q=q+G,D=(D<<1)+D,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,ar=p*(O[J]-O[V]-O[Q]+O[D]),ir=p*(O[J+1]-O[V+1]-O[Q+1]+O[D+1]),sr=p*(O[J+2]-O[V+2]-O[Q+2]+O[D+2]),t&&(er=0>er?0:er>255?255:er,nr=0>nr?0:nr>255?255:nr,tr=0>tr?0:tr>255?255:tr,ar=0>ar?0:ar>255?255:ar,ir=0>ir?0:ir>255?255:ir,sr=0>sr?0:sr>255?255:sr),er=~~er,nr=~~nr,tr=~~tr,ar=~~ar,ir=~~ir,sr=~~sr,K=er,Z=nr,rr=tr,R=0,X=0,U=0,F=0;or>F;F+=4)H=R+S+U+L<<2,r[H]=K,r[H+1]=Z,r[H+2]=rr,R++,(R+S>=e||R>=o)&&(R=0,X++,U+=e,K=er,Z=nr,rr=tr),R>u-X&&(K=ar,Z=ir,rr=sr),(X+N>=i||X>=o)&&(S+=o,S>=e&&(S=0,N+=o,L+=h),R=0,X=0,U=0,q=S,E=L,T=S-l+k,G=L+P,T=T>j?j:T,G=G>$?$:G,D=q+E,J=T+G,V=T+E,Q=q+G,D=(D<<1)+D,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,m=0==T-q+l-f+1,g=0==G-E-d,p=m&&g?w:m?M:g?I:b,er=p*(O[J]-O[V]-O[Q]+O[D]),nr=p*(O[J+1]-O[V+1]-O[Q+1]+O[D+1]),tr=p*(O[J+2]-O[V+2]-O[Q+2]+O[D+2]),q=S+l,T=S+k,T=T>j?j:T,D=q+E,J=T+G,V=T+E,Q=q+G,D=(D<<1)+D,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,m=0==T-q+l-f+1,p=m&&g?w:m?M:g?I:b,ar=p*(O[J]-O[V]-O[Q]+O[D]),ir=p*(O[J+1]-O[V+1]-O[Q+1]+O[D+1]),sr=p*(O[J+2]-O[V+2]-O[Q+2]+O[D+2]),t&&(er=0>er?0:er>255?255:er,nr=0>nr?0:nr>255?255:nr,tr=0>tr?0:tr>255?255:tr,ar=0>ar?0:ar>255?255:ar,ir=0>ir?0:ir>255?255:ir,sr=0>sr?0:sr>255?255:sr),er=~~er,nr=~~nr,tr=~~tr,ar=~~ar,ir=~~ir,sr=~~sr,K=er,Z=nr,rr=tr);return r}})}(e),!function(e,n){"use strict";var t=7/16,a=3/16,i=5/16,s=1/16,o=e.Array32F,l=e.Color.clamp,u=e.Color.RGB2YCbCr,h=e.Color.YCbCr2RGB;e.Create({name:"HalftoneFilter",_threshold:.4,_size:1,_grayscale:!1,init:function(r,e,t){var a=this;a._size=r||1,a._threshold=l(n===e?.4:e,0,1),a._grayscale=!!t},path:e.getPath(r.moduleUri),size:function(r){return this._size=r,this},threshold:function(r){return this._threshold=l(r,0,1),this},grayscale:function(r){return arguments.length||(r=!0),this._grayscale=!!r,this},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_size:r._size,_threshold:r._threshold,_grayscale:r._grayscale}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n._size=e._size,n._threshold=e._threshold,n._grayscale=e._grayscale),n},apply:function(r,e,n){var c,f,d,m,g,p,_,v,y,C,b,M,I,w,O,z,A,x=this,k=r.length,P=k>>>2,F=new o(3*P),Y=x._size,S=Y*Y,N=1/S,L=255*x._threshold,R=R<<1,X=!x._grayscale,U=Y*e,H=t,q=a,E=i,T=s;for(_=0,v=0,p=0;n>_;){for(M=I=w=0,y=0,C=0,b=0;Y>C;)c=p+v+y+b<<2,f=3*(p+v+y+b),M+=r[c]+F[f],I+=r[c+1]+F[f+1],w+=r[c+2]+F[f+2],y++,y>=Y&&(y=0,C++,b+=e);if(M*=N,I*=N,w*=N,g=X?u([M,I,w]):[M,I,w],d=g[0],d>L?X?(g[0]=l(~~d,0,255),m=h(g)):m=[255,255,255]:m=[0,0,0],c=p+v<<2,O=r[c]-m[0],z=r[c+1]-m[1],A=r[c+2]-m[2],e>p+Y)for(y=Y,C=0,b=0;Y>C;)f=3*(p+v+y+b),F[f]+=H*O,F[f+1]+=H*z,F[f+2]+=H*A,y++,y>=R&&(y=Y,C++,b+=e);if(n>_+Y&&p>Y)for(y=-Y,C=Y,b=0;R>C;)f=3*(p+v+y+b),F[f]+=q*O,F[f+1]+=q*z,F[f+2]+=q*A,y++,y>=0&&(y=-Y,C++,b+=e);if(n>_+Y)for(y=0,C=Y,b=0;R>C;)f=3*(p+v+y+b),F[f]+=E*O,F[f+1]+=E*z,F[f+2]+=E*A,y++,y>=Y&&(y=0,C++,b+=e);if(n>_+Y&&e>p+Y)for(y=Y,C=Y,b=0;R>C;)f=3*(p+v+y+b),F[f]+=T*O,F[f+1]+=T*z,F[f+2]+=T*A,y++,y>=R&&(y=Y,C++,b+=e);for(y=0,C=0,b=0;Y>C;)c=p+v+y+b<<2,r[c]=m[0],r[c+1]=m[1],r[c+2]=m[2],y++,y>=Y&&(y=0,C++,b+=e);p+=Y,p>=e&&(p=0,_+=Y,v+=U)}return r}})}(e),!function(e){"use strict";var n=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=e._notSupportClamp,s=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(r,e,n,t){var a=this;a.centerX=r||0,a.centerY=e||0,a.radius=n||10,a.amount=t||10},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{centerX:r.centerX,centerY:r.centerY,radius:r.radius,amount:r.amount}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.centerX=e.centerX,n.centerY=e.centerY,n.radius=e.radius,n.amount=e.amount),n},apply:function(r,e,o){var l=this;if(!l._isOn)return r;var u,h,c,f,d,m,g,p,_,v,y,C,b,M,I,w,O,z,A,x,k,P,F,Y,S,N,L,R,X,U,H,q,E,T=r.length,G=l.centerX||0,B=l.centerY||0,W=l.radius,j=l.amount;if(0>=j)return r;for(u=T>>2,U=0,H=e-1,q=0,E=u-e,G=a(G*(e-1)),B=a(B*(o-1)),c=(u<<1)+u,g=(e<<1)+e,h=new s(c),p=0,_=0,v=0,f=d=m=0,v=0;e>v;v++,p+=4,_+=3)f+=r[p],d+=r[p+1],m+=r[p+2],h[_]=f,h[_+1]=d,h[_+2]=m;for(p=g+e,_=0,v=0,f=d=m=0,p=g+e;T>p;p+=4,_+=3,v++)v>=e&&(v=0,f=d=m=0),f+=r[p],d+=r[p+1],m+=r[p+2],h[_+g]=h[_]+f,h[_+g+1]=h[_+1]+d,h[_+g+2]=h[_+2]+m;for(v=0,y=0,C=0,p=0;T>p;p+=4,v++)v>=e&&(v=0,y++,C+=e),M=v-G,I=y-B,b=t(M)+t(I),w=b>W?~~n((b-W)*j):~~(b/W+.5),w>0&&(O=w*e,z=.25/(w*w),A=v-w,x=C-O,k=v+w,P=C+O,U>A?A=U:k>H&&(k=H),q>x?x=q:P>E&&(P=E),F=A+x,N=k+P,Y=k+x,S=A+P,F=(F<<1)+F,Y=(Y<<1)+Y,S=(S<<1)+S,N=(N<<1)+N,L=z*(h[N]-h[Y]-h[S]+h[F]),R=z*(h[N+1]-h[Y+1]-h[S+1]+h[F+1]),X=z*(h[N+2]-h[Y+2]-h[S+2]+h[F+2]),i&&(L=0>L?0:L>255?255:L,R=0>R?0:R>255?255:R,X=0>X?0:X>255?255:X),r[p]=~~L,r[p+1]=~~R,r[p+2]=~~X);return r}})}(e),!function(e){"use strict";e.Create({name:"SeamlessTileFilter",type:0,init:function(r){var e=this;e.type=r||0},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{type:r.type}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.type=e.type),n},apply:function(r,n,t){var a,i,s,o,l,u,h,c,f,d,m,g,p,_,v,y=this,C=y.type;for(n!==t?r=e.Image.resize(r,n,t,g=n>t?n:t,g):g=n,p=Math.round(g/2),_=g*g,v=r.length,a=new e.ImArray(v),i=new e.ImArray(v),s=new e.Array8U(_),c=0,f=0,d=0;v>d;d+=4,c++)c>=g&&(c=0,f++),m=(c+p)%g+(f+p)%g*g<<2,a[m]=r[d],a[m+1]=r[d+1],a[m+2]=r[d+2],a[m+3]=r[d+3];for(c=0;p-1>=c;c++)for(f=0;p-1>=f;f++){switch(C){case 0:h=Math.sqrt((c-p)*(c-p)+(f-p)*(f-p))/p;break;case 1:h=p-f>p-c?(f-p)/p:(c-g/2)/p;break;case 2:default:h=p-f>p-c?Math.sqrt((f-g)*(f-g)+(c-g)*(c-g))/(1.13*g):Math.sqrt((c-g)*(c-g)+(f-g)*(f-g))/(1.13*g)}h=255-255*h,1>h?h=1:h>255&&(h=255),s[c+f*g]=h,s[c+(g-1-f)*g]=h,s[g-1-c+f*g]=h,s[g-1-c+(g-1-f)*g]=h}for(f=0;g-1>=f;f++)for(c=0;g-1>=c;c++)m=c+f*g,o=s[m],l=s[(c+p)%g+(f+p)%g*g],u=o+l,o/=u,l/=u,m<<=2,i[m]=~~(o*r[m]+l*a[m]),i[m+1]=~~(o*r[m+1]+l*a[m+1]),i[m+2]=~~(o*r[m+2]+l*a[m+2]),i[m+3]=r[m+3];return n!==t&&(i=e.Image.resize(i,g,g,n,t)),i}})}(e),!function(e){"use strict";var n=e.TypedArray;e.Create({name:"FloodFillFilter",x:0,y:0,color:null,tolerance:0,path:e.getPath(r.moduleUri),init:function(r,e,n,t){var a=this;a.x=r||0,a.y=e||0,a.color=n||[0,0,0],a.tolerance=t||0},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{color:r.color,x:r.x,y:r.y,tolerance:r.tolerance}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.color=n(e.color,Array),t.x=e.x,t.y=e.y,t.tolerance=e.tolerance),t},apply:function(r,e,n){var t,a,i,s,o,l,u,h,c,f,d=this,m=~~(255*(d.tolerance>=1?.999:d.tolerance)),g=d.color,p=e<<2,_=d.x,v=d.y,y=r.length,C=0,b=y-p,M=0,I=e-1<<2,w=Math.abs;if(u=v*e<<2,_<<=2,M>_||_>I||C>u||u>b||r[_+u]===g[0]&&r[_+u+1]===g[1]&&r[_+u+2]===g[2])return r;for(t=[r[_+u],r[_+u+1],r[_+u+2]],h=[],u+p>=C&&b>=u+p&&h.push([u,_,_,p]),h.push([u+p,_,_,-p]);h.length;){for(c=h.pop(),u=c[0]+(p=c[3]),o=c[1],l=c[2],s=o;s>=M&&(i=s+u,w(t[0]-r[i])<=m&&w(t[1]-r[i+1])<=m&&w(t[2]-r[i+2])<=m);s-=4)r[i]=g[0],r[i+1]=g[1],r[i+2]=g[2];if(s>=o){for(;l>=s&&!(w(t[0]-r[s+u])<=m&&w(t[1]-r[s+u+1])<=m&&w(t[2]-r[s+u+2])<=m);)s+=4;a=s,f=l>=s}else a=s+4,o>a&&u-p>=C&&b>=u-p&&h.push([u,a,o-4,-p]),s=o+4,f=!0;for(;f;){for(i=s+u;I>=s&&w(t[0]-r[i])<=m&&w(t[1]-r[i+1])<=m&&w(t[2]-r[i+2])<=m;)r[i]=g[0],r[i+1]=g[1],r[i+2]=g[2],s+=4,i=s+u;for(u+p>=C&&b>=u+p&&h.push([u,a,s-4,p]),s>l+4&&u-p>=C&&b>=u-p&&h.push([u,l+4,s-4,-p]);l>=s&&!(w(t[0]-r[s+u])<=m&&w(t[1]-r[s+u+1])<=m&&w(t[2]-r[s+u+2])<=m);)s+=4;a=s,f=l>=s}}return r}})}(e),!function(e){"use strict";var n=e._notSupportClamp,t=e.Color.RGB2HSV,a=.7083333333333334;e.Create({name:"HSVConverterFilter",path:e.getPath(r.moduleUri),apply:function(r,e,i){var s=this;if(!s._isOn)return r;var o,l,u,h,c,f=r.length;if(n)for(o=0;f>o;o+=4)l=t(r.subarray(o,o+3)),u=l[0]*a,c=255*l[1],h=l[2],0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),0>c?c=0:c>255&&(c=255),r[o]=~~u,r[o+1]=~~h,r[o+2]=~~c;else for(o=0;f>o;o+=4)l=t(r.subarray(o,o+3)),u=l[0]*a,c=255*l[1],h=l[2],r[o]=~~u,r[o+1]=~~h,r[o+2]=~~c;return r}})}(e),!function(e){"use strict";var n=(e._notSupportClamp,e.TypedArray),t=e.Color.RGBA2Color,a=e.Color.Color2RGBA;e.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(r,e){var n=this;n.thresholds=r,n.quantizedColors=e||null},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{thresholds:r.thresholds,quantizedColors:r.quantizedColors}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.thresholds=n(e.thresholds,Array),t.quantizedColors=n(e.quantizedColors,Array)),t},apply:function(r,e,n){var i=this;if(!(i._isOn&&i.thresholds&&i.thresholds.length&&i.quantizedColors&&i.quantizedColors.length))return r;var s,o,l,u,h=r.length,c=i.thresholds,f=c.length,d=i.quantizedColors,m=d.length;for(l=0;h>l;l+=4){for(s=t(r.subarray[l+4]),u=0;f>u&&s>c[u];)u++;s=m>u?d[u]:255,o=a(s),r[l]=o[0],r[l+1]=o[1],r[l+2]=o[2],r[l+3]=o[3]}return r}})}(e),!function(e){"use strict";var n=(e._notSupportClamp,e.ImArray,e.Color.clampPixel),t=e.TypedArray,a=e.Color.RGB2HSV,i=(e.Color.HSV2RGB,e.Color.Color2RGBA);e.Create({name:"HueExtractorFilter",range:null,background:0,init:function(r,e){var n=this;n.range=r,n.background=e||0},path:e.getPath(r.moduleUri),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{range:r.range,background:r.background}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.range=t(e.range,Array),n.background=e.background),n},apply:function(r,e,t){var s=this;if(!s._isOn||!s.range||!s.range.length)return r;var o,l,u,h,c,f,d,m=r.length,g=s.range[0],p=s.range[s.range.length-1];for(f=i(s.background||0),o=~~n(f[0]),l=~~n(f[1]),u=~~n(f[2]),h=~~n(f[3]),c=0;m>c;c+=4)d=a(r.subarray(c,c+3))[0],(g>d||d>p)&&(r[c]=o,r[c+1]=l,r[c+2]=u,r[c+3]=h);return r}})}(e),!function(e){"use strict";function n(r,e,n,t,a,i){var s,o,h,v,y,C=r.length,b=new u(C),M=new u(C),I=new u(C),w=new u(C),O=new u(i),z=new u(i),A=a*a,x=2*A,k=g*A;for(s=0;i>s&&(o=_(-(s*s)/x),!(c>=o&&s>=2));s++)h=_(-((y=s-.5)*y)/x),v=_(-((y=s+.5)*y)/x),O[s]=(o+h+v)/3/k,z[s]=v-h;var y,P,F,Y,S,N,L,R,X,U=s-1,H=e-(s-1),q=e*(s-1),E=e*(n-(s-1));for(y=U;H>y;y++)for(P=q;E>P;P+=e){for(F=y+P,Y=r[F]*O[0],S=Y,N=1,L=e;s>N;)S+=O[N]*(r[F-L]+r[F+L]),Y+=O[N]*(r[F-N]+r[F+N]),L+=e,N++;M[F]=S,b[F]=Y}for(y=U;H>y;y++)for(P=q;E>P;P+=e){for(R=0,F=y+P,X=1;s>X;X++)R+=z[X]*(M[F-X]-M[F+X]);I[F]=R}for(y=s;e-s>y;y++)for(P=q;E>P;P+=e){for(R=0,F=y+P,L=e,X=1;s>X;X++)R+=z[X]*(b[F-L]-b[F+L]),L+=e;w[F]=R}U=s,H=e-s,q=e*s,E=e*(n-s);var T,G,B,W,j,$,D,V,Q,J,K,Z,rr,er,nr,tr,ar,ir,sr,or;for(y=U;H>y;y++)for(P=q;E>P;P+=e)F=y+P,T=F-e,G=F+e,W=F-1,B=F+1,j=T-1,$=T+1,D=G-1,V=G+1,Q=I[F],J=w[F],K=l(Q,J),rr=l(I[T],w[T]),er=l(I[G],w[G]),tr=l(I[W],w[W]),nr=l(I[B],w[B]),ir=l(I[$],w[$]),or=l(I[V],w[V]),sr=l(I[D],w[D]),ar=l(I[j],w[j]),(0>=Q*J?p(Q)>=p(J)?(Z=p(Q*K))>=p(J*ir-(Q+J)*nr)&&Z>p(J*sr-(Q+J)*tr):(Z=p(J*K))>=p(Q*ir-(J+Q)*rr)&&Z>p(Q*sr-(J+Q)*er):p(Q)>=Math.abs(J)?(Z=p(Q*K))>=p(J*or+(Q-J)*nr)&&Z>p(J*ar+(Q-J)*tr):(Z=p(J*K))>=p(Q*or+(J-Q)*er)&&Z>p(Q*ar+(J-Q)*rr))?t[F]=K>=d?m:Math.floor(f*K):t[F]=0}function t(r,e,n,t,i,s){var o,l,u,h=0,c=r.length;for(o=0;c>o;o++)r[o]=0;for(u=0,l=0,h=0;c>h;h++,u++)u>=e&&(u=0,l++),0===r[h]&&t[h]>=s&&a(r,e,n,t,u,l,h,i)}function a(r,e,n,t,i,s,o,l){var u,h,c,f=0==i?i:i-1,d=i==e-1?i:i+1,m=0==s?s:s-1,g=s==n-1?s:s+1;for(r[o]=t[o],u=f,h=m;d>=u&&g>=h;){if(c=u+h*e,(h!=s||u!=i)&&0===r[c]&&t[c]>=l)return void a(r,e,n,t,u,h,c,l);h++,h>g&&(h=m,u++)}}function i(r,n){var t,a,i,s,o,l=r.length,u=e.LUMA[0],h=e.LUMA[1],c=e.LUMA[2];for(t=0,a=0;l>t;t+=4,a++)i=r[t],s=r[t+1],o=r[t+2],n[a]=~~(u*i+h*s+c*o+.5)}function s(r){var e,n,t,a,i,s=new h(256),o=new h(256),l=r.length;for(e=0;l>e;e++)s[r[e]]++;for(n=0,t=0,e=0;256>e;e++){for(n+=s[e],i=255*n/l,a=t+1;i>=a;a++)o[a]=e;t=i}for(e=0;l>e;e++)r[e]=o[r[e]]}function o(r,e){var n,t,a,i=r.length;for(n=0,t=0;i>n;n+=4,t++)a=e[t]>0?255:0,r[n]=r[n+1]=r[n+2]=a}var l,u=e.Array32F,h=e.Array32I,c=.005,f=100,d=1e3,m=f*d,g=e.CONST.PI2,p=Math.abs,_=Math.exp;l=Math.hypot?Math.hypot:function(r,e){return p(r)+p(e)},e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,gaussRadius:2,gaussWidth:16,contrastNormalized:!1,path:e.getPath(r.moduleUri),init:function(r,e,n,t,a){var i=this;i.low=arguments.length<1?2.5:r,i.high=arguments.length<2?7.5:e,i.gaussRadius=arguments.length<3?2:n,i.gaussWidth=arguments.length<4?16:t,i.contrastNormalized=!!a},thresholds:function(r,e){var n=this;return n.low=r,n.high=e,n},kernel:function(r,e){var n=this;return n.gaussRadius=r,n.gaussWidth=e,n},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{low:r.low,high:r.high,gaussRadius:r.gaussRadius,gaussWidth:r.gaussWidth,contrastNormalized:r.contrastNormalized}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.low=e.low,n.high=e.high,n.gaussRadius=e.gaussRadius,n.gaussWidth=e.gaussWidth,n.contrastNormalized=e.contrastNormalized),n},apply:function(r,e,a){var l,u,c,d,m=this,g=r.length>>2;return c=new h(g),d=new h(g),l=Math.round(m.low*f),u=Math.round(m.high*f),i(r,c),m.contrastNormalized&&s(c),n(c,e,a,d,m.gaussRadius,m.gaussWidth),t(c,e,a,d,l,u),o(r,c),r}})}(e),!function(e,n){"use strict";function t(r,e,n,t,a,i,s){var o,l,u,h,c,f,d,m=r.length;for(h=0,u=0,o=l=0;e>h;)d=4899*r[u]+9617*r[u+1]+1868*r[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[h]=d,a[h]=o,i[h]=l,s[h]=d,h++,u+=4;for(c=0,f=1,h=e,u=e<<2,o=l=0;m>u;)d=4899*r[u]+9617*r[u+1]+1868*r[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[h]=d,a[h]=a[h-e]+o,i[h]=i[h-e]+l,s[h]=s[h+1-e]+(d+t[h-e])+(f>1?s[h-e-e]:0)+(c>0?s[h-1-e]:0),c++,h++,u+=4,c>=e&&(c=0,f++,o=l=0)}function a(r,e,n,t){var a,i,s,o,l,u,h,c,m,g,p,_=r.length,v=new f(_);for(a=0;e>a;a++)v[a]=0,v[a+e]=0,v[a+_-e]=0,v[a+_-e-e]=0,t[a]=0,t[a+_-e]=0;for(i=0,s=0;n>i;i++,s+=e)v[0+s]=0,v[1+s]=0,v[e-1+s]=0,v[e-2+s]=0,t[0+s]=0,t[e-1+s]=0;for(a=2;e-2>a;a++)for(o=0,i=2,s=e<<1;n-2>i;i++,s+=e)h=a+s,c=h+e,m=c+e,g=h-e,p=g-e,o=0+(r[p-2]<<1)+(r[g-2]<<2)+(r[h-2]<<2)+r[h-2]+(r[c-2]<<2)+(r[m-2]<<1)+(r[p-1]<<2)+(r[g-1]<<3)+r[g-1]+(r[h-1]<<4)-(r[h-1]<<2)+(r[c-1]<<3)+r[c-1]+(r[m-1]<<2)+(r[p]<<2)+r[p]+(r[g]<<4)-(r[g]<<2)+(r[h]<<4)-r[h]+(r[c]<<4)-(r[c]<<2)+(r[m]<<2)+r[m]+(r[p+1]<<2)+(r[g+1]<<3)+r[g+1]+(r[h+1]<<4)-(r[h+1]<<2)+(r[c+1]<<3)+r[c+1]+(r[m+1]<<2)+(r[p+2]<<1)+(r[g+2]<<2)+(r[h+2]<<2)+r[h+2]+(r[c+2]<<2)+(r[m+2]<<1),v[h]=((103*o+8192&4294967295)>>>14&255)>>>0;for(a=1;e-1>a;a++)for(i=1,s=e;n-1>i;i++,s+=e)h=s+a,c=h+e,g=h-e,l=0-v[g-1]+v[g+1]-v[h-1]-v[h-1]+v[h+1]+v[h+1]-v[c-1]+v[c+1],u=0+v[g-1]+v[g]+v[g]+v[g+1]-v[c-1]-v[c]-v[c]-v[c+1],t[h]=d(l)+d(u);for(a=0,o=0;e>a;)o+=t[a],t[a]=o,a++;for(a=e,s=0,o=0;_>a;)o+=t[a],t[a]=t[a-e]+o,a++,s++,s>=e&&(s=0,o=0);return t}function i(r,e){var n=.2*m(e.width,r.width),t=.2*m(e.height,r.height);return!!(d(r.x-e.x)<=n&&d(r.y-e.y)<=t&&d(r.width-e.width)<=n&&d(r.height-e.height)<=t)}function s(r,e){r.x+=e.x,r.y+=e.y,r.width+=e.width,r.height+=e.height}function o(r,e){return!!(r.x>=e.x&&r.y>=e.y&&r.x+r.width<=e.x+e.width&&r.y+r.height<=e.y+e.height)}function l(r){r.x=~~(r.x+.5),r.y=~~(r.y+.5),r.width=~~(r.width+.5),r.height=~~(r.height+.5)}function u(r,e){return e.area-r.area}function h(r,e){var n,t,a,h,c,f,d,m=r.length,g=new Array(m),p=[],_=0,v=!1;for(a=0;m>a;a++)g[a]=0;for(a=0;m>a;a++){for(v=!1,h=0;a>h;h++)i(r[h],r[a])&&(v=!0,g[a]=g[h]);v||(g[a]=_,_++)}for(n=new Array(_),t=new Array(_),a=0;_>a;a++)n[a]=0,t[a]={x:0,y:0,width:0,height:0};for(a=0;m>a;a++)d=g[a],n[d]++,s(t[d],r[a]);for(a=0;_>a;a++)c=n[a],c>=e&&(f=1/(c+c),d={x:f*(2*t[a].x+c),y:f*(2*t[a].y+c),width:f*(2*t[a].width+c),height:f*(2*t[a].height+c)},p.push(d));for(m=p.length,a=0;m>a;a++)for(h=a+1;m>h;h++)!p[a].inside&&o(p[a],p[h])?p[a].inside=!0:!p[h].inside&&o(p[h],p[a])&&(p[h].inside=!0);for(a=m;--a>=0;)p[a].inside?p.splice(a,1):(l(p[a]),p[a].area=p[a].width*p[a].height);return p.sort(u)}var c=e.Array32F,f=e.Array8U,d=Math.abs,m=Math.max,g=Math.min,p=(Math.floor,Math.round,Math.sqrt),_="hasOwnProperty";e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,init:function(r,e,t,a,i,s){var o=this;o.objects=null,o.haardata=r||null,o.baseScale=n===e?1:e,o.scaleIncrement=n===t?1.25:t,o.stepIncrement=n===a?.5:a,o.minNeighbors=n===i?1:i,o.doCannyPruning=n===s?!0:!!s},path:e.getPath(r.moduleUri),dispose:function(){var r=this;return r.objects=null,r.haardata=null,r.$super("dispose"),r},haar:function(r){var e=this;return e.haardata=r,e},params:function(r){var e=this;return r&&(r[_]("haardata")&&(e.haardata=r.haardata),r[_]("baseScale")&&(e.baseScale=r.baseScale),r[_]("scaleIncrement")&&(e.scaleIncrement=r.scaleIncrement),r[_]("stepIncrement")&&(e.stepIncrement=r.stepIncrement),r[_]("minNeighbors")&&(e.minNeighbors=r.minNeighbors),r[_]("doCannyPruning")&&(e.doCannyPruning=r.doCannyPruning),r[_]("cannyLow")&&(e.cannyLow=r.cannyLow),r[_]("cannyHigh")&&(e.cannyHigh=r.cannyHigh)),e},serialize:function(){var r=this,e={filter:r.name,_isOn:!!r._isOn,params:{haardata:r.haardata,baseScale:r.baseScale,scaleIncrement:r.scaleIncrement,stepIncrement:r.stepIncrement,minNeighbors:r.minNeighbors,doCannyPruning:r.doCannyPruning,cannyLow:r.cannyLow,cannyHigh:r.cannyHigh}};return e},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.haardata=e.haardata,n.baseScale=e.baseScale,n.scaleIncrement=e.scaleIncrement,n.stepIncrement=e.stepIncrement,n.minNeighbors=e.minNeighbors,n.doCannyPruning=e.doCannyPruning,n.cannyLow=e.cannyLow,n.cannyHigh=e.cannyHigh),n},getMeta:function(){return this.objects},setMeta:function(r){return this.objects=r,this},apply:function(r,e,n){var i,s,o,l,u,d,m,_,v,y,C,b,M,I,w,O,z,A,x,k,P,F,Y,S,N,L,R,X,U,H,q,E,T,G,B,W,j,$,D,S,V,Q,J,K,Z,rr,er,nr,tr,ar,ir,sr,or,lr,ur,hr,cr,fr,dr,mr=this,gr=r.length>>>2,pr=mr.haardata,_r=pr.stages,vr=mr.baseScale,yr=mr.scaleIncrement,Cr=mr.stepIncrement,br=mr.minNeighbors,Mr=mr.doCannyPruning,Ir=mr.cannyLow,wr=mr.cannyHigh,Or=pr.size1,zr=pr.size2,Ar=g(e/Or,n/zr),xr=[],kr=gr-1,Pr=0,Fr=0,Yr=_r.length;for(t(r,e,n,s=new f(gr),o=new c(gr),l=new c(gr),u=new c(gr)),Mr&&a(s,e,n,d=new c(gr)),N=0,L=e-1,R=0,X=gr-e,i=vr;Ar>=i;){for(v=~~(i*Or),m=~~(v*Cr),y=~~(i*zr),_=~~(y*Cr),w=y*e,O=_*e,C=Fr*O,P=e-v,F=n-y,U=v*y,H=1/U,M=Fr,I=C;F>M;M+=_,I+=O)for(b=Pr;P>b;b+=m)if(z=b-1+I-e,A=z+v,x=z+w,k=x+v,z=0>z?0:z>kr?kr:z,A=0>A?0:A>kr?kr:A,x=0>x?0:x>kr?kr:x,k=0>k?0:k>kr?kr:k,!(Mr&&(G=H*(d[k]-d[x]-d[A]+d[z]),Ir>G||G>wr))){for(q=H*(o[k]-o[x]-o[A]+o[z]),E=H*(l[k]-l[x]-l[A]+l[z]),T=E-q*q,T=T>1?p(T):1,B=!0,Y=0;Yr>Y;Y++){for(W=_r[Y],j=W.thres,$=W.trees,D=$.length,dr=0,S=0;D>S;S++)for(J=$[S].feats,V=0;;){if(K=J[V],Z=K.rects,rr=Z.length,er=K.thres,nr=0,K.tilt)for(tr=0;rr>tr;tr++)ar=Z[tr],ir=b+~~(i*ar[0]),sr=(M-1+~~(i*ar[1]))*e,or=b+~~(i*(ar[0]+ar[2])),lr=(M-1+~~(i*(ar[1]+ar[2])))*e,ur=b+~~(i*(ar[0]-ar[3])),hr=(M-1+~~(i*(ar[1]+ar[3])))*e,cr=b+~~(i*(ar[0]+ar[2]-ar[3])),fr=(M-1+~~(i*(ar[1]+ar[2]+ar[3])))*e,ir=N>ir?N:ir>L?L:ir,or=N>or?N:or>L?L:or,ur=N>ur?N:ur>L?L:ur,cr=N>cr?N:cr>L?L:cr,sr=R>sr?R:sr>X?X:sr,lr=R>lr?R:lr>X?X:lr,hr=R>hr?R:hr>X?X:hr,fr=R>fr?R:fr>X?X:fr,nr+=ar[4]*(u[cr+fr]-u[ur+hr]-u[or+lr]+u[ir+sr]);else for(tr=0;rr>tr;tr++)ar=Z[tr],ir=b-1+~~(i*ar[0]),or=b-1+~~(i*(ar[0]+ar[2])),sr=e*(M-1+~~(i*ar[1])),lr=e*(M-1+~~(i*(ar[1]+ar[3]))),ir=N>ir?N:ir>L?L:ir,or=N>or?N:or>L?L:or,sr=R>sr?R:sr>X?X:sr,lr=R>lr?R:lr>X?X:lr,nr+=ar[4]*(o[or+lr]-o[ir+lr]-o[or+sr]+o[ir+sr]);if(Q=er*T>nr*H?0:1){if(K.has_r){dr+=K.r_val;break}V=K.r_node}else{if(K.has_l){dr+=K.l_val;break}V=K.l_node}}if(B=dr>j,!B)break}B&&xr.push({x:b,y:M,width:v,height:y})}i*=yr}return mr.objects=h(xr,br),r}})}(e),!function(e){"use strict";var n=(e._notSupportClamp,Math.min),t=Math.floor,a=e.CHANNEL.RED;e.CHANNEL.GREEN,e.CHANNEL.BLUE,e.CHANNEL.ALPHA;e.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,path:e.getPath(r.moduleUri),init:function(r,e,n,t,i){var s=this;s._srcImg=null,s.srcImg=null,s.srcChannel=e||a,s.dstChannel=n||a,s.centerX=t||0,s.centerY=i||0,r&&s.setSrc(r)},dispose:function(){var r=this;return r.srcImg=null,r._srcImg=null,r.$super("dispose"),r},setSrc:function(r){var e=this;return r?(e.srcImg=r,e._srcImg={data:r.getData(),width:r.width,height:r.height}):(e.srcImg=null,e._srcImg=null),e},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_srcImg:r._srcImg,centerX:r.centerX,centerY:r.centerY,srcChannel:r.srcChannel,dstChannel:r.dstChannel}}},unserialize:function(r){var n,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,n=r.params,t._srcImg=n._srcImg,t._srcImg&&(t._srcImg.data=e.TypedArray(t._srcImg.data,e.ImArray)),t.centerX=n.centerX,t.centerY=n.centerY,t.srcChannel=n.srcChannel,t.dstChannel=n.dstChannel),t},apply:function(r,e,a){var i=this;if(!i._isOn||!i._srcImg)return r;var s,o,l,u,h,c,f=i._srcImg.data,d=r.length,m=(f.length,i._srcImg.width),g=i._srcImg.height,p=i.srcChannel,_=i.dstChannel,v=n(e,m),y=n(a,g),C=i.centerX||0,b=i.centerY||0,M=m>>1,I=g>>1;for(C=t(C*(e-1))-M,b=t(b*(a-1))-I,s=0,o=0,l=0,s=0;d>s;s+=4,o++)o>=e&&(o=0,l++),h=o-C,c=l-b,h>=0&&v>h&&c>=0&&y>c&&(u=h+c*m<<2,r[s+_]=f[u+p]);return r}})}(e),!function(e){"use strict";var n=(e._notSupportClamp,Math.min),t=Math.floor;e.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,path:e.getPath(r.moduleUri),init:function(r,e,n){var t=this;t.centerX=e||0,t.centerY=n||0,t._alphaMask=null,t.alphaMask=null,r&&t.setMask(r)},dispose:function(){var r=this;return r.alphaMask=null,r._alphaMask=null,r.$super("dispose"),r},setMask:function(r){var e=this;return r?(e.alphaMask=r,e._alphaMask={data:r.getData(),width:r.width,height:r.height}):(e.alphaMask=null,e._alphaMask=null),e},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_alphaMask:r._alphaMask,centerX:r.centerX,centerY:r.centerY}}},unserialize:function(r){var n,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,n=r.params,t._alphaMask=n._alphaMask,t._alphaMask&&(t._alphaMask.data=e.TypedArray(t._alphaMask.data,e.ImArray)),t.centerX=n.centerX,t.centerY=n.centerY),t},apply:function(r,e,a){var i=this;if(!i._isOn||!i._alphaMask)return r;var s,o,l,u,h,c,f=i._alphaMask.data,d=i._alphaMask.width,m=i._alphaMask.height,g=r.length,p=(f.length,n(e,d)),_=n(a,m),v=i.centerX||0,y=i.centerY||0,C=d>>1,b=m>>1;for(v=t(v*(e-1))-C,y=t(y*(a-1))-b,o=0,l=0,s=0;g>s;s+=4,o++)o>=e&&(o=0,l++),h=o-v,c=l-y,h>=0&&p>h&&c>=0&&_>c?(u=h+c*d<<2,r[s+3]=f[u+3]):r[s+3]=0;return r}})}(e),!function(e,n){"use strict";var t,a="hasOwnProperty",i=Math.min,s=Math.max,o=Math.round,l=(Math.floor,Math.abs),u=e._notSupportClamp;t={normal:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,h=r[e],c=r[e+1],f=r[e+2],d=n[t],m=n[t+1],g=n[t+2];a=d,i=m,s=g,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~h,r[e+1]=~~c,r[e+2]=~~f},lighten:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,h=r[e],c=r[e+1],f=r[e+2],d=n[t],m=n[t+1],g=n[t+2];a=h>d?h:d,i=c>m?c:m,s=f>g?f:g,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~h,r[e+1]=~~c,r[e+2]=~~f},darken:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,h=r[e],c=r[e+1],f=r[e+2],d=n[t],m=n[t+1],g=n[t+2];a=h>d?d:h,i=c>m?m:c,s=f>g?g:f,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~h,r[e+1]=~~c,r[e+2]=~~f},multiply:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,h=r[e],c=r[e+1],f=r[e+2],d=n[t],m=n[t+1],g=n[t+2];a=h*d*.003921568627451,i=c*m*.003921568627451,s=f*g*.003921568627451,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~h,r[e+1]=~~c,r[e+2]=~~f},average:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,h=r[e],c=r[e+1],f=r[e+2],d=n[t],m=n[t+1],g=n[t+2];a=.5*(h+d),i=.5*(c+m),s=.5*(f+g),h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~h,r[e+1]=~~c,r[e+2]=~~f},add:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,h=r[e],c=r[e+1],f=r[e+2],d=n[t],m=n[t+1],g=n[t+2];a=h+d,i=c+m,s=f+g,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~h,r[e+1]=~~c,r[e+2]=~~f},subtract:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,h=r[e],c=r[e+1],f=r[e+2],d=n[t],m=n[t+1],g=n[t+2];
a=255>h+d?0:h+d-255,i=255>c+m?0:c+m-255,s=255>f+g?0:f+g-255,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~h,r[e+1]=~~c,r[e+2]=~~f},difference:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],h=1-o,c=r[e],f=r[e+1],d=r[e+2],m=n[t],g=n[t+1],p=n[t+2];a=l(m-c),i=l(g-f),s=l(p-d),c=a*o+c*h,f=i*o+f*h,d=s*o+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},negation:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],h=1-o,c=r[e],f=r[e+1],d=r[e+2],m=n[t],g=n[t+1],p=n[t+2];a=255-l(255-m-c),i=255-l(255-g-f),s=255-l(255-p-d),c=a*o+c*h,f=i*o+f*h,d=s*o+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},screen:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,h=r[e],c=r[e+1],f=r[e+2],d=n[t],m=n[t+1],g=n[t+2];a=255-((255-d)*(255-h)>>8),i=255-((255-m)*(255-c)>>8),s=255-((255-g)*(255-f)>>8),h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~h,r[e+1]=~~c,r[e+2]=~~f},exclusion:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,h=r[e],c=r[e+1],f=r[e+2],d=n[t],m=n[t+1],g=n[t+2];a=d+h-2*d*h*.003921568627451,i=m+c-2*m*c*.003921568627451,s=g+f-2*g*f*.003921568627451,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~h,r[e+1]=~~c,r[e+2]=~~f},overlay:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,h=r[e],c=r[e+1],f=r[e+2],d=n[t],m=n[t+1],g=n[t+2];a=128>h?2*d*h*.003921568627451:255-2*(255-d)*(255-h)*.003921568627451,i=128>c?2*m*c*.003921568627451:255-2*(255-m)*(255-c)*.003921568627451,a=128>f?2*g*f*.003921568627451:255-2*(255-g)*(255-f)*.003921568627451,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~h,r[e+1]=~~c,r[e+2]=~~f},softlight:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,h=r[e],c=r[e+1],f=r[e+2],d=n[t],m=n[t+1],g=n[t+2];a=128>h?2*((d>>1)+64)*(.003921568627451*h):255-2*(255-((d>>1)+64))*(255-h)*.003921568627451,i=128>c?2*((m>>1)+64)*(.003921568627451*c):255-2*(255-((m>>1)+64))*(255-c)*.003921568627451,s=128>f?2*((g>>1)+64)*(.003921568627451*f):255-2*(255-((g>>1)+64))*(255-f)*.003921568627451,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~h,r[e+1]=~~c,r[e+2]=~~f},hardlight:function(r,e,n,t){var a,i,s,o=.003921568627451*n[t+3],l=1-o,h=r[e],c=r[e+1],f=r[e+2],d=n[t],m=n[t+1],g=n[t+2];a=128>d?2*h*d*.003921568627451:255-2*(255-h)*(255-d)*.003921568627451,i=128>m?2*c*m*.003921568627451:255-2*(255-c)*(255-m)*.003921568627451,s=128>g?2*f*g*.003921568627451:255-2*(255-f)*(255-g)*.003921568627451,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),r[e]=~~h,r[e+1]=~~c,r[e+2]=~~f},colordodge:function(r,e,n,t){var a,s,o,l=.003921568627451*n[t+3],h=1-l,c=r[e],f=r[e+1],d=r[e+2],m=n[t],g=n[t+1],p=n[t+2];a=255==c?c:i(255,(m<<8)/(255-c)),s=255==f?f:i(255,(g<<8)/(255-f)),o=255==d?c:i(255,(p<<8)/(255-d)),c=a*l+c*h,f=s*l+f*h,d=o*l+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},colorburn:function(r,e,n,t){var a,i,o,l=.003921568627451*n[t+3],h=1-l,c=r[e],f=r[e+1],d=r[e+2],m=n[t],g=n[t+1],p=n[t+2];a=0==c?c:s(0,255-(255-m<<8)/c),i=0==f?f:s(0,255-(255-g<<8)/f),o=0==d?d:s(0,255-(255-p<<8)/d),c=a*l+c*h,f=i*l+f*h,d=o*l+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},linearlight:function(r,e,n,t){var a,i,s,o,l=.003921568627451*n[t+3],h=1-l,c=r[e],f=r[e+1],d=r[e+2],m=n[t],g=n[t+1],p=n[t+2];128>c?(o=2*c,a=255>o+m?0:o+m-255):(o=2*(c-128),a=o+m),128>f?(o=2*f,i=255>o+g?0:o+g-255):(o=2*(f-128),i=o+g),128>d?(o=2*d,s=255>o+p?0:o+p-255):(o=2*(d-128),s=o+p),c=a*l+c*h,f=i*l+f*h,d=s*l+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},reflect:function(r,e,n,t){var a,s,o,l=.003921568627451*n[t+3],h=1-l,c=r[e],f=r[e+1],d=r[e+2],m=n[t],g=n[t+1],p=n[t+2];a=255==c?c:i(255,m*m/(255-c)),s=255==f?f:i(255,g*g/(255-f)),o=255==d?d:i(255,p*p/(255-d)),c=a*l+c*h,f=s*l+f*h,d=o*l+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},glow:function(r,e,n,t){var a,s,o,l=.003921568627451*n[t+3],h=1-l,c=r[e],f=r[e+1],d=r[e+2],m=n[t],g=n[t+1],p=n[t+2];a=255==m?m:i(255,c*c/(255-m)),s=255==g?g:i(255,f*f/(255-g)),o=255==p?p:i(255,d*d/(255-p)),c=a*l+c*h,f=s*l+f*h,d=o*l+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},phoenix:function(r,e,n,t){var a,o,l,h=.003921568627451*n[t+3],c=1-h,f=r[e],d=r[e+1],m=r[e+2],g=n[t],p=n[t+1],_=n[t+2];a=i(g,f)-s(g,f)+255,o=i(p,d)-s(p,d)+255,l=i(_,m)-s(_,m)+255,f=a*h+f*c,d=o*h+d*c,m=l*h+m*c,u&&(f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m),r[e]=~~f,r[e+1]=~~d,r[e+2]=~~m},vividlight:function(r,e,n,t){var a,o,l,h,c=.003921568627451*n[t+3],f=1-c,d=r[e],m=r[e+1],g=r[e+2],p=n[t],_=n[t+1],v=n[t+2];128>d?(h=2*d,a=0==h?h:s(0,255-(255-p<<8)/h)):(h=2*(d-128),a=255==h?h:i(255,(p<<8)/(255-h))),128>m?(h=2*m,o=0==h?h:s(0,255-(255-_<<8)/h)):(h=2*(m-128),o=255==h?h:i(255,(_<<8)/(255-h))),128>g?(h=2*g,l=0==h?h:s(0,255-(255-v<<8)/h)):(h=2*(m-128),l=255==h?h:i(255,(v<<8)/(255-h))),d=a*c+d*f,m=o*c+m*f,g=l*c+g*f,u&&(d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m,g=0>g?0:g>255?255:g),r[e]=~~d,r[e+1]=~~m,r[e+2]=~~g},pinlight:function(r,e,n,t){var a,i,s,o,l=.003921568627451*n[t+3],h=1-l,c=r[e],f=r[e+1],d=r[e+2],m=n[t],g=n[t+1],p=n[t+2];128>c?(o=2*c,a=o>m?o:m):(o=2*(c-128),a=o>m?m:o),128>f?(o=2*f,i=o>g?o:g):(o=2*(c-128),i=o>g?g:o),128>d?(o=2*d,s=o>p?o:p):(o=2*(d-128),s=o>p?p:o),c=a*l+c*h,f=i*l+f*h,d=s*l+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),r[e]=~~c,r[e+1]=~~f,r[e+2]=~~d},hardmix:function(r,e,n,t){var a,o,l,h,c=.003921568627451*n[t+3],f=1-c,d=r[e],m=r[e+1],g=r[e+2],p=n[t],_=n[t+1],v=n[t+2];128>d?(h=2*d,a=0==h?h:s(0,255-(255-p<<8)/h)):(h=2*(d-128),a=255==h?h:i(255,(p<<8)/(255-h))),a=128>a?0:255,128>m?(h=2*m,o=0==h?h:s(0,255-(255-_<<8)/h)):(h=2*(m-128),o=255==h?h:i(255,(_<<8)/(255-h))),o=128>o?0:255,128>g?(h=2*g,l=0==h?h:s(0,255-(255-v<<8)/h)):(h=2*(g-128),l=255==h?h:i(255,(v<<8)/(255-h))),l=128>l?0:255,d=a*c+d*f,m=o*c+m*f,g=l*c+g*f,u&&(d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m,g=0>g?0:g>255?255:g),r[e]=~~d,r[e+1]=~~m,r[e+2]=~~g}},t.lineardodge=t.add,t.linearburn=t.subtract,e.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendImage:null,startX:0,startY:0,path:e.getPath(r.moduleUri),init:function(r,e){var n=this;n.startX=0,n.startY=0,n._blendImage=null,n.blendImage=null,n._blendMode=null,r&&n.setImage(r),e&&n.setMode(e)},dispose:function(){var r=this;return r.blendImage=null,r._blendImage=null,r._blendMode=null,r.$super("dispose"),r},setImage:function(r){var e=this;return r?(e.blendImage=r,e._blendImage={data:r.getData(),width:r.width,height:r.height}):(e.blendImage=null,e._blendImage=null),e},setMode:function(r){var e=this;return r?(e._blendMode=(""+r).toLowerCase(),t[a](e._blendMode)||(e._blendMode=null)):e._blendMode=null,e},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_blendImage:r._blendImage,_blendMode:r._blendMode,startX:r.startX,startY:r.startY}}},unserialize:function(r){var n,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,n=r.params,t.startX=n.startX,t.startY=n.startY,t._blendImage=n._blendImage,t._blendImage&&(t._blendImage.data=e.TypedArray(t._blendImage.data,e.ImArray)),t.setMode(n._blendMode)),t},reset:function(){var r=this;return r.startX=0,r.startY=0,r._blendMode=null,r},apply:function(r,e,n){var a=this;if(!a._isOn||!a._blendMode||!a._blendImage)return r;var s,l,u,h,c,f,d,m,g,p,_,v,y,C,b=a.startX||0,M=a.startY||0,I=0,w=0,O=a._blendImage,z=t[a._blendMode];if(0>b&&(I=-b,b=0),0>M&&(w=-M,M=0),h=O.width,c=O.height,b>=e||M>=n)return r;if(I>=h||w>=c)return r;if(b=o(b),M=o(M),I=o(I),w=o(w),s=i(e-b,h-I),l=i(n-M,c-w),0>=s||0>=l)return r;for(u=O.data,p=b,_=M*e,v=I,y=w*h,f=b+s,d=I+s,m=0,g=l*s;g>m;)C=v+y<<2,u[C+3]&&z(r,p+_<<2,u,C),m++,p++,p>=f&&(p=b,_+=e),v++,v>=d&&(v=I,y+=h);return r}})}(e),e});