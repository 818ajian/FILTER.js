/**
*
*   FILTER.js I/O Classes
*   @version: 0.9.6
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (I/O Loaders)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,n){"use strict";"object"==typeof module&&module.exports?module.exports=n.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_IO")?define("FILTER_IO",["module","FILTER"],function(t,r){return n.moduleUri=t.uri,n.call(e,r),r}):(n.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(n){"use strict";n.getPath(e.moduleUri);return!function(e,n){e.IO.HTMLImageManager=e.Class(e.IO.Manager,{name:"IO.HTMLImageManager",constructor:function t(){return this instanceof t?void this.$super("constructor"):new t},read:function(n,t,r){var o=this,s=new Image,a=new e.Image;return s.onload=function(e){a.image(s),"function"==typeof t&&t(a,s)},s.onerror=function(e){"function"==typeof r&&r(e,a,s)},s.crossOrigin=o._crossOrigin||"",s.src=n,a}}),e.IO.HTMLImageLoader=e.IO.HTMLImageManager}(n),!function(e,n){function t(e,n,t){var r="";if(!e)return xhr?xhr:r;var o,i,l,c,f,p=a(e);if(t){for(i=0,l=p.length;l>i;i++)o=p[i],t.setHeader(o,e[o]);return t}if(n){for(i=0,l=p.length;l>i;i++)if(o=p[i],"[object Array]"===s.call(e[o]))for(c=0,f=e[o].length;f>c;c++)n.setRequestHeader(o,String(e[o][c]));else n.setRequestHeader(o,String(e[o]));return n}for(i=0,l=p.length;l>i;i++)if(o=p[i],"[object Array]"===s.call(e[o]))for(r.length&&(r+=u),r+=o+": "+String(e[o][0]),c=1,f=e[o].length;f>c;c++)r+=u+String(e[o][c]);else r.length&&(r+=u),r+=o+": "+String(e[o]);return r}function r(e,n){var t,r,s,a,l={},c=null;if(e)for(n=!0===n,e=e.split(u),r=0,s=e.length;s>r;r++)a=e[r],t=a.split(":"),t.length>1?(c=i(t.shift()),n&&(c=c.toLowerCase()),l[o](c)?("string"==typeof l[c]&&(l[c]=[l[c]]),l[c].push(i(t.join(":")))):l[c]=i(t.join(":"))):t[0].length&&c&&(l[c]=u+t[0]);return l}if(!e.Util.LOADED_XHR){e.Util.LOADED_XHR=!0;var o="hasOwnProperty",s=Object.prototype.toString,a=Object.keys,u="\r\n",i=e.Util.String.trim,l=e.Browser.isNode;e.Util.Http={Header:{encode:t,decode:r}};var c=e.Util.XHR=function f(e,n){var t=this,r=!1;t.readyState=f.UNSENT,t.status=null,t.statusText=null,t.responseType="text",t.responseURL=null,t.response=null,t.responseText=null,t.responseXml=null,t._rawHeaders=null,t._headers=null,t.send=function(n){return r||f.UNSENT!==t.readyState?t:(e&&e(n),t.readyState=f.OPENED,t)},t.abort=function(){return r?t:(r=!0,n&&n(),t)},t.getAllResponseHeaders=function(e){return f.DONE!==t.readyState?null:!0===e?t._headers:t._rawHeaders},t.getResponseHeader=function(e,n){if(null==e||f.DONE!==t.readyState)return null;var r=t._headers||{};return!1!==n&&(e=e.toLowerCase()),r[o](e)?r[e]:null},t.dispose=function(){return t.readyState=null,t.status=null,t.statusText=null,t.responseType=null,t.responseURL=null,t.response=null,t.responseText=null,t.responseXml=null,t._rawHeaders=null,t._headers=null,t.getAllResponseHeaders=null,t.getResponseHeader=null,t.send=null,t.abort=null,t}};c.UNSENT=0,c.OPENED=1,c.HEADERS_RECEIVED=2,c.LOADING=3,c.DONE=4,c.create=l?function(e,n){if(e=e||{},!e.url)return null;var r,o,a="[object Object]"===s.call(e.url)?e.url:require("url").parse(e.url),u={method:e.method||"GET",agent:!1,protocol:a.protocol,host:a.hostname,hostname:a.hostname,port:a.port||80,path:(a.pathname||"/")+(a.query?"?"+a.query:"")};return"file:"===u.protocol?(o=new c(function(n){o.readyState=c.OPENED,require("fs").readFile(u.path,{encoding:"arraybuffer"===o.responseType?null:o.responseType,flag:"r"},function(n,t){o.readyState=c.DONE,o.responseUrl=u.path,e.onLoadStart&&e.onLoadStart(o),e.onLoadEnd&&e.onLoadEnd(o),n?(o.status=500,o.statusText=n.toString(),e.onRequestError?e.onRequestError(o):e.onError&&e.onError(o)):(o.status=200,o.statusText=null,o.response=t,"arraybuffer"!==o.responseType?(o.responseText=t,o.responseXml=null):(o.responseText=null,o.responseXml=null),e.onComplete&&e.onComplete(o))})},function(){}),o.responseType=e.responseType||"text",arguments.length>1&&o.send(n),o):(o=new c(function(e){null!=e&&(e=String(e),r.setHeader("Content-Length",String(e.length)),r.write(e)),r.end()},function(){r.abort()}),r=("https:"===u.protocol?require("https").request:require("http").request)(u,function(n){var t="",r=0;o.readyState=c.OPENED,e.onStateChange&&e.onStateChange(o),o.readyState=c.HEADERS_RECEIVED,o._rawHeaders=n.rawHeaders.join("\r\n"),o._headers=n.headers,o.responseURL=n.url||null,o.status=n.statusCode||null,o.statusText=n.statusMessage||null,e.onStateChange&&e.onStateChange(o),n.on("data",function(n){r||(r=1,o.readyState=c.LOADING,e.onStateChange&&e.onStateChange(o),e.onLoadStart&&e.onLoadStart(o)),t+=n.toString(),e.onProgress&&e.onProgress(o)}),n.on("end",function(){o.readyState=c.DONE,o.responseType="text",o.response=o.responseText=t,e.onStateChange&&e.onStateChange(o),e.onLoadEnd&&e.onLoadEnd(o),c.DONE===o.readyState&&(200===o.status?e.onComplete&&e.onComplete(o):e.onRequestError?e.onRequestError(o):e.onError&&e.onError(o))}),n.on("error",function(n){o.statusText=n.toString(),e.onError&&e.onError(o)})}),r.setTimeout(e.timeout||3e4,function(n){e.onTimeout&&e.onTimeout(o)}),r.on("abort",function(n){e.onAbort&&e.onAbort(o)}),r.on("error",function(n){o.statusText=n.toString(),e.onError&&e.onError(o)}),e.headers&&t(e.headers,null,r),arguments.length>1&&o.send(n),o)}:function(e,n){if(e=e||{},!e.url)return null;var o="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),s=new c(function(e){o.send(e)},function(){o.abort()}),a=function(e,n){return e.readyState=n.readyState,e.status=n.status,e.statusText=n.statusText,e.responseURL=n.responseURL,e.response=n.response,"arraybuffer"!==n.responseType?(e.responseText=n.responseText,e.responseXml=n.responseXml):(e.responseText=null,e.responseXml=null),e};return s.getAllResponseHeaders=function(e){var n=o.getAllResponseHeaders();return!0===e?r(n):n},s.getResponseHeader=function(e){return o.getResponseHeader(e)},o.open(e.method||"GET",e.url,!e.sync),s.responseType=o.responseType=e.responseType||"text",o.timeout=e.timeout||3e4,e.onProgress&&(o.onprogress=function(){e.onProgress(a(s,o))}),e.onLoadStart&&(o.onloadstart=function(){e.onLoadStart(a(s,o))}),e.onLoadEnd&&(o.onloadend=function(){e.onLoadEnd(a(s,o))}),!e.sync&&e.onStateChange&&(o.onreadystatechange=function(){e.onStateChange(a(s,o))}),o.onload=function(){a(s,o),c.DONE===o.readyState&&(200===o.status?e.onComplete&&e.onComplete(s):e.onRequestError?e.onRequestError(s):e.onError&&e.onError(s))},o.onabort=function(){e.onAbort&&e.onAbort(a(s,o))},o.onerror=function(){e.onError&&e.onError(a(s,o))},o.ontimeout=function(){e.onTimeout&&e.onTimeout(a(s,o))},e.headers&&t(e.headers,o),e.mimeType&&o.overrideMimeType(e.mimeType),arguments.length>1&&s.send(n),s}}}(n),!function(e,n){var t=e.Class,r=e.IO.FileManager=t(e.IO.Manager,{name:"IO.FileManager",constructor:function o(){var e=this;return e instanceof o?void e.$super("constructor"):new o},read:function(n,t,r){var o=this;return e.Browser.isNode?"http://"===n.slice(0,7)||"https://"===n.slice(0,8)?e.Util.XHR.create({url:n,responseType:o._responseType,onComplete:function(e){"function"==typeof t&&t(e.response)},onError:function(e){"function"==typeof r&&r(e.statusText)}},null):require("fs").readFile("file://"===n.slice(0,7)?n.slice(7):n,{encoding:"arraybuffer"===o._responseType?null:o._responseType,flag:"r"},function(e,n){e?"function"==typeof r&&r(e.toString()):"function"==typeof t&&t(n)}):e.Util.XHR.create({url:n,responseType:o._responseType,onComplete:function(e){"function"==typeof t&&t(e.response)},onError:function(e){"function"==typeof r&&r(e.statusText)}},null),o},write:function(n,t,r,o){var s=this;return e.Browser.isNode&&require("fs").writeFile("file://"===n.slice(0,7)?n.slice(7):n,t,{encoding:"arraybuffer"===s._encoding?null:s._encoding,flag:"w"},function(e){e?"function"==typeof o&&o(e.toString()):"function"==typeof r&&r(n)}),s}});e.IO.FileLoader=e.IO.FileReader=e.IO.FileWriter=r,e.IO.BinaryManager=t(r,{name:"IO.BinaryManager",constructor:function s(e){var n=this;return n instanceof s?(n._codec="object"==typeof e?e:null,void n.$super("constructor")):new s(e)},_codec:null,dispose:function(){var e=this;return e._codec=null,e.$super("dispose"),e},codec:function(e){var n=this;return arguments.length?(n._codec="object"==typeof e?e:null,n):n._codec},read:function(n,t,r){var o=this,s=new e.Image,a=o._codec?o._codec.decoder:null;return"function"==typeof a&&o.responseType("arraybuffer").$super("read",n,function(e){var n,o=null,u={};try{n=a(e,u)}catch(i){o=i,n=null}o||!n?"function"==typeof r&&r(o,e,s,u):(s.image(n),"function"==typeof t&&t(s,u))},r),s},write:function(e,n,t,r){var o,s=null,a=this,u=a._codec?a._codec.encoder:null;if(n&&"function"==typeof u){try{o=u(n.getPixelData())}catch(i){s=i,o=null}s||!o?"function"==typeof r&&r(s,n):a.encoding("arraybuffer").$super("write",e,o,t,r)}return a}}),e.IO.BinaryLoader=e.IO.BinaryReader=e.IO.BinaryWriter=e.IO.BinaryManager}(n),n});