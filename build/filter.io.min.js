/**
*
*   FILTER.js I/O Classes
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (I/O Loaders)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,n){"use strict";"object"==typeof module&&module.exports?module.exports=n.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_IO")?define("FILTER_IO",["module","FILTER"],function(t,r){return n.moduleUri=t.uri,n.call(e,r),r}):(n.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(n){"use strict";n.getPath(e.moduleUri);return!function(e,n){function t(e,n,t){var r="";if(!e)return xhr?xhr:r;var o,i,l,c,f,d=u(e);if(t){for(i=0,l=d.length;l>i;i++)o=d[i],t.setHeader(o,e[o]);return t}if(n){for(i=0,l=d.length;l>i;i++)if(o=d[i],"[object Array]"===s.call(e[o]))for(c=0,f=e[o].length;f>c;c++)n.setRequestHeader(o,String(e[o][c]));else n.setRequestHeader(o,String(e[o]));return n}for(i=0,l=d.length;l>i;i++)if(o=d[i],"[object Array]"===s.call(e[o]))for(r.length&&(r+=a),r+=o+": "+String(e[o][0]),c=1,f=e[o].length;f>c;c++)r+=a+String(e[o][c]);else r.length&&(r+=a),r+=o+": "+String(e[o]);return r}function r(e,n){var t,r,s,u,l={},c=null;if(e)for(n=!0===n,e=e.split(a),r=0,s=e.length;s>r;r++)u=e[r],t=u.split(":"),t.length>1?(c=i(t.shift()),n&&(c=c.toLowerCase()),l[o](c)?("string"==typeof l[c]&&(l[c]=[l[c]]),l[c].push(i(t.join(":")))):l[c]=i(t.join(":"))):t[0].length&&c&&(l[c]=a+t[0]);return l}var o="hasOwnProperty",s=Object.prototype.toString,u=Object.keys,a="\r\n",i=e.Util.String.trim;e.Util.Http={Header:{encode:t,decode:r}};var l=e.Util.XHR=function c(e,n){var t=this,r=!1;t.readyState=c.UNSENT,t.status=null,t.statusText=null,t.responseType="text",t.responseURL=null,t.response=null,t.responseText=null,t.responseXml=null,t._rawHeaders=null,t._headers=null,t.send=function(n){return r||c.UNSENT!==t.readyState?t:(e&&e(n),t.readyState=c.OPENED,t)},t.abort=function(){return r?t:(r=!0,n&&n(),t)},t.getAllResponseHeaders=function(e){return c.DONE!==t.readyState?null:!0===e?t._headers:t._rawHeaders},t.getResponseHeader=function(e,n){if(null==e||c.DONE!==t.readyState)return null;var r=t._headers||{};return!1!==n&&(e=e.toLowerCase()),r[o](e)?r[e]:null},t.dispose=function(){return t.readyState=null,t.status=null,t.statusText=null,t.responseType=null,t.responseURL=null,t.response=null,t.responseText=null,t.responseXml=null,t._rawHeaders=null,t._headers=null,t.getAllResponseHeaders=null,t.getResponseHeader=null,t.send=null,t.abort=null,t}};l.UNSENT=0,l.OPENED=1,l.HEADERS_RECEIVED=2,l.LOADING=3,l.DONE=4,l.create=e.Browser.isNode?function(e,n){if(e=e||{},!e.url)return null;var r,o,u="[object Object]"===s.call(e.url)?e.url:require("url").parse(e.url),a={method:e.method||"GET",agent:!1,protocol:u.protocol,host:u.hostname,hostname:u.hostname,port:u.port||80,path:(u.pathname||"/")+(u.query?"?"+u.query:"")};return"file:"===a.protocol?(o=new l(function(n){o.readyState=l.OPENED,require("fs").readFile(a.path,{encoding:"arraybuffer"===o.responseType?null:o.responseType,flag:"r"},function(n,t){o.readyState=l.DONE,o.responseUrl=a.path,e.onLoadStart&&e.onLoadStart(o),e.onLoadEnd&&e.onLoadEnd(o),n?(o.status=500,o.statusText=n.toString(),e.onRequestError?e.onRequestError(o):e.onError&&e.onError(o)):(o.status=200,o.statusText=null,o.response=t,"arraybuffer"!==o.responseType?(o.responseText=t,o.responseXml=null):(o.responseText=null,o.responseXml=null),e.onComplete&&e.onComplete(o))})},function(){}),o.responseType=e.responseType||"text",arguments.length>1&&o.send(n),o):(o=new l(function(e){null!=e&&(e=String(e),r.setHeader("Content-Length",String(e.length)),r.write(e)),r.end()},function(){r.abort()}),r=("https:"===a.protocol?require("https").request:require("http").request)(a,function(n){var t="",r=0;o.readyState=l.OPENED,e.onStateChange&&e.onStateChange(o),o.readyState=l.HEADERS_RECEIVED,o._rawHeaders=n.rawHeaders.join("\r\n"),o._headers=n.headers,o.responseURL=n.url||null,o.status=n.statusCode||null,o.statusText=n.statusMessage||null,e.onStateChange&&e.onStateChange(o),n.on("data",function(n){r||(r=1,o.readyState=l.LOADING,e.onStateChange&&e.onStateChange(o),e.onLoadStart&&e.onLoadStart(o)),t+=n.toString(),e.onProgress&&e.onProgress(o)}),n.on("end",function(){o.readyState=l.DONE,o.responseType="text",o.response=o.responseText=t,e.onStateChange&&e.onStateChange(o),e.onLoadEnd&&e.onLoadEnd(o),l.DONE===o.readyState&&(200===o.status?e.onComplete&&e.onComplete(o):e.onRequestError?e.onRequestError(o):e.onError&&e.onError(o))}),n.on("error",function(n){o.statusText=n.toString(),e.onError&&e.onError(o)})}),r.setTimeout(e.timeout||3e4,function(n){e.onTimeout&&e.onTimeout(o)}),r.on("abort",function(n){e.onAbort&&e.onAbort(o)}),r.on("error",function(n){o.statusText=n.toString(),e.onError&&e.onError(o)}),e.headers&&t(e.headers,null,r),arguments.length>1&&o.send(n),o)}:function(e,n){if(e=e||{},!e.url)return null;var o="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),s=new l(function(e){o.send(e)},function(){o.abort()}),u=function(e,n){return e.readyState=n.readyState,e.status=n.status,e.statusText=n.statusText,e.responseURL=n.responseURL,e.response=n.response,"arraybuffer"!==n.responseType?(e.responseText=n.responseText,e.responseXml=n.responseXml):(e.responseText=null,e.responseXml=null),e};return s.getAllResponseHeaders=function(e){var n=o.getAllResponseHeaders();return!0===e?r(n):n},s.getResponseHeader=function(e){return o.getResponseHeader(e)},o.open(e.method||"GET",e.url,!e.sync),s.responseType=o.responseType=e.responseType||"text",o.timeout=e.timeout||3e4,e.onProgress&&(o.onprogress=function(){e.onProgress(u(s,o))}),e.onLoadStart&&(o.onloadstart=function(){e.onLoadStart(u(s,o))}),e.onLoadEnd&&(o.onloadend=function(){e.onLoadEnd(u(s,o))}),!e.sync&&e.onStateChange&&(o.onreadystatechange=function(){e.onStateChange(u(s,o))}),o.onload=function(){u(s,o),l.DONE===o.readyState&&(200===o.status?e.onComplete&&e.onComplete(s):e.onRequestError?e.onRequestError(s):e.onError&&e.onError(s))},o.onabort=function(){e.onAbort&&e.onAbort(u(s,o))},o.onerror=function(){e.onError&&e.onError(u(s,o))},o.ontimeout=function(){e.onTimeout&&e.onTimeout(u(s,o))},e.headers&&t(e.headers,o),e.mimeType&&o.overrideMimeType(e.mimeType),arguments.length>1&&s.send(n),s}}(n),!function(e,n){e.IO.XHRLoader=e.Class(e.IO.Loader,{name:"IO.XHRLoader",constructor:function t(){var e=this;return e instanceof t?void 0:new t},load:function(n,t,r){var o=this;return e.Util.XHR.create({url:n,responseType:o._responseType,onComplete:function(e){"function"==typeof t&&t(e.response)},onError:function(e){"function"==typeof r&&r(e.statusText)}},null),o}})}(n),!function(e,n){var t=e.IO.Loader,r=e.Util.XHR,o=e.Image,s=e.Class,u=e.IO.FileLoader=e.IO.FileReader=s(t,{name:"IO.FileLoader",constructor:function a(){var e=this;return e instanceof a?void 0:new a},load:function(n,t,o){var s=this;return e.Browser.isNode?require("fs").readFile("file://"===n.slice(0,7)?n.slice(7):n,{encoding:"arraybuffer"===s._responseType?null:s._responseType,flag:"r"},function(e,n){e?"function"==typeof o&&o(e.toString()):"function"==typeof t&&t(n)}):r.create({url:n,responseType:s._responseType,onComplete:function(e){"function"==typeof t&&t(e.response)},onError:function(e){"function"==typeof o&&o(e.statusText)}},null),s}});e.IO.BinaryLoader=e.IO.BinaryReader=s(u,{name:"IO.BinaryLoader",constructor:function i(e){var n=this;return n instanceof i?void(n._decoder="function"==typeof e?e:null):new i(e)},_decoder:null,_encoder:null,dispose:function(){var e=this;return e._decoder=null,e._encoder=null,e.$super("dispose"),e},decoder:function(e){var n=this;return n._decoder="function"==typeof e?e:null,n},encoder:function(e){var n=this;return n._encoder="function"==typeof e?e:null,n},load:function(e,n,t){var r=this,s=new o,u=r._decoder;return"function"==typeof u&&r.responseType("arraybuffer").$super("load",e,function(e){var r={},o=u(e,r);return o?(s.image(o),void("function"==typeof n&&n(s,r))):void("function"==typeof t&&t(s,r,e))},t),s}})}(n),!function(e,n){var t=e.Class,r=e.IO.FileWriter=t(e.IO.Writer,{name:"IO.FileWriter",constructor:function o(){var e=this;return e instanceof o?void 0:new o},write:function(n,t,r,o){var s=this;return e.Browser.isNode&&require("fs").writeFile("file://"===n.slice(0,7)?n.slice(7):n,t,{encoding:"arraybuffer"===s._encoding?null:s._encoding,flag:"w"},function(e){e?"function"==typeof o&&o(e.toString()):"function"==typeof r&&r(n)}),s}});e.IO.BinaryWriter=t(r,{name:"IO.BinaryWriter",constructor:function s(e){var n=this;return n instanceof s?void(n._encoder="function"==typeof e?e:null):new s(e)},_encoder:null,dispose:function(){var e=this;return e._encoder=null,e.$super("dispose"),e},encoder:function(e){var n=this;return n._encoder="function"==typeof e?e:null,n},write:function(e,n,t,r){var o=this,s=o._encoder;return n&&"function"==typeof s&&o.encoding("arraybuffer").$super("write",e,s(n.getPixelData()),t,r),o}})}(n),!function(e,n){var t=e.Image;e.IO.HTMLImageLoader=e.Class(e.IO.Loader,{name:"IO.HTMLImageLoader",constructor:function r(){return this instanceof r?void this.$super("constructor"):new r},load:function(e,n,r){var o,s=this,u=new t;return o=new Image,o.onload=function(e){u.setImage(o),"function"==typeof n&&n(u,o)},o.onerror=function(e){"function"==typeof r&&r(u,o)},o.crossOrigin=s._crossOrigin||"",o.src=e,u}})}(n),n});