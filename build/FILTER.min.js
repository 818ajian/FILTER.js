/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.3.3
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/var FILTER=FILTER||{};
(function(e){var d,k=Math.min;d={normal:function(c){return c},lighten:function(c,a){return a>c?a:c},darken:function(c,a){return a>c?c:a},multiply:function(c,a){return c*a*0.003921568627451},average:function(c,a){return 0.5*(c+a)},add:function(c,a){return Math.min(255,c+a)},substract:function(c,a){return c+a<255?0:c+a-255},difference:function(c,a){return Math.abs(c-a)},negation:function(c,a){return 255-Math.abs(255-c-a)},screen:function(c,a){return 255-((255-c)*(255-a)>>8)},exclusion:function(c,a){return c+
a-2*c*a*0.003921568627451},overlay:function(c,a){return a<128?2*c*a*0.003921568627451:255-2*(255-c)*(255-a)*0.003921568627451},softLight:function(c,a){return a<128?2*((c>>1)+64)*a*0.003921568627451:255-2*(255-((c>>1)+64))*(255-a)*0.003921568627451},hardLight:function(c,a){return c<128?2*a*c*0.003921568627451:255-2*(255-a)*(255-c)*0.003921568627451},colorDodge:function(c,a){return a==255?a:Math.min(255,(c<<8)/(255-a))},colorBurn:function(c,a){return a==0?a:Math.max(0,255-(255-c<<8)/a)},linearLight:function(c,
a){return a<128?d.linearBurn(c,2*a):d.linearDodge(c,2*(a-128))},vividLight:function(c,a){return a<128?d.colorBurn(c,2*a):d.colorDodge(c,2*(a-128))},pinLight:function(c,a){return a<128?d.darken(c,2*a):d.lighten(c,2*(a-128))},hardMix:function(c,a){return d.vividLight(c,a)<128?0:255},reflect:function(c,a){return a==255?a:Math.min(255,c*c/(255-a))},glow:function(c,a){return c==255?c:Math.min(255,a*a/(255-c))},phoenix:function(c,a){return Math.min(c,a)-Math.max(c,a)+255}};d.linearDodge=d.add;d.linearBurn=
d.substract;e.blendModes=d;e.Image=function(c,a){this.height=this.width=0;this.imageData=this.context=null;this.canvasElement=document.createElement("canvas");this.canvasElement.width=0;this.canvasElement.height=0;this.context=this.canvasElement.getContext("2d");this._integral=this._histogram=null;this._integralRefresh=this._histogramRefresh=!0;this.setImage(c,a)};e.Image.prototype={getPixel:function(c,a){var l=~~(a*this.width+c+0.5);return{red:this.imageData.data[l],green:this.imageData.data[l+1],
blue:this.imageData.data[l+2],alpha:this.imageData.data[l+3]}},setPixel:function(c,a,l,d,j,k){this.context.putImageData(new e.ImArray([l,d,j,k]),c,a);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},getData:function(){return new e.ImArray(this.imageData.data)},setData:function(c){this.imageData.data.set(c);this.context.putImageData(this.imageData,0,0);this._integralRefresh=this._histogramRefresh=!0;return this},getPixelData:function(){return this.imageData},
setPixelData:function(c){this.context.putImageData(c,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setWidth:function(c){this.width=c;this.canvasElement.width=this.width;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setHeight:function(c){this.height=c;this.canvasElement.height=this.height;
this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setImage:function(c,a){if(typeof c=="undefined"||c==null)return this;var l=this,d;c instanceof Image||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement?(d=c,this.width=c.width,this.height=c.height,this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.context=this.canvasElement.getContext("2d"),
this.context.drawImage(d,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._integralRefresh=this._histogramRefresh=!0):(d=new Image,d.onload=function(){l.width=d.width;l.height=d.height;l.canvasElement.width=l.width;l.canvasElement.height=l.height;l.context=l.canvasElement.getContext("2d");l.context.drawImage(d,0,0);l.imageData=l.context.getImageData(0,0,l.width,l.height);l._histogramRefresh=!0;l._integralRefresh=!0;typeof a!="undefined"&&a.call(l)},d.src=c);d.crossOrigin=
"";return this},blend:function(c,a,l,e,j){typeof a=="undefined"&&(a="normal");typeof l=="undefined"&&(l=1);l>1&&(l=1);l<0&&(l=0);typeof e=="undefined"&&(e=0);typeof j=="undefined"&&(j=0);var m=0,h=0;e<0&&(m=-e,e=0);j<0&&(h=-j,j=0);if(!(e>=this.width||j>=this.height)){a=d[a];if(a==void 0||a==null)return this;var o=k(this.width,c.width-m),p=k(this.height,c.height-h),t=this.context.getImageData(e,j,o,p),m=c.context.getImageData(m,h,o,p),c=t.data,m=m.data,w,s,x,y=1-l,q=m.length,u;for(u=0;u<q;u+=4)w=c[u],
s=c[u+1],x=c[u+2],h=a(m[u],w),o=a(m[u+1],s),p=a(m[u+2],x),c[u]=h*l+w*y,c[u+1]=o*l+s*y,c[u+2]=p*l+x*y;this.context.putImageData(t,e,j);this._integralRefresh=this._histogramRefresh=!0;return this}},_refresh:function(){this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);return this},clone:function(){return new e.Image(this.canvasElement)},integral:function(){this._integralRefresh&&this._computeIntegral();return this._integral},_computeIntegral:function(){var c=
this.width,a=this.height,l=new e.Array32U(c*a),d=this.getPixelData().data,j,k,h,o,p;for(o=h=k=j=0;j<c;)ii=j+h,p=ii<<2,p=4899*d[p]+9617*d[p+1]+1868*d[p+2]+8192>>>14,o+=(p&255)>>>0,l[ii]=j>0?l[ii-1]+o:o,k++,h+=c,a==k&&(j++,o=h=k=0);this._integral=l;this._integralRefresh=!1},histogram:function(){this._histogramRefresh&&this._computeHistogram();return this._histogram},_computeHistogram:function(){for(var c=this.getPixelData().data,a=0,l=c.length,d=new e.ImArray(256),k=new e.ImArray(256),m=new e.ImArray(256),
h,o,p,a=0;a<256;)d[a]=0,k[a]=0,m[a]=0,a++;for(a=0;a<l;)h=c[a],o=c[a+1],p=c[a+2],d[h]++,k[o]++,m[p]++,a+=4;this._histogram=[d,k,m];this._histogramRefresh=!1},createImageData:function(c,a){this.width=c;this.height=a;this.canvasElement.width=this.width;this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.context.createImageData(c,a);return this.imageData=this.context.getImageData(0,0,this.width,this.height)},scale:function(){return this}}})(FILTER);
(function(e){e.Color={blend:function(d,e,c){return{red:d.red-~~((d.red-e.red)*c+0.5),green:d.green-~~((d.green-e.green)*c+0.5),blue:d.blue-~~((d.blue-e.blue)*c+0.5)}},distance:function(d,e){var c=d.red-e.red,a=d.green-e.green,l=d.blue-e.blue;return Math.sqrt(c*c+a*a+l*l)},RGBA2Color:function(d){return typeof d.alpha!="undefined"?(d.alpha<<24)+(d.red<<16)+(d.green<<8)+d.blue:(d.red<<16)+(d.green<<8)+d.blue},Color2RGBA:function(d){d=~~d;return{red:d>>16&255,green:d>>8&255,blue:d&255,alpha:d>>24&255}},
RGB2YCbCr:function(d){var e=d.red,c=d.green,d=d.blue;return{Y:~~(0.299*e+0.587*c+0.114*d),Cb:~~(128-0.169*e-0.331*c+0.5*d),Cr:~~(128+0.5*e-0.42*c-0.08*d)}},YCbCr2RGB:function(d){var e=d.Y,c=d.Cb,d=d.Cr;return{red:~~(e+1.4*(d-128)),green:~~(e-0.343*(c-128)-0.711*(d-128)),blue:~~(e+1.765*(c-128))}},RGB2HSV:function(d){var e=d.red*0.00392156862745098,c=d.green*0.00392156862745098,a=d.blue*0.00392156862745098,l;l=e<c?e<a?e:a:c<a?c:a;d=e>c?e>a?e:a:c>a?c:a;if(l==d)return{H:NaN,S:0,V:d};e=((e==l?3:c==l?
5:1)-(e==l?c-a:c==l?a-e:e-c)/(d-l))*60;e>=360?e-=360:e<0&&(e+=360);$=(d-l)/d;return{H:e,S:void 0,V:d}}}})(FILTER);
(function(e){function d(a,c){var a=a||{},e;for(e in c)c&&Object.prototype.hasOwnProperty.call(c,e)&&(a[e]=c[e]);return a}e.Array32F=typeof Float32Array!=="undefined"?Float32Array:Array;e.Array64F=typeof Float64Array!=="undefined"?Float64Array:Array;e.Array8I=typeof Int8Array!=="undefined"?Int8Array:Array;e.Array16I=typeof Int16Array!=="undefined"?Int16Array:Array;e.Array32I=typeof Int32Array!=="undefined"?Int32Array:Array;e.Array8U=typeof Uint8Array!=="undefined"?Uint8Array:Array;e.Array16U=typeof Uint16Array!==
"undefined"?Uint16Array:Array;e.Array32U=typeof Uint32Array!=="undefined"?Uint32Array:Array;e.ImArray=typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:e.Array8U;e.CONSTANTS={SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI};e.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3};e.Filter=function(){};e.Filter.prototype={_apply:function(){},apply:function(){},reset:function(){}};e.CompositeFilter=function(a){this._stack=typeof a!="undefined"&&a.length?a:[]};e.CompositeFilter.prototype={_stack:[],_apply:function(a,
c,e){if(!this._stack.length)return a;for(var d=this._stack,m=d.length,h=0,k;h<m;)(k=d[h++])&&(a=k._apply(a,c,e));return a},apply:function(a){if(!this._stack.length)return a;return a.setData(this._apply(im=a.getData(),a.width,a.height))},filters:function(a){if(a)this._stack=a;return this},push:function(a){this._stack.push(a);return this},pop:function(){return this._stack.pop()},shift:function(a){this._stack.shift(a);return this},unshift:function(){return this._stack.unshift()},concat:function(a){return this.push(a)},
remove:function(a){for(var c=this._stack.length;--c>=0;)a===this._stack[c]&&this._stack.splice(c,1);return this},reset:function(){this._stack.length=0;return this}};var k=null,c=null;e.static={createImageData:function(a,e){k||(k=document.createElement("canvas"),c=k.getContext("2d"));return c.createImageData(a,e)}};e.Create=function(a){var c=function(){this.init.apply(this,Array.prototype.slice.call(arguments))},a=d({init:function(){},reset:function(){return this},apply:function(a){return a}},a);a._apply=
a.apply;a.apply=function(a){return a.setData(this._apply(a.getData(),a.width,a.height))};c.prototype=d(c.prototype,a);return c}})(FILTER);
(function(e){e.LUMA={R:0.212671,G:0.71516,B:0.072169};var d=e.Array32F,k=e.CONSTANTS.toRad;e.ColorMatrixFilter=function(c){this.matrix=typeof c!="undefined"&&c.length?new d(c):null};e.ColorMatrixFilter.prototype={channel:function(c,a){var d=(typeof a=="undefined"?0:a)?1:0;switch(c){case e.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case e.CHANNEL.BLUE:return this.concat([0,0,d,0,0,0,0,d,0,0,0,0,1,0,0,0,0,0,0,255]);case e.CHANNEL.GREEN:return this.concat([0,d,0,0,
0,0,1,0,0,0,0,d,0,0,0,0,0,0,0,255]);default:return this.concat([1,0,0,0,0,d,0,0,0,0,d,0,0,0,0,0,0,0,0,255])}},redChannel:function(c){return this.channel(e.CHANNEL.RED,c)},greenChannel:function(c){return this.channel(e.CHANNEL.GREEN,c)},blueChannel:function(c){return this.channel(e.CHANNEL.BLUE,c)},alphaChannel:function(){return this.channel(e.CHANNEL.ALPHA,!0)},swapChannels:function(c,a){switch(c){case e.CHANNEL.ALPHA:switch(a){case e.CHANNEL.ALPHA:return this;case e.CHANNEL.BLUE:return this.concat([1,
0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case e.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);default:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}case e.CHANNEL.BLUE:switch(a){case e.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case e.CHANNEL.BLUE:return this;case e.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);default:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}case e.CHANNEL.GREEN:switch(a){case e.CHANNEL.ALPHA:return this.concat([1,
0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case e.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this;default:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}default:switch(a){case e.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case e.CHANNEL.BLUE:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this}}},
desaturate:function(){return this.concat([e.LUMA.R,e.LUMA.G,e.LUMA.B,0,0,e.LUMA.R,e.LUMA.G,e.LUMA.B,0,0,e.LUMA.R,e.LUMA.G,e.LUMA.B,0,0,0,0,0,1,0])},grayscale:function(){return this.desaturate()},colorize:function(c,a){var d,n,j,m;typeof a=="undefined"&&(a=1);d=(c>>16&255)*0.00392156862745098;n=(c>>8&255)*0.00392156862745098;j=(c&255)*0.00392156862745098;m=1-a;return this.concat([m+a*d*e.LUMA.R,a*d*e.LUMA.G,a*d*e.LUMA.B,0,0,a*n*e.LUMA.R,m+a*n*e.LUMA.G,a*n*e.LUMA.B,0,0,a*j*e.LUMA.R,a*j*e.LUMA.G,m+a*
j*e.LUMA.B,0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},saturate:function(c){var a,d,n;a=1-c;d=a*e.LUMA.R;n=a*e.LUMA.G;a*=e.LUMA.B;return this.concat([d+c,n,a,0,0,d,n+c,a,0,0,d,n,a+c,0,0,0,0,0,1,0])},contrast:function(c,a,d){typeof a=="undefined"&&(a=c);typeof d=="undefined"&&(d=c);c+=1;a+=1;d+=1;return this.concat([c,0,0,0,128*(1-c),0,a,0,0,128*(1-a),0,0,d,0,128*(1-d),0,0,0,1,0])},brightness:function(c,a,d){typeof a=="undefined"&&(a=c);
typeof d=="undefined"&&(d=c);return this.concat([1,0,0,0,c,0,1,0,0,a,0,0,1,0,d,0,0,0,1,0])},adjustHue:function(c){c*=k;var a=Math.cos(c),c=Math.sin(c);return this.concat([e.LUMA.R+a*(1-e.LUMA.R)+c*-e.LUMA.R,e.LUMA.G+a*-e.LUMA.G+c*-e.LUMA.G,e.LUMA.B+a*-e.LUMA.B+c*(1-e.LUMA.B),0,0,e.LUMA.R+a*-e.LUMA.R+c*0.143,e.LUMA.G+a*(1-e.LUMA.G)+c*0.14,e.LUMA.B+a*-e.LUMA.B+c*-0.283,0,0,e.LUMA.R+a*-e.LUMA.R+c*-(1-e.LUMA.R),e.LUMA.G+a*-e.LUMA.G+c*e.LUMA.G,e.LUMA.B+a*(1-e.LUMA.B)+c*e.LUMA.B,0,0,0,0,0,1,0])},average:function(c,
a,d){typeof c=="undefined"&&(c=0.3333);typeof a=="undefined"&&(a=0.3333);typeof d=="undefined"&&(d=0.3334);return this.concat([c,a,d,0,0,c,a,d,0,0,c,a,d,0,0,0,0,0,1,0])},quickContrastCorrection:function(c){typeof c=="undefined"&&(c=1.2);return this.concat([c,0,0,0,0,0,c,0,0,0,0,0,c,0,0,0,0,0,1,0])},quickSepia:function(c,a,d){typeof c=="undefined"&&(c=1);typeof a=="undefined"&&(a=c);typeof d=="undefined"&&(d=c);return this.concat([c*0.5,0.5,0.5,0,0,0.33,a*0.33,0.33,0,0,0.25,0.25,d*0.25,0,0,0,0,0,1,
0])},quickSepia2:function(c,a,d){typeof c=="undefined"&&(c=1);typeof a=="undefined"&&(a=c);typeof d=="undefined"&&(d=c);return this.concat([c*0.3930000066757202,0.7689999938011169,0.1889999955892563,0,0,0.3490000069141388,a*0.6859999895095825,0.1679999977350235,0,0,0.2720000147819519,0.5339999794960022,d*0.1309999972581863,0,0,0,0,0,1,0])},threshold:function(c,a){typeof a=="undefined"&&(a=256);return this.concat([e.LUMA.R*a,e.LUMA.G*a,e.LUMA.B*a,0,-(a-1)*c,e.LUMA.R*a,e.LUMA.G*a,e.LUMA.B*a,0,-(a-1)*
c,e.LUMA.R*a,e.LUMA.G*a,e.LUMA.B*a,0,-(a-1)*c,0,0,0,1,0])},threshold_rgb:function(c,a){typeof a=="undefined"&&(a=256);return this.concat([a,0,0,0,-(a-1)*c,0,a,0,0,-(a-1)*c,0,0,a,0,-(a-1)*c,0,0,0,1,0])},threshold_alpha:function(c,a){typeof c=="undefined"&&(c=0.5);typeof a=="undefined"&&(a=256);return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,a,-a*c])},blend:function(c,a){var e;if(this.matrix){e=this.matrix;for(var n=c.matrix,j=1-a,m=0,h=new d(20);m<20;)h[m]=j*e[m]+a*n[m],m++;e=h}else e=new d(c.matrix);
this.matrix=e;return this},concat:function(c){var a;if(this.matrix){a=this.matrix;var c=new d(c),e=new d(20),n,j,m,h,k;n=c[0];j=c[1];m=c[2];h=c[3];k=c[4];e[0]=n*a[0]+j*a[5]+m*a[10]+h*a[15];e[1]=n*a[1]+j*a[6]+m*a[11]+h*a[16];e[2]=n*a[2]+j*a[7]+m*a[12]+h*a[17];e[3]=n*a[3]+j*a[8]+m*a[13]+h*a[18];e[4]=n*a[4]+j*a[9]+m*a[14]+h*a[19]+k;n=c[5];j=c[6];m=c[7];h=c[8];k=c[9];e[5]=n*a[0]+j*a[5]+m*a[10]+h*a[15];e[6]=n*a[1]+j*a[6]+m*a[11]+h*a[16];e[7]=n*a[2]+j*a[7]+m*a[12]+h*a[17];e[8]=n*a[3]+j*a[8]+m*a[13]+h*a[18];
e[9]=n*a[4]+j*a[9]+m*a[14]+h*a[19]+k;n=c[10];j=c[11];m=c[12];h=c[13];k=c[14];e[10]=n*a[0]+j*a[5]+m*a[10]+h*a[15];e[11]=n*a[1]+j*a[6]+m*a[11]+h*a[16];e[12]=n*a[2]+j*a[7]+m*a[12]+h*a[17];e[13]=n*a[3]+j*a[8]+m*a[13]+h*a[18];e[14]=n*a[4]+j*a[9]+m*a[14]+h*a[19]+k;n=c[15];j=c[16];m=c[17];h=c[18];k=c[19];e[15]=n*a[0]+j*a[5]+m*a[10]+h*a[15];e[16]=n*a[1]+j*a[6]+m*a[11]+h*a[16];e[17]=n*a[2]+j*a[7]+m*a[12]+h*a[17];e[18]=n*a[3]+j*a[8]+m*a[13]+h*a[18];e[19]=n*a[4]+j*a[9]+m*a[14]+h*a[19]+k;a=e}else a=new d(c);
this.matrix=a;return this},_apply:function(c){if(!this.matrix)return c;for(var a=c.length,d=this.matrix,e=0,j,k,h,o;e<a;)j=c[e],k=c[e+1],h=c[e+2],o=c[e+3],c[e]=d[0]*j+d[1]*k+d[2]*h+d[3]*o+d[4],c[e+1]=d[5]*j+d[6]*k+d[7]*h+d[8]*o+d[9],c[e+2]=d[10]*j+d[11]*k+d[12]*h+d[13]*o+d[14],c[e+3]=d[15]*j+d[16]*k+d[17]*h+d[18]*o+d[19],e+=4;return c},apply:function(c){if(!this.matrix)return c;return c.setData(this._apply(c.getData(),c.width,c.height))},reset:function(){this.matrix=null;return this}}})(FILTER);
(function(e){function d(a){var c=o.length,d,e;a--;if(a<c)d=o[a].slice();else for(d=new h(o[c-1]);c<=a;){e=d.slice();d=[1];i=0;for(il=e.length-1;i<il;i++)d.push(e[i]+e[i+1]);d.push(1);c<12&&o.push(d.slice());c++}return d}function k(a){var c,d=-(a>>1),e=Array(a);for(c=0;c<a;c++)e[c]=d,d++;return e}function c(a,d){var e,h,j=a.length,k,l=[],m=0;if(typeof a[0].length=="undefined")for(e=0;e<j;e++)for(h=0;h<j;h++)k=a[e]*d[h],m+=k,l.push(k);else for(e=0;e<j;e++)for(h=0;h<j;h++)k=c(a[e],d[h]),m+=k.sum,l=l.concat(k.ker);
return{kernel:l,sum:m}}function a(a){a=d(a);return c(a,a)}function l(a,e){var h=d(a),j=k(a);return 1==e?c(j.reverse(),h):c(h,j)}function n(a,d){var e,h=Array(a);for(e=0;e<a;e++)h[e]=1;e=k(a);return 1==d?c(e.reverse(),h):c(h,e)}function j(a,c,d,e){var j=a.length,k,l=new h(a.length),d=d||1,e=e||1;for(k=0;k<j;k++)l[k]=d*a[k]+e*c[k];return l}function m(a,c){var c=c||1,d=a*a,e,k=new h(d);for(e=0;e<d;e++)k[e]=c;return k}var h=e.Array32F,o=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,
20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],p=e.CONSTANTS.toRad;e.ConvolutionMatrixFilter=function(a,c){this.factor=c||1;typeof a!="undefined"&&a.length?(this.matrix=new h(a),this.dim=~~(Math.sqrt(a.length)+0.5)):(this.matrix=null,this.dim=0);this.auxMatrix=null;this._isGrad=!1};e.ConvolutionMatrixFilter.prototype={dim:0,matrix:null,lowPass:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(m(a),1/(a*a),a)},highPass:function(a,c){var a=typeof a=="undefined"?3:a%2?a:a+1,
d=a*a,e=-(typeof c=="undefined"?1:c)/d,h=m(a,e);h[d>>2]=1+e;return this.set(h,1,a)},boxBlur:function(a){return this.lowPass(a)},binomialLowPass:function(c){var c=typeof c=="undefined"?3:c%2?c:c+1,d=a(c);return this.set(new h(d.kernel),1/d.sum,c)},binomialHighPass:function(c){var c=typeof c=="undefined"?3:c%2?c:c+1,d=a(c);return this.set(j(m(c),new h(d.kernel),1,-1/d.sum),1,c)},gaussBlur:function(a){return this.binomialLowPass(a)},sharpen:function(a,c){c=typeof c=="undefined"?0.5:c;return c<=0?this.set([0,
-2,0,-2,10,-2,0,-2,0],0.5,3):this.highPass(a,c)},prewittX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=n(a,0);return this.set(new h(c.kernel),1,a)},prewittY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=n(a,1);return this.set(new h(c.kernel),1,a)},prewittDirectional:function(a,c){a=typeof a=="undefined"?3:a%2?a:a+1;c*=p;var d=Math.cos(c),e=Math.sin(c),k=n(a,0),l=n(a,1);return this.set(j(new h(k.kernel),new h(l.kernel),d,e),1,a)},prewitt:function(a){var a=typeof a=="undefined"?3:a%
2?a:a+1,c=n(a,0),d=n(a,1);this.set(new h(c.kernel),1,a);this._isGrad=!0;this.auxMatrix=new h(d.kernel);return this},gradX:function(a){return this.prewittX(a)},gradY:function(a){return this.prewittY(a)},gradDirectional:function(a,c){return this.prewittDirectional(a,c)},grad:function(a){return this.prewitt(a)},sobelX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=l(a,0);return this.set(new h(c.kernel),1,a)},sobelY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=l(a,1);return this.set(new h(c.kernel),
1,a)},sobelDirectional:function(a,c){a=typeof a=="undefined"?3:a%2?a:a+1;c*=p;var d=Math.cos(c),e=Math.sin(c),k=l(a,0),m=l(a,1);return this.set(j(new h(k.kernel),new h(m.kernel),d,e),1,a)},sobel:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=l(a,0),d=l(a,1);this.set(new h(c.kernel),1,a);this.auxMatrix=new h(d.kernel);this._isGrad=!0;return this},laplace:function(){return this.set([0,-1,0,-1,4,-1,0,-1,0],1,3)},emboss:function(a,c){var c=1,d=(typeof a=="undefined"||a!=1&&a!=-1?1:a)*c;return this.set([-d*
2,-d*1,0,-d*1,c*1,d*1,0,d*1,d*2],1,3)},embossHigh:function(){return this.emboss(1)},embossLow:function(){return this.emboss(-1)},edges:function(){return this.set([0,1,0,1,-4,1,0,1,0],1,3)},edges2:function(){return this.set([0,2,0,2,-8,2,0,2,0],0.5,3)},motionblur:function(a){var c=new h(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);if(a==0)for(a=0;a<9;a++)c[36+a]=1;else if(a==2)for(a=
0;a<9;a++)c[9*a+5]=1;else if(a==1)for(a=0;a<9;a++)c[9*a+a]=1;return this.set(c,1/9,9)},set:function(a,c,d){this.matrix=new h(a);this.factor=c;this.dim=d;this.auxMatrix=null;this._isGrad=!1;return this},_apply:function(a,c,d){if(!this.matrix)return a;var h=this.dim,k=h>>1,j=new e.ImArray(a.length),l,m,n,p,o,H=0,A=0,F=0,I=0,K=0,L=0,D,C,E,J,N,O,P,M=Math.abs;for(m=O=0;m<d;m++){for(l=0;l<c;l++){p=m;n=l;o=O+l<<2;for(C=L=K=I=N=F=A=H=0;C<h;C++){D=p+C-k;if(D>=0&&D<d){P=D*c;for(D=0;D<h;D++)E=n+D-k,E>=0&&E<
c&&(E=P+E<<2,J=this.matrix[N+D],H+=a[E]*J,A+=a[E+1]*J,F+=a[E+2]*J,this.auxMatrix&&(J=this.auxMatrix[N+D],I+=a[E]*J,K+=a[E+1]*J,L+=a[E+2]*J))}N+=h}this._isGrad?(j[o]=this.factor*(M(H)+M(I)),j[o+1]=this.factor*(M(A)+M(K)),j[o+2]=this.factor*(M(F)+M(L))):(j[o]=this.factor*H,j[o+1]=this.factor*A,j[o+2]=this.factor*F);j[o+3]=a[o+3]}O+=c}return j},apply:function(a){if(!this.matrix)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this.auxMatrix=this.matrix=null;this.dim=
0;return this}}})(FILTER);
(function(e){e.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4};var d=Math.min;e.DisplacementMapFilter=function(d){this.map=d};e.DisplacementMapFilter.prototype={scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:e.MODE.CLAMP,map:null,_apply:function(k,c,a){if(!this.map)return k;var l=this.map.getData(),n=this.map.width,j=this.map.height,m=d(n,c),j=d(j,a),h=this.scaleX*0.00390625,o=this.scaleY*0.00390625,p=this.color>>24&255,t=this.color>>16&255,w=this.color>>8&255,s=this.color&255,
x=~~this.startY,y=~~this.startX,q=this.componentX,u=this.componentY,z=this.mode,v,G,B,H,A,F,I,K,L,D=x*c,C=new e.ImArray(k.length);for(I=L=K=0;I<j;I++){G=I+x;if(G>=0&&G<a)for(F=0;F<m;F++)if(v=F+y,!(v<0||v>=c)){B=L+D+v<<2;H=K+F<<2;A=G+~~((l[H+u]-128)*o);v+=~~((l[H+q]-128)*h);if(A>=a||A<0||v>=c||v<0)switch(z){case e.MODE.IGNORE:continue;case e.MODE.COLOR:C[B]=t;C[B+1]=w;C[B+2]=s;C[B+3]=p;continue;case e.MODE.WRAP:A>=a&&(A-=a);A<0&&(A+=a);v>=c&&(v-=c);v<0&&(v+=c);break;default:A>=a&&(A=a-1),A<0&&(A=0),
v>=c&&(v=c-1),v<0&&(v=0)}A=A*c+v<<2;C[B]=k[A];C[B+1]=k[A+1];C[B+2]=k[A+2];C[B+3]=k[A+3]}K+=n;L+=c}return C},apply:function(d){if(!this.map)return d;return d.setData(this._apply(d.getData(),d.width,d.height))},reset:function(){this.map=null;return this}}})(FILTER);
(function(e){e.NonLinearFilter=function(){this.dim=0;this._apply=this._dummyApply};e.NonLinearFilter.prototype={dim:0,median:function(d){this.dim=typeof d=="undefined"?3:d%2?d:d+1;this._apply=this._MedianFilter;return this},erode:function(d){this.dim=typeof d=="undefined"?3:d%2?d:d+1;this._apply=this._MinimumFilter;return this},dilate:function(d){this.dim=typeof d=="undefined"?3:d%2?d:d+1;this._apply=this._MaximumFilter;return this},_MedianFilter:function(d,k,c){var a=this.dim,l=a>>1,n=a*a,j=new e.ImArray(d.length),
m,h,o,p,t,w,s,x,y,q,u,z,v,G,B;u=[];z=[];v=[];G=n%2;B=~~(0.5*n)+G;for(m=y=0;m<c;m++){for(n=0;n<k;n++){o=m;h=n;p=y+n<<2;u.length=0;z.length=0;for(w=x=v.length=0;w<a;w++){t=o+w-l;if(t>=0&&t<c){q=t*k;for(t=0;t<a;t++)s=h+t-l,s>=0&&s<k&&(s=q+s<<2,u.push(d[s]),z.push(d[s+1]),v.push(d[s+2]))}x+=a}u.sort();z.sort();v.sort();G?(j[p]=u[B],j[p+1]=z[B],j[p+2]=v[B]):(j[p]=~~(0.5*(u[B]+u[B+1])),j[p+1]=~~(0.5*(z[B]+z[B+1])),j[p+2]=~~(0.5*(v[B]+v[B+1])));j[p+3]=d[p+3]}y+=k}return j},_MaximumFilter:function(d,k,c){var a=
this.dim,l=a>>1,n=new e.ImArray(d.length),j,m,h,o,p,t,w,s,x,y,q,u,z,v;for(m=y=0;m<c;m++){for(j=0;j<k;j++){o=m;h=j;p=y+j<<2;for(w=x=v=z=u=0;w<a;w++){t=o+w-l;if(t>=0&&t<c){q=t*k;for(t=0;t<a;t++)s=h+t-l,s>=0&&s<k&&(s=q+s<<2,d[s]>u&&(u=d[s]),d[s+1]>z&&(z=d[s+1]),d[s+2]>v&&(v=d[s+2]))}x+=a}n[p]=u;n[p+1]=z;n[p+2]=v;n[p+3]=d[p+3]}y+=k}return n},_MinimumFilter:function(d,k,c){var a=this.dim,l=a>>1,n=new e.ImArray(d.length),j,m,h,o,p,t,w,s,x,y,q,u,z,v;for(m=y=0;m<c;m++){for(j=0;j<k;j++){o=m;h=j;p=y+j<<2;v=
z=u=255;for(w=x=0;w<a;w++){t=o+w-l;if(t>=0&&t<c){q=t*k;for(t=0;t<a;t++)s=h+t-l,s>=0&&s<k&&(s=q+s<<2,d[s]<u&&(u=d[s]),d[s+1]<z&&(z=d[s+1]),d[s+2]<v&&(v=d[s+2]))}x+=a}n[p]=u;n[p+1]=z;n[p+2]=v;n[p+3]=d[p+3]}y+=k}return n},_dummyApply:function(d){return d},_apply:function(d){return d},apply:function(d){if(!this.dim)return d;return d.setData(this._apply(d.getData(),d.width,d.height))},reset:function(){this._apply=this._dummyApply;this.dim=0;return this}}})(FILTER);
(function(e){e.CustomFilter=function(d){this._handler=d};e.CustomFilter.prototype={_handler:null,_apply:function(d,e,c){if(!this._handler)return d;return this._handler.call(this,d,e,c)},apply:function(d){if(!this._handler)return d;return d.setData(this._handler.call(this,d.getData(),d.width,d.height))}}})(FILTER);
(function(e){e.HistogramEqualizeFilter=e.Create({apply:function(d){var k,c,a,l;l=0;var n=255,j=new e.Array32F(256),m=new e.Array32F(257),h,o,p=d.length,t=1/(p>>2),w=Array(p>>2),s=e.Color.RGB2YCbCr,x=e.Color.YCbCr2RGB;for(h=0;h<256;)j[h]=0,m[h]=0,h++;for(o=h=m[256]=0;h<p;){k=d[h];c=d[h+1];a=d[h+2];k=s({red:k,green:c,blue:a});j[k.Y]+=t;if(k.Y>l)l=k.Y;if(k.Y<n)n=k.Y;w[o]=k;h+=4;o++}for(h=0;h<256;)m[h+1]=m[h]+j[h],h++;l-=n;for(o=h=0;h<p;)k=w[o],k.Y=m[k.Y+1]*l+n,j=x(k),d[h]=j.red,d[h+1]=j.green,d[h+2]=
j.blue,h+=4,o++;return d}})})(FILTER);
(function(e){e.RGBHistogramEqualizeFilter=e.Create({init:function(){},apply:function(d){var k,c,a,l,n,j;j=n=l=0;var m=255,h=255,o=255,p=new e.Array32F(256),t=new e.Array32F(256),w=new e.Array32F(256),s=new e.Array32F(257),x=new e.Array32F(257),y=new e.Array32F(257),q,u=d.length,z=1/(u>>2);for(q=0;q<256;)p[q]=0,t[q]=0,w[q]=0,s[q]=0,x[q]=0,y[q]=0,q++;s[256]=0;x[256]=0;for(q=y[256]=0;q<u;)k=d[q],c=d[q+1],a=d[q+2],p[k]+=z,t[c]+=z,w[a]+=z,k>l&&(l=k),k<m&&(m=k),c>n&&(n=c),c<h&&(h=c),a>j&&(j=a),a<o&&(o=
a),q+=4;for(q=0;q<256;)s[q+1]=s[q]+p[q],x[q+1]=x[q]+t[q],y[q+1]=y[q]+w[q],q++;l-=m;n-=h;j-=o;for(q=0;q<u;)k=d[q],c=d[q+1],a=d[q+2],d[q]=s[k+1]*l+m,d[q+1]=x[c+1]*n+h,d[q+2]=y[a+1]*j+o,q+=4;return d}})})(FILTER);(function(e){e.NoiseFilter=e.Create({min:-127,max:127,init:function(d,e){this.min=d||-127;this.max=e||127},apply:function(d){var e=this.max-this.min,c=Math.random,a=this.min,l,n=d.length,j;for(l=0;l<n;)r=d[l],g=d[l+1],b=d[l+2],j=e*c()+a,d[l]=r+j,d[l+1]=g+j,d[l+2]=b+j,l+=4;return d}})})(FILTER);
