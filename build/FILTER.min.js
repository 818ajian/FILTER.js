/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.3.3
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/var FILTER=FILTER||{};
(function(c){var m,e=Math.min;m={normal:function(d){return d},lighten:function(d,a){return a>d?a:d},darken:function(d,a){return a>d?d:a},multiply:function(d,a){return d*a*0.003921568627451},average:function(d,a){return 0.5*(d+a)},add:function(d,a){return Math.min(255,d+a)},substract:function(d,a){return d+a<255?0:d+a-255},difference:function(d,a){return Math.abs(d-a)},negation:function(d,a){return 255-Math.abs(255-d-a)},screen:function(d,a){return 255-((255-d)*(255-a)>>8)},exclusion:function(d,a){return d+
a-2*d*a*0.003921568627451},overlay:function(d,a){return a<128?2*d*a*0.003921568627451:255-2*(255-d)*(255-a)*0.003921568627451},softLight:function(d,a){return a<128?2*((d>>1)+64)*a*0.003921568627451:255-2*(255-((d>>1)+64))*(255-a)*0.003921568627451},hardLight:function(d,a){return d<128?2*a*d*0.003921568627451:255-2*(255-a)*(255-d)*0.003921568627451},colorDodge:function(d,a){return a==255?a:Math.min(255,(d<<8)/(255-a))},colorBurn:function(d,a){return a==0?a:Math.max(0,255-(255-d<<8)/a)},linearLight:function(d,
a){return a<128?m.linearBurn(d,2*a):m.linearDodge(d,2*(a-128))},vividLight:function(d,a){return a<128?m.colorBurn(d,2*a):m.colorDodge(d,2*(a-128))},pinLight:function(d,a){return a<128?m.darken(d,2*a):m.lighten(d,2*(a-128))},hardMix:function(d,a){return m.vividLight(d,a)<128?0:255},reflect:function(d,a){return a==255?a:Math.min(255,d*d/(255-a))},glow:function(d,a){return d==255?d:Math.min(255,a*a/(255-d))},phoenix:function(d,a){return Math.min(d,a)-Math.max(d,a)+255}};m.linearDodge=m.add;m.linearBurn=
m.substract;c.blendModes=m;c.Image=function(d,a){this.height=this.width=0;this.imageData=this.context=null;this.canvasElement=document.createElement("canvas");this.canvasElement.width=0;this.canvasElement.height=0;this.context=this.canvasElement.getContext("2d");this._integral=this._histogram=null;this._integralRefresh=this._histogramRefresh=!0;this.setImage(d,a)};c.Image.prototype={getPixel:function(d,a){var l=~~(a*this.width+d+0.5);return{red:this.imageData.data[l],green:this.imageData.data[l+1],
blue:this.imageData.data[l+2],alpha:this.imageData.data[l+3]}},setPixel:function(d,a,l,m,k,n){this.context.putImageData(new c.ImArray([l,m,k,n]),d,a);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},getData:function(){return new c.ImArray(this.imageData.data)},setData:function(d){this.imageData.data.set(d);this.context.putImageData(this.imageData,0,0);this._integralRefresh=this._histogramRefresh=!0;return this},getPixelData:function(){return this.imageData},
setPixelData:function(d){this.context.putImageData(d,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setWidth:function(d){this.width=d;this.canvasElement.width=this.width;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setHeight:function(d){this.height=d;this.canvasElement.height=this.height;
this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setImage:function(d,a){if(typeof d=="undefined"||d==null)return this;var l=this,c;d instanceof Image||d instanceof HTMLCanvasElement||d instanceof HTMLVideoElement?(c=d,this.width=d.width,this.height=d.height,this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.context=this.canvasElement.getContext("2d"),
this.context.drawImage(c,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._integralRefresh=this._histogramRefresh=!0):(c=new Image,c.onload=function(){l.width=c.width;l.height=c.height;l.canvasElement.width=l.width;l.canvasElement.height=l.height;l.context=l.canvasElement.getContext("2d");l.context.drawImage(c,0,0);l.imageData=l.context.getImageData(0,0,l.width,l.height);l._histogramRefresh=!0;l._integralRefresh=!0;typeof a!="undefined"&&a.call(l)},c.src=d);c.crossOrigin=
"";return this},blend:function(d,a,l,c,k){typeof a=="undefined"&&(a="normal");typeof l=="undefined"&&(l=1);l>1&&(l=1);l<0&&(l=0);typeof c=="undefined"&&(c=0);typeof k=="undefined"&&(k=0);var n=0,j=0;c<0&&(n=-c,c=0);k<0&&(j=-k,k=0);if(!(c>=this.width||k>=this.height)){a=m[a];if(a==void 0||a==null)return this;var p=e(this.width,d.width-n),q=e(this.height,d.height-j),F=this.context.getImageData(c,k,p,q),n=d.context.getImageData(n,j,p,q),d=F.data,n=n.data,C,t,s,y=1-l,o=n.length,x;for(x=0;x<o;x+=4)C=d[x],
t=d[x+1],s=d[x+2],j=a(n[x],C),p=a(n[x+1],t),q=a(n[x+2],s),d[x]=j*l+C*y,d[x+1]=p*l+t*y,d[x+2]=q*l+s*y;this.context.putImageData(F,c,k);this._integralRefresh=this._histogramRefresh=!0;return this}},_refresh:function(){this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);return this},clone:function(){return new c.Image(this.canvasElement)},integral:function(){this._integralRefresh&&this._computeIntegral();return this._integral},_computeIntegral:function(){var d=
this.width,a=this.height,l=new c.Array32U(d*a),m=this.getPixelData().data,k,n,j,e,q;for(e=j=n=k=0;k<d;)ii=k+j,q=ii<<2,q=4899*m[q]+9617*m[q+1]+1868*m[q+2]+8192>>>14,e+=(q&255)>>>0,l[ii]=k>0?l[ii-1]+e:e,n++,j+=d,a==n&&(k++,e=j=n=0);this._integral=l;this._integralRefresh=!1},histogram:function(){this._histogramRefresh&&this._computeHistogram();return this._histogram},_computeHistogram:function(){for(var d=this.getPixelData().data,a=0,l=d.length,m=new c.ImArray(256),k=new c.ImArray(256),e=new c.ImArray(256),
j,p,q,a=0;a<256;)m[a]=0,k[a]=0,e[a]=0,a++;for(a=0;a<l;)j=d[a],p=d[a+1],q=d[a+2],m[j]++,k[p]++,e[q]++,a+=4;this._histogram=[m,k,e];this._histogramRefresh=!1},createImageData:function(d,a){this.width=d;this.height=a;this.canvasElement.width=this.width;this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.context.createImageData(d,a);return this.imageData=this.context.getImageData(0,0,this.width,this.height)},scale:function(){return this}}})(FILTER);
(function(c){c.Color={blend:function(c,e,d){return{red:c.red-~~((c.red-e.red)*d+0.5),green:c.green-~~((c.green-e.green)*d+0.5),blue:c.blue-~~((c.blue-e.blue)*d+0.5)}},distance:function(c,e){var d=c.red-e.red,a=c.green-e.green,l=c.blue-e.blue;return Math.sqrt(d*d+a*a+l*l)},RGBA2Color:function(c){return typeof c.alpha!="undefined"?(c.alpha<<24)+(c.red<<16)+(c.green<<8)+c.blue:(c.red<<16)+(c.green<<8)+c.blue},Color2RGBA:function(c){c=~~c;return{red:c>>16&255,green:c>>8&255,blue:c&255,alpha:c>>24&255}},
RGB2YCbCr:function(c){var e=c.red,d=c.green,c=c.blue;return{Y:~~(0.299*e+0.587*d+0.114*c),Cb:~~(128-0.169*e-0.331*d+0.5*c),Cr:~~(128+0.5*e-0.42*d-0.08*c)}},YCbCr2RGB:function(c){var e=c.Y,d=c.Cb,c=c.Cr;return{red:~~(e+1.4*(c-128)),green:~~(e-0.343*(d-128)-0.711*(c-128)),blue:~~(e+1.765*(d-128))}},RGB2HSV:function(c){var e=c.red*0.00392156862745098,d=c.green*0.00392156862745098,a=c.blue*0.00392156862745098,l;l=e<d?e<a?e:a:d<a?d:a;c=e>d?e>a?e:a:d>a?d:a;if(l==c)return{H:NaN,S:0,V:c};e=((e==l?3:d==l?
5:1)-(e==l?d-a:d==l?a-e:e-d)/(c-l))*60;e>=360?e-=360:e<0&&(e+=360);$=(c-l)/c;return{H:e,S:void 0,V:c}}}})(FILTER);
(function(c){function m(a,d){var a=a||{},c;for(c in d)d&&Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c]);return a}c.Array32F=typeof Float32Array!=="undefined"?Float32Array:Array;c.Array64F=typeof Float64Array!=="undefined"?Float64Array:Array;c.Array8I=typeof Int8Array!=="undefined"?Int8Array:Array;c.Array16I=typeof Int16Array!=="undefined"?Int16Array:Array;c.Array32I=typeof Int32Array!=="undefined"?Int32Array:Array;c.Array8U=typeof Uint8Array!=="undefined"?Uint8Array:Array;c.Array16U=typeof Uint16Array!==
"undefined"?Uint16Array:Array;c.Array32U=typeof Uint32Array!=="undefined"?Uint32Array:Array;c.ImArray=typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:c.Array8U;c.CONSTANTS={SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI};c.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3};c.Filter=function(){};c.Filter.prototype={_apply:function(){},apply:function(){},reset:function(){}};c.CompositeFilter=function(a){this._stack=typeof a!="undefined"&&a.length?a:[]};c.CompositeFilter.prototype={_stack:[],_apply:function(a,
d,c){if(!this._stack.length)return a;for(var k=this._stack,e=k.length,j=0,m;j<e;)(m=k[j++])&&(a=m._apply(a,d,c));return a},apply:function(a){if(!this._stack.length)return a;return a.setData(this._apply(im=a.getData(),a.width,a.height))},filters:function(a){if(a)this._stack=a;return this},push:function(a){this._stack.push(a);return this},pop:function(){return this._stack.pop()},shift:function(a){this._stack.shift(a);return this},unshift:function(){return this._stack.unshift()},concat:function(a){return this.push(a)},
remove:function(a){for(var d=this._stack.length;--d>=0;)a===this._stack[d]&&this._stack.splice(d,1);return this},reset:function(){this._stack.length=0;return this}};var e=null,d=null;c.static={createImageData:function(a,c){e||(e=document.createElement("canvas"),d=e.getContext("2d"));return d.createImageData(a,c)}};c.Create=function(a){var d=function(){this.init.apply(this,Array.prototype.slice.call(arguments))},a=m({init:function(){},reset:function(){return this},apply:function(a){return a}},a);a._apply=
a.apply;a.apply=function(a){return a.setData(this._apply(a.getData(),a.width,a.height))};d.prototype=m(d.prototype,a);return d}})(FILTER);(function(c){c.CustomFilter=function(c){this._handler=c};c.CustomFilter.prototype={_handler:null,_apply:function(c,e,d){if(!this._handler)return c;return this._handler.call(this,c,e,d)},apply:function(c){if(!this._handler)return c;return c.setData(this._handler.call(this,c.getData(),c.width,c.height))}}})(FILTER);
(function(c){c.LUMA={R:0.212671,G:0.71516,B:0.072169};var m=c.Array32F,e=c.CONSTANTS.toRad;c.ColorMatrixFilter=function(d){this.matrix=typeof d!="undefined"&&d.length?new m(d):null};c.ColorMatrixFilter.prototype={channel:function(d,a){var l=(typeof a=="undefined"?0:a)?1:0;switch(d){case c.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case c.CHANNEL.BLUE:return this.concat([0,0,l,0,0,0,0,l,0,0,0,0,1,0,0,0,0,0,0,255]);case c.CHANNEL.GREEN:return this.concat([0,l,0,0,
0,0,1,0,0,0,0,l,0,0,0,0,0,0,0,255]);default:return this.concat([1,0,0,0,0,l,0,0,0,0,l,0,0,0,0,0,0,0,0,255])}},redChannel:function(d){return this.channel(c.CHANNEL.RED,d)},greenChannel:function(d){return this.channel(c.CHANNEL.GREEN,d)},blueChannel:function(d){return this.channel(c.CHANNEL.BLUE,d)},alphaChannel:function(){return this.channel(c.CHANNEL.ALPHA,!0)},swapChannels:function(d,a){switch(d){case c.CHANNEL.ALPHA:switch(a){case c.CHANNEL.ALPHA:return this;case c.CHANNEL.BLUE:return this.concat([1,
0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case c.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);default:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}case c.CHANNEL.BLUE:switch(a){case c.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case c.CHANNEL.BLUE:return this;case c.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);default:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}case c.CHANNEL.GREEN:switch(a){case c.CHANNEL.ALPHA:return this.concat([1,
0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case c.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this;default:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}default:switch(a){case c.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case c.CHANNEL.BLUE:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this}}},
desaturate:function(){return this.concat([c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,0,0,0,1,0])},grayscale:function(){return this.desaturate()},colorize:function(d,a){var l,e,k,n;typeof a=="undefined"&&(a=1);l=(d>>16&255)*0.00392156862745098;e=(d>>8&255)*0.00392156862745098;k=(d&255)*0.00392156862745098;n=1-a;return this.concat([n+a*l*c.LUMA.R,a*l*c.LUMA.G,a*l*c.LUMA.B,0,0,a*e*c.LUMA.R,n+a*e*c.LUMA.G,a*e*c.LUMA.B,0,0,a*k*c.LUMA.R,a*k*c.LUMA.G,n+a*
k*c.LUMA.B,0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},saturate:function(d){var a,l,e;a=1-d;l=a*c.LUMA.R;e=a*c.LUMA.G;a*=c.LUMA.B;return this.concat([l+d,e,a,0,0,l,e+d,a,0,0,l,e,a+d,0,0,0,0,0,1,0])},contrast:function(d,a,c){typeof a=="undefined"&&(a=d);typeof c=="undefined"&&(c=d);d+=1;a+=1;c+=1;return this.concat([d,0,0,0,128*(1-d),0,a,0,0,128*(1-a),0,0,c,0,128*(1-c),0,0,0,1,0])},brightness:function(d,a,c){typeof a=="undefined"&&(a=d);
typeof c=="undefined"&&(c=d);return this.concat([1,0,0,0,d,0,1,0,0,a,0,0,1,0,c,0,0,0,1,0])},adjustHue:function(d){d*=e;var a=Math.cos(d),d=Math.sin(d);return this.concat([c.LUMA.R+a*(1-c.LUMA.R)+d*-c.LUMA.R,c.LUMA.G+a*-c.LUMA.G+d*-c.LUMA.G,c.LUMA.B+a*-c.LUMA.B+d*(1-c.LUMA.B),0,0,c.LUMA.R+a*-c.LUMA.R+d*0.143,c.LUMA.G+a*(1-c.LUMA.G)+d*0.14,c.LUMA.B+a*-c.LUMA.B+d*-0.283,0,0,c.LUMA.R+a*-c.LUMA.R+d*-(1-c.LUMA.R),c.LUMA.G+a*-c.LUMA.G+d*c.LUMA.G,c.LUMA.B+a*(1-c.LUMA.B)+d*c.LUMA.B,0,0,0,0,0,1,0])},average:function(d,
a,c){typeof d=="undefined"&&(d=0.3333);typeof a=="undefined"&&(a=0.3333);typeof c=="undefined"&&(c=0.3334);return this.concat([d,a,c,0,0,d,a,c,0,0,d,a,c,0,0,0,0,0,1,0])},quickContrastCorrection:function(d){typeof d=="undefined"&&(d=1.2);return this.concat([d,0,0,0,0,0,d,0,0,0,0,0,d,0,0,0,0,0,1,0])},quickSepia:function(d,a,c){typeof d=="undefined"&&(d=1);typeof a=="undefined"&&(a=d);typeof c=="undefined"&&(c=d);return this.concat([d*0.5,0.5,0.5,0,0,0.33,a*0.33,0.33,0,0,0.25,0.25,c*0.25,0,0,0,0,0,1,
0])},quickSepia2:function(d,a,c){typeof d=="undefined"&&(d=1);typeof a=="undefined"&&(a=d);typeof c=="undefined"&&(c=d);return this.concat([d*0.3930000066757202,0.7689999938011169,0.1889999955892563,0,0,0.3490000069141388,a*0.6859999895095825,0.1679999977350235,0,0,0.2720000147819519,0.5339999794960022,c*0.1309999972581863,0,0,0,0,0,1,0])},threshold:function(d,a){typeof a=="undefined"&&(a=256);return this.concat([c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*d,c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*
d,c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*d,0,0,0,1,0])},threshold_rgb:function(d,a){typeof a=="undefined"&&(a=256);return this.concat([a,0,0,0,-(a-1)*d,0,a,0,0,-(a-1)*d,0,0,a,0,-(a-1)*d,0,0,0,1,0])},threshold_alpha:function(d,a){typeof d=="undefined"&&(d=0.5);typeof a=="undefined"&&(a=256);return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,a,-a*d])},blend:function(d,a){var c;if(this.matrix){c=this.matrix;for(var e=d.matrix,k=1-a,n=0,j=new m(20);n<20;)j[n]=k*c[n]+a*e[n],n++;c=j}else c=new m(d.matrix);
this.matrix=c;return this},concat:function(d){var a;if(this.matrix){a=this.matrix;var d=new m(d),c=new m(20),e,k,n,j,p;e=d[0];k=d[1];n=d[2];j=d[3];p=d[4];c[0]=e*a[0]+k*a[5]+n*a[10]+j*a[15];c[1]=e*a[1]+k*a[6]+n*a[11]+j*a[16];c[2]=e*a[2]+k*a[7]+n*a[12]+j*a[17];c[3]=e*a[3]+k*a[8]+n*a[13]+j*a[18];c[4]=e*a[4]+k*a[9]+n*a[14]+j*a[19]+p;e=d[5];k=d[6];n=d[7];j=d[8];p=d[9];c[5]=e*a[0]+k*a[5]+n*a[10]+j*a[15];c[6]=e*a[1]+k*a[6]+n*a[11]+j*a[16];c[7]=e*a[2]+k*a[7]+n*a[12]+j*a[17];c[8]=e*a[3]+k*a[8]+n*a[13]+j*a[18];
c[9]=e*a[4]+k*a[9]+n*a[14]+j*a[19]+p;e=d[10];k=d[11];n=d[12];j=d[13];p=d[14];c[10]=e*a[0]+k*a[5]+n*a[10]+j*a[15];c[11]=e*a[1]+k*a[6]+n*a[11]+j*a[16];c[12]=e*a[2]+k*a[7]+n*a[12]+j*a[17];c[13]=e*a[3]+k*a[8]+n*a[13]+j*a[18];c[14]=e*a[4]+k*a[9]+n*a[14]+j*a[19]+p;e=d[15];k=d[16];n=d[17];j=d[18];p=d[19];c[15]=e*a[0]+k*a[5]+n*a[10]+j*a[15];c[16]=e*a[1]+k*a[6]+n*a[11]+j*a[16];c[17]=e*a[2]+k*a[7]+n*a[12]+j*a[17];c[18]=e*a[3]+k*a[8]+n*a[13]+j*a[18];c[19]=e*a[4]+k*a[9]+n*a[14]+j*a[19]+p;a=c}else a=new m(d);
this.matrix=a;return this},_apply:function(d){if(!this.matrix)return d;for(var a=d.length,c=this.matrix,e=0,k,n,j,m;e<a;)k=d[e],n=d[e+1],j=d[e+2],m=d[e+3],d[e]=c[0]*k+c[1]*n+c[2]*j+c[3]*m+c[4],d[e+1]=c[5]*k+c[6]*n+c[7]*j+c[8]*m+c[9],d[e+2]=c[10]*k+c[11]*n+c[12]*j+c[13]*m+c[14],d[e+3]=c[15]*k+c[16]*n+c[17]*j+c[18]*m+c[19],e+=4;return d},apply:function(c){if(!this.matrix)return c;return c.setData(this._apply(c.getData(),c.width,c.height))},reset:function(){this.matrix=null;return this}}})(FILTER);
(function(c){function m(a){var c=p.length,d,e;a--;if(a<c)d=p[a].slice();else for(d=new j(p[c-1]);c<=a;){e=d.slice();d=[1];i=0;for(il=e.length-1;i<il;i++)d.push(e[i]+e[i+1]);d.push(1);c<12&&p.push(d.slice());c++}return d}function e(a){var c,d=-(a>>1),e=Array(a);for(c=0;c<a;c++)e[c]=d,d++;return e}function d(a,c){var e,j,l=a.length,k,n=[],m=0;if(typeof a[0].length=="undefined")for(e=0;e<l;e++)for(j=0;j<l;j++)k=a[e]*c[j],m+=k,n.push(k);else for(e=0;e<l;e++)for(j=0;j<l;j++)k=d(a[e],c[j]),m+=k.sum,n=n.concat(k.ker);
return{kernel:n,sum:m}}function a(a){a=m(a);return d(a,a)}function l(a,c){var j=m(a),l=e(a);return 1==c?d(l.reverse(),j):d(j,l)}function v(a,c){var j,l=Array(a);for(j=0;j<a;j++)l[j]=1;j=e(a);return 1==c?d(j.reverse(),l):d(l,j)}function k(a,c,d,e){var l=a.length,k,n=new j(a.length),d=d||1,e=e||1;for(k=0;k<l;k++)n[k]=d*a[k]+e*c[k];return n}function n(a,c){var c=c||1,d=a*a,e,l=new j(d);for(e=0;e<d;e++)l[e]=c;return l}var j=c.Array32F,p=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,
20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],q=c.CONSTANTS.toRad;c.ConvolutionMatrixFilter=function(a,c){this.factor=c||1;typeof a!="undefined"&&a.length?(this.matrix=new j(a),this.dim=~~(Math.sqrt(a.length)+0.5)):(this.matrix=null,this.dim=0);this.auxMatrix=null;this._isGrad=!1};c.ConvolutionMatrixFilter.prototype={dim:0,matrix:null,lowPass:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(n(a),1/(a*a),a)},highPass:function(a,c){var a=typeof a=="undefined"?3:a%2?a:a+1,
d=a*a,e=-(typeof c=="undefined"?1:c)/d,j=n(a,e);j[d>>2]=1+e;return this.set(j,1,a)},boxBlur:function(a){return this.lowPass(a)},binomialLowPass:function(c){var c=typeof c=="undefined"?3:c%2?c:c+1,d=a(c);return this.set(new j(d.kernel),1/d.sum,c)},binomialHighPass:function(c){var c=typeof c=="undefined"?3:c%2?c:c+1,d=a(c);return this.set(k(n(c),new j(d.kernel),1,-1/d.sum),1,c)},gaussBlur:function(a){return this.binomialLowPass(a)},sharpen:function(a,c){c=typeof c=="undefined"?0.5:c;return c<=0?this.set([0,
-2,0,-2,10,-2,0,-2,0],0.5,3):this.highPass(a,c)},prewittX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=v(a,0);return this.set(new j(c.kernel),1,a)},prewittY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=v(a,1);return this.set(new j(c.kernel),1,a)},prewittDirectional:function(a,c){a=typeof a=="undefined"?3:a%2?a:a+1;c*=q;var d=Math.cos(c),e=Math.sin(c),l=v(a,0),n=v(a,1);return this.set(k(new j(l.kernel),new j(n.kernel),d,e),1,a)},prewitt:function(a){var a=typeof a=="undefined"?3:a%
2?a:a+1,c=v(a,0),d=v(a,1);this.set(new j(c.kernel),1,a);this._isGrad=!0;this.auxMatrix=new j(d.kernel);return this},gradX:function(a){return this.prewittX(a)},gradY:function(a){return this.prewittY(a)},gradDirectional:function(a,c){return this.prewittDirectional(a,c)},grad:function(a){return this.prewitt(a)},sobelX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=l(a,0);return this.set(new j(c.kernel),1,a)},sobelY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=l(a,1);return this.set(new j(c.kernel),
1,a)},sobelDirectional:function(a,c){a=typeof a=="undefined"?3:a%2?a:a+1;c*=q;var d=Math.cos(c),e=Math.sin(c),n=l(a,0),m=l(a,1);return this.set(k(new j(n.kernel),new j(m.kernel),d,e),1,a)},sobel:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=l(a,0),d=l(a,1);this.set(new j(c.kernel),1,a);this.auxMatrix=new j(d.kernel);this._isGrad=!0;return this},laplace:function(){return this.set([0,-1,0,-1,4,-1,0,-1,0],1,3)},emboss:function(a,c){var c=1,d=(typeof a=="undefined"||a!=1&&a!=-1?1:a)*c;return this.set([-d*
2,-d*1,0,-d*1,c*1,d*1,0,d*1,d*2],1,3)},embossHigh:function(){return this.emboss(1)},embossLow:function(){return this.emboss(-1)},edges:function(){return this.set([0,1,0,1,-4,1,0,1,0],1,3)},edges2:function(){return this.set([0,2,0,2,-8,2,0,2,0],0.5,3)},motionblur:function(a){var c=new j(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);if(a==0)for(a=0;a<9;a++)c[36+a]=1;else if(a==2)for(a=
0;a<9;a++)c[9*a+5]=1;else if(a==1)for(a=0;a<9;a++)c[9*a+a]=1;return this.set(c,1/9,9)},set:function(a,c,d){this.matrix=new j(a);this.factor=c;this.dim=d;this.auxMatrix=null;this._isGrad=!1;return this},_apply:function(a,d,e){if(!this.matrix)return a;var j=this.dim,l=j>>1,k=new c.ImArray(a.length),n,m,p,q,u,v=0,z=0,E=0,K=0,M=0,N=0,I,H,J,L,P,Q,R,O=Math.abs;for(m=Q=0;m<e;m++){for(n=0;n<d;n++){q=m;p=n;u=Q+n<<2;for(H=N=M=K=P=E=z=v=0;H<j;H++){I=q+H-l;if(I>=0&&I<e){R=I*d;for(I=0;I<j;I++)J=p+I-l,J>=0&&J<
d&&(J=R+J<<2,L=this.matrix[P+I],v+=a[J]*L,z+=a[J+1]*L,E+=a[J+2]*L,this.auxMatrix&&(L=this.auxMatrix[P+I],K+=a[J]*L,M+=a[J+1]*L,N+=a[J+2]*L))}P+=j}this._isGrad?(k[u]=this.factor*(O(v)+O(K)),k[u+1]=this.factor*(O(z)+O(M)),k[u+2]=this.factor*(O(E)+O(N))):(k[u]=this.factor*v,k[u+1]=this.factor*z,k[u+2]=this.factor*E);k[u+3]=a[u+3]}Q+=d}return k},apply:function(a){if(!this.matrix)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this.auxMatrix=this.matrix=null;this.dim=
0;return this}}})(FILTER);
(function(c){c.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4};var m=Math.min;c.DisplacementMapFilter=function(c){this.map=c};c.DisplacementMapFilter.prototype={scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:c.MODE.CLAMP,map:null,_apply:function(e,d,a){if(!this.map)return e;var l=this.map.getData(),v=this.map.width,k=this.map.height,n=m(v,d),k=m(k,a),j=this.scaleX*0.00390625,p=this.scaleY*0.00390625,q=this.color>>24&255,F=this.color>>16&255,C=this.color>>8&255,t=this.color&255,
s=~~this.startY,y=~~this.startX,o=this.componentX,x=this.componentY,G=this.mode,A,B,u,D,z,E,K,M,N,I=s*d,H=new c.ImArray(e.length);for(K=N=M=0;K<k;K++){B=K+s;if(B>=0&&B<a)for(E=0;E<n;E++)if(A=E+y,!(A<0||A>=d)){u=N+I+A<<2;D=M+E<<2;z=B+~~((l[D+x]-128)*p);A+=~~((l[D+o]-128)*j);if(z>=a||z<0||A>=d||A<0)switch(G){case c.MODE.IGNORE:continue;case c.MODE.COLOR:H[u]=F;H[u+1]=C;H[u+2]=t;H[u+3]=q;continue;case c.MODE.WRAP:z>=a&&(z-=a);z<0&&(z+=a);A>=d&&(A-=d);A<0&&(A+=d);break;default:z>=a&&(z=a-1),z<0&&(z=0),
A>=d&&(A=d-1),A<0&&(A=0)}z=z*d+A<<2;H[u]=e[z];H[u+1]=e[z+1];H[u+2]=e[z+2];H[u+3]=e[z+3]}M+=v;N+=d}return H},apply:function(c){if(!this.map)return c;return c.setData(this._apply(c.getData(),c.width,c.height))},reset:function(){this.map=null;return this}}})(FILTER);
(function(c){var m=function(a,d,e){var k=this.dim,n=k>>1,j=k*k,m=new c.ImArray(a.length),q,F,C,t,s,y,o,x,G,A,B,u,D,z,E;B=[];u=[];D=[];z=j%2;E=~~(0.5*j)+z;for(q=G=0;q<e;q++){for(j=0;j<d;j++){C=q;F=j;t=G+j<<2;B.length=0;u.length=0;for(y=x=D.length=0;y<k;y++){s=C+y-n;if(s>=0&&s<e){A=s*d;for(s=0;s<k;s++)o=F+s-n,o>=0&&o<d&&(o=A+o<<2,B.push(a[o]),u.push(a[o+1]),D.push(a[o+2]))}x+=k}B.sort();u.sort();D.sort();z?(m[t]=B[E],m[t+1]=u[E],m[t+2]=D[E]):(m[t]=~~(0.5*(B[E]+B[E+1])),m[t+1]=~~(0.5*(u[E]+u[E+1])),
m[t+2]=~~(0.5*(D[E]+D[E+1])));m[t+3]=a[t+3]}G+=d}return m},e=function(a,d,e){var k=this.dim,m=k>>1,j=new c.ImArray(a.length),p,q,F,C,t,s,y,o,x,G,A,B,u,D;for(q=G=0;q<e;q++){for(p=0;p<d;p++){C=q;F=p;t=G+p<<2;for(y=x=D=u=B=0;y<k;y++){s=C+y-m;if(s>=0&&s<e){A=s*d;for(s=0;s<k;s++)o=F+s-m,o>=0&&o<d&&(o=A+o<<2,a[o]>B&&(B=a[o]),a[o+1]>u&&(u=a[o+1]),a[o+2]>D&&(D=a[o+2]))}x+=k}j[t]=B;j[t+1]=u;j[t+2]=D;j[t+3]=a[t+3]}G+=d}return j},d=function(a,d,e){var k=this.dim,m=k>>1,j=new c.ImArray(a.length),p,q,F,C,t,s,
y,o,x,G,A,B,u,D;for(q=G=0;q<e;q++){for(p=0;p<d;p++){C=q;F=p;t=G+p<<2;D=u=B=255;for(y=x=0;y<k;y++){s=C+y-m;if(s>=0&&s<e){A=s*d;for(s=0;s<k;s++)o=F+s-m,o>=0&&o<d&&(o=A+o<<2,a[o]<B&&(B=a[o]),a[o+1]<u&&(u=a[o+1]),a[o+2]<D&&(D=a[o+2]))}x+=k}j[t]=B;j[t+1]=u;j[t+2]=D;j[t+3]=a[t+3]}G+=d}return j};c.NonLinearFilter=function(){this.dim=0;this._applyFunc=null};c.NonLinearFilter.prototype={dim:0,median:function(a){this.dim=typeof a=="undefined"?3:a%2?a:a+1;this._applyFunc=m;return this},erode:function(a){this.dim=
typeof a=="undefined"?3:a%2?a:a+1;this._applyFunc=d;return this},dilate:function(a){this.dim=typeof a=="undefined"?3:a%2?a:a+1;this._applyFunc=e;return this},_apply:function(a){if(!this._applyFunc)return a;return this._applyFunc.call(this,a,w,h)},apply:function(a){if(!this.dim)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this._applyFunc=null;this.dim=0;return this}}})(FILTER);
(function(c){c.HistogramEqualizeFilter=c.Create({apply:function(m){var e,d,a,l;l=0;var v=255,k=new c.Array32F(256),n=new c.Array32F(257),j,p,q=m.length,F=1/(q>>2),C=Array(q>>2),t=c.Color.RGB2YCbCr,s=c.Color.YCbCr2RGB;for(j=0;j<256;)k[j]=0,n[j]=0,j++;for(p=j=n[256]=0;j<q;){e=m[j];d=m[j+1];a=m[j+2];e=t({red:e,green:d,blue:a});k[e.Y]+=F;if(e.Y>l)l=e.Y;if(e.Y<v)v=e.Y;C[p]=e;j+=4;p++}for(j=0;j<256;)n[j+1]=n[j]+k[j],j++;l-=v;for(p=j=0;j<q;)e=C[p],e.Y=n[e.Y+1]*l+v,k=s(e),m[j]=k.red,m[j+1]=k.green,m[j+2]=
k.blue,j+=4,p++;return m}})})(FILTER);
(function(c){c.RGBHistogramEqualizeFilter=c.Create({init:function(){},apply:function(m){var e,d,a,l,v,k;k=v=l=0;var n=255,j=255,p=255,q=new c.Array32F(256),F=new c.Array32F(256),C=new c.Array32F(256),t=new c.Array32F(257),s=new c.Array32F(257),y=new c.Array32F(257),o,x=m.length,G=1/(x>>2);for(o=0;o<256;)q[o]=0,F[o]=0,C[o]=0,t[o]=0,s[o]=0,y[o]=0,o++;t[256]=0;s[256]=0;for(o=y[256]=0;o<x;)e=m[o],d=m[o+1],a=m[o+2],q[e]+=G,F[d]+=G,C[a]+=G,e>l&&(l=e),e<n&&(n=e),d>v&&(v=d),d<j&&(j=d),a>k&&(k=a),a<p&&(p=
a),o+=4;for(o=0;o<256;)t[o+1]=t[o]+q[o],s[o+1]=s[o]+F[o],y[o+1]=y[o]+C[o],o++;l-=n;v-=j;k-=p;for(o=0;o<x;)e=m[o],d=m[o+1],a=m[o+2],m[o]=t[e+1]*l+n,m[o+1]=s[d+1]*v+j,m[o+2]=y[a+1]*k+p,o+=4;return m}})})(FILTER);(function(c){c.NoiseFilter=c.Create({min:-127,max:127,init:function(c,e){this.min=c||-127;this.max=e||127},apply:function(c){var e=this.max-this.min,d=Math.random,a=this.min,l,v=c.length,k;for(l=0;l<v;)r=c[l],g=c[l+1],b=c[l+2],k=e*d()+a,c[l]=r+k,c[l+1]=g+k,c[l+2]=b+k,l+=4;return c}})})(FILTER);
