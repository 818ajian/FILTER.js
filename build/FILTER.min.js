/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.4
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/var FILTER=FILTER||{};
(function(c){var l,m=Math.min;l={normal:function(b){return b},lighten:function(b,a){return a>b?a:b},darken:function(b,a){return a>b?b:a},multiply:function(b,a){return b*a*0.003921568627451},average:function(b,a){return 0.5*(b+a)},add:function(b,a){return Math.min(255,b+a)},substract:function(b,a){return b+a<255?0:b+a-255},difference:function(b,a){return Math.abs(b-a)},negation:function(b,a){return 255-Math.abs(255-b-a)},screen:function(b,a){return 255-((255-b)*(255-a)>>8)},exclusion:function(b,a){return b+
a-2*b*a*0.003921568627451},overlay:function(b,a){return a<128?2*b*a*0.003921568627451:255-2*(255-b)*(255-a)*0.003921568627451},softLight:function(b,a){return a<128?2*((b>>1)+64)*a*0.003921568627451:255-2*(255-((b>>1)+64))*(255-a)*0.003921568627451},hardLight:function(b,a){return b<128?2*a*b*0.003921568627451:255-2*(255-a)*(255-b)*0.003921568627451},colorDodge:function(b,a){return a==255?a:Math.min(255,(b<<8)/(255-a))},colorBurn:function(b,a){return a==0?a:Math.max(0,255-(255-b<<8)/a)},linearLight:function(b,
a){return a<128?l.linearBurn(b,2*a):l.linearDodge(b,2*(a-128))},vividLight:function(b,a){return a<128?l.colorBurn(b,2*a):l.colorDodge(b,2*(a-128))},pinLight:function(b,a){return a<128?l.darken(b,2*a):l.lighten(b,2*(a-128))},hardMix:function(b,a){return l.vividLight(b,a)<128?0:255},reflect:function(b,a){return a==255?a:Math.min(255,b*b/(255-a))},glow:function(b,a){return b==255?b:Math.min(255,a*a/(255-b))},phoenix:function(b,a){return Math.min(b,a)-Math.max(b,a)+255}};l.linearDodge=l.add;l.linearBurn=
l.substract;c.blendModes=l;c.Image=function(b,a){this.height=this.width=0;this.imageData=this.context=null;this.canvasElement=document.createElement("canvas");this.canvasElement.width=0;this.canvasElement.height=0;this._tmpCanvas=document.createElement("canvas");this._tmpCanvas.width=0;this._tmpCanvas.height=0;this.context=this.canvasElement.getContext("2d");this._integral=this._histogram=null;this._integralRefresh=this._histogramRefresh=!0;this.setImage(b,a)};c.Image.prototype={width:0,height:0,
canvasElement:null,getPixel:function(b,a){var d=~~(a*this.width+b+0.5);return{red:this.imageData.data[d],green:this.imageData.data[d+1],blue:this.imageData.data[d+2],alpha:this.imageData.data[d+3]}},setPixel:function(b,a,d,e,h,j){this.context.putImageData(new c.ImArray([d,e,h,j]),b,a);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},getData:function(){return new c.ImArray(this.imageData.data)},setData:function(b){this.imageData.data.set(b);
this.context.putImageData(this.imageData,0,0);this._integralRefresh=this._histogramRefresh=!0;return this},getPixelData:function(){return this.imageData},setPixelData:function(b){this.context.putImageData(b,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setWidth:function(b){this._tmpCanvas.width=this.canvasElement.width=this.width=b;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,
0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setHeight:function(b){this._tmpCanvas.height=this.canvasElement.height=this.height=b;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setImage:function(b,a){if(typeof b=="undefined"||b==null)return this;var d=this,c;b instanceof Image||b instanceof HTMLCanvasElement||b instanceof HTMLVideoElement?
(c=b,this.width=b instanceof HTMLVideoElement?b.videoWidth:b.width,this.height=b instanceof HTMLVideoElement?b.videoHeight:b.height,this._tmpCanvas.width=this.canvasElement.width=this.width,this._tmpCanvas.height=this.canvasElement.height=this.height,this.context=this.canvasElement.getContext("2d"),this.context.drawImage(c,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._integralRefresh=this._histogramRefresh=!0):(c=new Image,c.onload=function(){d.width=c.width;d.height=
c.height;d._tmpCanvas.width=d.canvasElement.width=d.width;d._tmpCanvas.height=d.canvasElement.height=d.height;d.context=d.canvasElement.getContext("2d");d.context.drawImage(c,0,0);d.imageData=d.context.getImageData(0,0,d.width,d.height);d._histogramRefresh=!0;d._integralRefresh=!0;typeof a!="undefined"&&a.call(d)},c.src=b);c.crossOrigin="";return this},blend:function(b,a,d,c,h){typeof a=="undefined"&&(a="normal");typeof d=="undefined"&&(d=1);d>1&&(d=1);d<0&&(d=0);typeof c=="undefined"&&(c=0);typeof h==
"undefined"&&(h=0);var j=0,g=0;c<0&&(j=-c,c=0);h<0&&(g=-h,h=0);if(!(c>=this.width||h>=this.height)){a=l[a];if(a==void 0||a==null)return this;var k=m(this.width,b.width-j),t=m(this.height,b.height-g),z=this.context.getImageData(c,h,k,t),j=b.context.getImageData(j,g,k,t),b=z.data,j=j.data,s,x,p,q=1-d,n=j.length,o;for(o=0;o<n;o+=4)s=b[o],x=b[o+1],p=b[o+2],g=a(j[o],s),k=a(j[o+1],x),t=a(j[o+2],p),b[o]=g*d+s*q,b[o+1]=k*d+x*q,b[o+2]=t*d+p*q;this.context.putImageData(z,c,h);this._integralRefresh=this._histogramRefresh=
!0;return this}},_refresh:function(){this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);return this},clone:function(){return new c.Image(this.canvasElement)},integral:function(){this._integralRefresh&&this._computeIntegral();return this._integral},_computeIntegral:function(){var b=this.width,a=this.height,d=new c.Array32U(b*a),e=this.getPixelData().data,h,j,g,m,l;for(m=g=j=h=0;h<b;)ii=h+g,l=ii<<2,l=4899*e[l]+9617*e[l+1]+1868*e[l+2]+
8192>>>14,m+=(l&255)>>>0,d[ii]=h>0?d[ii-1]+m:m,j++,g+=b,a==j&&(h++,m=g=j=0);this._integral=d;this._integralRefresh=!1},histogram:function(){this._histogramRefresh&&this._computeHistogram();return this._histogram},_computeHistogram:function(){for(var b=this.getPixelData().data,a=0,d=b.length,e,h,m,g=0,k=0,l=0,z=255,s=255,x=255,p=new c.Array32F(256),q=new c.Array32F(256),n=new c.Array32F(256),o=1/(d>>2),a=0;a<256;)p[a]=0,q[a]=0,n[a]=0,a++;for(a=0;a<d;)e=b[a],h=b[a+1],m=b[a+2],p[e]+=o,q[h]+=o,n[m]+=
o,e>g&&(g=e),e<z&&(z=e),h>k&&(k=h),h<s&&(s=h),m>l&&(l=m),m<x&&(x=m),a+=4;this._histogram=[p,q,n];this._histogramRefresh=!1},createImageData:function(b,a){this.width=b;this.height=a;this._tmpCanvas.width=this.canvasElement.width=this.width;this._tmpCanvas.height=this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.context.createImageData(b,a);return this.imageData=this.context.getImageData(0,0,this.width,this.height)},scale:function(b,a){var b=b||1,a=a||b,d=this._tmpCanvas.getContext("2d");
d.scale(b,a);d.drawImage(this.canvasElement,0,0);this.canvasElement.width=this.width=~~(b*this.width+0.5);this.canvasElement.height=this.height=~~(a*this.height+0.5);this.context.drawImage(this._tmpCanvas,0,0);this._tmpCanvas.width=this.width;this._tmpCanvas.height=this.height;this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},flipHorizontal:function(){var b=this._tmpCanvas.getContext("2d");b.translate(this.width,0);b.scale(-1,
1);b.drawImage(this.canvasElement,0,0);this.context.drawImage(this._tmpCanvas,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},flipVertical:function(){var b=this._tmpCanvas.getContext("2d");b.translate(0,this.height);b.scale(1,-1);b.drawImage(this.canvasElement,0,0);this.context.drawImage(this._tmpCanvas,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=
!0;return this}}})(FILTER);
(function(c){function l(a,b){var a=a||{},c;for(c in b)b&&Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);return a}c.Array32F=typeof Float32Array!=="undefined"?Float32Array:Array;c.Array64F=typeof Float64Array!=="undefined"?Float64Array:Array;c.Array8I=typeof Int8Array!=="undefined"?Int8Array:Array;c.Array16I=typeof Int16Array!=="undefined"?Int16Array:Array;c.Array32I=typeof Int32Array!=="undefined"?Int32Array:Array;c.Array8U=typeof Uint8Array!=="undefined"?Uint8Array:Array;c.Array16U=typeof Uint16Array!==
"undefined"?Uint16Array:Array;c.Array32U=typeof Uint32Array!=="undefined"?Uint32Array:Array;c.ImArray=typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:c.Array8U;c.CONSTANTS={SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI};c.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3};c.LUMA=new c.Array32F([0.212671,0.71516,0.072169]);c.Filter=function(){};c.Filter.prototype={_apply:function(){},apply:function(){},reset:function(){}};c.CompositeFilter=function(a){this._stack=typeof a!="undefined"&&a.length?
a:[]};c.CompositeFilter.prototype={_stack:[],_apply:function(a,b,c){if(!this._stack.length)return a;for(var m=this._stack,j=m.length,g=0,k;g<j;)(k=m[g++])&&(a=k._apply(a,b,c));return a},apply:function(a){if(!this._stack.length)return a;return a.setData(this._apply(im=a.getData(),a.width,a.height))},filters:function(a){if(a)this._stack=a;return this},push:function(a){this._stack.push(a);return this},pop:function(){return this._stack.pop()},shift:function(a){this._stack.shift(a);return this},unshift:function(){return this._stack.unshift()},
concat:function(a){return this.push(a)},remove:function(a){for(var b=this._stack.length;--b>=0;)a===this._stack[b]&&this._stack.splice(b,1);return this},reset:function(){this._stack.length=0;return this}};c.Create=function(a){var b=function(){this.init.apply(this,Array.prototype.slice.call(arguments))},a=l({init:function(){},reset:function(){return this},apply:function(a){return a}},a);a._apply=a.apply;a.apply=function(a){return a.setData(this._apply(a.getData(),a.width,a.height))};b.prototype=l(b.prototype,
a);return b};var m=null,b=null;c.static={createImageData:function(a,d){m||(m=document.createElement("canvas"),b=m.getContext("2d"));return b.createImageData(a,d)}}})(FILTER);
(function(c){var l=Math.sqrt;c.Color={blend:function(c,b,a){return{red:c.red-~~((c.red-b.red)*a+0.5),green:c.green-~~((c.green-b.green)*a+0.5),blue:c.blue-~~((c.blue-b.blue)*a+0.5)}},toGray:function(m,b,a){return~~(c.LUMA[0]*m+c.LUMA[1]*b+c.LUMA[2]*a)},distance:function(c,b){var a=c.red-b.red,d=c.green-b.green,e=c.blue-b.blue;return l(a*a+d*d+e*e)},RGB2Color:function(c){return(c.red<<16)+(c.green<<8)+c.blue},RGBA2Color:function(c){return(c.alpha<<24)+(c.red<<16)+(c.green<<8)+c.blue},Color2RGBA:function(c){c=
~~c;return{red:c>>16&255,green:c>>8&255,blue:c&255,alpha:c>>24&255}},RGB2YCbCr:function(c){var b=c.red,a=c.green,c=c.blue;return{Y:~~(0.299*b+0.587*a+0.114*c),Cb:~~(128-0.169*b-0.331*a+0.5*c),Cr:~~(128+0.5*b-0.42*a-0.08*c)}},YCbCr2RGB:function(c){var b=c.Y,a=c.Cb,c=c.Cr;return{red:~~(b+1.4*(c-128)),green:~~(b-0.343*(a-128)-0.711*(c-128)),blue:~~(b+1.765*(a-128))}},RGB2HSV:function(c){var b=c.red*0.00392156862745098,a=c.green*0.00392156862745098,d=c.blue*0.00392156862745098,e;e=b<a?b<d?b:d:a<d?a:d;
c=b>a?b>d?b:d:a>d?a:d;if(e==c)return{H:NaN,S:0,V:c};b=((b==e?3:a==e?5:1)-(b==e?a-d:a==e?d-b:b-a)/(c-e))*60;b>=360?b-=360:b<0&&(b+=360);$=(c-e)/c;return{H:b,S:void 0,V:c}}}})(FILTER);(function(c){c.CustomFilter=function(c){this._handler=c};c.CustomFilter.prototype={_handler:null,_apply:function(c,m,b){if(!this._handler)return c;return this._handler.call(this,c,m,b)},apply:function(c){if(!this._handler)return c;return c.setData(this._handler.call(this,c.getData(),c.width,c.height))}}})(FILTER);
(function(c){var l=c.Array32F,m=c.CONSTANTS.toRad;c.ColorMatrixFilter=function(b){this.matrix=typeof b!="undefined"&&b.length?new l(b):null};c.ColorMatrixFilter.prototype={channel:function(b,a){var d=(typeof a=="undefined"?0:a)?1:0;switch(b){case c.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case c.CHANNEL.BLUE:return this.concat([0,0,d,0,0,0,0,d,0,0,0,0,1,0,0,0,0,0,0,255]);case c.CHANNEL.GREEN:return this.concat([0,d,0,0,0,0,1,0,0,0,0,d,0,0,0,0,0,0,0,255]);default:return this.concat([1,
0,0,0,0,d,0,0,0,0,d,0,0,0,0,0,0,0,0,255])}},redChannel:function(b){return this.channel(c.CHANNEL.RED,b)},greenChannel:function(b){return this.channel(c.CHANNEL.GREEN,b)},blueChannel:function(b){return this.channel(c.CHANNEL.BLUE,b)},alphaChannel:function(){return this.channel(c.CHANNEL.ALPHA,!0)},swapChannels:function(b,a){switch(b){case c.CHANNEL.ALPHA:switch(a){case c.CHANNEL.ALPHA:return this;case c.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case c.CHANNEL.GREEN:return this.concat([1,
0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);default:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}case c.CHANNEL.BLUE:switch(a){case c.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case c.CHANNEL.BLUE:return this;case c.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);default:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}case c.CHANNEL.GREEN:switch(a){case c.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,0,0,1,0,0,
0,1,0,0,0,1,0,0,0]);case c.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this;default:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}default:switch(a){case c.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case c.CHANNEL.BLUE:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this}}},desaturate:function(){return this.concat([c.LUMA[0],
c.LUMA[1],c.LUMA[2],0,0,c.LUMA[0],c.LUMA[1],c.LUMA[2],0,0,c.LUMA[0],c.LUMA[1],c.LUMA[2],0,0,0,0,0,1,0])},grayscale:function(){return this.desaturate()},colorize:function(b,a){var d,e,h,j;typeof a=="undefined"&&(a=1);d=(b>>16&255)*0.00392156862745098;e=(b>>8&255)*0.00392156862745098;h=(b&255)*0.00392156862745098;j=1-a;return this.concat([j+a*d*c.LUMA[0],a*d*c.LUMA[1],a*d*c.LUMA[2],0,0,a*e*c.LUMA[0],j+a*e*c.LUMA[1],a*e*c.LUMA[2],0,0,a*h*c.LUMA[0],a*h*c.LUMA[1],j+a*h*c.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,
0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},saturate:function(b){var a,d,e;a=1-b;d=a*c.LUMA[0];e=a*c.LUMA[1];a*=c.LUMA[2];return this.concat([d+b,e,a,0,0,d,e+b,a,0,0,d,e,a+b,0,0,0,0,0,1,0])},contrast:function(b,a,c){typeof a=="undefined"&&(a=b);typeof c=="undefined"&&(c=b);b+=1;a+=1;c+=1;return this.concat([b,0,0,0,128*(1-b),0,a,0,0,128*(1-a),0,0,c,0,128*(1-c),0,0,0,1,0])},brightness:function(b,a,c){typeof a=="undefined"&&(a=b);typeof c=="undefined"&&(c=b);return this.concat([1,0,0,0,b,0,1,0,
0,a,0,0,1,0,c,0,0,0,1,0])},adjustHue:function(b){b*=m;var a=Math.cos(b),b=Math.sin(b);return this.concat([c.LUMA[0]+a*(1-c.LUMA[0])+b*-c.LUMA[0],c.LUMA[1]+a*-c.LUMA[1]+b*-c.LUMA[1],c.LUMA[2]+a*-c.LUMA[2]+b*(1-c.LUMA[2]),0,0,c.LUMA[0]+a*-c.LUMA[0]+b*0.143,c.LUMA[1]+a*(1-c.LUMA[1])+b*0.14,c.LUMA[2]+a*-c.LUMA[2]+b*-0.283,0,0,c.LUMA[0]+a*-c.LUMA[0]+b*-(1-c.LUMA[0]),c.LUMA[1]+a*-c.LUMA[1]+b*c.LUMA[1],c.LUMA[2]+a*(1-c.LUMA[2])+b*c.LUMA[2],0,0,0,0,0,1,0])},average:function(b,a,c){typeof b=="undefined"&&
(b=0.3333);typeof a=="undefined"&&(a=0.3333);typeof c=="undefined"&&(c=0.3334);return this.concat([b,a,c,0,0,b,a,c,0,0,b,a,c,0,0,0,0,0,1,0])},quickContrastCorrection:function(b){typeof b=="undefined"&&(b=1.2);return this.concat([b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0])},quickSepia:function(b){typeof b=="undefined"&&(b=10);b>100&&(b=100);b*=2.55;return this.concat([c.LUMA[0],c.LUMA[1],c.LUMA[2],0,40,c.LUMA[0],c.LUMA[1],c.LUMA[2],0,20,c.LUMA[0],c.LUMA[1],c.LUMA[2],0,-b,0,0,0,1,0])},quickSepia2:function(b,
a,c){typeof b=="undefined"&&(b=1);typeof a=="undefined"&&(a=b);typeof c=="undefined"&&(c=b);return this.concat([b*0.5,0.5,0.5,0,0,0.33,a*0.33,0.33,0,0,0.25,0.25,c*0.25,0,0,0,0,0,1,0])},threshold:function(b,a){typeof a=="undefined"&&(a=256);return this.concat([c.LUMA[0]*a,c.LUMA[1]*a,c.LUMA[2]*a,0,-(a-1)*b,c.LUMA[0]*a,c.LUMA[1]*a,c.LUMA[2]*a,0,-(a-1)*b,c.LUMA[0]*a,c.LUMA[1]*a,c.LUMA[2]*a,0,-(a-1)*b,0,0,0,1,0])},threshold_rgb:function(b,a){typeof a=="undefined"&&(a=256);return this.concat([a,0,0,0,
-(a-1)*b,0,a,0,0,-(a-1)*b,0,0,a,0,-(a-1)*b,0,0,0,1,0])},threshold_alpha:function(b,a){typeof b=="undefined"&&(b=0.5);typeof a=="undefined"&&(a=256);return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,a,-a*b])},blend:function(b,a){var c;if(this.matrix){c=this.matrix;for(var e=b.matrix,h=1-a,j=0,g=new l(20);j<20;)g[j]=h*c[j]+a*e[j],j++;c=g}else c=new l(b.matrix);this.matrix=c;return this},concat:function(b){var a;if(this.matrix){a=this.matrix;var b=new l(b),c=new l(20),e,h,j,g,k;e=b[0];h=b[1];j=
b[2];g=b[3];k=b[4];c[0]=e*a[0]+h*a[5]+j*a[10]+g*a[15];c[1]=e*a[1]+h*a[6]+j*a[11]+g*a[16];c[2]=e*a[2]+h*a[7]+j*a[12]+g*a[17];c[3]=e*a[3]+h*a[8]+j*a[13]+g*a[18];c[4]=e*a[4]+h*a[9]+j*a[14]+g*a[19]+k;e=b[5];h=b[6];j=b[7];g=b[8];k=b[9];c[5]=e*a[0]+h*a[5]+j*a[10]+g*a[15];c[6]=e*a[1]+h*a[6]+j*a[11]+g*a[16];c[7]=e*a[2]+h*a[7]+j*a[12]+g*a[17];c[8]=e*a[3]+h*a[8]+j*a[13]+g*a[18];c[9]=e*a[4]+h*a[9]+j*a[14]+g*a[19]+k;e=b[10];h=b[11];j=b[12];g=b[13];k=b[14];c[10]=e*a[0]+h*a[5]+j*a[10]+g*a[15];c[11]=e*a[1]+h*a[6]+
j*a[11]+g*a[16];c[12]=e*a[2]+h*a[7]+j*a[12]+g*a[17];c[13]=e*a[3]+h*a[8]+j*a[13]+g*a[18];c[14]=e*a[4]+h*a[9]+j*a[14]+g*a[19]+k;e=b[15];h=b[16];j=b[17];g=b[18];k=b[19];c[15]=e*a[0]+h*a[5]+j*a[10]+g*a[15];c[16]=e*a[1]+h*a[6]+j*a[11]+g*a[16];c[17]=e*a[2]+h*a[7]+j*a[12]+g*a[17];c[18]=e*a[3]+h*a[8]+j*a[13]+g*a[18];c[19]=e*a[4]+h*a[9]+j*a[14]+g*a[19]+k;a=c}else a=new l(b);this.matrix=a;return this},_apply:function(b){if(!this.matrix)return b;for(var a=b.length,c=this.matrix,e=0,h,j,g,k;e<a;)h=b[e],j=b[e+
1],g=b[e+2],k=b[e+3],b[e]=c[0]*h+c[1]*j+c[2]*g+c[3]*k+c[4],b[e+1]=c[5]*h+c[6]*j+c[7]*g+c[8]*k+c[9],b[e+2]=c[10]*h+c[11]*j+c[12]*g+c[13]*k+c[14],b[e+3]=c[15]*h+c[16]*j+c[17]*g+c[18]*k+c[19],e+=4;return b},apply:function(b){if(!this.matrix)return b;return b.setData(this._apply(b.getData(),b.width,b.height))},reset:function(){this.matrix=null;return this}}})(FILTER);
(function(c){function l(a){if(a)return new c.ImArray(a);return null}var m=Math.pow,b=1/255;c.TableLookupFilter=function(a,b,c){this.tableR=a||null;this.tableG=b||l(this.tableR);this.tableB=c||l(this.tableG)};c.TableLookupFilter.prototype={tableR:null,tableG:null,tableB:null,thresholds:function(a){a.length||(a=[a]);var b=a.length,e=b+1,h=new c.ImArray(256),j=new c.ImArray(e),g,k=255/(e-1);for(g=0;g<e;)j[g]=~~(k*g),g++;a[0]=~~(255*a[0]);for(g=1;g<b;)a[g]=a[g-1]+~~(255*a[g]),g++;for(g=0;g<256;){for(e=
0;e<b&&g>a[e];)e++;h[g]=j[e];g++}return this.concat(h)},threshold:function(a){return this.thresholds([a||0.5])},quantize:function(a){typeof a=="undefined"&&(a=64);a<2&&(a=2);var b=new c.ImArray(256),e=new c.ImArray(a),h,j=255/(a-1),g=a/256;for(h=0;h<a;)e[h]=~~(j*h),h++;for(h=0;h<256;)b[h]=e[~~(g*h)],h++;return this.concat(b)},levels:function(a){return this.quantize(a)},posterize:function(a){return this.quantize(a)},binarize:function(){return this.quantize(2)},solarize:function(a){typeof a=="undefined"&&
(a=0.5);for(var b=0,e=new c.ImArray(256),a=~~(a*256)-1,b=0;b<256;)e[b]=b>a?255-(b<<1):(b<<1)-255,b++;return this.concat(e)},invert:function(){for(var a=0,b=new c.ImArray(256),a=0;a<256;)b[a]=255-a,a++;return this.concat(b)},gammaCorrection:function(a,d,e){for(var a=a||1,d=d||a,e=e||d,a=1/a,d=1/d,e=1/e,h=new c.ImArray(256),j=new c.ImArray(256),g=new c.ImArray(256),k=0;k<256;)h[k]=~~(255*m(b*k,a)),j[k]=~~(255*m(b*k,d)),g[k]=~~(255*m(b*k,e)),k++;return this.concat(h,j,g)},concat:function(a,b,e){if(!a)return this;
var b=b||a,e=e||b,h;if(!(h=this.tableR)){h=new c.ImArray(256);for(var j=0;j<256;)h[j]=j,j++}var j=this.tableG||l(h),g=this.tableB||l(j),k=l(h),m=l(j),z=l(g),s;for(s=0;s<256;)h[s]=a[k[s]],j[s]=b[m[s]],g[s]=e[z[s]],s++;this.tableR=h;this.tableG=j;this.tableB=g;return this},_apply:function(a){if(!this.tableR)return a;for(var b=a.length,c=0,h,j,g,k=this.tableR,l=this.tableG,z=this.tableB;c<b;)h=a[c],j=a[c+1],g=a[c+2],a[c]=k[h],a[c+1]=l[j],a[c+2]=z[g],c+=4;return a},apply:function(a){if(!this.tableR)return a;
return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this.tableB=this.tableG=this.tableR=null;return this}}})(FILTER);
(function(c){c.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4};var l=Math.min;c.DisplacementMapFilter=function(c){this.map=c||null};c.DisplacementMapFilter.prototype={scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:c.MODE.CLAMP,map:null,_apply:function(m,b,a){if(!this.map)return m;var d=this.map.getData(),e=this.map.width,h=this.map.height,j=l(e,b),h=l(h,a),g=this.scaleX*0.00390625,k=this.scaleY*0.00390625,t=this.color>>24&255,z=this.color>>16&255,s=this.color>>8&255,x=this.color&
255,p=~~this.startY,q=~~this.startX,n=this.componentX,o=this.componentY,A=this.mode,u,D,v,w,r,B,y,H,I,E=p*b,C=new c.ImArray(m.length);for(y=I=H=0;y<h;y++){D=y+p;if(D>=0&&D<a)for(B=0;B<j;B++)if(u=B+q,!(u<0||u>=b)){v=I+E+u<<2;w=H+B<<2;r=D+~~((d[w+o]-128)*k);u+=~~((d[w+n]-128)*g);if(r>=a||r<0||u>=b||u<0)switch(A){case c.MODE.IGNORE:continue;case c.MODE.COLOR:C[v]=z;C[v+1]=s;C[v+2]=x;C[v+3]=t;continue;case c.MODE.WRAP:r>=a&&(r-=a);r<0&&(r+=a);u>=b&&(u-=b);u<0&&(u+=b);break;default:r>=a&&(r=a-1),r<0&&
(r=0),u>=b&&(u=b-1),u<0&&(u=0)}r=r*b+u<<2;C[v]=m[r];C[v+1]=m[r+1];C[v+2]=m[r+2];C[v+3]=m[r+3]}H+=e;I+=b}return C},apply:function(c){if(!this.map)return c;return c.setData(this._apply(c.getData(),c.width,c.height))},reset:function(){this.map=null;return this}}})(FILTER);
(function(c){function l(a){var b=k.length,c,d;a--;if(a<b)c=k[a].slice();else for(c=new g(k[b-1]);b<=a;){d=c.slice();c=[1];i=0;for(il=d.length-1;i<il;i++)c.push(d[i]+d[i+1]);c.push(1);b<12&&k.push(c.slice());b++}return c}function m(a){var b,c=-(a>>1),d=Array(a);for(b=0;b<a;b++)d[b]=c,c++;return d}function b(a,c){var d,e,g=a.length,h,j=[],k=0;if(typeof a[0].length=="undefined")for(d=0;d<g;d++)for(e=0;e<g;e++)h=a[d]*c[e],k+=h,j.push(h);else for(d=0;d<g;d++)for(e=0;e<g;e++)h=b(a[d],c[e]),k+=h.sum,j=j.concat(h.ker);
return{kernel:j,sum:k}}function a(a){a=l(a);return b(a,a)}function d(a,c){var d=l(a),e=m(a);return 1==c?b(e.reverse(),d):b(d,e)}function e(a,c){var d,e=Array(a);for(d=0;d<a;d++)e[d]=1;d=m(a);return 1==c?b(d.reverse(),e):b(e,d)}function h(a,b,c,d){var e=a.length,h,j=new g(a.length),c=c||1,d=d||1;for(h=0;h<e;h++)j[h]=c*a[h]+d*b[h];return j}function j(a,b){var b=b||1,c=a*a,d,e=new g(c);for(d=0;d<c;d++)e[d]=b;return e}var g=c.Array32F,k=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,
20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],t=c.CONSTANTS.toRad;c.ConvolutionMatrixFilter=function(a,b){this.factor=b||1;typeof a!="undefined"&&a.length?(this.matrix=new g(a),this.dim=~~(Math.sqrt(a.length)+0.5)):(this.matrix=null,this.dim=0);this.auxMatrix=null;this._isGrad=!1};c.ConvolutionMatrixFilter.prototype={dim:0,matrix:null,lowPass:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(j(a),1/(a*a),a)},highPass:function(a,b){var a=typeof a=="undefined"?3:a%2?a:a+1,
c=a*a,d=-(typeof b=="undefined"?1:b)/c,e=j(a,d);e[c>>2]=1+d;return this.set(e,1,a)},boxBlur:function(a){return this.lowPass(a)},binomialLowPass:function(b){var b=typeof b=="undefined"?3:b%2?b:b+1,c=a(b);return this.set(new g(c.kernel),1/c.sum,b)},binomialHighPass:function(b){var b=typeof b=="undefined"?3:b%2?b:b+1,c=a(b);return this.set(h(j(b),new g(c.kernel),1,-1/c.sum),1,b)},gaussBlur:function(a){return this.binomialLowPass(a)},sharpen:function(a,b){b=typeof b=="undefined"?0.5:b;return b<=0?this.set([0,
-2,0,-2,10,-2,0,-2,0],0.5,3):this.highPass(a,b)},prewittX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=e(a,0);return this.set(new g(b.kernel),1,a)},prewittY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=e(a,1);return this.set(new g(b.kernel),1,a)},prewittDirectional:function(a,b){a=typeof a=="undefined"?3:a%2?a:a+1;b*=t;var c=Math.cos(b),d=Math.sin(b),j=e(a,0),k=e(a,1);return this.set(h(new g(j.kernel),new g(k.kernel),c,d),1,a)},prewitt:function(a){var a=typeof a=="undefined"?3:a%
2?a:a+1,b=e(a,0),c=e(a,1);this.set(new g(b.kernel),1,a);this._isGrad=!0;this.auxMatrix=new g(c.kernel);return this},gradX:function(a){return this.prewittX(a)},gradY:function(a){return this.prewittY(a)},gradDirectional:function(a,b){return this.prewittDirectional(a,b)},grad:function(a){return this.prewitt(a)},sobelX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=d(a,0);return this.set(new g(b.kernel),1,a)},sobelY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=d(a,1);return this.set(new g(b.kernel),
1,a)},sobelDirectional:function(a,b){a=typeof a=="undefined"?3:a%2?a:a+1;b*=t;var c=Math.cos(b),e=Math.sin(b),j=d(a,0),k=d(a,1);return this.set(h(new g(j.kernel),new g(k.kernel),c,e),1,a)},sobel:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=d(a,0),c=d(a,1);this.set(new g(b.kernel),1,a);this.auxMatrix=new g(c.kernel);this._isGrad=!0;return this},laplace:function(){return this.set([0,-1,0,-1,4,-1,0,-1,0],1,3)},emboss:function(a,b){var b=1,c=(typeof a=="undefined"||a!=1&&a!=-1?1:a)*b;return this.set([-c*
2,-c*1,0,-c*1,b*1,c*1,0,c*1,c*2],1,3)},embossHigh:function(){return this.emboss(1)},embossLow:function(){return this.emboss(-1)},edges:function(){return this.set([0,1,0,1,-4,1,0,1,0],1,3)},edges2:function(){return this.set([0,2,0,2,-8,2,0,2,0],0.5,3)},motionblur:function(a){var b=new g(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);if(a==0)for(a=0;a<9;a++)b[36+a]=1;else if(a==2)for(a=
0;a<9;a++)b[9*a+5]=1;else if(a==1)for(a=0;a<9;a++)b[9*a+a]=1;return this.set(b,1/9,9)},set:function(a,b,c){this.matrix=new g(a);this.factor=b;this.dim=c;this.auxMatrix=null;this._isGrad=!1;return this},_apply:function(a,b,d){if(!this.matrix)return a;var e=this.dim,h=e>>1,g=new c.ImArray(a.length),j,k,l,m,t,w=0,r=0,B=0,y=0,H=0,I=0,E,C,F,G,K,L,M,J=Math.abs;for(k=L=0;k<d;k++){for(j=0;j<b;j++){m=k;l=j;t=L+j<<2;for(C=I=H=y=K=B=r=w=0;C<e;C++){E=m+C-h;if(E>=0&&E<d){M=E*b;for(E=0;E<e;E++)F=l+E-h,F>=0&&F<
b&&(F=M+F<<2,G=this.matrix[K+E],w+=a[F]*G,r+=a[F+1]*G,B+=a[F+2]*G,this.auxMatrix&&(G=this.auxMatrix[K+E],y+=a[F]*G,H+=a[F+1]*G,I+=a[F+2]*G))}K+=e}this._isGrad?(g[t]=this.factor*(J(w)+J(y)),g[t+1]=this.factor*(J(r)+J(H)),g[t+2]=this.factor*(J(B)+J(I))):(g[t]=this.factor*w,g[t+1]=this.factor*r,g[t+2]=this.factor*B);g[t+3]=a[t+3]}L+=b}return g},apply:function(a){if(!this.matrix)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this.auxMatrix=this.matrix=null;this.dim=
0;return this}}})(FILTER);
(function(c){var l=function(a,b,h){var j=this.dim,g=j>>1,k=j*j,l=new c.ImArray(a.length),m,s,x,p,q,n,o,A,u,D,v,w,r,B,y;v=[];w=[];r=[];B=k%2;y=~~(0.5*k)+B;for(m=u=0;m<h;m++){for(k=0;k<b;k++){x=m;s=k;p=u+k<<2;v.length=0;w.length=0;for(n=A=r.length=0;n<j;n++){q=x+n-g;if(q>=0&&q<h){D=q*b;for(q=0;q<j;q++)o=s+q-g,o>=0&&o<b&&(o=D+o<<2,v.push(a[o]),w.push(a[o+1]),r.push(a[o+2]))}A+=j}v.sort();w.sort();r.sort();B?(l[p]=v[y],l[p+1]=w[y],l[p+2]=r[y]):(l[p]=~~(0.5*(v[y]+v[y+1])),l[p+1]=~~(0.5*(w[y]+w[y+1])),
l[p+2]=~~(0.5*(r[y]+r[y+1])));l[p+3]=a[p+3]}u+=b}return l},m=function(a,b,h){var j=this.dim,g=j>>1,k=new c.ImArray(a.length),l,m,s,x,p,q,n,o,A,u,D,v,w,r;for(m=u=0;m<h;m++){for(l=0;l<b;l++){x=m;s=l;p=u+l<<2;for(n=A=r=w=v=0;n<j;n++){q=x+n-g;if(q>=0&&q<h){D=q*b;for(q=0;q<j;q++)o=s+q-g,o>=0&&o<b&&(o=D+o<<2,a[o]>v&&(v=a[o]),a[o+1]>w&&(w=a[o+1]),a[o+2]>r&&(r=a[o+2]))}A+=j}k[p]=v;k[p+1]=w;k[p+2]=r;k[p+3]=a[p+3]}u+=b}return k},b=function(a,b,h){var j=this.dim,g=j>>1,k=new c.ImArray(a.length),l,m,s,x,p,q,
n,o,A,u,D,v,w,r;for(m=u=0;m<h;m++){for(l=0;l<b;l++){x=m;s=l;p=u+l<<2;r=w=v=255;for(n=A=0;n<j;n++){q=x+n-g;if(q>=0&&q<h){D=q*b;for(q=0;q<j;q++)o=s+q-g,o>=0&&o<b&&(o=D+o<<2,a[o]<v&&(v=a[o]),a[o+1]<w&&(w=a[o+1]),a[o+2]<r&&(r=a[o+2]))}A+=j}k[p]=v;k[p+1]=w;k[p+2]=r;k[p+3]=a[p+3]}u+=b}return k},a=function(a){return a};c.NonLinearFilter=function(){this.dim=0;this._apply=a};c.NonLinearFilter.prototype={dim:0,median:function(a){this.dim=typeof a=="undefined"?3:a%2?a:a+1;this._apply=l;return this},erode:function(a){this.dim=
typeof a=="undefined"?3:a%2?a:a+1;this._apply=b;return this},dilate:function(a){this.dim=typeof a=="undefined"?3:a%2?a:a+1;this._apply=m;return this},_apply:function(a){return a},apply:function(a){if(!this.dim)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this._apply=a;this.dim=0;return this}}})(FILTER);
(function(c){c.HistogramEqualizeFilter=c.Create({apply:function(l){var m,b,a,d;d=0;var e=255,h=new c.Array32F(256),j=new c.Array32F(256),g=0,k,t=l.length,z=1/(t>>2),s=Array(t>>2),x=c.Color.RGB2YCbCr,p=c.Color.YCbCr2RGB;for(k=0;k<256;)h[k]=0,j[k]=0,k++;for(g=k=0;k<t;){m=l[k];b=l[k+1];a=l[k+2];m=x({red:m,green:b,blue:a});h[m.Y]+=z;if(m.Y>d)d=m.Y;if(m.Y<e)e=m.Y;s[g]=m;k+=4;g++}for(k=g=0;k<256;)g+=h[k],j[k]=g,k++;d-=e;for(g=k=0;k<t;)m=s[g],m.Y=j[m.Y]*d+e,h=p(m),l[k]=h.red,l[k+1]=h.green,l[k+2]=h.blue,
k+=4,g++;return l}})})(FILTER);
(function(c){c.RGBHistogramEqualizeFilter=c.Create({init:function(){},apply:function(l){var m,b,a,d,e,h;h=e=d=0;var j=255,g=255,k=255,t=new c.Array32F(256),z=new c.Array32F(256),s=new c.Array32F(256),x=new c.Array32F(256),p=new c.Array32F(256),q=new c.Array32F(256),n,o=l.length,A=1/(o>>2);for(n=0;n<256;)t[n]=0,z[n]=0,s[n]=0,x[n]=0,p[n]=0,q[n]=0,n++;for(n=0;n<o;)m=l[n],b=l[n+1],a=l[n+2],t[m]+=A,z[b]+=A,s[a]+=A,m>d&&(d=m),m<j&&(j=m),b>e&&(e=b),b<g&&(g=b),a>h&&(h=a),a<k&&(k=a),n+=4;for(n=m=b=a=0;n<256;)m+=
t[n],x[n]=m,b+=z[n],p[n]=b,a+=s[n],q[n]=a,n++;d-=j;e-=g;h-=k;for(n=0;n<o;)m=l[n],b=l[n+1],a=l[n+2],l[n]=x[m]*d+j,l[n+1]=p[b]*e+g,l[n+2]=q[a]*h+k,n+=4;return l}})})(FILTER);(function(c){c.NoiseFilter=c.Create({min:-127,max:127,init:function(c,m){this.min=c||-127;this.max=m||127},apply:function(c){var m=this.max-this.min,b=Math.random,a=this.min,d,e=c.length,h,j,g,k;for(d=0;d<e;)j=c[d],g=c[d+1],k=c[d+2],h=m*b()+a,c[d]=j+h,c[d+1]=g+h,c[d+2]=k+h,d+=4;return c}})})(FILTER);
