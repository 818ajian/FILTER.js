/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.3
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/
var FILTER=FILTER||{};
(function(c){var d,l=Math.min;d={normal:function(b){return b},lighten:function(b,a){return a>b?a:b},darken:function(b,a){return a>b?b:a},multiply:function(b,a){return b*a*0.003921568627451},average:function(b,a){return 0.5*(b+a)},add:function(b,a){return Math.min(255,b+a)},substract:function(b,a){return b+a<255?0:b+a-255},difference:function(b,a){return Math.abs(b-a)},negation:function(b,a){return 255-Math.abs(255-b-a)},screen:function(b,a){return 255-((255-b)*(255-a)>>8)},exclusion:function(b,a){return b+
a-2*b*a*0.003921568627451},overlay:function(b,a){return a<128?2*b*a*0.003921568627451:255-2*(255-b)*(255-a)*0.003921568627451},softLight:function(b,a){return a<128?2*((b>>1)+64)*a*0.003921568627451:255-2*(255-((b>>1)+64))*(255-a)*0.003921568627451},hardLight:function(b,a){return b<128?2*a*b*0.003921568627451:255-2*(255-a)*(255-b)*0.003921568627451},colorDodge:function(b,a){return a==255?a:Math.min(255,(b<<8)/(255-a))},colorBurn:function(b,a){return a==0?a:Math.max(0,255-(255-b<<8)/a)},linearLight:function(b,
a){return a<128?d.linearBurn(b,2*a):d.linearDodge(b,2*(a-128))},vividLight:function(b,a){return a<128?d.colorBurn(b,2*a):d.colorDodge(b,2*(a-128))},pinLight:function(b,a){return a<128?d.darken(b,2*a):d.lighten(b,2*(a-128))},hardMix:function(b,a){return d.vividLight(b,a)<128?0:255},reflect:function(b,a){return a==255?a:Math.min(255,b*b/(255-a))},glow:function(b,a){return b==255?b:Math.min(255,a*a/(255-b))},phoenix:function(b,a){return Math.min(b,a)-Math.max(b,a)+255}};d.linearDodge=d.add;d.linearBurn=
d.substract;c.blendModes=d;c.Image=function(b,a){this.height=this.width=0;this.imageData=this.context=null;this.canvasElement=document.createElement("canvas");this.canvasElement.width=0;this.canvasElement.height=0;this.context=this.canvasElement.getContext("2d");this._integral=this._histogram=null;this._integralRefresh=this._histogramRefresh=!0;this.setImage(b,a)};c.Image.prototype={getData:function(){return new c.ImArray(this.imageData.data)},setData:function(b){this.imageData.data.set(b);this.context.putImageData(this.imageData,
0,0);this._integralRefresh=this._histogramRefresh=!0;return this},getPixelData:function(){return this.imageData},setPixelData:function(b){this.context.putImageData(b,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setWidth:function(b){this.width=b;this.canvasElement.width=this.width;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=
this._histogramRefresh=!0;return this},setHeight:function(b){this.height=b;this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setImage:function(b,a){if(typeof b=="undefined"||b==null)return this;var j=this,d;b instanceof Image||b instanceof HTMLCanvasElement||b instanceof HTMLVideoElement?(d=b,this.width=b.width,this.height=b.height,
this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.context=this.canvasElement.getContext("2d"),this.context.drawImage(d,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._integralRefresh=this._histogramRefresh=!0):(d=new Image,d.onload=function(){j.width=d.width;j.height=d.height;j.canvasElement.width=j.width;j.canvasElement.height=j.height;j.context=j.canvasElement.getContext("2d");j.context.drawImage(d,0,0);j.imageData=j.context.getImageData(0,
0,j.width,j.height);j._histogramRefresh=!0;j._integralRefresh=!0;typeof a!="undefined"&&a.call(j)},d.src=b);d.crossOrigin="";return this},blend:function(b,a,j,c,e){typeof a=="undefined"&&(a="normal");typeof j=="undefined"&&(j=1);j>1&&(j=1);j<0&&(j=0);typeof c=="undefined"&&(c=0);typeof e=="undefined"&&(e=0);var g=0,h=0;c<0&&(g=-c,c=0);e<0&&(h=-e,e=0);if(!(c>=this.width||e>=this.height)){a=d[a];if(a==void 0||a==null)return this;var s=l(this.width,b.width-g),m=l(this.height,b.height-h),t=this.context.getImageData(c,
e,s,m),g=b.context.getImageData(g,h,s,m),b=t.data,g=g.data,w,n,A,y=1-j,C=g.length,p;for(p=0;p<C;p+=4)w=b[p],n=b[p+1],A=b[p+2],h=a(g[p],w),s=a(g[p+1],n),m=a(g[p+2],A),b[p]=h*j+w*y,b[p+1]=s*j+n*y,b[p+2]=m*j+A*y;this.context.putImageData(t,c,e);this._integralRefresh=this._histogramRefresh=!0;return this}},_refresh:function(){this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);return this},clone:function(){return new c.Image(this.canvasElement)},
integral:function(){this._integralRefresh&&this._computeIntegral();return this._integral},_computeIntegral:function(){var b=this.width,a=this.height,j=new c.Array32U(b*a),d=this.getPixelData().data,e,g,h,l,m;for(l=h=g=e=0;e<b;)ii=e+h,m=ii<<2,m=4899*d[m]+9617*d[m+1]+1868*d[m+2]+8192>>>14,l+=(m&255)>>>0,j[ii]=e>0?j[ii-1]+l:l,g++,h+=b,a==g&&(e++,l=h=g=0);this._integral=j;this._integralRefresh=!1},histogram:function(){this._histogramRefresh&&this._computeHistogram();return this._histogram},_computeHistogram:function(){for(var b=
this.getPixelData().data,a=0,j=b.length,d=new c.ImArray(256),e=new c.ImArray(256),g=new c.ImArray(256),h,l,m,a=0;a<256;)d[a]=0,e[a]=0,g[a]=0,a++;for(a=0;a<j;)h=b[a],l=b[a+1],m=b[a+2],d[h]++,e[l]++,g[m]++,a+=4;this._histogram=[d,e,g];this._histogramRefresh=!1},createImageData:function(b,a){this.width=b;this.height=a;this.canvasElement.width=this.width;this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.context.createImageData(b,a);return this.imageData=this.context.getImageData(0,
0,this.width,this.height)},scale:function(){return this}}})(FILTER);
(function(c){c.Color={blend:function(d,c,b){return{red:d.red-~~((d.red-c.red)*b+0.5),green:d.green-~~((d.green-c.green)*b+0.5),blue:d.blue-~~((d.blue-c.blue)*b+0.5)}},distance:function(d,c){var b=d.red-c.red,a=d.green-c.green,j=d.blue-c.blue;return Math.sqrt(b*b+a*a+j*j)},RGBA2Color:function(d){return typeof d.alpha!="undefined"?(d.alpha<<24)+(d.red<<16)+(d.green<<8)+d.blue:(d.red<<16)+(d.green<<8)+d.blue},Color2RGBA:function(d){d=~~d;return{red:d>>16&255,green:d>>8&255,blue:d&255,alpha:d>>24&255}},
RGB2YCbCr:function(d){var c=d.red,b=d.green,d=d.blue;return{Y:~~(0.299*c+0.587*b+0.114*d),Cb:~~(128-0.169*c-0.331*b+0.5*d),Cr:~~(128+0.5*c-0.42*b-0.08*d)}},YCbCr2RGB:function(d){var c=d.Y,b=d.Cb,d=d.Cr;return{red:~~(c+1.4(d-128)),green:~~(c-0.343*(b-128)-0.711*(d-128)),blue:~~(c+1.765*(b-128))}},RGB2HSV:function(d){var c=d.red*0.00392156862745098,b=d.green*0.00392156862745098,a=d.blue*0.00392156862745098,j;j=c<b?c<a?c:a:b<a?b:a;d=c>b?c>a?c:a:b>a?b:a;if(j==d)return{H:NaN,S:0,V:d};c=((c==j?3:b==j?5:
1)-(c==j?b-a:b==j?a-c:c-b)/(d-j))*60;c>=360?c-=360:c<0&&(c+=360);$=(d-j)/d;return{H:c,S:void 0,V:d}}}})(FILTER);
(function(c){c.Array32F=typeof Float32Array!=="undefined"?Float32Array:Array;c.Array64F=typeof Float64Array!=="undefined"?Float64Array:Array;c.Array8I=typeof Int8Array!=="undefined"?Int8Array:Array;c.Array16I=typeof Int16Array!=="undefined"?Int16Array:Array;c.Array32I=typeof Int32Array!=="undefined"?Int32Array:Array;c.Array8U=typeof Uint8Array!=="undefined"?Uint8Array:Array;c.Array16U=typeof Uint16Array!=="undefined"?Uint16Array:Array;c.Array32U=typeof Uint32Array!=="undefined"?Uint32Array:Array;
c.ImArray=typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:c.Array8U;c.CONSTANTS={SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI};c.Filter=function(){};c.Filter.prototype={_apply:function(){},apply:function(){},reset:function(){}};c.CompositeFilter=function(b){this._stack=typeof b!="undefined"&&b.length?b:[]};c.CompositeFilter.prototype={_stack:[],_apply:function(b,a,c){if(!this._stack.length)return b;for(var d=this._stack,e=d.length,g=0,h;g<e;)(h=d[g++])&&(b=h._apply(b,a,c));return b},
apply:function(b){if(!this._stack.length)return b;return b.setData(this._apply(im=b.getData(),b.width,b.height))},filters:function(b){if(b)this._stack=b;return this},push:function(b){this._stack.push(b);return this},pop:function(){return this._stack.pop()},shift:function(b){this._stack.shift(b);return this},unshift:function(){return this._stack.unshift()},concat:function(b){return this.push(b)},remove:function(b){for(var a=this._stack.length;--a>=0;)b===this._stack[a]&&this._stack.splice(a,1);return this},
reset:function(){this._stack.length=0;return this}};var d=null,l=null;c.static={createImageData:function(b,a){d||(d=document.createElement("canvas"),l=d.getContext("2d"));return l.createImageData(b,a)}}})(FILTER);
(function(c){c.LUMA={R:0.212671,G:0.71516,B:0.072169};var d=c.Array32F,l=c.CONSTANTS.toRad;c.ColorMatrixFilter=function(b){this.matrix=typeof b!="undefined"&&b.length?new d(b):null};c.ColorMatrixFilter.prototype={redChannel:function(){return this.concat([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,255])},greenChannel:function(){return this.concat([0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,255])},blueChannel:function(){return this.concat([0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,255])},alphaChannel:function(){return this.concat([0,
0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255])},desaturate:function(){return this.concat([c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,0,0,0,1,0])},grayscale:function(){return this.desaturate()},colorize:function(b,a){var d,k,e,g;typeof a=="undefined"&&(a=1);d=(b>>16&255)*0.00392156862745098;k=(b>>8&255)*0.00392156862745098;e=(b&255)*0.00392156862745098;g=1-a;return this.concat([g+a*d*c.LUMA.R,a*d*c.LUMA.G,a*d*c.LUMA.B,0,0,a*k*c.LUMA.R,g+a*k*c.LUMA.G,a*k*
c.LUMA.B,0,0,a*e*c.LUMA.R,a*e*c.LUMA.G,g+a*e*c.LUMA.B,0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},saturate:function(b){var a,d,k;a=1-b;d=a*c.LUMA.R;k=a*c.LUMA.G;a*=c.LUMA.B;return this.concat([d+b,k,a,0,0,d,k+b,a,0,0,d,k,a+b,0,0,0,0,0,1,0])},contrast:function(b,a,d){typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);b+=1;a+=1;d+=1;return this.concat([b,0,0,0,128*(1-b),0,a,0,0,128*(1-a),0,0,d,0,128*(1-d),0,0,0,1,0])},brightness:function(b,
a,d){typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);return this.concat([1,0,0,0,b,0,1,0,0,a,0,0,1,0,d,0,0,0,1,0])},adjustHue:function(b){b*=l;var a=Math.cos(b),b=Math.sin(b);return this.concat([c.LUMA.R+a*(1-c.LUMA.R)+b*-c.LUMA.R,c.LUMA.G+a*-c.LUMA.G+b*-c.LUMA.G,c.LUMA.B+a*-c.LUMA.B+b*(1-c.LUMA.B),0,0,c.LUMA.R+a*-c.LUMA.R+b*0.143,c.LUMA.G+a*(1-c.LUMA.G)+b*0.14,c.LUMA.B+a*-c.LUMA.B+b*-0.283,0,0,c.LUMA.R+a*-c.LUMA.R+b*-(1-c.LUMA.R),c.LUMA.G+a*-c.LUMA.G+b*c.LUMA.G,c.LUMA.B+a*(1-c.LUMA.B)+
b*c.LUMA.B,0,0,0,0,0,1,0])},average:function(b,a,d){typeof b=="undefined"&&(b=0.3333);typeof a=="undefined"&&(a=0.3333);typeof d=="undefined"&&(d=0.3334);return this.concat([b,a,d,0,0,b,a,d,0,0,b,a,d,0,0,0,0,0,1,0])},quickContrastCorrection:function(b){typeof b=="undefined"&&(b=1.2);return this.concat([b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0])},quickSepia:function(b,a,d){typeof b=="undefined"&&(b=1);typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);return this.concat([b*0.5,0.5,0.5,0,0,0.33,
a*0.33,0.33,0,0,0.25,0.25,d*0.25,0,0,0,0,0,1,0])},quickSepia2:function(b,a,d){typeof b=="undefined"&&(b=1);typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);return this.concat([b*0.3930000066757202,0.7689999938011169,0.1889999955892563,0,0,0.3490000069141388,a*0.6859999895095825,0.1679999977350235,0,0,0.2720000147819519,0.5339999794960022,d*0.1309999972581863,0,0,0,0,0,1,0])},threshold:function(b,a){typeof a=="undefined"&&(a=256);return this.concat([c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-
1)*b,c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*b,c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*b,0,0,0,1,0])},threshold_rgb:function(b,a){typeof a=="undefined"&&(a=256);return this.concat([a,0,0,0,-(a-1)*b,0,a,0,0,-(a-1)*b,0,0,a,0,-(a-1)*b,0,0,0,1,0])},threshold_alpha:function(b,a){typeof b=="undefined"&&(b=0.5);typeof a=="undefined"&&(a=256);return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,a,-a*b])},blend:function(b,a){var c;if(this.matrix){c=this.matrix;for(var k=b.matrix,e=1-a,g=0,h=new d(20);g<
20;)h[g]=e*c[g]+a*k[g],g++;c=h}else c=new d(b.matrix);this.matrix=c;return this},concat:function(b){var a;if(this.matrix){a=this.matrix;var b=new d(b),c=new d(20),k,e,g,h,l;k=b[0];e=b[1];g=b[2];h=b[3];l=b[4];c[0]=k*a[0]+e*a[5]+g*a[10]+h*a[15];c[1]=k*a[1]+e*a[6]+g*a[11]+h*a[16];c[2]=k*a[2]+e*a[7]+g*a[12]+h*a[17];c[3]=k*a[3]+e*a[8]+g*a[13]+h*a[18];c[4]=k*a[4]+e*a[9]+g*a[14]+h*a[19]+l;k=b[5];e=b[6];g=b[7];h=b[8];l=b[9];c[5]=k*a[0]+e*a[5]+g*a[10]+h*a[15];c[6]=k*a[1]+e*a[6]+g*a[11]+h*a[16];c[7]=k*a[2]+
e*a[7]+g*a[12]+h*a[17];c[8]=k*a[3]+e*a[8]+g*a[13]+h*a[18];c[9]=k*a[4]+e*a[9]+g*a[14]+h*a[19]+l;k=b[10];e=b[11];g=b[12];h=b[13];l=b[14];c[10]=k*a[0]+e*a[5]+g*a[10]+h*a[15];c[11]=k*a[1]+e*a[6]+g*a[11]+h*a[16];c[12]=k*a[2]+e*a[7]+g*a[12]+h*a[17];c[13]=k*a[3]+e*a[8]+g*a[13]+h*a[18];c[14]=k*a[4]+e*a[9]+g*a[14]+h*a[19]+l;k=b[15];e=b[16];g=b[17];h=b[18];l=b[19];c[15]=k*a[0]+e*a[5]+g*a[10]+h*a[15];c[16]=k*a[1]+e*a[6]+g*a[11]+h*a[16];c[17]=k*a[2]+e*a[7]+g*a[12]+h*a[17];c[18]=k*a[3]+e*a[8]+g*a[13]+h*a[18];
c[19]=k*a[4]+e*a[9]+g*a[14]+h*a[19]+l;a=c}else a=new d(b);this.matrix=a;return this},_apply:function(b){if(!this.matrix)return b;for(var a=b.length,d=this.matrix,c=0,e,g,h,l;c<a;)e=b[c],g=b[c+1],h=b[c+2],l=b[c+3],b[c]=d[0]*e+d[1]*g+d[2]*h+d[3]*l+d[4],b[c+1]=d[5]*e+d[6]*g+d[7]*h+d[8]*l+d[9],b[c+2]=d[10]*e+d[11]*g+d[12]*h+d[13]*l+d[14],b[c+3]=d[15]*e+d[16]*g+d[17]*h+d[18]*l+d[19],c+=4;return b},apply:function(b){if(!this.matrix)return b;return b.setData(this._apply(b.getData(),b.width,b.height))},reset:function(){this.matrix=
null;return this}}})(FILTER);
(function(c){function d(a){var b=s.length,d,c;a--;if(a<b)d=s[a].slice();else for(d=new h(s[b-1]);b<=a;){c=d.slice();d=[1];i=0;for(il=c.length-1;i<il;i++)d.push(c[i]+c[i+1]);d.push(1);b<12&&s.push(d.slice());b++}return d}function l(a){var b,d=-(a>>1),c=Array(a);for(b=0;b<a;b++)c[b]=d,d++;return c}function b(a,d){var c,e,g=a.length,h,j=[],k=0;if(typeof a[0].length=="undefined")for(c=0;c<g;c++)for(e=0;e<g;e++)h=a[c]*d[e],k+=h,j.push(h);else for(c=0;c<g;c++)for(e=0;e<g;e++)h=b(a[c],d[e]),k+=h.sum,j=j.concat(h.ker);
return{kernel:j,sum:k}}function a(a){a=d(a);return b(a,a)}function j(a,c){var e=d(a),h=l(a);return 1==c?b(h.reverse(),e):b(e,h)}function k(a,d){var c,e=Array(a);for(c=0;c<a;c++)e[c]=1;c=l(a);return 1==d?b(c.reverse(),e):b(e,c)}function e(a,b,d,c){var e=a.length,g,j=new h(a.length),d=d||1,c=c||1;for(g=0;g<e;g++)j[g]=d*a[g]+c*b[g];return j}function g(a,b){var b=b||1,d=a*a,c,e=new h(d);for(c=0;c<d;c++)e[c]=b;return e}var h=c.Array32F,s=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,
20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],m=c.CONSTANTS.toRad;c.ConvolutionMatrixFilter=function(a,b){this.factor=b||1;typeof a!="undefined"&&a.length?(this.matrix=new h(a),this.dim=~~(Math.sqrt(a.length)+0.5)):(this.matrix=null,this.dim=0);this.auxMatrix=null;this._isGrad=!1};c.ConvolutionMatrixFilter.prototype={lowPass:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(g(a),1/(a*a),a)},highPass:function(a,b){var a=typeof a=="undefined"?3:a%2?a:a+1,c=a*a,d=-(typeof b==
"undefined"?1:b)/c,e=g(a,d);e[c>>2]=1+d;return this.set(e,1,a)},boxBlur:function(a){return this.lowPass(a)},binomialLowPass:function(b){var b=typeof b=="undefined"?3:b%2?b:b+1,c=a(b);return this.set(new h(c.kernel),1/c.sum,b)},binomialHighPass:function(b){var b=typeof b=="undefined"?3:b%2?b:b+1,c=a(b);return this.set(e(g(b),new h(c.kernel),1,-1/c.sum),1,b)},gaussBlur:function(a){return this.binomialLowPass(a)},sharpen:function(a,b){b=typeof b=="undefined"?0.5:b;return b<=0?this.set([0,-2,0,-2,10,
-2,0,-2,0],0.5,3):this.highPass(a,b)},prewittX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=k(a,0);return this.set(new h(b.kernel),1,a)},prewittY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=k(a,1);return this.set(new h(b.kernel),1,a)},prewittDirectional:function(a,b){a=typeof a=="undefined"?3:a%2?a:a+1;b*=m;var c=Math.cos(b),d=Math.sin(b),g=k(a,0),j=k(a,1);return this.set(e(new h(g.kernel),new h(j.kernel),c,d),1,a)},prewitt:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=
k(a,0),c=k(a,1);this.set(new h(b.kernel),1,a);this._isGrad=!0;this.auxMatrix=new h(c.kernel);return this},gradX:function(a){return this.prewittX(a)},gradY:function(a){return this.prewittY(a)},gradDirectional:function(a,b){return this.prewittDirectional(a,b)},grad:function(a){return this.prewitt(a)},sobelX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=j(a,0);return this.set(new h(b.kernel),1,a)},sobelY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=j(a,1);return this.set(new h(b.kernel),
1,a)},sobelDirectional:function(a,b){a=typeof a=="undefined"?3:a%2?a:a+1;b*=m;var c=Math.cos(b),d=Math.sin(b),g=j(a,0),k=j(a,1);return this.set(e(new h(g.kernel),new h(k.kernel),c,d),1,a)},sobel:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=j(a,0),c=j(a,1);this.set(new h(b.kernel),1,a);this.auxMatrix=new h(c.kernel);this._isGrad=!0;return this},laplace:function(){return this.set([0,-1,0,-1,4,-1,0,-1,0],1,3)},emboss:function(a,b){var b=1,c=(typeof a=="undefined"||a!=1&&a!=-1?1:a)*b;return this.set([-c*
2,-c*1,0,-c*1,b*1,c*1,0,c*1,c*2],1,3)},embossHigh:function(){return this.emboss(1)},embossLow:function(){return this.emboss(-1)},edges:function(){return this.set([0,1,0,1,-4,1,0,1,0],1,3)},edges2:function(){return this.set([0,2,0,2,-8,2,0,2,0],0.5,3)},motionblur:function(a){var b=new h(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);if(a==0)for(a=0;a<9;a++)b[36+a]=1;else if(a==2)for(a=
0;a<9;a++)b[9*a+5]=1;else if(a==1)for(a=0;a<9;a++)b[9*a+a]=1;return this.set(b,1/9,9)},set:function(a,b,c){this.matrix=new h(a);this.factor=b;this.dim=c;this.auxMatrix=null;this._isGrad=!1;return this},_apply:function(a,b,d){if(!this.matrix)return a;var e=this.dim,g=e>>1,h=new c.ImArray(a.length),j,k,l,m,r,s=0,q=0,u=0,E=0,H=0,I=0,z,x,B,F,K,L,M,J=Math.abs;for(k=L=0;k<d;k++){for(j=0;j<b;j++){m=k;l=j;r=L+j<<2;for(x=I=H=E=K=u=q=s=0;x<e;x++){z=m+x-g;if(z>=0&&z<d){M=z*b;for(z=0;z<e;z++)B=l+z-g,B>=0&&B<
b&&(B=M+B<<2,F=this.matrix[K+z],s+=a[B]*F,q+=a[B+1]*F,u+=a[B+2]*F,this.auxMatrix&&(F=this.auxMatrix[K+z],E+=a[B]*F,H+=a[B+1]*F,I+=a[B+2]*F))}K+=e}this._isGrad?(h[r]=this.factor*(J(s)+J(E)),h[r+1]=this.factor*(J(q)+J(H)),h[r+2]=this.factor*(J(u)+J(I))):(h[r]=this.factor*s,h[r+1]=this.factor*q,h[r+2]=this.factor*u);h[r+3]=a[r+3]}L+=b}return h},apply:function(a){if(!this.matrix)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this.auxMatrix=this.matrix=null;this.dim=
0;return this}}})(FILTER);
(function(c){c.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3};c.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4};var d=Math.min;c.DisplacementMapFilter=function(c){this.map=c};c.DisplacementMapFilter.prototype={scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:c.MODE.CLAMP,map:null,_apply:function(l,b,a){if(!this.map)return l;var j=this.map.getData(),k=this.map.width,e=this.map.height,g=d(k,b),e=d(e,a),h=this.scaleX*0.00390625,s=this.scaleY*0.00390625,m=this.color>>24&255,t=this.color>>16&
255,w=this.color>>8&255,n=this.color&255,A=~~this.startY,y=~~this.startX,C=this.componentX,p=this.componentY,v=this.mode,o,D,r,G,q,u,E,H,I,z=A*b,x=new c.ImArray(l.length);for(E=I=H=0;E<e;E++){D=E+A;if(D>=0&&D<a)for(u=0;u<g;u++)if(o=u+y,!(o<0||o>=b)){r=I+z+o<<2;G=H+u<<2;q=D+~~((j[G+p]-128)*s);o+=~~((j[G+C]-128)*h);if(q>=a||q<0||o>=b||o<0)switch(v){case c.MODE.IGNORE:continue;case c.MODE.COLOR:x[r]=t;x[r+1]=w;x[r+2]=n;x[r+3]=m;continue;case c.MODE.WRAP:q>=a&&(q-=a);q<0&&(q+=a);o>=b&&(o-=b);o<0&&(o+=
b);break;default:q>=a&&(q=a-1),q<0&&(q=0),o>=b&&(o=b-1),o<0&&(o=0)}q=q*b+o<<2;x[r]=l[q];x[r+1]=l[q+1];x[r+2]=l[q+2];x[r+3]=l[q+3]}H+=k;I+=b}return x},apply:function(c){if(!this.map)return c;return c.setData(this._apply(c.getData(),c.width,c.height))},reset:function(){this.map=null;return this}}})(FILTER);
(function(c){c.NonLinearFilter=function(c){this.func=c;this.isMaximum=this.isMinimum=this.isMedian=!1;this.dim=0};c.NonLinearFilter.prototype={median:function(c){this.isMedian=!0;this.isMaximum=this.isMinimum=!1;this.dim=typeof c=="undefined"?3:c%2?c:c+1;return this},erode:function(c){this.isMedian=!1;this.isMinimum=!0;this.isMaximum=!1;this.dim=typeof c=="undefined"?3:c%2?c:c+1;return this},dilate:function(c){this.isMinimum=this.isMedian=!1;this.isMaximum=!0;this.dim=typeof c=="undefined"?3:c%2?
c:c+1;return this},_apply:function(d,l,b){var a=this.dim,j=a>>1,k=a*a,e=new c.ImArray(d.length),g,h,s,m,t,w,n,A,y,C,p,v,o,D,r,G,q,u;this.isMedian?(p=[],v=[],o=[],q=k%2,u=~~(0.5*k)+q):this.isMaximum?G=r=D=0:this.isMinimum&&(G=r=D=255);if(this.isMedian){for(g=y=0;g<b;g++){for(k=0;k<l;k++){s=g;h=k;m=y+k<<2;p.length=0;v.length=0;for(w=A=o.length=0;w<a;w++){t=s+w-j;if(t>=0&&t<b){C=t*l;for(t=0;t<a;t++)n=h+t-j,n>=0&&n<l&&(n=C+n<<2,p.push(d[n]),v.push(d[n+1]),o.push(d[n+2]))}A+=a}p.sort();v.sort();o.sort();
q?(e[m]=p[u],e[m+1]=v[u],e[m+2]=o[u]):(e[m]=~~(0.5*(p[u]+p[u+1])),e[m+1]=~~(0.5*(v[u]+v[u+1])),e[m+2]=~~(0.5*(o[u]+o[u+1])));e[m+3]=d[m+3]}y+=l}return e}else if(this.isMinimum||this.isMaximum){for(g=y=0;g<b;g++){for(k=0;k<l;k++){s=g;h=k;m=y+k<<2;p=D;v=r;o=G;for(w=A=0;w<a;w++){t=s+w-j;if(t>=0&&t<b){C=t*l;for(t=0;t<a;t++)n=h+t-j,n>=0&&n<l&&(n=C+n<<2,this.isMaximum?(d[n]>p&&(p=d[n]),d[n+1]>v&&(v=d[n+1]),d[n+2]>o&&(o=d[n+2])):(d[n]<p&&(p=d[n]),d[n+1]<v&&(v=d[n+1]),d[n+2]<o&&(o=d[n+2])))}A+=a}e[m]=p;e[m+
1]=v;e[m+2]=o;e[m+3]=d[m+3]}y+=l}return e}return d},apply:function(c){return c.setData(this._apply(c.getData(),c.width,c.height))},reset:function(){this.isMaximum=this.isMinimum=this.isMedian=!1;this.dim=0;return this}}})(FILTER);
