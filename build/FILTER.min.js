/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.3.2.1
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/
var FILTER=FILTER||{};
(function(c){var e,d=Math.min;e={normal:function(b){return b},lighten:function(b,a){return a>b?a:b},darken:function(b,a){return a>b?b:a},multiply:function(b,a){return b*a*0.003921568627451},average:function(b,a){return 0.5*(b+a)},add:function(b,a){return Math.min(255,b+a)},substract:function(b,a){return b+a<255?0:b+a-255},difference:function(b,a){return Math.abs(b-a)},negation:function(b,a){return 255-Math.abs(255-b-a)},screen:function(b,a){return 255-((255-b)*(255-a)>>8)},exclusion:function(b,a){return b+
a-2*b*a*0.003921568627451},overlay:function(b,a){return a<128?2*b*a*0.003921568627451:255-2*(255-b)*(255-a)*0.003921568627451},softLight:function(b,a){return a<128?2*((b>>1)+64)*a*0.003921568627451:255-2*(255-((b>>1)+64))*(255-a)*0.003921568627451},hardLight:function(b,a){return b<128?2*a*b*0.003921568627451:255-2*(255-a)*(255-b)*0.003921568627451},colorDodge:function(b,a){return a==255?a:Math.min(255,(b<<8)/(255-a))},colorBurn:function(b,a){return a==0?a:Math.max(0,255-(255-b<<8)/a)},linearLight:function(b,
a){return a<128?e.linearBurn(b,2*a):e.linearDodge(b,2*(a-128))},vividLight:function(b,a){return a<128?e.colorBurn(b,2*a):e.colorDodge(b,2*(a-128))},pinLight:function(b,a){return a<128?e.darken(b,2*a):e.lighten(b,2*(a-128))},hardMix:function(b,a){return e.vividLight(b,a)<128?0:255},reflect:function(b,a){return a==255?a:Math.min(255,b*b/(255-a))},glow:function(b,a){return b==255?b:Math.min(255,a*a/(255-b))},phoenix:function(b,a){return Math.min(b,a)-Math.max(b,a)+255}};e.linearDodge=e.add;e.linearBurn=
e.substract;c.blendModes=e;c.Image=function(b,a){this.height=this.width=0;this.imageData=this.context=null;this.canvasElement=document.createElement("canvas");this.canvasElement.width=0;this.canvasElement.height=0;this.context=this.canvasElement.getContext("2d");this._integral=this._histogram=null;this._integralRefresh=this._histogramRefresh=!0;this.setImage(b,a)};c.Image.prototype={getData:function(){return new c.ImArray(this.imageData.data)},setData:function(b){this.imageData.data.set(b);this.context.putImageData(this.imageData,
0,0);this._integralRefresh=this._histogramRefresh=!0;return this},getPixelData:function(){return this.imageData},setPixelData:function(b){this.context.putImageData(b,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setWidth:function(b){this.width=b;this.canvasElement.width=this.width;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=
this._histogramRefresh=!0;return this},setHeight:function(b){this.height=b;this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setImage:function(b,a){if(typeof b=="undefined"||b==null)return this;var j=this,c;b instanceof Image||b instanceof HTMLCanvasElement||b instanceof HTMLVideoElement?(c=b,this.width=b.width,this.height=b.height,
this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.context=this.canvasElement.getContext("2d"),this.context.drawImage(c,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._integralRefresh=this._histogramRefresh=!0):(c=new Image,c.onload=function(){j.width=c.width;j.height=c.height;j.canvasElement.width=j.width;j.canvasElement.height=j.height;j.context=j.canvasElement.getContext("2d");j.context.drawImage(c,0,0);j.imageData=j.context.getImageData(0,
0,j.width,j.height);j._histogramRefresh=!0;j._integralRefresh=!0;typeof a!="undefined"&&a.call(j)},c.src=b);c.crossOrigin="";return this},blend:function(b,a,j,c,k){typeof a=="undefined"&&(a="normal");typeof j=="undefined"&&(j=1);j>1&&(j=1);j<0&&(j=0);typeof c=="undefined"&&(c=0);typeof k=="undefined"&&(k=0);var g=0,h=0;c<0&&(g=-c,c=0);k<0&&(h=-k,k=0);if(!(c>=this.width||k>=this.height)){a=e[a];if(a==void 0||a==null)return this;var m=d(this.width,b.width-g),l=d(this.height,b.height-h),t=this.context.getImageData(c,
k,m,l),g=b.context.getImageData(g,h,m,l),b=t.data,g=g.data,w,n,A,y=1-j,C=g.length,p;for(p=0;p<C;p+=4)w=b[p],n=b[p+1],A=b[p+2],h=a(g[p],w),m=a(g[p+1],n),l=a(g[p+2],A),b[p]=h*j+w*y,b[p+1]=m*j+n*y,b[p+2]=l*j+A*y;this.context.putImageData(t,c,k);this._integralRefresh=this._histogramRefresh=!0;return this}},_refresh:function(){this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);return this},clone:function(){return new c.Image(this.canvasElement)},
integral:function(){this._integralRefresh&&this._computeIntegral();return this._integral},_computeIntegral:function(){var b=this.width,a=this.height,j=new c.Array32U(b*a),e=this.getPixelData().data,k,g,h,d,l;for(d=h=g=k=0;k<b;)ii=k+h,l=ii<<2,l=4899*e[l]+9617*e[l+1]+1868*e[l+2]+8192>>>14,d+=(l&255)>>>0,j[ii]=k>0?j[ii-1]+d:d,g++,h+=b,a==g&&(k++,d=h=g=0);this._integral=j;this._integralRefresh=!1},histogram:function(){this._histogramRefresh&&this._computeHistogram();return this._histogram},_computeHistogram:function(){for(var b=
this.getPixelData().data,a=0,j=b.length,e=new c.ImArray(256),k=new c.ImArray(256),g=new c.ImArray(256),h,d,l,a=0;a<256;)e[a]=0,k[a]=0,g[a]=0,a++;for(a=0;a<j;)h=b[a],d=b[a+1],l=b[a+2],e[h]++,k[d]++,g[l]++,a+=4;this._histogram=[e,k,g];this._histogramRefresh=!1},createImageData:function(b,a){this.width=b;this.height=a;this.canvasElement.width=this.width;this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.context.createImageData(b,a);return this.imageData=this.context.getImageData(0,
0,this.width,this.height)},scale:function(){return this}}})(FILTER);
(function(c){c.Color={blend:function(c,d,b){return{red:c.red-~~((c.red-d.red)*b+0.5),green:c.green-~~((c.green-d.green)*b+0.5),blue:c.blue-~~((c.blue-d.blue)*b+0.5)}},distance:function(c,d){var b=c.red-d.red,a=c.green-d.green,j=c.blue-d.blue;return Math.sqrt(b*b+a*a+j*j)},RGBA2Color:function(c){return typeof c.alpha!="undefined"?(c.alpha<<24)+(c.red<<16)+(c.green<<8)+c.blue:(c.red<<16)+(c.green<<8)+c.blue},Color2RGBA:function(c){c=~~c;return{red:c>>16&255,green:c>>8&255,blue:c&255,alpha:c>>24&255}},
RGB2YCbCr:function(c){var d=c.red,b=c.green,c=c.blue;return{Y:~~(0.299*d+0.587*b+0.114*c),Cb:~~(128-0.169*d-0.331*b+0.5*c),Cr:~~(128+0.5*d-0.42*b-0.08*c)}},YCbCr2RGB:function(c){var d=c.Y,b=c.Cb,c=c.Cr;return{red:~~(d+1.4(c-128)),green:~~(d-0.343*(b-128)-0.711*(c-128)),blue:~~(d+1.765*(b-128))}},RGB2HSV:function(c){var d=c.red*0.00392156862745098,b=c.green*0.00392156862745098,a=c.blue*0.00392156862745098,j;j=d<b?d<a?d:a:b<a?b:a;c=d>b?d>a?d:a:b>a?b:a;if(j==c)return{H:NaN,S:0,V:c};d=((d==j?3:b==j?5:
1)-(d==j?b-a:b==j?a-d:d-b)/(c-j))*60;d>=360?d-=360:d<0&&(d+=360);$=(c-j)/c;return{H:d,S:void 0,V:c}}}})(FILTER);
(function(c){c.Array32F=typeof Float32Array!=="undefined"?Float32Array:Array;c.Array64F=typeof Float64Array!=="undefined"?Float64Array:Array;c.Array8I=typeof Int8Array!=="undefined"?Int8Array:Array;c.Array16I=typeof Int16Array!=="undefined"?Int16Array:Array;c.Array32I=typeof Int32Array!=="undefined"?Int32Array:Array;c.Array8U=typeof Uint8Array!=="undefined"?Uint8Array:Array;c.Array16U=typeof Uint16Array!=="undefined"?Uint16Array:Array;c.Array32U=typeof Uint32Array!=="undefined"?Uint32Array:Array;
c.ImArray=typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:c.Array8U;c.CONSTANTS={SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI};c.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3};c.Filter=function(){};c.Filter.prototype={_apply:function(){},apply:function(){},reset:function(){}};c.CompositeFilter=function(b){this._stack=typeof b!="undefined"&&b.length?b:[]};c.CompositeFilter.prototype={_stack:[],_apply:function(b,a,c){if(!this._stack.length)return b;for(var e=this._stack,k=e.length,g=0,h;g<
k;)(h=e[g++])&&(b=h._apply(b,a,c));return b},apply:function(b){if(!this._stack.length)return b;return b.setData(this._apply(im=b.getData(),b.width,b.height))},filters:function(b){if(b)this._stack=b;return this},push:function(b){this._stack.push(b);return this},pop:function(){return this._stack.pop()},shift:function(b){this._stack.shift(b);return this},unshift:function(){return this._stack.unshift()},concat:function(b){return this.push(b)},remove:function(b){for(var a=this._stack.length;--a>=0;)b===
this._stack[a]&&this._stack.splice(a,1);return this},reset:function(){this._stack.length=0;return this}};var e=null,d=null;c.static={createImageData:function(b,a){e||(e=document.createElement("canvas"),d=e.getContext("2d"));return d.createImageData(b,a)}}})(FILTER);
(function(c){c.LUMA={R:0.212671,G:0.71516,B:0.072169};var e=c.Array32F,d=c.CONSTANTS.toRad;c.ColorMatrixFilter=function(b){this.matrix=typeof b!="undefined"&&b.length?new e(b):null};c.ColorMatrixFilter.prototype={channel:function(b,a){var j=(typeof a=="undefined"?0:a)?1:0;switch(b){case c.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case c.CHANNEL.BLUE:return this.concat([0,0,j,0,0,0,0,j,0,0,0,0,1,0,0,0,0,0,0,255]);case c.CHANNEL.GREEN:return this.concat([0,j,0,0,
0,0,1,0,0,0,0,j,0,0,0,0,0,0,0,255]);default:return this.concat([1,0,0,0,0,j,0,0,0,0,j,0,0,0,0,0,0,0,0,255])}},redChannel:function(b){return this.channel(c.CHANNEL.RED,b)},greenChannel:function(b){return this.channel(c.CHANNEL.GREEN,b)},blueChannel:function(b){return this.channel(c.CHANNEL.BLUE,b)},alphaChannel:function(){return this.channel(c.CHANNEL.ALPHA,!0)},swapChannels:function(b,a){switch(b){case c.CHANNEL.ALPHA:switch(a){case c.CHANNEL.ALPHA:return this;case c.CHANNEL.BLUE:return this.concat([1,
0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case c.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);default:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}case c.CHANNEL.BLUE:switch(a){case c.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case c.CHANNEL.BLUE:return this;case c.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);default:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}case c.CHANNEL.GREEN:switch(a){case c.CHANNEL.ALPHA:return this.concat([1,
0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case c.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this;default:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}default:switch(a){case c.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case c.CHANNEL.BLUE:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this}}},
desaturate:function(){return this.concat([c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,0,0,0,1,0])},grayscale:function(){return this.desaturate()},colorize:function(b,a){var j,e,k,g;typeof a=="undefined"&&(a=1);j=(b>>16&255)*0.00392156862745098;e=(b>>8&255)*0.00392156862745098;k=(b&255)*0.00392156862745098;g=1-a;return this.concat([g+a*j*c.LUMA.R,a*j*c.LUMA.G,a*j*c.LUMA.B,0,0,a*e*c.LUMA.R,g+a*e*c.LUMA.G,a*e*c.LUMA.B,0,0,a*k*c.LUMA.R,a*k*c.LUMA.G,g+a*
k*c.LUMA.B,0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},saturate:function(b){var a,j,e;a=1-b;j=a*c.LUMA.R;e=a*c.LUMA.G;a*=c.LUMA.B;return this.concat([j+b,e,a,0,0,j,e+b,a,0,0,j,e,a+b,0,0,0,0,0,1,0])},contrast:function(b,a,c){typeof a=="undefined"&&(a=b);typeof c=="undefined"&&(c=b);b+=1;a+=1;c+=1;return this.concat([b,0,0,0,128*(1-b),0,a,0,0,128*(1-a),0,0,c,0,128*(1-c),0,0,0,1,0])},brightness:function(b,a,c){typeof a=="undefined"&&(a=b);
typeof c=="undefined"&&(c=b);return this.concat([1,0,0,0,b,0,1,0,0,a,0,0,1,0,c,0,0,0,1,0])},adjustHue:function(b){b*=d;var a=Math.cos(b),b=Math.sin(b);return this.concat([c.LUMA.R+a*(1-c.LUMA.R)+b*-c.LUMA.R,c.LUMA.G+a*-c.LUMA.G+b*-c.LUMA.G,c.LUMA.B+a*-c.LUMA.B+b*(1-c.LUMA.B),0,0,c.LUMA.R+a*-c.LUMA.R+b*0.143,c.LUMA.G+a*(1-c.LUMA.G)+b*0.14,c.LUMA.B+a*-c.LUMA.B+b*-0.283,0,0,c.LUMA.R+a*-c.LUMA.R+b*-(1-c.LUMA.R),c.LUMA.G+a*-c.LUMA.G+b*c.LUMA.G,c.LUMA.B+a*(1-c.LUMA.B)+b*c.LUMA.B,0,0,0,0,0,1,0])},average:function(b,
a,c){typeof b=="undefined"&&(b=0.3333);typeof a=="undefined"&&(a=0.3333);typeof c=="undefined"&&(c=0.3334);return this.concat([b,a,c,0,0,b,a,c,0,0,b,a,c,0,0,0,0,0,1,0])},quickContrastCorrection:function(b){typeof b=="undefined"&&(b=1.2);return this.concat([b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0])},quickSepia:function(b,a,c){typeof b=="undefined"&&(b=1);typeof a=="undefined"&&(a=b);typeof c=="undefined"&&(c=b);return this.concat([b*0.5,0.5,0.5,0,0,0.33,a*0.33,0.33,0,0,0.25,0.25,c*0.25,0,0,0,0,0,1,
0])},quickSepia2:function(b,a,c){typeof b=="undefined"&&(b=1);typeof a=="undefined"&&(a=b);typeof c=="undefined"&&(c=b);return this.concat([b*0.3930000066757202,0.7689999938011169,0.1889999955892563,0,0,0.3490000069141388,a*0.6859999895095825,0.1679999977350235,0,0,0.2720000147819519,0.5339999794960022,c*0.1309999972581863,0,0,0,0,0,1,0])},threshold:function(b,a){typeof a=="undefined"&&(a=256);return this.concat([c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*b,c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*
b,c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*b,0,0,0,1,0])},threshold_rgb:function(b,a){typeof a=="undefined"&&(a=256);return this.concat([a,0,0,0,-(a-1)*b,0,a,0,0,-(a-1)*b,0,0,a,0,-(a-1)*b,0,0,0,1,0])},threshold_alpha:function(b,a){typeof b=="undefined"&&(b=0.5);typeof a=="undefined"&&(a=256);return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,a,-a*b])},blend:function(b,a){var c;if(this.matrix){c=this.matrix;for(var d=b.matrix,k=1-a,g=0,h=new e(20);g<20;)h[g]=k*c[g]+a*d[g],g++;c=h}else c=new e(b.matrix);
this.matrix=c;return this},concat:function(b){var a;if(this.matrix){a=this.matrix;var b=new e(b),c=new e(20),d,k,g,h,m;d=b[0];k=b[1];g=b[2];h=b[3];m=b[4];c[0]=d*a[0]+k*a[5]+g*a[10]+h*a[15];c[1]=d*a[1]+k*a[6]+g*a[11]+h*a[16];c[2]=d*a[2]+k*a[7]+g*a[12]+h*a[17];c[3]=d*a[3]+k*a[8]+g*a[13]+h*a[18];c[4]=d*a[4]+k*a[9]+g*a[14]+h*a[19]+m;d=b[5];k=b[6];g=b[7];h=b[8];m=b[9];c[5]=d*a[0]+k*a[5]+g*a[10]+h*a[15];c[6]=d*a[1]+k*a[6]+g*a[11]+h*a[16];c[7]=d*a[2]+k*a[7]+g*a[12]+h*a[17];c[8]=d*a[3]+k*a[8]+g*a[13]+h*a[18];
c[9]=d*a[4]+k*a[9]+g*a[14]+h*a[19]+m;d=b[10];k=b[11];g=b[12];h=b[13];m=b[14];c[10]=d*a[0]+k*a[5]+g*a[10]+h*a[15];c[11]=d*a[1]+k*a[6]+g*a[11]+h*a[16];c[12]=d*a[2]+k*a[7]+g*a[12]+h*a[17];c[13]=d*a[3]+k*a[8]+g*a[13]+h*a[18];c[14]=d*a[4]+k*a[9]+g*a[14]+h*a[19]+m;d=b[15];k=b[16];g=b[17];h=b[18];m=b[19];c[15]=d*a[0]+k*a[5]+g*a[10]+h*a[15];c[16]=d*a[1]+k*a[6]+g*a[11]+h*a[16];c[17]=d*a[2]+k*a[7]+g*a[12]+h*a[17];c[18]=d*a[3]+k*a[8]+g*a[13]+h*a[18];c[19]=d*a[4]+k*a[9]+g*a[14]+h*a[19]+m;a=c}else a=new e(b);
this.matrix=a;return this},_apply:function(b){if(!this.matrix)return b;for(var a=b.length,c=this.matrix,d=0,e,g,h,m;d<a;)e=b[d],g=b[d+1],h=b[d+2],m=b[d+3],b[d]=c[0]*e+c[1]*g+c[2]*h+c[3]*m+c[4],b[d+1]=c[5]*e+c[6]*g+c[7]*h+c[8]*m+c[9],b[d+2]=c[10]*e+c[11]*g+c[12]*h+c[13]*m+c[14],b[d+3]=c[15]*e+c[16]*g+c[17]*h+c[18]*m+c[19],d+=4;return b},apply:function(b){if(!this.matrix)return b;return b.setData(this._apply(b.getData(),b.width,b.height))},reset:function(){this.matrix=null;return this}}})(FILTER);
(function(c){function e(a){var b=m.length,c,d;a--;if(a<b)c=m[a].slice();else for(c=new h(m[b-1]);b<=a;){d=c.slice();c=[1];i=0;for(il=d.length-1;i<il;i++)c.push(d[i]+d[i+1]);c.push(1);b<12&&m.push(c.slice());b++}return c}function d(a){var b,c=-(a>>1),d=Array(a);for(b=0;b<a;b++)d[b]=c,c++;return d}function b(a,c){var d,e,g=a.length,h,j=[],k=0;if(typeof a[0].length=="undefined")for(d=0;d<g;d++)for(e=0;e<g;e++)h=a[d]*c[e],k+=h,j.push(h);else for(d=0;d<g;d++)for(e=0;e<g;e++)h=b(a[d],c[e]),k+=h.sum,j=j.concat(h.ker);
return{kernel:j,sum:k}}function a(a){a=e(a);return b(a,a)}function j(a,c){var h=e(a),g=d(a);return 1==c?b(g.reverse(),h):b(h,g)}function q(a,c){var e,h=Array(a);for(e=0;e<a;e++)h[e]=1;e=d(a);return 1==c?b(e.reverse(),h):b(h,e)}function k(a,b,c,d){var e=a.length,g,j=new h(a.length),c=c||1,d=d||1;for(g=0;g<e;g++)j[g]=c*a[g]+d*b[g];return j}function g(a,b){var b=b||1,c=a*a,d,e=new h(c);for(d=0;d<c;d++)e[d]=b;return e}var h=c.Array32F,m=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,
20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],l=c.CONSTANTS.toRad;c.ConvolutionMatrixFilter=function(a,b){this.factor=b||1;typeof a!="undefined"&&a.length?(this.matrix=new h(a),this.dim=~~(Math.sqrt(a.length)+0.5)):(this.matrix=null,this.dim=0);this.auxMatrix=null;this._isGrad=!1};c.ConvolutionMatrixFilter.prototype={lowPass:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(g(a),1/(a*a),a)},highPass:function(a,b){var a=typeof a=="undefined"?3:a%2?a:a+1,c=a*a,d=-(typeof b==
"undefined"?1:b)/c,e=g(a,d);e[c>>2]=1+d;return this.set(e,1,a)},boxBlur:function(a){return this.lowPass(a)},binomialLowPass:function(b){var b=typeof b=="undefined"?3:b%2?b:b+1,c=a(b);return this.set(new h(c.kernel),1/c.sum,b)},binomialHighPass:function(b){var b=typeof b=="undefined"?3:b%2?b:b+1,c=a(b);return this.set(k(g(b),new h(c.kernel),1,-1/c.sum),1,b)},gaussBlur:function(a){return this.binomialLowPass(a)},sharpen:function(a,b){b=typeof b=="undefined"?0.5:b;return b<=0?this.set([0,-2,0,-2,10,
-2,0,-2,0],0.5,3):this.highPass(a,b)},prewittX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=q(a,0);return this.set(new h(b.kernel),1,a)},prewittY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=q(a,1);return this.set(new h(b.kernel),1,a)},prewittDirectional:function(a,b){a=typeof a=="undefined"?3:a%2?a:a+1;b*=l;var c=Math.cos(b),d=Math.sin(b),e=q(a,0),g=q(a,1);return this.set(k(new h(e.kernel),new h(g.kernel),c,d),1,a)},prewitt:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=
q(a,0),c=q(a,1);this.set(new h(b.kernel),1,a);this._isGrad=!0;this.auxMatrix=new h(c.kernel);return this},gradX:function(a){return this.prewittX(a)},gradY:function(a){return this.prewittY(a)},gradDirectional:function(a,b){return this.prewittDirectional(a,b)},grad:function(a){return this.prewitt(a)},sobelX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=j(a,0);return this.set(new h(b.kernel),1,a)},sobelY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=j(a,1);return this.set(new h(b.kernel),
1,a)},sobelDirectional:function(a,b){a=typeof a=="undefined"?3:a%2?a:a+1;b*=l;var c=Math.cos(b),d=Math.sin(b),e=j(a,0),g=j(a,1);return this.set(k(new h(e.kernel),new h(g.kernel),c,d),1,a)},sobel:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=j(a,0),c=j(a,1);this.set(new h(b.kernel),1,a);this.auxMatrix=new h(c.kernel);this._isGrad=!0;return this},laplace:function(){return this.set([0,-1,0,-1,4,-1,0,-1,0],1,3)},emboss:function(a,b){var b=1,c=(typeof a=="undefined"||a!=1&&a!=-1?1:a)*b;return this.set([-c*
2,-c*1,0,-c*1,b*1,c*1,0,c*1,c*2],1,3)},embossHigh:function(){return this.emboss(1)},embossLow:function(){return this.emboss(-1)},edges:function(){return this.set([0,1,0,1,-4,1,0,1,0],1,3)},edges2:function(){return this.set([0,2,0,2,-8,2,0,2,0],0.5,3)},motionblur:function(a){var b=new h(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);if(a==0)for(a=0;a<9;a++)b[36+a]=1;else if(a==2)for(a=
0;a<9;a++)b[9*a+5]=1;else if(a==1)for(a=0;a<9;a++)b[9*a+a]=1;return this.set(b,1/9,9)},set:function(a,b,c){this.matrix=new h(a);this.factor=b;this.dim=c;this.auxMatrix=null;this._isGrad=!1;return this},_apply:function(a,b,d){if(!this.matrix)return a;var e=this.dim,g=e>>1,h=new c.ImArray(a.length),j,k,l,m,s,q=0,r=0,u=0,E=0,H=0,I=0,z,x,B,F,K,L,M,J=Math.abs;for(k=L=0;k<d;k++){for(j=0;j<b;j++){m=k;l=j;s=L+j<<2;for(x=I=H=E=K=u=r=q=0;x<e;x++){z=m+x-g;if(z>=0&&z<d){M=z*b;for(z=0;z<e;z++)B=l+z-g,B>=0&&B<
b&&(B=M+B<<2,F=this.matrix[K+z],q+=a[B]*F,r+=a[B+1]*F,u+=a[B+2]*F,this.auxMatrix&&(F=this.auxMatrix[K+z],E+=a[B]*F,H+=a[B+1]*F,I+=a[B+2]*F))}K+=e}this._isGrad?(h[s]=this.factor*(J(q)+J(E)),h[s+1]=this.factor*(J(r)+J(H)),h[s+2]=this.factor*(J(u)+J(I))):(h[s]=this.factor*q,h[s+1]=this.factor*r,h[s+2]=this.factor*u);h[s+3]=a[s+3]}L+=b}return h},apply:function(a){if(!this.matrix)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this.auxMatrix=this.matrix=null;this.dim=
0;return this}}})(FILTER);
(function(c){c.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4};var e=Math.min;c.DisplacementMapFilter=function(c){this.map=c};c.DisplacementMapFilter.prototype={scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:c.MODE.CLAMP,map:null,_apply:function(d,b,a){if(!this.map)return d;var j=this.map.getData(),q=this.map.width,k=this.map.height,g=e(q,b),k=e(k,a),h=this.scaleX*0.00390625,m=this.scaleY*0.00390625,l=this.color>>24&255,t=this.color>>16&255,w=this.color>>8&255,n=this.color&255,
A=~~this.startY,y=~~this.startX,C=this.componentX,p=this.componentY,v=this.mode,o,D,s,G,r,u,E,H,I,z=A*b,x=new c.ImArray(d.length);for(E=I=H=0;E<k;E++){D=E+A;if(D>=0&&D<a)for(u=0;u<g;u++)if(o=u+y,!(o<0||o>=b)){s=I+z+o<<2;G=H+u<<2;r=D+~~((j[G+p]-128)*m);o+=~~((j[G+C]-128)*h);if(r>=a||r<0||o>=b||o<0)switch(v){case c.MODE.IGNORE:continue;case c.MODE.COLOR:x[s]=t;x[s+1]=w;x[s+2]=n;x[s+3]=l;continue;case c.MODE.WRAP:r>=a&&(r-=a);r<0&&(r+=a);o>=b&&(o-=b);o<0&&(o+=b);break;default:r>=a&&(r=a-1),r<0&&(r=0),
o>=b&&(o=b-1),o<0&&(o=0)}r=r*b+o<<2;x[s]=d[r];x[s+1]=d[r+1];x[s+2]=d[r+2];x[s+3]=d[r+3]}H+=q;I+=b}return x},apply:function(c){if(!this.map)return c;return c.setData(this._apply(c.getData(),c.width,c.height))},reset:function(){this.map=null;return this}}})(FILTER);
(function(c){c.NonLinearFilter=function(c){this.func=c;this.isMaximum=this.isMinimum=this.isMedian=!1;this.dim=0};c.NonLinearFilter.prototype={median:function(c){this.isMedian=!0;this.isMaximum=this.isMinimum=!1;this.dim=typeof c=="undefined"?3:c%2?c:c+1;return this},erode:function(c){this.isMedian=!1;this.isMinimum=!0;this.isMaximum=!1;this.dim=typeof c=="undefined"?3:c%2?c:c+1;return this},dilate:function(c){this.isMinimum=this.isMedian=!1;this.isMaximum=!0;this.dim=typeof c=="undefined"?3:c%2?
c:c+1;return this},_apply:function(e,d,b){var a=this.dim,j=a>>1,q=a*a,k=new c.ImArray(e.length),g,h,m,l,t,w,n,A,y,C,p,v,o,D,s,G,r,u;this.isMedian?(p=[],v=[],o=[],r=q%2,u=~~(0.5*q)+r):this.isMaximum?G=s=D=0:this.isMinimum&&(G=s=D=255);if(this.isMedian){for(g=y=0;g<b;g++){for(q=0;q<d;q++){m=g;h=q;l=y+q<<2;p.length=0;v.length=0;for(w=A=o.length=0;w<a;w++){t=m+w-j;if(t>=0&&t<b){C=t*d;for(t=0;t<a;t++)n=h+t-j,n>=0&&n<d&&(n=C+n<<2,p.push(e[n]),v.push(e[n+1]),o.push(e[n+2]))}A+=a}p.sort();v.sort();o.sort();
r?(k[l]=p[u],k[l+1]=v[u],k[l+2]=o[u]):(k[l]=~~(0.5*(p[u]+p[u+1])),k[l+1]=~~(0.5*(v[u]+v[u+1])),k[l+2]=~~(0.5*(o[u]+o[u+1])));k[l+3]=e[l+3]}y+=d}return k}else if(this.isMinimum||this.isMaximum){for(g=y=0;g<b;g++){for(q=0;q<d;q++){m=g;h=q;l=y+q<<2;p=D;v=s;o=G;for(w=A=0;w<a;w++){t=m+w-j;if(t>=0&&t<b){C=t*d;for(t=0;t<a;t++)n=h+t-j,n>=0&&n<d&&(n=C+n<<2,this.isMaximum?(e[n]>p&&(p=e[n]),e[n+1]>v&&(v=e[n+1]),e[n+2]>o&&(o=e[n+2])):(e[n]<p&&(p=e[n]),e[n+1]<v&&(v=e[n+1]),e[n+2]<o&&(o=e[n+2])))}A+=a}k[l]=p;k[l+
1]=v;k[l+2]=o;k[l+3]=e[l+3]}y+=d}return k}return e},apply:function(c){return c.setData(this._apply(c.getData(),c.width,c.height))},reset:function(){this.isMaximum=this.isMinimum=this.isMedian=!1;this.dim=0;return this}}})(FILTER);
