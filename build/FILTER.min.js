/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.3.3
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/var FILTER=FILTER||{};
(function(c){var l,e=Math.min;l={normal:function(d){return d},lighten:function(d,a){return a>d?a:d},darken:function(d,a){return a>d?d:a},multiply:function(d,a){return d*a*0.003921568627451},average:function(d,a){return 0.5*(d+a)},add:function(d,a){return Math.min(255,d+a)},substract:function(d,a){return d+a<255?0:d+a-255},difference:function(d,a){return Math.abs(d-a)},negation:function(d,a){return 255-Math.abs(255-d-a)},screen:function(d,a){return 255-((255-d)*(255-a)>>8)},exclusion:function(d,a){return d+
a-2*d*a*0.003921568627451},overlay:function(d,a){return a<128?2*d*a*0.003921568627451:255-2*(255-d)*(255-a)*0.003921568627451},softLight:function(d,a){return a<128?2*((d>>1)+64)*a*0.003921568627451:255-2*(255-((d>>1)+64))*(255-a)*0.003921568627451},hardLight:function(d,a){return d<128?2*a*d*0.003921568627451:255-2*(255-a)*(255-d)*0.003921568627451},colorDodge:function(d,a){return a==255?a:Math.min(255,(d<<8)/(255-a))},colorBurn:function(d,a){return a==0?a:Math.max(0,255-(255-d<<8)/a)},linearLight:function(d,
a){return a<128?l.linearBurn(d,2*a):l.linearDodge(d,2*(a-128))},vividLight:function(d,a){return a<128?l.colorBurn(d,2*a):l.colorDodge(d,2*(a-128))},pinLight:function(d,a){return a<128?l.darken(d,2*a):l.lighten(d,2*(a-128))},hardMix:function(d,a){return l.vividLight(d,a)<128?0:255},reflect:function(d,a){return a==255?a:Math.min(255,d*d/(255-a))},glow:function(d,a){return d==255?d:Math.min(255,a*a/(255-d))},phoenix:function(d,a){return Math.min(d,a)-Math.max(d,a)+255}};l.linearDodge=l.add;l.linearBurn=
l.substract;c.blendModes=l;c.Image=function(d,a){this.height=this.width=0;this.imageData=this.context=null;this.canvasElement=document.createElement("canvas");this.canvasElement.width=0;this.canvasElement.height=0;this.context=this.canvasElement.getContext("2d");this._integral=this._histogram=null;this._integralRefresh=this._histogramRefresh=!0;this.setImage(d,a)};c.Image.prototype={getPixel:function(d,a){var k=~~(a*this.width+d+0.5);return{red:this.imageData.data[k],green:this.imageData.data[k+1],
blue:this.imageData.data[k+2],alpha:this.imageData.data[k+3]}},setPixel:function(d,a,k,l,j,m){this.context.putImageData(new c.ImArray([k,l,j,m]),d,a);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},getData:function(){return new c.ImArray(this.imageData.data)},setData:function(d){this.imageData.data.set(d);this.context.putImageData(this.imageData,0,0);this._integralRefresh=this._histogramRefresh=!0;return this},getPixelData:function(){return this.imageData},
setPixelData:function(d){this.context.putImageData(d,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setWidth:function(d){this.width=d;this.canvasElement.width=this.width;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setHeight:function(d){this.height=d;this.canvasElement.height=this.height;
this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setImage:function(d,a){if(typeof d=="undefined"||d==null)return this;var k=this,c;d instanceof Image||d instanceof HTMLCanvasElement||d instanceof HTMLVideoElement?(c=d,this.width=d.width,this.height=d.height,this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.context=this.canvasElement.getContext("2d"),
this.context.drawImage(c,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._integralRefresh=this._histogramRefresh=!0):(c=new Image,c.onload=function(){k.width=c.width;k.height=c.height;k.canvasElement.width=k.width;k.canvasElement.height=k.height;k.context=k.canvasElement.getContext("2d");k.context.drawImage(c,0,0);k.imageData=k.context.getImageData(0,0,k.width,k.height);k._histogramRefresh=!0;k._integralRefresh=!0;typeof a!="undefined"&&a.call(k)},c.src=d);c.crossOrigin=
"";return this},blend:function(d,a,k,c,j){typeof a=="undefined"&&(a="normal");typeof k=="undefined"&&(k=1);k>1&&(k=1);k<0&&(k=0);typeof c=="undefined"&&(c=0);typeof j=="undefined"&&(j=0);var m=0,h=0;c<0&&(m=-c,c=0);j<0&&(h=-j,j=0);if(!(c>=this.width||j>=this.height)){a=l[a];if(a==void 0||a==null)return this;var o=e(this.width,d.width-m),p=e(this.height,d.height-h),D=this.context.getImageData(c,j,o,p),m=d.context.getImageData(m,h,o,p),d=D.data,m=m.data,A,s,q,w=1-k,n=m.length,v;for(v=0;v<n;v+=4)A=d[v],
s=d[v+1],q=d[v+2],h=a(m[v],A),o=a(m[v+1],s),p=a(m[v+2],q),d[v]=h*k+A*w,d[v+1]=o*k+s*w,d[v+2]=p*k+q*w;this.context.putImageData(D,c,j);this._integralRefresh=this._histogramRefresh=!0;return this}},_refresh:function(){this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);return this},clone:function(){return new c.Image(this.canvasElement)},integral:function(){this._integralRefresh&&this._computeIntegral();return this._integral},_computeIntegral:function(){var d=
this.width,a=this.height,k=new c.Array32U(d*a),l=this.getPixelData().data,j,m,h,e,p;for(e=h=m=j=0;j<d;)ii=j+h,p=ii<<2,p=4899*l[p]+9617*l[p+1]+1868*l[p+2]+8192>>>14,e+=(p&255)>>>0,k[ii]=j>0?k[ii-1]+e:e,m++,h+=d,a==m&&(j++,e=h=m=0);this._integral=k;this._integralRefresh=!1},histogram:function(){this._histogramRefresh&&this._computeHistogram();return this._histogram},_computeHistogram:function(){for(var d=this.getPixelData().data,a=0,k=d.length,l=new c.ImArray(256),j=new c.ImArray(256),e=new c.ImArray(256),
h,o,p,a=0;a<256;)l[a]=0,j[a]=0,e[a]=0,a++;for(a=0;a<k;)h=d[a],o=d[a+1],p=d[a+2],l[h]++,j[o]++,e[p]++,a+=4;this._histogram=[l,j,e];this._histogramRefresh=!1},createImageData:function(d,a){this.width=d;this.height=a;this.canvasElement.width=this.width;this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.context.createImageData(d,a);return this.imageData=this.context.getImageData(0,0,this.width,this.height)},scale:function(){return this}}})(FILTER);
(function(c){c.Color={blend:function(c,e,d){return{red:c.red-~~((c.red-e.red)*d+0.5),green:c.green-~~((c.green-e.green)*d+0.5),blue:c.blue-~~((c.blue-e.blue)*d+0.5)}},distance:function(c,e){var d=c.red-e.red,a=c.green-e.green,k=c.blue-e.blue;return Math.sqrt(d*d+a*a+k*k)},RGBA2Color:function(c){return typeof c.alpha!="undefined"?(c.alpha<<24)+(c.red<<16)+(c.green<<8)+c.blue:(c.red<<16)+(c.green<<8)+c.blue},Color2RGBA:function(c){c=~~c;return{red:c>>16&255,green:c>>8&255,blue:c&255,alpha:c>>24&255}},
RGB2YCbCr:function(c){var e=c.red,d=c.green,c=c.blue;return{Y:~~(0.299*e+0.587*d+0.114*c),Cb:~~(128-0.169*e-0.331*d+0.5*c),Cr:~~(128+0.5*e-0.42*d-0.08*c)}},YCbCr2RGB:function(c){var e=c.Y,d=c.Cb,c=c.Cr;return{red:~~(e+1.4*(c-128)),green:~~(e-0.343*(d-128)-0.711*(c-128)),blue:~~(e+1.765*(d-128))}},RGB2HSV:function(c){var e=c.red*0.00392156862745098,d=c.green*0.00392156862745098,a=c.blue*0.00392156862745098,k;k=e<d?e<a?e:a:d<a?d:a;c=e>d?e>a?e:a:d>a?d:a;if(k==c)return{H:NaN,S:0,V:c};e=((e==k?3:d==k?
5:1)-(e==k?d-a:d==k?a-e:e-d)/(c-k))*60;e>=360?e-=360:e<0&&(e+=360);$=(c-k)/c;return{H:e,S:void 0,V:c}}}})(FILTER);
(function(c){function l(a,d){var a=a||{},c;for(c in d)d&&Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c]);return a}c.Array32F=typeof Float32Array!=="undefined"?Float32Array:Array;c.Array64F=typeof Float64Array!=="undefined"?Float64Array:Array;c.Array8I=typeof Int8Array!=="undefined"?Int8Array:Array;c.Array16I=typeof Int16Array!=="undefined"?Int16Array:Array;c.Array32I=typeof Int32Array!=="undefined"?Int32Array:Array;c.Array8U=typeof Uint8Array!=="undefined"?Uint8Array:Array;c.Array16U=typeof Uint16Array!==
"undefined"?Uint16Array:Array;c.Array32U=typeof Uint32Array!=="undefined"?Uint32Array:Array;c.ImArray=typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:c.Array8U;c.CONSTANTS={SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI};c.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3};c.Filter=function(){};c.Filter.prototype={_apply:function(){},apply:function(){},reset:function(){}};c.CompositeFilter=function(a){this._stack=typeof a!="undefined"&&a.length?a:[]};c.CompositeFilter.prototype={_stack:[],_apply:function(a,
d,c){if(!this._stack.length)return a;for(var j=this._stack,e=j.length,h=0,l;h<e;)(l=j[h++])&&(a=l._apply(a,d,c));return a},apply:function(a){if(!this._stack.length)return a;return a.setData(this._apply(im=a.getData(),a.width,a.height))},filters:function(a){if(a)this._stack=a;return this},push:function(a){this._stack.push(a);return this},pop:function(){return this._stack.pop()},shift:function(a){this._stack.shift(a);return this},unshift:function(){return this._stack.unshift()},concat:function(a){return this.push(a)},
remove:function(a){for(var d=this._stack.length;--d>=0;)a===this._stack[d]&&this._stack.splice(d,1);return this},reset:function(){this._stack.length=0;return this}};var e=null,d=null;c.static={createImageData:function(a,c){e||(e=document.createElement("canvas"),d=e.getContext("2d"));return d.createImageData(a,c)}};c.Create=function(a){var d=function(){this.init.apply(this,Array.prototype.slice.call(arguments))},a=l({init:function(){},reset:function(){return this},apply:function(a){return a}},a);a._apply=
a.apply;a.apply=function(a){return a.setData(this._apply(a.getData(),a.width,a.height))};d.prototype=l(d.prototype,a);return d}})(FILTER);(function(c){c.CustomFilter=function(c){this._handler=c};c.CustomFilter.prototype={_handler:null,_apply:function(c,e,d){if(!this._handler)return c;return this._handler.call(this,c,e,d)},apply:function(c){if(!this._handler)return c;return c.setData(this._handler.call(this,c.getData(),c.width,c.height))}}})(FILTER);
(function(c){c.LUMA={R:0.212671,G:0.71516,B:0.072169};var l=c.Array32F,e=c.CONSTANTS.toRad;c.ColorMatrixFilter=function(d){this.matrix=typeof d!="undefined"&&d.length?new l(d):null};c.ColorMatrixFilter.prototype={channel:function(d,a){var k=(typeof a=="undefined"?0:a)?1:0;switch(d){case c.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case c.CHANNEL.BLUE:return this.concat([0,0,k,0,0,0,0,k,0,0,0,0,1,0,0,0,0,0,0,255]);case c.CHANNEL.GREEN:return this.concat([0,k,0,0,
0,0,1,0,0,0,0,k,0,0,0,0,0,0,0,255]);default:return this.concat([1,0,0,0,0,k,0,0,0,0,k,0,0,0,0,0,0,0,0,255])}},redChannel:function(d){return this.channel(c.CHANNEL.RED,d)},greenChannel:function(d){return this.channel(c.CHANNEL.GREEN,d)},blueChannel:function(d){return this.channel(c.CHANNEL.BLUE,d)},alphaChannel:function(){return this.channel(c.CHANNEL.ALPHA,!0)},swapChannels:function(d,a){switch(d){case c.CHANNEL.ALPHA:switch(a){case c.CHANNEL.ALPHA:return this;case c.CHANNEL.BLUE:return this.concat([1,
0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case c.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);default:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}case c.CHANNEL.BLUE:switch(a){case c.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case c.CHANNEL.BLUE:return this;case c.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);default:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}case c.CHANNEL.GREEN:switch(a){case c.CHANNEL.ALPHA:return this.concat([1,
0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case c.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this;default:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}default:switch(a){case c.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case c.CHANNEL.BLUE:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this}}},
desaturate:function(){return this.concat([c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,c.LUMA.R,c.LUMA.G,c.LUMA.B,0,0,0,0,0,1,0])},grayscale:function(){return this.desaturate()},colorize:function(d,a){var k,e,j,m;typeof a=="undefined"&&(a=1);k=(d>>16&255)*0.00392156862745098;e=(d>>8&255)*0.00392156862745098;j=(d&255)*0.00392156862745098;m=1-a;return this.concat([m+a*k*c.LUMA.R,a*k*c.LUMA.G,a*k*c.LUMA.B,0,0,a*e*c.LUMA.R,m+a*e*c.LUMA.G,a*e*c.LUMA.B,0,0,a*j*c.LUMA.R,a*j*c.LUMA.G,m+a*
j*c.LUMA.B,0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},saturate:function(d){var a,k,e;a=1-d;k=a*c.LUMA.R;e=a*c.LUMA.G;a*=c.LUMA.B;return this.concat([k+d,e,a,0,0,k,e+d,a,0,0,k,e,a+d,0,0,0,0,0,1,0])},contrast:function(d,a,c){typeof a=="undefined"&&(a=d);typeof c=="undefined"&&(c=d);d+=1;a+=1;c+=1;return this.concat([d,0,0,0,128*(1-d),0,a,0,0,128*(1-a),0,0,c,0,128*(1-c),0,0,0,1,0])},brightness:function(d,a,c){typeof a=="undefined"&&(a=d);
typeof c=="undefined"&&(c=d);return this.concat([1,0,0,0,d,0,1,0,0,a,0,0,1,0,c,0,0,0,1,0])},adjustHue:function(d){d*=e;var a=Math.cos(d),d=Math.sin(d);return this.concat([c.LUMA.R+a*(1-c.LUMA.R)+d*-c.LUMA.R,c.LUMA.G+a*-c.LUMA.G+d*-c.LUMA.G,c.LUMA.B+a*-c.LUMA.B+d*(1-c.LUMA.B),0,0,c.LUMA.R+a*-c.LUMA.R+d*0.143,c.LUMA.G+a*(1-c.LUMA.G)+d*0.14,c.LUMA.B+a*-c.LUMA.B+d*-0.283,0,0,c.LUMA.R+a*-c.LUMA.R+d*-(1-c.LUMA.R),c.LUMA.G+a*-c.LUMA.G+d*c.LUMA.G,c.LUMA.B+a*(1-c.LUMA.B)+d*c.LUMA.B,0,0,0,0,0,1,0])},average:function(d,
a,c){typeof d=="undefined"&&(d=0.3333);typeof a=="undefined"&&(a=0.3333);typeof c=="undefined"&&(c=0.3334);return this.concat([d,a,c,0,0,d,a,c,0,0,d,a,c,0,0,0,0,0,1,0])},quickContrastCorrection:function(d){typeof d=="undefined"&&(d=1.2);return this.concat([d,0,0,0,0,0,d,0,0,0,0,0,d,0,0,0,0,0,1,0])},quickSepia:function(d,a,c){typeof d=="undefined"&&(d=1);typeof a=="undefined"&&(a=d);typeof c=="undefined"&&(c=d);return this.concat([d*0.5,0.5,0.5,0,0,0.33,a*0.33,0.33,0,0,0.25,0.25,c*0.25,0,0,0,0,0,1,
0])},quickSepia2:function(d,a,c){typeof d=="undefined"&&(d=1);typeof a=="undefined"&&(a=d);typeof c=="undefined"&&(c=d);return this.concat([d*0.3930000066757202,0.7689999938011169,0.1889999955892563,0,0,0.3490000069141388,a*0.6859999895095825,0.1679999977350235,0,0,0.2720000147819519,0.5339999794960022,c*0.1309999972581863,0,0,0,0,0,1,0])},threshold:function(d,a){typeof a=="undefined"&&(a=256);return this.concat([c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*d,c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*
d,c.LUMA.R*a,c.LUMA.G*a,c.LUMA.B*a,0,-(a-1)*d,0,0,0,1,0])},threshold_rgb:function(d,a){typeof a=="undefined"&&(a=256);return this.concat([a,0,0,0,-(a-1)*d,0,a,0,0,-(a-1)*d,0,0,a,0,-(a-1)*d,0,0,0,1,0])},threshold_alpha:function(d,a){typeof d=="undefined"&&(d=0.5);typeof a=="undefined"&&(a=256);return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,a,-a*d])},blend:function(d,a){var c;if(this.matrix){c=this.matrix;for(var e=d.matrix,j=1-a,m=0,h=new l(20);m<20;)h[m]=j*c[m]+a*e[m],m++;c=h}else c=new l(d.matrix);
this.matrix=c;return this},concat:function(d){var a;if(this.matrix){a=this.matrix;var d=new l(d),c=new l(20),e,j,m,h,o;e=d[0];j=d[1];m=d[2];h=d[3];o=d[4];c[0]=e*a[0]+j*a[5]+m*a[10]+h*a[15];c[1]=e*a[1]+j*a[6]+m*a[11]+h*a[16];c[2]=e*a[2]+j*a[7]+m*a[12]+h*a[17];c[3]=e*a[3]+j*a[8]+m*a[13]+h*a[18];c[4]=e*a[4]+j*a[9]+m*a[14]+h*a[19]+o;e=d[5];j=d[6];m=d[7];h=d[8];o=d[9];c[5]=e*a[0]+j*a[5]+m*a[10]+h*a[15];c[6]=e*a[1]+j*a[6]+m*a[11]+h*a[16];c[7]=e*a[2]+j*a[7]+m*a[12]+h*a[17];c[8]=e*a[3]+j*a[8]+m*a[13]+h*a[18];
c[9]=e*a[4]+j*a[9]+m*a[14]+h*a[19]+o;e=d[10];j=d[11];m=d[12];h=d[13];o=d[14];c[10]=e*a[0]+j*a[5]+m*a[10]+h*a[15];c[11]=e*a[1]+j*a[6]+m*a[11]+h*a[16];c[12]=e*a[2]+j*a[7]+m*a[12]+h*a[17];c[13]=e*a[3]+j*a[8]+m*a[13]+h*a[18];c[14]=e*a[4]+j*a[9]+m*a[14]+h*a[19]+o;e=d[15];j=d[16];m=d[17];h=d[18];o=d[19];c[15]=e*a[0]+j*a[5]+m*a[10]+h*a[15];c[16]=e*a[1]+j*a[6]+m*a[11]+h*a[16];c[17]=e*a[2]+j*a[7]+m*a[12]+h*a[17];c[18]=e*a[3]+j*a[8]+m*a[13]+h*a[18];c[19]=e*a[4]+j*a[9]+m*a[14]+h*a[19]+o;a=c}else a=new l(d);
this.matrix=a;return this},_apply:function(d){if(!this.matrix)return d;for(var a=d.length,c=this.matrix,e=0,j,m,h,l;e<a;)j=d[e],m=d[e+1],h=d[e+2],l=d[e+3],d[e]=c[0]*j+c[1]*m+c[2]*h+c[3]*l+c[4],d[e+1]=c[5]*j+c[6]*m+c[7]*h+c[8]*l+c[9],d[e+2]=c[10]*j+c[11]*m+c[12]*h+c[13]*l+c[14],d[e+3]=c[15]*j+c[16]*m+c[17]*h+c[18]*l+c[19],e+=4;return d},apply:function(c){if(!this.matrix)return c;return c.setData(this._apply(c.getData(),c.width,c.height))},reset:function(){this.matrix=null;return this}}})(FILTER);
(function(c){function l(a){var c=o.length,d,e;a--;if(a<c)d=o[a].slice();else for(d=new h(o[c-1]);c<=a;){e=d.slice();d=[1];i=0;for(il=e.length-1;i<il;i++)d.push(e[i]+e[i+1]);d.push(1);c<12&&o.push(d.slice());c++}return d}function e(a){var c,d=-(a>>1),e=Array(a);for(c=0;c<a;c++)e[c]=d,d++;return e}function d(a,c){var e,h,k=a.length,j,m=[],l=0;if(typeof a[0].length=="undefined")for(e=0;e<k;e++)for(h=0;h<k;h++)j=a[e]*c[h],l+=j,m.push(j);else for(e=0;e<k;e++)for(h=0;h<k;h++)j=d(a[e],c[h]),l+=j.sum,m=m.concat(j.ker);
return{kernel:m,sum:l}}function a(a){a=l(a);return d(a,a)}function k(a,c){var h=l(a),k=e(a);return 1==c?d(k.reverse(),h):d(h,k)}function u(a,c){var h,k=Array(a);for(h=0;h<a;h++)k[h]=1;h=e(a);return 1==c?d(h.reverse(),k):d(k,h)}function j(a,c,d,e){var k=a.length,j,m=new h(a.length),d=d||1,e=e||1;for(j=0;j<k;j++)m[j]=d*a[j]+e*c[j];return m}function m(a,c){var c=c||1,d=a*a,e,k=new h(d);for(e=0;e<d;e++)k[e]=c;return k}var h=c.Array32F,o=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,
20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],p=c.CONSTANTS.toRad;c.ConvolutionMatrixFilter=function(a,c){this.factor=c||1;typeof a!="undefined"&&a.length?(this.matrix=new h(a),this.dim=~~(Math.sqrt(a.length)+0.5)):(this.matrix=null,this.dim=0);this.auxMatrix=null;this._isGrad=!1};c.ConvolutionMatrixFilter.prototype={dim:0,matrix:null,lowPass:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(m(a),1/(a*a),a)},highPass:function(a,c){var a=typeof a=="undefined"?3:a%2?a:a+1,
d=a*a,e=-(typeof c=="undefined"?1:c)/d,h=m(a,e);h[d>>2]=1+e;return this.set(h,1,a)},boxBlur:function(a){return this.lowPass(a)},binomialLowPass:function(c){var c=typeof c=="undefined"?3:c%2?c:c+1,d=a(c);return this.set(new h(d.kernel),1/d.sum,c)},binomialHighPass:function(c){var c=typeof c=="undefined"?3:c%2?c:c+1,d=a(c);return this.set(j(m(c),new h(d.kernel),1,-1/d.sum),1,c)},gaussBlur:function(a){return this.binomialLowPass(a)},sharpen:function(a,c){c=typeof c=="undefined"?0.5:c;return c<=0?this.set([0,
-2,0,-2,10,-2,0,-2,0],0.5,3):this.highPass(a,c)},prewittX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=u(a,0);return this.set(new h(c.kernel),1,a)},prewittY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=u(a,1);return this.set(new h(c.kernel),1,a)},prewittDirectional:function(a,c){a=typeof a=="undefined"?3:a%2?a:a+1;c*=p;var d=Math.cos(c),e=Math.sin(c),k=u(a,0),m=u(a,1);return this.set(j(new h(k.kernel),new h(m.kernel),d,e),1,a)},prewitt:function(a){var a=typeof a=="undefined"?3:a%
2?a:a+1,c=u(a,0),d=u(a,1);this.set(new h(c.kernel),1,a);this._isGrad=!0;this.auxMatrix=new h(d.kernel);return this},gradX:function(a){return this.prewittX(a)},gradY:function(a){return this.prewittY(a)},gradDirectional:function(a,c){return this.prewittDirectional(a,c)},grad:function(a){return this.prewitt(a)},sobelX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=k(a,0);return this.set(new h(c.kernel),1,a)},sobelY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=k(a,1);return this.set(new h(c.kernel),
1,a)},sobelDirectional:function(a,c){a=typeof a=="undefined"?3:a%2?a:a+1;c*=p;var d=Math.cos(c),e=Math.sin(c),m=k(a,0),l=k(a,1);return this.set(j(new h(m.kernel),new h(l.kernel),d,e),1,a)},sobel:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=k(a,0),d=k(a,1);this.set(new h(c.kernel),1,a);this.auxMatrix=new h(d.kernel);this._isGrad=!0;return this},laplace:function(){return this.set([0,-1,0,-1,4,-1,0,-1,0],1,3)},emboss:function(a,c){var c=1,d=(typeof a=="undefined"||a!=1&&a!=-1?1:a)*c;return this.set([-d*
2,-d*1,0,-d*1,c*1,d*1,0,d*1,d*2],1,3)},embossHigh:function(){return this.emboss(1)},embossLow:function(){return this.emboss(-1)},edges:function(){return this.set([0,1,0,1,-4,1,0,1,0],1,3)},edges2:function(){return this.set([0,2,0,2,-8,2,0,2,0],0.5,3)},motionblur:function(a){var c=new h(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);if(a==0)for(a=0;a<9;a++)c[36+a]=1;else if(a==2)for(a=
0;a<9;a++)c[9*a+5]=1;else if(a==1)for(a=0;a<9;a++)c[9*a+a]=1;return this.set(c,1/9,9)},set:function(a,c,d){this.matrix=new h(a);this.factor=c;this.dim=d;this.auxMatrix=null;this._isGrad=!1;return this},_apply:function(a,d,e){if(!this.matrix)return a;var h=this.dim,k=h>>1,j=new c.ImArray(a.length),m,l,o,p,t,u=0,x=0,C=0,I=0,K=0,L=0,G,F,H,J,N,O,P,M=Math.abs;for(l=O=0;l<e;l++){for(m=0;m<d;m++){p=l;o=m;t=O+m<<2;for(F=L=K=I=N=C=x=u=0;F<h;F++){G=p+F-k;if(G>=0&&G<e){P=G*d;for(G=0;G<h;G++)H=o+G-k,H>=0&&H<
d&&(H=P+H<<2,J=this.matrix[N+G],u+=a[H]*J,x+=a[H+1]*J,C+=a[H+2]*J,this.auxMatrix&&(J=this.auxMatrix[N+G],I+=a[H]*J,K+=a[H+1]*J,L+=a[H+2]*J))}N+=h}this._isGrad?(j[t]=this.factor*(M(u)+M(I)),j[t+1]=this.factor*(M(x)+M(K)),j[t+2]=this.factor*(M(C)+M(L))):(j[t]=this.factor*u,j[t+1]=this.factor*x,j[t+2]=this.factor*C);j[t+3]=a[t+3]}O+=d}return j},apply:function(a){if(!this.matrix)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this.auxMatrix=this.matrix=null;this.dim=
0;return this}}})(FILTER);
(function(c){c.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4};var l=Math.min;c.DisplacementMapFilter=function(c){this.map=c};c.DisplacementMapFilter.prototype={scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:c.MODE.CLAMP,map:null,_apply:function(e,d,a){if(!this.map)return e;var k=this.map.getData(),u=this.map.width,j=this.map.height,m=l(u,d),j=l(j,a),h=this.scaleX*0.00390625,o=this.scaleY*0.00390625,p=this.color>>24&255,D=this.color>>16&255,A=this.color>>8&255,s=this.color&255,
q=~~this.startY,w=~~this.startX,n=this.componentX,v=this.componentY,E=this.mode,y,z,t,B,x,C,I,K,L,G=q*d,F=new c.ImArray(e.length);for(I=L=K=0;I<j;I++){z=I+q;if(z>=0&&z<a)for(C=0;C<m;C++)if(y=C+w,!(y<0||y>=d)){t=L+G+y<<2;B=K+C<<2;x=z+~~((k[B+v]-128)*o);y+=~~((k[B+n]-128)*h);if(x>=a||x<0||y>=d||y<0)switch(E){case c.MODE.IGNORE:continue;case c.MODE.COLOR:F[t]=D;F[t+1]=A;F[t+2]=s;F[t+3]=p;continue;case c.MODE.WRAP:x>=a&&(x-=a);x<0&&(x+=a);y>=d&&(y-=d);y<0&&(y+=d);break;default:x>=a&&(x=a-1),x<0&&(x=0),
y>=d&&(y=d-1),y<0&&(y=0)}x=x*d+y<<2;F[t]=e[x];F[t+1]=e[x+1];F[t+2]=e[x+2];F[t+3]=e[x+3]}K+=u;L+=d}return F},apply:function(c){if(!this.map)return c;return c.setData(this._apply(c.getData(),c.width,c.height))},reset:function(){this.map=null;return this}}})(FILTER);
(function(c){var l=function(a,d,e,j){var m=j>>1,h=j*j,l=new c.ImArray(a.length),p,D,A,s,q,w,n,v,E,y,z,t,B,x,C;z=[];t=[];B=[];x=h%2;C=~~(0.5*h)+x;for(p=E=0;p<e;p++){for(h=0;h<d;h++){A=p;D=h;s=E+h<<2;z.length=0;t.length=0;for(w=v=B.length=0;w<j;w++){q=A+w-m;if(q>=0&&q<e){y=q*d;for(q=0;q<j;q++)n=D+q-m,n>=0&&n<d&&(n=y+n<<2,z.push(a[n]),t.push(a[n+1]),B.push(a[n+2]))}v+=j}z.sort();t.sort();B.sort();x?(l[s]=z[C],l[s+1]=t[C],l[s+2]=B[C]):(l[s]=~~(0.5*(z[C]+z[C+1])),l[s+1]=~~(0.5*(t[C]+t[C+1])),l[s+2]=~~(0.5*
(B[C]+B[C+1])));l[s+3]=a[s+3]}E+=d}return l},e=function(a,d,e,j){var l=j>>1,h=new c.ImArray(a.length),o,p,D,A,s,q,w,n,v,E,y,z,t,B;for(p=E=0;p<e;p++){for(o=0;o<d;o++){A=p;D=o;s=E+o<<2;for(w=v=B=t=z=0;w<j;w++){q=A+w-l;if(q>=0&&q<e){y=q*d;for(q=0;q<j;q++)n=D+q-l,n>=0&&n<d&&(n=y+n<<2,a[n]>z&&(z=a[n]),a[n+1]>t&&(t=a[n+1]),a[n+2]>B&&(B=a[n+2]))}v+=j}h[s]=z;h[s+1]=t;h[s+2]=B;h[s+3]=a[s+3]}E+=d}return h},d=function(a,d,e,j){var l=j>>1,h=new c.ImArray(a.length),o,p,D,A,s,q,w,n,v,E,y,z,t,B;for(p=E=0;p<e;p++){for(o=
0;o<d;o++){A=p;D=o;s=E+o<<2;B=t=z=255;for(w=v=0;w<j;w++){q=A+w-l;if(q>=0&&q<e){y=q*d;for(q=0;q<j;q++)n=D+q-l,n>=0&&n<d&&(n=y+n<<2,a[n]<z&&(z=a[n]),a[n+1]<t&&(t=a[n+1]),a[n+2]<B&&(B=a[n+2]))}v+=j}h[s]=z;h[s+1]=t;h[s+2]=B;h[s+3]=a[s+3]}E+=d}return h};c.NonLinearFilter=function(){this.dim=0;this._applyFunc=null};c.NonLinearFilter.prototype={dim:0,median:function(a){this.dim=typeof a=="undefined"?3:a%2?a:a+1;this._applyFunc=l;return this},erode:function(a){this.dim=typeof a=="undefined"?3:a%2?a:a+1;this._applyFunc=
d;return this},dilate:function(a){this.dim=typeof a=="undefined"?3:a%2?a:a+1;this._applyFunc=e;return this},_apply:function(a,c,d){if(!this._applyFunc)return a;return this._applyFunc(a,c,d,this.dim)},apply:function(a){if(!this._applyFunc)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this._applyFunc=null;this.dim=0;return this}}})(FILTER);
(function(c){c.HistogramEqualizeFilter=c.Create({apply:function(l){var e,d,a,k;k=0;var u=255,j=new c.Array32F(256),m=new c.Array32F(257),h,o,p=l.length,D=1/(p>>2),A=Array(p>>2),s=c.Color.RGB2YCbCr,q=c.Color.YCbCr2RGB;for(h=0;h<256;)j[h]=0,m[h]=0,h++;for(o=h=m[256]=0;h<p;){e=l[h];d=l[h+1];a=l[h+2];e=s({red:e,green:d,blue:a});j[e.Y]+=D;if(e.Y>k)k=e.Y;if(e.Y<u)u=e.Y;A[o]=e;h+=4;o++}for(h=0;h<256;)m[h+1]=m[h]+j[h],h++;k-=u;for(o=h=0;h<p;)e=A[o],e.Y=m[e.Y+1]*k+u,j=q(e),l[h]=j.red,l[h+1]=j.green,l[h+2]=
j.blue,h+=4,o++;return l}})})(FILTER);
(function(c){c.RGBHistogramEqualizeFilter=c.Create({init:function(){},apply:function(l){var e,d,a,k,u,j;j=u=k=0;var m=255,h=255,o=255,p=new c.Array32F(256),D=new c.Array32F(256),A=new c.Array32F(256),s=new c.Array32F(257),q=new c.Array32F(257),w=new c.Array32F(257),n,v=l.length,E=1/(v>>2);for(n=0;n<256;)p[n]=0,D[n]=0,A[n]=0,s[n]=0,q[n]=0,w[n]=0,n++;s[256]=0;q[256]=0;for(n=w[256]=0;n<v;)e=l[n],d=l[n+1],a=l[n+2],p[e]+=E,D[d]+=E,A[a]+=E,e>k&&(k=e),e<m&&(m=e),d>u&&(u=d),d<h&&(h=d),a>j&&(j=a),a<o&&(o=
a),n+=4;for(n=0;n<256;)s[n+1]=s[n]+p[n],q[n+1]=q[n]+D[n],w[n+1]=w[n]+A[n],n++;k-=m;u-=h;j-=o;for(n=0;n<v;)e=l[n],d=l[n+1],a=l[n+2],l[n]=s[e+1]*k+m,l[n+1]=q[d+1]*u+h,l[n+2]=w[a+1]*j+o,n+=4;return l}})})(FILTER);(function(c){c.NoiseFilter=c.Create({min:-127,max:127,init:function(c,e){this.min=c||-127;this.max=e||127},apply:function(c){var e=this.max-this.min,d=Math.random,a=this.min,k,u=c.length,j;for(k=0;k<u;)r=c[k],g=c[k+1],b=c[k+2],j=e*d()+a,c[k]=r+j,c[k+1]=g+j,c[k+2]=b+j,k+=4;return c}})})(FILTER);
