/** 
*
* FILTER.js
* JavaScript Image Processing Library
*
* http://github.com/foo123/FILTER.js
*
* @version 0.6.6
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/var FILTER=FILTER||{VERSION:"0.6.6"};!function(t){var e=navigator.userAgent.match(/Opera|OPR\//)?!0:!1;t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array;var i=t._notSupportClamp="undefined"==typeof Uint8ClampedArray;if(t.ImArray=i?t.Array8U:Uint8ClampedArray,t.ImArrayCopy=e?t.Array8U:t.ImArray,i&&"undefined"!=typeof CanvasPixelArray){var n=function(t){for(var e=t.length,i=e;--i;)this[i]=t[i];return this};CanvasPixelArray.prototype.set=n}t.CONSTANTS={PI:Math.PI,PI2:2*Math.PI,SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI},t.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3},t.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4},t.LUMA=new t.Array32F([.212671,.71516,.072169]);var r=Object.prototype.hasOwnProperty,s=Array.prototype.slice,a=Array.prototype.splice,h=function(){var t=s.call(arguments),e=t.length;if(e){var i=t.shift();if(this.__super__[i])return this.__super__[i].apply(this,t)}return null},o=t.Merge=function(t,e){t=t||{};for(var i in e)r.call(e,i)&&(t[i]=e[i]);return t},u=t.Extends=function(t,e){var i=function(){},n=e.constructor;return i.prototype=t.prototype,n.prototype=new i,n.prototype.constructor=n,n.prototype=o(n.prototype,e),n.prototype.__super__=t.prototype,n.prototype.superCall=h,n},c=t.log=window.console&&window.console.log?window.console.log:function(){};t.warning=function(t){c("WARNING: "+t)},t.error=function(t){c("ERROR: "+t)},t.useWebGL=!1,t.useWebGLSharedResources=!1,t.useWebGLIfAvailable=function(){},t.useWebGLSharedResourcesIfAvailable=function(){};var l=t.devicePixelRatio=window.devicePixelRatio||1;t.createCanvas=function(t,e){var i=document.createElement("canvas");return t=t||0,e=e||0,i.style.width=t+"px",i.style.height=e+"px",i.width=t*l,i.height=e*l,i};var f=0;t.getId=function(){return++f};var _=t.Filter=t.Extends(Object,{name:"GenericFilter",constructor:function(){},id:null,_isOn:!0,isOn:function(){return this._isOn},turnOn:function(){return this._isOn=!0,this},turnOff:function(){return this._isOn=!1,this},reset:function(){return this},combineWith:function(){return this},_apply:function(t){return t},apply:function(t){return this._isOn?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}}),g=t.CompositeFilter=t.Extends(_,{name:"CompositeFilter",constructor:function(t){this._stack=t&&t.length?t.slice():[]},_stack:null,getFilters:function(){return this._stack.slice()},setFilters:function(t){return t&&(this._stack=t.slice()),this},push:function(t){return this._stack.push(t),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(t){return this._stack.unshift(t),this},getAt:function(t){return this._stack.length>t?this._stack[t]:null},setAt:function(t,e){return this._stack.length>t?this._stack[t]=e:this._stack.push(e),this},insertAt:function(t){var e=s.call(arguments);return e.length,argslen>1&&(e.shift(),a.apply(this._stack,[t,0].concat(e))),this},removeAt:function(t){return this._stack.splice(t,1)},remove:function(t){for(var e=this._stack.length;--e>=0;)t===this._stack[e]&&this._stack.splice(e,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(t,e,i,n){if(this._isOn&&this._stack.length)for(var r,s=this._stack,a=s.length,h=0;a>h;)r=s[h++],r&&r._isOn&&(t=r._apply(t,e,i,n));return t},apply:function(t){return this._isOn&&this._stack.length?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}});g.prototype.empty=g.prototype.reset,g.prototype.concat=g.prototype.push,t.Create=function(t){return t=o({init:function(){},name:"PluginFilter",apply:function(t){return t}},t),t=o(t,{constructor:t.init,_apply:t.apply,apply:function(t){return this._isOn?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}}),t.init&&(t.init=null,delete t.init),u(_,t)}}(FILTER),function(t){var e=Math.sqrt,n=Math.min,r=Math.max;t.Color={clamp:function(t,e,i){return n(i,r(t,e))},clampPixel:function(t){return n(255,r(t,0))},ubyteToFloat:function(t){return.00392156862745098*t},ubyteColorToFloatColor:function(t){var e=t.length,n=new Array(e);for(i=0;e>i;i++)n[i]=.00392156862745098*t[i];return n},hexColorToFloatColor:function(t){var e,i,n,r;return e=255&t>>16,i=255&t>>8,n=255&t,r=255&t>>24,[.00392156862745098*e,.00392156862745098*i,.00392156862745098*n,.00392156862745098*r]},blend:function(t,e,i){return{r:t.r-~~((t.r-e.r)*i+.5),g:t.g-~~((t.g-e.g)*i+.5),b:t.b-~~((t.b-e.b)*i+.5)}},toGray:function(e,i,n){var r=t.LUMA;return~~(r[0]*e+r[1]*i+r[2]*n)},distance:function(t,i){var n=t.r-i.r,r=t.g-i.g,s=t.b-i.b;return e(n*n+r*r+s*s)},RGB2Color:function(t){return t.r<<16|t.g<<8|255&t.b},RGBA2Color:function(t){return t.a<<24|t.r<<16|t.g<<8|255&t.b},Color2RGBA:function(t){return t=~~t,{r:255&t>>>16,g:255&t>>>8,b:255&t,a:255&t>>>24}},RGB2YCbCr:function(t){var e,i,n,r=t.r,s=t.g,a=t.b;return e=~~(0+.299*r+.587*s+.114*a),i=~~(128-.168736*r-.331264*s+.5*a),n=~~(128+.5*r-.418688*s-.081312*a),{y:e,cb:i,cr:n}},YCbCr2RGB:function(t){var e,i,n,r=t.y,s=t.cb,a=t.cr;return e=~~(r+1.402*(a-128)),i=~~(r-.34414*(s-128)-.71414*(a-128)),n=~~(r+1.772*(s-128)),{r:e,g:i,b:n}},RGB2HSV:function(t){var e,i,s,a,h,o,u,c,l;return a=t.r,h=t.g,o=t.b,e=n(a,h,o),i=r(a,h,o),s=i-e,l=i,0==i?(c=0,u=0,{h:u,s:c,v:l}):(c=s/i,u=a==i?(h-o)/s:h==i?2+(o-a)/s:4+(a-h)/s,u*=60,0>u&&(u+=360),{h:u,s:c,v:l})},HSV2RGB:function(t){var e,i,n,r,s,a,h,o,u,c,l;if(u=t.h,c=t.s,l=t.v,0==c)return a=h=o=l,{r:a,g:h,b:o};switch(u/=60,e=~~u,i=u-e,n=l*(1-c),r=l*(1-c*i),s=l*(1-c*(1-i)),e){case 0:a=l,h=s,o=n;break;case 1:a=r,h=l,o=n;break;case 2:a=n,h=l,o=s;break;case 3:a=n,h=r,o=l;break;case 4:a=s,h=n,o=l;break;default:a=l,h=n,o=r}return{r:a,g:h,b:o}}}}(FILTER),function(t){var e,i=t.devicePixelRatio,n=t.ImArray,r=t.Array32F,s=t.createCanvas,a=(t._notSupportTypedArrays,Math.min);e=t.blendModes={normal:function(t){return t},lighten:function(t,e){return e>t?e:t},darken:function(t,e){return e>t?t:e},multiply:function(t,e){return.003921568627451*t*e},average:function(t,e){return.5*(t+e)},add:function(t,e){return Math.min(255,t+e)},substract:function(t,e){return 255>t+e?0:t+e-255},difference:function(t,e){return Math.abs(t-e)},negation:function(t,e){return 255-Math.abs(255-t-e)},screen:function(t,e){return 255-((255-t)*(255-e)>>8)},exclusion:function(t,e){return t+e-.003921568627451*2*t*e},overlay:function(t,e){return 128>e?.003921568627451*2*t*e:255-.003921568627451*2*(255-t)*(255-e)},softLight:function(t,e){return 128>e?2*((t>>1)+64)*.003921568627451*e:255-.003921568627451*2*(255-((t>>1)+64))*(255-e)},hardLight:function(t,e){return 128>t?.003921568627451*2*e*t:255-.003921568627451*2*(255-e)*(255-t)},colorDodge:function(t,e){return 255==e?e:Math.min(255,(t<<8)/(255-e))},colorBurn:function(t,e){return 0==e?e:Math.max(0,255-(255-t<<8)/e)},linearLight:function(t,i){return 128>i?e.linearBurn(t,2*i):e.linearDodge(t,2*(i-128))},vividLight:function(t,i){return 128>i?e.colorBurn(t,2*i):e.colorDodge(t,2*(i-128))},pinLight:function(t,i){return 128>i?e.darken(t,2*i):e.lighten(t,2*(i-128))},hardMix:function(t,i){return e.vividLight(t,i)<128?0:255},reflect:function(t,e){return 255==e?e:Math.min(255,t*t/(255-e))},glow:function(t,e){return 255==t?t:Math.min(255,e*e/(255-t))},phoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}},e.linearDodge=e.add,e.linearBurn=e.substract;var h=t.Image=t.Extends(Object,{name:"ImageProxy",constructor:function(t,e){this.width=0,this.height=0,this.context=null,this.imageData=null,this.domElement=this.canvasElement=s(this.width,this.height),this.context=this.canvasElement.getContext("2d"),this._tmpCanvas=s(this.width,this.height),this.webgl=null,this._histogram=null,this._integral=null,this._histogramRefresh=!0,this._integralRefresh=!0,this.setImage(t,e)},width:0,height:0,canvasElement:null,domElement:null,context:null,webgl:null,setWidth:function(t){return this.imageData=this._setDimensions(t).context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},setHeight:function(t){return this.imageData=this._setDimensions(t).context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},setDimensions:function(t,e){return this.imageData=this._setDimensions(t,e).context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},setImage:function(e,i){if("undefined"==typeof e||null==e)return this;var n,r,s,a,h=this;return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?(n=e,s=n instanceof HTMLVideoElement?n.videoWidth:n.width,a=n instanceof HTMLVideoElement?n.videoHeight:n.height,r=h.context=h._setDimensions(s,a).canvasElement.getContext("2d"),r.drawImage(n,0,0),h.imageData=r.getImageData(0,0,s,a),h._histogramRefresh=!0,h._integralRefresh=!0,h.webgl=t.useWebGL?new t.WebGL(h.canvasElement):null):(n=new Image,n.onload=function(){s=n.width,a=n.height,r=h.context=h._setDimensions(s,a).canvasElement.getContext("2d"),r.drawImage(n,0,0),h.imageData=r.getImageData(0,0,s,a),h._histogramRefresh=!0,h._integralRefresh=!0,h.webgl=t.useWebGL?new t.WebGL(h.canvasElement):null,"undefined"!=typeof i&&i.call(h)},n.src=e),n.crossOrigin="",this},getPixel:function(t,e){var i=~~(e*this.width+t+.5),n=this.imageData.data;return{r:n[i],g:n[i+1],b:n[i+2],a:n[i+3]}},setPixel:function(t,e,i,r,s,a){var h=new n([255&i,255&r,255&s,255&a]);return this.context.putImageData(h,t,e),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},getData:function(){return new n(this.imageData.data)},setData:function(t){return this.imageData.data.set(t),this.context.putImageData(this.imageData,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},getPixelData:function(){return this.imageData},setPixelData:function(t){return this.context.putImageData(t,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},createImageData:function(t,e){return this.context=this._setDimensions(t,e).canvasElement.getContext("2d"),this.context.createImageData(t,e),this.imageData=this.context.getImageData(0,0,this.width,this.height),this.imageData},copy:function(t){return this.setData(t.getData()),this.imageData=this.context.getImageData(0,0,this.width,this.height),this},clone:function(){return new h(this.canvasElement)},scale:function(t,e){if(t=t||1,e=e||t,1==t&&1==e)return this;var n=this._tmpCanvas.getContext("2d");return n.scale(t,e),n.drawImage(this.canvasElement,0,0),this.width=~~(t*this.width+.5),this.height=~~(e*this.height+.5),this.canvasElement.style.width=this.width+"px",this.canvasElement.style.height=this.height+"px",this.canvasElement.width=this.width*i,this.canvasElement.height=this.height*i,this.context.drawImage(this._tmpCanvas,0,0),this._tmpCanvas.width=this.width,this._tmpCanvas.height=this.height,this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},flipHorizontal:function(){var t=this._tmpCanvas.getContext("2d");return t.translate(this.width,0),t.scale(-1,1),t.drawImage(this.canvasElement,0,0),this.context.drawImage(this._tmpCanvas,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},flipVertical:function(){var t=this._tmpCanvas.getContext("2d");return t.translate(0,this.height),t.scale(1,-1),t.drawImage(this.canvasElement,0,0),this.context.drawImage(this._tmpCanvas,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},clear:function(){if(this.width&&this.height){var t=this.context;t.clearRect(0,0,this.width,this.height),this.imageData=t.getImageData(0,0,this.width,this.height)}return this},fill:function(t,e,i,n,r){if(!n&&this.width&&!r&&this.height)return this;n&&!this.width&&r&&!this.height&&(this.context=this._setDimensions(n,r).canvasElement.getContext("2d"),this.context.createImageData(n,r),this.imageData=this.context.getImageData(0,0,this.width,this.height)),t=t||0,e=e||0,i=i||0,n=n||this.width,r=r||this.height;var s=this.context;return s.fillStyle=t,s.fillRect(e,i,n,r),this.imageData=s.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},draw:function(){return this},blend:function(t,i,n,r,s){"undefined"==typeof i&&(i="normal"),"undefined"==typeof n&&(n=1),n>1?n=1:0>n&&(n=0),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=0);var h=0,o=0,u=this.context;if(0>r&&(h=-r,r=0),0>s&&(o=-s,s=0),r>=this.width||s>=this.height)return this;var c=e[i];if(void 0==c||null==c)return this;var l,f,_,g,m,d,p,A=a(this.width,t.width-h),w=a(this.height,t.height-o),y=this.context.getImageData(r,s,A,w),v=t.context.getImageData(h,o,A,w),E=y.data,L=v.data,x=1-n,M=L.length;for(p=0;M>p;p+=4)g=E[p],m=E[p+1],d=E[p+2],l=c(L[p],g),f=c(L[p+1],m),_=c(L[p+2],d),E[p]=l*n+g*x,E[p+1]=f*n+m*x,E[p+2]=_*n+d*x;return u.putImageData(y,r,s),this.imageData=u.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},integral:function(){return this._integralRefresh&&this._computeIntegral(),this._integral},histogram:function(){return this._histogramRefresh&&this._computeHistogram(),this._histogram},_setDimensions:function(t,e){return this._tmpCanvas.style.width=this.canvasElement.style.width=t+"px",this._tmpCanvas.width=this.canvasElement.width=this.width=t*i,this._tmpCanvas.style.height=this.canvasElement.style.height=e+"px",this._tmpCanvas.height=this.canvasElement.height=this.height=e*i,this},_setWidth:function(t){return this._tmpCanvas.style.width=this.canvasElement.style.width=t+"px",this._tmpCanvas.width=this.canvasElement.width=this.width=t*i,this},_setHeight:function(t){return this._tmpCanvas.style.height=this.canvasElement.style.height=t+"px",this._tmpCanvas.height=this.canvasElement.height=this.height=t*i,this},_computeIntegral:function(){var t,e,i,n,s,a,h=this.width,o=this.height,u=h*o,c=h<<2,l=new r(u),f=new r(u),_=new r(u),g=this.getPixelData().data;for(t=0,e=0,i=0,n=s=a=0;h>i;)n+=g[t],s+=g[t+1],a+=g[t+2],l[e]=n,f[e]=s,_[e]=a,t+=4,e++,i++;for(t=c,i=0,n=s=a=0;imLen>t;)n+=g[t],s+=g[t+1],a+=g[t+2],l[e]=l[e-h]+n,f[e]=f[e-h]+s,_[e]=_[e-h]+a,t+=4,e++,i++,i>=h&&(i=0,n=s=a=0);this._integral=[l,f,_],this._integralRefresh=!1},_computeHistogram:function(){var t,e,i,n,s=this.getPixelData().data,n=0,a=s.length,h=0,o=0,u=0,c=255,l=255,f=255,_=new r(256),g=new r(256),m=new r(256),d=1/(a>>2);for(n=0;256>n;)_[n]=0,g[n]=0,m[n]=0,n++;for(n=0;a>n;)t=s[n],e=s[n+1],i=s[n+2],_[t]+=d,g[e]+=d,m[i]+=d,t>h&&(h=t),c>t&&(c=t),e>o&&(o=e),l>e&&(l=e),i>u&&(u=i),f>i&&(f=i),n+=4;this._histogram=[_,g,m],this._histogramRefresh=!1},_refresh:function(){return this.context=this.canvasElement.getContext("2d"),this.imageData=this.context.getImageData(0,0,this.width,this.height),this}})}(FILTER),function(t){t.CustomFilter=t.Extends(t.Filter,{name:"CustomFilter",constructor:function(t){this._handler=t},_handler:null,_apply:function(t,e,i,n){return this._isOn&&this._handler?this._handler.call(this,t,e,i,n):t},apply:function(t){return this._isOn&&this._handler?t.setData(this._handler.call(this,t.getData(),t.width,t.height,t)):t}})}(FILTER),function(t,e){function i(t,e){var i,n,r,s,h,o=new a(20);return i=e[0],n=e[1],r=e[2],s=e[3],h=e[4],o[0]=i*t[0]+n*t[5]+r*t[10]+s*t[15],o[1]=i*t[1]+n*t[6]+r*t[11]+s*t[16],o[2]=i*t[2]+n*t[7]+r*t[12]+s*t[17],o[3]=i*t[3]+n*t[8]+r*t[13]+s*t[18],o[4]=i*t[4]+n*t[9]+r*t[14]+s*t[19]+h,i=e[5],n=e[6],r=e[7],s=e[8],h=e[9],o[5]=i*t[0]+n*t[5]+r*t[10]+s*t[15],o[6]=i*t[1]+n*t[6]+r*t[11]+s*t[16],o[7]=i*t[2]+n*t[7]+r*t[12]+s*t[17],o[8]=i*t[3]+n*t[8]+r*t[13]+s*t[18],o[9]=i*t[4]+n*t[9]+r*t[14]+s*t[19]+h,i=e[10],n=e[11],r=e[12],s=e[13],h=e[14],o[10]=i*t[0]+n*t[5]+r*t[10]+s*t[15],o[11]=i*t[1]+n*t[6]+r*t[11]+s*t[16],o[12]=i*t[2]+n*t[7]+r*t[12]+s*t[17],o[13]=i*t[3]+n*t[8]+r*t[13]+s*t[18],o[14]=i*t[4]+n*t[9]+r*t[14]+s*t[19]+h,i=e[15],n=e[16],r=e[17],s=e[18],h=e[19],o[15]=i*t[0]+n*t[5]+r*t[10]+s*t[15],o[16]=i*t[1]+n*t[6]+r*t[11]+s*t[16],o[17]=i*t[2]+n*t[7]+r*t[12]+s*t[17],o[18]=i*t[3]+n*t[8]+r*t[13]+s*t[18],o[19]=i*t[4]+n*t[9]+r*t[14]+s*t[19]+h,o}function n(t,e,i){var n=1-i,r=new a(20);return r[0]=n*t[0]+i*e[0],r[1]=n*t[1]+i*e[1],r[2]=n*t[2]+i*e[2],r[3]=n*t[3]+i*e[3],r[4]=n*t[4]+i*e[4],r[5]=n*t[5]+i*e[5],r[6]=n*t[6]+i*e[6],r[7]=n*t[7]+i*e[7],r[8]=n*t[8]+i*e[8],r[9]=n*t[9]+i*e[9],r[10]=n*t[10]+i*e[10],r[11]=n*t[11]+i*e[11],r[12]=n*t[12]+i*e[12],r[13]=n*t[13]+i*e[13],r[14]=n*t[14]+i*e[14],r[15]=n*t[15]+i*e[15],r[16]=n*t[16]+i*e[16],r[17]=n*t[17]+i*e[17],r[18]=n*t[18]+i*e[18],r[19]=n*t[19]+i*e[19],r}var r=Math.sin,s=Math.cos,a=t.Array32F,h=t.CONSTANTS.toRad,o=(t.CONSTANTS.toDeg,t._notSupportClamp),u=t.ColorMatrixFilter=t.Extends(t.Filter,{name:"ColorMatrixFilter",constructor:function(e){this._matrix=e&&e.length?new a(e):null,t.useWebGL&&(this._webglInstance=t.WebGLColorMatrixFilterInstance)},_matrix:null,_webglInstance:null,channel:function(i,n){n=n===e?!1:n;var r=n?1:0;switch(i){case t.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case t.CHANNEL.BLUE:return this.set([0,0,r,0,0,0,0,r,0,0,0,0,1,0,0,0,0,0,0,255]);case t.CHANNEL.GREEN:return this.set([0,r,0,0,0,0,1,0,0,0,0,r,0,0,0,0,0,0,0,255]);case t.CHANNEL.RED:default:return this.set([1,0,0,0,0,r,0,0,0,0,r,0,0,0,0,0,0,0,0,255])}},redChannel:function(e){return this.channel(t.CHANNEL.RED,e)},greenChannel:function(e){return this.channel(t.CHANNEL.GREEN,e)},blueChannel:function(e){return this.channel(t.CHANNEL.BLUE,e)},alphaChannel:function(){return this.channel(t.CHANNEL.ALPHA,!0)},maskChannel:function(e){switch(e){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(e,i){switch(e){case t.CHANNEL.ALPHA:switch(i){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case t.CHANNEL.BLUE:switch(i){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.BLUE:return this;case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case t.CHANNEL.GREEN:switch(i){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this;case t.CHANNEL.RED:default:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case t.CHANNEL.RED:default:switch(i){case t.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case t.CHANNEL.BLUE:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this}}},desaturate:function(){return this.set([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,0,0,0,1,0])},colorize:function(i,n){var r,s,a,h;return n===e&&(n=1),r=.00392156862745098*(255&i>>16),s=.00392156862745098*(255&i>>8),a=.00392156862745098*(255&i),h=1-n,this.set([h+n*r*t.LUMA[0],n*r*t.LUMA[1],n*r*t.LUMA[2],0,0,n*s*t.LUMA[0],h+n*s*t.LUMA[1],n*s*t.LUMA[2],0,0,n*a*t.LUMA[0],n*a*t.LUMA[1],h+n*a*t.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.set([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(e){var i,n,r,s;return i=1-e,n=i*t.LUMA[0],r=i*t.LUMA[1],s=i*t.LUMA[2],this.set([n+e,r,s,0,0,n,r+e,s,0,0,n,r,s+e,0,0,0,0,0,1,0])},contrast:function(t,i,n){return i===e&&(i=t),n===e&&(n=t),t+=1,i+=1,n+=1,this.set([t,0,0,0,128*(1-t),0,i,0,0,128*(1-i),0,0,n,0,128*(1-n),0,0,0,1,0])},brightness:function(t,i,n){return i===e&&(i=t),n===e&&(n=t),this.set([1,0,0,0,t,0,1,0,0,i,0,0,1,0,n,0,0,0,1,0])},adjustHue:function(e){e*=h;var i=s(e),n=r(e);return this.set([t.LUMA[0]+i*(1-t.LUMA[0])+n*-t.LUMA[0],t.LUMA[1]+i*-t.LUMA[1]+n*-t.LUMA[1],t.LUMA[2]+i*-t.LUMA[2]+n*(1-t.LUMA[2]),0,0,t.LUMA[0]+i*-t.LUMA[0]+.143*n,t.LUMA[1]+i*(1-t.LUMA[1])+.14*n,t.LUMA[2]+i*-t.LUMA[2]+n*-.283,0,0,t.LUMA[0]+i*-t.LUMA[0]+n*-(1-t.LUMA[0]),t.LUMA[1]+i*-t.LUMA[1]+n*t.LUMA[1],t.LUMA[2]+i*(1-t.LUMA[2])+n*t.LUMA[2],0,0,0,0,0,1,0])},average:function(t,i,n){return t===e&&(t=.3333),i===e&&(i=.3333),n===e&&(n=.3334),this.set([t,i,n,0,0,t,i,n,0,0,t,i,n,0,0,0,0,0,1,0])},quickContrastCorrection:function(t){return t===e&&(t=1.2),this.set([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0])},sepia:function(t){return t===e&&(t=.5),t>1?t=1:0>t&&(t=0),this.set([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0])},quickSepia:function(i){return i===e&&(i=10),i>100&&(i=100),i*=2.55,this.set([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,40,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,20,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,-i,0,0,0,1,0])},threshold:function(i,n){return n===e&&(n=256),this.set([t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*i,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*i,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*i,0,0,0,1,0])},threshold_rgb:function(t,i){return i===e&&(i=256),this.set([i,0,0,0,-(i-1)*t,0,i,0,0,-(i-1)*t,0,0,i,0,-(i-1)*t,0,0,0,1,0])},threshold_alpha:function(t,i){return t===e&&(t=.5),i===e&&(i=256),this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,i,-i*t])},RGB2YCbCr:function(){return this.set([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.set([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(t,e){return this._matrix=this._matrix?n(this._matrix,t.getMatrix(),e):new a(t.getMatrix()),this},set:function(t){return this._matrix=this._matrix?i(this._matrix,new a(t)):new a(t),this},reset:function(){return this._matrix=null,this},combineWith:function(t){return this.set(t.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(t){return this._matrix=new a(t),this},_apply:function(t){if(this._isOn&&this._matrix)for(var e,i,n,r,s,a,h,u,c=t.length,l=this._matrix,f=0;c>f;)e=t[f],i=t[f+1],n=t[f+2],r=t[f+3],s=l[0]*e+l[1]*i+l[2]*n+l[3]*r+l[4],a=l[5]*e+l[6]*i+l[7]*n+l[8]*r+l[9],h=l[10]*e+l[11]*i+l[12]*n+l[13]*r+l[14],u=l[15]*e+l[16]*i+l[17]*n+l[18]*r+l[19],o&&(0>s?s=0:s>255&&(s=255),0>a?a=0:a>255&&(a=255),0>h?h=0:h>255&&(h=255),0>u?u=0:u>255&&(u=255)),t[f]=~~s,t[f+1]=~~a,t[f+2]=~~h,t[f+3]=~~u,f+=4;return t},apply:function(t){return this._isOn&&this._matrix?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}});u.prototype.grayscale=u.prototype.desaturate,u.prototype.rotateHue=u.prototype.adjustHue,u.prototype.thresholdRgb=u.prototype.threshold_rgb,u.prototype.thresholdAlpha=u.prototype.threshold_alpha}(FILTER),function(t,e){var i=t.ImArrayCopy,n=t.Color.clampPixel,r=function(t){var e=new i(256),n=0;if(t)for(;256>n;)e[n]=255-n,n++;else for(;256>n;)e[n]=n,n++;return e},s=function(t){for(var e=new i(256),n=0;256>n;)e[n]=t,n++;return e},a=function(t){return t?new i(t):null},h=Math.pow,o=Math.exp,u=1/255,c=r(),l=r(1),f=t.TableLookupFilter=t.Extends(t.Filter,{name:"TableLookupFilter",constructor:function(t,e,i,n){this._tableR=t||null,this._tableG=e||this._tableR,this._tableB=i||this._tableG,this._tableA=n||null},_tableR:null,_tableG:null,_tableB:null,_tableA:null,thresholds:function(t,e,r){t.length||(t=[t]),e||(e=t),r||(r=e);var s,a,h=t.length,o=h+1,u=e.length,c=u+1,l=r.length,f=l+1,_=new i(256),g=new i(o),m=new i(256),d=new i(c),p=new i(256),A=new i(f),w=255/(o-1),y=255/(c-1),v=255/(f-1);for(s=0;o>s;)g[s]=~~(w*s),s++;for(t[0]=~~(255*t[0]),s=1;h>s;)t[s]=t[s-1]+~~(255*t[s]),s++;for(s=0;c>s;)d[s]=~~(y*s),s++;for(e[0]=~~(255*e[0]),s=1;u>s;)e[s]=e[s-1]+~~(255*e[s]),s++;for(s=0;f>s;)A[s]=~~(v*s),s++;for(r[0]=~~(255*r[0]),s=1;l>s;)r[s]=r[s-1]+~~(255*r[s]),s++;for(s=0;256>s;){for(a=0;h>a&&s>t[a];)a++;for(_[s]=n(g[a]),a=0;u>a&&s>e[a];)a++;for(m[s]=n(d[a]),a=0;l>a&&s>r[a];)a++;p[s]=n(A[a]),s++}return this.set(_,m,p)},threshold:function(t,e,i){return t=t||.5,e=e||t,i=i||e,this.thresholds([t],[e],[i])},quantize:function(t){t===e&&(t=64),2>t&&(t=2);var r,s=new i(256),a=new i(t),h=255/(t-1),o=t/256;for(r=0;t>r;)a[r]=~~(h*r),r++;for(r=0;256>r;)s[r]=n(a[~~(o*r)]),r++;return this.set(s)},binarize:function(){return this.quantize(2)},solarize:function(t){t===e&&(t=.5);var r,s,a=0,h=new i(256),o=2/255;for(a=0;256>a;)r=o*a,s=r>t?255-255*r:255*r-255,h[a]=~~n(s),a++;return this.set(h)},solarize2:function(t){t===e&&(t=.5),t=1-t;var r,s,a=0,h=new i(256),o=2/255;for(a=0;256>a;)r=o*a,s=t>r?255-255*r:255*r-255,h[a]=~~n(s),a++;return this.set(h)},solarizeInverse:function(t){t===e&&(t=.5),t*=256;var n=0,r=new i(256);for(n=0;256>n;)r[n]=n>t?255-n:n,n++;return this.set(r)},invert:function(){return this.set(l)},mask:function(t){var e=0,r=255&t>>16,s=255&t>>8,a=255&t;for(tR=new i(256),tG=new i(256),tB=new i(256),e=0;256>e;)tR[e]=n(e&r),tG[e]=n(e&s),tB[e]=n(e&a),e++;return this.set(tR,tG,tB)},replace:function(t,e){if(t==e)return this;var i=255&t>>16,n=255&t>>8,r=255&t,s=255&e>>16,h=255&e>>8,o=255&e,u=a(c),l=a(c),f=a(c);return u[i]=s,l[n]=h,f[r]=o,this.set(u,l,f)},extract:function(e,i,r){if(!i||!i.length)return this;r=r||0;var a,h,o=255&r>>16,u=255&r>>8,c=255&r,l=s(o),f=s(u),_=s(c);switch(e){case t.CHANNEL.BLUE:for(a=i[0],h=i[1];h>=a;)_[a]=n(a),a++;break;case t.CHANNEL.GREEN:for(a=i[0],h=i[1];h>=a;)f[a]=n(a),a++;break;case t.CHANNEL.RED:default:for(a=i[0],h=i[1];h>=a;)l[a]=n(a),a++}return this.set(l,f,_)},gammaCorrection:function(t,e,r){t=t||1,e=e||t,r=r||e,t=1/t,e=1/e,r=1/r;for(var s=new i(256),a=new i(256),o=new i(256),c=0;256>c;)s[c]=n(~~(255*h(u*c,t))),a[c]=n(~~(255*h(u*c,e))),o[c]=n(~~(255*h(u*c,r))),c++;return this.set(s,a,o)},exposure:function(t){t===e&&(t=1);var r=0,s=new i(256);for(r=0;256>r;)s[r]=n(~~(255*(1-o(-t*r*u)))),r++;return this.set(s)},set:function(t,e,i){if(!t)return this;e=e||t,i=i||e;var n,s,h,o,u,c=this._tableR||r(),l=a(c);if(e&&i){for(n=this._tableG||a(c),s=this._tableB||a(n),h=a(n),o=a(s),u=0;256>u;)c[u]=t[l[u]],n[u]=e[h[u]],s[u]=i[o[u]],u++;this._tableR=c,this._tableG=n,this._tableB=s}else{for(u=0;256>u;)c[u]=t[l[u]],u++;this._tableR=c,this._tableG=this._tableR,this._tableB=this._tableR}return this},reset:function(){return this._tableR=null,this._tableG=null,this._tableB=null,this._tableA=null,this},combineWith:function(t){return this.set(t.getTable(0),t.getTable(1),t.getTable(2))},getTable:function(e){switch(e=e||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA;case t.CHANNEL.BLUE:return this._tableB;case t.CHANNEL.GREEN:return this._tableG;case t.CHANNEL.RED:default:return this._tableR}},setTable:function(e,i){switch(i=i||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA=e,this;case t.CHANNEL.BLUE:return this._tableB=e,this;case t.CHANNEL.GREEN:return this._tableG=e,this;case t.CHANNEL.RED:default:return this._tableR=e,this}},_apply:function(t){if(!this._isOn||!this._tableR)return t;var e,i,n,r,s=t.length,a=0,h=this._tableR,o=this._tableG,u=this._tableB,c=this._tableA;if(c)for(;s>a;)e=t[a],i=t[a+1],n=t[a+2],r=t[a+3],t[a]=h[e],t[a+1]=o[i],t[a+2]=u[n],t[a+3]=c[r],a+=4;else for(;s>a;)e=t[a],i=t[a+1],n=t[a+2],t[a]=h[e],t[a+1]=o[i],t[a+2]=u[n],a+=4;return t},apply:function(t){return this._isOn&&this._tableR?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}});f.prototype.posterize=f.prototype.levels=f.prototype.quantize}(FILTER),function(t){var e=(t.ImArray,t.ImArrayCopy),i=t.Array16I,n=Math.min;Math.max,t.DisplacementMapFilter=t.Extends(t.Filter,{name:"DisplacementMapFilter",constructor:function(t){t&&this.setMap(t)},_map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:t.MODE.CLAMP,combineWith:function(){return this},reset:function(){return this._map=null,this},getMap:function(){return this._map},setMap:function(t){return this._map=t,this},_apply:function(r,s,a){if(!this._isOn||!this._map)return r;var h,o,u,c,l,f,_,g,m,d,p=this._map.getData(),A=this._map.width,w=this._map.height,y=A*w,v=new i(y<<1),E=n(A,s),L=n(w,a),x=.00390625*this.scaleX,M=.00390625*this.scaleY,b=this.componentX,C=this.componentY,D=255&this.color>>24,R=255&this.color>>16,N=255&this.color>>8,I=255&this.color,U=~~this.startY,k=~~this.startX,H=this.mode,O=U*s,G=-k,F=-U,P=s-k-1,T=a-U-1,B=E*L<<2,S=(r.length,new e(r)),W=t.MODE.IGNORE,Y=t.MODE.CLAMP,X=t.MODE.COLOR,z=t.MODE.WRAP;for(h=0,o=0,u=0,c=0,l=0;y>h;)g=u+l<<2,v[o]=~~((p[g+b]-128)*x),v[o+1]=~~((p[g+C]-128)*M),h++,o+=2,u++,u>=A&&(u=0,c++,l+=A);for(h=-4,u=-1,c=0,l=0,ty2=0;B>h;)if(h+=4,u++,u>=E&&(u=0,c++,l+=s,ty2+=A),!(F>c||c>T||G>u||u>P)){if(_=u+k,f=c+U,m=_+l+O<<2,o=u+ty2<<1,srcx=_+v[o],srcy=f+v[o+1],srcy>=a||0>srcy||srcx>=s||0>srcx)switch(H){case W:continue;case X:r[m]=R,r[m+1]=N,r[m+2]=I,r[m+3]=D;continue;case z:srcy>T?srcy-=a:0>srcy&&(srcy+=a),srcx>P?srcx-=s:0>srcx&&(srcx+=s);break;case Y:default:srcy>T?srcy=T:0>srcy&&(srcy=0),srcx>P?srcx=P:0>srcx&&(srcx=0)}d=srcx+srcy*s<<2,r[m]=S[d],r[m+1]=S[d+1],r[m+2]=S[d+2],r[m+3]=S[d+3]}return r},apply:function(t){return this._isOn&&this._map?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}})}(FILTER),function(t){var e=t.ImArray,i=t.ImArrayCopy,n=(t.CONSTANTS.PI,Math.sqrt),r=Math.atan2,s=Math.sin,a=Math.cos,h=Math.asin,o=Math.tan;Math.abs,t.CONSTANTS.toRad;var u=function(i,n,r){var s,a,h,o,u,c,l,f=i.length,_=new e(f),g=this.inverseTransform,m=this.mode,d=t.MODE.CLAMP,p=t.MODE.WRAP;for(h=0,s=0,a=0;f>h;){if(u=g([s,a],n,r),c=~~u[0],l=~~u[1],0>c||c>=n||0>l||l>=r)switch(m){case p:l>=r?l-=r:0>l&&(l+=r),c>=n?c-=n:0>c&&(c+=n);break;case d:default:l>=r?l=r-1:0>l&&(l=0),c>=n?c=n-1:0>c&&(c=0)}o=c+l*n<<2,_[h]=i[o],_[h+1]=i[o+1],_[h+2]=i[o+2],_[h+3]=i[o+3],h+=4,s++,s>=n&&(s=0,a++)}return _},c=function(i,n,r){var s,a,h,o,u,c,l,f,_,g=n*r,m=i.length,d=new e(m),p=this.matrix,A=p[0],w=p[1],y=p[3],v=p[4],E=p[2],L=p[5],x=this.mode,M=t.MODE.CLAMP,b=t.MODE.WRAP,C=n-1,D=g-n;for(h=0,s=0,a=0,u=L*n,c=y*n,l=v*n;m>h;){if(f=~~(A*s+w*a+E),_=~~(c*s+l*a+u),0>f||f>C||0>_||_>D)switch(x){case b:_>D?_-=g:0>_&&(_+=g),f>=n?f-=n:0>f&&(f+=n);break;case M:default:_>D?_=D:0>_&&(_=0),f>C?f=C:0>f&&(f=0)}o=f+_<<2,d[h]=i[o],d[h+1]=i[o+1],d[h+2]=i[o+2],d[h+3]=i[o+3],h+=4,s++,s>=n&&(s=0,a++)}return d},l=function(t,i){var n,r,s,a,h,o=t.length,u=new e(o);for(a=0,n=0,r=0,s=0;o>a;)h=i-1-n+s<<2,u[a]=t[h],u[a+1]=t[h+1],u[a+2]=t[h+2],u[a+3]=t[h+3],a+=4,n++,n>=i&&(n=0,r++,s+=i);return u},f=function(t,i,n){var r,s,a,h,o,u=t.length,c=new e(u);for(h=0,r=0,s=0,a=(n-1)*i;u>h;)o=r+a<<2,c[h]=t[o],c[h+1]=t[o+1],c[h+2]=t[o+2],c[h+3]=t[o+3],h+=4,r++,r>=i&&(r=0,s++,a-=i);return c},_=function(t,i,n){var r,s,a,h,o,u,c=t.length,l=new e(c);for(o=0,r=0,s=0,h=(n-1)*i;c>o;)u=i-1-r+h<<2,l[o]=t[u],l[o+1]=t[u+1],l[o+2]=t[u+2],l[o+3]=t[u+3],o+=4,r++,r>=i&&(r=0,s++,a+=i,h-=i);return l},g=function(t,i,n){var r,s,a,h,o,u=t.length,c=new e(u),l=n*i;for(h=0,r=0,s=0,a=l-1;u>h;)o=s+a<<2,c[h]=t[o],c[h+1]=t[o+1],c[h+2]=t[o+2],c[h+3]=t[o+3],h+=4,r++,a-=i,r>=i&&(r=0,a=l-1,s++);return c},m=function(t,i,n){var r,s,a,h,o,u=t.length,c=new e(u);for(h=0,r=0,s=0,a=0;u>h;)o=i-1-s+a<<2,c[h]=t[o],c[h+1]=t[o+1],c[h+2]=t[o+2],c[h+3]=t[o+3],h+=4,r++,a+=i,r>=i&&(r=0,a=0,s++);return c},d=function(e,h,o){if(0>=this.radius)return e;var u,c,l,f,_,g,m,d,p=e.length,A=new i(e),w=this.centerX,y=this.centerY,v=this.angle,E=this.radius,L=this.mode,x=t.MODE.CLAMP,M=t.MODE.WRAP,b=v/E,C=h-1,D=o-1;
for(l=0,u=0,c=0;p>l;){if(g=u-w,m=c-y,_=n(g*g+m*m),E>_){if(d=r(m,g)+b*(E-_),g=~~(w+_*a(d)),m=~~(y+_*s(d)),0>g||g>C||0>m||m>D)switch(L){case M:m>D?m-=o:0>m&&(m+=o),g>C?g-=h:0>g&&(g+=h);break;case x:default:m>D?m=D:0>m&&(m=0),g>C?g=C:0>g&&(g=0)}f=g+m*h<<2,e[l]=A[f],e[l+1]=A[f+1],e[l+2]=A[f+2],e[l+3]=A[f+3]}l+=4,u++,u>=h&&(u=0,c++)}return e},p=function(e,r,s){if(0>=this.radius)return e;var a,u,c,l,f,_,g,m,d,p,A,w,y,v=e.length,E=new i(e),L=this.centerX,x=this.centerY,M=this.radius,b=this.mode,C=t.MODE.CLAMP,D=t.MODE.WRAP,R=M*M,N=.555556,I=1-N,U=r-1,k=s-1;for(c=0,a=0,u=0;v>c;){if(f=a-L,_=u-x,w=f*f,y=_*_,g=w+y,R>g){if(p=R-g,A=n(p),m=h(f/n(w+p))*I,d=h(_/n(y+p))*I,f=~~(a-A*o(m)),_=~~(u-A*o(d)),0>f||f>U||0>_||_>k)switch(b){case D:_>k?_-=s:0>_&&(_+=s),f>U?f-=r:0>f&&(f+=r);break;case C:default:_>k?_=k:0>_&&(_=0),f>U?f=U:0>f&&(f=0)}l=f+_*r<<2,e[c]=E[l],e[c+1]=E[l+1],e[c+2]=E[l+2],e[c+3]=E[l+3]}c+=4,a++,a>=r&&(a=0,u++)}return e},A=function(t){return t},w=function(t){return t};t.GeometricMapFilter=t.Extends(t.Filter,{name:"GeometricMapFilter",constructor:function(t){this.generic(t)},_map:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,angle:0,radius:0,mode:t.MODE.CLAMP,generic:function(t){return t&&(this.inverseTransform=t,this._map=u),this},affine:function(t){return t&&(this.matrix=t,this._map=c),this},flipX:function(){return this._map=l,this},flipY:function(){return this._map=f,this},flipXY:function(){return this._map=_,this},rotateCW:function(){return this._map=g,this},rotateCCW:function(){return this._map=m,this},polar:function(t,e){return this.centerX=t||0,this.centerY=e||0,this._map=A,this},cartesian:function(t,e){return this.centerX=t||0,this.centerY=e||0,this._map=w,this},twirl:function(t,e,i,n){return this.angle=t||0,this.radius=e||0,this.centerX=i||0,this.centerY=n||0,this._map=d,this},sphere:function(t,e,i){return this.radius=t||0,this.centerX=e||0,this.centerY=i||0,this._map=p,this},combineWith:function(){return this},reset:function(){return this._map=null,this},getMap:function(){return this._map},setMap:function(t){return this._map=t,this},_apply:function(t,e,i,n){return this._isOn&&this._map?this._map.call(this,t,e,i,n):t},apply:function(t){return this._isOn&&this._map?t.setData(this._map.call(this,t.getData(),t.width,t.height,t)):t}})}(FILTER),function(t,e){function i(t,e,i,n){var r,s=t.length,a=new E(t.length);for(i=i||1,n=n||1,r=0;s>r;)a[r]=i*t[r]+n*e[r],r++;return a}function n(t,e){var i,n,r,s=t.length,a=[],h=0;for(i=0;s>i;i++)for(n=0;s>n;n++)r=t[i]*e[n],h+=r,a.push(r);return{kernel:a,sum:h}}function r(t){var e,i=new Array(t);for(e=0;t>e;)i[e]=1,e++;return i}function s(t){var e,i,n,r,s=D.length;if(t--,s>t)e=new E(D[t]);else for(e=new E(D[s-1]);t>=s;){for(i=e,e=new E(i.length+1),e[0]=1,n=0,r=i.length-1;r>n;n++)e[n+1]=i[n]+i[n+1];e[i.length]=1,40>s&&D.push(new Array(e)),s++}return e}function a(t){var e,i=t>>1,n=-i,r=new Array(t);for(e=0;t>e;)r[e]=n,n++,e++;return r}function h(t){var e=s(t);return n(e,e)}function o(t,e){var i=s(t),r=a(t);return 1==e?n(r.reverse(),i):n(i,r)}function u(t,e){var i=r(t),s=a(t);return 1==e?n(s.reverse(),i):n(i,s)}function c(t,e,i){e=e||1,i=i||e;var n,r=t*t,s=r>>1,a=new E(r);for(n=0;r>n;)a[n]=e,n++;return a[s]=i,a}function l(t,e,i,n){var r,s,a,h,o,u=t*t,c=t>>1,l=u>>1,f=new E(u);for(h=0,r=0;c>=r;r++){for(s=0,o=0,a=0;c>=a;a++)f[l+r+s]=h+o,f[l-r-s]=-h-o,f[l-r+s]=-h+o,f[l+r-s]=h-o,s+=t,o+=i;h+=e}return n=n||1,f[l]=n,f}function f(t,e,i,n){var r,s,a,h,o,u,c=t*t,l=t>>1,f=c>>1,_=new E(c),g=new E(c),m=1/t,d=1e-8;for(A(e)>d?(o=1,u=i/e):(o=e/i,u=1),r=0,a=0,h=0,s=u*t;l>=r;)g[f+r]=~~(f+a+h+.5),g[f-r]=~~(f-a-h+.5),r++,a+=o,h+=s;for(r=0;l>=r;)_[g[f+r]]=_[g[f-r]]=m,r++;return n=n||1,_[f]=n,_}function _(t,e,i,n,r,s,a,h,o,u){var c,l,f,_,g,m,d,p,A,w,y,v,E,M,b,D,R,N,I,U,k,H,O,G,F,P,T,B,S,W,Y,X,z,q,V,j,Q,J,K,Z,$,te,ee,ie,ne,re,se,ae,he,oe,ue=t.length,ce=s,le=a;if(c=e*i,A=ce*le,d=ce>>1,p=e*(le>>1),v=-d-1,M=-p-e,E=d,b=p,Y=0,z=e-1,X=0,q=c-e,f=(c<<1)+c,y=(e<<1)+e,u=u||1,oe=0,r)for(k=n[0],H=n[A>>1],O=H-k,G=r[0],F=r[A>>1],P=F-G,ae=h,he=o;u>oe;){for(w=new L(ue),l=new x(f),D=0,R=0,N=0,_=g=m=0;e>N;)_+=t[D],g+=t[D+1],m+=t[D+2],l[R]=_,l[R+1]=g,l[R+2]=m,D+=4,R+=3,N++;for(D=y+e,R=y,N=0,_=g=m=0;ue>D;)_+=t[D],g+=t[D+1],m+=t[D+2],l[R]=l[R-y]+_,l[R+1]=l[R-y+1]+g,l[R+2]=l[R-y+2]+m,D+=4,R+=3,N++,N>=e&&(N=0,_=g=m=0);for(D=0,N=0,I=0,U=0;ue>D;)T=N+v,B=U+M,S=N+E,W=U+b,Y>T?T=Y:S>z&&(S=z),X>B?B=X:W>q&&(W=q),V=T+B,J=S+W,j=S+B,Q=T+W,V=(V<<1)+V,j=(j<<1)+j,Q=(Q<<1)+Q,J=(J<<1)+J,te=k*(l[J]-l[j]-l[Q]+l[V])+O*t[D],ee=k*(l[J+1]-l[j+1]-l[Q+1]+l[V+1])+O*t[D+1],ie=k*(l[J+2]-l[j+2]-l[Q+2]+l[V+2])+O*t[D+2],ne=G*(l[J]-l[j]-l[Q]+l[V])+P*t[D],re=G*(l[J+1]-l[j+1]-l[Q+1]+l[V+1])+P*t[D+1],se=G*(l[J+2]-l[j+2]-l[Q+2]+l[V+2])+P*t[D+2],K=ae*te+he*ne,Z=ae*ee+he*re,$=ae*ie+he*se,C&&(0>K?K=0:K>255&&(K=255),0>Z?Z=0:Z>255&&(Z=255),0>$?$=0:$>255&&($=255)),w[D]=~~K,w[D+1]=~~Z,w[D+2]=~~$,w[D+3]=t[D+3],D+=4,N++,N>=e&&(N=0,I++,U+=e);t=w,oe++}else for(k=n[0],H=n[A>>1],O=H-k,h=h||1,o=o||0;u>oe;){for(w=new L(ue),l=new x(f),D=0,R=0,N=0,_=g=m=0;e>N;)_+=t[D],g+=t[D+1],m+=t[D+2],l[R]=_,l[R+1]=g,l[R+2]=m,D+=4,R+=3,N++;for(D=y+e,R=y,N=0,_=g=m=0;ue>D;)_+=t[D],g+=t[D+1],m+=t[D+2],l[R]=l[R-y]+_,l[R+1]=l[R-y+1]+g,l[R+2]=l[R-y+2]+m,D+=4,R+=3,N++,N>=e&&(N=0,_=g=m=0);for(D=0,N=0,I=0,U=0;ue>D;)T=N+v,B=U+M,S=N+E,W=U+b,Y>T?T=Y:S>z&&(S=z),X>B?B=X:W>q&&(W=q),V=T+B,J=S+W,j=S+B,Q=T+W,V=(V<<1)+V,j=(j<<1)+j,Q=(Q<<1)+Q,J=(J<<1)+J,te=k*(l[J]-l[j]-l[Q]+l[V])+O*t[D],ee=k*(l[J+1]-l[j+1]-l[Q+1]+l[V+1])+O*t[D+1],ie=k*(l[J+2]-l[j+2]-l[Q+2]+l[V+2])+O*t[D+2],K=h*te+o,Z=h*ee+o,$=h*ie+o,C&&(0>K?K=0:K>255&&(K=255),0>Z?Z=0:Z>255&&(Z=255),0>$?$=0:$>255&&($=255)),w[D]=~~K,w[D+1]=~~Z,w[D+2]=~~$,w[D+3]=t[D+3],D+=4,N++,N>=e&&(N=0,I++,U+=e);t=w,oe++}return w}function g(t,e,i,n,r,s,a,h,o){var u,c,l,f,_,g,m,d,p,A,w,y,v,E,x,D,R,N,I,U,k,H,O,G,F,P,T,B,S,W,Y,X,z,q,V,j,Q=t.length;for(u=e*i,g=[a,s],m=[r,n],c=[1,s],l=[a,1],f=[0,s>>1],_=[a>>1,0],q=[o,h],F=e-1,P=u-e,j=2;--j;){for(v=new L(Q),w=g[j],y=m[j],p=f[j],A=_[j],d=c[j],V=q[j],D=new M(w<<1),x=new b(w),N=0,I=0,U=0,k=0,H=0,E=A*e;w>I;)x[I]=U+k,D[N]=U-p,D[N+1]=H-E,N+=2,I++,U++,U>=d&&(U=0,k+=d,H+=e);for(R=0,U=0,k=0;Q>R;){for(Y=0,X=0,z=0,N=0,I=0;w>I;)O=U+D[N],G=k+D[N+1],O>=0&&F>=O&&G>=0&&P>=G&&(srcOff=O+G<<2,W=V*y[x[I]],Y+=t[srcOff]*W,X+=t[srcOff+1]*W,z+=t[srcOff+2]*W),N+=2,I++;T=Y,B=X,S=z,C&&(0>T?T=0:T>255&&(T=255),0>B?B=0:B>255&&(B=255),0>S?S=0:S>255&&(S=255)),v[R]=~~T,v[R+1]=~~B,v[R+2]=~~S,v[R+3]=t[R+3],R+=4,U++,U>=e&&(U=0,k+=e)}t=v}return v}function m(t,e,i,n,r,s,a,h){var o,u,c,l,f,_,g,m,d,p,w,y,v,E,x,D,R,N,I,U,k=matRadiusY=3,H=matHalfSideY=1,O=9,G=e,F=new M(18),P=new b(9),T=e*i,B=t.length,S=new L(B),W=e-1,Y=T-e,X=s,z=a;for(g=0,m=0,d=0,p=0,w=0;O>m;)P[m]=d+p,F[g]=d-H,F[g+1]=w-G,g+=2,m++,d++,d>=k&&(d=0,p+=k,w+=e);if(r)for(_=0,d=0,p=0;B>_;)x=0,D=0,R=0,N=0,I=0,U=0,y=d+F[0],v=p+F[1],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[0]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[0]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[2],v=p+F[3],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[1]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[1]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[4],v=p+F[5],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[2]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[2]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[6],v=p+F[7],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[3]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[3]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[8],v=p+F[9],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[4]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[4]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[10],v=p+F[11],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[5]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[5]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[12],v=p+F[13],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[6]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[6]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[14],v=p+F[15],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[7]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[7]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[16],v=p+F[17],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[8]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[8]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),h?(c=A(x)+A(N),l=A(D)+A(I),f=A(R)+A(U)):(c=X*x+z*N,l=X*D+z*I,f=X*R+z*U),C&&(0>c?c=0:c>255&&(c=255),0>l?l=0:l>255&&(l=255),0>f?f=0:f>255&&(f=255)),S[_]=~~c,S[_+1]=~~l,S[_+2]=~~f,S[_+3]=t[_+3],_+=4,d++,d>=e&&(d=0,p+=e);else for(_=0,d=0,p=0;B>_;)x=0,D=0,R=0,y=d+F[0],v=p+F[1],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[0]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[2],v=p+F[3],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[1]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[4],v=p+F[5],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[2]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[6],v=p+F[7],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[3]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[8],v=p+F[9],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[4]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[10],v=p+F[11],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[5]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[12],v=p+F[13],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[6]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[14],v=p+F[15],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[7]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[16],v=p+F[17],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[8]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),c=s*x+a,l=s*D+a,f=s*R+a,C&&(0>c?c=0:c>255&&(c=255),0>l?l=0:l>255&&(l=255),0>f?f=0:f>255&&(f=255)),S[_]=~~c,S[_+1]=~~l,S[_+2]=~~f,S[_+3]=t[_+3],_+=4,d++,d>=e&&(d=0,p+=e);return S}function d(t,e,i,n,r,s,a,h){var o,u,c,l,f,_,g,m,d,p,w,y,v,E,x,D,R,N,I,U,k=matRadiusY=5,H=matHalfSideY=2,O=25,G=e,F=new M(50),P=new b(25),T=e*i,B=t.length,S=new L(B),W=e-1,Y=T-e,X=s,z=a;for(g=0,m=0,d=0,p=0,w=0;O>m;)P[m]=d+p,F[g]=d-H,F[g+1]=w-G,g+=2,m++,d++,d>=k&&(d=0,p+=k,w+=e);if(r)for(_=0,d=0,p=0;B>_;)x=0,D=0,R=0,N=0,I=0,U=0,y=d+F[0],v=p+F[1],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[0]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[0]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[2],v=p+F[3],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[1]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[1]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[4],v=p+F[5],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[2]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[2]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[6],v=p+F[7],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[3]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[3]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[8],v=p+F[9],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[4]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[4]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[10],v=p+F[11],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[5]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[5]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[12],v=p+F[13],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[6]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[6]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[14],v=p+F[15],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[7]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[7]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[16],v=p+F[17],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[8]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[8]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[18],v=p+F[19],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[9]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[9]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[20],v=p+F[21],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[10]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[10]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[22],v=p+F[23],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[11]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[11]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[24],v=p+F[25],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[12]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[12]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[26],v=p+F[27],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[13]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[13]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[28],v=p+F[29],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[14]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[14]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[30],v=p+F[31],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[15]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[15]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[32],v=p+F[33],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[16]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[16]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[34],v=p+F[35],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[17]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[17]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[36],v=p+F[27],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[18]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[18]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[38],v=p+F[39],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[19]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[19]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[40],v=p+F[41],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[20]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[20]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[42],v=p+F[43],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[21]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[21]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[44],v=p+F[45],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[22]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[22]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[46],v=p+F[47],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[23]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[23]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),y=d+F[48],v=p+F[49],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[24]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o,u=r[P[24]],N+=t[E]*u,I+=t[E+1]*u,U+=t[E+2]*u),h?(c=A(x)+A(N),l=A(D)+A(I),f=A(R)+A(U)):(c=X*x+z*N,l=X*D+z*I,f=X*R+z*U),C&&(0>c?c=0:c>255&&(c=255),0>l?l=0:l>255&&(l=255),0>f?f=0:f>255&&(f=255)),S[_]=~~c,S[_+1]=~~l,S[_+2]=~~f,S[_+3]=t[_+3],_+=4,d++,d>=e&&(d=0,p+=e);else for(_=0,d=0,p=0;B>_;)x=0,D=0,R=0,y=d+F[0],v=p+F[1],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[0]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[2],v=p+F[3],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[1]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[4],v=p+F[5],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[2]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[6],v=p+F[7],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[3]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[8],v=p+F[9],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[4]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[10],v=p+F[11],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[5]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[12],v=p+F[13],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[6]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[14],v=p+F[15],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[7]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[16],v=p+F[17],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[8]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[18],v=p+F[19],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[9]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[20],v=p+F[21],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[10]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[22],v=p+F[23],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[11]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[24],v=p+F[25],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[12]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[26],v=p+F[27],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[13]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[28],v=p+F[29],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[14]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[30],v=p+F[31],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[15]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[32],v=p+F[33],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[16]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[34],v=p+F[35],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[17]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[36],v=p+F[27],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[18]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[38],v=p+F[39],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[19]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[40],v=p+F[41],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[20]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[42],v=p+F[43],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[21]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[44],v=p+F[45],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[22]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[46],v=p+F[47],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[23]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),y=d+F[48],v=p+F[49],y>=0&&W>=y&&v>=0&&Y>=v&&(E=y+v<<2,o=n[P[24]],x+=t[E]*o,D+=t[E+1]*o,R+=t[E+2]*o),c=s*x+a,l=s*D+a,f=s*R+a,C&&(0>c?c=0:c>255&&(c=255),0>l?l=0:l>255&&(l=255),0>f?f=0:f>255&&(f=255)),S[_]=~~c,S[_+1]=~~l,S[_+2]=~~f,S[_+3]=t[_+3],_+=4,d++,d>=e&&(d=0,p+=e);return S}var p=(t.CONSTANTS.SQRT2,t.CONSTANTS.toRad),A=(t.CONSTANTS.toDeg,Math.abs),w=Math.sqrt,y=Math.sin,v=Math.cos,E=t.Array32F,L=t.ImArray,x=t.Array32F,M=t.Array16I,b=t.Array8U,C=t._notSupportClamp,D=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],R=t.ConvolutionMatrixFilter=t.Extends(t.Filter,{name:"ConvolutionMatrixFilter",constructor:function(e,i,n){this._coeff=new E([1,0]),e&&e.length?this.set(e,~~(w(e.length)+.5),i||1,n||0):(this._matrix=null,this._dim=0),this._matrix2=null,this._dim2=this._dim,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,t.useWebGL&&(this._webglInstance=t.WebGLConvolutionMatrixFilterInstance)},_dim:0,_dim2:0,_matrix:null,_matrix2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_webglInstance:null,lowPass:function(t){return t=t===e?3:t%2?t:t+1,this.set(c(t),t,1/(t*t),0),this._doIntegral=1,this},highPass:function(t,i){t=t===e?3:t%2?t:t+1,i=i===e?1:i;var n=t*t,r=-i/n,s=c(t,r,1+r);return this.set(s,t,1,0),this._doIntegral=1,this},glow:function(t,i){return t=t===e?.5:t,this.highPass(i,-t)},sharpen:function(t,i){return t=t===e?.5:t,this.highPass(i,t)},verticalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(r(t),1,1/t,0),this._dim2=t,this._doIntegral=1,this},horizontalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(r(t),t,1/t,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(t,i){i=i===e?3:i%2?i:i+1,t*=p;var n=v(t),r=-y(t),s=f(i,n,r,1/i);return this.set(s,i,1,0)},fastGauss:function(t,i){return i=i===e?3:i%2?i:i+1,t=~~(t||1),1>t?t=1:t>3&&(t=3),this.set(c(i),i,1/(i*i),0),this._doIntegral=t,this},binomialLowPass:function(t){t=t===e?3:t%2?t:t+1;var i=s(t),n=1<<t-1,r=1/n;return this.set(i,t,r,r),this._matrix2=new E(i),this._doSeparable=!0,this},binomialHighPass:function(t){t=t===e?3:t%2?t:t+1;var n=h(t);return this.set(i(c(t),new E(n.kernel),1,-1/n.sum),t,1,0)},prewittX:function(t){t=t===e?3:t%2?t:t+1;var i=u(t,0);return this.set(i.kernel,t,1,0)},prewittY:function(t){t=t===e?3:t%2?t:t+1;var i=u(t,1);return this.set(i.kernel,t,1,0)},prewittDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=p;var r=v(t),s=y(t),a=u(n,0),h=u(n,1);return this.set(i(new E(a.kernel),new E(h.kernel),r,s),n,1,0)},prewitt:function(t){t=t===e?3:t%2?t:t+1;var i=u(t,0),n=u(t,1);return this.set(i.kernel,t,1,0),this._isGrad=!0,this._matrix2=new E(n.kernel),this},sobelX:function(t){t=t===e?3:t%2?t:t+1;var i=o(t,0);return this.set(i.kernel,t,1,0)},sobelY:function(t){t=t===e?3:t%2?t:t+1;var i=o(t,1);return this.set(i.kernel,t,1,0)},sobelDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=p;var r=v(t),s=y(t),a=o(n,0),h=o(n,1);return this.set(i(new E(a.kernel),new E(h.kernel),r,s),n,1,0)},sobel:function(t){t=t===e?3:t%2?t:t+1;var i=o(t,0),n=o(t,1);return this.set(i.kernel,t,1,0),this._matrix2=new E(n.kernel),this._isGrad=!0,this},laplace:function(t){t=t===e?3:t%2?t:t+1;var i=t*t,n=c(t,-1,i-1);return this.set(n,t,1,0),this._doIntegral=1,this},emboss:function(t,i,n){n=n===e?3:n%2?n:n+1,t=t===e?-.25*Math.PI:t*p,i=i||1;var r=i*v(t),s=-i*y(t),a=l(n,r,s,1);return this.set(a,n,1,0)},edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,i,n){return this._matrix2=null,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,this._matrix=new E(t),this._dim2=this._dim=e,this._coeff[0]=i||1,this._coeff[1]=n||0,this},reset:function(){return this._matrix=null,this._matrix2=null,this._dim=0,this._dim2=0,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,this},combineWith:function(){return this},getMatrix:function(){return this._matrix},setMatrix:function(t,e){return this._matrix=t,this._dim2=this._dim=e,this._matrix2=null,this._coeff[0]=1,this._coeff[1]=0,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,this},_apply:function(t,e,i){if(!this._isOn||!this._matrix)return t;if(this._doIntegral)return this._matrix2?_(t,e,i,this._matrix,this._matrix2,this._dim,this._dim2,this._coeff[0],this._coeff[1],this._doIntegral):_(t,e,i,this._matrix,null,this._dim,this._dim2,this._coeff[0],this._coeff[1],this._doIntegral);if(this._doSeparable)return g(t,e,i,this._matrix,this._matrix2,this._dim,this._dim2,this._coeff[0],this._coeff[1]);if(3==this._dim)return this._matrix2?m(t,e,i,this._matrix,this._matrix2,this._coeff[0],this._coeff[1],this._isGrad):m(t,e,i,this._matrix,null,this._coeff[0],this._coeff[1],!1);if(5==this._dim)return this._matrix2?d(t,e,i,this._matrix,this._matrix2,this._coeff[0],this._coeff[1],this._isGrad):d(t,e,i,this._matrix,null,this._coeff[0],this._coeff[1],!1);var n,r,s,a,h,o,u,c,l,f,p,w,y,v,E,x,D,R,N,I,U=this._dim,k=this._dim,H=U>>1,O=k>>1,G=U*k,F=O*e,P=this._matrix,T=this._matrix2,B=this._isGrad,S=new M(G<<1),W=new b(G),Y=e*i,X=t.length,z=new L(X),q=e-1,V=Y-e,j=this._coeff[0],Q=this._coeff[1];for(u=0,c=0,l=0,f=0,p=0;G>c;)W[c]=l+f,S[u]=l-H,S[u+1]=p-F,u+=2,c++,l++,l>=U&&(l=0,f+=U,p+=e);if(T)for(o=0,l=0,f=0;X>o;){for(E=0,x=0,D=0,R=0,N=0,I=0,u=0,c=0;G>c;)w=l+S[u],y=f+S[u+1],w>=0&&q>=w&&y>=0&&V>=y&&(v=w+y<<2,n=P[W[c]],E+=t[v]*n,x+=t[v+1]*n,D+=t[v+2]*n,r=T[W[c]],R+=t[v]*r,N+=t[v+1]*r,I+=t[v+2]*r),u+=2,c++;B?(s=A(E)+A(R),a=A(x)+A(N),h=A(D)+A(I)):(s=j*E+Q*R,a=j*x+Q*N,h=j*D+Q*I),C&&(0>s?s=0:s>255&&(s=255),0>a?a=0:a>255&&(a=255),0>h?h=0:h>255&&(h=255)),z[o]=~~s,z[o+1]=~~a,z[o+2]=~~h,z[o+3]=src[o+3],o+=4,l++,l>=e&&(l=0,f+=e)}else for(o=0,l=0,f=0;X>o;){for(E=0,x=0,D=0,u=0,c=0;G>c;)w=l+S[u],y=f+S[u+1],w>=0&&q>=w&&y>=0&&V>=y&&(v=w+y<<2,n=P[W[c]],E+=t[v]*n,x+=t[v+1]*n,D+=t[v+2]*n),u+=2,c++;s=j*E+Q,a=j*x+Q,h=j*D+Q,C&&(0>s?s=0:s>255&&(s=255),0>a?a=0:a>255&&(a=255),0>h?h=0:h>255&&(h=255)),z[o]=~~s,z[o+1]=~~a,z[o+2]=~~h,z[o+3]=src[o+3],o+=4,l++,l>=e&&(l=0,f+=e)}return z},apply:function(t){return this._isOn&&this._matrix?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}});R.prototype.boxBlur=R.prototype.lowPass,R.prototype.gaussBlur=R.prototype.binomialLowPass,R.prototype.gradX=R.prototype.prewittX,R.prototype.gradY=R.prototype.prewittY,R.prototype.gradDirectional=R.prototype.prewittDirectional,R.prototype.grad=R.prototype.prewitt}(FILTER),function(t){var e=t.ImArray,i=t.Array8U,n=t.Array32I,r=Math.sqrt,s=function(t,i,r){var s,a,h,o,u,c,l,f,_,g,m,d,p,A=this._structureElement,w=(A.length,this._dim,new n(this._indices)),y=i*r,v=t.length,E=new e(v),L=w.length,x=L>>1,M=i-1,b=y-i;for(k=0;L>k;)w[k+1]*=i,k+=2;for(s=0,h=0,o=0;v>s;){for(m=0,d=0,p=0,a=0;x>a;)u=h+w[a],c=o+w[a+1],u>=0&&M>=u&&c>=0&&b>=c&&(l=u+c<<2,f=t[l],_=t[l+1],g=t[l+2],f>m&&(m=f),_>d&&(d=_),g>p&&(p=g)),a+=2;E[s]=m,E[s+1]=d,E[s+2]=p,E[s+3]=t[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}return E},a=function(t,i,r){var s,a,h,o,u,c,l,f,_,g,m,d,p,A=this._structureElement,w=(A.length,this._dim,new n(this._indices)),y=i*r,v=t.length,E=new e(v),L=w.length,x=L>>1,M=i-1,b=y-i;for(k=0;L>k;)w[k+1]*=i,k+=2;for(s=0,h=0,o=0;v>s;){for(m=255,d=255,p=255,a=0;x>a;)u=h+w[a],c=o+w[a+1],u>=0&&M>=u&&c>=0&&b>=c&&(l=u+c<<2,f=t[l],_=t[l+1],g=t[l+2],m>f&&(m=f),d>_&&(d=_),p>g&&(p=g)),a+=2;E[s]=m,E[s+1]=d,E[s+2]=p,E[s+3]=t[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}return E},h=function(t,i,r){var s,a,h,o,u,c,l,f,_,g,m,d,p,A=this._structureElement,w=(A.length,this._dim,new n(this._indices)),y=i*r,v=t.length,E=new e(v),L=w.length,x=L>>1,M=i-1,b=y-i;for(k=0;L>k;)w[k+1]*=i,k+=2;for(s=0,h=0,o=0;v>s;){for(m=255,d=255,p=255,a=0;x>a;)u=h+w[a],c=o+w[a+1],u>=0&&M>=u&&c>=0&&b>=c&&(l=u+c<<2,f=t[l],_=t[l+1],g=t[l+2],m>f&&(m=f),d>_&&(d=_),p>g&&(p=g)),a+=2;E[s]=m,E[s+1]=d,E[s+2]=p,E[s+3]=t[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}for(t=E,E=new e(v),s=0,h=0,o=0;v>s;){for(m=255,d=255,p=255,a=0;x>a;)u=h+w[a],c=o+w[a+1],u>=0&&M>=u&&c>=0&&b>=c&&(l=u+c<<2,f=t[l],_=t[l+1],g=t[l+2],m>f&&(m=f),d>_&&(d=_),p>g&&(p=g)),a+=2;E[s]=m,E[s+1]=d,E[s+2]=p,E[s+3]=t[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}return E},o=function(t,i,r){var s,a,h,o,u,c,l,f,_,g,m,d,p,A=this._structureElement,w=(A.length,this._dim,new n(this._indices)),y=i*r,v=t.length,E=new e(v),L=w.length,x=L>>1,M=i-1,b=y-i;for(k=0;L>k;)w[k+1]*=i,k+=2;for(s=0,h=0,o=0;v>s;){for(m=255,d=255,p=255,a=0;x>a;)u=h+w[a],c=o+w[a+1],u>=0&&M>=u&&c>=0&&b>=c&&(l=u+c<<2,f=t[l],_=t[l+1],g=t[l+2],m>f&&(m=f),d>_&&(d=_),p>g&&(p=g)),a+=2;E[s]=m,E[s+1]=d,E[s+2]=p,E[s+3]=t[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}for(t=E,E=new e(v),s=0,h=0,o=0;v>s;){for(m=255,d=255,p=255,a=0;x>a;)u=h+w[a],c=o+w[a+1],u>=0&&M>=u&&c>=0&&b>=c&&(l=u+c<<2,f=t[l],_=t[l+1],g=t[l+2],m>f&&(m=f),d>_&&(d=_),p>g&&(p=g)),a+=2;E[s]=m,E[s+1]=d,E[s+2]=p,E[s+3]=t[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}return E},u=function(t){var e,n=t*t,r=new i(n);for(e=0;n>e;e++)r[e]=1;return r},c=u(3);t.MorphologicalFilter=t.Extends(t.Filter,{name:"MorphologicalFilter",constructor:function(){this._filter=null,this._dim=0,this._structureElement=null,this._indices=null},_filter:null,_dim:0,_structureElement:null,_indices:null,erode:function(t){return this.set(t,a)},dilate:function(t){return this.set(t,s)},opening:function(t){return this.set(t,h)},closing:function(t){return this.set(t,o)},set:function(t,e){this._filter=e,t&&t.length?(this._structureElement=new i(t),this._dim=~~(r(this._structureElement.length)+.5)):t&&t===t-0?(this._structureElement=u(t),this._dim=t):(this._structureElement=c,this._dim=3);var s,a,h,o=[],t=this._structureElement,l=t.length,f=this._dim,_=f>>1;for(a=0,h=0,s=0;l>s;)t[s]&&(o.push(a-_),o.push(h-_)),s++,a++,a>=f&&(a=0,h++);return this._indices=new n(o),this},reset:function(){return this._filter=null,this._dim=0,this._structureElement=null,this._indices=null,this},_apply:function(t,e,i){return this._isOn&&this._dim&&this._filter?this._filter.call(this,t,e,i):t},apply:function(t){return this._isOn&&this._dim&&this._filter?t.setData(this._filter.call(this,t.getData(),t.width,t.height,t)):t}})}(FILTER),function(t,e){var i=t.ImArray,n=t.Array32I;Math.min,Math.max;var r=function(t,e,r){var s,a,h,o,u,c,l,f,_,g,m,d,p,A,w,y=this._dim,v=y*y,E=new n(this._indices),L=e*r,x=t.length,M=new i(x),b=[],C=[],D=[],R=v<<1,N=e-1,I=L-e;for(a=0;R>a;)E[a+1]*=e,a+=2;for(s=0,h=0,o=0;x>s;){for(b.length=0,C.length=0,D.length=0,a=0;R>a;)u=h+E[a],c=o+E[a+1],u>=0&&N>=u&&c>=0&&I>=c&&(l=u+c<<2,f=t[l],_=t[l+1],g=t[l+2],b.push(f),C.push(_),D.push(g)),a+=2;b.sort(),C.sort(),D.sort(),A=b.length,w=A>>1,m=A%2?b[w+1]:~~(.5*(b[w]+b[w+1])),A=C.length,w=A>>1,d=A%2?C[w+1]:~~(.5*(C[w]+C[w+1])),A=D.length,w=A>>1,p=A%2?D[w+1]:~~(.5*(D[w]+D[w+1])),M[s]=m,M[s+1]=d,M[s+2]=p,M[s+3]=t[s+3],s+=4,h++,h>=e&&(h=0,o+=e)}return M},s=function(t,e,r){var s,a,h,o,u,c,l,f,_,g,m,d,p,A=this._dim,w=A*A,y=new n(this._indices),v=e*r,E=t.length,L=new i(E),x=w<<1,M=e-1,b=v-e;for(a=0;x>a;)y[a+1]*=e,a+=2;for(s=0,h=0,o=0;E>s;){for(m=0,d=0,p=0,a=0;x>a;)u=h+y[a],c=o+y[a+1],u>=0&&M>=u&&c>=0&&b>=c&&(l=u+c<<2,f=t[l],_=t[l+1],g=t[l+2],f>m&&(m=f),_>d&&(d=_),g>p&&(p=g)),a+=2;L[s]=m,L[s+1]=d,L[s+2]=p,L[s+3]=t[s+3],s+=4,h++,h>=e&&(h=0,o+=e)}return L},a=function(t,e,r){var s,a,h,o,u,c,l,f,_,g,m,d,p,A=this._dim,w=A*A,y=new n(this._indices),v=e*r,E=t.length,L=new i(E),x=w<<1,M=e-1,b=v-e;for(a=0;x>a;)y[a+1]*=e,a+=2;for(s=0,h=0,o=0;E>s;){for(m=255,d=255,p=255,a=0;x>a;)u=h+y[a],c=o+y[a+1],u>=0&&M>=u&&c>=0&&b>=c&&(l=u+c<<2,f=t[l],_=t[l+1],g=t[l+2],m>f&&(m=f),d>_&&(d=_),p>g&&(p=g)),a+=2;L[s]=m,L[s+1]=d,L[s+2]=p,L[s+3]=t[s+3],s+=4,h++,h>=e&&(h=0,o+=e)}return L},h=t.StatisticalFilter=t.Extends(t.Filter,{name:"StatisticalFilter",constructor:function(){this._dim=0,this._indices=null,this._filter=null},_dim:0,_indices:null,_filter:null,median:function(t){return t=t===e?3:t%2?t:t+1,this.set(t,r)},minimum:function(t){return t=t===e?3:t%2?t:t+1,this.set(t,a)},maximum:function(t){return t=t===e?3:t%2?t:t+1,this.set(t,s)},set:function(t,e){this._filter=e,this._dim=t;var i,r,s,a=[],h=t*t,o=t,u=o>>1;for(r=0,s=0,i=0;h>i;)a.push(r-u),a.push(s-u),i++,r++,r>=o&&(r=0,s++);return this._indices=new n(a),this},reset:function(){return this._filter=null,this._dim=0,this._indices=null,this},_apply:function(t,e,i){return this._isOn&&this._dim?this._filter.call(this,t,e,i):t},apply:function(t){return this._isOn&&this._dim?t.setData(this._filter.call(this,t.getData(),t.width,t.height,t)):t}});h.prototype.erode=h.prototype.minimum,h.prototype.dilate=h.prototype.maximum}(FILTER);