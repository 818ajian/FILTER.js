/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.6.5
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/var FILTER=FILTER||{};!function(t){function e(t,e){return t&&i.call(t,e)}function n(t,n){t=t||{};for(var i in n)e(n,i)&&(t[i]=n[i]);return t}var i=Object.prototype.hasOwnProperty,r=Array.prototype.slice;t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,t.ImArray="undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:t.Array8U,t._notSupportTypedArrays=!t.ImArray.set,t._notSupportTypedArrays&&(t.ImArray.prototype.set||(t.ImArray.prototype.set=function(t){for(var e=t.length,n=e;--n;)this[n]=t[n]}),"undefined"!=typeof CanvasPixelArray&&(CanvasPixelArray.prototype.set=function(t){for(var e=t.length,n=e;--n;)this[n]=t[n]})),t.CONSTANTS={PI:Math.PI,PI2:2*Math.PI,SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI},t.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3},t.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4},t.LUMA=new t.Array32F([.212671,.71516,.072169]);var s=t.log=window.console&&window.console.log?window.console.log:function(){};t.warning=function(t){s("WARNING: "+t)},t.error=function(t){s("ERROR: "+t)},t.useWebGL=!1,t.useWebGLSharedResources=!1,t.useWebGLIfAvailable=function(){},t.useWebGLSharedResourcesIfAvailable=function(){};var a=window.devicePixelRatio||1;t.createCanvas=function(t,e){var n=document.createElement("canvas");return t=t||0,e=e||0,n.style.width=t+"px",n.style.height=e+"px",n.width=t*a,n.height=e*a,n};var h=0;t.getId=function(){return++h};var o=t.Filter=function(){};o.prototype={constructor:o,_apply:function(){},apply:function(){},reset:function(){}};var u=t.CompositeFilter=function(t){this._stack="undefined"!=typeof t&&t.length?t:[]};u.prototype={constructor:u,_stack:[],_apply:function(t,e,n,i){if(!this._stack.length)return t;for(var r,s=this._stack,a=s.length,h=0;a>h;)r=s[h++],r&&(t=r._apply(t,e,n,i));return t},apply:function(t){return this._stack.length?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},filters:function(t){return t&&(this._stack=t),this},push:function(t){return this._stack.push(t),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(t){return this._stack.unshift(t),this},concat:function(t){return this.push(t)},getAt:function(t){return this._stack.length>t?this._stack[t]:null},setAt:function(t,e){return this._stack.length>t&&(this._stack[t]=e),this},insertAt:function(t,e){return this._stack.splice(t,0,e),this},removeAt:function(t){return this._stack.splice(t,1),this},remove:function(t){for(var e=this._stack.length;--e>=0;)t===this._stack[e]&&this._stack.splice(e,1);return this},reset:function(){return this._stack.length=0,this}},t.Create=function(t){var e=function(){this.init.apply(this,r.call(arguments))};return t=n({init:function(){},reset:function(){return this},apply:function(t){return t}},t),t._apply=t.apply,t.apply=function(t){return t.setData(this._apply(t.getData(),t.width,t.height,t))},e.prototype=n(e.prototype,t),e}}(FILTER),function(t){var e=Math.sqrt,n=Math.min,r=Math.max;t.Color={ubyteToFloat:function(t){return.00392156862745098*t},ubyteColorToFloatColor:function(t){var e=t.length,n=new Array(e);for(i=0;e>i;i++)n[i]=.00392156862745098*t[i];return n},hexColorToFloatColor:function(t){var e,n,i,r;return e=255&t>>16,n=255&t>>8,i=255&t,r=255&t>>24,[.00392156862745098*e,.00392156862745098*n,.00392156862745098*i,.00392156862745098*r]},blend:function(t,e,n){return{r:t.r-~~((t.r-e.r)*n+.5),g:t.g-~~((t.g-e.g)*n+.5),b:t.b-~~((t.b-e.b)*n+.5)}},toGray:function(e,n,i){var r=t.LUMA;return~~(r[0]*e+r[1]*n+r[2]*i)},distance:function(t,n){var i=t.r-n.r,r=t.g-n.g,s=t.b-n.b;return e(i*i+r*r+s*s)},RGB2Color:function(t){return t.r<<16|t.g<<8|255&t.b},RGBA2Color:function(t){return t.a<<24|t.r<<16|t.g<<8|255&t.b},Color2RGBA:function(t){return t=~~t,{r:255&t>>>16,g:255&t>>>8,b:255&t,a:255&t>>>24}},RGB2YCbCr:function(t){var e,n,i,r=t.r,s=t.g,a=t.b;return e=~~(0+.299*r+.587*s+.114*a),n=~~(128-.168736*r-.331264*s+.5*a),i=~~(128+.5*r-.418688*s-.081312*a),{y:e,cb:n,cr:i}},YCbCr2RGB:function(t){var e,n,i,r=t.y,s=t.cb,a=t.cr;return e=~~(r+1.402*(a-128)),n=~~(r-.34414*(s-128)-.71414*(a-128)),i=~~(r+1.772*(s-128)),{r:e,g:n,b:i}},RGB2HSV:function(t){var e,i,s,a,h,o,u,c,f;return a=t.r,h=t.g,o=t.b,e=n(a,h,o),i=r(a,h,o),s=i-e,f=i,0==i?(c=0,u=0,{h:u,s:c,v:f}):(c=s/i,u=a==i?(h-o)/s:h==i?2+(o-a)/s:4+(a-h)/s,u*=60,0>u&&(u+=360),{h:u,s:c,v:f})},HSV2RGB:function(t){var e,n,i,r,s,a,h,o,u,c,f;if(u=t.h,c=t.s,f=t.v,0==c)return a=h=o=f,{r:a,g:h,b:o};switch(u/=60,e=~~u,n=u-e,i=f*(1-c),r=f*(1-c*n),s=f*(1-c*(1-n)),e){case 0:a=f,h=s,o=i;break;case 1:a=r,h=f,o=i;break;case 2:a=i,h=f,o=s;break;case 3:a=i,h=r,o=f;break;case 4:a=s,h=i,o=f;break;default:a=f,h=i,o=r}return{r:a,g:h,b:o}}}}(FILTER),function(t){var e,n=window.devicePixelRatio||1,i=Math.min,r=t.ImArray,s=t.Array32F,a=t.createCanvas;t._notSupportTypedArrays,e=t.blendModes={normal:function(t){return t},lighten:function(t,e){return e>t?e:t},darken:function(t,e){return e>t?t:e},multiply:function(t,e){return.003921568627451*t*e},average:function(t,e){return.5*(t+e)},add:function(t,e){return Math.min(255,t+e)},substract:function(t,e){return 255>t+e?0:t+e-255},difference:function(t,e){return Math.abs(t-e)},negation:function(t,e){return 255-Math.abs(255-t-e)},screen:function(t,e){return 255-((255-t)*(255-e)>>8)},exclusion:function(t,e){return t+e-.003921568627451*2*t*e},overlay:function(t,e){return 128>e?.003921568627451*2*t*e:255-.003921568627451*2*(255-t)*(255-e)},softLight:function(t,e){return 128>e?2*((t>>1)+64)*.003921568627451*e:255-.003921568627451*2*(255-((t>>1)+64))*(255-e)},hardLight:function(t,e){return 128>t?.003921568627451*2*e*t:255-.003921568627451*2*(255-e)*(255-t)},colorDodge:function(t,e){return 255==e?e:Math.min(255,(t<<8)/(255-e))},colorBurn:function(t,e){return 0==e?e:Math.max(0,255-(255-t<<8)/e)},linearLight:function(t,n){return 128>n?e.linearBurn(t,2*n):e.linearDodge(t,2*(n-128))},vividLight:function(t,n){return 128>n?e.colorBurn(t,2*n):e.colorDodge(t,2*(n-128))},pinLight:function(t,n){return 128>n?e.darken(t,2*n):e.lighten(t,2*(n-128))},hardMix:function(t,n){return e.vividLight(t,n)<128?0:255},reflect:function(t,e){return 255==e?e:Math.min(255,t*t/(255-e))},glow:function(t,e){return 255==t?t:Math.min(255,e*e/(255-t))},phoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}},e.linearDodge=e.add,e.linearBurn=e.substract;var h=t.Image=function(t,e){this.width=0,this.height=0,this.context=null,this.imageData=null,this.domElement=this.canvasElement=a(this.width,this.height),this.context=this.canvasElement.getContext("2d"),this._tmpCanvas=a(this.width,this.height),this.webgl=null,this._histogram=null,this._integral=null,this._histogramRefresh=!0,this._integralRefresh=!0,this.setImage(t,e)};h.prototype={constructor:h,width:0,height:0,canvasElement:null,domElement:null,context:null,webgl:null,setWidth:function(t){return this.imageData=this._setDimensions(t).context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},setHeight:function(t){return this.imageData=this._setDimensions(t).context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},setDimensions:function(t,e){return this.imageData=this._setDimensions(t,e).context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},setImage:function(e,n){if("undefined"==typeof e||null==e)return this;var i,r,s,a,h=this;return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?(i=e,s=i instanceof HTMLVideoElement?i.videoWidth:i.width,a=i instanceof HTMLVideoElement?i.videoHeight:i.height,r=h.context=h._setDimensions(s,a).canvasElement.getContext("2d"),r.drawImage(i,0,0),h.imageData=r.getImageData(0,0,s,a),h._histogramRefresh=!0,h._integralRefresh=!0,h.webgl=t.useWebGL?new t.WebGL(h.canvasElement):null):(i=new Image,i.onload=function(){s=i.width,a=i.height,r=h.context=h._setDimensions(s,a).canvasElement.getContext("2d"),r.drawImage(i,0,0),h.imageData=r.getImageData(0,0,s,a),h._histogramRefresh=!0,h._integralRefresh=!0,h.webgl=t.useWebGL?new t.WebGL(h.canvasElement):null,"undefined"!=typeof n&&n.call(h)},i.src=e),i.crossOrigin="",this},getPixel:function(t,e){var n=~~(e*this.width+t+.5),i=this.imageData.data;return{r:i[n],g:i[n+1],b:i[n+2],a:i[n+3]}},setPixel:function(t,e,n,i,s,a){var h=new r([255&n,255&i,255&s,255&a]);return this.context.putImageData(h,t,e),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},getData:function(){return new r(this.imageData.data)},setData:function(t){return this.imageData.data.set(t),this.context.putImageData(this.imageData,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},getPixelData:function(){return this.imageData},setPixelData:function(t){return this.context.putImageData(t,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},createImageData:function(t,e){return this.context=this._setDimensions(t,e).canvasElement.getContext("2d"),this.context.createImageData(t,e),this.imageData=this.context.getImageData(0,0,this.width,this.height),this.imageData},copy:function(t){return this.setData(t.getData()),this.imageData=this.context.getImageData(0,0,this.width,this.height),this},clone:function(){return new h(this.canvasElement)},scale:function(t,e){if(t=t||1,e=e||t,1==t&&1==e)return this;var i=this._tmpCanvas.getContext("2d");return i.scale(t,e),i.drawImage(this.canvasElement,0,0),this.width=~~(t*this.width+.5),this.height=~~(e*this.height+.5),this.canvasElement.style.width=this.width+"px",this.canvasElement.style.height=this.height+"px",this.canvasElement.width=this.width*n,this.canvasElement.height=this.height*n,this.context.drawImage(this._tmpCanvas,0,0),this._tmpCanvas.width=this.width,this._tmpCanvas.height=this.height,this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},flipHorizontal:function(){var t=this._tmpCanvas.getContext("2d");return t.translate(this.width,0),t.scale(-1,1),t.drawImage(this.canvasElement,0,0),this.context.drawImage(this._tmpCanvas,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},flipVertical:function(){var t=this._tmpCanvas.getContext("2d");return t.translate(0,this.height),t.scale(1,-1),t.drawImage(this.canvasElement,0,0),this.context.drawImage(this._tmpCanvas,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},clear:function(){if(this.width&&this.height){var t=this.context;t.clearRect(0,0,this.width,this.height),this.imageData=t.getImageData(0,0,this.width,this.height)}return this},fill:function(t,e,n,i,r){if(!i&&this.width&&!r&&this.height)return this;i&&!this.width&&r&&!this.height&&(this.context=this._setDimensions(i,r).canvasElement.getContext("2d"),this.context.createImageData(i,r),this.imageData=this.context.getImageData(0,0,this.width,this.height)),t=t||0,e=e||0,n=n||0,i=i||this.width,r=r||this.height;var s=this.context;return s.fillStyle=t,s.fillRect(e,n,i,r),this.imageData=s.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},draw:function(){return this},blend:function(t,n,r,s,a){"undefined"==typeof n&&(n="normal"),"undefined"==typeof r&&(r=1),r>1?r=1:0>r&&(r=0),"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=0);var h=0,o=0,u=this.context;if(0>s&&(h=-s,s=0),0>a&&(o=-a,a=0),s>=this.width||a>=this.height)return this;var c=e[n];if(void 0==c||null==c)return this;var f,l,d,p,m,g,_,y=i(this.width,t.width-h),A=i(this.height,t.height-o),w=this.context.getImageData(s,a,y,A),v=t.context.getImageData(h,o,y,A),L=w.data,E=v.data,M=1-r,x=E.length;for(_=0;x>_;_+=4)p=L[_],m=L[_+1],g=L[_+2],f=c(E[_],p),l=c(E[_+1],m),d=c(E[_+2],g),L[_]=f*r+p*M,L[_+1]=l*r+m*M,L[_+2]=d*r+g*M;return u.putImageData(w,s,a),this.imageData=u.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},integral:function(){return this._integralRefresh&&this._computeIntegral(),this._integral},histogram:function(){return this._histogramRefresh&&this._computeHistogram(),this._histogram},_setDimensions:function(t,e){return this._tmpCanvas.style.width=this.canvasElement.style.width=t+"px",this._tmpCanvas.width=this.canvasElement.width=this.width=t*n,this._tmpCanvas.style.height=this.canvasElement.style.height=e+"px",this._tmpCanvas.height=this.canvasElement.height=this.height=e*n,this},_setWidth:function(t){return this._tmpCanvas.style.width=this.canvasElement.style.width=t+"px",this._tmpCanvas.width=this.canvasElement.width=this.width=t*n,this},_setHeight:function(t){return this._tmpCanvas.style.height=this.canvasElement.style.height=t+"px",this._tmpCanvas.height=this.canvasElement.height=this.height=t*n,this},_computeIntegral:function(){var t,e,n,i,r,a,h=this.width,o=this.height,u=h*o,c=h<<2,f=new s(u),l=new s(u),d=new s(u),p=this.getPixelData().data;for(t=0,e=0,n=0,i=r=a=0;h>n;)i+=p[t],r+=p[t+1],a+=p[t+2],f[e]=i,l[e]=r,d[e]=a,t+=4,e++,n++;for(t=c,n=0,i=r=a=0;imLen>t;)i+=p[t],r+=p[t+1],a+=p[t+2],f[e]=f[e-h]+i,l[e]=l[e-h]+r,d[e]=d[e-h]+a,t+=4,e++,n++,n>=h&&(n=0,i=r=a=0);this._integral=[f,l,d],this._integralRefresh=!1},_computeHistogram:function(){var t,e,n,i,r=this.getPixelData().data,i=0,a=r.length,h=0,o=0,u=0,c=255,f=255,l=255,d=new s(256),p=new s(256),m=new s(256),g=1/(a>>2);for(i=0;256>i;)d[i]=0,p[i]=0,m[i]=0,i++;for(i=0;a>i;)t=r[i],e=r[i+1],n=r[i+2],d[t]+=g,p[e]+=g,m[n]+=g,t>h&&(h=t),c>t&&(c=t),e>o&&(o=e),f>e&&(f=e),n>u&&(u=n),l>n&&(l=n),i+=4;this._histogram=[d,p,m],this._histogramRefresh=!1},_refresh:function(){return this.context=this.canvasElement.getContext("2d"),this.imageData=this.context.getImageData(0,0,this.width,this.height),this}}}(FILTER),function(t){var e=t.CustomFilter=function(t){this._handler=t};e.prototype={constructor:e,_handler:null,_apply:function(t,e,n,i){return this._handler?this._handler.call(this,t,e,n,i):t},apply:function(t){return this._handler?t.setData(this._handler.call(this,t.getData(),t.width,t.height,t)):t}}}(FILTER),function(t){function e(t,e){var n,r,s,a,h,o=new i(20);return n=e[0],r=e[1],s=e[2],a=e[3],h=e[4],o[0]=n*t[0]+r*t[5]+s*t[10]+a*t[15],o[1]=n*t[1]+r*t[6]+s*t[11]+a*t[16],o[2]=n*t[2]+r*t[7]+s*t[12]+a*t[17],o[3]=n*t[3]+r*t[8]+s*t[13]+a*t[18],o[4]=n*t[4]+r*t[9]+s*t[14]+a*t[19]+h,n=e[5],r=e[6],s=e[7],a=e[8],h=e[9],o[5]=n*t[0]+r*t[5]+s*t[10]+a*t[15],o[6]=n*t[1]+r*t[6]+s*t[11]+a*t[16],o[7]=n*t[2]+r*t[7]+s*t[12]+a*t[17],o[8]=n*t[3]+r*t[8]+s*t[13]+a*t[18],o[9]=n*t[4]+r*t[9]+s*t[14]+a*t[19]+h,n=e[10],r=e[11],s=e[12],a=e[13],h=e[14],o[10]=n*t[0]+r*t[5]+s*t[10]+a*t[15],o[11]=n*t[1]+r*t[6]+s*t[11]+a*t[16],o[12]=n*t[2]+r*t[7]+s*t[12]+a*t[17],o[13]=n*t[3]+r*t[8]+s*t[13]+a*t[18],o[14]=n*t[4]+r*t[9]+s*t[14]+a*t[19]+h,n=e[15],r=e[16],s=e[17],a=e[18],h=e[19],o[15]=n*t[0]+r*t[5]+s*t[10]+a*t[15],o[16]=n*t[1]+r*t[6]+s*t[11]+a*t[16],o[17]=n*t[2]+r*t[7]+s*t[12]+a*t[17],o[18]=n*t[3]+r*t[8]+s*t[13]+a*t[18],o[19]=n*t[4]+r*t[9]+s*t[14]+a*t[19]+h,o}function n(t,e,n){var r=1-n,s=new i(20);return s[0]=r*t[0]+n*e[0],s[1]=r*t[1]+n*e[1],s[2]=r*t[2]+n*e[2],s[3]=r*t[3]+n*e[3],s[4]=r*t[4]+n*e[4],s[5]=r*t[5]+n*e[5],s[6]=r*t[6]+n*e[6],s[7]=r*t[7]+n*e[7],s[8]=r*t[8]+n*e[8],s[9]=r*t[9]+n*e[9],s[10]=r*t[10]+n*e[10],s[11]=r*t[11]+n*e[11],s[12]=r*t[12]+n*e[12],s[13]=r*t[13]+n*e[13],s[14]=r*t[14]+n*e[14],s[15]=r*t[15]+n*e[15],s[16]=r*t[16]+n*e[16],s[17]=r*t[17]+n*e[17],s[18]=r*t[18]+n*e[18],s[19]=r*t[19]+n*e[19],s}var i=t.Array32F,r=t.CONSTANTS.toRad,s=(t.CONSTANTS.toDeg,t._notSupportTypedArrays),a=t.ColorMatrixFilter=function(e){this._matrix="undefined"!=typeof e&&e.length?new i(e):null,t.useWebGL&&(this._webglInstance=t.WebGLColorMatrixFilterInstance)};a.prototype={constructor:a,_matrix:null,_webglInstance:null,channel:function(e,n){n="undefined"==typeof n?!1:n;var i=n?1:0;switch(e){case t.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case t.CHANNEL.BLUE:return this.concat([0,0,i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,0,0,255]);case t.CHANNEL.GREEN:return this.concat([0,i,0,0,0,0,1,0,0,0,0,i,0,0,0,0,0,0,0,255]);case t.CHANNEL.RED:default:return this.concat([1,0,0,0,0,i,0,0,0,0,i,0,0,0,0,0,0,0,0,255])}},redChannel:function(e){return this.channel(t.CHANNEL.RED,e)},greenChannel:function(e){return this.channel(t.CHANNEL.GREEN,e)},blueChannel:function(e){return this.channel(t.CHANNEL.BLUE,e)},alphaChannel:function(){return this.channel(t.CHANNEL.ALPHA,!0)},maskChannel:function(e){switch(e){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.concat([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(e,n){switch(e){case t.CHANNEL.ALPHA:switch(n){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.RED:default:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case t.CHANNEL.BLUE:switch(n){case t.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.BLUE:return this;case t.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case t.CHANNEL.GREEN:switch(n){case t.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this;case t.CHANNEL.RED:default:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case t.CHANNEL.RED:default:switch(n){case t.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case t.CHANNEL.BLUE:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this}}},desaturate:function(){return this.concat([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,0,0,0,1,0])},colorize:function(e,n){var i,r,s,a;return"undefined"==typeof n&&(n=1),i=.00392156862745098*(255&e>>16),r=.00392156862745098*(255&e>>8),s=.00392156862745098*(255&e),a=1-n,this.concat([a+n*i*t.LUMA[0],n*i*t.LUMA[1],n*i*t.LUMA[2],0,0,n*r*t.LUMA[0],a+n*r*t.LUMA[1],n*r*t.LUMA[2],0,0,n*s*t.LUMA[0],n*s*t.LUMA[1],a+n*s*t.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(e){var n,i,r,s;return n=1-e,i=n*t.LUMA[0],r=n*t.LUMA[1],s=n*t.LUMA[2],this.concat([i+e,r,s,0,0,i,r+e,s,0,0,i,r,s+e,0,0,0,0,0,1,0])},contrast:function(t,e,n){return"undefined"==typeof e&&(e=t),"undefined"==typeof n&&(n=t),t+=1,e+=1,n+=1,this._log=!0,this.concat([t,0,0,0,128*(1-t),0,e,0,0,128*(1-e),0,0,n,0,128*(1-n),0,0,0,1,0])},brightness:function(t,e,n){return"undefined"==typeof e&&(e=t),"undefined"==typeof n&&(n=t),this.concat([1,0,0,0,t,0,1,0,0,e,0,0,1,0,n,0,0,0,1,0])},adjustHue:function(e){e*=r;var n=Math.cos(e),i=Math.sin(e);return this.concat([t.LUMA[0]+n*(1-t.LUMA[0])+i*-t.LUMA[0],t.LUMA[1]+n*-t.LUMA[1]+i*-t.LUMA[1],t.LUMA[2]+n*-t.LUMA[2]+i*(1-t.LUMA[2]),0,0,t.LUMA[0]+n*-t.LUMA[0]+.143*i,t.LUMA[1]+n*(1-t.LUMA[1])+.14*i,t.LUMA[2]+n*-t.LUMA[2]+i*-.283,0,0,t.LUMA[0]+n*-t.LUMA[0]+i*-(1-t.LUMA[0]),t.LUMA[1]+n*-t.LUMA[1]+i*t.LUMA[1],t.LUMA[2]+n*(1-t.LUMA[2])+i*t.LUMA[2],0,0,0,0,0,1,0])},average:function(t,e,n){return"undefined"==typeof t&&(t=.3333),"undefined"==typeof e&&(e=.3333),"undefined"==typeof n&&(n=.3334),this.concat([t,e,n,0,0,t,e,n,0,0,t,e,n,0,0,0,0,0,1,0])},quickContrastCorrection:function(t){return"undefined"==typeof t&&(t=1.2),this.concat([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0])},sepia:function(t){return"undefined"==typeof t&&(t=.5),t>1?t=1:0>t&&(t=0),this.concat([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0])},quickSepia:function(e){return"undefined"==typeof e&&(e=10),e>100&&(e=100),e*=2.55,this.concat([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,40,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,20,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,-e,0,0,0,1,0])},threshold:function(e,n){return"undefined"==typeof n&&(n=256),this.concat([t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*e,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*e,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*e,0,0,0,1,0])},threshold_rgb:function(t,e){return"undefined"==typeof e&&(e=256),this.concat([e,0,0,0,-(e-1)*t,0,e,0,0,-(e-1)*t,0,0,e,0,-(e-1)*t,0,0,0,1,0])},threshold_alpha:function(t,e){return"undefined"==typeof t&&(t=.5),"undefined"==typeof e&&(e=256),this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,e,-e*t])},RGB2YCbCr:function(){return this.concat([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.concat([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(t,e){return this._matrix=this._matrix?n(this._matrix,t.getMatrix(),e):new i(t.getMatrix()),this},concat:function(t){return this._matrix=this._matrix?e(this._matrix,new i(t)):new i(t),this},combineWith:function(t){return this.concat(t.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(t){return this._matrix=t,this},_apply:function(t){if(!this._matrix)return t;for(var e,n,i,r,a,h,o,u,c=t.length,f=this._matrix,l=0;c>l;)e=t[l],n=t[l+1],i=t[l+2],r=t[l+3],a=f[0]*e+f[1]*n+f[2]*i+f[3]*r+f[4],h=f[5]*e+f[6]*n+f[7]*i+f[8]*r+f[9],o=f[10]*e+f[11]*n+f[12]*i+f[13]*r+f[14],u=f[15]*e+f[16]*n+f[17]*i+f[18]*r+f[19],s&&(0>a?a=0:a>255&&(a=255),0>h?h=0:h>255&&(h=255),0>o?o=0:o>255&&(o=255),0>u?u=0:u>255&&(u=255)),t[l]=~~a,t[l+1]=~~h,t[l+2]=~~o,t[l+3]=~~u,l+=4;return t},apply:function(t){return this._matrix?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},reset:function(){return this._matrix=null,this}},a.prototype.grayscale=a.prototype.desaturate}(FILTER),function(t){function e(t){var e=new r(256),n=0;if(t)for(;256>n;)e[n]=255-n,n++;else for(;256>n;)e[n]=n,n++;return e}function n(t){for(var e=new r(256),n=0;256>n;)e[n]=t,n++;return e}function i(t){return t?new r(t):null}var r=t.ImArray,s=Math.pow,a=Math.exp,h=1/255,o=e(),u=e(1),c=t.TableLookupFilter=function(t,e,n,i){this._tableR=t||null,this._tableG=e||this._tableR,this._tableB=n||this._tableG,this._tableA=i||null};c.prototype={constructor:c,_tableR:null,_tableG:null,_tableB:null,_tableA:null,thresholds:function(t,e,n){t.length||(t=[t]),e||(e=t),n||(n=e);var i,s,a=t.length,h=a+1,o=e.length,u=o+1,c=n.length,f=c+1,l=new r(256),d=new r(h),p=new r(256),m=new r(u),g=new r(256),_=new r(f),y=255/(h-1),A=255/(u-1),w=255/(f-1);for(i=0;h>i;)d[i]=~~(y*i),i++;for(t[0]=~~(255*t[0]),i=1;a>i;)t[i]=t[i-1]+~~(255*t[i]),i++;for(i=0;u>i;)m[i]=~~(A*i),i++;for(e[0]=~~(255*e[0]),i=1;o>i;)e[i]=e[i-1]+~~(255*e[i]),i++;for(i=0;f>i;)_[i]=~~(w*i),i++;for(n[0]=~~(255*n[0]),i=1;c>i;)n[i]=n[i-1]+~~(255*n[i]),i++;for(i=0;256>i;){for(s=0;a>s&&i>t[s];)s++;for(l[i]=d[s],s=0;o>s&&i>e[s];)s++;for(p[i]=m[s],s=0;c>s&&i>n[s];)s++;g[i]=_[s],i++}return this.concat(l,p,g)},threshold:function(t,e,n){return t=t||.5,e=e||t,n=n||e,this.thresholds([t],[e],[n])},quantize:function(t){"undefined"==typeof t&&(t=64),2>t&&(t=2);var e,n=new r(256),i=new r(t),s=255/(t-1),a=t/256;for(e=0;t>e;)i[e]=~~(s*e),e++;for(e=0;256>e;)n[e]=i[~~(a*e)],e++;return this.concat(n)},levels:function(t){return this.quantize(t)},posterize:function(t){return this.quantize(t)},binarize:function(){return this.quantize(2)},solarize:function(t){"undefined"==typeof t&&(t=.5);var e=0,n=new r(256);for(t=~~(256*t)-1,e=0;256>e;)n[e]=e>t?255-(e<<1):(e<<1)-255,e++;return this.concat(n)},invert:function(){return this.concat(u)},mask:function(t){var e=0,n=255&t>>16,i=255&t>>8,s=255&t;for(tR=new r(256),tG=new r(256),tB=new r(256),e=0;256>e;)tR[e]=e&n,tG[e]=e&i,tB[e]=e&s,e++;return this.concat(tR,tG,tB)},replace:function(t,e){if(t==e)return this;var n=255&t>>16,r=255&t>>8,s=255&t,a=255&e>>16,h=255&e>>8,u=255&e,c=i(o),f=i(o),l=i(o);return c[n]=a,f[r]=h,l[s]=u,this.concat(c,f,l)},extract:function(e,i,r){if(!i||!i.length)return this;r=r||0;var s,a,h=255&r>>16,o=255&r>>8,u=255&r,c=n(h),f=n(o),l=n(u);switch(e){case t.CHANNEL.BLUE:for(s=i[0],a=i[1];a>=s;)l[s]=s,s++;break;case t.CHANNEL.GREEN:for(s=i[0],a=i[1];a>=s;)f[s]=s,s++;break;case t.CHANNEL.RED:default:for(s=i[0],a=i[1];a>=s;)c[s]=s,s++}return this.concat(c,f,l)},gammaCorrection:function(t,e,n){t=t||1,e=e||t,n=n||e,t=1/t,e=1/e,n=1/n;for(var i=new r(256),a=new r(256),o=new r(256),u=0;256>u;)i[u]=~~(255*s(h*u,t)),a[u]=~~(255*s(h*u,e)),o[u]=~~(255*s(h*u,n)),u++;return this.concat(i,a,o)},exposure:function(t){"undefined"==typeof t&&(t=1);var e=0,n=new r(256);for(e=0;256>e;)n[e]=~~(255*(1-a(-t*e*h))),e++;return this.concat(n)},concat:function(t,n,r){if(!t)return this;n=n||t,r=r||n;var s,a,h,o,u,c=this._tableR||e(),f=i(c);if(n&&r){for(s=this._tableG||i(c),a=this._tableB||i(s),h=i(s),o=i(a),u=0;256>u;)c[u]=t[f[u]],s[u]=n[h[u]],a[u]=r[o[u]],u++;this._tableR=c,this._tableG=s,this._tableB=a}else{for(u=0;256>u;)c[u]=t[f[u]],u++;this._tableR=c,this._tableG=this._tableR,this._tableB=this._tableR}return this},combineWith:function(t){return this.concat(t.getTable(0),t.getTable(1),t.getTable(2))},getTable:function(e){switch(e=e||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA;case t.CHANNEL.BLUE:return this._tableB;case t.CHANNEL.GREEN:return this._tableG;case t.CHANNEL.RED:default:return this._tableR}},setTable:function(e,n){switch(n=n||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA=e,this;case t.CHANNEL.BLUE:return this._tableB=e,this;case t.CHANNEL.GREEN:return this._tableG=e,this;case t.CHANNEL.RED:default:return this._tableR=e,this}},_apply:function(t){if(!this._tableR)return t;var e,n,i,r,s=t.length,a=0,h=this._tableR,o=this._tableG,u=this._tableB,c=this._tableA;if(c)for(;s>a;)e=t[a],n=t[a+1],i=t[a+2],r=t[a+3],t[a]=h[e],t[a+1]=o[n],t[a+2]=u[i],t[a+3]=c[r],a+=4;else for(;s>a;)e=t[a],n=t[a+1],i=t[a+2],t[a]=h[e],t[a+1]=o[n],t[a+2]=u[i],a+=4;return t},apply:function(t){return this._tableR?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},reset:function(){return this._tableR=null,this._tableG=null,this._tableB=null,this._tableA=null,this}}}(FILTER),function(t){var e=t.ImArray,n=Math.min;Math.max;var i=t.DisplacementMapFilter=function(t){t&&this.setMap(t)};i.prototype={constructor:i,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:t.MODE.CLAMP,_map:null,combineWith:function(){return this},getMap:function(){return this._map},setMap:function(t){return this._map=t,this},_apply:function(i,r,s){if(!this._map)return i;var a,h,o,u,c,f,l,d,p,m,g=this._map.getData(),_=this._map.width,y=this._map.height,A=_*y,w=new t.Array16I(A<<1),v=n(_,r),L=n(y,s),E=.00390625*this.scaleX,M=.00390625*this.scaleY,x=this.componentX,b=this.componentY,C=255&this.color>>24,D=255&this.color>>16,R=255&this.color>>8,N=255&this.color,I=~~this.startY,U=~~this.startX,H=this.mode,k=I*r,G=-U,T=-I,F=r-U-1,P=s-I-1,B=v*L<<2,S=(i.length,new e(i)),O=t.MODE.IGNORE,W=t.MODE.CLAMP,Y=t.MODE.COLOR,X=t.MODE.WRAP;for(a=0,h=0,o=0,u=0,c=0;A>a;)d=o+c<<2,w[h]=~~((g[d+x]-128)*E),w[h+1]=~~((g[d+b]-128)*M),a++,h+=2,o++,o>=_&&(o=0,u++,c+=_);for(a=-4,o=-1,u=0,c=0,ty2=0;B>a;)if(a+=4,o++,o>=v&&(o=0,u++,c+=r,ty2+=_),!(T>u||u>P||G>o||o>F)){if(l=o+U,f=u+I,p=l+c+k<<2,h=o+ty2<<1,srcx=l+w[h],srcy=f+w[h+1],srcy>=s||0>srcy||srcx>=r||0>srcx)switch(H){case O:continue;case Y:S[p]=D,S[p+1]=R,S[p+2]=N,S[p+3]=C;continue;case X:srcy>P?srcy-=s:0>srcy&&(srcy+=s),srcx>F?srcx-=r:0>srcx&&(srcx+=r);break;case W:default:srcy>P?srcy=P:0>srcy&&(srcy=0),srcx>F?srcx=F:0>srcx&&(srcx=0)}m=srcx+srcy*r<<2,S[p]=i[m],S[p+1]=i[m+1],S[p+2]=i[m+2],S[p+3]=i[m+3]}return S},apply:function(t){return this._map?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},reset:function(){return this._map=null,this}}}(FILTER),function(t){function e(t,e){var n,i,r,s,a,h=t.length,o=new l(h);for(s=0,n=0,i=0,r=0;h>s;)a=e-1-n+r<<2,o[s]=t[a],o[s+1]=t[a+1],o[s+2]=t[a+2],o[s+3]=t[a+3],s+=4,n++,n>=e&&(n=0,i++,r+=e);return o}function n(t,e,n){var i,r,s,a,h,o=t.length,u=new l(o);for(a=0,i=0,r=0,s=(n-1)*e;o>a;)h=i+s<<2,u[a]=t[h],u[a+1]=t[h+1],u[a+2]=t[h+2],u[a+3]=t[h+3],a+=4,i++,i>=e&&(i=0,r++,s-=e);return u}function i(t,e,n){var i,r,s,a,h,o,u=t.length,c=new l(u);for(h=0,i=0,r=0,a=(n-1)*e;u>h;)o=e-1-i+a<<2,c[h]=t[o],c[h+1]=t[o+1],c[h+2]=t[o+2],c[h+3]=t[o+3],h+=4,i++,i>=e&&(i=0,r++,s+=e,a-=e);return c}function r(t,e,n){var i,r,s,a,h,o=t.length,u=new l(o),c=n*e;for(a=0,i=0,r=0,s=c-1;o>a;)h=r+s<<2,u[a]=t[h],u[a+1]=t[h+1],u[a+2]=t[h+2],u[a+3]=t[h+3],a+=4,i++,s-=e,i>=e&&(i=0,s=c-1,r++);return u}function s(t,e,n){var i,r,s,a,h,o=t.length,u=new l(o);for(a=0,i=0,r=0,s=0;o>a;)h=e-1-r+s<<2,u[a]=t[h],u[a+1]=t[h+1],u[a+2]=t[h+2],u[a+3]=t[h+3],a+=4,i++,s+=e,i>=e&&(i=0,s=0,r++);return u}function a(e,n,i){var r,s,a,h,o,u,c,f=e.length,d=new l(f),p=this.inverseTransform,m=this.mode,g=t.MODE.CLAMP,_=t.MODE.WRAP;for(a=0,r=0,s=0;f>a;){if(o=p([r,s],n,i),u=~~o[0],c=~~o[1],0>u||u>=n||0>c||c>=i)switch(m){case _:c>=i?c-=i:0>c&&(c+=i),u>=n?u-=n:0>u&&(u+=n);break;case g:default:c>=i?c=i-1:0>c&&(c=0),u>=n?u=n-1:0>u&&(u=0)}h=u+c*n<<2,d[a]=e[h],d[a+1]=e[h+1],d[a+2]=e[h+2],d[a+3]=e[h+3],a+=4,r++,r>=n&&(r=0,s++)}return d}function h(e,n,i){var r,s,a,h,o,u,c,f,d,p=n*i,m=e.length,g=new l(m),_=this.matrix,y=_[0],A=_[1],w=_[3],v=_[4],L=_[2],E=_[5],M=this.mode,x=t.MODE.CLAMP,b=t.MODE.WRAP,C=n-1,D=p-n;for(a=0,r=0,s=0,o=E*n,u=w*n,c=v*n;m>a;){if(f=~~(y*r+A*s+L),d=~~(u*r+c*s+o),0>f||f>C||0>d||d>D)switch(M){case b:d>D?d-=p:0>d&&(d+=p),f>=n?f-=n:0>f&&(f+=n);break;case x:default:d>D?d=D:0>d&&(d=0),f>C?f=C:0>f&&(f=0)}h=f+d<<2,g[a]=e[h],g[a+1]=e[h+1],g[a+2]=e[h+2],g[a+3]=e[h+3],a+=4,r++,r>=n&&(r=0,s++)}return g}function o(e,n,i){if(0>=this.radius)return e;var r,s,a,h,o,u,c,f,_=e.length,y=new l(e),A=this.centerX,w=this.centerY,v=this.angle,L=this.radius,E=this.mode,M=t.MODE.CLAMP,x=t.MODE.WRAP,b=v/L,C=n-1,D=i-1;for(a=0,r=0,s=0;_>a;){if(u=r-A,c=s-w,o=d(u*u+c*c),L>o){if(f=p(c,u)+b*(L-o),u=~~(A+o*g(f)),c=~~(w+o*m(f)),0>u||u>C||0>c||c>D)switch(E){case x:c>D?c-=i:0>c&&(c+=i),u>C?u-=n:0>u&&(u+=n);break;case M:default:c>D?c=D:0>c&&(c=0),u>C?u=C:0>u&&(u=0)}h=u+c*n<<2,y[a]=e[h],y[a+1]=e[h+1],y[a+2]=e[h+2],y[a+3]=e[h+3]}a+=4,r++,r>=n&&(r=0,s++)}return y}function u(e,n,i){if(0>=this.radius)return e;var r,s,a,h,o,u,c,f,p,m,g,A,w,v=e.length,L=new l(e),E=this.centerX,M=this.centerY,x=this.radius,b=this.mode,C=t.MODE.CLAMP,D=t.MODE.WRAP,R=x*x,N=.555556,I=1-N,U=n-1,H=i-1;for(a=0,r=0,s=0;v>a;){if(o=r-E,u=s-M,A=o*o,w=u*u,c=A+w,R>c){if(m=R-c,g=d(m),f=_(o/d(A+m))*I,p=_(u/d(w+m))*I,o=~~(r-g*y(f)),u=~~(s-g*y(p)),0>o||o>U||0>u||u>H)switch(b){case D:u>H?u-=i:0>u&&(u+=i),o>U?o-=n:0>o&&(o+=n);break;case C:default:u>H?u=H:0>u&&(u=0),o>U?o=U:0>o&&(o=0)}h=o+u*n<<2,L[a]=e[h],L[a+1]=e[h+1],L[a+2]=e[h+2],L[a+3]=e[h+3]}a+=4,r++,r>=n&&(r=0,s++)}return L}function c(t){return t}function f(t){return t}var l=t.ImArray,d=(t.CONSTANTS.PI,Math.sqrt),p=Math.atan2,m=Math.sin,g=Math.cos,_=Math.asin,y=Math.tan;Math.abs,t.CONSTANTS.toRad;var A=t.GeometricMapFilter=function(t){this.generic(t)};A.prototype={constructor:A,_map:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,angle:0,radius:0,mode:t.MODE.CLAMP,generic:function(t){return t&&(this.inverseTransform=t,this._map=a),this
},affine:function(t){return t&&(this.matrix=t,this._map=h),this},flipX:function(){return this._map=e,this},flipY:function(){return this._map=n,this},flipXY:function(){return this._map=i,this},rotateCW:function(){return this._map=r,this},rotateCCW:function(){return this._map=s,this},polar:function(t,e){return this.centerX=t||0,this.centerY=e||0,this._map=c,this},cartesian:function(t,e){return this.centerX=t||0,this.centerY=e||0,this._map=f,this},twirl:function(t,e,n,i){return this.angle=t||0,this.radius=e||0,this.centerX=n||0,this.centerY=i||0,this._map=o,this},sphere:function(t,e,n){return this.radius=t||0,this.centerX=e||0,this.centerY=n||0,this._map=u,this},combineWith:function(){return this},getMap:function(){return this._map},setMap:function(t){return this._map=t,this},_apply:function(t,e,n,i){return this._map?this._map.call(this,t,e,n,i):t},apply:function(t){return this._map?t.setData(this._map.call(this,t.getData(),t.width,t.height,t)):t},reset:function(){return this._map=null,this}}}(FILTER),function(t){function e(t,e,n,i){var r,s=t.length,a=new _(t.length);for(n=n||1,i=i||1,r=0;s>r;)a[r]=n*t[r]+i*e[r],r++;return a}function n(t,e){var n,i,r,s=t.length,a=[],h=0;for(n=0;s>n;n++)for(i=0;s>i;i++)r=t[n]*e[i],h+=r,a.push(r);return{kernel:a,sum:h}}function i(t){var e,n=new Array(t);for(e=0;t>e;)n[e]=1,e++;return n}function r(t){var e,n,i,r,s=A.length;if(t--,s>t)e=new _(A[t]);else for(e=new _(A[s-1]);t>=s;){for(n=e,e=new _(n.length+1),e[0]=1,i=0,r=n.length-1;r>i;i++)e[i+1]=n[i]+n[i+1];e[n.length]=1,40>s&&A.push(new Array(e)),s++}return e}function s(t){var e,n=t>>1,i=-n,r=new Array(t);for(e=0;t>e;)r[e]=i,i++,e++;return r}function a(t){var e=r(t);return n(e,e)}function h(t,e){var i=r(t),a=s(t);return 1==e?n(a.reverse(),i):n(i,a)}function o(t,e){var r=i(t),a=s(t);return 1==e?n(a.reverse(),r):n(r,a)}function u(t,e,n){e=e||1,n=n||e;var i,r=t*t,s=r>>1,a=new _(r);for(i=0;r>i;)a[i]=e,i++;return a[s]=n,a}function c(t,e,n,i){var r,s,a,h,o,u=t*t,c=t>>1,f=u>>1,l=new _(u);for(h=0,r=0;c>=r;r++){for(s=0,o=0,a=0;c>=a;a++)l[f+r+s]=h+o,l[f-r-s]=-h-o,l[f-r+s]=-h+o,l[f+r-s]=h-o,s+=t,o+=n;h+=e}return i=i||1,l[f]=i,l}function f(t,e,n,i){var r,s,a,h,o,u,c=t*t,f=t>>1,l=c>>1,d=new _(c),p=new _(c),m=1/t,g=1e-8;for(v(e)>g?(o=1,u=n/e):(o=e/n,u=1),r=0,a=0,h=0,s=u*t;f>=r;)p[l+r]=~~(l+a+h+.5),p[l-r]=~~(l-a-h+.5),r++,a+=o,h+=s;for(r=0;f>=r;)d[p[l+r]]=d[p[l-r]]=m,r++;return i=i||1,d[l]=i,d}function l(e,n,i,r,s,a,h,o,u,c){var f,l,d,p,m,_,A,w,v,L,E,M,x,b,C,D,R,N,I,U,H,k,G,T,F,P,B,S,O,W,Y,X,q,z,V,Q,j,J,K,Z,$,te,ee,ne,ie,re,se,ae,he,oe,ue=e.length,ce=a,fe=h;if(f=n*i,v=ce*fe,A=ce>>1,w=n*(fe>>1),M=-A-1,b=-w-n,x=A,C=w,Y=0,q=n-1,X=0,z=f-n,d=(f<<1)+f,E=(n<<1)+n,c=c||1,oe=0,s)for(H=r[0],k=r[v>>1],G=k-H,T=s[0],F=s[v>>1],P=F-T,ae=o,he=u;c>oe;){for(L=new g(e),l=new t.Array32F(d),D=0,R=0,N=0,p=m=_=0;n>N;)p+=e[D],m+=e[D+1],_+=e[D+2],l[R]=p,l[R+1]=m,l[R+2]=_,D+=4,R+=3,N++;for(D=E+n,R=E,N=0,p=m=_=0;ue>D;)p+=e[D],m+=e[D+1],_+=e[D+2],l[R]=l[R-E]+p,l[R+1]=l[R-E+1]+m,l[R+2]=l[R-E+2]+_,D+=4,R+=3,N++,N>=n&&(N=0,p=m=_=0);for(D=0,N=0,I=0,U=0;ue>D;)B=N+M,S=U+b,O=N+x,W=U+C,Y>B?B=Y:O>q&&(O=q),X>S?S=X:W>z&&(W=z),V=B+S,J=O+W,Q=O+S,j=B+W,V=(V<<1)+V,Q=(Q<<1)+Q,j=(j<<1)+j,J=(J<<1)+J,te=H*(l[J]-l[Q]-l[j]+l[V])+G*e[D],ee=H*(l[J+1]-l[Q+1]-l[j+1]+l[V+1])+G*e[D+1],ne=H*(l[J+2]-l[Q+2]-l[j+2]+l[V+2])+G*e[D+2],ie=T*(l[J]-l[Q]-l[j]+l[V])+P*e[D],re=T*(l[J+1]-l[Q+1]-l[j+1]+l[V+1])+P*e[D+1],se=T*(l[J+2]-l[Q+2]-l[j+2]+l[V+2])+P*e[D+2],K=ae*te+he*ie,Z=ae*ee+he*re,$=ae*ne+he*se,y&&(0>K?K=0:K>255&&(K=255),0>Z?Z=0:Z>255&&(Z=255),0>$?$=0:$>255&&($=255)),L[D]=~~K,L[D+1]=~~Z,L[D+2]=~~$,D+=4,N++,N>=n&&(N=0,I++,U+=n);e=L,oe++}else for(H=r[0],k=r[v>>1],G=k-H,o=o||1,u=u||0;c>oe;){for(L=new g(e),l=new t.Array32F(d),D=0,R=0,N=0,p=m=_=0;n>N;)p+=e[D],m+=e[D+1],_+=e[D+2],l[R]=p,l[R+1]=m,l[R+2]=_,D+=4,R+=3,N++;for(D=E+n,R=E,N=0,p=m=_=0;ue>D;)p+=e[D],m+=e[D+1],_+=e[D+2],l[R]=l[R-E]+p,l[R+1]=l[R-E+1]+m,l[R+2]=l[R-E+2]+_,D+=4,R+=3,N++,N>=n&&(N=0,p=m=_=0);for(D=0,N=0,I=0,U=0;ue>D;)B=N+M,S=U+b,O=N+x,W=U+C,Y>B?B=Y:O>q&&(O=q),X>S?S=X:W>z&&(W=z),V=B+S,J=O+W,Q=O+S,j=B+W,V=(V<<1)+V,Q=(Q<<1)+Q,j=(j<<1)+j,J=(J<<1)+J,te=H*(l[J]-l[Q]-l[j]+l[V])+G*e[D],ee=H*(l[J+1]-l[Q+1]-l[j+1]+l[V+1])+G*e[D+1],ne=H*(l[J+2]-l[Q+2]-l[j+2]+l[V+2])+G*e[D+2],K=o*te+u,Z=o*ee+u,$=o*ne+u,y&&(0>K?K=0:K>255&&(K=255),0>Z?Z=0:Z>255&&(Z=255),0>$?$=0:$>255&&($=255)),L[D]=~~K,L[D+1]=~~Z,L[D+2]=~~$,D+=4,N++,N>=n&&(N=0,I++,U+=n);e=L,oe++}return L}function d(e,n,i,r,s,a,h,o,u){var c,f,l,d,p,m,_,A,w,v,L,E,M,x,b,C,D,R,N,I,U,H,k,G,T,F,P,B,S,O,W,Y,X,q,z,V,Q=e.length;for(c=n*i,m=[h,a],_=[s,r],f=[1,a],l=[h,1],d=[0,a>>1],p=[h>>1,0],q=[u,o],T=n-1,F=c-n,V=2;--V;){for(M=new g(e),L=m[V],E=_[V],w=d[V],v=p[V],A=f[V],z=q[V],C=new t.Array16I(L<<1),b=new t.Array8U(L),R=0,N=0,I=0,U=0,H=0,x=v*n;L>N;)b[N]=I+U,C[R]=I-w,C[R+1]=H-x,R+=2,N++,I++,I>=A&&(I=0,U+=A,H+=n);for(D=0,I=0,U=0;Q>D;){for(W=0,Y=0,X=0,R=0,N=0;L>N;)k=I+C[R],G=U+C[R+1],k>=0&&T>=k&&G>=0&&F>=G&&(srcOff=k+G<<2,O=z*E[b[N]],W+=e[srcOff]*O,Y+=e[srcOff+1]*O,X+=e[srcOff+2]*O),R+=2,N++;P=W,B=Y,S=X,y&&(0>P?P=0:P>255&&(P=255),0>B?B=0:B>255&&(B=255),0>S?S=0:S>255&&(S=255)),M[D]=~~P,M[D+1]=~~B,M[D+2]=~~S,M[D+3]=e[D+3],D+=4,I++,I>=n&&(I=0,U+=n)}e=M}return M}function p(e,n,i,r,s,a,h,o){var u,c,f,l,d,p,m,_,A,w,L,E,M,x,b,C,D,R,N,I,U=matRadiusY=3,H=matHalfSideY=1,k=9,G=n,T=new t.Array16I(18),F=new t.Array8U(9),P=n*i,B=e.length,S=new g(B),O=n-1,W=P-n,Y=a,X=h;for(m=0,_=0,A=0,w=0,L=0;k>_;)F[_]=A+w,T[m]=A-H,T[m+1]=L-G,m+=2,_++,A++,A>=U&&(A=0,w+=U,L+=n);if(s)for(p=0,A=0,w=0;B>p;)b=0,C=0,D=0,R=0,N=0,I=0,E=A+T[0],M=w+T[1],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[0]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[0]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[2],M=w+T[3],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[1]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[1]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[4],M=w+T[5],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[2]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[2]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[6],M=w+T[7],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[3]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[3]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[8],M=w+T[9],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[4]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[4]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[10],M=w+T[11],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[5]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[5]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[12],M=w+T[13],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[6]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[6]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[14],M=w+T[15],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[7]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[7]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[16],M=w+T[17],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[8]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[8]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),o?(f=v(b)+v(R),l=v(C)+v(N),d=v(D)+v(I)):(f=Y*b+X*R,l=Y*C+X*N,d=Y*D+X*I),y&&(0>f?f=0:f>255&&(f=255),0>l?l=0:l>255&&(l=255),0>d?d=0:d>255&&(d=255)),S[p]=~~f,S[p+1]=~~l,S[p+2]=~~d,S[p+3]=e[p+3],p+=4,A++,A>=n&&(A=0,w+=n);else for(p=0,A=0,w=0;B>p;)b=0,C=0,D=0,E=A+T[0],M=w+T[1],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[0]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[2],M=w+T[3],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[1]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[4],M=w+T[5],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[2]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[6],M=w+T[7],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[3]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[8],M=w+T[9],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[4]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[10],M=w+T[11],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[5]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[12],M=w+T[13],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[6]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[14],M=w+T[15],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[7]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[16],M=w+T[17],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[8]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),f=a*b+h,l=a*C+h,d=a*D+h,y&&(0>f?f=0:f>255&&(f=255),0>l?l=0:l>255&&(l=255),0>d?d=0:d>255&&(d=255)),S[p]=~~f,S[p+1]=~~l,S[p+2]=~~d,S[p+3]=e[p+3],p+=4,A++,A>=n&&(A=0,w+=n);return S}function m(e,n,i,r,s,a,h,o){var u,c,f,l,d,p,m,_,A,w,L,E,M,x,b,C,D,R,N,I,U=matRadiusY=5,H=matHalfSideY=2,k=25,G=n,T=new t.Array16I(50),F=new t.Array8U(25),P=n*i,B=e.length,S=new g(B),O=n-1,W=P-n,Y=a,X=h;for(m=0,_=0,A=0,w=0,L=0;k>_;)F[_]=A+w,T[m]=A-H,T[m+1]=L-G,m+=2,_++,A++,A>=U&&(A=0,w+=U,L+=n);if(s)for(p=0,A=0,w=0;B>p;)b=0,C=0,D=0,R=0,N=0,I=0,E=A+T[0],M=w+T[1],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[0]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[0]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[2],M=w+T[3],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[1]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[1]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[4],M=w+T[5],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[2]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[2]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[6],M=w+T[7],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[3]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[3]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[8],M=w+T[9],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[4]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[4]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[10],M=w+T[11],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[5]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[5]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[12],M=w+T[13],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[6]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[6]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[14],M=w+T[15],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[7]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[7]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[16],M=w+T[17],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[8]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[8]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[18],M=w+T[19],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[9]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[9]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[20],M=w+T[21],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[10]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[10]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[22],M=w+T[23],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[11]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[11]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[24],M=w+T[25],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[12]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[12]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[26],M=w+T[27],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[13]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[13]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[28],M=w+T[29],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[14]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[14]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[30],M=w+T[31],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[15]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[15]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[32],M=w+T[33],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[16]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[16]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[34],M=w+T[35],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[17]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[17]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[36],M=w+T[27],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[18]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[18]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[38],M=w+T[39],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[19]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[19]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[40],M=w+T[41],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[20]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[20]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[42],M=w+T[43],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[21]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[21]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[44],M=w+T[45],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[22]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[22]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[46],M=w+T[47],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[23]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[23]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),E=A+T[48],M=w+T[49],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[24]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u,c=s[F[24]],R+=e[x]*c,N+=e[x+1]*c,I+=e[x+2]*c),o?(f=v(b)+v(R),l=v(C)+v(N),d=v(D)+v(I)):(f=Y*b+X*R,l=Y*C+X*N,d=Y*D+X*I),y&&(0>f?f=0:f>255&&(f=255),0>l?l=0:l>255&&(l=255),0>d?d=0:d>255&&(d=255)),S[p]=~~f,S[p+1]=~~l,S[p+2]=~~d,S[p+3]=e[p+3],p+=4,A++,A>=n&&(A=0,w+=n);else for(p=0,A=0,w=0;B>p;)b=0,C=0,D=0,E=A+T[0],M=w+T[1],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[0]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[2],M=w+T[3],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[1]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[4],M=w+T[5],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[2]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[6],M=w+T[7],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[3]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[8],M=w+T[9],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[4]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[10],M=w+T[11],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[5]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[12],M=w+T[13],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[6]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[14],M=w+T[15],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[7]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[16],M=w+T[17],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[8]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[18],M=w+T[19],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[9]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[20],M=w+T[21],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[10]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[22],M=w+T[23],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[11]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[24],M=w+T[25],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[12]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[26],M=w+T[27],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[13]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[28],M=w+T[29],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[14]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[30],M=w+T[31],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[15]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[32],M=w+T[33],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[16]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[34],M=w+T[35],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[17]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[36],M=w+T[27],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[18]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[38],M=w+T[39],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[19]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[40],M=w+T[41],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[20]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[42],M=w+T[43],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[21]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[44],M=w+T[45],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[22]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[46],M=w+T[47],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[23]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),E=A+T[48],M=w+T[49],E>=0&&O>=E&&M>=0&&W>=M&&(x=E+M<<2,u=r[F[24]],b+=e[x]*u,C+=e[x+1]*u,D+=e[x+2]*u),f=a*b+h,l=a*C+h,d=a*D+h,y&&(0>f?f=0:f>255&&(f=255),0>l?l=0:l>255&&(l=255),0>d?d=0:d>255&&(d=255)),S[p]=~~f,S[p+1]=~~l,S[p+2]=~~d,S[p+3]=e[p+3],p+=4,A++,A>=n&&(A=0,w+=n);return S}var g=t.ImArray,_=t.Array32F,y=t._notSupportTypedArrays,A=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],w=(t.CONSTANTS.SQRT2,t.CONSTANTS.toRad),v=(t.CONSTANTS.toDeg,Math.abs),L=Math.sqrt,E=Math.sin,M=Math.cos,x=t.ConvolutionMatrixFilter=function(e,n,i){this._coeff=new _([1,0]),"undefined"!=typeof e&&e.length?this.set(e,~~(L(e.length)+.5),n||1,i||0):(this._matrix=null,this._dim=0),this._matrix2=null,this._dim2=this._dim,this._isGrad=!1,this._doFast=0,this._doSeparable=!1,t.useWebGL&&(this._webglInstance=t.WebGLConvolutionMatrixFilterInstance)};x.prototype={constructor:x,_dim:0,_dim2:0,_matrix:null,_matrix2:null,_coeff:null,_webglInstance:null,lowPass:function(t){return t="undefined"==typeof t?3:t%2?t:t+1,this.set(u(t),t,1/(t*t),0),this._doFast=1,this},highPass:function(t,e){t="undefined"==typeof t?3:t%2?t:t+1,e="undefined"==typeof e?1:e;var n=t*t,i=-e/n,r=u(t,i,1+i);return this.set(r,t,1,0),this._doFast=1,this},glow:function(t,e){return t="undefined"==typeof t?.5:t,this.highPass(e,-t)},sharpen:function(t,e){return t="undefined"==typeof t?.5:t,this.highPass(e,t)},verticalBlur:function(t){return t="undefined"==typeof t?3:t%2?t:t+1,this.set(i(t),1,1/t,0),this._dim2=t,this._doFast=1,this},horizontalBlur:function(t){return t="undefined"==typeof t?3:t%2?t:t+1,this.set(i(t),t,1/t,0),this._dim2=1,this._doFast=1,this},directionalBlur:function(t,e){e="undefined"==typeof e?3:e%2?e:e+1,t*=w;var n=M(t),i=-E(t),r=f(e,n,i,1/e);return this.set(r,e,1,0)},fastGauss:function(t,e){return e="undefined"==typeof e?3:e%2?e:e+1,t=t||1,t=~~t,1>t?t=1:t>3&&(t=3),this.set(u(e),e,1/(e*e),0),this._doFast=t,this},binomialLowPass:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=r(t),n=1<<t-1,i=1/n;return this.set(e,t,i,i),this._matrix2=new _(e),this._doSeparable=!0,this},binomialHighPass:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var n=a(t);return this.set(e(u(t),new _(n.kernel),1,-1/n.sum),t,1,0)},prewittX:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=o(t,0);return this.set(e.kernel,t,1,0)},prewittY:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=o(t,1);return this.set(e.kernel,t,1,0)},prewittDirectional:function(t,n){n="undefined"==typeof n?3:n%2?n:n+1,t*=w;var i=M(t),r=E(t),s=o(n,0),a=o(n,1);return this.set(e(new _(s.kernel),new _(a.kernel),i,r),n,1,0)},prewitt:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=o(t,0),n=o(t,1);return this.set(e.kernel,t,1,0),this._isGrad=!0,this._matrix2=new _(n.kernel),this},sobelX:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=h(t,0);return this.set(e.kernel,t,1,0)},sobelY:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=h(t,1);return this.set(e.kernel,t,1,0)},sobelDirectional:function(t,n){n="undefined"==typeof n?3:n%2?n:n+1,t*=w;var i=M(t),r=E(t),s=h(n,0),a=h(n,1);return this.set(e(new _(s.kernel),new _(a.kernel),i,r),n,1,0)},sobel:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=h(t,0),n=h(t,1);return this.set(e.kernel,t,1,0),this._matrix2=new _(n.kernel),this._isGrad=!0,this},laplace:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=t*t,n=u(t,-1,e-1);return this.set(n,t,1,0),this._doFast=1,this},emboss:function(t,e,n){n="undefined"==typeof n?3:n%2?n:n+1,t="undefined"==typeof t?-.25*Math.PI:t*w,e=e||1;var i=e*M(t),r=-e*E(t),s=c(n,i,r,1);return this.set(s,n,1,0)},edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,n,i){return this._matrix2=null,this._isGrad=!1,this._doFast=0,this._doSeparable=!1,this._matrix=new _(t),this._dim2=this._dim=e,this._coeff[0]=n||1,this._coeff[1]=i||0,this},combineWith:function(){return this},getMatrix:function(){return this._matrix},setMatrix:function(t,e){return this._matrix=t,this._dim2=this._dim=e,this._matrix2=null,this._coeff[0]=1,this._coeff[1]=0,this._isGrad=!1,this._doFast=0,this._doSeparable=!1,this},_apply:function(e,n,i){if(!this._matrix)return e;if(this._doFast)return this._matrix2?l(e,n,i,this._matrix,this._matrix2,this._dim,this._dim2,this._coeff[0],this._coeff[1],this._doFast):l(e,n,i,this._matrix,null,this._dim,this._dim2,this._coeff[0],this._coeff[1],this._doFast);if(this._doSeparable)return d(e,n,i,this._matrix,this._matrix2,this._dim,this._dim2,this._coeff[0],this._coeff[1]);if(3==this._dim)return this._matrix2?p(e,n,i,this._matrix,this._matrix2,this._coeff[0],this._coeff[1],this._isGrad):p(e,n,i,this._matrix,null,this._coeff[0],this._coeff[1],!1);if(5==this._dim)return this._matrix2?m(e,n,i,this._matrix,this._matrix2,this._coeff[0],this._coeff[1],this._isGrad):m(e,n,i,this._matrix,null,this._coeff[0],this._coeff[1],!1);var r,s,a,h,o,u,c,f,_,A,w,L,E,M,x,b,C,D,R,N,I=this._dim,U=this._dim,H=I>>1,k=U>>1,G=I*U,T=k*n,F=this._matrix,P=this._matrix2,B=this._isGrad,S=new t.Array16I(G<<1),O=new t.Array8U(G),W=n*i,Y=e.length,X=new g(Y),q=n-1,z=W-n,V=this._coeff[0],Q=this._coeff[1];for(c=0,f=0,_=0,A=0,w=0;G>f;)O[f]=_+A,S[c]=_-H,S[c+1]=w-T,c+=2,f++,_++,_>=I&&(_=0,A+=I,w+=n);if(P)for(u=0,_=0,A=0;Y>u;){for(x=0,b=0,C=0,D=0,R=0,N=0,c=0,f=0;G>f;)L=_+S[c],E=A+S[c+1],L>=0&&q>=L&&E>=0&&z>=E&&(M=L+E<<2,r=F[O[f]],x+=e[M]*r,b+=e[M+1]*r,C+=e[M+2]*r,s=P[O[f]],D+=e[M]*s,R+=e[M+1]*s,N+=e[M+2]*s),c+=2,f++;B?(a=v(x)+v(D),h=v(b)+v(R),o=v(C)+v(N)):(a=V*x+Q*D,h=V*b+Q*R,o=V*C+Q*N),y&&(0>a?a=0:a>255&&(a=255),0>h?h=0:h>255&&(h=255),0>o?o=0:o>255&&(o=255)),X[u]=~~a,X[u+1]=~~h,X[u+2]=~~o,X[u+3]=e[u+3],u+=4,_++,_>=n&&(_=0,A+=n)}else for(u=0,_=0,A=0;Y>u;){for(x=0,b=0,C=0,c=0,f=0;G>f;)L=_+S[c],E=A+S[c+1],L>=0&&q>=L&&E>=0&&z>=E&&(M=L+E<<2,r=F[O[f]],x+=e[M]*r,b+=e[M+1]*r,C+=e[M+2]*r),c+=2,f++;a=V*x+Q,h=V*b+Q,o=V*C+Q,y&&(0>a?a=0:a>255&&(a=255),0>h?h=0:h>255&&(h=255),0>o?o=0:o>255&&(o=255)),X[u]=~~a,X[u+1]=~~h,X[u+2]=~~o,X[u+3]=e[u+3],u+=4,_++,_>=n&&(_=0,A+=n)}return X},apply:function(t){return this._matrix?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},reset:function(){return this._matrix=null,this._matrix2=null,this._dim=0,this}},x.prototype.boxBlur=x.prototype.lowPass,x.prototype.gaussBlur=x.prototype.binomialLowPass,x.prototype.gradX=x.prototype.prewittX,x.prototype.gradY=x.prototype.prewittY,x.prototype.gradDirectional=x.prototype.prewittDirectional,x.prototype.grad=x.prototype.prewitt}(FILTER),function(t){function e(t){var e,n=t*t,r=new i(n);for(e=0;n>e;e++)r[e]=1;return r}var n=t.ImArray,i=t.Array8U,r=(Math.min,Math.max,Math.sqrt),s=function(e,i,r){var s,a,h,o,u,c,f,l,d,p,m,g,_,y,A,w=this._dim,v=w>>1,L=w*w,E=v*i,M=this.structureElement,x=i*r,b=e.length,C=new n(b),D=i-1,R=x-i;for(s=[],o=0,u=0,k=0;L>k;)M[k]&&(s.push(o-v),s.push(u-E)),k++,o++,o>=w&&(o=0,u+=i);for(s=new t.Array32I(s),A=s.length,a=0,o=0,u=0;b>a;){for(g=0,_=0,y=0,h=0;A>h;)c=o+s[h],f=u+s[h+1],c>=0&&D>=c&&f>=0&&R>=f&&(l=c+f<<2,d=e[l],p=e[l+1],m=e[l+2],d>g&&(g=d),p>_&&(_=p),m>y&&(y=m)),h+=2;C[a]=g,C[a+1]=_,C[a+2]=y,C[a+3]=e[a+3],a+=4,o++,o>=i&&(o=0,u+=i)}return C},a=function(e,i,r){var s,a,h,o,u,c,f,l,d,p,m,g,_,y,A,w=this._dim,v=w>>1,L=w*w,E=v*i,M=this.structureElement,x=i*r,b=e.length,C=new n(b),D=i-1,R=x-i;for(s=[],o=0,u=0,k=0;L>k;)M[k]&&(s.push(o-v),s.push(u-E)),k++,o++,o>=w&&(o=0,u+=i);for(s=new t.Array32I(s),A=s.length,a=0,o=0,u=0;b>a;){for(g=255,_=255,y=255,h=0;A>h;)c=o+s[h],f=u+s[h+1],c>=0&&D>=c&&f>=0&&R>=f&&(l=c+f<<2,d=e[l],p=e[l+1],m=e[l+2],g>d&&(g=d),_>p&&(_=p),y>m&&(y=m)),h+=2;C[a]=g,C[a+1]=_,C[a+2]=y,C[a+3]=e[a+3],a+=4,o++,o>=i&&(o=0,u+=i)}return C},h=function(t){return t},o=e(3),u=t.MorphologicalFilter=function(){this._dim=0,this.structureElement=null,this._apply=h};u.prototype={constructor:u,_dim:0,structureElement:null,erode:function(t){return this.set(t),this._apply=a,this},dilate:function(t){return this.set(t),this._apply=s,this},_apply:function(t){return t},apply:function(t){return this._dim?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},set:function(t){return t&&t.length?(this.structureElement=new i(t),this._dim=~~(r(this.structureElement.length)+.5)):t&&t===t-0?(this.structureElement=e(t),this._dim=t):(this.structureElement=o,this._dim=3),this},reset:function(){return this._apply=h,this._dim=0,this.structureElement=null,this}}}(FILTER),function(t){var e=t.ImArray;Math.min,Math.max;var n=function(n,i,r){var s,a,h,o,u,c,f,l,d,p,m,g,_,y,A,w=this._dim,v=w>>1,L=w*w,E=v*i,M=new t.Array32I(L<<1),x=i*r,b=n.length,C=new e(b),D=[],R=[],N=[],I=L<<1,U=i-1,H=x-i;for(a=0,h=0,o=0;I>a;)M[a]=h-v,M[a+1]=o-E,a+=2,h++,h>=w&&(h=0,o+=i);for(s=0,h=0,o=0;b>s;){for(D.length=0,R.length=0,N.length=0,a=0;I>a;)u=h+M[a],c=o+M[a+1],u>=0&&U>=u&&c>=0&&H>=c&&(f=u+c<<2,l=n[f],d=n[f+1],p=n[f+2],D.push(l),R.push(d),N.push(p)),a+=2;D.sort(),R.sort(),N.sort(),y=D.length,A=y>>1,m=y%2?D[A+1]:~~(.5*(D[A]+D[A+1])),y=R.length,A=y>>1,g=y%2?R[A+1]:~~(.5*(R[A]+R[A+1])),y=N.length,A=y>>1,_=y%2?N[A+1]:~~(.5*(N[A]+N[A+1])),C[s]=m,C[s+1]=g,C[s+2]=_,C[s+3]=n[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}return C},i=function(n,i,r){var s,a,h,o,u,c,f,l,d,p,m,g,_,y=this._dim,A=y>>1,w=y*y,v=A*i,L=new t.Array32I(w<<1),E=i*r,M=n.length,x=new e(M),b=w<<1,C=i-1,D=E-i;for(h=0,o=0,a=0;b>a;)L[a]=h-A,L[a+1]=o-v,a+=2,h++,h>=y&&(h=0,o+=i);for(s=0,h=0,o=0;M>s;){for(m=0,g=0,_=0,a=0;b>a;)u=h+L[a],c=o+L[a+1],u>=0&&C>=u&&c>=0&&D>=c&&(f=u+c<<2,l=n[f],d=n[f+1],p=n[f+2],l>m&&(m=l),d>g&&(g=d),p>_&&(_=p)),a+=2;x[s]=m,x[s+1]=g,x[s+2]=_,x[s+3]=n[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}return x},r=function(n,i,r){var s,a,h,o,u,c,f,l,d,p,m,g,_,y=this._dim,A=y>>1,w=y*y,v=A*i,L=new t.Array32I(w<<1),E=i*r,M=n.length,x=new e(M),b=w<<1,C=i-1,D=E-i;for(h=0,o=0,a=0;b>a;)L[a]=h-A,L[a+1]=o-v,a+=2,h++,h>=y&&(h=0,o+=i);for(s=0,h=0,o=0;M>s;){for(m=255,g=255,_=255,a=0;b>a;)u=h+L[a],c=o+L[a+1],u>=0&&C>=u&&c>=0&&D>=c&&(f=u+c<<2,l=n[f],d=n[f+1],p=n[f+2],m>l&&(m=l),g>d&&(g=d),_>p&&(_=p)),a+=2;x[s]=m,x[s+1]=g,x[s+2]=_,x[s+3]=n[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}return x},s=function(t){return t},a=t.StatisticalFilter=function(){this._dim=0,this._apply=s};a.prototype={constructor:a,_dim:0,median:function(t){return t="undefined"==typeof t?3:t%2?t:t+1,this._dim=t,this._apply=n,this},minimum:function(t){return t="undefined"==typeof t?3:t,this._dim=t,this._apply=r,this},maximum:function(t){return t="undefined"==typeof t?3:t,this._dim=t,this._apply=i,this},_apply:function(t){return t},apply:function(t){return this._dim?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},reset:function(){return this._apply=s,this._dim=0,this}},a.prototype.erode=a.prototype.minimum,a.prototype.dilate=a.prototype.maximum}(FILTER);