/**
*
*   Classy.js
*   @version: 0.5.5
*
*   Object-Oriented mini-framework for JavaScript
*   https://github.com/foo123/classy.js
*
**/!function(e,t,n,r,o){var i="undefined"!=typeof global&&"[object global]"=={}.toString.call(global)?1:0,l=i||"undefined"==typeof navigator?0:1,a="function"==typeof importScripts&&navigator instanceof WorkerNavigator?1:0,u=Array,c=u.prototype,f=function(){var e=null;if(i)return e=__filename,{path:__dirname,file:__filename};if(a)e=self.location.href;else if(l){var t;(t=document.getElementsByTagName("script"))&&t.length&&(e=t[t.length-1].src)}return e?{path:e.split("/").slice(0,-1).join("/"),file:e}:{path:null,file:null}},s=f(),p=function(e,t){if(i)return t;if("."==t.charAt(0)){e=e.split("/"),t=t.split("/");var n,r=0,o=0,l=t.length,a=e.length;for(n=0;l>n;n++)if(/^\.\./.test(t[n]))r++,o++;else{if(!/^\./.test(t[n]))break;o++}r=r>=a?0:a-r,t=e.slice(0,r).concat(t.slice(o)).join("/")}return t};n=n?[].concat(n):[];var b,d,y,g=n.length,v=new u(g),m=new u(g),h=new u(g),w=new u(g);for(b=0;g>b;b++)v[b]=n[b][0],m[b]=n[b][1],h[b]=/\.js$/i.test(m[b])?p(s.path,m[b]):p(s.path,m[b]+".js");if("object"==typeof module&&module.exports){if(o===module.exports[t]){for(b=0;g>b;b++)w[b]=module.exports[v[b]]||require(h[b])[v[b]];d=r.apply(e,w),module.exports[t]=d||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(m),function(n){if(o===n[t]){for(var i=c.slice.call(arguments,1),l=i.length,a=0;l>a;a++)w[a]=n[v[a]]||i[a];d=r.apply(e,w),n[t]=d||1}});else if(a){for(b=0;g>b;b++)self[v[b]]||importScripts(h[b]),w[b]=self[v[b]];d=r.apply(e,w),self[t]=d||1}else if(o===e[t]){var j=function(e,t){y=y||document.getElementsByTagName("head")[0];var n=0,r=document.createElement("script");r.type="text/javascript",r.language="javascript",r.src=e,r.onload=r.onreadystatechange=function(){n||r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(n=1,r.onload=r.onreadystatechange=null,y.removeChild(r),r=null,t&&t())},y.appendChild(r)},E=function(t,n,r){e[t]?r():j(n,r)},x=function(n){return function(){g>n&&(w[n]=e[v[n]]),++n<g?E(v[n],h[n],x(n)):(d=r.apply(e,w),e[t]=d||1)}};g?E(v[0],h[0],x(0)):(d=r.apply(e,w),e[t]=d||1)}}(this,"Classy",null,function(){var e={};return function(e,t){var n=function(e,t,n){this.v=e||null,this.prev=t||null,this.next=n||null};n.prototype={constructor:n,v:null,prev:null,next:null};var r=Array.prototype,o=Object.prototype,i=Function.prototype,l=i.call.bind(r.slice),a=i.call.bind(o.toString),u=i.call.bind(o.hasOwnProperty),c=i.call.bind(o.propertyIsEnumerable),f=Object.keys,s=Object.defineProperty,p=2,b=3,d=4,y=8,g=9,v=16,m=32,h=64,w=128,j=256,E=512,x=1024,_=function(e){var t=typeof e,n=a(e);return"undefined"===t?E:"number"===t||e instanceof Number?isNaN(e)?b:p:null===e?j:!0===e||!1===e?d:e&&("string"===t||e instanceof String)?1===e.length?g:y:e&&("[object Array]"===n||e instanceof Array)?v:e&&("[object RegExp]"===n||e instanceof RegExp)?w:e&&("function"===t&&"[object Function]"===n||e instanceof Function)?h:e&&"[object Object]"===n?m:x},O=function(e,t){var n,r=t.length,o=[].concat(e);for(n=0;r>n;n++)o.indexOf(t[n])>-1||o.push(t[n]);return o},N=function(e,t){if(m!==_(e))throw new TypeError("bad desc");var n={};if(u(e,"enumerable")&&(n.enumerable=!!t.enumerable),u(e,"configurable")&&(n.configurable=!!t.configurable),u(e,"value")&&(n.value=t.value),u(e,"writable")&&(n.writable=!!e.writable),u(e,"get")){var r=e.get;if(h!==_(r)&&"undefined"!==r)throw new TypeError("bad get");n.get=r}if(u(e,"set")){var o=e.set;if(h!==_(o)&&"undefined"!==o)throw new TypeError("bad set");n.set=o}if(("get"in n||"set"in n)&&("value"in n||"writable"in n))throw new TypeError("identity-confused descriptor");return n},T=Object.defineProperties||function(e,t){if("object"!=typeof e||null===e)throw new TypeError("bad obj");t=Object(t);for(var n=f(t),r=[],o=0;o<n.length;o++)r.push([n[o],N(t[n[o]],e)]);for(var o=0;o<r.length;o++)s(e,r[o][0],r[o][1]);return e},S=Object.create||function(e,t){var n,r=function(){};return r.prototype=e,n=new r,n.__proto__=e,"object"==typeof t&&T(n,t),n},A=function(e){var t=new n(e);return function(e){if(e&&t&&t.v){var r,o=this;if(e="constructor"==e?t.v:t.v.prototype[e])return t=new n(t.v.$super,t),r=e.apply(o,l(arguments,1)),t=t.prev,r}}},C=function(){var e,t,n,r,o,i,a,f=l(arguments);for(t=f.shift()||{},e=f.length,i=0;e>i;i++)if(n=f[i],m===_(n))for(o in n)u(n,o)&&c(n,o)&&(r=n[o],a=_(r),t[o]=p&a?0+r:(y|v)&a?r.slice(0):r);return t},R=function(e,n){e=e||Object,n=n||{};var r,o,i,l,a,c,s,b,d=null,g=e.$static||null;if(u(n,"constructor")?o=n.constructor:(r=function(){},n.constructor=o=r),u(n,"__static__")&&(d=n.__static__,delete n.__static__,g=O(g||[],f(d))),o.prototype=S(e.prototype),o.prototype=C(o.prototype,n),T(o.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0},$class:{value:o,enumerable:!1,writable:!0,configurable:!0},$super:{value:A(e),enumerable:!1,writable:!0,configurable:!0}}),T(o,{$super:{value:e,enumerable:!1,writable:!0,configurable:!0},$static:{value:g,enumerable:!1,writable:!0,configurable:!0}}),g){for(l=g.length,a={},i=0;l>i;i++)c=g[i],s=null,d&&t!==d[c]?s=d[c]:t!==e[c]&&(b=_(e[c]),s=m===b?C(null,e[c]):(y|v)&b?e[c].slice(0):p&b?0+e[c]:e[c]),a[c]={value:s,enumerable:!1,writable:!0,configurable:!0};T(o,a)}return o},I=Mixin=C,M=function(){var e=l(arguments),t=e.length,n=null;if(t>=2){var r=_(e[0]);r=h===r?{Extends:e[0]}:m===r?e[0]:{Extends:Object};var o,i,a=e[1]||{},u={},c=r.Extends||r.extends||Object,f=r.Implements||r.implements,s=r.Mixin||r.mixin;if(f=f?[].concat(f):null,s=s?[].concat(s):null)for(o=0,i=s.length;i>o;o++)s[o].prototype&&(u=Mixin(u,s[o].prototype));if(f)for(o=0,i=f.length;i>o;o++)f[o].prototype&&(u=I(u,f[o].prototype));n=R(c,C(u,a))}else n=R(Object,e[0]);return n};e.Classy={VERSION:"0.5.5",T:{UNDEFINED:E,NULL:j,BOOLEAN:d,STRING:y,NUMBER:p,NAN:b,FUNCTION:h,REGEXP:w,ARRAY:v,OBJECT:m},Type:_,Create:S,Merge:C,Implements:I,Mixin:Mixin,Extends:R,Static:function(e){return e},Class:M}}(e),e.Classy});
/**
*
*   FILTER.js
*   @version: 0.6.11
*   @dependencies: Classy.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e,i,n,s){var r="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),a=!r&&"undefined"!=typeof navigator,l="function"==typeof importScripts&&navigator instanceof WorkerNavigator,h=Array,o=h.prototype,u=function(){var t=null;if(r)return t=__filename,{path:__dirname,file:__filename};if(l)t=self.location.href;else if(a){var e;(e=document.getElementsByTagName("script"))&&e.length&&(t=e[e.length-1].src)}return t?{path:t.split("/").slice(0,-1).join("/"),file:t}:{path:null,file:null}},c=u(),f=function(t,e){if(r)return e;if("."==e.charAt(0)){t=t.split("/"),e=e.split("/");var i,n=0,s=0,a=e.length,l=t.length;for(i=0;a>i;i++)if(/^\.\./.test(e[i]))n++,s++;else{if(!/^\./.test(e[i]))break;s++}n=n>=l?0:l-n,e=t.slice(0,n).concat(e.slice(s)).join("/")}return e};i=i?[].concat(i):[];var m,_,d,p=i.length,g=new h(p),v=new h(p),w=new h(p),A=new h(p);for(m=0;p>m;m++)g[m]=i[m][0],v[m]=i[m][1],w[m]=/\.js$/i.test(v[m])?f(c.path,v[m]):f(c.path,v[m]+".js");if("object"==typeof module&&module.exports){if(s===module.exports[e]){for(m=0;p>m;m++)A[m]=module.exports[g[m]]||require(w[m])[g[m]];_=n.apply(t,A),module.exports[e]=_||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(v),function(i){if(s===i[e]){for(var r=o.slice.call(arguments,1),a=r.length,l=0;a>l;l++)A[l]=i[g[l]]||r[l];_=n.apply(t,A),i[e]=_||1}});else if(l){for(m=0;p>m;m++)self[g[m]]||importScripts(w[m]),A[m]=self[g[m]];_=n.apply(t,A),self[e]=_||1}else if(s===t[e]){var y=function(t,e){d=d||document.getElementsByTagName("head")[0];var i=0,n=document.createElement("script");n.type="text/javascript",n.language="javascript",n.onload=n.onreadystatechange=function(){i||n.readyState&&"loaded"!=n.readyState&&"complete"!=n.readyState||(i=1,n.onload=n.onreadystatechange=null,d.removeChild(n),n=null,e&&e())},n.src=t,d.appendChild(n)},b=function(e,i,n){t[e]?n():y(i,n)},E=function(i){return function(){p>i&&(A[i]=t[g[i]]),++i<p?b(g[i],w[i],E(i)):(_=n.apply(t,A),t[e]=_||1)}};p?b(g[0],w[0],E(0)):(_=n.apply(t,A),t[e]=_||1)}}(this,"FILTER",[["Classy","./classy"]],function(Classy){var FILTER=FILTER||{VERSION:"0.6.11",Class:Classy.Class,Merge:Classy.Merge};return!function(t,e){"use strict";var i,n=Object.prototype,s=Function.prototype,r=Array.prototype,a=s.call.bind(r.slice),l=s.call.bind(n.toString),h=(r.splice,r.concat,e.Merge),o="undefined"!=typeof global&&"[object global]"===l(global),u=!o&&"undefined"!=typeof navigator,c="function"==typeof importScripts&&navigator instanceof WorkerNavigator,f="function"==typeof Worker,m=navigator?navigator.userAgent:"",_=e.Browser={isNode:o,isBrowser:u,isWorker:c,supportsWorker:f,isPhantom:/PhantomJS/.test(m),isOpera:u&&/Opera|OPR\//.test(m),isFirefox:u&&/Firefox\//.test(m),isChrome:u&&/Chrome\//.test(m),isSafari:u&&/Apple Computer/.test(navigator.vendor),isKhtml:u&&/KHTML\//.test(m),isIE:u&&(/MSIE \d/.test(m)||/Trident\/\d/.test(m)),isGecko:u&&/gecko\/\d/i.test(m),isWebkit:u&&/WebKit\//.test(m),isMac_geLion:u&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(m),isMac_geMountainLion:u&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(m),isMobile:!1,isIOS:/AppleWebKit/.test(m)&&/Mobile\/\w+/.test(m),isWin:/windows/i.test(navigator.platform),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1};_.isMobile=_.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(m),_.isMac=_.isIOS||/Mac/.test(navigator.platform),_.isIE_lt8=_.isIE&&!c&&(null==document.documentMode||document.documentMode<8),_.isIE_lt9=_.isIE&&!c&&(null==document.documentMode||document.documentMode<9),_.isQtWebkit=_.isWebkit&&/Qt\/\d+\.\d+/.test(m),e.getPath=function(){var t,e=null;return o?{path:__dirname,file:__filename}:(c?e=self.location.href:u&&(t=document.getElementsByTagName("script"))&&t.length&&(e=t[t.length-1].src),e?{path:e.split("/").slice(0,-1).join("/"),file:""+e}:{path:null,file:null})};var d=e.devicePixelRatio=t.devicePixelRatio||1;e.getCanvas=e.createCanvas=function(t,e){var i=document.createElement("canvas");return t=t||0,e=e||0,i.style.width=t+"px",i.style.height=e+"px",i.width=t*d,i.height=e*d,i};var p=0;e.uuid=function(t){return[t||"fuuid",(new Date).getTime(),++p].join("_")};var g=e.URL=t.webkitURL||t.URL,v=function(t){return g.createObjectURL(new Blob([t||""],{type:"text/javascript"}))};e.useWebGL=!1,e.useWebGLSharedResources=!1,e.useWebGLIfAvailable=function(){},e.useWebGLSharedResourcesIfAvailable=function(){},e.Array=Array,e.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,e.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,e.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,e.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,e.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,e.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,e.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array;var w=e._notSupportClamp="undefined"==typeof Uint8ClampedArray;if(e.ImArray=w?e.Array8U:Uint8ClampedArray,e.ImArrayCopy=_.isOpera?e.Array8U:e.ImArray,w&&"undefined"!=typeof CanvasPixelArray&&!CanvasPixelArray.prototype.set){var A=function(t,e){var i=t.length;for(e=parseInt(e,10)||0;--i>=0;)this[i+e]=t[i];return this};CanvasPixelArray.prototype.set=A}if(e.CONSTANTS={PI:Math.PI,PI2:2*Math.PI,PI_2:.5*Math.PI,SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI},e.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3},e.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4},e.LUMA=new e.Array32F([.212671,.71516,.072169]),c){var y=null;t.console={log:function(t){postMessage({event:"console.log",data:{output:t||""}})},error:function(t){postMessage({event:"console.error",data:{output:t||""}})}},onmessage=function(t){var i=t.data.event,n=t.data.data||null;switch(i){case"init":if(!(n&&n.filter&&e[n.filter]))throw new Error('Filter "'+n.filter+'" could not be created');y&&y.dispose(!0),y=new e[n.filter];break;case"import":n&&n["import"]&&n["import"].length&&importScripts(n["import"].join(","));break;case"params":y&&y.unserialize(n);break;case"apply":y&&(n&&n.im?(n.params&&y.unserialize(n.params),y.send("apply",{im:y._apply(n.im[0],n.im[1],n.im[2])})):y.send("apply",{im:null}));break;case"dispose":default:y&&y.dispose(!0),close()}}}i=e.log=console&&console.log?console.log:function(){},e.warning=function(t){i("WARNING: "+t)},e.error=function(t){i("ERROR: "+t)};var b=e.FilterWorkerInterface=e.Class({path:e.getPath(),name:null,_worker:null,_workerListeners:null,disposeWorker:function(){var t=this;return t._worker&&(t.send("dispose"),t._worker=null,t._workerListeners=null),t},serialize:function(){return{}},unserialize:function(){return this},sources:function(){var t=a(arguments);if(t.length){var e,i=[];for(e=0;e<t.length;e++)"function"==typeof t[e]?i.push(v(t[e].toString())):i.push(v(t[e]));this.send("import",{"import":i})}return this},scripts:function(){var t=a(arguments);return t.length&&this.send("import",{"import":t}),this},worker:function(t){var e,n=this;if(arguments.length||(t=!0),t=!!t,!1===t)return n._worker&&n.disposeWorker(),n;if(!n._worker){if(!f)throw new Error("Worker is not supported");n._workerListeners={},e=n._worker=new Worker(this.path.file),e.onmessage=function(t){if(t.data.event){var e=t.data.event,s=t.data.data||null;n._workerListeners&&n._workerListeners[e]&&n._workerListeners[e](s),("console.log"===e||"console.error"===e)&&i("Worker: "+s.output)}},e.onerror=function(t){if(!n._workerListeners||!n._workerListeners.error)throw new Error("Worker Error: "+t.message+" file: "+t.filename+" line: "+t.lineno);n._workerListeners.error(t)},n.send("init",{filter:n.name})}return n},bind:function(t,e){return t&&e&&this._workerListeners&&(this._workerListeners[t]=e.bind(this)),this},unbind:function(t){return t&&this._workerListeners&&this._workerListeners[t]&&delete this._workerListeners[t],this},send:function(t,e){return t&&(c?postMessage({event:t,data:e||null}):this._worker&&this._worker.postMessage({event:t,data:e||null})),this}}),E=e.Filter=e.Class(b,{name:"Filter",constructor:function(){},id:null,_isOn:!0,dispose:function(){return this.disposeWorker(),this},serialize:function(){return{filter:this.name,_isOn:!!this._isOn}},unserialize:function(t){return t&&this.name===t.filter&&(this._isOn=!!t._isOn),this},isOn:function(){return this._isOn},turnOn:function(t){return arguments.length||(t=!0),this._isOn=!!t,this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this},combineWith:function(){return this},_apply:function(t){return t},apply:function(t,e){if(t&&this._isOn){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._apply(i[0],i[1],i[2],t)),e&&e.call(this))}return t},toString:function(){return"[FILTER: "+this.name+"]"}}),L=function(){return"[FILTER Plugin: "+this.name+"]"};e.Create=function(t){return t=h({init:function(){},name:"PluginFilter",toString:L,apply:function(t){return t}},t),t.constructor=t.init,t._apply=t.apply,delete t.init,delete t.apply,e.Class(E,t)}}(this,FILTER),!function(t){"use strict";var e=Math.sqrt,n=Math.min,s=Math.max;t.Color={name:"ColorTransforms",clamp:function(t,e,i){return n(i,s(t,e))},clampPixel:function(t){return n(255,s(t,0))},ubyteToFloat:function(t){return.00392156862745098*t},ubyteColorToFloatColor:function(t){var e=t.length,n=new Array(e);for(i=0;e>i;i++)n[i]=.00392156862745098*t[i];return n},hexColorToFloatColor:function(t){var e,i,n,s;return e=255&t>>16,i=255&t>>8,n=255&t,s=255&t>>24,[.00392156862745098*e,.00392156862745098*i,.00392156862745098*n,.00392156862745098*s]},blend:function(t,e,i){return{r:t.r-~~((t.r-e.r)*i+.5),g:t.g-~~((t.g-e.g)*i+.5),b:t.b-~~((t.b-e.b)*i+.5)}},toGray:function(e,i,n){var s=t.LUMA;return~~(s[0]*e+s[1]*i+s[2]*n)},distance:function(t,i){var n=t.r-i.r,s=t.g-i.g,r=t.b-i.b;return e(n*n+s*s+r*r)},RGB2Color:function(t){return t.r<<16|t.g<<8|255&t.b},RGBA2Color:function(t){return t.a<<24|t.r<<16|t.g<<8|255&t.b},Color2RGBA:function(t){return t=~~t,{r:255&t>>>16,g:255&t>>>8,b:255&t,a:255&t>>>24}},RGB2YCbCr:function(t){var e,i,n,s=t.r,r=t.g,a=t.b;return e=~~(0+.299*s+.587*r+.114*a),i=~~(128-.168736*s-.331264*r+.5*a),n=~~(128+.5*s-.418688*r-.081312*a),{y:e,cb:i,cr:n}},YCbCr2RGB:function(t){var e,i,n,s=t.y,r=t.cb,a=t.cr;return e=~~(s+1.402*(a-128)),i=~~(s-.34414*(r-128)-.71414*(a-128)),n=~~(s+1.772*(r-128)),{r:e,g:i,b:n}},RGB2HSV:function(t){var e,i,r,a,l,h,o,u,c;return a=t.r,l=t.g,h=t.b,e=n(a,l,h),i=s(a,l,h),r=i-e,c=i,0==i?(u=0,o=0,{h:o,s:u,v:c}):(u=r/i,o=a==i?(l-h)/r:l==i?2+(h-a)/r:4+(a-l)/r,o*=60,0>o&&(o+=360),{h:o,s:u,v:c})},HSV2RGB:function(t){var e,i,n,s,r,a,l,h,o,u,c;if(o=t.h,u=t.s,c=t.v,0==u)return a=l=h=c,{r:a,g:l,b:h};switch(o/=60,e=~~o,i=o-e,n=c*(1-u),s=c*(1-u*i),r=c*(1-u*(1-i)),e){case 0:a=c,l=r,h=n;break;case 1:a=s,l=c,h=n;break;case 2:a=n,l=c,h=r;break;case 3:a=n,l=s,h=c;break;case 4:a=r,l=n,h=c;break;default:a=c,l=n,h=s}return{r:a,g:l,b:h}},toString:function(){return"[FILTER: "+this.name+"]"}}}(FILTER),!function(t,e){"use strict";var i=t.devicePixelRatio,n=t.ImArray,s=t.Array32F,r=t.createCanvas,a=(t._notSupportTypedArrays,Math.min),l=Math.floor,h=t.blendModes={normal:function(t){return t},lighten:function(t,e){return e>t?e:t},darken:function(t,e){return e>t?t:e},multiply:function(t,e){return.003921568627451*t*e},average:function(t,e){return.5*(t+e)},add:function(t,e){return Math.min(255,t+e)},substract:function(t,e){return 255>t+e?0:t+e-255},difference:function(t,e){return Math.abs(t-e)},negation:function(t,e){return 255-Math.abs(255-t-e)},screen:function(t,e){return 255-((255-t)*(255-e)>>8)},exclusion:function(t,e){return t+e-.003921568627451*2*t*e},overlay:function(t,e){return 128>e?.003921568627451*2*t*e:255-.003921568627451*2*(255-t)*(255-e)},softLight:function(t,e){return 128>e?2*((t>>1)+64)*.003921568627451*e:255-.003921568627451*2*(255-((t>>1)+64))*(255-e)},hardLight:function(t,e){return 128>t?.003921568627451*2*e*t:255-.003921568627451*2*(255-e)*(255-t)},colorDodge:function(t,e){return 255==e?e:Math.min(255,(t<<8)/(255-e))},colorBurn:function(t,e){return 0==e?e:Math.max(0,255-(255-t<<8)/e)},linearLight:function(t,e){return 128>e?h.linearBurn(t,2*e):h.linearDodge(t,2*(e-128))},vividLight:function(t,e){return 128>e?h.colorBurn(t,2*e):h.colorDodge(t,2*(e-128))},pinLight:function(t,e){return 128>e?h.darken(t,2*e):h.lighten(t,2*(e-128))},hardMix:function(t,e){return h.vividLight(t,e)<128?0:255},reflect:function(t,e){return 255==e?e:Math.min(255,t*t/(255-e))},glow:function(t,e){return 255==t?t:Math.min(255,e*e/(255-t))},phoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}};h.linearDodge=h.add,h.linearBurn=h.substract;var o=1,u=2,c=4,f=8,m=t.Image=t.Class({name:"Image",constructor:function(t,e){this.width=0,this.height=0,this.context=null,this.selection=null,this.imageData=null,this.imageDataSel=null,this.domElement=this.canvasElement=r(this.width,this.height),this.context=this.canvasElement.getContext("2d"),this._tmpCanvas=null,this.webgl=null,this._histogram=null,this._integral=null,this._needsRefresh=0,t&&this.setImage(t,e)},width:0,height:0,canvasElement:null,domElement:null,context:null,selection:null,imageData:null,imageDataSel:null,webgl:null,_histogram:null,_integral:null,_needsRefresh:0,_tmpCanvas:null,select:function(t,i,n,s){return this.selection=[e===t?0:t,e===i?0:i,e===n?1:n,e===s?1:s],this._needsRefresh|=u,this},deselect:function(){return this.selection=null,this.imageDataSel=null,this._needsRefresh&=~u,this},setWidth:function(t){return this._setWidth(t),this._needsRefresh|=o|c|f,this.selection&&(this._needsRefresh|=u),this},setHeight:function(t){return this._setHeight(t),this._needsRefresh|=o|c|f,this.selection&&(this._needsRefresh|=u),this},setDimensions:function(t,e){return this._setDimensions(t,e),this._needsRefresh|=o|c|f,this.selection&&(this._needsRefresh|=u),this},setImage:function(e,i){if(!e)return this;var n,s,r,a,l=this;return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?(n=e,r=n instanceof HTMLVideoElement?n.videoWidth:n.width,a=n instanceof HTMLVideoElement?n.videoHeight:n.height,s=l.context=l._setDimensions(r,a).canvasElement.getContext("2d"),s.drawImage(n,0,0),l._needsRefresh|=o|c|f,l.selection&&(l._needsRefresh|=u),l.webgl=t.useWebGL?new t.WebGL(l.canvasElement):null):(n=new Image,n.onload=function(){r=n.width,a=n.height,s=l.context=l._setDimensions(r,a).canvasElement.getContext("2d"),s.drawImage(n,0,0),l._needsRefresh|=o|c|f,l.selection&&(l._needsRefresh|=u),l.webgl=t.useWebGL?new t.WebGL(l.canvasElement):null,"undefined"!=typeof i&&i.call(l)},n.src=e),n.crossOrigin="",this},getPixel:function(t,e){this._needsRefresh&o&&this._refreshData();var i=~~(e*this.width+t+.5),n=this.imageData.data;return{r:n[i],g:n[i+1],b:n[i+2],a:n[i+3]}},setPixel:function(t,e,i,s,r,a){var l=new n([255&i,255&s,255&r,255&a]);return this.context.putImageData(l,t,e),this._needsRefresh|=o|c|f,this.selection&&(this._needsRefresh|=u),this},getData:function(){return this._needsRefresh&o&&this._refreshData(),new n(this.imageData.data)},getSelectedData:function(){var t;return this.selection?(this._needsRefresh&u&&this._refreshDataSel(),t=this.imageDataSel):(this._needsRefresh&o&&this._refreshData(),t=this.imageData),[new n(t.data),t.width,t.height]},setData:function(t){return this._needsRefresh&o&&this._refreshData(),this.imageData.data.set(t),this.context.putImageData(this.imageData,0,0),this._needsRefresh|=c|f,this.selection&&(this._needsRefresh|=u),this},setSelectedData:function(t){if(this.selection){var e=this.selection,i=this.width-1,n=this.height-1,s=l(e[0]*i),r=l(e[1]*n);this._needsRefresh&u&&this._refreshDataSel(),this.imageDataSel.data.set(t),this.context.putImageData(this.imageDataSel,s,r),this._needsRefresh|=o}else this._needsRefresh&o&&this._refreshData(),this.imageData.data.set(t),this.context.putImageData(this.imageData,0,0),this.selection&&(this._needsRefresh|=u);return this._needsRefresh|=c|f,this},getPixelData:function(){return this._needsRefresh&o&&this._refreshData(),this.imageData},setPixelData:function(t){return this.context.putImageData(t,0,0),this._needsRefresh|=o|c|f,this.selection&&(this._needsRefresh|=u),this},createImageData:function(t,e){return this.context=this._setDimensions(t,e).canvasElement.getContext("2d"),this.context.createImageData(t,e),this._needsRefresh|=o,this.selection&&(this._needsRefresh|=u),this},copy:function(t){return this.setData(t.getData()),this},clone:function(){return new m(this.canvasElement)},scale:function(t,e){if(t=t||1,e=e||t,1==t&&1==e)return this;this._tmpCanvas=this._tmpCanvas||this._getTmpCanvas();var n=this._tmpCanvas.getContext("2d");return n.scale(t,e),n.drawImage(this.canvasElement,0,0),this.width=~~(t*this.width+.5),this.height=~~(e*this.height+.5),this.canvasElement.style.width=this.width+"px",this.canvasElement.style.height=this.height+"px",this.canvasElement.width=this.width*i,this.canvasElement.height=this.height*i,this.context.drawImage(this._tmpCanvas,0,0),this._tmpCanvas.width=this.width,this._tmpCanvas.height=this.height,this._needsRefresh|=o|c|f,this.selection&&(this._needsRefresh|=u),this},flipHorizontal:function(){this._tmpCanvas=this._tmpCanvas||this._getTmpCanvas();var t=this._tmpCanvas.getContext("2d");return t.translate(this.width,0),t.scale(-1,1),t.drawImage(this.canvasElement,0,0),this.context.drawImage(this._tmpCanvas,0,0),this._needsRefresh|=o|c|f,this.selection&&(this._needsRefresh|=u),this},flipVertical:function(){this._tmpCanvas=this._tmpCanvas||this._getTmpCanvas();var t=this._tmpCanvas.getContext("2d");return t.translate(0,this.height),t.scale(1,-1),t.drawImage(this.canvasElement,0,0),this.context.drawImage(this._tmpCanvas,0,0),this._needsRefresh|=o|c|f,this.selection&&(this._needsRefresh|=u),this},clear:function(){if(this.width&&this.height){var t=this.context;t.clearRect(0,0,this.width,this.height),this._needsRefresh|=o|c|f,this.selection&&(this._needsRefresh|=u)}return this},fill:function(t,e,i,n,s){if(!n&&this.width&&!s&&this.height)return this;n&&!this.width&&s&&!this.height&&(this.context=this._setDimensions(n,s).canvasElement.getContext("2d"),this.context.createImageData(n,s)),t=t||0,e=e||0,i=i||0,n=n||this.width,s=s||this.height;var r=this.context;return r.fillStyle=t,r.fillRect(e,i,n,s),this._needsRefresh|=o|c|f,this.selection&&(this._needsRefresh|=u),this},draw:function(){return this},blend:function(t,e,i,n,s){"undefined"==typeof e&&(e="normal"),"undefined"==typeof i&&(i=1),i>1?i=1:0>i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof s&&(s=0);var r=0,l=0,m=this.context;if(0>n&&(r=-n,n=0),0>s&&(l=-s,s=0),n>=this.width||s>=this.height)return this;var _=h[e]||null;if(!_)return this;var d,p,g,v,w,A,y,b=a(this.width,t.width-r),E=a(this.height,t.height-l),L=this.context.getImageData(n,s,b,E),M=t.context.getImageData(r,l,b,E),I=L.data,C=M.data,R=1-i,N=C.length;for(y=0;N>y;y+=4)v=I[y],w=I[y+1],A=I[y+2],d=_(C[y],v),p=_(C[y+1],w),g=_(C[y+2],A),I[y]=d*i+v*R,I[y+1]=p*i+w*R,I[y+2]=g*i+A*R;return m.putImageData(L,n,s),this._needsRefresh|=o|c|f,this.selection&&(this._needsRefresh|=u),this},integral:function(){return this._needsRefresh&f&&this._computeIntegral(),this._integral},histogram:function(){return this._needsRefresh&c&&this._computeHistogram(),this._histogram},toString:function(){return"[FILTER Image: "+this.name+"]"},_getTmpCanvas:function(){var t=r(this.width,this.height);return t.width=this.width,t.height=this.height,t},_setDimensions:function(t,e){return this.canvasElement.style.width=t+"px",this.canvasElement.width=this.width=t*i,this.canvasElement.style.height=e+"px",this.canvasElement.height=this.height=e*i,this._tmpCanvas&&(this._tmpCanvas.style.width=this.canvasElement.style.width,this._tmpCanvas.width=this.canvasElement.width,this._tmpCanvas.style.height=this.canvasElement.style.height,this._tmpCanvas.height=this.canvasElement.height),this},_setWidth:function(t){return this.canvasElement.style.width=t+"px",this.canvasElement.width=this.width=t*i,this._tmpCanvas&&(this._tmpCanvas.style.width=this.canvasElement.style.width,this._tmpCanvas.width=this.canvasElement.width),this},_setHeight:function(t){return this.canvasElement.style.height=t+"px",this.canvasElement.height=this.height=t*i,this._tmpCanvas&&(this._tmpCanvas.style.height=this.canvasElement.style.height,this._tmpCanvas.height=this.canvasElement.height),this},_computeIntegral:function(){var t,e,i,n,r,a,l,h,o,u=this.width,c=(this.height,u<<2),m=this.getPixelData().data,_=m.length,d=_>>2;for(t=new s(d),e=new s(d),i=new s(d),h=0,l=0,n=r=a=0,o=0;u>o;o++,l+=4,h++)n+=m[l],r+=m[l+1],a+=m[l+2],t[h]=n,e[h]=r,i[h]=a;for(l=c,o=0,h=0,n=r=a=0,l=c;_>l;l+=4,h++,o++)o>=u&&(o=0,n=r=a=0),n+=m[l],r+=m[l+1],a+=m[l+2],t[h+u]=t[h]+n,e[h+u]=e[h]+r,i[h+u]=i[h]+a;return this._integral=[t,e,i],this._needsRefresh&=~f,this},_computeHistogram:function(){var t,e,i,n,r,a,l,h,o,u,f=this.getPixelData().data,m=f.length,_=0,d=0,p=0,g=255,v=255,w=255,A=1/(m>>2);for(t=new s(256),e=new s(256),i=new s(256),u=0;256>u;u+=4)t[u]=0,e[u]=0,i[u]=0,t[u+1]=0,e[u+1]=0,i[u+1]=0,t[u+2]=0,e[u+2]=0,i[u+2]=0,t[u+3]=0,e[u+3]=0,i[u+3]=0;for(u=0;m>u;u+=4)n=f[u],r=f[u+1],a=f[u+2],t[n]+=A,e[r]+=A,i[a]+=A,n>_?_=n:g>n&&(g=n),r>d?d=r:v>r&&(v=r),a>p?p=a:w>a&&(w=a);for(l=h=o=0,u=0;256>u;u+=4)l+=t[u],t[u]=l,h+=e[u],e[u]=h,o+=i[u],i[u]=o,l+=t[u+1],t[u+1]=l,h+=e[u+1],e[u+1]=h,o+=i[u+1],i[u+1]=o,l+=t[u+2],t[u+2]=l,h+=e[u+2],e[u+2]=h,o+=i[u+2],i[u+2]=o,l+=t[u+3],t[u+3]=l,h+=e[u+3],e[u+3]=h,o+=i[u+3],i[u+3]=o;return this._histogram=[t,e,i],this._needsRefresh&=~c,this},_refreshData:function(){return this.imageData=this.context.getImageData(0,0,this.width,this.height),this._needsRefresh&=~o,this},_refreshDataSel:function(){if(this.selection){var t=this.selection,e=this.width-1,i=this.height-1,n=l(t[0]*e),s=l(t[1]*i),r=l(t[2]*e)-n+1,a=l(t[3]*i)-s+1;this.imageDataSel=this.context.getImageData(n,s,r,a)}return this._needsRefresh&=~u,this}}),_=t.ScaledImage=t.Class(m,{name:"ScaledImage",constructor:function(t,e,i,n){this.scaleX=t||1,this.scaleY=e||this.scaleX,this.$super("constructor",i,n)},scaleX:1,scaleY:1,clone:function(){return new _(this.scaleX,this.scaleY,this.canvasElement)},setScale:function(t,i){return e!==t&&null!==t&&(this.scaleX=t),e===i&&e!==t&&null!==t?this.scaleY=t:null!==i&&(this.scaleY=i),this},setImage:function(e,i){if(!e)return this;var n,s,r,a,l,h,m=this,_=this.scaleX,d=this.scaleY;return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?(n=e,r=n instanceof HTMLVideoElement?n.videoWidth:n.width,a=n instanceof HTMLVideoElement?n.videoHeight:n.height,l=~~(_*r+.5),h=~~(d*a+.5),s=m.context=m._setDimensions(l,h).canvasElement.getContext("2d"),s.drawImage(n,0,0,r,a,0,0,l,h),m._needsRefresh|=o|c|f,m.selection&&(m._needsRefresh|=u),m.webgl=t.useWebGL?new t.WebGL(m.canvasElement):null):(n=new Image,n.onload=function(){r=n.width,a=n.height,l=~~(_*r+.5),h=~~(d*a+.5),s=m.context=m._setDimensions(r,a).canvasElement.getContext("2d"),s.drawImage(n,0,0,r,a,0,0,l,h),m._needsRefresh|=o|c|f,m.selection&&(m._needsRefresh|=u),m.webgl=t.useWebGL?new t.WebGL(m.canvasElement):null,"undefined"!=typeof i&&i.call(m)},n.src=e),n.crossOrigin="",this}})}(FILTER),!function(t){"use strict";var e=Object.prototype,i=Function.prototype,n=Array.prototype,s=i.call.bind(n.slice),r=(i.call.bind(e.toString),n.splice),a=n.concat,l=t.CompositeFilter=t.Class(t.Filter,{name:"CompositeFilter",constructor:function(t){this._stack=t&&t.length?t.slice():[]},_stack:null,_stable:!0,dispose:function(t){var e,i=this._stack;if(this.disposeWorker(),!0===t)for(e=0;e<i.length;e++)i[e]&&i[e].dispose(t),i[e]=null;return this._stack=null,this},serialize:function(){var t,e={filter:this.name,_isOn:!!this._isOn,_stable:!!this._stable,filters:[]},i=this._stack;for(t=0;t<i.length;t++)e.filters.push(i[t].serialize());return e},unserialize:function(e){var i,n,s,r,a,l=this,h=l._stack;if(e&&l.name===e.filter){if(l._isOn=!!e._isOn,l._stable=!!e._stable,r=e.filters||[],n=r.length,s=h.length,n===s&&l._stable)for(i=0;n>i;i++)h[i]=h[i].unserialize(r[i]);else{for(i=0;s>i;i++)h[i]&&h[i].dispose(!0),h[i]=null;for(h=[],i=0;n>i;i++){if(a=r[i]&&r[i].filter?t[r[i].filter]:null,!a)throw new Error('Filter "'+r[i].filter+'" could not be created');h.push((new a).unserialize(r[i]))}}l._stack=h}return l},stable:function(t){return arguments.length||(t=!0),this._stable=!!t,this},filters:function(t){return arguments.length?(this._stack=t.slice(),this):this._stack.slice()},push:function(){var t=s(arguments),e=t.length;return e&&(this._stack=a.apply(this._stack,t)),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){var t=s(arguments),e=t.length;return e&&r.apply(this._stack,[0,0].concat(t)),this},getAt:function(t){return this._stack.length>t?this._stack[t]:null},setAt:function(t,e){return this._stack.length>t?this._stack[t]=e:this._stack.push(e),this},insertAt:function(t){var e=s(arguments);return e.length,argslen>1&&(e.shift(),r.apply(this._stack,[t,0].concat(e))),this},removeAt:function(t){return this._stack.splice(t,1)},remove:function(t){for(var e=this._stack.length;--e>=0;)t===this._stack[e]&&this._stack.splice(e,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(t,e,i,n){if(this._isOn&&this._stack.length){var s,r,a=this._stack,l=a.length;for(s=0;l>s;s++)r=a[s],r&&r._isOn&&(t=r._apply(t,e,i,n))}return t},apply:function(t,e){if(t&&this._isOn&&this._stack.length){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._apply(i[0],i[1],i[2],t)),e&&e.call(this))}return t},toString:function(){return["[FILTER: "+this.name+"]","[","    "+this._stack.join("\n    "),"]",""].join("\n")}});l.prototype.empty=l.prototype.reset,l.prototype.concat=l.prototype.push}(FILTER),!function(FILTER,undef){"use strict";var CustomFilter=FILTER.CustomFilter=FILTER.Class(FILTER.Filter,{name:"CustomFilter",constructor:function(t){this._handler=t&&"function"==typeof t?t:null},_handler:null,dispose:function(){return this.disposeWorker(),this._handler=null,this},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_handler:t._handler?t._handler.toString():null}}},unserialize:function(json){var self=this,params;return json&&self.name===json.filter&&(self._isOn=!!json._isOn,params=json.params,self._handler=null,params._handler&&(self._handler=eval('(function(){ "use strict"; return '+params._handler+"})();"))),self},_apply:function(t,e,i,n){return this._isOn&&this._handler?this._handler.call(this,t,e,i,n):t},apply:function(t,e){if(this._isOn&&this._handler){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._handler.call(this,i[0],i[1],i[2],t)),e&&e.call(this))}return t}})}(FILTER),!function(t,e){"use strict";function i(t,e){var i,n,s,r,l,h=new a(20);return i=e[0],n=e[1],s=e[2],r=e[3],l=e[4],h[0]=i*t[0]+n*t[5]+s*t[10]+r*t[15],h[1]=i*t[1]+n*t[6]+s*t[11]+r*t[16],h[2]=i*t[2]+n*t[7]+s*t[12]+r*t[17],h[3]=i*t[3]+n*t[8]+s*t[13]+r*t[18],h[4]=i*t[4]+n*t[9]+s*t[14]+r*t[19]+l,i=e[5],n=e[6],s=e[7],r=e[8],l=e[9],h[5]=i*t[0]+n*t[5]+s*t[10]+r*t[15],h[6]=i*t[1]+n*t[6]+s*t[11]+r*t[16],h[7]=i*t[2]+n*t[7]+s*t[12]+r*t[17],h[8]=i*t[3]+n*t[8]+s*t[13]+r*t[18],h[9]=i*t[4]+n*t[9]+s*t[14]+r*t[19]+l,i=e[10],n=e[11],s=e[12],r=e[13],l=e[14],h[10]=i*t[0]+n*t[5]+s*t[10]+r*t[15],h[11]=i*t[1]+n*t[6]+s*t[11]+r*t[16],h[12]=i*t[2]+n*t[7]+s*t[12]+r*t[17],h[13]=i*t[3]+n*t[8]+s*t[13]+r*t[18],h[14]=i*t[4]+n*t[9]+s*t[14]+r*t[19]+l,i=e[15],n=e[16],s=e[17],r=e[18],l=e[19],h[15]=i*t[0]+n*t[5]+s*t[10]+r*t[15],h[16]=i*t[1]+n*t[6]+s*t[11]+r*t[16],h[17]=i*t[2]+n*t[7]+s*t[12]+r*t[17],h[18]=i*t[3]+n*t[8]+s*t[13]+r*t[18],h[19]=i*t[4]+n*t[9]+s*t[14]+r*t[19]+l,h}function n(t,e,i){var n=1-i,s=new a(20);return s[0]=n*t[0]+i*e[0],s[1]=n*t[1]+i*e[1],s[2]=n*t[2]+i*e[2],s[3]=n*t[3]+i*e[3],s[4]=n*t[4]+i*e[4],s[5]=n*t[5]+i*e[5],s[6]=n*t[6]+i*e[6],s[7]=n*t[7]+i*e[7],s[8]=n*t[8]+i*e[8],s[9]=n*t[9]+i*e[9],s[10]=n*t[10]+i*e[10],s[11]=n*t[11]+i*e[11],s[12]=n*t[12]+i*e[12],s[13]=n*t[13]+i*e[13],s[14]=n*t[14]+i*e[14],s[15]=n*t[15]+i*e[15],s[16]=n*t[16]+i*e[16],s[17]=n*t[17]+i*e[17],s[18]=n*t[18]+i*e[18],s[19]=n*t[19]+i*e[19],s}var s=Math.sin,r=Math.cos,a=t.Array32F,l=t.CONSTANTS.toRad,h=(t.CONSTANTS.toDeg,t._notSupportClamp),o=t.ColorMatrixFilter=t.Class(t.Filter,{name:"ColorMatrixFilter",constructor:function(e){this._matrix=e&&e.length?new a(e):null,t.useWebGL&&(this._webglInstance=t.WebGLColorMatrixFilterInstance||null)},_matrix:null,_webglInstance:null,dispose:function(){var t=this;return t.disposeWorker(),t._webglInstance=null,t._matrix=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_matrix:t._matrix}}},unserialize:function(t){var e,i=this;return t&&i.name===t.filter&&(i._isOn=!!t._isOn,e=t.params,i._matrix=e._matrix),i},channel:function(i,n){n=n===e?!1:n;var s=n?1:0;switch(i){case t.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case t.CHANNEL.BLUE:return this.set([0,0,s,0,0,0,0,s,0,0,0,0,1,0,0,0,0,0,0,255]);case t.CHANNEL.GREEN:return this.set([0,s,0,0,0,0,1,0,0,0,0,s,0,0,0,0,0,0,0,255]);case t.CHANNEL.RED:default:return this.set([1,0,0,0,0,s,0,0,0,0,s,0,0,0,0,0,0,0,0,255])}},redChannel:function(e){return this.channel(t.CHANNEL.RED,e)},greenChannel:function(e){return this.channel(t.CHANNEL.GREEN,e)},blueChannel:function(e){return this.channel(t.CHANNEL.BLUE,e)},alphaChannel:function(){return this.channel(t.CHANNEL.ALPHA,!0)},maskChannel:function(e){switch(e){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(e,i){switch(e){case t.CHANNEL.ALPHA:switch(i){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case t.CHANNEL.BLUE:switch(i){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.BLUE:return this;case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case t.CHANNEL.GREEN:switch(i){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this;case t.CHANNEL.RED:default:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case t.CHANNEL.RED:default:switch(i){case t.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case t.CHANNEL.BLUE:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this}}},desaturate:function(){return this.set([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,0,0,0,1,0])},colorize:function(i,n){var s,r,a,l;return n===e&&(n=1),s=.00392156862745098*(255&i>>16),r=.00392156862745098*(255&i>>8),a=.00392156862745098*(255&i),l=1-n,this.set([l+n*s*t.LUMA[0],n*s*t.LUMA[1],n*s*t.LUMA[2],0,0,n*r*t.LUMA[0],l+n*r*t.LUMA[1],n*r*t.LUMA[2],0,0,n*a*t.LUMA[0],n*a*t.LUMA[1],l+n*a*t.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.set([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(e){var i,n,s,r;return i=1-e,n=i*t.LUMA[0],s=i*t.LUMA[1],r=i*t.LUMA[2],this.set([n+e,s,r,0,0,n,s+e,r,0,0,n,s,r+e,0,0,0,0,0,1,0])
},contrast:function(t,i,n){return i===e&&(i=t),n===e&&(n=t),t+=1,i+=1,n+=1,this.set([t,0,0,0,128*(1-t),0,i,0,0,128*(1-i),0,0,n,0,128*(1-n),0,0,0,1,0])},brightness:function(t,i,n){return i===e&&(i=t),n===e&&(n=t),this.set([1,0,0,0,t,0,1,0,0,i,0,0,1,0,n,0,0,0,1,0])},adjustHue:function(e){e*=l;var i=r(e),n=s(e);return this.set([t.LUMA[0]+i*(1-t.LUMA[0])+n*-t.LUMA[0],t.LUMA[1]+i*-t.LUMA[1]+n*-t.LUMA[1],t.LUMA[2]+i*-t.LUMA[2]+n*(1-t.LUMA[2]),0,0,t.LUMA[0]+i*-t.LUMA[0]+.143*n,t.LUMA[1]+i*(1-t.LUMA[1])+.14*n,t.LUMA[2]+i*-t.LUMA[2]+n*-.283,0,0,t.LUMA[0]+i*-t.LUMA[0]+n*-(1-t.LUMA[0]),t.LUMA[1]+i*-t.LUMA[1]+n*t.LUMA[1],t.LUMA[2]+i*(1-t.LUMA[2])+n*t.LUMA[2],0,0,0,0,0,1,0])},average:function(t,i,n){return t===e&&(t=.3333),i===e&&(i=.3333),n===e&&(n=.3334),this.set([t,i,n,0,0,t,i,n,0,0,t,i,n,0,0,0,0,0,1,0])},quickContrastCorrection:function(t){return t===e&&(t=1.2),this.set([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0])},sepia:function(t){return t===e&&(t=.5),t>1?t=1:0>t&&(t=0),this.set([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0])},sepia2:function(i){return i===e&&(i=10),i>100&&(i=100),i*=2.55,this.set([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,40,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,20,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,-i,0,0,0,1,0])},threshold:function(i,n){return n===e&&(n=256),this.set([t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*i,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*i,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*i,0,0,0,1,0])},threshold_rgb:function(t,i){return i===e&&(i=256),this.set([i,0,0,0,-(i-1)*t,0,i,0,0,-(i-1)*t,0,0,i,0,-(i-1)*t,0,0,0,1,0])},threshold_alpha:function(t,i){return t===e&&(t=.5),i===e&&(i=256),this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,i,-i*t])},RGB2YCbCr:function(){return this.set([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.set([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(t,e){return this._matrix=this._matrix?n(this._matrix,t.getMatrix(),e):new a(t.getMatrix()),this},set:function(t){return this._matrix=this._matrix?i(this._matrix,new a(t)):new a(t),this},reset:function(){return this._matrix=null,this},combineWith:function(t){return this.set(t.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(t){return this._matrix=new a(t),this},_apply:function(t){if(this._isOn&&this._matrix){var e,i,n,s,r,a,l,o,u,c,f,m,_,d,p,g,v,w,A,y,b,E=t.length,L=this._matrix,M=(E>>2)%4;if(h){for(e=0;E>e;e+=16)w=t[e],A=t[e+1],y=t[e+2],b=t[e+3],i=L[0]*w+L[1]*A+L[2]*y+L[3]*b+L[4],n=L[5]*w+L[6]*A+L[7]*y+L[8]*b+L[9],s=L[10]*w+L[11]*A+L[12]*y+L[13]*b+L[14],r=L[15]*w+L[16]*A+L[17]*y+L[18]*b+L[19],w=t[e+4],A=t[e+5],y=t[e+6],b=t[e+7],a=L[0]*w+L[1]*A+L[2]*y+L[3]*b+L[4],l=L[5]*w+L[6]*A+L[7]*y+L[8]*b+L[9],o=L[10]*w+L[11]*A+L[12]*y+L[13]*b+L[14],u=L[15]*w+L[16]*A+L[17]*y+L[18]*b+L[19],w=t[e+8],A=t[e+9],y=t[e+10],b=t[e+11],c=L[0]*w+L[1]*A+L[2]*y+L[3]*b+L[4],f=L[5]*w+L[6]*A+L[7]*y+L[8]*b+L[9],m=L[10]*w+L[11]*A+L[12]*y+L[13]*b+L[14],_=L[15]*w+L[16]*A+L[17]*y+L[18]*b+L[19],w=t[e+12],A=t[e+13],y=t[e+14],b=t[e+15],d=L[0]*w+L[1]*A+L[2]*y+L[3]*b+L[4],p=L[5]*w+L[6]*A+L[7]*y+L[8]*b+L[9],g=L[10]*w+L[11]*A+L[12]*y+L[13]*b+L[14],v=L[15]*w+L[16]*A+L[17]*y+L[18]*b+L[19],i=0>i?0:i>255?255:i,n=0>n?0:n>255?255:n,s=0>s?0:s>255?255:s,r=0>r?0:r>255?255:r,a=0>a?0:a>255?255:a,l=0>l?0:l>255?255:l,o=0>o?0:o>255?255:o,u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,m=0>m?0:m>255?255:m,_=0>_?0:_>255?255:_,d=0>d?0:d>255?255:d,p=0>p?0:p>255?255:p,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,t[e]=~~i,t[e+1]=~~n,t[e+2]=~~s,t[e+3]=~~r,t[e+4]=~~a,t[e+5]=~~l,t[e+6]=~~o,t[e+7]=~~u,t[e+8]=~~c,t[e+9]=~~f,t[e+10]=~~m,t[e+11]=~~_,t[e+12]=~~d,t[e+13]=~~p,t[e+14]=~~g,t[e+15]=~~v;if(M)for(M<<=2,e=E-M;E>e;e+=4)w=t[e],A=t[e+1],y=t[e+2],b=t[e+3],i=L[0]*w+L[1]*A+L[2]*y+L[3]*b+L[4],n=L[5]*w+L[6]*A+L[7]*y+L[8]*b+L[9],s=L[10]*w+L[11]*A+L[12]*y+L[13]*b+L[14],r=L[15]*w+L[16]*A+L[17]*y+L[18]*b+L[19],i=0>i?0:i>255?255:i,n=0>n?0:n>255?255:n,s=0>s?0:s>255?255:s,r=0>r?0:r>255?255:r,t[e]=~~i,t[e+1]=~~n,t[e+2]=~~s,t[e+3]=~~r}else{for(e=0;E>e;e+=16)w=t[e],A=t[e+1],y=t[e+2],b=t[e+3],i=L[0]*w+L[1]*A+L[2]*y+L[3]*b+L[4],n=L[5]*w+L[6]*A+L[7]*y+L[8]*b+L[9],s=L[10]*w+L[11]*A+L[12]*y+L[13]*b+L[14],r=L[15]*w+L[16]*A+L[17]*y+L[18]*b+L[19],w=t[e+4],A=t[e+5],y=t[e+6],b=t[e+7],a=L[0]*w+L[1]*A+L[2]*y+L[3]*b+L[4],l=L[5]*w+L[6]*A+L[7]*y+L[8]*b+L[9],o=L[10]*w+L[11]*A+L[12]*y+L[13]*b+L[14],u=L[15]*w+L[16]*A+L[17]*y+L[18]*b+L[19],w=t[e+8],A=t[e+9],y=t[e+10],b=t[e+11],c=L[0]*w+L[1]*A+L[2]*y+L[3]*b+L[4],f=L[5]*w+L[6]*A+L[7]*y+L[8]*b+L[9],m=L[10]*w+L[11]*A+L[12]*y+L[13]*b+L[14],_=L[15]*w+L[16]*A+L[17]*y+L[18]*b+L[19],w=t[e+12],A=t[e+13],y=t[e+14],b=t[e+15],d=L[0]*w+L[1]*A+L[2]*y+L[3]*b+L[4],p=L[5]*w+L[6]*A+L[7]*y+L[8]*b+L[9],g=L[10]*w+L[11]*A+L[12]*y+L[13]*b+L[14],v=L[15]*w+L[16]*A+L[17]*y+L[18]*b+L[19],t[e]=~~i,t[e+1]=~~n,t[e+2]=~~s,t[e+3]=~~r,t[e+4]=~~a,t[e+5]=~~l,t[e+6]=~~o,t[e+7]=~~u,t[e+8]=~~c,t[e+9]=~~f,t[e+10]=~~m,t[e+11]=~~_,t[e+12]=~~d,t[e+13]=~~p,t[e+14]=~~g,t[e+15]=~~v;if(M)for(M<<=2,e=E-M;E>e;e+=4)w=t[e],A=t[e+1],y=t[e+2],b=t[e+3],i=L[0]*w+L[1]*A+L[2]*y+L[3]*b+L[4],n=L[5]*w+L[6]*A+L[7]*y+L[8]*b+L[9],s=L[10]*w+L[11]*A+L[12]*y+L[13]*b+L[14],r=L[15]*w+L[16]*A+L[17]*y+L[18]*b+L[19],t[e]=~~i,t[e+1]=~~n,t[e+2]=~~s,t[e+3]=~~r}}return t},apply:function(t,e){if(this._isOn&&this._matrix)if(this._worker)this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:t.getSelectedData(),params:this.serialize()});else{var i=t.getSelectedData();t.setSelectedData(this._apply(i[0],i[1],i[2],t)),e&&e.call(this)}return t}});o.prototype.grayscale=o.prototype.desaturate,o.prototype.rotateHue=o.prototype.adjustHue,o.prototype.thresholdRgb=o.prototype.threshold_rgb,o.prototype.thresholdAlpha=o.prototype.threshold_alpha}(FILTER),!function(t,e){"use strict";var i=t.ImArrayCopy,n=t.Color.clampPixel,s=function(t){var e=new i(256),n=0;if(t)for(;256>n;)e[n]=255-n,n++;else for(;256>n;)e[n]=n,n++;return e},r=function(t){for(var e=new i(256),n=0;256>n;)e[n]=t,n++;return e},a=function(t){return t?new i(t):null},l=Math.pow,h=Math.exp,o=1/255,u=s(),c=s(1),f=t.TableLookupFilter=t.Class(t.Filter,{name:"TableLookupFilter",constructor:function(t,e,i,n){this._tableR=t||null,this._tableG=e||this._tableR,this._tableB=i||this._tableG,this._tableA=n||null},_tableR:null,_tableG:null,_tableB:null,_tableA:null,dispose:function(){var t=this;return t.disposeWorker(),t._tableR=null,t._tableG=null,t._tableB=null,t._tableA=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_tableR:t._tableR,_tableG:t._tableG,_tableB:t._tableB,_tableA:t._tableA}}},unserialize:function(t){var e,i=this;return t&&i.name===t.filter&&(i._isOn=!!t._isOn,e=t.params,i._tableR=e._tableR,i._tableG=e._tableG,i._tableB=e._tableB,i._tableA=e._tableA),i},thresholds:function(t,e,s){t.length||(t=[t]),e||(e=t),s||(s=e);var r,a,l=t.length,h=l+1,o=e.length,u=o+1,c=s.length,f=c+1,m=new i(256),_=new i(h),d=new i(256),p=new i(u),g=new i(256),v=new i(f),w=255/(h-1),A=255/(u-1),y=255/(f-1);for(r=0;h>r;)_[r]=~~(w*r),r++;for(t[0]=~~(255*t[0]),r=1;l>r;)t[r]=t[r-1]+~~(255*t[r]),r++;for(r=0;u>r;)p[r]=~~(A*r),r++;for(e[0]=~~(255*e[0]),r=1;o>r;)e[r]=e[r-1]+~~(255*e[r]),r++;for(r=0;f>r;)v[r]=~~(y*r),r++;for(s[0]=~~(255*s[0]),r=1;c>r;)s[r]=s[r-1]+~~(255*s[r]),r++;for(r=0;256>r;){for(a=0;l>a&&r>t[a];)a++;for(m[r]=n(_[a]),a=0;o>a&&r>e[a];)a++;for(d[r]=n(p[a]),a=0;c>a&&r>s[a];)a++;g[r]=n(v[a]),r++}return this.set(m,d,g)},threshold:function(t,e,i){return t=t||.5,e=e||t,i=i||e,this.thresholds([t],[e],[i])},quantize:function(t){t===e&&(t=64),2>t&&(t=2);var s,r=new i(256),a=new i(t),l=255/(t-1),h=t/256;for(s=0;t>s;)a[s]=~~(l*s),s++;for(s=0;256>s;)r[s]=n(a[~~(h*s)]),s++;return this.set(r)},binarize:function(){return this.quantize(2)},solarize:function(t){t===e&&(t=.5);var s,r,a=0,l=new i(256),h=2/255;for(a=0;256>a;)s=h*a,r=s>t?255-255*s:255*s-255,l[a]=~~n(r),a++;return this.set(l)},solarize2:function(t){t===e&&(t=.5),t=1-t;var s,r,a=0,l=new i(256),h=2/255;for(a=0;256>a;)s=h*a,r=t>s?255-255*s:255*s-255,l[a]=~~n(r),a++;return this.set(l)},solarizeInverse:function(t){t===e&&(t=.5),t*=256;var n=0,s=new i(256);for(n=0;256>n;)s[n]=n>t?255-n:n,n++;return this.set(s)},invert:function(){return this.set(c)},mask:function(t){var e=0,s=255&t>>16,r=255&t>>8,a=255&t;for(tR=new i(256),tG=new i(256),tB=new i(256),e=0;256>e;)tR[e]=n(e&s),tG[e]=n(e&r),tB[e]=n(e&a),e++;return this.set(tR,tG,tB)},replace:function(t,e){if(t==e)return this;var i=255&t>>16,n=255&t>>8,s=255&t,r=255&e>>16,l=255&e>>8,h=255&e,o=a(u),c=a(u),f=a(u);return o[i]=r,c[n]=l,f[s]=h,this.set(o,c,f)},extract:function(e,i,s){if(!i||!i.length)return this;s=s||0;var a,l,h=255&s>>16,o=255&s>>8,u=255&s,c=r(h),f=r(o),m=r(u);switch(e){case t.CHANNEL.BLUE:for(a=i[0],l=i[1];l>=a;)m[a]=n(a),a++;break;case t.CHANNEL.GREEN:for(a=i[0],l=i[1];l>=a;)f[a]=n(a),a++;break;case t.CHANNEL.RED:default:for(a=i[0],l=i[1];l>=a;)c[a]=n(a),a++}return this.set(c,f,m)},gammaCorrection:function(t,e,s){t=t||1,e=e||t,s=s||e,t=1/t,e=1/e,s=1/s;for(var r=new i(256),a=new i(256),h=new i(256),u=0;256>u;)r[u]=n(~~(255*l(o*u,t))),a[u]=n(~~(255*l(o*u,e))),h[u]=n(~~(255*l(o*u,s))),u++;return this.set(r,a,h)},exposure:function(t){t===e&&(t=1);var s=0,r=new i(256);for(s=0;256>s;)r[s]=n(~~(255*(1-h(-t*s*o)))),s++;return this.set(r)},set:function(t,e,i){if(!t)return this;e=e||t,i=i||e;var r,l,h,o,u,c=this._tableR||s(),f=a(c);if(e&&i){for(r=this._tableG||a(c),l=this._tableB||a(r),h=a(r),o=a(l),u=0;256>u;)c[u]=n(t[n(f[u])]),r[u]=n(e[n(h[u])]),l[u]=n(i[n(o[u])]),u++;this._tableR=c,this._tableG=r,this._tableB=l}else{for(u=0;256>u;)c[u]=n(t[n(f[u])]),u++;this._tableR=c,this._tableG=this._tableR,this._tableB=this._tableR}return this},reset:function(){return this._tableR=this._tableG=this._tableB=this._tableA=null,this},combineWith:function(t){return this.set(t.getTable(0),t.getTable(1),t.getTable(2))},getTable:function(e){switch(e=e||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA;case t.CHANNEL.BLUE:return this._tableB;case t.CHANNEL.GREEN:return this._tableG;case t.CHANNEL.RED:default:return this._tableR}},setTable:function(e,i){switch(i=i||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA=e,this;case t.CHANNEL.BLUE:return this._tableB=e,this;case t.CHANNEL.GREEN:return this._tableG=e,this;case t.CHANNEL.RED:default:return this._tableR=e,this}},_apply:function(t){if(!this._isOn||!this._tableR)return t;var e,i,n,s,r,a=t.length,l=(a>>2)%4,h=this._tableR,o=this._tableG,u=this._tableB,c=this._tableA;if(c){for(e=0;a>e;e+=16)i=t[e],n=t[e+1],s=t[e+2],r=t[e+3],t[e]=h[i],t[e+1]=o[n],t[e+2]=u[s],t[e+3]=c[r],i=t[e+4],n=t[e+5],s=t[e+6],r=t[e+7],t[e+4]=h[i],t[e+5]=o[n],t[e+6]=u[s],t[e+7]=c[r],i=t[e+8],n=t[e+9],s=t[e+10],r=t[e+11],t[e+8]=h[i],t[e+9]=o[n],t[e+10]=u[s],t[e+11]=c[r],i=t[e+12],n=t[e+13],s=t[e+14],r=t[e+15],t[e+12]=h[i],t[e+13]=o[n],t[e+14]=u[s],t[e+15]=c[r];if(l)for(l<<=2,e=a-l;a>e;e+=4)i=t[e],n=t[e+1],s=t[e+2],r=t[e+3],t[e]=h[i],t[e+1]=o[n],t[e+2]=u[s],t[e+3]=c[r]}else{for(e=0;a>e;e+=16)i=t[e],n=t[e+1],s=t[e+2],t[e]=h[i],t[e+1]=o[n],t[e+2]=u[s],i=t[e+4],n=t[e+5],s=t[e+6],t[e+4]=h[i],t[e+5]=o[n],t[e+6]=u[s],i=t[e+8],n=t[e+9],s=t[e+10],t[e+8]=h[i],t[e+9]=o[n],t[e+10]=u[s],i=t[e+12],n=t[e+13],s=t[e+14],t[e+12]=h[i],t[e+13]=o[n],t[e+14]=u[s];if(l)for(l<<=2,e=a-l;a>e;e+=4)i=t[e],n=t[e+1],s=t[e+2],t[e]=h[i],t[e+1]=o[n],t[e+2]=u[s]}return t},apply:function(t,e){if(this._isOn&&this._tableR){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._apply(i[0],i[1],i[2],t)),e&&e.call(this))}return t}});f.prototype.posterize=f.prototype.levels=f.prototype.quantize}(FILTER),!function(t){"use strict";var e=(t.ImArray,t.ImArrayCopy),i=t.Array16I,n=Math.min,s=(Math.max,Math.floor);t.DisplacementMapFilter=t.Class(t.Filter,{name:"DisplacementMapFilter",constructor:function(t){t&&this.setMap(t)},_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,red:0,green:0,blue:0,alpha:0,mode:t.MODE.CLAMP,dispose:function(){var t=this;return t.disposeWorker(),t._map=null,t.map=null,t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.red=null,t.green=null,t.blue=null,t.alpha=null,t.mode=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_map:t._map,scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color,red:t.red,green:t.green,blue:t.blue,alpha:t.alpha,mode:t.mode}}},unserialize:function(t){var e,i=this;return t&&i.name===t.filter&&(i._isOn=!!t._isOn,e=t.params,i.map=null,i._map=e._map,i.scaleX=e.scaleX,i.scaleY=e.scaleY,i.startX=e.startX,i.startY=e.startY,i.componentX=e.componentX,i.componentY=e.componentY,i.color=e.color,i.red=e.red,i.green=e.green,i.blue=e.blue,i.alpha=e.alpha,i.mode=e.mode),i},reset:function(){return this._map=null,this.map=null,this},getMap:function(){return this.map},setMap:function(t){return t&&(this.map=t,this._map={data:t.getData(),width:t.width,height:t.height}),this},setColor:function(t){return this.color=t,this.alpha=255&t>>24,this.red=255&t>>16,this.green=255&t>>8,this.blue=255&t,this},_apply:function(r,a,l){if(!this._isOn||!this._map)return r;var h,o,u,c,f,m,_,d,p,g,v,w,A,y,b,E,L,M,I,C,R,N,x,D,k,S,O,T,F,U,P,G=.00390625*this.scaleX,H=.00390625*this.scaleY,W=this.componentX,Y=this.componentY,B=this.alpha,X=this.red,z=this.green,j=this.blue,q=this.mode,V=t.MODE.IGNORE,Q=(t.MODE.CLAMP,t.MODE.COLOR),K=t.MODE.WRAP;for(h=this._map.data,o=this._map.width,u=this._map.height,c=h.length>>2,m=n(o,a),_=n(u,l),T=r.length,S=m*_<<2,O=T>>2,p=s(this.startX*(a-1)),d=s(this.startY*(l-1)),g=d*a,v=-p,w=-d,A=a-p-1,y=l-d-1,f=new i(c<<1),F=new e(r),E=0,L=0,M=0,I=0,b=0;c>b;b++,E+=2,L++)L>=o&&(L=0,M++,I+=o),x=L+I<<2,f[E]=s((h[x+W]-128)*G),f[E+1]=s((h[x+Y]-128)*H);for(L=0,M=0,I=0,C=0,b=0;S>b;b+=4,L++)if(L>=m&&(L=0,M++,I+=a,C+=o),!(w>M||M>y||v>L||L>A)){if(N=L+p,R=M+d,D=N+I+g<<2,E=L+C<<1,U=N+f[E],P=R+f[E+1],P>=l||0>P||U>=a||0>U){if(q==V)continue;if(q==Q){r[D]=X,r[D+1]=z,r[D+2]=j,r[D+3]=B;continue}q==K?(P>y?P-=l:0>P&&(P+=l),U>A?U-=a:0>U&&(U+=a)):(P>y?P=y:0>P&&(P=0),U>A?U=A:0>U&&(U=0))}k=U+P*a<<2,r[D]=F[k],r[D+1]=F[k+1],r[D+2]=F[k+2],r[D+3]=F[k+3]}return r},apply:function(t,e){if(this._isOn&&(this._map||this.map)){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._apply(i[0],i[1],i[2],t)),e&&e.call(this))}return t}})}(FILTER),!function(FILTER,undef){"use strict";var IMG=FILTER.ImArray,IMGcopy=FILTER.ImArrayCopy,PI=FILTER.CONSTANTS.PI,DoublePI=FILTER.CONSTANTS.PI2,HalfPI=FILTER.CONSTANTS.PI_2,ThreePI2=1.5*PI,Sqrt=Math.sqrt,Atan2=Math.atan2,Atan=Math.atan,Sin=Math.sin,Cos=Math.cos,Floor=Math.floor,Asin=Math.asin,Tan=Math.tan,Abs=Math.abs,Max=Math.max,toRad=FILTER.CONSTANTS.toRad,Maps,GeometricMapFilter=FILTER.GeometricMapFilter=FILTER.Class(FILTER.Filter,{name:"GeometricMapFilter",constructor:function(t){t&&this.generic(t)},_map:null,_mapName:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,angle:0,radius:0,wavelength:0,amplitude:0,phase:0,xAmplitude:0,yAmplitude:0,xWavelength:0,yWavelength:0,mode:FILTER.MODE.CLAMP,dispose:function(){var t=this;return t.disposeWorker(),t._map=null,t._mapName=null,t.inverseTransform=null,t.matrix=null,t.centerX=null,t.centerY=null,t.angle=null,t.radius=null,t.wavelength=null,t.amplitude=null,t.phase=null,t.xAmplitude=null,t.yAmplitude=null,t.xWavelength=null,t.yWavelength=null,t.mode=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_mapName:t._mapName,inverseTransform:t.inverseTransform?t.inverseTransform.toString():null,matrix:t.matrix,centerX:t.centerX,centerY:t.centerY,angle:t.angle,radius:t.radius,wavelength:t.wavelength,amplitude:t.amplitude,phase:t.phase,xAmplitude:t.xAmplitude,yAmplitude:t.yAmplitude,xWavelength:t.xWavelength,yWavelength:t.yWavelength,mode:t.mode}}},unserialize:function(json){var self=this,params;return json&&self.name===json.filter&&(self._isOn=!!json._isOn,params=json.params,self.inverseTransform=null,self.matrix=params.matrix,self.centerX=params.centerX,self.centerY=params.centerY,self.angle=params.angle,self.radius=params.radius,self.wavelength=params.wavelength,self.amplitude=params.amplitude,self.phase=params.phase,self.xAmplitude=params.xAmplitude,self.yAmplitude=params.yAmplitude,self.xWavelength=params.xWavelength,self.yWavelength=params.yWavelength,self.mode=params.mode,params.inverseTransform&&(self.inverseTransform=eval('(function(){ "use strict"; return '+params.inverseTransform+"})();")),self._mapName=params._mapName,self._map=null,self._mapName&&Maps[self._mapName]&&(self._map=Maps[self._mapName].bind(self))),self},generic:function(t){return t&&(this.inverseTransform=t,this._mapName="generic",this._map=Maps.generic.bind(this)),this},affine:function(t){return t&&(this.matrix=t,this._mapName="affine",this._map=Maps.affine.bind(this)),this},flipX:function(){return this._mapName="flipX",this._map=Maps.flipX.bind(this),this},flipY:function(){return this._mapName="flipY",this._map=Maps.flipY.bind(this),this},flipXY:function(){return this._mapName="flipXY",this._map=Maps.flipXY.bind(this),this},rotateCW:function(){return this._mapName="rotateCW",this._map=Maps.rotateCW.bind(this),this},rotateCCW:function(){return this._mapName="rotateCCW",this._map=Maps.rotateCCW.bind(this),this},polar:function(t,e){return this.centerX=t||0,this.centerY=e||0,this._mapName="polar",this._map=Maps.polar.bind(this),this},cartesian:function(t,e){return this.centerX=t||0,this.centerY=e||0,this._mapName="cartesian",this._map=Maps.cartesian.bind(this),this},twirl:function(t,e,i,n){return this.angle=t||0,this.radius=e||0,this.centerX=i||0,this.centerY=n||0,this._mapName="twirl",this._map=Maps.twirl.bind(this),this},sphere:function(t,e,i){return this.radius=t||0,this.centerX=e||0,this.centerY=i||0,this._mapName="sphere",this._map=Maps.sphere.bind(this),this},ripple:function(t,e,i,n,s,r){return this.radius=t!==undef?t:50,this.centerX=s||0,this.centerY=r||0,this.wavelength=e!==undef?e:16,this.amplitude=i!==undef?i:10,this.phase=n||0,this._mapName="ripple",this._map=Maps.ripple.bind(this),this},reset:function(){return this._mapName=null,this._map=null,this},getMap:function(){return this._map},setMap:function(t){return this._mapName=null,this._map=t,this},_apply:function(t,e,i,n){return this._isOn&&this._map?this._map(t,e,i,n):t},apply:function(t,e){if(this._isOn&&this._map){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._map(i[0],i[1],i[2],t)),e&&e.call(this))}return t}});Maps={generic:function(t,e,i){var n,s,r,a,l,h,o,u=t.length,c=new IMG(u),f=this.inverseTransform,m=this.mode,_=FILTER.MODE.CLAMP,d=FILTER.MODE.WRAP;for(n=0,s=0,r=0;u>r;r+=4,n++){if(n>=e&&(n=0,s++),l=f([n,s],e,i),h=~~l[0],o=~~l[1],0>h||h>=e||0>o||o>=i)switch(m){case d:o>=i?o-=i:0>o&&(o+=i),h>=e?h-=e:0>h&&(h+=e);break;case _:default:o>=i?o=i-1:0>o&&(o=0),h>=e?h=e-1:0>h&&(h=0)}a=h+o*e<<2,c[r]=t[a],c[r+1]=t[a+1],c[r+2]=t[a+2],c[r+3]=t[a+3]}return c},affine:function(t,e){var i,n,s,r,a,l,h,o,u,c=t.length,f=c>>2,m=new IMG(c),_=this.matrix,d=_[0],p=_[1],g=_[3],v=_[4],w=_[2],A=_[5],y=this.mode,b=FILTER.MODE.CLAMP,E=FILTER.MODE.WRAP,L=e-1,M=f-e;for(i=0,n=0,a=A*e,l=g*e,h=v*e,s=0;c>s;s+=4,i++){if(i>=e&&(i=0,n++),o=~~(d*i+p*n+w),u=~~(l*i+h*n+a),0>o||o>L||0>u||u>M)switch(y){case E:u>M?u-=f:0>u&&(u+=f),o>=e?o-=e:0>o&&(o+=e);break;case b:default:u>M?u=M:0>u&&(u=0),o>L?o=L:0>o&&(o=0)}r=o+u<<2,m[s]=t[r],m[s+1]=t[r+1],m[s+2]=t[r+2],m[s+3]=t[r+3]}return m},flipX:function(t,e){var i,n,s,r,a,l=t.length,h=new IMG(l);for(i=0,n=0,s=0,r=0;l>r;r+=4,i++)i>=e&&(i=0,n++,s+=e),a=e-1-i+s<<2,h[r]=t[a],h[r+1]=t[a+1],h[r+2]=t[a+2],h[r+3]=t[a+3];return h},flipY:function(t,e,i){var n,s,r,a,l,h=t.length,o=new IMG(h);for(n=0,s=0,r=(i-1)*e,a=0;h>a;a+=4,n++)n>=e&&(n=0,s++,r-=e),l=n+r<<2,o[a]=t[l],o[a+1]=t[l+1],o[a+2]=t[l+2],o[a+3]=t[l+3];return o},flipXY:function(t,e,i){var n,s,r,a,l,h,o=t.length,u=new IMG(o);for(n=0,s=0,a=(i-1)*e,l=0;o>l;l+=4,n++)n>=e&&(n=0,s++,r+=e,a-=e),h=e-1-n+a<<2,u[l]=t[h],u[l+1]=t[h+1],u[l+2]=t[h+2],u[l+3]=t[h+3];return u},rotateCW:function(t,e){var i,n,s,r,a,l=t.length,h=new IMG(l),o=l>>2;for(i=0,n=0,s=o-1,r=0;l>r;r+=4,i++,s-=e)i>=e&&(i=0,s=o-1,n++),a=n+s<<2,h[r]=t[a],h[r+1]=t[a+1],h[r+2]=t[a+2],h[r+3]=t[a+3];return h},rotateCCW:function(t,e){var i,n,s,r,a,l=t.length,h=new IMG(l);for(i=0,n=0,s=0,r=0;l>r;r+=4,i++,s+=e)i>=e&&(i=0,s=0,n++),a=e-1-n+s<<2,h[r]=t[a],h[r+1]=t[a+1],h[r+2]=t[a+2],h[r+3]=t[a+3];return h},twirl:function(t,e,i){if(0>=this.radius)return t;var n,s,r,a,l,h,o,u,c=t.length,f=new IMGcopy(t),m=this.centerX,_=this.centerY,d=this.angle,p=this.radius,g=this.mode,v=FILTER.MODE.CLAMP,w=FILTER.MODE.WRAP,A=d/p,y=e-1,b=i-1;for(m=Floor(m*(e-1)),_=Floor(_*(i-1)),n=0,s=0,r=0;c>r;r+=4,n++)if(n>=e&&(n=0,s++),h=n-m,o=s-_,l=Sqrt(h*h+o*o),p>l){if(u=Atan2(o,h)+A*(p-l),h=~~(m+l*Cos(u)),o=~~(_+l*Sin(u)),0>h||h>y||0>o||o>b)switch(g){case w:o>b?o-=i:0>o&&(o+=i),h>y?h-=e:0>h&&(h+=e);break;case v:default:o>b?o=b:0>o&&(o=0),h>y?h=y:0>h&&(h=0)}a=h+o*e<<2,t[r]=f[a],t[r+1]=f[a+1],t[r+2]=f[a+2],t[r+3]=f[a+3]}return t},sphere:function(t,e,i){if(0>=this.radius)return t;var n,s,r,a,l,h,o,u,c,f,m,_,d,p=t.length,g=new IMGcopy(t),v=this.centerX,w=this.centerY,A=this.radius,y=this.mode,b=FILTER.MODE.CLAMP,E=FILTER.MODE.WRAP,L=A*A,M=.555556,I=1-M,C=e-1,R=i-1;for(v=Floor(v*(e-1)),w=Floor(w*(i-1)),n=0,s=0,r=0;p>r;r+=4,n++)if(n>=e&&(n=0,s++),l=n-v,h=s-w,_=l*l,d=h*h,o=_+d,L>o){if(f=L-o,m=Sqrt(f),u=Asin(l/Sqrt(_+f))*I,c=Asin(h/Sqrt(d+f))*I,l=~~(n-m*Tan(u)),h=~~(s-m*Tan(c)),0>l||l>C||0>h||h>R)switch(y){case E:h>R?h-=i:0>h&&(h+=i),l>C?l-=e:0>l&&(l+=e);break;case b:default:h>R?h=R:0>h&&(h=0),l>C?l=C:0>l&&(l=0)}a=l+h*e<<2,t[r]=g[a],t[r+1]=g[a+1],t[r+2]=g[a+2],t[r+3]=g[a+3]}return t},ripple:function(t,e,i){if(0>=this.radius)return t;var n,s,r,a,l,h,o,u,c,f,m,_=t.length,d=new IMGcopy(t),p=FILTER.MODE.CLAMP,g=FILTER.MODE.WRAP,v=e-1,w=i-1,A=this.centerX,y=this.centerY,b=this.radius,E=this.mode,L=b*b,M=this.wavelength,I=this.amplitude,C=this.phase;for(A=Floor(A*(e-1)),y=Floor(y*(i-1)),n=0,s=0,r=0;_>r;r+=4,n++)if(n>=e&&(n=0,s++),h=n-A,o=s-y,f=h*h,m=o*o,c=f+m,L>c){if(l=Sqrt(c),u=I*Sin(2*l/M*Math.PI-C),u*=(b-l)/b,l&&(u*=M/l),h=~~(n+h*u),o=~~(s+o*u),0>h||h>v||0>o||o>w)switch(E){case g:o>w?o-=i:0>o&&(o+=i),h>v?h-=e:0>h&&(h+=e);break;case p:default:o>w?o=w:0>o&&(o=0),h>v?h=v:0>h&&(h=0)}a=h+o*e<<2,t[r]=d[a],t[r+1]=d[a+1],t[r+2]=d[a+2],t[r+3]=d[a+3]}return t},polar:function(t,e,i){var n,s,r,a,l,h,o,u,c,f,m,_,d=t.length,p=new IMGcopy(t),g=FILTER.MODE.CLAMP,v=FILTER.MODE.WRAP,w=e-1,A=i-1,y=0,b=this.mode;for(m=~~(.5*e+.5),_=~~(.5*i+.5),f=Max(_,m),n=0,s=0,r=0;d>r;r+=4,n++){if(n>=e&&(n=0,s++),a=n-m,l=s-_,c=0,a>=0?l>0?(c=PI-Atan(a/l),y=Sqrt(a*a+l*l)):0>l?(c=Atan(a/l),y=Sqrt(a*a+l*l)):(c=HalfPI,y=a):0>a&&(0>l?(c=DoublePI-Atan(a/l),y=Sqrt(a*a+l*l)):l>0?(c=PI+Atan(a/l),y=Sqrt(a*a+l*l)):(c=ThreePI2,y=-a)),h=e-1-(e-1)/DoublePI*c,o=i*y/f,0>h||h>w||0>o||o>A)switch(b){case v:o>A?o-=i:0>o&&(o+=i),h>w?h-=e:0>h&&(h+=e);break;case g:default:o>A?o=A:0>o&&(o=0),h>w?h=w:0>h&&(h=0)}u=~~(h+.5)+~~(o+.5)*e<<2,t[r]=p[u],t[r+1]=p[u+1],t[r+2]=p[u+2],t[r+3]=p[u+3]}return t},cartesian:function(t,e,i){var n,s,r,a,l,h,o,u,c,f,m,_,d,p=t.length,g=new IMGcopy(t),v=FILTER.MODE.CLAMP,w=FILTER.MODE.WRAP,A=e-1,y=i-1,b=0,E=this.mode;for(_=~~(.5*e+.5),d=~~(.5*i+.5),m=Max(d,_),n=0,s=0,r=0;p>r;r+=4,n++){if(n>=e&&(n=0,s++),c=n/e*DoublePI,f=c>=ThreePI2?DoublePI-c:c>=PI?c-PI:c>=HalfPI?PI-c:c,b=m*(s/i),o=-b*Sin(f),u=b*Cos(f),c>=ThreePI2?(a=_-o,l=d-u):c>=PI?(a=_-o,l=d+u):c>=HalfPI?(a=_+o,l=d+u):(a=_+o,l=d-u),0>a||a>A||0>l||l>y)switch(E){case w:l>y?l-=i:0>l&&(l+=i),a>A?a-=e:0>a&&(a+=e);break;case v:default:l>y?l=y:0>l&&(l=0),a>A?a=A:0>a&&(a=0)}h=~~(a+.5)+~~(l+.5)*e<<2,t[r]=g[h],t[r+1]=g[h+1],t[r+2]=g[h+2],t[r+3]=g[h+3]}return t}}}(FILTER),!function(t,e){"use strict";function i(t,e,i,n){var s,r=t.length,a=new A(t.length);for(i=i||1,n=n||1,s=0;r>s;)a[s]=i*t[s]+n*e[s],s++;return a}function n(t,e){var i,n,s,r=t.length,a=[],l=0;for(i=0;r>i;i++)for(n=0;r>n;n++)s=t[i]*e[n],l+=s,a.push(s);return{kernel:a,sum:l}}function s(t){var e,i=new Array(t);for(e=0;t>e;)i[e]=1,e++;return i}function r(t){var e,i,n,s,r=M.length;if(t--,r>t)e=new A(M[t]);else for(e=new A(M[r-1]);t>=r;){for(i=e,e=new A(i.length+1),e[0]=1,n=0,s=i.length-1;s>n;n++)e[n+1]=i[n]+i[n+1];e[i.length]=1,40>r&&M.push(new Array(e)),r++}return e}function a(t){var e,i=t>>1,n=-i,s=new Array(t);for(e=0;t>e;)s[e]=n,n++,e++;return s}function l(t){var e=r(t);return n(e,e)}function h(t,e){var i=r(t),s=a(t);return 1==e?n(s.reverse(),i):n(i,s)}function o(t,e){var i=s(t),r=a(t);return 1==e?n(r.reverse(),i):n(i,r)}function u(t,e,i){e=e||1,i=i||e;var n,s=t*t,r=s>>1,a=new A(s);for(n=0;s>n;)a[n]=e,n++;return a[r]=i,a}function c(t,e,i,n){var s,r,a,l,h,o=t*t,u=t>>1,c=o>>1,f=new A(o);for(l=0,s=0;u>=s;s++){for(r=0,h=0,a=0;u>=a;a++)f[c+s+r]=l+h,f[c-s-r]=-l-h,f[c-s+r]=-l+h,f[c+s-r]=l-h,r+=t,h+=i;l+=e}return f[c]=n||1,f}function f(t,e,i,n){var s,r,a,l,h,o,u=t*t,c=t>>1,f=u>>1,m=new A(u),_=new A(u),d=1/t,g=1e-8;for(p(e)>g?(h=1,o=i/e):(h=e/i,o=1),s=0,a=0,l=0,r=o*t;c>=s;)_[f+s]=~~(f+a+l+.5),_[f-s]=~~(f-a-l+.5),s++,a+=h,l+=r;for(s=0;c>=s;)m[_[f+s]]=m[_[f-s]]=d,s++;return m[f]=n||1,m}function m(t,e,i,n,s,r,a,l,h,o){var u,c,f,m,_,d,p,g,v,w,A,E,M,I,C,R,N,x,D,k,S,O,T,F,U,P,G,H,W,Y,B,X,z,j,q,V,Q,K,$,J,Z,te,ee,ie,ne,se,re,ae=t.length,le=ae>>2,he=r,oe=a;if(g=he*oe,d=he>>1,p=e*(oe>>1),A=-d-1,M=-p-e,E=d,I=p,Y=0,X=e-1,B=0,z=le-e,c=(le<<1)+le,w=(e<<1)+e,o=o||1,re=0,s)for(k=n[0],S=n[g>>1],O=S-k,T=s[0],F=s[g>>1],U=F-T;o>re;){for(v=new y(ae),u=new b(c),C=0,R=0,f=m=_=0,N=0;e>N;N++,C+=4,R+=3)f+=t[C],m+=t[C+1],_+=t[C+2],u[R]=f,u[R+1]=m,u[R+2]=_;for(R=0,N=0,f=m=_=0,C=w+e;ae>C;C+=4,R+=3,N++)N>=e&&(N=0,f=m=_=0),f+=t[C],m+=t[C+1],_+=t[C+2],u[R+w]=u[R]+f,u[R+w+1]=u[R+1]+m,u[R+w+2]=u[R+2]+_;for(N=0,x=0,D=0,C=0;ae>C;C+=4,N++)N>=e&&(N=0,x++,D+=e),P=N+A,G=D+M,H=N+E,W=D+I,P=Y>P?Y:P,H=H>X?X:H,G=B>G?B:G,W=W>z?z:W,j=P+G,Q=H+W,q=H+G,V=P+W,j=(j<<1)+j,q=(q<<1)+q,V=(V<<1)+V,Q=(Q<<1)+Q,Z=k*(u[Q]-u[q]-u[V]+u[j])+O*t[C],te=k*(u[Q+1]-u[q+1]-u[V+1]+u[j+1])+O*t[C+1],ee=k*(u[Q+2]-u[q+2]-u[V+2]+u[j+2])+O*t[C+2],ie=T*(u[Q]-u[q]-u[V]+u[j])+U*t[C],ne=T*(u[Q+1]-u[q+1]-u[V+1]+u[j+1])+U*t[C+1],se=T*(u[Q+2]-u[q+2]-u[V+2]+u[j+2])+U*t[C+2],K=l*Z+h*ie,$=l*te+h*ne,J=l*ee+h*se,L&&(K=0>K?0:K>255?255:K,$=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J),v[C]=~~K,v[C+1]=~~$,v[C+2]=~~J,v[C+3]=t[C+3];t=v,re++}else for(k=n[0],S=n[g>>1],O=S-k;o>re;){for(v=new y(ae),u=new b(c),C=0,R=0,f=m=_=0,N=0;e>N;N++,C+=4,R+=3)f+=t[C],m+=t[C+1],_+=t[C+2],u[R]=f,u[R+1]=m,u[R+2]=_;for(R=0,N=0,f=m=_=0,C=w+e;ae>C;C+=4,R+=3,N++)N>=e&&(N=0,f=m=_=0),f+=t[C],m+=t[C+1],_+=t[C+2],u[R+w]=u[R]+f,u[R+w+1]=u[R+1]+m,u[R+w+2]=u[R+2]+_;for(N=0,x=0,D=0,C=0;ae>C;C+=4,N++)N>=e&&(N=0,x++,D+=e),P=N+A,G=D+M,H=N+E,W=D+I,P=Y>P?Y:P,H=H>X?X:H,G=B>G?B:G,W=W>z?z:W,j=P+G,Q=H+W,q=H+G,V=P+W,j=(j<<1)+j,q=(q<<1)+q,V=(V<<1)+V,Q=(Q<<1)+Q,Z=k*(u[Q]-u[q]-u[V]+u[j])+O*t[C],te=k*(u[Q+1]-u[q+1]-u[V+1]+u[j+1])+O*t[C+1],ee=k*(u[Q+2]-u[q+2]-u[V+2]+u[j+2])+O*t[C+2],K=l*Z+h,$=l*te+h,J=l*ee+h,L&&(K=0>K?0:K>255?255:K,$=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J),v[C]=~~K,v[C+1]=~~$,v[C+2]=~~J,v[C+3]=t[C+3];t=v,re++}return v}function _(t,e,i,n,s,r,a,l,h){var o,u,c,f,m,_,d,p,g,v,w,A,b,M,I,C,R,N,x,D,k,S,O,T,F,U,P,G=t.length,H=G>>2;for(o=[s,n],u=[a,r],F=[h,l],C=e-1,R=H-e,P=2;P--;){for(d=new y(G),f=o[P],m=u[P],c=f.length,_=m.length,U=F[P],p=new E(m),w=0;_>w;w+=2)p[w+1]*=e;if(L)for(A=0,b=0,g=0;G>g;g+=4,A++){for(A>=e&&(A=0,b+=e),S=0,O=0,T=0,w=0,v=0;c>w;w++,v+=2)M=A+p[v],I=b+p[v+1],M>=0&&C>=M&&I>=0&&R>=I&&(srcOff=M+I<<2,k=f[w],S+=t[srcOff]*k,O+=t[srcOff+1]*k,T+=t[srcOff+2]*k);N=U*S,x=U*O,D=U*T,N=0>N?0:N>255?255:N,x=0>x?0:x>255?255:x,D=0>D?0:D>255?255:D,d[g]=~~N,d[g+1]=~~x,d[g+2]=~~D,d[g+3]=t[g+3]}else for(A=0,b=0,g=0;G>g;g+=4,A++){for(A>=e&&(A=0,b+=e),S=0,O=0,T=0,w=0,v=0;c>w;w++,v+=2)M=A+p[v],I=b+p[v+1],M>=0&&C>=M&&I>=0&&R>=I&&(srcOff=M+I<<2,k=f[w],S+=t[srcOff]*k,O+=t[srcOff+1]*k,T+=t[srcOff+2]*k);N=U*S,x=U*O,D=U*T,d[g]=~~N,d[g+1]=~~x,d[g+2]=~~D,d[g+3]=t[g+3]}t=d}return d}var d=(t.CONSTANTS.SQRT2,t.CONSTANTS.toRad),p=(t.CONSTANTS.toDeg,Math.abs),g=Math.sqrt,v=Math.sin,w=Math.cos,A=t.Array32F,y=t.ImArray,b=t.Array32F,E=t.Array16I,L=(t.Array8U,t._notSupportClamp),M=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],I=t.ConvolutionMatrixFilter=t.Class(t.Filter,{name:"ConvolutionMatrixFilter",constructor:function(e,i,n){this._coeff=new A([1,0]),e&&e.length?this.set(e,~~(g(e.length)+.5),i||1,n||0):(this._matrix=null,this._dim=0),this._matrix2=null,this._dim2=0,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,t.useWebGL&&(this._webglInstance=t.WebGLConvolutionMatrixFilterInstance||null)},_dim:0,_dim2:0,_matrix:null,_matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_webglInstance:null,dispose:function(){var t=this;return t.disposeWorker(),t._webglInstance=null,t._dim=null,t._dim2=null,t._matrix=null,t._matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_dim:t._dim,_dim2:t._dim2,_matrix:t._matrix,_matrix2:t._matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2}}},unserialize:function(t){var e,i=this;return t&&i.name===t.filter&&(i._isOn=!!t._isOn,e=t.params,i._dim=e._dim,i._dim2=e._dim2,i._matrix=e._matrix,i._matrix2=e._matrix2,i._mat=e._mat,i._mat2=e._mat2,i._coeff=e._coeff,i._isGrad=e._isGrad,i._doIntegral=e._doIntegral,i._doSeparable=e._doSeparable,i._indices=e._indices,i._indices2=e._indices2,i._indicesf=e._indicesf,i._indicesf2=e._indicesf2),i},lowPass:function(t){return t=t===e?3:t%2?t:t+1,this.set(u(t),t,1/(t*t),0),this._doIntegral=1,this},highPass:function(t,i){t=t===e?3:t%2?t:t+1,i=i===e?1:i;var n=t*t,s=-i/n,r=u(t,s,1+s);return this.set(r,t,1,0),this._doIntegral=1,this},glow:function(t,i){return t=t===e?.5:t,this.highPass(i,-t)},sharpen:function(t,i){return t=t===e?.5:t,this.highPass(i,t)},verticalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(s(t),1,1/t,0),this._dim2=t,this._doIntegral=1,this},horizontalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(s(t),t,1/t,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(t,i){i=i===e?3:i%2?i:i+1,t*=d;var n=w(t),s=-v(t),r=f(i,n,s,1/i);return this.set(r,i,1,0)},fastGauss:function(t,i){return i=i===e?3:i%2?i:i+1,t=~~(t||1),1>t?t=1:t>3&&(t=3),this.set(u(i),i,1/(i*i),0),this._doIntegral=t,this},binomialLowPass:function(t){t=t===e?3:t%2?t:t+1;var i=r(t),n=1<<t-1,s=1/n;this.set(i,t,s,s),this._matrix2=new A(i);var a=this._computeIndices(this._matrix2,this._dim2);return this._indices2=a[0],this._indicesf2=a[1],this._mat2=a[2],this._doSeparable=!0,this},binomialHighPass:function(t){t=t===e?3:t%2?t:t+1;var n=l(t);return this.set(i(u(t),new A(n.kernel),1,-1/n.sum),t,1,0)},prewittX:function(t){t=t===e?3:t%2?t:t+1;var i=o(t,0);return this.set(i.kernel,t,1,0)},prewittY:function(t){t=t===e?3:t%2?t:t+1;var i=o(t,1);return this.set(i.kernel,t,1,0)},prewittDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=d;var s=w(t),r=v(t),a=o(n,0),l=o(n,1);return this.set(i(new A(a.kernel),new A(l.kernel),s,r),n,1,0)},prewitt:function(t){t=t===e?3:t%2?t:t+1;var i=o(t,0),n=o(t,1);
this.set(i.kernel,t,1,0),this._isGrad=!0,this._matrix2=new A(n.kernel);var s=this._computeIndices(this._matrix2,this._dim2);return this._indices2=s[0],this._indicesf2=s[1],this._mat2=s[2],this},sobelX:function(t){t=t===e?3:t%2?t:t+1;var i=h(t,0);return this.set(i.kernel,t,1,0)},sobelY:function(t){t=t===e?3:t%2?t:t+1;var i=h(t,1);return this.set(i.kernel,t,1,0)},sobelDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=d;var s=w(t),r=v(t),a=h(n,0),l=h(n,1);return this.set(i(new A(a.kernel),new A(l.kernel),s,r),n,1,0)},sobel:function(t){t=t===e?3:t%2?t:t+1;var i=h(t,0),n=h(t,1);this.set(i.kernel,t,1,0),this._matrix2=new A(n.kernel);var s=this._computeIndices(this._matrix2,this._dim2);return this._indices2=s[0],this._indicesf2=s[1],this._mat2=s[2],this._isGrad=!0,this},laplace:function(t){t=t===e?3:t%2?t:t+1;var i=t*t,n=u(t,-1,i-1);return this.set(n,t,1,0),this._doIntegral=1,this},emboss:function(t,i,n){n=n===e?3:n%2?n:n+1,t=t===e?-.25*Math.PI:t*d,i=i||1;var s=i*w(t),r=-i*v(t),a=c(n,s,r,1);return this.set(a,n,1,0)},edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,i,n){this._matrix2=null,this._dim2=0,this._indices2=this._indicesf2=null,this._mat2=null,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,this._matrix=new A(t),this._dim=e,this._coeff[0]=i||1,this._coeff[1]=n||0;var s=this._computeIndices(this._matrix,this._dim);return this._indices=s[0],this._indicesf=s[1],this._mat=s[2],this},_computeIndices:function(t,e){var i,n,s,r=[],a=[],l=[],h=t.length,o=e,u=o>>1;for(n=0,s=0,i=0;h>i;)a.push(n-u),a.push(s-u),t[i]&&(r.push(n-u),r.push(s-u),l.push(t[i])),i++,n++,n>=o&&(n=0,s++);return[new E(r),new E(a),new A(l)]},reset:function(){return this._matrix=this._matrix2=null,this._mat=this._mat2=null,this._dim=this._dim2=0,this._indices=this._indices2=this._indicesf=this._indicesf2=null,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,this},combineWith:function(){return this},getMatrix:function(){return this._matrix},setMatrix:function(t,e){return this.set(t,e)},_apply:function(t,e,i){if(!this._isOn||!this._matrix)return t;if(this._doIntegral)return this._matrix2?m(t,e,i,this._matrix,this._matrix2,this._dim,this._dim2,this._coeff[0],this._coeff[1],this._doIntegral):m(t,e,i,this._matrix,null,this._dim,this._dim,this._coeff[0],this._coeff[1],this._doIntegral);if(this._doSeparable)return _(t,e,i,this._mat,this._mat2,this._indices,this._indices2,this._coeff[0],this._coeff[1]);var n,s,r,a,l,h,o,u,c,f,d,g,v,w,A,b,M,I,C,R,N,x,D=t.length,k=D>>2,S=new y(D),O=e-1,T=k-e,F=this._coeff[0],U=this._coeff[1],P=this._matrix,G=this._matrix2,H=this._isGrad;if(G){for(R=this._indicesf.length,x=new E(this._indicesf),h=0;R>h;h+=2)x[h+1]*=e;for(N=P.length,o=0,u=0,a=0;D>a;a+=4,o++){for(o>=e&&(o=0,u+=e),g=0,v=0,w=0,A=0,b=0,M=0,h=0,l=0;N>h;h++,l+=2)c=o+x[l],f=u+x[l+1],c>=0&&O>=c&&f>=0&&T>=f&&(d=c+f<<2,I=P[h],g+=t[d]*I,v+=t[d+1]*I,w+=t[d+2]*I,C=G[h],A+=t[d]*C,b+=t[d+1]*C,M+=t[d+2]*C);H?(n=p(g)+p(A),s=p(v)+p(b),r=p(w)+p(M)):(n=F*g+U*A,s=F*v+U*b,r=F*w+U*M),L&&(n=0>n?0:n>255?255:n,s=0>s?0:s>255?255:s,r=0>r?0:r>255?255:r),S[a]=~~n,S[a+1]=~~s,S[a+2]=~~r,S[a+3]=t[a+3]}}else{for(R=this._indices.length,x=new E(this._indices),h=0;R>h;h+=2)x[h+1]*=e;for(P=this._mat,N=P.length,o=0,u=0,a=0;D>a;a+=4,o++){for(o>=e&&(o=0,u+=e),g=0,v=0,w=0,h=0,l=0;N>h;h++,l+=2)c=o+x[l],f=u+x[l+1],c>=0&&O>=c&&f>=0&&T>=f&&(d=c+f<<2,I=P[h],g+=t[d]*I,v+=t[d+1]*I,w+=t[d+2]*I);n=F*g+U,s=F*v+U,r=F*w+U,L&&(n=0>n?0:n>255?255:n,s=0>s?0:s>255?255:s,r=0>r?0:r>255?255:r),S[a]=~~n,S[a+1]=~~s,S[a+2]=~~r,S[a+3]=t[a+3]}}return S},apply:function(t,e){if(this._isOn&&this._matrix)if(this._worker)this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:t.getSelectedData(),params:this.serialize()});else{var i=t.getSelectedData();t.setSelectedData(this._apply(i[0],i[1],i[2],t)),e&&e.call(this)}return t}});I.prototype.bump=I.prototype.emboss,I.prototype.boxBlur=I.prototype.lowPass,I.prototype.gaussBlur=I.prototype.binomialLowPass,I.prototype.gradX=I.prototype.prewittX,I.prototype.gradY=I.prototype.prewittY,I.prototype.gradDirectional=I.prototype.prewittDirectional,I.prototype.grad=I.prototype.prewitt}(FILTER),!function(t){"use strict";var e,i=t.ImArray,n=t.Array8U,s=t.Array32I,r=Math.sqrt,a=function(t){var e,i=t*t,s=new n(i);for(e=0;i>e;e++)s[e]=1;return s},l=a(3);t.MorphologicalFilter=t.Class(t.Filter,{name:"MorphologicalFilter",constructor:function(){this._filterName=null,this._filter=null,this._dim=0,this._structureElement=null,this._indices=null},_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var t=this;return t.disposeWorker(),t._filterName=null,t._filter=null,t._dim=null,t._structureElement=null,t._indices=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_structureElement:t._structureElement,_indices:t._indices}}},unserialize:function(t){var i,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,i=t.params,n._dim=i._dim,n._structureElement=i._structureElement,n._indices=i._indices,n._filterName=i._filterName,n._filterName&&e[n._filterName]&&(n._filter=e[n._filterName].bind(n))),n},erode:function(t){return this.set(t,"erode")},dilate:function(t){return this.set(t,"dilate")},opening:function(t){return this.set(t,"open")},closing:function(t){return this.set(t,"close")},set:function(t,i){this._filterName=i,this._filter=e[i].bind(this),t&&t.length?(this._structureElement=new n(t),this._dim=~~(r(this._structureElement.length)+.5)):t&&t===t-0?(this._structureElement=a(t),this._dim=t):(this._structureElement=l,this._dim=3);var h,o,u,c=[],t=this._structureElement,f=t.length,m=this._dim,_=m>>1;for(o=0,u=0,h=0;f>h;)t[h]&&(c.push(o-_),c.push(u-_)),h++,o++,o>=m&&(o=0,u++);return this._indices=new s(c),this},reset:function(){return this._filterName=null,this._filter=null,this._dim=0,this._structureElement=null,this._indices=null,this},_apply:function(t,e,i){return this._isOn&&this._dim&&this._filter?this._filter(t,e,i):t},apply:function(t,e){if(this._isOn&&this._dim&&this._filter){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._filter(i[0],i[1],i[2],t)),e&&e.call(this))}return t}}),e={dilate:function(t,e){var n,r,a,l,h,o,u,c,f,m,_,d,p,g,v=this._structureElement,w=(v.length,this._dim,new s(this._indices)),A=t.length,y=A>>2,b=new i(A),E=w.length,L=E>>1,M=e-1,I=y-e;for(a=0;E>a;a+=2)w[a+1]*=e;for(l=0,h=0,n=0;A>n;n+=4,l++){for(l>=e&&(l=0,h+=e),d=0,p=0,g=0,r=0;L>r;r+=2)o=l+w[r],u=h+w[r+1],o>=0&&M>=o&&u>=0&&I>=u&&(c=o+u<<2,f=t[c],m=t[c+1],_=t[c+2],f>d&&(d=f),m>p&&(p=m),_>g&&(g=_));b[n]=d,b[n+1]=p,b[n+2]=g,b[n+3]=t[n+3]}return b},erode:function(t,e){var n,r,a,l,h,o,u,c,f,m,_,d,p,g,v=this._structureElement,w=(v.length,this._dim,new s(this._indices)),A=t.length,y=A>>2,b=new i(A),E=w.length,L=E>>1,M=e-1,I=y-e;for(a=0;E>a;a+=2)w[a+1]*=e;for(l=0,h=0,n=0;A>n;n+=4,l++){for(l>=e&&(l=0,h+=e),d=255,p=255,g=255,r=0;L>r;r+=2)o=l+w[r],u=h+w[r+1],o>=0&&M>=o&&u>=0&&I>=u&&(c=o+u<<2,f=t[c],m=t[c+1],_=t[c+2],d>f&&(d=f),p>m&&(p=m),g>_&&(g=_));b[n]=d,b[n+1]=p,b[n+2]=g,b[n+3]=t[n+3]}return b},open:function(t,e){var n,r,a,l,h,o,u,c,f,m,_,d,p,g,v=this._structureElement,w=(v.length,this._dim,new s(this._indices)),A=t.length,y=A>>2,b=new i(A),E=w.length,L=E>>1,M=e-1,I=y-e;for(a=0;E>a;a+=2)w[a+1]*=e;for(l=0,h=0,n=0;A>n;n+=4,l++){for(l>=e&&(l=0,h+=e),d=255,p=255,g=255,r=0;L>r;r+=2)o=l+w[r],u=h+w[r+1],o>=0&&M>=o&&u>=0&&I>=u&&(c=o+u<<2,f=t[c],m=t[c+1],_=t[c+2],d>f&&(d=f),p>m&&(p=m),g>_&&(g=_));b[n]=d,b[n+1]=p,b[n+2]=g,b[n+3]=t[n+3]}for(t=b,b=new i(A),l=0,h=0,n=0;A>n;n+=4,l++){for(l>=e&&(l=0,h+=e),d=255,p=255,g=255,r=0;L>r;r+=2)o=l+w[r],u=h+w[r+1],o>=0&&M>=o&&u>=0&&I>=u&&(c=o+u<<2,f=t[c],m=t[c+1],_=t[c+2],d>f&&(d=f),p>m&&(p=m),g>_&&(g=_));b[n]=d,b[n+1]=p,b[n+2]=g,b[n+3]=t[n+3]}return b},close:function(t,e){var n,r,a,l,h,o,u,c,f,m,_,d,p,g,v=this._structureElement,w=(v.length,this._dim,new s(this._indices)),A=t.length,y=A>>2,b=new i(A),E=w.length,L=E>>1,M=e-1,I=y-e;for(a=0;E>a;a+=2)w[a+1]*=e;for(l=0,h=0,n=0;A>n;n+=4,l++){for(l>=e&&(l=0,h+=e),d=255,p=255,g=255,r=0;L>r;r+=2)o=l+w[r],u=h+w[r+1],o>=0&&M>=o&&u>=0&&I>=u&&(c=o+u<<2,f=t[c],m=t[c+1],_=t[c+2],d>f&&(d=f),p>m&&(p=m),g>_&&(g=_));b[n]=d,b[n+1]=p,b[n+2]=g,b[n+3]=t[n+3]}for(t=b,b=new i(A),l=0,h=0,n=0;A>n;n+=4,l++){for(l>=e&&(l=0,h+=e),d=255,p=255,g=255,r=0;L>r;r+=2)o=l+w[r],u=h+w[r+1],o>=0&&M>=o&&u>=0&&I>=u&&(c=o+u<<2,f=t[c],m=t[c+1],_=t[c+2],d>f&&(d=f),p>m&&(p=m),g>_&&(g=_));b[n]=d,b[n+1]=p,b[n+2]=g,b[n+3]=t[n+3]}return b}}}(FILTER),!function(t,e){"use strict";var i,n=t.ImArray,s=t.Array32I;Math.min,Math.max;var r=t.StatisticalFilter=t.Class(t.Filter,{name:"StatisticalFilter",constructor:function(){this._dim=0,this._indices=null,this._filterName=null,this._filter=null},_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var t=this;return t.disposeWorker(),t._dim=null,t._indices=null,t._filter=null,t._filterName=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_indices:t._indices}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._indices=e._indices,n._filterName=e._filterName,n._filterName&&i[n._filterName]&&(n._filter=i[n._filterName].bind(n))),n},median:function(t){return t=t===e?3:t%2?t:t+1,this.set(t,"median")},minimum:function(t){return t=t===e?3:t%2?t:t+1,this.set(t,"minimum")},maximum:function(t){return t=t===e?3:t%2?t:t+1,this.set(t,"maximum")},set:function(t,e){this._filterName=e,this._filter=i[e].bind(this),this._dim=t;var n,r,a,l=[],h=t*t,o=t,u=o>>1;for(r=0,a=0,n=0;h>n;)l.push(r-u),l.push(a-u),n++,r++,r>=o&&(r=0,a++);return this._indices=new s(l),this},reset:function(){return this._filterName=null,this._filter=null,this._dim=0,this._indices=null,this},_apply:function(t,e,i){return this._isOn&&this._dim?this._filter(t,e,i):t},apply:function(t,e){if(this._isOn&&this._dim){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._filter(i[0],i[1],i[2],t)),e&&e.call(this))}return t}});r.prototype.erode=r.prototype.minimum,r.prototype.dilate=r.prototype.maximum,i={median:function(t,e){var i,r,a,l,h,o,u,c,f,m,_,d,p,g,v,w,A,y,b=this._dim,E=b*b,L=new s(this._indices),M=t.length,I=M>>2,C=new n(M),R=E<<1,N=e-1,x=I-e;for(c=[],f=[],m=[],r=0;R>r;r+=2)L[r+1]*=e;for(i=0,a=0,l=0;M>i;){for(c.length=0,f.length=0,m.length=0,r=0;R>r;)h=a+L[r],o=l+L[r+1],h>=0&&N>=h&&o>=0&&x>=o&&(u=h+o<<2,_=t[u],d=t[u+1],p=t[u+2],c.push(_),f.push(d),m.push(p)),r+=2;c.sort(),f.sort(),m.sort(),A=c.length,y=A>>1,g=A%2?c[y+1]:~~(.5*(c[y]+c[y+1])),A=f.length,y=A>>1,v=A%2?f[y+1]:~~(.5*(f[y]+f[y+1])),A=m.length,y=A>>1,w=A%2?m[y+1]:~~(.5*(m[y]+m[y+1])),C[i]=g,C[i+1]=v,C[i+2]=w,C[i+3]=t[i+3],i+=4,a++,a>=e&&(a=0,l+=e)}return C},maximum:function(t,e){var i,r,a,l,h,o,u,c,f,m,_,d,p,g=this._dim,v=g*g,w=new s(this._indices),A=t.length,y=A>>2,b=new n(A),E=v<<1,L=e-1,M=y-e;for(r=0;E>r;r+=2)w[r+1]*=e;for(i=0,a=0,l=0;A>i;){for(_=0,d=0,p=0,r=0;E>r;)h=a+w[r],o=l+w[r+1],h>=0&&L>=h&&o>=0&&M>=o&&(u=h+o<<2,c=t[u],f=t[u+1],m=t[u+2],c>_&&(_=c),f>d&&(d=f),m>p&&(p=m)),r+=2;b[i]=_,b[i+1]=d,b[i+2]=p,b[i+3]=t[i+3],i+=4,a++,a>=e&&(a=0,l+=e)}return b},minimum:function(t,e){var i,r,a,l,h,o,u,c,f,m,_,d,p,g=this._dim,v=g*g,w=new s(this._indices),A=t.length,y=A>>2,b=new n(A),E=v<<1,L=e-1,M=y-e;for(r=0;E>r;r+=2)w[r+1]*=e;for(i=0,a=0,l=0;A>i;){for(_=255,d=255,p=255,r=0;E>r;)h=a+w[r],o=l+w[r+1],h>=0&&L>=h&&o>=0&&M>=o&&(u=h+o<<2,c=t[u],f=t[u+1],m=t[u+2],_>c&&(_=c),d>f&&(d=f),p>m&&(p=m)),r+=2;b[i]=_,b[i+1]=d,b[i+2]=p,b[i+3]=t[i+3],i+=4,a++,a>=e&&(a=0,l+=e)}return b}}}(FILTER),FILTER});
/**
*
*   FILTER.js Plugins
*   @version: 0.6.11
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e,r,n,a){var i="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),s=!i&&"undefined"!=typeof navigator,l="function"==typeof importScripts&&navigator instanceof WorkerNavigator,o=Array,u=o.prototype,h=function(){var t=null;if(i)return t=__filename,{path:__dirname,file:__filename};if(l)t=self.location.href;else if(s){var e;(e=document.getElementsByTagName("script"))&&e.length&&(t=e[e.length-1].src)}return t?{path:t.split("/").slice(0,-1).join("/"),file:t}:{path:null,file:null}},c=h(),f=function(t,e){if(i)return e;if("."==e.charAt(0)){t=t.split("/"),e=e.split("/");var r,n=0,a=0,s=e.length,l=t.length;for(r=0;s>r;r++)if(/^\.\./.test(e[r]))n++,a++;else{if(!/^\./.test(e[r]))break;a++}n=n>=l?0:l-n,e=t.slice(0,n).concat(e.slice(a)).join("/")}return e};r=r?[].concat(r):[];var p,m,d,g=r.length,_=new o(g),v=new o(g),C=new o(g),b=new o(g);for(p=0;g>p;p++)_[p]=r[p][0],v[p]=r[p][1],C[p]=/\.js$/i.test(v[p])?f(c.path,v[p]):f(c.path,v[p]+".js");if("object"==typeof module&&module.exports){if(a===module.exports[e]){for(p=0;g>p;p++)b[p]=module.exports[_[p]]||require(C[p])[_[p]];m=n.apply(t,b),module.exports[e]=m||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(v),function(r){if(a===r[e]){for(var i=u.slice.call(arguments,1),s=i.length,l=0;s>l;l++)b[l]=r[_[l]]||i[l];m=n.apply(t,b),r[e]=m||1}});else if(l){for(p=0;g>p;p++)self[_[p]]||importScripts(C[p]),b[p]=self[_[p]];m=n.apply(t,b),self[e]=m||1}else if(a===t[e]){var M=function(t,e){d=d||document.getElementsByTagName("head")[0];var r=0,n=document.createElement("script");n.type="text/javascript",n.language="javascript",n.onload=n.onreadystatechange=function(){r||n.readyState&&"loaded"!=n.readyState&&"complete"!=n.readyState||(r=1,n.onload=n.onreadystatechange=null,d.removeChild(n),n=null,e&&e())},n.src=t,d.appendChild(n)},y=function(e,r,n){t[e]?n():M(r,n)},O=function(r){return function(){g>r&&(b[r]=t[_[r]]),++r<g?y(_[r],C[r],O(r)):(m=n.apply(t,b),t[e]=m||1)}};g?y(_[0],C[0],O(0)):(m=n.apply(t,b),t[e]=m||1)}}(this,"FILTER_PLUGINS",[["FILTER","./filter"]],function(t){var e=null;return!function(t){"use strict";var e=t._notSupportClamp,r=Math.random;t.NoiseFilter=t.Create({name:"NoiseFilter",min:-127,max:127,init:function(t,e){this.min=t||-127,this.max=e||127},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{min:t.min,max:t.max}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.min=e.min,r.max=e.max),r},apply:function(t){var n,a,i,s,l,o,u,h,c=this.max-this.min,f=this.min,p=t.length;if(e)for(n=0;p>n;n+=4)i=t[n],s=t[n+1],l=t[n+2],a=c*r()+f,o=i+a,u=s+a,h=l+a,0>o?o=0:o>255&&(o=255),0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),t[n]=~~o,t[n+1]=~~u,t[n+2]=~~h;else for(n=0;p>n;n+=4)i=t[n],s=t[n+1],l=t[n+2],a=c*r()+f,o=i+a,u=s+a,h=l+a,t[n]=~~o,t[n+1]=~~u,t[n+2]=~~h;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F,n=t.Color.RGB2YCbCr,a=t.Color.YCbCr2RGB;t.HistogramEqualizeFilter=t.Create({name:"HistogramEqualizeFilter",path:t.getPath(),apply:function(t){var i,s,l,o,u,h,c,f,p,m,d,g=0,_=255,v=0,C=t.length,b=C>>2,M=1/b;for(u=new r(256),p=0;256>p;p+=4)u[p]=0,u[p+1]=0,u[p+2]=0,u[p+3]=0;for(p=0;C>p;p+=4)i=t[p],s=t[p+1],l=t[p+2],m=n({r:i,g:s,b:l}),i=t[p]=~~m.cr,s=t[p+1]=~~m.y,l=t[p+2]=~~m.cb,u[s]+=M,s>g?g=s:_>s&&(_=s);for(v=0,p=0;256>p;p+=4)v+=u[p],u[p]=v,v+=u[p+1],u[p+1]=v,v+=u[p+2],u[p+2]=v,v+=u[p+3],u[p+3]=v;if(o=g-_,e)for(p=0;C>p;p+=4)m={cr:t[p],y:t[p+1],cb:t[p+2]},m.y=u[m.y]*o+_,d=a(m),h=d.r,c=d.g,f=d.b,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,t[p]=~~h,t[p+1]=~~c,t[p+2]=~~f;else for(p=0;C>p;p+=4)m={cr:t[p],y:t[p+1],cb:t[p+2]},m.y=u[m.y]*o+_,d=a(m),t[p]=~~d.r,t[p+1]=~~d.g,t[p+2]=~~d.b;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F;t.GrayscaleHistogramEqualizeFilter=t.Create({name:"GrayscaleHistogramEqualizeFilter",path:t.getPath(),apply:function(t){var n,a,i,s,l,o=0,u=255,h=0,c=t.length,f=c>>2,p=1/f;for(s=new r(256),l=0;256>l;l+=4)s[l]=0,s[l+1]=0,s[l+2]=0,s[l+3]=0;for(l=0;c>l;l+=4)n=t[l],s[n]+=p,n>o?o=n:u>n&&(u=n);for(h=0,l=0;256>l;l+=4)h+=s[l],s[l]=h,h+=s[l+1],s[l+1]=h,h+=s[l+2],s[l+2]=h,h+=s[l+3],s[l+3]=h;if(i=o-u,e)for(l=0;c>l;l+=4)n=t[l],a=s[n]*i+u,a=0>a?0:a>255?255:a,a=~~a,t[l]=a,t[l+1]=a,t[l+2]=a;else for(l=0;c>l;l+=4)n=t[l],a=~~(s[n]*i+u),t[l]=a,t[l+1]=a,t[l+2]=a;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F;t.RGBHistogramEqualizeFilter=t.Create({name:"RGBHistogramEqualizeFilter",path:t.getPath(),apply:function(t){var n,a,i,s,l,o,u,h,c,f,p,m,d,g,_,v,C=0,b=0,M=0,y=255,O=255,F=255,z=t.length,I=z>>2,Y=1/I;for(u=new r(256),h=new r(256),c=new r(256),v=0;256>v;v+=4)u[v]=0,h[v]=0,c[v]=0,u[v+1]=0,h[v+1]=0,c[v+1]=0,u[v+2]=0,h[v+2]=0,c[v+2]=0,u[v+3]=0,h[v+3]=0,c[v+3]=0;for(v=0;z>v;v+=4)n=t[v],a=t[v+1],i=t[v+2],u[n]+=Y,h[a]+=Y,c[i]+=Y,n>C?C=n:y>n&&(y=n),a>b?b=a:O>a&&(O=a),i>M?M=i:F>i&&(F=i);for(f=p=m=0,v=0;256>v;v+=4)f+=u[v],u[v]=f,p+=h[v],h[v]=p,m+=c[v],c[v]=m,f+=u[v+1],u[v+1]=f,p+=h[v+1],h[v+1]=p,m+=c[v+1],c[v+1]=m,f+=u[v+2],u[v+2]=f,p+=h[v+2],h[v+2]=p,m+=c[v+2],c[v+2]=m,f+=u[v+3],u[v+3]=f,p+=h[v+3],h[v+3]=p,m+=c[v+3],c[v+3]=m;if(s=C-y,l=b-O,o=M-F,e)for(v=0;z>v;v+=4)n=t[v],a=t[v+1],i=t[v+2],d=u[n]*s+y,g=h[a]*l+O,_=c[i]*o+F,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,_=0>_?0:_>255?255:_,t[v]=~~d,t[v+1]=~~g,t[v+2]=~~_;else for(v=0;z>v;v+=4)n=t[v],a=t[v+1],i=t[v+2],d=u[n]*s+y,g=h[a]*l+O,_=c[i]*o+F,t[v]=~~d,t[v+1]=~~g,t[v+2]=~~_;return t}})}(t),!function(t){"use strict";var e=Math.sqrt,r=t._notSupportClamp,n=t.Array32F;t.PixelateFilter=t.Create({name:"PixelateFilter",scale:1,init:function(t){this.scale=t||1},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{scale:t.scale}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.scale=e.scale),r},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var s,l,o,u,h,c,f,p,m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L,T,j,V,D,U,Q,W,$,J,K=t.length,Z=K>>2,te=(a<<1)+a;for(s=~~(.01*e(Z)*this.scale),l=a*s,o=i%s,u=a%s,h=(o-1)*a,m=1/(s*s),d=1/(u*s),g=1/(o*s),_=1/(u*o),v=m,C=d,b=g,M=_,I=s-1,Y=(s-1)*a,G=0,T=a-1,L=0,j=Z-a,y=new n(3*Z),k=0,X=0,S=0,O=F=z=0,S=0;a>S;S++,k+=4,X+=3)O+=t[k],F+=t[k+1],z+=t[k+2],y[X]=O,y[X+1]=F,y[X+2]=z;for(X=0,S=0,O=F=z=0,k=te+a;K>k;k+=4,X+=3,S++)S>=a&&(S=0,O=F=z=0),O+=t[k],F+=t[k+1],z+=t[k+2],y[X+te]=y[X]+O,y[X+te+1]=y[X+1]+F,y[X+te+2]=y[X+2]+z;for(S=0,x=0,w=0,H=S,B=w,N=H+I,R=B+Y,N=N>T?T:N,R=R>j?j:R,V=H+B,Q=N+R,D=N+B,U=H+R,V=(V<<1)+V,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,p=v,W=p*(y[Q]-y[D]-y[U]+y[V]),$=p*(y[Q+1]-y[D+1]-y[U+1]+y[V+1]),J=p*(y[Q+2]-y[D+2]-y[U+2]+y[V+2]),r&&(W=0>W?0:W>255?255:W,$=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J),W=~~W,$=~~$,J=~~J,E=0,A=0,P=0,k=0;K>k;k+=4)q=E+S+P+w<<2,t[q]=W,t[q+1]=$,t[q+2]=J,E++,(E+S>=a||E>=s)&&(E=0,A++,P+=a),(A+x>=i||A>=s)&&(S+=s,S>=a&&(S=0,x+=s,w+=l),E=0,A=0,P=0,H=S,B=w,N=H+I,R=B+Y,N=N>T?T:N,R=R>j?j:R,V=H+B,Q=N+R,D=N+B,U=H+R,V=(V<<1)+V,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,c=0==N-H-u+1,f=0==R-B-h,p=c&&f?M:c?C:f?b:v,W=p*(y[Q]-y[D]-y[U]+y[V]),$=p*(y[Q+1]-y[D+1]-y[U+1]+y[V+1]),J=p*(y[Q+2]-y[D+2]-y[U+2]+y[V+2]),r&&(W=0>W?0:W>255?255:W,$=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J),W=~~W,$=~~$,J=~~J);return t}})}(t),!function(t){"use strict";var e=Math.sqrt,r=(Math.SQRT2,Math.min,t._notSupportClamp),n=t.Array32F;t.TriangularPixelateFilter=t.Create({name:"TriangularPixelateFilter",scale:1,init:function(t){this.scale=t||1},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{scale:t.scale}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.scale=e.scale),r},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var s,l,o,u,h,c,f,p,m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L,T,j,V,D,U,Q,W,$,J,K,Z,te,ee,re,ne,ae,ie,se=t.length,le=se>>2,oe=(a<<1)+a;for(s=~~(.01*e(le)*this.scale),l=s>>1,o=s-1,u=a*s,h=i%s,c=a%s,f=(h-1)*a,g=1/(s*s),_=1/(c*s),v=1/(h*s),C=1/(c*h),b=2*g,M=2*_,y=2*v,O=2*C,k=o,X=o*a,T=0,V=a-1,j=0,D=le-a,F=new n(3*le),S=0,x=0,w=0,z=I=Y=0,w=0;a>w;w++,S+=4,x+=3)z+=t[S],I+=t[S+1],Y+=t[S+2],F[x]=z,F[x+1]=I,F[x+2]=Y;for(x=0,w=0,z=I=Y=0,S=oe+a;se>S;S+=4,x+=3,w++)w>=a&&(w=0,z=I=Y=0),z+=t[S],I+=t[S+1],Y+=t[S+2],F[x+oe]=F[x]+z,F[x+oe+1]=F[x+1]+I,F[x+oe+2]=F[x+2]+Y;for(w=0,E=0,A=0,N=w,R=A,G=w-l+k,L=A+X,G=G>V?V:G,L=L>D?D:L,U=N+R,$=G+L,Q=G+R,W=N+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,d=b,te=d*(F[$]-F[Q]-F[W]+F[U]),ee=d*(F[$+1]-F[Q+1]-F[W+1]+F[U+1]),re=d*(F[$+2]-F[Q+2]-F[W+2]+F[U+2]),N=w+l,G=w+k,G=G>V?V:G,U=N+R,$=G+L,Q=G+R,W=N+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,ne=d*(F[$]-F[Q]-F[W]+F[U]),ae=d*(F[$+1]-F[Q+1]-F[W+1]+F[U+1]),ie=d*(F[$+2]-F[Q+2]-F[W+2]+F[U+2]),r&&(te=0>te?0:te>255?255:te,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie),te=~~te,ee=~~ee,re=~~re,ne=~~ne,ae=~~ae,ie=~~ie,J=te,K=ee,Z=re,P=0,q=0,H=0,S=0;se>S;S+=4)B=P+w+H+A<<2,t[B]=J,t[B+1]=K,t[B+2]=Z,P++,(P+w>=a||P>=s)&&(P=0,q++,H+=a,J=te,K=ee,Z=re),P>o-q&&(J=ne,K=ae,Z=ie),(q+E>=i||q>=s)&&(w+=s,w>=a&&(w=0,E+=s,A+=u),P=0,q=0,H=0,N=w,R=A,G=w-l+k,L=A+X,G=G>V?V:G,L=L>D?D:L,U=N+R,$=G+L,Q=G+R,W=N+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,p=0==G-N+l-c+1,m=0==L-R-f,d=p&&m?O:p?M:m?y:b,te=d*(F[$]-F[Q]-F[W]+F[U]),ee=d*(F[$+1]-F[Q+1]-F[W+1]+F[U+1]),re=d*(F[$+2]-F[Q+2]-F[W+2]+F[U+2]),N=w+l,G=w+k,G=G>V?V:G,U=N+R,$=G+L,Q=G+R,W=N+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,p=0==G-N+l-c+1,d=p&&m?O:p?M:m?y:b,ne=d*(F[$]-F[Q]-F[W]+F[U]),ae=d*(F[$+1]-F[Q+1]-F[W+1]+F[U+1]),ie=d*(F[$+2]-F[Q+2]-F[W+2]+F[U+2]),r&&(te=0>te?0:te>255?255:te,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie),te=~~te,ee=~~ee,re=~~re,ne=~~ne,ae=~~ae,ie=~~ie,J=te,K=ee,Z=re);return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Color.RGB2HSV,n=.7083333333333334;t.HSVConverterFilter=t.Create({name:"HSVConverterFilter",path:t.getPath(),apply:function(t){var a,i,s,l,o,u,h,c,f=t.length;if(e)for(l=0;f>l;l+=4)a=t[l],i=t[l+1],s=t[l+2],o=r({r:a,g:i,b:s}),u=o.h*n,c=255*o.s,h=o.v,0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),0>c?c=0:c>255&&(c=255),t[l]=~~u,t[l+1]=~~h,t[l+2]=~~c;else for(l=0;f>l;l+=4)a=t[l],i=t[l+1],s=t[l+2],o=r({r:a,g:i,b:s}),u=o.h*n,c=255*o.s,h=o.v,t[l]=~~u,t[l+1]=~~h,t[l+2]=~~c;return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,t.ImArray,t.Color.clampPixel),r=t.Color.RGB2HSV,n=(t.Color.HSV2RGB,t.Color.Color2RGBA);t.HueExtractorFilter=t.Create({name:"HueExtractorFilter",range:null,background:0,init:function(t,e){this.range=t,this.background=e||0},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{range:t.range,background:t.background}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.range=e.range,r.background=e.background),r},apply:function(t){if(!this.range||!this.range.length)return t;var a,i,s,l,o,u,h,c,f,p,m=t.length,d=this.range[0],g=this.range[this.range.length-1];for(f=n(this.background||0),l=~~e(f.r),o=~~e(f.g),u=~~e(f.b),h=~~e(f.a),c=0;m>c;c+=4)a=t[c],i=t[c+1],s=t[c+2],p=r({r:a,g:i,b:s}).h,(d>p||p>g)&&(t[c]=l,t[c+1]=o,t[c+2]=u,t[c+3]=h);return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,Math.min),r=Math.floor,n=t.CHANNEL.RED;t.CHANNEL.GREEN,t.CHANNEL.BLUE,t.CHANNEL.ALPHA,t.ChannelCopyFilter=t.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,init:function(t,e,r,a,i){this._srcImg=null,this.srcImg=null,this.srcChannel=e||n,this.dstChannel=r||n,this.centerX=a||0,this.centerY=i||0,t&&this.setSrc(t)},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_srcImg:t._srcImg,centerX:t.centerX,centerY:t.centerY,srcChannel:t.srcChannel,dstChannel:t.dstChannel}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r._srcImg=e._srcImg,r.centerX=e.centerX,r.centerY=e.centerY,r.srcChannel=e.srcChannel,r.dstChannel=e.dstChannel),r},setSrc:function(t){return t&&(this.srcImg=t,this._srcImg={data:t.getData(),width:t.width,height:t.height}),this},apply:function(t,n,a){if(!this._srcImg)return t;var i,s,l,o,u,h,c=this._srcImg.data,f=t.length,p=(c.length,this._srcImg.width),m=this._srcImg.height,d=this.srcChannel,g=this.dstChannel,_=e(n,p),v=e(a,m),C=this.centerX||0,b=this.centerY||0,M=p>>1,y=m>>1;for(C=r(C*(n-1))-M,b=r(b*(a-1))-y,i=0,s=0,l=0,i=0;f>i;i+=4,s++)s>=n&&(s=0,l++),u=s-C,h=l-b,u>=0&&_>u&&h>=0&&v>h&&(o=u+h*p<<2,t[i+g]=c[o+d]);return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,Math.min),r=Math.floor;t.AlphaMaskFilter=t.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,init:function(t,e,r){this.centerX=e||0,this.centerY=r||0,this._alphaMask=null,this.alphaMask=null,t&&this.setMask(t)},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_alphaMask:t._alphaMask,centerX:t.centerX,centerY:t.centerY}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r._alphaMask=e._alphaMask,r.centerX=e.centerX,r.centerY=e.centerY),r},setMask:function(t){return t&&(this.alphaMask=t,this._alphaMask={data:t.getData(),width:t.width,height:t.height}),this},apply:function(t,n,a){if(!this._alphaMask)return t;var i,s,l,o,u,h,c=this._alphaMask.data,f=this._alphaMask.width,p=this._alphaMask.height,m=t.length,d=(c.length,e(n,f)),g=e(a,p),_=this.centerX||0,v=this.centerY||0,C=f>>1,b=p>>1;for(_=r(_*(n-1))-C,v=r(v*(a-1))-b,s=0,l=0,i=0;m>i;i+=4,s++)s>=n&&(s=0,l++),u=s-_,h=l-v,u>=0&&d>u&&h>=0&&g>h?(o=u+h*f<<2,t[i+3]=c[o+3]):t[i+3]=0;return t}})}(t),!function(t,e){"use strict";var r,n=Math.min,a=Math.max,i=Math.round,s=(Math.floor,Math.abs),l=t._notSupportClamp;t.BlendFilter=t.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendMode:null,blendImage:null,startX:0,startY:0,amount:1,init:function(t,e,r){this.startX=0,this.startY=0,this.amount=1,this._blendImage=null,this.blendImage=null,this._blendMode=null,this.blendMode=null,t&&this.setImage(t),e&&this.setMode(e,r)},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_blendImage:t._blendImage,_blendMode:t._blendMode,startX:t.startX,startY:t.startY,amount:t.amount}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r._blendImage=e._blendImage,r.startX=e.startX,r.startY=e.startY,r.setMode(e._blendMode,e.amount)),r},setImage:function(t){return t&&(this.blendImage=t,this._blendImage={data:t.getData(),width:t.width,height:t.height}),this},setMode:function(t,i){return t?(this._blendMode=(""+t).toLowerCase(),this.blendMode=r[this._blendMode]||null,this.amount=a(0,n(1,e===i?1:i))):(this._blendMode=null,this.blendMode=null),this},reset:function(){return this.startX=0,this.startY=0,this.amount=1,this._blendMode=null,this.blendMode=null,this},apply:function(t,e,r){if(!this.blendMode||!this._blendImage)return t;var a,s,l,o,u,h=this.startX||0,c=this.startY||0,f=0,p=0,m=this._blendImage,d=this.amount||1;return o=m.width,u=m.height,0>h&&(f=-h,h=0),0>c&&(p=-c,c=0),h>=e||c>=r?t:f>=o||p>=u?t:(h=i(h),c=i(c),f=i(f),p=i(p),a=n(e-h,o-f),s=n(r-c,u-p),0>=a||0>=s?t:(l=m.data,this.blendMode(t,e,r,l,o,u,h,c,f,p,a,s,d)))}}),r={normal:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=Y,x=k,w=X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},lighten:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=F>Y?F:Y,x=z>k?z:k,w=I>X?I:X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},darken:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=F>Y?Y:F,x=z>k?k:z,w=I>X?X:I,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},multiply:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=.003921568627451*F*Y,x=.003921568627451*z*k,w=.003921568627451*I*X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},average:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=.5*(F+Y),x=.5*(z+k),w=.5*(I+X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},add:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=F+Y,x=z+k,w=I+X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},subtract:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=255>F+Y?0:F+Y-255,x=255>z+k?0:z+k-255,w=255>I+X?0:I+X-255,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},difference:function(t,e,r,n,a,i,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*a,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=s(k-z),w=s(X-I),E=s(S-Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=a);return t},negation:function(t,e,r,n,a,i,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*a,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=255-s(255-k-z),w=255-s(255-X-I),E=255-s(255-S-Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=a);return t},screen:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=255-((255-Y)*(255-F)>>8),x=255-((255-k)*(255-z)>>8),w=255-((255-X)*(255-I)>>8),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},exclusion:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=Y+F-.003921568627451*2*Y*F,x=k+z-.003921568627451*2*k*z,w=X+I-.003921568627451*2*X*I,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},overlay:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>F?.003921568627451*2*Y*F:255-.003921568627451*2*(255-Y)*(255-F),x=128>z?.003921568627451*2*k*z:255-.003921568627451*2*(255-k)*(255-z),S=128>I?.003921568627451*2*X*I:255-.003921568627451*2*(255-X)*(255-I),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},softlight:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>F?2*((Y>>1)+64)*.003921568627451*F:255-.003921568627451*2*(255-((Y>>1)+64))*(255-F),x=128>z?2*((k>>1)+64)*.003921568627451*z:255-.003921568627451*2*(255-((k>>1)+64))*(255-z),w=128>I?2*((X>>1)+64)*.003921568627451*I:255-.003921568627451*2*(255-((X>>1)+64))*(255-I),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},hardlight:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>Y?.003921568627451*2*F*Y:255-.003921568627451*2*(255-F)*(255-Y),x=128>k?.003921568627451*2*z*k:255-.003921568627451*2*(255-z)*(255-k),w=128>X?.003921568627451*2*I*X:255-.003921568627451*2*(255-I)*(255-X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},colordodge:function(t,e,r,a,i,s,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*i,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==z?z:n(255,(k<<8)/(255-z)),w=255==I?I:n(255,(X<<8)/(255-I)),E=255==Y?z:n(255,(S<<8)/(255-Y)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=i);return t},colorburn:function(t,e,r,n,i,s,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*i,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=0==z?z:a(0,255-(255-k<<8)/z),w=0==I?I:a(0,255-(255-X<<8)/I),E=0==Y?Y:a(0,255-(255-S<<8)/Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=i);return t},linearlight:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;for(var A;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],128>F?(A=2*F,S=255>A+Y?0:A+Y-255):(A=2*(F-128),S=A+Y),128>z?(A=2*z,x=255>A+k?0:A+k-255):(A=2*(z-128),x=A+k),128>I?(A=2*I,w=255>A+X?0:A+X-255):(A=2*(I-128),w=A+X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},reflect:function(t,e,r,a,i,s,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*i,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==z?z:n(255,k*k/(255-z)),w=255==I?I:n(255,X*X/(255-I)),E=255==Y?Y:n(255,S*S/(255-Y)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=i);return t},glow:function(t,e,r,a,i,s,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*i,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==k?k:n(255,z*z/(255-k)),w=255==X?X:n(255,I*I/(255-X)),E=255==S?S:n(255,Y*Y/(255-S)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=i);return t},phoenix:function(t,e,r,i,s,o,u,h,c,f,p,m,d){var g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;for(P=1-d,y=u,O=h*e,F=c,z=f*s,g=u+p,_=c+p,v=0,C=m*p;C>v;)b=y+O<<2,M=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=i[M],S=i[M+1],x=i[M+2],w=n(X,I)-a(X,I)+255,E=n(S,Y)-a(S,Y)+255,A=n(x,k)-a(x,k)+255,I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,l&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,y++,y>=g&&(y=u,O+=e),F++,F>=_&&(F=c,z+=s);return t},vividlight:function(t,e,r,i,s,o,u,h,c,f,p,m,d){var g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;P=1-d,y=u,O=h*e,F=c,z=f*s,g=u+p,_=c+p,v=0,C=m*p;for(var q;C>v;)b=y+O<<2,M=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=i[M],S=i[M+1],x=i[M+2],128>I?(q=2*I,w=0==q?q:a(0,255-(255-X<<8)/q)):(q=2*(I-128),w=255==q?q:n(255,(X<<8)/(255-q))),128>Y?(q=2*Y,E=0==q?q:a(0,255-(255-S<<8)/q)):(q=2*(Y-128),E=255==q?q:n(255,(S<<8)/(255-q))),128>k?(q=2*k,A=0==q?q:a(0,255-(255-x<<8)/q)):(q=2*(Y-128),A=255==q?q:n(255,(x<<8)/(255-q))),I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,l&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,y++,y>=g&&(y=u,O+=e),F++,F>=_&&(F=c,z+=s);return t},pinlight:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;for(var A;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],128>F?(A=2*F,S=A>Y?A:Y):(A=2*(F-128),S=A>Y?Y:A),128>z?(A=2*z,x=A>k?A:k):(A=2*(F-128),x=A>k?k:A),128>I?(A=2*I,w=A>X?A:X):(A=2*(I-128),w=A>X?X:A),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},hardmix:function(t,e,r,i,s,o,u,h,c,f,p,m,d){var g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;P=1-d,y=u,O=h*e,F=c,z=f*s,g=u+p,_=c+p,v=0,C=m*p;for(var q;C>v;)b=y+O<<2,M=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=i[M],S=i[M+1],x=i[M+2],128>I?(q=2*I,w=0==q?q:a(0,255-(255-X<<8)/q)):(q=2*(I-128),w=255==q?q:n(255,(X<<8)/(255-q))),w=128>w?0:255,128>Y?(q=2*Y,E=0==q?q:a(0,255-(255-S<<8)/q)):(q=2*(Y-128),E=255==q?q:n(255,(S<<8)/(255-q))),E=128>E?0:255,128>k?(q=2*k,A=0==q?q:a(0,255-(255-x<<8)/q)):(q=2*(k-128),A=255==q?q:n(255,(x<<8)/(255-q))),A=128>A?0:255,I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,l&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,y++,y>=g&&(y=u,O+=e),F++,F>=_&&(F=c,z+=s);return t}},r.lineardodge=r.add,r.linearburn=r.subtract}(t),!function(t){"use strict";var e=(t._notSupportClamp,t.Color.RGBA2Color),r=t.Color.Color2RGBA;t.ThresholdFilter=t.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(t,e){this.thresholds=t,this.quantizedColors=e||null},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{thresholds:t.thresholds,quantizedColors:t.quantizedColors}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.thresholds=e.thresholds,r.quantizedColors=e.quantizedColors),r},apply:function(t){if(!this.thresholds||!this.thresholds.length)return t;if(!this.quantizedColors||!this.quantizedColors.length)return t;var n,a,i,s,l,o,u,h,c=t.length,f=this.thresholds,p=f.length,m=this.quantizedColors,d=m.length;for(u=0;c>u;u+=4){for(l=e({r:t[u],g:t[u+1],b:t[u+2],a:t[u+3]}),h=0;p>h&&l>f[h];)h++;l=d>h?m[h]:255,o=r(l),n=o.r,a=o.g,i=o.b,s=o.a,t[u]=n,t[u+1]=a,t[u+2]=i,t[u+3]=s}return t}})}(t),!function(t){"use strict";var e=(Math.sqrt,Math.exp,Math.log),r=Math.abs,n=Math.floor,a=t._notSupportClamp,i=t.Array32F;t.BokehFilter=t.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(t,e,r,n){this.centerX=t||0,this.centerY=e||0,this.radius=r||10,this.amount=n||10},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{centerX:t.centerX,centerY:t.centerY,radius:t.radius,amount:t.amount}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.centerX=e.centerX,r.centerY=e.centerY,r.radius=e.radius,r.amount=e.amount),r},apply:function(t,s,l){var o,u,h,c,f,p,m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G=t.length,L=this.centerX||0,T=this.centerY||0,j=this.radius,V=this.amount;if(0>=V)return t;for(o=G>>2,H=0,B=s-1,N=0,R=o-s,L=n(L*(s-1)),T=n(T*(l-1)),h=(o<<1)+o,m=(s<<1)+s,u=new i(h),d=0,g=0,_=0,c=f=p=0,_=0;s>_;_++,d+=4,g+=3)c+=t[d],f+=t[d+1],p+=t[d+2],u[g]=c,u[g+1]=f,u[g+2]=p;for(d=m+s,g=0,_=0,c=f=p=0,d=m+s;G>d;d+=4,g+=3,_++)_>=s&&(_=0,c=f=p=0),c+=t[d],f+=t[d+1],p+=t[d+2],u[g+m]=u[g]+c,u[g+m+1]=u[g+1]+f,u[g+m+2]=u[g+2]+p;for(_=0,v=0,C=0,d=0;G>d;d+=4,_++)_>=s&&(_=0,v++,C+=s),M=_-L,y=v-T,b=r(M)+r(y),O=b>j?~~e((b-j)*V):~~(b/j+.5),O>0&&(F=O*s,z=.25/(O*O),I=_-O,Y=C-F,k=_+O,X=C+F,H>I?I=H:k>B&&(k=B),N>Y?Y=N:X>R&&(X=R),S=I+Y,E=k+X,x=k+Y,w=I+X,S=(S<<1)+S,x=(x<<1)+x,w=(w<<1)+w,E=(E<<1)+E,A=z*(u[E]-u[x]-u[w]+u[S]),P=z*(u[E+1]-u[x+1]-u[w+1]+u[S+1]),q=z*(u[E+2]-u[x+2]-u[w+2]+u[S+2]),a&&(A=0>A?0:A>255?255:A,P=0>P?0:P>255?255:P,q=0>q?0:q>255?255:q),t[d]=~~A,t[d+1]=~~P,t[d+2]=~~q);return t}})}(t),e});
