/**
*
*   FILTER.js Generic Filters
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Generic Filters)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e){"use strict";"object"==typeof module&&module.exports?module.exports=e.call(t,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_FILTERS")?define("FILTER_FILTERS",["module","FILTER"],function(n,r){return e.moduleUri=n.uri,e.call(t,r),r}):(e.call(t,t.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return t.FILTER})}(this,function t(e){"use strict";var n=e.getPath(t.moduleUri);return!function(t,e){var r=(Object.prototype,Function.prototype,Array.prototype),i=r.slice,a=r.splice,s=r.concat,l=t.CompositeFilter=t.Class(t.Filter,{name:"CompositeFilter",constructor:function(t){var e=this;e.$super("constructor"),e._stack=t&&t.length?t.slice():[]},path:n,_stack:null,_meta:null,_stable:!0,dispose:function(t){var e,n=this,r=n._stack;if(n.$super("dispose"),!0===t)for(e=0;e<r.length;e++)r[e]&&r[e].dispose(t),r[e]=null;return n._stack=null,n._meta=null,n},serialize:function(){var t,e=this,n={filter:e.name,_isOn:!!e._isOn,_stable:!!e._stable,filters:[]},r=e._stack;for(t=0;t<r.length;t++)n.filters.push(r[t].serialize());return n},unserialize:function(e){var n,r,i,a,s,l=this,u=l._stack;if(e&&l.name===e.filter){if(l._isOn=!!e._isOn,l._stable=!!e._stable,a=e.filters||[],r=a.length,i=u.length,r===i&&l._stable)for(n=0;r>n;n++)u[n]=u[n].unserialize(a[n]);else{for(n=0;i>n;n++)u[n]&&u[n].dispose(!0),u[n]=null;for(u=[],n=0;r>n;n++){if(s=a[n]&&a[n].filter?t[a[n].filter]:null,!s)throw new Error('Filter "'+a[n].filter+'" could not be created');u.push((new s).unserialize(a[n]))}}l._stack=u}return l},getMeta:function(){return this._meta},setMeta:function(t){var e,n,r=this,i=r._stack;if(t&&(n=t.length)&&i.length)for(e=0;n>e;e++)i[t[e][0]].setMeta(t[e][1]);return r},stable:function(t){return arguments.length||(t=!0),this._stable=!!t,this},filters:function(t){return arguments.length?(this._stack=t.slice(),this):this._stack.slice()},push:function(){var t=i.call(arguments),e=t.length;return e&&(this._stack=s.apply(this._stack,t)),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){var t=i.call(arguments),e=t.length;return e&&a.apply(this._stack,[0,0].concat(t)),this},getAt:function(t){return this._stack.length>t?this._stack[t]:null},setAt:function(t,e){return this._stack.length>t?this._stack[t]=e:this._stack.push(e),this},insertAt:function(t){var e=i.call(arguments);e.length;return argslen>1&&(e.shift(),a.apply(this._stack,[t,0].concat(e))),this},removeAt:function(t){return this._stack.splice(t,1)},remove:function(t){for(var e=this._stack.length;--e>=0;)t===this._stack[e]&&this._stack.splice(e,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(t,e,n,r){var i=this,a=!1;if(i.hasMeta=!1,i._meta=[],i._isOn&&i._stack.length){var s,l,u=i._stack,o=u.length;for(s=0;o>s;s++)l=u[s],l&&l._isOn&&(t=l._apply(t,e,n,r),a=a||l._update,l.hasMeta&&i._meta.push([s,l.getMeta()]))}return i._update=a,i.hasMeta=i._meta.length>0,t},canRun:function(){return this._isOn&&this._stack.length},toString:function(){var t,e=arguments.length&&arguments[0].substr?arguments[0]:"  ",n=e+e,r=this._stack,i=[],a=r.length;for(t=0;a>t;t++)i.push(r[t].toString(n));return["[FILTER: "+this.name+"]","[","  "+i.join("\n  "),"]",""].join("\n")}});l.prototype.empty=l.prototype.reset,l.prototype.concat=l.prototype.push}(e),!function(t,e){var r="hasOwnProperty";t.InlineFilter=t.CustomFilter=t.Class(t.Filter,{name:"InlineFilter",constructor:function(t){var e=this;e.$super("constructor"),e._handler=t&&"function"==typeof t?t:null,e._params={}},path:n,_handler:null,_params:null,dispose:function(){var t=this;return t.$super("dispose"),t._handler=null,t._params=null,t},params:function(t){var e=this;if(arguments.length){for(var n in t)t[r](n)&&(e._params[n]=t[n]);return e}return e._params},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_handler:t._handler?t._handler.toString():null,_params:t._params}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r._handler=null,n._handler&&(r._handler=new Function("FILTER",'"use strict"; return '+n._handler+";")(t)),r._params=n._params||{}),r},_apply:function(t,e,n,r){var i=this;return i._isOn&&i._handler?i._handler(i,t,e,n,r):t},canRun:function(){return this._isOn&&this._handler}})}(e),!function(t,e){function r(){return new u([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}function i(t,e){var n,r,i,a,s,l=new u(20);return n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],l[0]=n*t[0]+r*t[5]+i*t[10]+a*t[15],l[1]=n*t[1]+r*t[6]+i*t[11]+a*t[16],l[2]=n*t[2]+r*t[7]+i*t[12]+a*t[17],l[3]=n*t[3]+r*t[8]+i*t[13]+a*t[18],l[4]=n*t[4]+r*t[9]+i*t[14]+a*t[19]+s,n=e[5],r=e[6],i=e[7],a=e[8],s=e[9],l[5]=n*t[0]+r*t[5]+i*t[10]+a*t[15],l[6]=n*t[1]+r*t[6]+i*t[11]+a*t[16],l[7]=n*t[2]+r*t[7]+i*t[12]+a*t[17],l[8]=n*t[3]+r*t[8]+i*t[13]+a*t[18],l[9]=n*t[4]+r*t[9]+i*t[14]+a*t[19]+s,n=e[10],r=e[11],i=e[12],a=e[13],s=e[14],l[10]=n*t[0]+r*t[5]+i*t[10]+a*t[15],l[11]=n*t[1]+r*t[6]+i*t[11]+a*t[16],l[12]=n*t[2]+r*t[7]+i*t[12]+a*t[17],l[13]=n*t[3]+r*t[8]+i*t[13]+a*t[18],l[14]=n*t[4]+r*t[9]+i*t[14]+a*t[19]+s,n=e[15],r=e[16],i=e[17],a=e[18],s=e[19],l[15]=n*t[0]+r*t[5]+i*t[10]+a*t[15],l[16]=n*t[1]+r*t[6]+i*t[11]+a*t[16],l[17]=n*t[2]+r*t[7]+i*t[12]+a*t[17],l[18]=n*t[3]+r*t[8]+i*t[13]+a*t[18],l[19]=n*t[4]+r*t[9]+i*t[14]+a*t[19]+s,l}function a(t,e,n){var r=new u(20);return r[0]=t[0]+n*(e[0]-t[0]),r[1]=t[1]+n*(e[1]-t[1]),r[2]=t[2]+n*(e[2]-t[2]),r[3]=t[3]+n*(e[3]-t[3]),r[4]=t[4]+n*(e[4]-t[4]),r[5]=t[5]+n*(e[5]-t[5]),r[6]=t[6]+n*(e[6]-t[6]),r[7]=t[7]+n*(e[7]-t[7]),r[8]=t[8]+n*(e[8]-t[0]),r[9]=t[9]+n*(e[9]-t[9]),r[10]=t[10]+n*(e[10]-t[10]),r[11]=t[11]+n*(e[11]-t[11]),r[12]=t[12]+n*(e[12]-t[12]),r[13]=t[13]+n*(e[13]-t[13]),r[14]=t[14]+n*(e[14]-t[14]),r[15]=t[15]+n*(e[15]-t[15]),r[16]=t[16]+n*(e[16]-t[16]),r[17]=t[17]+n*(e[17]-t[17]),r[18]=t[18]+n*(e[18]-t[18]),r[19]=t[19]+n*(e[19]-t[19]),r}var s=Math.sin,l=Math.cos,u=t.Array32F,o=t.Util.Array.typed,c=t.CONST.toRad,h=(t.CONST.toDeg,t._notSupportClamp),_=t.ColorMatrixFilter=t.Class(t.Filter,{name:"ColorMatrixFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&t.length?e._matrix=new u(t):e._matrix=null},path:n,_matrix:null,_webglInstance:null,dispose:function(){var t=this;return t.$super("dispose"),t._webglInstance=null,t._matrix=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_matrix:t._matrix}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._matrix=o(e._matrix,u)),n},channel:function(n,r){r=r===e?!1:r;var i=r?1:0;switch(n){case t.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case t.CHANNEL.BLUE:return this.set([0,0,i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,0,0,255]);case t.CHANNEL.GREEN:return this.set([0,i,0,0,0,0,1,0,0,0,0,i,0,0,0,0,0,0,0,255]);case t.CHANNEL.RED:default:return this.set([1,0,0,0,0,i,0,0,0,0,i,0,0,0,0,0,0,0,0,255])}},redChannel:function(e){return this.channel(t.CHANNEL.RED,e)},greenChannel:function(e){return this.channel(t.CHANNEL.GREEN,e)},blueChannel:function(e){return this.channel(t.CHANNEL.BLUE,e)},alphaChannel:function(e){return this.channel(t.CHANNEL.ALPHA,!0)},maskChannel:function(e){switch(e){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(e,n){switch(e){case t.CHANNEL.ALPHA:switch(n){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case t.CHANNEL.BLUE:switch(n){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.BLUE:return this;case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case t.CHANNEL.GREEN:switch(n){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this;case t.CHANNEL.RED:default:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case t.CHANNEL.RED:default:switch(n){case t.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case t.CHANNEL.BLUE:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this}}},desaturate:function(){var e=t.LUMA;return this.set([e[0],e[1],e[2],0,0,e[0],e[1],e[2],0,0,e[0],e[1],e[2],0,0,0,0,0,1,0])},colorize:function(n,r){var i,a,s,l,u=t.LUMA;return r===e&&(r=1),i=.00392156862745098*(n>>16&255),a=.00392156862745098*(n>>8&255),s=.00392156862745098*(255&n),l=1-r,this.set([l+r*i*u[0],r*i*u[1],r*i*u[2],0,0,r*a*u[0],l+r*a*u[1],r*a*u[2],0,0,r*s*u[0],r*s*u[1],l+r*s*u[2],0,0,0,0,0,1,0])},invert:function(){return this.set([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(e){var n,r,i,a,s=t.LUMA;return n=1-e,r=n*s[0],i=n*s[1],a=n*s[2],this.set([r+e,i,a,0,0,r,i+e,a,0,0,r,i,a+e,0,0,0,0,0,1,0])},contrast:function(t,n,r){return n===e&&(n=t),r===e&&(r=t),t+=1,n+=1,r+=1,this.set([t,0,0,0,128*(1-t),0,n,0,0,128*(1-n),0,0,r,0,128*(1-r),0,0,0,1,0])},brightness:function(t,n,r){return n===e&&(n=t),r===e&&(r=t),this.set([1,0,0,0,t,0,1,0,0,n,0,0,1,0,r,0,0,0,1,0])},adjustHue:function(e){e*=c;var n=l(e),r=s(e),i=t.LUMA;return this.set([i[0]+n*(1-i[0])+r*-i[0],i[1]+n*-i[1]+r*-i[1],i[2]+n*-i[2]+r*(1-i[2]),0,0,i[0]+n*-i[0]+.143*r,i[1]+n*(1-i[1])+.14*r,i[2]+n*-i[2]+r*-.283,0,0,i[0]+n*-i[0]+r*-(1-i[0]),i[1]+n*-i[1]+r*i[1],i[2]+n*(1-i[2])+r*i[2],0,0,0,0,0,1,0])},average:function(t,n,r){return t===e&&(t=.3333),n===e&&(n=.3333),r===e&&(r=.3334),this.set([t,n,r,0,0,t,n,r,0,0,t,n,r,0,0,0,0,0,1,0])},quickContrastCorrection:function(t){return t===e&&(t=1.2),this.set([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0])},sepia:function(t){return t===e&&(t=.5),t>1?t=1:0>t&&(t=0),this.set([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0])},sepia2:function(n){n===e&&(n=10),n>100&&(n=100),n*=2.55;var r=t.LUMA;return this.set([r[0],r[1],r[2],0,40,r[0],r[1],r[2],0,20,r[0],r[1],r[2],0,-n,0,0,0,1,0])},threshold:function(n,r){r===e&&(r=256);var i=t.LUMA;return this.set([i[0]*r,i[1]*r,i[2]*r,0,-(r-1)*n,i[0]*r,i[1]*r,i[2]*r,0,-(r-1)*n,i[0]*r,i[1]*r,i[2]*r,0,-(r-1)*n,0,0,0,1,0])},threshold_rgb:function(t,n){return n===e&&(n=256),this.set([n,0,0,0,-(n-1)*t,0,n,0,0,-(n-1)*t,0,0,n,0,-(n-1)*t,0,0,0,1,0])},threshold_alpha:function(t,n){return t===e&&(t=.5),n===e&&(n=256),this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,n,-n*t])},RGB2YCbCr:function(){return this.set([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.set([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(t,e){return this._matrix=this._matrix?a(this._matrix,t.getMatrix(),e):new u(t.getMatrix()),this},set:function(t){return this._matrix=this._matrix?i(this._matrix,new u(t)):new u(t),this},reset:function(){return this._matrix=null,this},combineWith:function(t){return this.set(t.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(t){return this._matrix=new u(t),this},_apply:h?function(t,e,n){var r=this;if(r._isOn&&r._matrix){var i,a,s,l,u,o,c,h,_,f,m,p,d,v,g,N,b,w,A,E,C,y=t.length,x=r._matrix,L=(y>>2)%4;for(i=0;y>i;i+=16)w=t[i],A=t[i+1],E=t[i+2],C=t[i+3],a=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],s=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],l=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],u=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],w=t[i+4],A=t[i+5],E=t[i+6],C=t[i+7],o=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],c=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],h=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],_=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],w=t[i+8],A=t[i+9],E=t[i+10],C=t[i+11],f=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],m=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],p=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],d=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],w=t[i+12],A=t[i+13],E=t[i+14],C=t[i+15],v=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],g=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],N=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],b=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,o=0>o?0:o>255?255:o,c=0>c?0:c>255?255:c,h=0>h?0:h>255?255:h,_=0>_?0:_>255?255:_,f=0>f?0:f>255?255:f,m=0>m?0:m>255?255:m,p=0>p?0:p>255?255:p,d=0>d?0:d>255?255:d,v=0>v?0:v>255?255:v,g=0>g?0:g>255?255:g,N=0>N?0:N>255?255:N,b=0>b?0:b>255?255:b,t[i]=~~a,t[i+1]=~~s,t[i+2]=~~l,t[i+3]=~~u,t[i+4]=~~o,t[i+5]=~~c,t[i+6]=~~h,t[i+7]=~~_,t[i+8]=~~f,t[i+9]=~~m,t[i+10]=~~p,t[i+11]=~~d,t[i+12]=~~v,t[i+13]=~~g,t[i+14]=~~N,t[i+15]=~~b;if(L)for(L<<=2,i=y-L;y>i;i+=4)w=t[i],A=t[i+1],E=t[i+2],C=t[i+3],a=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],s=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],l=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],u=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,t[i]=~~a,t[i+1]=~~s,t[i+2]=~~l,t[i+3]=~~u}return t}:function(t,e,n){var r=this;if(r._isOn&&r._matrix){var i,a,s,l,u,o,c,h,_,f,m,p,d,v,g,N,b,w,A,E,C,y=t.length,x=r._matrix,L=(y>>2)%4;for(i=0;y>i;i+=16)w=t[i],A=t[i+1],E=t[i+2],C=t[i+3],a=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],s=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],l=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],u=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],w=t[i+4],A=t[i+5],E=t[i+6],C=t[i+7],o=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],c=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],h=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],_=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],w=t[i+8],A=t[i+9],E=t[i+10],C=t[i+11],f=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],m=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],p=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],d=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],w=t[i+12],A=t[i+13],E=t[i+14],C=t[i+15],v=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],g=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],N=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],b=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],t[i]=~~a,t[i+1]=~~s,t[i+2]=~~l,t[i+3]=~~u,t[i+4]=~~o,t[i+5]=~~c,t[i+6]=~~h,t[i+7]=~~_,t[i+8]=~~f,t[i+9]=~~m,t[i+10]=~~p,t[i+11]=~~d,t[i+12]=~~v,t[i+13]=~~g,t[i+14]=~~N,t[i+15]=~~b;if(L)for(L<<=2,i=y-L;y>i;i+=4)w=t[i],A=t[i+1],E=t[i+2],C=t[i+3],a=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],s=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],l=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],u=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],t[i]=~~a,t[i+1]=~~s,t[i+2]=~~l,t[i+3]=~~u}return t},canRun:function(){return this._isOn&&this._matrix}});_.prototype.grayscale=_.prototype.desaturate,_.prototype.rotateHue=_.prototype.adjustHue,_.prototype.thresholdRgb=_.prototype.threshold_rgb,_.prototype.thresholdAlpha=_.prototype.threshold_alpha,_.multiply=i,_.blend=a,_.eye=r}(e),!function(t,e){var r=t.ImArrayCopy,i=t.Color.clampPixel,a=t.Util.Array.typed,s=function(){var t,e=new r(256);for(t=0;256>t;t++)e[t]=t;return e},l=function(){var t,e=new r(256);for(t=0;256>t;t++)e[t]=255-t;return e},u=function(t){var e,n=new r(256);for(e=0;256>e;e++)n[e]=t;return n},o=function(t){return t?new r(t):null},c=Math.pow,h=Math.exp,_=1/255,f=t.TableLookupFilter=t.Class(t.Filter,{name:"TableLookupFilter",constructor:function(t,e,n,r){var i=this;i.$super("constructor"),i._tableR=t||null,i._tableG=e||i._tableR,i._tableB=n||i._tableG,i._tableA=r||null},path:n,_tableR:null,_tableG:null,_tableB:null,_tableA:null,dispose:function(){var t=this;return t.$super("dispose"),t._tableR=null,t._tableG=null,t._tableB=null,t._tableA=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_tableR:t._tableR,_tableG:t._tableG,_tableB:t._tableB,_tableA:t._tableA}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._tableR=a(e._tableR,r),n._tableG=a(e._tableG,r),n._tableB=a(e._tableB,r),n._tableA=a(e._tableA,r)),n},thresholds:function(t,e,n){t.length||(t=[t]),e||(e=t),n||(n=e);var a,s,l=t.length,u=l+1,o=e.length,c=o+1,h=n.length,_=h+1,f=new r(256),m=new r(u),p=new r(256),d=new r(c),v=new r(256),g=new r(_),N=255/(u-1),b=255/(c-1),w=255/(_-1);for(a=0;u>a;)m[a]=~~(N*a),a++;for(t[0]=~~(255*t[0]),a=1;l>a;)t[a]=t[a-1]+~~(255*t[a]),a++;for(a=0;c>a;)d[a]=~~(b*a),a++;for(e[0]=~~(255*e[0]),a=1;o>a;)e[a]=e[a-1]+~~(255*e[a]),a++;for(a=0;_>a;)g[a]=~~(w*a),a++;for(n[0]=~~(255*n[0]),a=1;h>a;)n[a]=n[a-1]+~~(255*n[a]),a++;for(a=0;256>a;a++){for(s=0;l>s&&a>t[s];)s++;for(f[a]=i(m[s]),s=0;o>s&&a>e[s];)s++;for(p[a]=i(d[s]),s=0;h>s&&a>n[s];)s++;v[a]=i(g[s])}return this.set(f,p,v)},threshold:function(t,e,n){return t=t||.5,e=e||t,n=n||e,this.thresholds([t],[e],[n])},quantize:function(t){t===e&&(t=64),2>t&&(t=2);var n,a=new r(256),s=new r(t),l=255/(t-1),u=t/256;for(n=0;t>n;)s[n]=~~(l*n),n++;for(n=0;256>n;n++)a[n]=i(s[~~(u*n)]);return this.set(a)},binarize:function(){return this.quantize(2)},channel:function(e){if(null==e)return this;var n,r,i;switch(e){case t.CHANNEL.BLUE:n=u(0),r=u(0),i=s();break;case t.CHANNEL.GREEN:n=u(0),r=s(),i=u(0);break;case t.CHANNEL.RED:default:n=s(),r=u(0),i=u(0)}return this.set(n,r,i)},redChannel:function(){return this.channel(t.CHANNEL.RED)},greenChannel:function(){return this.channel(t.CHANNEL.GREEN)},blueChannel:function(){return this.channel(t.CHANNEL.BLUE)},solarize:function(t){t===e&&(t=.5);var n,a,s=0,l=new r(256),u=2/255;for(s=0;256>s;s++)n=u*s,a=n>t?255-255*n:255*n-255,l[s]=~~i(a);return this.set(l)},solarize2:function(t){t===e&&(t=.5),t=1-t;var n,a,s=0,l=new r(256),u=2/255;for(s=0;256>s;s++)n=u*s,a=t>n?255-255*n:255*n-255,l[s]=~~i(a);return this.set(l)},solarizeInverse:function(t){t===e&&(t=.5),t*=256;var n=0,i=new r(256);for(n=0;256>n;n++)i[n]=n>t?255-n:n;return this.set(i)},invert:function(){return this.set(l())},mask:function(t){var e=0,n=t>>16&255,a=t>>8&255,s=255&t;for(tR=new r(256),tG=new r(256),tB=new r(256),e=0;256>e;e++)tR[e]=i(e&n),tG[e]=i(e&a),tB[e]=i(e&s);return this.set(tR,tG,tB)},replace:function(t,e){if(t==e)return this;var n=t>>16&255,r=t>>8&255,i=255&t,a=e>>16&255,l=e>>8&255,u=255&e,o=s(),c=s(),h=s();return o[n]=a,c[r]=l,h[i]=u,this.set(o,c,h)},extract:function(e,n,r){if(!n||!n.length)return this;r=r||0;var a,s,l=r>>16&255,o=r>>8&255,c=255&r,h=u(l),_=u(o),f=u(c);switch(e){case t.CHANNEL.BLUE:for(a=n[0],s=n[1];s>=a;)f[a]=i(a),a++;break;case t.CHANNEL.GREEN:for(a=n[0],s=n[1];s>=a;)_[a]=i(a),a++;break;case t.CHANNEL.RED:default:for(a=n[0],s=n[1];s>=a;)h[a]=i(a),a++}return this.set(h,_,f)},gammaCorrection:function(t,e,n){t=t||1,e=e||t,n=n||e,t=1/t,e=1/e,n=1/n;var a=new r(256),s=new r(256),l=new r(256),u=0;for(u=0;256>u;u++)a[u]=i(~~(255*c(_*u,t))),s[u]=i(~~(255*c(_*u,e))),l[u]=i(~~(255*c(_*u,n)));return this.set(a,s,l)},exposure:function(t){t===e&&(t=1);var n=0,a=new r(256);for(n=0;256>n;n++)a[n]=i(~~(255*(1-h(-t*n*_))));return this.set(a)},set:function(t,e,n,r){if(!t)return this;e=e||t,n=n||e;var a,l,u,c,h,_=this._tableR||s(),f=o(_);if(e&&n){for(a=this._tableG||o(_),l=this._tableB||o(a),u=o(a),c=o(l),h=0;256>h;h++)_[h]=i(t[i(f[h])]),a[h]=i(e[i(u[h])]),l[h]=i(n[i(c[h])]);this._tableR=_,this._tableG=a,this._tableB=l}else{for(h=0;256>h;h++)_[h]=i(t[i(f[h])]);this._tableR=_,this._tableG=this._tableR,this._tableB=this._tableR}return this},reset:function(){return this._tableR=this._tableG=this._tableB=this._tableA=null,this},combineWith:function(t){return this.set(t.getTable(0),t.getTable(1),t.getTable(2))},getTable:function(e){switch(e=e||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA;case t.CHANNEL.BLUE:return this._tableB;case t.CHANNEL.GREEN:return this._tableG;case t.CHANNEL.RED:default:return this._tableR}},setTable:function(e,n){switch(n=n||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA=e,this;case t.CHANNEL.BLUE:return this._tableB=e,this;case t.CHANNEL.GREEN:return this._tableG=e,this;case t.CHANNEL.RED:default:return this._tableR=e,this}},_apply:function(t,e,n){var r=this;if(!r._isOn||!r._tableR)return t;var i,a,s,l,u,o=t.length,c=(o>>2)%4,h=r._tableR,_=r._tableG,f=r._tableB,m=r._tableA;if(m){for(i=0;o>i;i+=16)a=t[i],s=t[i+1],l=t[i+2],u=t[i+3],t[i]=h[a],t[i+1]=_[s],t[i+2]=f[l],t[i+3]=m[u],a=t[i+4],s=t[i+5],l=t[i+6],u=t[i+7],t[i+4]=h[a],t[i+5]=_[s],t[i+6]=f[l],t[i+7]=m[u],a=t[i+8],s=t[i+9],l=t[i+10],u=t[i+11],t[i+8]=h[a],t[i+9]=_[s],t[i+10]=f[l],t[i+11]=m[u],a=t[i+12],s=t[i+13],l=t[i+14],u=t[i+15],t[i+12]=h[a],t[i+13]=_[s],t[i+14]=f[l],t[i+15]=m[u];if(c)for(c<<=2,i=o-c;o>i;i+=4)a=t[i],s=t[i+1],l=t[i+2],u=t[i+3],t[i]=h[a],t[i+1]=_[s],t[i+2]=f[l],t[i+3]=m[u]}else{for(i=0;o>i;i+=16)a=t[i],s=t[i+1],l=t[i+2],t[i]=h[a],t[i+1]=_[s],t[i+2]=f[l],a=t[i+4],s=t[i+5],l=t[i+6],t[i+4]=h[a],t[i+5]=_[s],t[i+6]=f[l],a=t[i+8],s=t[i+9],l=t[i+10],t[i+8]=h[a],t[i+9]=_[s],t[i+10]=f[l],a=t[i+12],s=t[i+13],l=t[i+14],t[i+12]=h[a],t[i+13]=_[s],t[i+14]=f[l];if(c)for(c<<=2,i=o-c;o>i;i+=4)a=t[i],s=t[i+1],l=t[i+2],t[i]=h[a],t[i+1]=_[s],t[i+2]=f[l]}return t},canRun:function(){return this._isOn&&this._tableR}});f.prototype.posterize=f.prototype.levels=f.prototype.quantize}(e),!function(t,e){var r=t.ImArray,i=t.ImArrayCopy,a=t.Util.Array.typed,s=t.MODE,l=t.Array16I,u=Math.min,o=(Math.max,Math.floor);t.DisplacementMapFilter=t.Class(t.Filter,{name:"DisplacementMapFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&e.setMap(t)},path:n,_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,red:0,green:0,blue:0,alpha:0,mode:s.CLAMP,dispose:function(){var t=this;return t.$super("dispose"),t._map=null,t.map=null,t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.red=null,t.green=null,t.blue=null,t.alpha=null,t.mode=null,t},serialize:function(){var t=this,e=t.map;return{filter:t.name,_isOn:!!t._isOn,params:{_map:t._map||(e?{data:e.getData(),width:e.width,height:e.height}:null),scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color,red:t.red,green:t.green,blue:t.blue,alpha:t.alpha,mode:t.mode}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n.map=null,n._map=e._map,n._map&&(n._map.data=a(n._map.data,r)),n.scaleX=e.scaleX,n.scaleY=e.scaleY,n.startX=e.startX,n.startY=e.startY,n.componentX=e.componentX,n.componentY=e.componentY,n.color=e.color,n.red=e.red,n.green=e.green,n.blue=e.blue,n.alpha=e.alpha,n.mode=e.mode),n},reset:function(){var t=this;return t._map=null,t.map=null,t},getMap:function(){return this.map},setMap:function(t){var e=this;return t&&(e.map=t,e._map=null),e},setColor:function(t){var e=this;return e.color=t,e.alpha=t>>24&255,e.red=t>>16&255,e.green=t>>8&255,e.blue=255&t,e},_apply:function(t,e,n){var r=this,a=r.map;if(!r._isOn||!a&&!r._map)return t;var c,h,_,f,m,p,d,v,g,N,b,w,A,E,C,y,x,L,R,M,O,H,k,I,G,Y,F,X,P,T,B,z=r._map||{data:a.getData(),width:a.width,height:a.height},S=.00390625*r.scaleX,U=.00390625*r.scaleY,W=r.componentX,D=r.componentY,$=r.alpha,q=r.red,j=r.green,Q=r.blue,J=r.mode,K=s.IGNORE,V=(s.CLAMP,s.COLOR),Z=s.WRAP;for(c=z.data,h=z.width,_=z.height,f=c.length>>2,p=u(h,e),d=u(_,n),X=t.length,Y=p*d<<2,F=X>>2,g=o(r.startX*(e-1)),v=o(r.startY*(n-1)),N=v*e,b=-g,w=-v,A=e-g-1,E=n-v-1,m=new l(f<<1),P=new i(t),y=0,x=0,L=0,R=0,C=0;f>C;C++,y+=2,x++)x>=h&&(x=0,L++,R+=h),k=x+R<<2,m[y]=o((c[k+W]-128)*S),m[y+1]=o((c[k+D]-128)*U);for(x=0,L=0,R=0,M=0,C=0;Y>C;C+=4,x++)if(x>=p&&(x=0,L++,R+=e,M+=h),!(w>L||L>E||b>x||x>A)){if(H=x+g,O=L+v,I=H+R+N<<2,y=x+M<<1,T=H+m[y],B=O+m[y+1],B>=n||0>B||T>=e||0>T){if(J==K)continue;if(J==V){t[I]=q,t[I+1]=j,t[I+2]=Q,t[I+3]=$;continue}J==Z?(B>E?B-=n:0>B&&(B+=n),T>A?T-=e:0>T&&(T+=e)):(B>E?B=E:0>B&&(B=0),T>A?T=A:0>T&&(T=0))}G=T+B*e<<2,t[I]=P[G],t[I+1]=P[G+1],t[I+2]=P[G+2],t[I+3]=P[G+3]}return t},canRun:function(){return this._isOn&&(this._map||this.map)}})}(e),!function(t,e){var r,i=t.ImArray,a=t.ImArrayCopy,s=t.Util.Array.typed,l=t.CONST.PI,u=t.CONST.PI2,o=t.CONST.PI_2,c=t.MODE,h=(t.CONST.toRad,1.5*l),_=Math.sqrt,f=Math.atan2,m=Math.atan,p=Math.sin,d=Math.cos,v=Math.floor,g=Math.round,N=Math.asin,b=Math.tan,w=(Math.abs,Math.max),A=t.GeometricMapFilter=t.Class(t.Filter,{name:"GeometricMapFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&e.generic(t)},path:n,_map:null,_mapName:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,dx:0,dy:0,angle:0,radius:0,wavelength:0,amplitude:0,phase:0,xAmplitude:0,yAmplitude:0,xWavelength:0,yWavelength:0,mode:c.CLAMP,dispose:function(){var t=this;return t.$super("dispose"),t._map=null,t._mapName=null,t.inverseTransform=null,t.matrix=null,t.centerX=null,t.centerY=null,t.dx=null,t.dy=null,t.angle=null,t.radius=null,t.wavelength=null,t.amplitude=null,t.phase=null,t.xAmplitude=null,t.yAmplitude=null,t.xWavelength=null,t.yWavelength=null,t.mode=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_mapName:t._mapName,inverseTransform:t.inverseTransform?t.inverseTransform.toString():null,matrix:t.matrix,centerX:t.centerX,centerY:t.centerY,dx:t.dx,dy:t.dy,angle:t.angle,radius:t.radius,wavelength:t.wavelength,amplitude:t.amplitude,phase:t.phase,xAmplitude:t.xAmplitude,yAmplitude:t.yAmplitude,xWavelength:t.xWavelength,yWavelength:t.yWavelength,mode:t.mode}}},unserialize:function(e){var n,i=this;return e&&i.name===e.filter&&(i._isOn=!!e._isOn,n=e.params,i.inverseTransform=null,i.matrix=s(n.matrix,Array),i.centerX=n.centerX,i.centerY=n.centerY,i.dx=n.dx,i.dy=n.dy,i.angle=n.angle,i.radius=n.radius,i.wavelength=n.wavelength,i.amplitude=n.amplitude,i.phase=n.phase,i.xAmplitude=n.xAmplitude,i.yAmplitude=n.yAmplitude,i.xWavelength=n.xWavelength,i.yWavelength=n.yWavelength,i.mode=n.mode,n.inverseTransform&&(i.inverseTransform=new Function("FILTER",'"use strict"; return '+n.inverseTransform)(t)),i._mapName=n._mapName,i._map=null,i._mapName&&r[i._mapName]&&(i._map=r[i._mapName])),i},generic:function(t){var e=this;return t&&(e.inverseTransform=t,e._mapName="generic",e._map=r.generic),e},affine:function(t){var e=this;return t&&(e.matrix=t,e._mapName="affine",e._map=r.affine),e},flipX:function(){var t=this;return t._mapName="flipX",t._map=r.flipX,t},flipY:function(){var t=this;return t._mapName="flipY",t._map=r.flipY,t},flipXY:function(){var t=this;return t._mapName="flipXY",t._map=r.flipXY,t},rotateCW:function(){var t=this;return t._mapName="rotateCW",t._map=r.rotateCW,t},rotateCCW:function(){var t=this;return t._mapName="rotateCCW",t._map=r.rotateCCW,t},polar:function(t,e){var n=this;return n.centerX=t||0,n.centerY=e||0,n._mapName="polar",n._map=r.polar,n},cartesian:function(t,e){var n=this;return n.centerX=t||0,n.centerY=e||0,n._mapName="cartesian",n._map=r.cartesian,n},twirl:function(t,e,n,i){var a=this;return a.angle=t||0,a.radius=e||0,a.centerX=n||0,a.centerY=i||0,a._mapName="twirl",a._map=r.twirl,a},sphere:function(t,e,n){var i=this;return i.radius=t||0,i.centerX=e||0,i.centerY=n||0,i._mapName="sphere",i._map=r.sphere,i},ripple:function(t,n,i,a,s,l){var u=this;return u.radius=t!==e?t:50,u.centerX=s||0,u.centerY=l||0,u.wavelength=n!==e?n:16,u.amplitude=i!==e?i:10,u.phase=a||0,u._mapName="ripple",u._map=r.ripple,u},shift:function(t,n){var i=this;return i.dx=t!==e?t:0,i.dy=n!==e?n:i.dx,i._mapName="shift",i._map=r.shift,i},reset:function(){var t=this;return t._mapName=null,t._map=null,t},getMap:function(){return this._map},setMap:function(t){var e=this;return e._mapName=null,e._map=t,e},_apply:function(t,e,n,r){var i=this;return i._isOn&&i._map?i._map(i,t,e,n,r):t},canRun:function(){return this._isOn&&this._map}});A.prototype.translate=A.prototype.shift,r={generic:function(t,e,n,r){var a,s,l,u,o,h,_,f=e.length,m=new i(f),p=t.inverseTransform,d=t.mode,v=c.CLAMP,g=c.WRAP;for(a=0,s=0,l=0;f>l;l+=4,a++){if(a>=n&&(a=0,s++),o=p([a,s],n,r),h=~~o[0],_=~~o[1],0>h||h>=n||0>_||_>=r)switch(d){case g:_>=r?_-=r:0>_&&(_+=r),h>=n?h-=n:0>h&&(h+=n);break;case v:default:_>=r?_=r-1:0>_&&(_=0),h>=n?h=n-1:0>h&&(h=0)}u=h+_*n<<2,m[l]=e[u],m[l+1]=e[u+1],m[l+2]=e[u+2],m[l+3]=e[u+3]}return m},affine:function(t,e,n,r){var a,s,l,u,o,h,_,f,m,p=e.length,d=p>>2,v=new i(p),g=t.matrix,N=g[0],b=g[1],w=g[3],A=g[4],E=g[2],C=g[5],y=t.mode,x=c.CLAMP,L=c.WRAP,R=n-1,M=d-n;for(a=0,s=0,o=C*n,h=w*n,_=A*n,l=0;p>l;l+=4,a++){if(a>=n&&(a=0,s++),f=~~(N*a+b*s+E),m=~~(h*a+_*s+o),0>f||f>R||0>m||m>M)switch(y){case L:m>M?m-=d:0>m&&(m+=d),f>=n?f-=n:0>f&&(f+=n);break;case x:default:m>M?m=M:0>m&&(m=0),f>R?f=R:0>f&&(f=0)}u=f+m<<2,v[l]=e[u],v[l+1]=e[u+1],v[l+2]=e[u+2],v[l+3]=e[u+3]}return v},shift:function(t,e,n,r){var a,s,l,u,o,c=e.length,h=new i(c),_=-t.dx,f=-t.dy;for(0>_&&(_+=n),0>f&&(f+=r),a=0,s=0,l=0,u=0;c>u;u+=4,a++)a>=n&&(a=0,s++,l+=n),o=(a+_)%n+(s+f)%r*n<<2,h[u]=e[o],h[u+1]=e[o+1],h[u+2]=e[o+2],h[u+3]=e[o+3];return h},flipX:function(t,e,n,r){var a,s,l,u,o,c=e.length,h=new i(c);for(a=0,s=0,l=0,u=0;c>u;u+=4,a++)a>=n&&(a=0,s++,l+=n),o=n-1-a+l<<2,h[u]=e[o],h[u+1]=e[o+1],h[u+2]=e[o+2],h[u+3]=e[o+3];return h},flipY:function(t,e,n,r){var a,s,l,u,o,c=e.length,h=new i(c);for(a=0,s=0,l=(r-1)*n,u=0;c>u;u+=4,a++)a>=n&&(a=0,s++,l-=n),o=a+l<<2,h[u]=e[o],h[u+1]=e[o+1],h[u+2]=e[o+2],h[u+3]=e[o+3];return h},flipXY:function(t,e,n,r){var a,s,l,u,o,c,h=e.length,_=new i(h);for(a=0,s=0,u=(r-1)*n,o=0;h>o;o+=4,a++)a>=n&&(a=0,s++,l+=n,u-=n),c=n-1-a+u<<2,_[o]=e[c],_[o+1]=e[c+1],_[o+2]=e[c+2],_[o+3]=e[c+3];return _},rotateCW:function(t,e,n,r){var a,s,l,u,o,c=e.length,h=new i(c),_=c>>2;for(a=0,s=0,l=_-1,u=0;c>u;u+=4,a++,l-=n)a>=n&&(a=0,l=_-1,s++),o=s+l<<2,h[u]=e[o],h[u+1]=e[o+1],h[u+2]=e[o+2],h[u+3]=e[o+3];return h},rotateCCW:function(t,e,n,r){var a,s,l,u,o,c=e.length,h=new i(c);for(a=0,s=0,l=0,u=0;c>u;u+=4,a++,l+=n)a>=n&&(a=0,l=0,s++),o=n-1-s+l<<2,h[u]=e[o],h[u+1]=e[o+1],h[u+2]=e[o+2],h[u+3]=e[o+3];return h},twirl:function(t,e,n,r){if(0>=t.radius)return e;var i,s,l,u,o,h,m,g,N=e.length,b=new a(e),w=t.centerX,A=t.centerY,E=t.angle,C=t.radius,y=t.mode,x=c.CLAMP,L=c.WRAP,R=E/C,M=n-1,O=r-1;for(w=v(w*(n-1)),A=v(A*(r-1)),i=0,s=0,l=0;N>l;l+=4,i++)if(i>=n&&(i=0,s++),h=i-w,m=s-A,o=_(h*h+m*m),C>o){if(g=f(m,h)+R*(C-o),h=~~(w+o*d(g)),m=~~(A+o*p(g)),0>h||h>M||0>m||m>O)switch(y){case L:m>O?m-=r:0>m&&(m+=r),h>M?h-=n:0>h&&(h+=n);break;case x:default:m>O?m=O:0>m&&(m=0),h>M?h=M:0>h&&(h=0)}u=h+m*n<<2,e[l]=b[u],e[l+1]=b[u+1],e[l+2]=b[u+2],e[l+3]=b[u+3]}return e},sphere:function(t,e,n,r){if(0>=t.radius)return e;var i,s,l,u,o,h,f,m,p,d,g,w,A,E=e.length,C=new a(e),y=t.centerX,x=t.centerY,L=t.radius,R=t.mode,M=c.CLAMP,O=c.WRAP,H=L*L,k=.555556,I=1-k,G=n-1,Y=r-1;for(y=v(y*(n-1)),x=v(x*(r-1)),i=0,s=0,l=0;E>l;l+=4,i++)if(i>=n&&(i=0,s++),o=i-y,h=s-x,w=o*o,A=h*h,f=w+A,H>f){if(d=H-f,g=_(d),m=N(o/_(w+d))*I,p=N(h/_(A+d))*I,o=~~(i-g*b(m)),h=~~(s-g*b(p)),0>o||o>G||0>h||h>Y)switch(R){case O:h>Y?h-=r:0>h&&(h+=r),o>G?o-=n:0>o&&(o+=n);break;case M:default:h>Y?h=Y:0>h&&(h=0),o>G?o=G:0>o&&(o=0)}u=o+h*n<<2,e[l]=C[u],e[l+1]=C[u+1],e[l+2]=C[u+2],e[l+3]=C[u+3]}return e},ripple:function(t,e,n,r){if(0>=t.radius)return e;var i,s,l,u,o,h,f,m,d,g,N,b=e.length,w=new a(e),A=c.CLAMP,E=c.WRAP,C=n-1,y=r-1,x=t.centerX,L=t.centerY,R=t.radius,M=t.mode,O=R*R,H=t.wavelength,k=t.amplitude,I=t.phase;for(x=v(x*(n-1)),L=v(L*(r-1)),i=0,s=0,l=0;b>l;l+=4,i++)if(i>=n&&(i=0,s++),h=i-x,f=s-L,g=h*h,N=f*f,d=g+N,O>d){if(o=_(d),m=k*p(o/H*Math.PI*2-I),m*=(R-o)/R,o&&(m*=H/o),h=~~(i+h*m),f=~~(s+f*m),0>h||h>C||0>f||f>y)switch(M){case E:f>y?f-=r:0>f&&(f+=r),h>C?h-=n:0>h&&(h+=n);break;case A:default:f>y?f=y:0>f&&(f=0),h>C?h=C:0>h&&(h=0)}u=h+f*n<<2,e[l]=w[u],e[l+1]=w[u+1],e[l+2]=w[u+2],e[l+3]=w[u+3]}return e},polar:function(t,e,n,r){var i,s,f,p,d,v,N,b,A,E,C,y,x=e.length,L=new a(e),R=c.CLAMP,M=c.WRAP,O=n-1,H=r-1,k=0,I=t.mode;for(C=~~(.5*n+.5),y=~~(.5*r+.5),E=w(y,C),i=0,s=0,f=0;x>f;f+=4,i++){if(i>=n&&(i=0,s++),
p=i-C,d=s-y,A=0,p>=0?d>0?(A=l-m(p/d),k=_(p*p+d*d)):0>d?(A=m(p/d),k=_(p*p+d*d)):(A=o,k=p):0>p&&(0>d?(A=u-m(p/d),k=_(p*p+d*d)):d>0?(A=l+m(p/d),k=_(p*p+d*d)):(A=h,k=-p)),v=n-1-(n-1)/u*A,N=r*k/E,v=g(v),N=g(N),0>v||v>O||0>N||N>H)switch(I){case M:N>H?N-=r:0>N&&(N+=r),v>O?v-=n:0>v&&(v+=n);break;case R:default:N>H?N=H:0>N&&(N=0),v>O?v=O:0>v&&(v=0)}b=v+N*n<<2,e[f]=L[b],e[f+1]=L[b+1],e[f+2]=L[b+2],e[f+3]=L[b+3]}return e},cartesian:function(t,e,n,r){var i,s,_,f,m,v,N,b,A,E,C,y,x,L=e.length,R=new a(e),M=c.CLAMP,O=c.WRAP,H=n-1,k=r-1,I=0,G=t.mode;for(y=~~(.5*n+.5),x=~~(.5*r+.5),C=w(x,y),i=0,s=0,_=0;L>_;_+=4,i++){if(i>=n&&(i=0,s++),A=i/n*u,E=A>=h?u-A:A>=l?A-l:A>=o?l-A:A,I=C*(s/r),N=-I*p(E),b=I*d(E),A>=h?(f=y-N,m=x-b):A>=l?(f=y-N,m=x+b):A>=o?(f=y+N,m=x+b):(f=y+N,m=x-b),f=g(f),m=g(m),0>f||f>H||0>m||m>k)switch(G){case O:m>k?m-=r:0>m&&(m+=r),f>H?f-=n:0>f&&(f+=n);break;case M:default:m>k?m=k:0>m&&(m=0),f>H?f=H:0>f&&(f=0)}v=f+m*n<<2,e[_]=R[v],e[_+1]=R[v+1],e[_+2]=R[v+2],e[_+3]=R[v+3]}return e}}}(e),!function(t,e){function r(t,e,n,r){var i,a=t.length,s=new C(t.length);for(n=n||1,r=r||1,i=0;a>i;)s[i]=n*t[i]+r*e[i],i++;return s}function i(t,e){var n,r,i,a=t.length,s=[],l=0;for(n=0;a>n;n++)for(r=0;a>r;r++)i=t[n]*e[r],l+=i,s.push(i);return{kernel:s,sum:l}}function a(t){var e,n=new Array(t);for(e=0;t>e;)n[e]=1,e++;return n}function s(t){var e,n,r,i,a=L.length;if(t--,a>t)e=new C(L[t]);else for(e=new C(L[a-1]);t>=a;){for(n=e,e=new C(n.length+1),e[0]=1,r=0,i=n.length-1;i>r;r++)e[r+1]=n[r]+n[r+1];e[n.length]=1,40>a&&L.push(new Array(e)),a++}return e}function l(t){var e,n=t>>1,r=-n,i=new Array(t);for(e=0;t>e;)i[e]=r,r++,e++;return i}function u(t){var e=s(t);return i(e,e)}function o(t,e){var n=s(t),r=l(t);return 1==e?i(r.reverse(),n):i(n,r)}function c(t,e){var n=a(t),r=l(t);return 1==e?i(r.reverse(),n):i(n,r)}function h(t,e,n){e=e||1,n=n||e;var r,i=t*t,a=i>>1,s=new C(i);for(r=0;i>r;)s[r]=e,r++;return s[a]=n,s}function _(t,e,n,r){var i,a,s,l,u,o=t*t,c=t>>1,h=o>>1,_=new C(o);for(l=0,i=0;c>=i;i++){for(a=0,u=0,s=0;c>=s;s++)_[h+i+a]=l+u,_[h-i-a]=-l-u,_[h-i+a]=-l+u,_[h+i-a]=l-u,a+=t,u+=n;l+=e}return _[h]=r||1,_}function f(t,e,n,r){var i,a,s,l,u,o,c=t*t,h=t>>1,_=c>>1,f=new C(c),m=new C(c),d=1/t,v=1e-8;for(p(e)>v?(u=1,o=n/e):(u=e/n,o=1),i=0,s=0,l=0,a=o*t;h>=i;)m[_+i]=~~(_+s+l+.5),m[_-i]=~~(_-s-l+.5),i++,s+=u,l+=a;for(i=0;h>=i;)f[m[_+i]]=f[m[_-i]]=d,i++;return f[_]=r||1,f}var m=(t.CONST.SQRT2,t.CONST.toRad),p=(t.CONST.toDeg,Math.abs),d=Math.sqrt,v=Math.sin,g=Math.cos,N=t.Util.Array.typed,b=t.Util.Filter,w=t._notSupportClamp,A=b.integral_convolution,E=b.separable_convolution,C=t.Array32F,y=t.ImArray,x=(t.Array32F,t.Array16I),L=(t.Array8U,[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]]),R=t.ConvolutionMatrixFilter=t.Class(t.Filter,{name:"ConvolutionMatrixFilter",constructor:function(t,e,n,r){var i=this;i.$super("constructor"),i._coeff=new C([1,0]),t&&t.length?i.set(t,~~(d(t.length)+.5),e||1,n||0):(i._matrix=null,i._dim=0),i._matrix2=null,i._dim2=0,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,i._rgba=!!r},path:n,_dim:0,_dim2:0,_matrix:null,_matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_rgba:!1,_webglInstance:null,dispose:function(){var t=this;return t.$super("dispose"),t._webglInstance=null,t._dim=null,t._dim2=null,t._matrix=null,t._matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t._rgba=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_dim:t._dim,_dim2:t._dim2,_matrix:t._matrix,_matrix2:t._matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2,_rgba:t._rgba}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._dim2=e._dim2,n._matrix=N(e._matrix,C),n._matrix2=N(e._matrix2,C),n._mat=N(e._mat,C),n._mat2=N(e._mat2,C),n._coeff=N(e._coeff,C),n._isGrad=e._isGrad,n._doIntegral=e._doIntegral,n._doSeparable=e._doSeparable,n._indices=N(e._indices,x),n._indices2=N(e._indices2,x),n._indicesf=N(e._indicesf,x),n._indicesf2=N(e._indicesf2,x),n._rgba=e._rgba),n},rgba:function(t){var e=this;return arguments.length?(e._rgba=!!t,e):e._rgba},lowPass:function(t){return t=t===e?3:t%2?t:t+1,this.set(h(t),t,1/(t*t),0),this._doIntegral=1,this},highPass:function(t,n){t=t===e?3:t%2?t:t+1,n=n===e?1:n;var r=t*t,i=-n/r,a=h(t,i,1+i);return this.set(a,t,1,0),this._doIntegral=1,this},glow:function(t,n){return t=t===e?.5:t,this.highPass(n,-t)},sharpen:function(t,n){return t=t===e?.5:t,this.highPass(n,t)},verticalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(a(t),1,1/t,0),this._dim2=t,this._doIntegral=1,this},horizontalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(a(t),t,1/t,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(t,n){n=n===e?3:n%2?n:n+1,t*=m;var r=g(t),i=-v(t),a=f(n,r,i,1/n);return this.set(a,n,1,0)},fastGauss:function(t,n){return n=n===e?3:n%2?n:n+1,t=~~(t||1),1>t?t=1:t>3&&(t=3),this.set(h(n),n,1/(n*n),0),this._doIntegral=t,this},binomialLowPass:function(t){t=t===e?3:t%2?t:t+1;var n=s(t),r=1<<t-1,i=1/r;this.set(n,t,i,i),this._matrix2=new C(n);var a=this._computeIndices(this._matrix2,this._dim2);return this._indices2=a[0],this._indicesf2=a[1],this._mat2=a[2],this._doSeparable=!0,this},binomialHighPass:function(t){t=t===e?3:t%2?t:t+1;var n=u(t);return this.set(r(h(t),new C(n.kernel),1,-1/n.sum),t,1,0)},prewittX:function(t){t=t===e?3:t%2?t:t+1;var n=c(t,0);return this.set(n.kernel,t,1,0)},prewittY:function(t){t=t===e?3:t%2?t:t+1;var n=c(t,1);return this.set(n.kernel,t,1,0)},prewittDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=m;var i=g(t),a=v(t),s=c(n,0),l=c(n,1);return this.set(r(new C(s.kernel),new C(l.kernel),i,a),n,1,0)},prewitt:function(t){t=t===e?3:t%2?t:t+1;var n=c(t,0),r=c(t,1);this.set(n.kernel,t,1,0),this._isGrad=!0,this._matrix2=new C(r.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this},sobelX:function(t){t=t===e?3:t%2?t:t+1;var n=o(t,0);return this.set(n.kernel,t,1,0)},sobelY:function(t){t=t===e?3:t%2?t:t+1;var n=o(t,1);return this.set(n.kernel,t,1,0)},sobelDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=m;var i=g(t),a=v(t),s=o(n,0),l=o(n,1);return this.set(r(new C(s.kernel),new C(l.kernel),i,a),n,1,0)},sobel:function(t){t=t===e?3:t%2?t:t+1;var n=o(t,0),r=o(t,1);this.set(n.kernel,t,1,0),this._matrix2=new C(r.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this._isGrad=!0,this},laplace:function(t){t=t===e?3:t%2?t:t+1;var n=t*t,r=h(t,-1,n-1);return this.set(r,t,1,0),this._doIntegral=1,this},emboss:function(t,n,r){r=r===e?3:r%2?r:r+1,t=t===e?-.25*Math.PI:t*m,n=n||1;var i=n*g(t),a=-n*v(t),s=_(r,i,a,1);return this.set(s,r,1,0)},edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,n,r){var i=this;i._matrix2=null,i._dim2=0,i._indices2=i._indicesf2=null,i._mat2=null,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,i._matrix=new C(t),i._dim=e,i._coeff[0]=n||1,i._coeff[1]=r||0;var a=i._computeIndices(i._matrix,i._dim);return i._indices=a[0],i._indicesf=a[1],i._mat=a[2],i},_computeIndices:function(t,e){var n,r,i,a=[],s=[],l=[],u=t.length,o=e,c=o>>1;for(r=0,i=0,n=0;u>n;)s.push(r-c),s.push(i-c),t[n]&&(a.push(r-c),a.push(i-c),l.push(t[n])),n++,r++,r>=o&&(r=0,i++);return[new x(a),new x(s),new C(l)]},reset:function(){var t=this;return t._matrix=t._matrix2=null,t._mat=t._mat2=null,t._dim=t._dim2=0,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t},combineWith:function(t){return this},getMatrix:function(){return this._matrix},setMatrix:function(t,e){return this.set(t,e)},_apply:function(t,e,n){var r=this,i=r._rgba;if(!r._isOn||!r._matrix)return t;if(r._doIntegral)return r._matrix2?A(i,t,e,n,r._matrix,r._matrix2,r._dim,r._dim2,r._coeff[0],r._coeff[1],r._doIntegral):A(i,t,e,n,r._matrix,null,r._dim,r._dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return E(i,t,e,n,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,s,l,u,o,c,h,_,f,m,d,v,g,N,b,C,L,R,M,O,H,k,I,G,Y,F=t.length,X=F>>2,P=new y(F),T=e-1,B=X-e,z=r._coeff[0],S=r._coeff[1],U=r._matrix,W=r._matrix2,D=r._isGrad;if(W){for(I=r._indicesf.length,Y=new x(r._indicesf),h=0;I>h;h+=2)Y[h+1]*=e;for(G=U.length,_=0,f=0,o=0;F>o;o+=4,_++){for(_>=e&&(_=0,f+=e),g=N=b=C=L=R=M=O=0,h=0,c=0;G>h;h++,c+=2)m=_+Y[c],d=f+Y[c+1],m>=0&&T>=m&&d>=0&&B>=d&&(v=m+d<<2,H=U[h],g+=t[v]*H,N+=t[v+1]*H,b+=t[v+2]*H,C+=t[v+3]*H,k=W[h],L+=t[v]*k,R+=t[v+1]*k,M+=t[v+2]*k,O+=t[v+3]*k);D?(a=p(g)+p(L),s=p(N)+p(R),l=p(b)+p(M)):(a=z*g+S*L,s=z*N+S*R,l=z*b+S*M),w&&(a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l),P[o]=~~a,P[o+1]=~~s,P[o+2]=~~l,i?(u=D?p(C)+p(O):z*C+S*O,w&&(u=0>u?0:u>255?255:u),P[o+3]=~~u):P[o+3]=t[o+3]}}else{for(I=r._indices.length,Y=new x(r._indices),h=0;I>h;h+=2)Y[h+1]*=e;for(U=r._mat,G=U.length,_=0,f=0,o=0;F>o;o+=4,_++){for(_>=e&&(_=0,f+=e),g=N=b=C=0,h=0,c=0;G>h;h++,c+=2)m=_+Y[c],d=f+Y[c+1],m>=0&&T>=m&&d>=0&&B>=d&&(v=m+d<<2,H=U[h],g+=t[v]*H,N+=t[v+1]*H,b+=t[v+2]*H,C+=t[v+3]*H);a=z*g+S,s=z*N+S,l=z*b+S,w&&(a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l),P[o]=~~a,P[o+1]=~~s,P[o+2]=~~l,i?(u=z*C+S,w&&(u=0>u?0:u>255?255:u),P[o+3]=~~u):P[o+3]=t[o+3]}}return P},canRun:function(){return this._isOn&&this._matrix}});R.prototype.bump=R.prototype.emboss,R.prototype.boxBlur=R.prototype.lowPass,R.prototype.gaussBlur=R.prototype.binomialLowPass,R.prototype.gradX=R.prototype.prewittX,R.prototype.gradY=R.prototype.prewittY,R.prototype.gradDirectional=R.prototype.prewittDirectional,R.prototype.grad=R.prototype.prewitt}(e),!function(t,e){var r,i=t.ImArray,a=t.Array8U,s=t.Array32I,l=Math.sqrt,u=t.Util.Array.typed,o=function(t){var e,n=t*t,r=new a(n);for(e=0;n>e;e++)r[e]=1;return r},c=o(3);t.MorphologicalFilter=t.Class(t.Filter,{name:"MorphologicalFilter",constructor:function(){var t=this;t.$super("constructor"),t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null},path:n,_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var t=this;return t.$super("dispose"),t._filterName=null,t._filter=null,t._dim=null,t._structureElement=null,t._indices=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_structureElement:t._structureElement,_indices:t._indices}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._structureElement=u(e._structureElement,a),n._indices=u(e._indices,s),n._filterName=e._filterName,n._filterName&&r[n._filterName]&&(n._filter=r[n._filterName])),n},erode:function(t){return this.set(t,"erode")},dilate:function(t){return this.set(t,"dilate")},opening:function(t){return this.set(t,"open")},closing:function(t){return this.set(t,"close")},set:function(t,e){var n=this;n._filterName=e,n._filter=r[e],t&&t.length?(n._structureElement=new a(t),n._dim=~~(l(n._structureElement.length)+.5)):t&&t===t-0?(n._structureElement=o(t),n._dim=t):(n._structureElement=c,n._dim=3);var i,u,h,_=[],t=n._structureElement,f=t.length,m=n._dim,p=m>>1;for(u=0,h=0,i=0;f>i;)t[i]&&(_.push(u-p),_.push(h-p)),i++,u++,u>=m&&(u=0,h++);return n._indices=new s(_),n},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null,t},_apply:function(t,e,n){var r=this;return r._isOn&&r._dim&&r._filter?r._filter(r,t,e,n):t},canRun:function(){return this._isOn&&this._dim&&this._filter}});r={dilate:function(t,e,n,r){var a,l,u,o,c,h,_,f,m,p,d,v,g,N,b=t._structureElement,w=(b.length,t._dim,new s(t._indices)),A=e.length,E=A>>2,C=new i(A),y=w.length,x=y>>1,L=n-1,R=E-n;for(u=0;y>u;u+=2)w[u+1]*=n;for(o=0,c=0,a=0;A>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=0,g=0,N=0,l=0;x>l;l+=2)h=o+w[l],_=c+w[l+1],h>=0&&L>=h&&_>=0&&R>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],m>v&&(v=m),p>g&&(g=p),d>N&&(N=d));C[a]=v,C[a+1]=g,C[a+2]=N,C[a+3]=e[a+3]}return C},erode:function(t,e,n,r){var a,l,u,o,c,h,_,f,m,p,d,v,g,N,b=t._structureElement,w=(b.length,t._dim,new s(t._indices)),A=e.length,E=A>>2,C=new i(A),y=w.length,x=y>>1,L=n-1,R=E-n;for(u=0;y>u;u+=2)w[u+1]*=n;for(o=0,c=0,a=0;A>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,N=255,l=0;x>l;l+=2)h=o+w[l],_=c+w[l+1],h>=0&&L>=h&&_>=0&&R>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),N>d&&(N=d));C[a]=v,C[a+1]=g,C[a+2]=N,C[a+3]=e[a+3]}return C},open:function(t,e,n,r){var a,l,u,o,c,h,_,f,m,p,d,v,g,N,b=t._structureElement,w=(b.length,t._dim,new s(t._indices)),A=e.length,E=A>>2,C=new i(A),y=w.length,x=y>>1,L=n-1,R=E-n;for(u=0;y>u;u+=2)w[u+1]*=n;for(o=0,c=0,a=0;A>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,N=255,l=0;x>l;l+=2)h=o+w[l],_=c+w[l+1],h>=0&&L>=h&&_>=0&&R>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),N>d&&(N=d));C[a]=v,C[a+1]=g,C[a+2]=N,C[a+3]=e[a+3]}for(e=C,C=new i(A),o=0,c=0,a=0;A>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,N=255,l=0;x>l;l+=2)h=o+w[l],_=c+w[l+1],h>=0&&L>=h&&_>=0&&R>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),N>d&&(N=d));C[a]=v,C[a+1]=g,C[a+2]=N,C[a+3]=e[a+3]}return C},close:function(t,e,n,r){var a,l,u,o,c,h,_,f,m,p,d,v,g,N,b=t._structureElement,w=(b.length,t._dim,new s(t._indices)),A=e.length,E=A>>2,C=new i(A),y=w.length,x=y>>1,L=n-1,R=E-n;for(u=0;y>u;u+=2)w[u+1]*=n;for(o=0,c=0,a=0;A>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,N=255,l=0;x>l;l+=2)h=o+w[l],_=c+w[l+1],h>=0&&L>=h&&_>=0&&R>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),N>d&&(N=d));C[a]=v,C[a+1]=g,C[a+2]=N,C[a+3]=e[a+3]}for(e=C,C=new i(A),o=0,c=0,a=0;A>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,N=255,l=0;x>l;l+=2)h=o+w[l],_=c+w[l+1],h>=0&&L>=h&&_>=0&&R>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),N>d&&(N=d));C[a]=v,C[a+1]=g,C[a+2]=N,C[a+3]=e[a+3]}return C}}}(e),!function(t,e){var r,i=t.ImArray,a=t.Array32I,s=t.Util.Array.typed,l=(Math.min,Math.max,t.StatisticalFilter=t.Class(t.Filter,{name:"StatisticalFilter",constructor:function(){var t=this;t.$super("constructor"),t._dim=0,t._indices=null,t._filterName=null,t._filter=null},path:n,_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var t=this;return t.$super("dispose"),t._dim=null,t._indices=null,t._filter=null,t._filterName=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_indices:t._indices}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._indices=s(e._indices,a),n._filterName=e._filterName,n._filterName&&r[n._filterName]&&(n._filter=r[n._filterName])),n},median:function(t){return this.set(null==t?3:1&t?t:t+1,"median")},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,"minimum")},maximum:function(t){return this.set(null==t?3:1&t?t:t+1,"maximum")},set:function(t,e){var n=this;n._filterName=e,n._filter=r[e],n._dim=t;var i,s,l,u=[],o=t*t,c=t,h=c>>1;for(s=0,l=0,i=0;o>i;)u.push(s-h),u.push(l-h),i++,s++,s>=c&&(s=0,l++);return n._indices=new a(u),n},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._indices=null,t},_apply:function(t,e,n){var r=this;return r._isOn&&r._dim?r._filter(r,t,e,n):t},canRun:function(){return this._isOn&&this._dim}}));l.prototype.erode=l.prototype.minimum,l.prototype.dilate=l.prototype.maximum,r={median:function(t,e,n,r){var s,l,u,o,c,h,_,f,m,p,d,v,g,N,b,w,A,E,C=t._dim,y=C*C,x=new a(t._indices),L=e.length,R=L>>2,M=new i(L),O=y<<1,H=n-1,k=R-n;for(f=[],m=[],p=[],l=0;O>l;l+=2)x[l+1]*=n;for(s=0,u=0,o=0;L>s;){for(f.length=0,m.length=0,p.length=0,l=0;O>l;)c=u+x[l],h=o+x[l+1],c>=0&&H>=c&&h>=0&&k>=h&&(_=c+h<<2,d=e[_],v=e[_+1],g=e[_+2],f.push(d),m.push(v),p.push(g)),l+=2;f.sort(),m.sort(),p.sort(),A=f.length,E=A>>>1,N=1&A?f[E]:~~(.5*f[E-1]+.5*f[E]),b=1&A?m[E]:~~(.5*m[E-1]+.5*m[E]),w=1&A?p[E]:~~(.5*p[E-1]+.5*p[E]),M[s]=N,M[s+1]=b,M[s+2]=w,M[s+3]=e[s+3],s+=4,u++,u>=n&&(u=0,o+=n)}return M},maximum:function(t,e,n,r){var s,l,u,o,c,h,_,f,m,p,d,v,g,N=t._dim,b=N*N,w=new a(t._indices),A=e.length,E=A>>2,C=new i(A),y=b<<1,x=n-1,L=E-n;for(l=0;y>l;l+=2)w[l+1]*=n;for(s=0,u=0,o=0;A>s;){for(d=0,v=0,g=0,l=0;y>l;)c=u+w[l],h=o+w[l+1],c>=0&&x>=c&&h>=0&&L>=h&&(_=c+h<<2,f=e[_],m=e[_+1],p=e[_+2],f>d&&(d=f),m>v&&(v=m),p>g&&(g=p)),l+=2;C[s]=d,C[s+1]=v,C[s+2]=g,C[s+3]=e[s+3],s+=4,u++,u>=n&&(u=0,o+=n)}return C},minimum:function(t,e,n,r){var s,l,u,o,c,h,_,f,m,p,d,v,g,N=t._dim,b=N*N,w=new a(t._indices),A=e.length,E=A>>2,C=new i(A),y=b<<1,x=n-1,L=E-n;for(l=0;y>l;l+=2)w[l+1]*=n;for(s=0,u=0,o=0;A>s;){for(d=255,v=255,g=255,l=0;y>l;)c=u+w[l],h=o+w[l+1],c>=0&&x>=c&&h>=0&&L>=h&&(_=c+h<<2,f=e[_],m=e[_+1],p=e[_+2],d>f&&(d=f),v>m&&(v=m),g>p&&(g=p)),l+=2;C[s]=d,C[s+1]=v,C[s+2]=g,C[s+3]=e[s+3],s+=4,u++,u>=n&&(u=0,o+=n)}return C}}}(e),e});