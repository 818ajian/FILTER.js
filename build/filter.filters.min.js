/**
*
*   FILTER.js Generic Filters
*   @version: 0.9.6
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Generic Filters)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e){"use strict";"object"==typeof module&&module.exports?module.exports=e.call(t,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_FILTERS")?define("FILTER_FILTERS",["module","FILTER"],function(n,i){return e.moduleUri=n.uri,e.call(t,i),i}):(e.call(t,t.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return t.FILTER})}(this,function t(e){"use strict";var n=e.getPath(t.moduleUri);return!function(t,e){var i=(Object.prototype,Function.prototype,Array.prototype),r=i.slice,l=i.splice,a=i.push,s=t.Create({name:"CompositeFilter",init:function(t){var e=this;e.filters=t&&t.length?t:[]},path:n,filters:null,hasInputs:!0,_stable:!0,dispose:function(t){var e,n=this,i=n.filters;if(!0===t)for(e=0;e<i.length;e++)i[e]&&i[e].dispose(t),i[e]=null;return n.filters=null,n.$super("dispose"),n},serializeInputs:function(t){var e,n,i,r=this,l=r.filters,a=[],s=!1;for(e=0,n=l.length;n>e;e++)a.push(i=l[e].serializeInputs(t)),i&&(s=!0);return s?a:null},unserializeInputs:function(t,e){var n=this;if(!t)return n;var i,r,l=n.filters;for(i=0,r=l.length;r>i;i++)t[i]&&l[i].unserializeInputs(t[i],e);return n},serialize:function(){var t,e,n=this,i=n.filters,r=[];for(t=0,e=i.length;e>t;t++)r.push(i[t].serializeFilter());return{_stable:n._stable,filters:r}},unserialize:function(e){var n,i,r,l,a,s=this,o=s.filters;if(s._stable=e._stable,l=e.filters||[],i=l.length,r=o.length,i===r&&s._stable)for(n=0;i>n;n++)o[n].unserializeFilter(l[n]);else{for(n=0;r>n;n++)o[n]&&o[n].dispose(!0),o[n]=null;for(o=[],n=0;i>n;n++){if(a=l[n]&&l[n].filter?t.Filter.get(l[n].filter):null,!a)throw new Error('Filter "'+l[n].filter+'" could not be created');o.push((new a).unserializeFilter(l[n]))}s.filters=o}return s},setMetaData:function(t,e){var n,i,r=this,l=r.filters;if(t&&t.filters&&(i=t.filters.length)&&l.length)for(n=0;i>n;n++)l[t.filters[n][0]].setMetaData(t.filters[n][1],e);return t&&null!=t._IMG_WIDTH&&(r.meta={_IMG_WIDTH:t._IMG_WIDTH,_IMG_HEIGHT:t._IMG_HEIGHT},r.hasMeta=!0),r},stable:function(t){return arguments.length||(t=!0),this._stable=!!t,this},set:function(t){return t&&t.length&&(this.filters=t),this},filter:function(t,e){return arguments.length>1?(this.filters.length>t?this.filters[t]=e:this.filters.push(e),this):this.filters.length>t?this.filters[t]:null},get:null,push:function(){return arguments.length&&a.apply(this.filters,arguments),this},concat:null,pop:function(){return this.filters.pop()},shift:function(){return this.filters.shift()},unshift:function(){return arguments.length&&l.apply(this.filters,a.apply([0,0],arguments)),this},insertAt:function(t){var e=r.call(arguments);e.length;return argslen>1&&(e.shift(),l.apply(this.filters,[t,0].concat(e))),this},removeAt:function(t){return this.filters.splice(t,1)},remove:function(t){for(var e=this.filters.length;--e>=0;)t===this.filters[e]&&this.filters.splice(e,1);return this},reset:function(){return this.filters.length=0,this},empty:null,_apply:function(t,e,n,i){var r,l=this,a=null,s=0,o=null,u=null;if(l.filters.length){i=i||{};var c,f,h=l.filters,m=h.length;for(a=new Array(m),c=0;m>c;c++)f=h[c],f&&f._isOn&&(i.container=l,i.index=c,t=f._apply(t,e,n,i),f.hasMeta&&(a[s++]=[c,r=f.metaData()],null!=r._IMG_WIDTH&&(o=e=r._IMG_WIDTH,u=n=r._IMG_HEIGHT)))}return s>0?(a.length>s&&(a.length=s),l.hasMeta=!0,l.meta={filters:a},null!=o&&(l.meta._IMG_WIDTH=o,l.meta._IMG_HEIGHT=u)):(l.hasMeta=!1,l.meta=null),t},canRun:function(){return this._isOn&&this.filters.length},toString:function(){var t,e="	",n=this.filters,i=[],r=n.length;for(t=0;r>t;t++)i.push(e+n[t].toString().split("\n").join("\n"+e));return["[FILTER: "+this.name+"]","[",i.join("\n"),"]",""].join("\n")}});s.prototype.get=s.prototype.filter,s.prototype.empty=s.prototype.reset,s.prototype.concat=s.prototype.push,t.CompositionFilter=t.CompositeFilter}(e),!function(t,e){var i=Math.min,r=Math.max,l=(Math.floor,t.Array32F),a=t._notSupportClamp;t.Create({name:"AlgebraicFilter",init:function(t){var e=this;e.set(t)},path:n,matrix:null,raw:!1,hasInputs:!0,dispose:function(){var t=this;return t.matrix=null,t.raw=null,t.$super("dispose"),t},serialize:function(){var t=this;return{matrix:t.matrix,raw:t.raw}},unserialize:function(t){var e=this;return e.matrix=t.matrix,e.raw=t.raw,e},fastGradient:function(t){return this},set:function(t){var e=this;return t&&t.length&&(e.matrix=t),e},setInputValues:function(t,n){var i,r=this,l=r.matrix;return n&&(l||(l=r.matrix=[1,0,0,0,0,null,null]),i=7*(t-1),null!=n.a&&(l[i]=+n.a),null!=n.b&&(l[i+1]=+n.b),null!=n.c&&(l[i+2]=+n.c),null!=n.tx&&(l[i+3]=+n.tx),null!=n.ty&&(l[i+4]=+n.ty),e!==n.co&&(l[i+5]=n.co),e!==n.ci&&(l[i+6]=n.ci)),r},reset:function(){var t=this;return t.matrix=null,t},_apply:function(t,e,n){var s=this,o=s.matrix;if(!o||!o.length)return t;var u,c,f,h,m,_,p,d,g,v,C,R,y,I,x,A,w,b,E,F,L,G,T,M,S,Y,N,B,U,O,H,X=o.length,z=t.length,D=z>>>2,V=new l(z);for(f=0,b=e,E=n,w=t,c=0;X>c;c+=7){if(F=i(e,b),L=i(n,E),H=F*L,R=o[c+0],y=o[c+1],I=o[c+2]||0,v=(o[c+3]||0)*(e-1)|0,C=(o[c+4]||0)*(n-1)*e|0,A=o[c+5],x=o[c+6],null!==x&&null!==A)for(d=0,p=C,g=0,u=0;H>u;u++,d++)d>=F&&(d=0,p+=e,g+=b),_=d+v,0>_||_>=e||0>p||p>=D||(h=_+p<<2,m=d+g<<2,V[h+A]=R*V[h+A]+y*w[m+x]+I);else if(null!==x)for(d=0,p=C,g=0,u=0;H>u;u++,d++)d>=F&&(d=0,p+=e,g+=b),_=d+v,0>_||_>=e||0>p||p>=D||(h=_+p<<2,m=d+g<<2,O=y*w[m+x]+I,V[h]=R*V[h]+O,V[h+1]=R*V[h+1]+O,V[h+2]=R*V[h+2]+O,V[h+3]=R*V[h+3]+O);else if(null!==A)for(G=(y>>>16&255)/255,T=(y>>>8&255)/255,M=(255&y)/255,S=(y>>>24&255)/255,Y=I>>>16&255,N=I>>>8&255,B=255&I,U=I>>>24&255,d=0,p=C,g=0,u=0;H>u;u++,d++)d>=F&&(d=0,p+=e,g+=b),_=d+v,0>_||_>=e||0>p||p>=D||(h=_+p<<2,m=d+g<<2,V[h+A]=R*V[h+A]+G*w[m]+Y+T*w[m+1]+N+M*w[m+2]+B+S*w[m+3]+U);else for(d=0,p=C,g=0,u=0;H>u;u++,d++)d>=F&&(d=0,p+=e,g+=b),_=d+v,0>_||_>=e||0>p||p>=D||(h=_+p<<2,m=d+g<<2,V[h]=R*V[h]+y*w[m]+I,V[h+1]=R*V[h+1]+y*w[m+1]+I,V[h+2]=R*V[h+2]+y*w[m+2]+I,V[h+3]=R*V[h+3]+y*w[m+3]+I);w=s.input(++f),b=w[1],E=w[2],w=w[0]}if(a)for(u=0;z>u;u+=4)t[u]=i(255,r(0,0|V[u])),t[u+1]=i(255,r(0,0|V[u+1])),t[u+2]=i(255,r(0,0|V[u+2])),t[u+3]=i(255,r(0,0|V[u+3]));else for(u=0;z>u;u+=4)t[u]=0|V[u],t[u+1]=0|V[u+1],t[u+2]=0|V[u+2],t[u+3]=0|V[u+3];return t}})}(e),!function(t,e){var i="hasOwnProperty",r=t.ImArray,l=(t.ImArrayCopy,Math.min),a=Math.round,s=t.Util.Array.hasArrayset,o=t.Util.Array.arrayset,u=t._notSupportClamp;t.Create({name:"BlendFilter",init:function(t){var e=this;e.set(t)},path:n,matrix:null,hasInputs:!0,dispose:function(){var t=this;return t.matrix=null,t.$super("dispose"),t},serialize:function(){var t=this;return{matrix:t.matrix}},unserialize:function(t){var e=this;return e.matrix=t.matrix,e},set:function(t){var e=this;return t&&t.length&&(e.matrix=t),e},setInputValues:function(t,n){var i,r=this,l=r.matrix;return n&&(l||(l=r.matrix=["normal",0,0,1,1]),i=t-1<<2,e!==n.mode&&(l[i]=n.mode||"normal"),null!=n.startX&&(l[i+1]=+n.startX),null!=n.startY&&(l[i+2]=+n.startY),null!=n.alpha&&(l[i+3]=+n.alpha),null!=n.enabled&&(l[i+4]=!!n.enabled)),r},reset:function(){var t=this;return t.matrix=null,t.resetInputs(),t},_apply:function(e,n,c){var f=this,h=f.matrix;if(!h||!h.length)return e;var m,_,p,d,g,v,C,R,y,I,x,A,w,b,E,F,L,G,T,M,S,Y,N,B,U,O=h.length,H=e.length,X=t.Color.Blend;for(U=new r(H),s?U.set(e):o(U,e),m=0,_=1;O>m;m+=5,_++)if(h[m+4]&&(d=h[m+3]||0,0!==d&&(B=h[m]||"normal",N=X[i](B)?X[B]:null,N&&(p=f.input(_),p&&(x=p[0],A=p[1],w=p[2],g=h[m+1]||0,v=h[m+2]||0,C=0,R=0,0>g&&(C=-g,g=0),0>v&&(R=-v,v=0),!(g>=n||v>=c||C>=A||R>=w||(g=a(g),v=a(v),C=a(C),R=a(R),y=l(n-g,A-C),I=l(c-v,w-R),0>=y||0>=I)))))))for(G=g,T=v*n,M=C,S=R*A,b=g+y,E=C+y,F=0,L=I*y;L>F;F++)Y=M+S<<2,0<x[Y+3]&&N(U,x,G+T<<2,Y,d,u),++G>=b&&(G=g,T+=n),++M>=E&&(M=C,S+=A);return U}}),t.CombineFilter=t.BlendFilter}(e),!function(t,e){var i=t.CHANNEL,r=t.ColorTable,l=t.Color.clampPixel,a=(Math.floor,Math.pow),s=Math.exp,o=1/255,u=t.Util.Array.typed,c=t.Create({name:"ColorTableFilter",init:function(t,e,n,r){var l=this;l.table=[null,null,null,null],t=t||null,e=e||t,n=n||e,r=r||null,l.table[i.R]=t,l.table[i.G]=e,l.table[i.B]=n,l.table[i.A]=r},path:n,table:null,dispose:function(){var t=this;return t.table=null,t.$super("dispose"),t},serialize:function(){var t=this;return{tableR:t.table[i.R],tableG:t.table[i.G],tableB:t.table[i.B],tableA:t.table[i.A]}},unserialize:function(t){var e=this;return e.table[i.R]=u(t.tableR,r),e.table[i.G]=u(t.tableG,r),e.table[i.B]=u(t.tableB,r),e.table[i.A]=u(t.tableA,r),e},functional:function(e,n,i){if("function"!=typeof e)return this;var r=t.Util.Filter.ct_eye,l=r(e),a=n?r(n):l,s=i?r(i):a;return this.set(l,a,s)},channel:function(e){if(null==e)return this;var n,r,l,a=t.Util.Filter.ct_eye;switch(e||i.R){case i.B:n=a(0,0),r=a(0,0),l=a();break;case i.G:n=a(0,0),r=a(),l=a(0,0);break;case i.R:default:n=a(),r=a(0,0),l=a(0,0)}return this.set(n,r,l)},redChannel:function(){return this.channel(i.R)},greenChannel:function(){return this.channel(i.G)},blueChannel:function(){return this.channel(i.B)},channelInvert:function(e){if(null==e)return this;var n,r,l,a=t.Util.Filter.ct_eye;switch(e||i.R){case i.B:n=a(),r=a(),l=a(-1,255);break;case i.G:n=a(),r=a(-1,255),l=a();break;case i.R:default:n=a(-1,255),r=a(),l=a()}return this.set(n,r,l)},redInvert:function(){return this.channelInvert(i.R)},greenInvert:function(){return this.channelInvert(i.G)},blueInvert:function(){return this.channelInvert(i.B)},invert:function(){return this.set(t.Util.Filter.ct_eye(-1,255))},thresholds:function(t,e,n){t.length||(t=[t]),e||(e=t),n||(n=e);var i,a,s=t.length,o=s+1,u=e.length,c=u+1,f=n.length,h=f+1,m=new r(256),_=new r(o),p=new r(256),d=new r(c),g=new r(256),v=new r(h),C=255/(o-1),R=255/(c-1),y=255/(h-1);for(i=0;o>i;i++)_[i]=C*i|0;for(t[0]=255*t[0]|0,i=1;s>i;i++)t[i]=t[i-1]+255*t[i]|0;for(i=0;c>i;i++)d[i]=R*i|0;for(e[0]=255*e[0]|0,i=1;u>i;i++)e[i]=e[i-1]+255*e[i]|0;for(i=0;h>i;i++)v[i]=y*i|0;for(n[0]=255*n[0]|0,i=1;f>i;i++)n[i]=n[i-1]+255*n[i]|0;for(i=0;256>i;i++){for(a=0;s>a&&i>t[a];)a++;for(m[i]=l(_[a]),a=0;u>a&&i>e[a];)a++;for(p[i]=l(d[a]),a=0;f>a&&i>n[a];)a++;g[i]=l(v[a])}return this.set(m,p,g)},threshold:function(t,e,n){return t=null==t?.5:t,e=null==e?t:e,n=null==n?e:n,this.thresholds([t],[e],[n])},quantize:function(e){null==e&&(e=64),2>e&&(e=2);var n,i=new r(e),a=255/(e-1),s=e/256;for(n=0;e>n;n++)i[n]=0|l(a*n);return this.set(t.Util.Filter.ct_eye(function(t){return i[s*t|0]}))},posterize:null,binarize:function(){return this.quantize(2)},solarize:function(e,n){null==n&&(n=1),null==e&&(e=.5);var i;return-1===n?(e*=256,i=function(t){return t>e?255-t:t}):2===n?(e=1-e,i=function(t){var n=2*t/255;return e>n?255-255*n:255*n-255}):i=function(t){var n=2*t/255;return n>e?255-255*n:255*n-255},this.set(t.Util.Filter.ct_eye(i))},solarize2:function(t){return this.solarize(t,2)},solarizeInverse:function(t){return this.solarize(t,-1)},mask:function(e){var n=t.Util.Filter.ct_eye,i=e>>>16&255,r=e>>>8&255,l=255&e;return this.set(n(function(t){return t&i}),n(function(t){return t&r}),n(function(t){return t&l}))},replace:function(e,n){if(e==n)return this;var i=t.Util.Filter.ct_eye,r=i(),l=i(),a=i();return r[e>>>16&255]=n>>>16&255,l[e>>>8&255]=n>>>8&255,a[255&e]=255&n,this.set(r,l,a)},extract:function(e,n,r){if(!n||!n.length)return this;r=r||0;var a,s,o=t.Util.Filter.ct_eye,u=o(0,r>>>16&255),c=o(0,r>>>8&255),f=o(0,255&r);switch(e||i.R){case i.B:for(a=n[0],s=n[1];s>=a;a++)f[a]=l(a);break;case i.G:for(a=n[0],s=n[1];s>=a;a++)c[a]=l(a);break;case i.R:default:for(a=n[0],s=n[1];s>=a;a++)u[a]=l(a)}return this.set(u,c,f)},gammaCorrection:function(e,n,i){e=e||1,n=n||e,i=i||n,e=1/e,n=1/n,i=1/i;var r=t.Util.Filter.ct_eye;return this.set(r(function(t){return 255*a(o*t,e)}),r(function(t){return 255*a(o*t,n)}),r(function(t){return 255*a(o*t,i)}))},exposure:function(e){return null==e&&(e=1),this.set(t.Util.Filter.ct_eye(function(t){return 255*(1-s(-e*t*o))}))},contrast:function(e,n,i){null==n&&(n=e),null==i&&(i=e),e+=1,n+=1,i+=1;var r=t.Util.Filter.ct_eye;return this.set(r(e,128*(1-e)),r(n,128*(1-n)),r(i,128*(1-i)))},brightness:function(e,n,i){null==n&&(n=e),null==i&&(i=e);var r=t.Util.Filter.ct_eye;return this.set(r(1,e),r(1,n),r(1,i))},quickContrastCorrection:function(e){return this.set(t.Util.Filter.ct_eye(null==e?1.2:+e))},set:function(e,n,r,l){if(!e)return this;var a,s,o=t.Util.Filter.ct_eye,u=t.Util.Filter.ct_multiply,c=this.table,f=c[i.R]||o();return n||r?(n=n||e,r=r||n,a=c[i.G]||f,s=c[i.B]||a,c[i.R]=u(e,f),c[i.G]=u(n,a),c[i.B]=u(r,s)):(c[i.R]=u(e,f),c[i.G]=c[i.R],c[i.B]=c[i.R]),this},reset:function(){return this.table=[null,null,null,null],this},combineWith:function(t){return this.set(t.getTable(i.R),t.getTable(i.G),t.getTable(i.B))},getTable:function(t){return this.table[t||i.R]||null},setTable:function(t,e){return this.table[e||i.R]=t||null,this},_apply:function(t,e,n){var r=this,l=r.table;if(!l||!l[i.R])return t;var a,s,o=t.length,u=o>>>2,c=(15&u)<<2,f=l[0],h=l[1],m=l[2],_=l[3];if(_){for(a=0;c>a;a+=4)t[a]=f[t[a]],t[a+1]=h[t[a+1]],t[a+2]=m[t[a+2]],t[a+3]=_[t[a+3]];for(s=c;o>s;s+=64)a=s,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]]}else{for(a=0;c>a;a+=4)t[a]=f[t[a]],t[a+1]=h[t[a+1]],t[a+2]=m[t[a+2]];for(s=c;o>s;s+=64)a=s,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a}return t},canRun:function(){return this._isOn&&this.table&&this.table[i.R]}});c.prototype.posterize=c.prototype.levels=c.prototype.quantize,t.TableLookupFilter=t.ColorTableFilter}(e),!function(t,e){var i=t.CHANNEL,r=t.ColorMatrix,l=t.Array8U,a=Math.sin,s=Math.cos,o=t.CONST.toRad,u=(t.CONST.toDeg,t.Util.Array.typed),c=t._notSupportClamp,f=t.Create({name:"ColorMatrixFilter",init:function(t){var e=this;e.matrix=t&&t.length?new r(t):null},path:n,matrix:null,dispose:function(){var t=this;return t.matrix=null,t.$super("dispose"),t},serialize:function(){var t=this;return{matrix:t.matrix}},unserialize:function(t){var e=this;return e.matrix=u(t.matrix,r),e},channel:function(t,e){t=t||0;var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],r=i.A===t||e?1:0;return n[5*i.R+t]=i.R===t?1:r,n[5*i.G+t]=i.G===t?1:r,n[5*i.B+t]=i.B===t?1:r,this.set(n)},redChannel:function(t){return this.channel(i.R,t)},greenChannel:function(t){return this.channel(i.G,t)},blueChannel:function(t){return this.channel(i.B,t)},alphaChannel:function(t){return this.channel(i.A,!0)},maskChannel:function(t){if(t=t||0,i.A===t)return this;var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return e[5*t+t]=0,this.set(e)},swapChannels:function(t,e){if(t===e)return this;var n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return n[5*t+t]=0,n[5*e+e]=0,n[5*t+e]=1,n[5*e+t]=1,this.set(n)},invertChannel:function(t){if(t=t||0,i.A===t)return this;var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return e[5*t+t]=-1,e[5*t+4]=255,this.set(e)},invertRed:function(){return this.invertChannel(i.R)},invertGreen:function(){return this.invertChannel(i.G)},invertBlue:function(){return this.invertChannel(i.B)},invertAlpha:function(){return this.invertChannel(i.A)},invert:function(){return this.set(t.Util.Filter.cm_rechannel([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},desaturate:function(e){var n=e||t.LUMA;return this.set(t.Util.Filter.cm_rechannel([n[0],n[1],n[2],0,0,n[0],n[1],n[2],0,0,n[0],n[1],n[2],0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},grayscale:null,saturate:function(e,n){var r,l,a,s,o=n||t.LUMA;return r=1-e,l=r*o[0],a=r*o[1],s=r*o[2],this.set(t.Util.Filter.cm_rechannel([l+e,a,s,0,0,l,a+e,s,0,0,l,a,s+e,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},colorize:function(e,n,r){var l,a,s,o,u=r||t.LUMA;return null==n&&(n=1),l=(e>>16&255)/255,a=(e>>8&255)/255,s=(255&e)/255,o=1-n,this.set(t.Util.Filter.cm_rechannel([o+n*l*u[0],n*l*u[1],n*l*u[2],0,0,n*a*u[0],o+n*a*u[1],n*a*u[2],0,0,n*s*u[0],n*s*u[1],o+n*s*u[2],0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},contrast:function(e,n,r){return null==n&&(n=e),null==r&&(r=e),e+=1,n+=1,r+=1,this.set(t.Util.Filter.cm_rechannel([e,0,0,0,128*(1-e),0,n,0,0,128*(1-n),0,0,r,0,128*(1-r),0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},brightness:function(e,n,r){return null==n&&(n=e),null==r&&(r=e),this.set(t.Util.Filter.cm_rechannel([1,0,0,0,e,0,1,0,0,n,0,0,1,0,r,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},adjustHue:function(e,n){e*=o;var r=s(e),l=a(e),u=n||t.LUMA;return this.set(t.Util.Filter.cm_rechannel([u[0]+r*(1-u[0])+l*-u[0],u[1]+r*-u[1]+l*-u[1],u[2]+r*-u[2]+l*(1-u[2]),0,0,u[0]+r*-u[0]+.143*l,u[1]+r*(1-u[1])+.14*l,u[2]+r*-u[2]+l*-.283,0,0,u[0]+r*-u[0]+l*-(1-u[0]),u[1]+r*-u[1]+l*u[1],u[2]+r*(1-u[2])+l*u[2],0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},rotateHue:null,average:function(e,n,r){return null==e&&(e=.3333),null==n&&(n=.3333),null==r&&(r=.3333),this.set(t.Util.Filter.cm_rechannel([e,n,r,0,0,e,n,r,0,0,e,n,r,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},quickContrastCorrection:function(e){return null==e&&(e=1.2),this.set(t.Util.Filter.cm_rechannel([e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},sepia:function(e){return null==e&&(e=.5),e>1?e=1:0>e&&(e=0),this.set(t.Util.Filter.cm_rechannel([1-.607*e,.769*e,.189*e,0,0,.349*e,1-.314*e,.168*e,0,0,.272*e,.534*e,1-.869*e,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},sepia2:function(e,n){null==e&&(e=10),e>100&&(e=100),e*=2.55;var r=n||t.LUMA;return this.set(t.Util.Filter.cm_rechannel([r[0],r[1],r[2],0,40,r[0],r[1],r[2],0,20,r[0],r[1],r[2],0,-e,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},threshold:function(e,n,r){null==n&&(n=256);var l=r||t.LUMA;return this.set(t.Util.Filter.cm_rechannel(!1!==r?[l[0]*n,l[1]*n,l[2]*n,0,-(n-1)*e,l[0]*n,l[1]*n,l[2]*n,0,-(n-1)*e,l[0]*n,l[1]*n,l[2]*n,0,-(n-1)*e,0,0,0,1,0]:[n,0,0,0,-(n-1)*e,0,n,0,0,-(n-1)*e,0,0,n,0,-(n-1)*e,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},thresholdRGB:function(t,e){return this.threshold(t,e,!1)},threshold_rgb:null,thresholdChannel:function(e,n,r,l){null==r&&(r=256);var a=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],s=l||t.LUMA;return i.A===e?(a[5*e+e]=r,a[5*e+4]=-r*n):!1!==l?(a[5*e+i.R]=s[0]*r,a[5*e+i.G]=s[1]*r,a[5*e+i.B]=s[2]*r,a[5*e+4]=-(r-1)*n):(a[5*e+i.R]=r,a[5*e+i.G]=r,a[5*e+i.B]=r,a[5*e+4]=-(r-1)*n),this.set(a)},thresholdRed:function(t,e,n){return this.thresholdChannel(i.R,t,e,n)},thresholdGreen:function(t,e,n){return this.thresholdChannel(i.G,t,e,n)},thresholdBlue:function(t,e,n){return this.thresholdChannel(i.B,t,e,n)},thresholdAlpha:function(t,e,n){return this.thresholdChannel(i.A,t,e,n)},threshold_alpha:null,RGB2YCbCr:function(){return this.set(t.Util.Filter.cm_rechannel([.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,.5,-.418688,-.081312,0,128,0,0,0,1,0],i.R,i.G,i.B,i.A,i.Y,i.CB,i.CR,i.A))},YCbCr2RGB:function(){return this.set(t.Util.Filter.cm_rechannel([1,0,1.402,0,-179.456,1,-.34414,-.71414,0,135.45984,1,1.772,0,0,-226.816,0,0,0,1,0],i.Y,i.CB,i.CR,i.A,i.R,i.G,i.B,i.A))},RGB2YIQ:function(){return this.set(t.Util.Filter.cm_rechannel([.299,.587,.114,0,0,.701,-.587,-.114,0,0,-.299,-.587,.886,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.Y,i.IP,i.Q,i.A))},YIQ2RGB:function(){return this.set(t.Util.Filter.cm_rechannel([1,1,0,0,0,1,-.509,-.194,0,0,1,0,1,0,0,0,0,0,1,0],i.Y,i.IP,i.Q,i.A,i.R,i.G,i.B,i.A))},blend:function(e,n){var i=this;return i.matrix=i.matrix?t.Util.Filter.cm_combine(i.matrix,e.matrix,1-n,n,r):new r(e.matrix),i},set:function(e){var n=this;return n.matrix=n.matrix?t.Util.Filter.cm_multiply(n.matrix,e):new r(e),n},reset:function(){return this.matrix=null,this},combineWith:function(t){return this.set(t.matrix)},_apply:c?function(t,e,n){var i=this,a=i.matrix;if(!a)return t;var s,o=t.length,u=o>>>2,c=(7&u)<<2,f=new r(32),h=new l(4),m=new r(4);for(s=0;c>s;s+=4)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],m[0]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],m[1]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],m[2]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],m[3]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],m[0]=m[0]<0?0:m[0]>255?255:m[0],m[1]=m[1]<0?0:m[1]>255?255:m[1],m[2]=m[2]<0?0:m[2]>255?255:m[2],m[3]=m[3]<0?0:m[3]>255?255:m[3],t[s]=0|m[0],t[s+1]=0|m[1],t[s+2]=0|m[2],t[s+3]=0|m[3];for(s=c;o>s;s+=32)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],f[0]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[1]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[2]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[3]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+4],h[1]=t[s+5],h[2]=t[s+6],h[3]=t[s+7],f[4]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[5]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[6]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[7]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+8],h[1]=t[s+9],h[2]=t[s+10],h[3]=t[s+11],f[8]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[9]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[10]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[11]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+12],h[1]=t[s+13],h[2]=t[s+14],h[3]=t[s+15],f[12]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[13]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[14]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[15]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+16],h[1]=t[s+17],h[2]=t[s+18],h[3]=t[s+19],f[16]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[17]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[18]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[19]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+20],h[1]=t[s+21],h[2]=t[s+22],h[3]=t[s+23],f[20]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[21]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[22]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[23]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+24],h[1]=t[s+25],h[2]=t[s+26],h[3]=t[s+27],f[24]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[25]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[26]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[27]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+28],h[1]=t[s+29],h[2]=t[s+30],h[3]=t[s+31],f[28]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[29]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[30]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[31]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],f[0]=f[0]<0?0:f[0]>255?255:f[0],f[1]=f[1]<0?0:f[1]>255?255:f[1],f[2]=f[2]<0?0:f[2]>255?255:f[2],f[3]=f[3]<0?0:f[3]>255?255:f[3],f[4]=f[4]<0?0:f[4]>255?255:f[4],f[5]=f[5]<0?0:f[5]>255?255:f[5],f[6]=f[6]<0?0:f[6]>255?255:f[6],f[7]=f[7]<0?0:f[7]>255?255:f[7],f[8]=f[8]<0?0:f[8]>255?255:f[8],f[9]=f[9]<0?0:f[9]>255?255:f[9],f[10]=f[10]<0?0:f[10]>255?255:f[10],f[11]=f[11]<0?0:f[11]>255?255:f[11],f[12]=f[12]<0?0:f[12]>255?255:f[12],f[13]=f[13]<0?0:f[13]>255?255:f[13],f[14]=f[14]<0?0:f[14]>255?255:f[14],f[15]=f[15]<0?0:f[15]>255?255:f[15],f[16]=f[16]<0?0:f[16]>255?255:f[16],f[17]=f[17]<0?0:f[17]>255?255:f[17],f[18]=f[18]<0?0:f[18]>255?255:f[18],f[19]=f[19]<0?0:f[19]>255?255:f[19],f[20]=f[20]<0?0:f[20]>255?255:f[20],f[21]=f[21]<0?0:f[21]>255?255:f[21],f[22]=f[22]<0?0:f[22]>255?255:f[22],f[23]=f[23]<0?0:f[23]>255?255:f[23],f[24]=f[24]<0?0:f[24]>255?255:f[24],f[25]=f[25]<0?0:f[25]>255?255:f[25],f[26]=f[26]<0?0:f[26]>255?255:f[26],f[27]=f[27]<0?0:f[27]>255?255:f[27],f[28]=f[28]<0?0:f[28]>255?255:f[28],f[29]=f[29]<0?0:f[29]>255?255:f[29],f[30]=f[30]<0?0:f[30]>255?255:f[30],f[31]=f[31]<0?0:f[31]>255?255:f[31],t[s]=0|f[0],t[s+1]=0|f[1],t[s+2]=0|f[2],t[s+3]=0|f[3],t[s+4]=0|f[4],t[s+5]=0|f[5],t[s+6]=0|f[6],t[s+7]=0|f[7],t[s+8]=0|f[8],t[s+9]=0|f[9],t[s+10]=0|f[10],t[s+11]=0|f[11],t[s+12]=0|f[12],t[s+13]=0|f[13],t[s+14]=0|f[14],t[s+15]=0|f[15],t[s+16]=0|f[16],t[s+17]=0|f[17],t[s+18]=0|f[18],t[s+19]=0|f[19],t[s+20]=0|f[20],t[s+21]=0|f[21],t[s+22]=0|f[22],t[s+23]=0|f[23],t[s+24]=0|f[24],t[s+25]=0|f[25],t[s+26]=0|f[26],t[s+27]=0|f[27],t[s+28]=0|f[28],t[s+29]=0|f[29],t[s+30]=0|f[30],t[s+31]=0|f[31];return t}:function(t,e,n){var i=this,a=i.matrix;if(!a)return t;var s,o=t.length,u=o>>>2,c=(7&u)<<2,f=new r(32),h=new l(4),m=new r(4);for(s=0;c>s;s+=4)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],m[0]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],m[1]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],m[2]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],m[3]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],t[s]=0|m[0],t[s+1]=0|m[1],t[s+2]=0|m[2],t[s+3]=0|m[3];for(s=c;o>s;s+=32)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],f[0]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[1]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[2]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[3]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+4],h[1]=t[s+5],h[2]=t[s+6],h[3]=t[s+7],f[4]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[5]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[6]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[7]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+8],h[1]=t[s+9],h[2]=t[s+10],h[3]=t[s+11],f[8]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[9]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[10]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[11]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+12],h[1]=t[s+13],h[2]=t[s+14],h[3]=t[s+15],f[12]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[13]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[14]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[15]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+16],h[1]=t[s+17],h[2]=t[s+18],h[3]=t[s+19],f[16]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[17]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[18]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[19]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+20],h[1]=t[s+21],h[2]=t[s+22],h[3]=t[s+23],f[20]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[21]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[22]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[23]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+24],h[1]=t[s+25],h[2]=t[s+26],h[3]=t[s+27],f[24]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[25]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[26]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[27]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+28],h[1]=t[s+29],h[2]=t[s+30],h[3]=t[s+31],f[28]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[29]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[30]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[31]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],t[s]=0|f[0],t[s+1]=0|f[1],t[s+2]=0|f[2],t[s+3]=0|f[3],t[s+4]=0|f[4],t[s+5]=0|f[5],t[s+6]=0|f[6],t[s+7]=0|f[7],t[s+8]=0|f[8],t[s+9]=0|f[9],t[s+10]=0|f[10],t[s+11]=0|f[11],t[s+12]=0|f[12],t[s+13]=0|f[13],t[s+14]=0|f[14],t[s+15]=0|f[15],t[s+16]=0|f[16],t[s+17]=0|f[17],t[s+18]=0|f[18],t[s+19]=0|f[19],t[s+20]=0|f[20],t[s+21]=0|f[21],t[s+22]=0|f[22],t[s+23]=0|f[23],t[s+24]=0|f[24],t[s+25]=0|f[25],t[s+26]=0|f[26],t[s+27]=0|f[27],t[s+28]=0|f[28],t[s+29]=0|f[29],t[s+30]=0|f[30],t[s+31]=0|f[31];return t},canRun:function(){return this._isOn&&this.matrix}});f.prototype.grayscale=f.prototype.desaturate,f.prototype.rotateHue=f.prototype.adjustHue,f.prototype.threshold_rgb=f.prototype.thresholdRGB,f.prototype.threshold_alpha=f.prototype.thresholdAlpha}(e),!function(t,e){function i(e,n){var i=n?o(n):"",r=o(e),l=s?"c[0] = 0>c[0] ? 0 : (255<c[0] ? 255: c[0]); c[1] = 0>c[1] ? 0 : (255<c[1] ? 255: c[1]); c[2] = 0>c[2] ? 0 : (255<c[2] ? 255: c[2]); c[3] = 0>c[3] ? 0 : (255<c[3] ? 255: c[3]);":"";return new Function("FILTER",'"use strict"; return function( im, w, h ){    var self = this;    if ( !self._map ) return im;    var x, y, i, i0, imLen = im.length, imArea = imLen>>>2, rem = (imArea&7)<<2, c = new FILTER.ColorMatrix(4);    '+i+";        x=0;y=0;    for(i=0; i<rem; i+=4)    {        c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+r+";        "+l+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;        if (++x>=w) {x=0; y++;}    }    for(i0=rem; i0<imLen; i0+=32)    {        i=i0; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+r+";        "+l+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; y++;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+r+";        "+l+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; y++;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+r+";        "+l+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; y++;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+r+";        "+l+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; y++;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+r+";        "+l+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; y++;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+r+";        "+l+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; y++;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+r+";        "+l+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; y++;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+r+";        "+l+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; y++;}    }    return im;};")(t)}var r,l=(t.CHANNEL,t.MODE),a=(t.Color,t.ColorMatrix,t.Util.Array.typed),s=t._notSupportClamp,o=t.Util.String.function_body,u=t.Create({name:"ColorMapFilter",init:function(t,e){var n=this;t&&n.set(t,e)},path:n,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,thresholds:null,quantizedColors:null,mode:l.COLOR,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.thresholds=null,t.quantizedColors=null,t.$super("dispose"),t},serialize:function(){var t,e=this;return t={_mapName:e._mapName||null,_map:"generic"===e._mapName&&e._map&&e._mapChanged?e._map.toString():null,_mapInit:"generic"===e._mapName&&e._mapInit&&e._mapChanged?e._mapInit.toString():null,thresholds:e.thresholds,quantizedColors:e.quantizedColors
},e._mapChanged=!1,t},unserialize:function(t){var e=this;return e.thresholds=a(t.thresholds,Array),e.quantizedColors=a(t.quantizedColors,Array),!t._map&&t._mapName&&r.hasOwnProperty(t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},RGB2HSV:function(){return this.set("rgb2hsv")},HSV2RGB:function(){return this.set("hsv2rgb")},RGB2CMYK:function(){return this.set("rgb2cmyk")},hue:function(){return this.set("hue")},saturation:function(){return this.set("saturation")},quantize:function(t,e){var n=this;return n.thresholds=t,n.quantizedColors=e,n.set("quantize")},threshold:null,mask:function(t,e,n){var i=this;return i.thresholds=[t,e],i.quantizedColors=[n||0],i.set("mask")},extract:null,set:function(t,e){var n=this;return t&&r.hasOwnProperty(String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=r[n._mapName],n._mapInit=r["init__"+n._mapName],n._apply=i(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=T,n._mapInit=e||null,n._apply=i(n._map,n._mapInit),n._mapChanged=!0),n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t},canRun:function(){return this._isOn&&this._map}});u.prototype.threshold=u.prototype.quantize,u.prototype.extract=u.prototype.mask,r={rgb2hsv:"function( ){        if ( 0 !== c[3] )        {            RGB2HSV(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CV] = C2;        }    }",init__rgb2hsv:"function( ){        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, RGB2HSV = FILTER.Color.RGB2HSV;    }",hsv2rgb:"function( ){        if ( 0 !== c[3] )        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CV];            c[0] = C0; c[1] = C1; c[2] = C2;            HSV2RGB(c, 0);        }    }",init__hsv2rgb:"function( ){        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, HSV2RGB = FILTER.Color.HSV2RGB;    }",rgb2cmyk:"function( ){        if ( 0 !== c[3] )        {            RGB2CMYK(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CY] = C0; c[MA] = C1; c[YE] = C2;        }    }",init__rgb2cmyk:"function( ){        var C0, C1, C2, CY = FILTER.CHANNEL.CY, MA = FILTER.CHANNEL.MA, YE = FILTER.CHANNEL.YE, RGB2CMYK = FILTER.Color.RGB2CMYK;    }",hue:"function( ){        if ( 0 !== c[3] )        {            HHH = HUE(c[0], c[1], c[2])*0.70833333333333333333333333333333;            c[0] = HHH; c[1] = HHH; c[2] = HHH;        }    }",init__hue:"function( ){        var HUE = FILTER.Color.hue, HHH;    }",saturation:"function( ){        if ( 0 !== c[3] )        {            SSS = SATURATION(c[0], c[1], c[2]);            c[0] = SSS; c[1] = SSS; c[2] = SSS;        }    }",init__saturation:"function( ){        var SATURATION = FILTER.Color.saturation, SSS;    }",quantize:"function( ){        if ( 0 !== c[3] )        {            J = 0; V = VALUE(c[0], c[1], c[2]);            while (J<THRESH_LEN && V>THRESH[J]) J++;            COLVAL = J < COLORS_LEN ? COLORS[j] : 0xffffff;            c[0] = (COLVAL >>> 16) & 255; c[1] = (COLVAL >>> 8) & 255; c[2] = COLVAL & 255;        }    }",init__quantize:"function( ){        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            THRESH = self.thresholds, THRESH_LEN = THRESH.length,            COLORS = self.quantizedColors, COLORS_LEN = COLORS.length, J, COLVAL, V;    }",mask:"function( ){        if ( 0 !== c[3] )        {            V = VALUE(c[0], c[1], c[2]);            if ( (V < MIN_VALUE) || (V > MAX_VALUE) )            {                c[0] = COLVAL[0];                c[1] = COLVAL[1];                c[2] = COLVAL[2];                c[3] = COLVAL[3];            }        }    }",init__mask:"function( ){        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            MIN_VALUE = self.thresholds[0], MAX_VALUE = self.thresholds[self.thresholds.length-1],            COLVAL = [(self.quantizedColors[0] >>> 16) & 255, (self.quantizedColors[0] >>> 8) & 255, self.quantizedColors[0] & 255, (self.quantizedColors[0] >>> 24) & 255], V;    }"}}(e),!function(t,e){var i=t.ImArray,r=t.AffineMatrix,l=t.Util.Array.typed,a=t.MODE,s=(t.CONST.toRad,Math.sin),o=Math.cos,u=Math.tan,c=t.Create({name:"AffineMatrixFilter",init:function(t){var e=this;e.matrix=t&&t.length?new r(t):null},path:n,matrix:null,mode:a.CLAMP,color:0,dispose:function(){var t=this;return t.matrix=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{matrix:t.matrix,color:t.color}},unserialize:function(t){var e=this;return e.matrix=l(t.matrix,r),e.color=t.color,e},flipX:function(){return this.set([-1,0,0,1,0,1,0,0])},flipY:function(){return this.set([1,0,0,0,0,-1,0,1])},flipXY:function(){return this.set([-1,0,0,1,0,-1,0,1])},translate:function(t,e,n){return this.set(n?[1,0,0,t,0,1,0,e]:[1,0,t,0,0,1,e,0])},shift:null,rotate:function(t){var e=s(t),n=o(t);return this.set([n,-e,0,0,e,n,0,0])},scale:function(t,e){return this.set([t,0,0,0,0,e,0,0])},skew:function(t,e){return this.set([1,t?u(t):0,0,0,e?u(e):0,1,0,0])},set:function(e){var n=this;return n.matrix=n.matrix?t.Util.Filter.am_multiply(n.matrix,e):new r(e),n},reset:function(){return this.matrix=null,this},combineWith:function(t){return this.set(t.matrix)},_apply:function(t,e,n){var r=this,l=r.matrix;if(!l)return t;var s,o,u,c,f,h,m,_,p,d,g,v=t.length,C=v>>>2,R=e-1,y=C-e,I=new i(v),x=r.color||0,A=a.COLOR,w=(a.CLAMP,a.WRAP),b=a.IGNORE,E=l[0],F=l[1],L=l[2]+l[3]*R,G=l[4]*e,T=l[5],M=l[6]*e+l[7]*y,S=r.mode||b;if(A===S)for(g=x>>>24&255,_=x>>>16&255,p=x>>>8&255,d=255&x,s=0,o=0,u=0,h=0;v>h;h+=4,s++)s>=e&&(s=0,o++,u+=e),c=E*s+F*o+L,f=G*s+T*u+M,0>c||c>R||0>f||f>y?(I[h]=_,I[h+1]=p,I[h+2]=d,I[h+3]=g):(m=(0|c)+(0|f)<<2,I[h]=t[m],I[h+1]=t[m+1],I[h+2]=t[m+2],I[h+3]=t[m+3]);else if(b===S)for(s=0,o=0,u=0,h=0;v>h;h+=4,s++)s>=e&&(s=0,o++,u+=e),c=E*s+F*o+L,f=G*s+T*u+M,f=f>y||0>f?u:f,c=c>R||0>c?s:c,m=(0|c)+(0|f)<<2,I[h]=t[m],I[h+1]=t[m+1],I[h+2]=t[m+2],I[h+3]=t[m+3];else if(w===S)for(s=0,o=0,u=0,h=0;v>h;h+=4,s++)s>=e&&(s=0,o++,u+=e),c=E*s+F*o+L,f=G*s+T*u+M,f=f>y?f-C:0>f?f+C:f,c=c>R?c-e:0>c?c+e:c,m=(0|c)+(0|f)<<2,I[h]=t[m],I[h+1]=t[m+1],I[h+2]=t[m+2],I[h+3]=t[m+3];else for(s=0,o=0,u=0,h=0;v>h;h+=4,s++)s>=e&&(s=0,o++,u+=e),c=E*s+F*o+L,f=G*s+T*u+M,f=f>y?y:0>f?0:f,c=c>R?R:0>c?0:c,m=(0|c)+(0|f)<<2,I[h]=t[m],I[h+1]=t[m+1],I[h+2]=t[m+2],I[h+3]=t[m+3];return I},canRun:function(){return this._isOn&&this.matrix}});c.prototype.shift=c.prototype.translate}(e),!function(t,e){var i=t.MODE,r=(t.Util.Array.typed,Math.min),l=(Math.max,Math.floor);t.Create({name:"DisplacementMapFilter",init:function(t){var e=this;t&&e.setInput("map",t)},path:n,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:i.CLAMP,hasInputs:!0,dispose:function(){var t=this;return t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color}},unserialize:function(t){var e=this;return e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.startX=t.startX,e.startY=t.startY,e.componentX=t.componentX,e.componentY=t.componentY,e.color=t.color,e},reset:function(){return this.unsetInput("map"),this},_apply:function(e,n,a){var s,o=this;if(s=o.input("map"),!s)return e;var u,c,f,h,m,_,p,d,g,v,C,R,y,I,x,A,w,b,E,F,L,G,T,M,S,Y,N,B,U,O,H,X,z,D,V,q,k=o.color||0,P=n-1,j=a-1,W=.00390625*o.scaleX,$=.00390625*o.scaleY,J=o.componentX,Q=o.componentY,K=i.IGNORE,Z=(i.CLAMP,i.COLOR),tt=i.WRAP,et=o.mode||K,nt=(t.ImArray,t.ImArrayCopy),it=t.Array16I;for(u=s[0],c=s[1],f=s[2],z=u.length,h=z>>>2,_=r(c,n),p=r(f,a),X=e.length,O=_*p<<2,H=X>>>2,y=l(o.startX*P),R=l(o.startY*j),I=R*n,x=-y,A=-R,w=P-y,b=j-R,m=new it(h<<1),D=new nt(e),E=(15&h)<<2,L=0,F=0;E>F;F+=4)m[L++]=l((u[F+J]-128)*W),m[L++]=l((u[F+Q]-128)*$);for(F=E;z>F;F+=64)m[L++]=l((u[F+J]-128)*W),m[L++]=l((u[F+Q]-128)*$),m[L++]=l((u[F+4+J]-128)*W),m[L++]=l((u[F+4+Q]-128)*$),m[L++]=l((u[F+8+J]-128)*W),m[L++]=l((u[F+8+Q]-128)*$),m[L++]=l((u[F+12+J]-128)*W),m[L++]=l((u[F+12+Q]-128)*$),m[L++]=l((u[F+16+J]-128)*W),m[L++]=l((u[F+16+Q]-128)*$),m[L++]=l((u[F+20+J]-128)*W),m[L++]=l((u[F+20+Q]-128)*$),m[L++]=l((u[F+24+J]-128)*W),m[L++]=l((u[F+24+Q]-128)*$),m[L++]=l((u[F+28+J]-128)*W),m[L++]=l((u[F+28+Q]-128)*$),m[L++]=l((u[F+32+J]-128)*W),m[L++]=l((u[F+32+Q]-128)*$),m[L++]=l((u[F+36+J]-128)*W),m[L++]=l((u[F+36+Q]-128)*$),m[L++]=l((u[F+40+J]-128)*W),m[L++]=l((u[F+40+Q]-128)*$),m[L++]=l((u[F+44+J]-128)*W),m[L++]=l((u[F+44+Q]-128)*$),m[L++]=l((u[F+48+J]-128)*W),m[L++]=l((u[F+48+Q]-128)*$),m[L++]=l((u[F+52+J]-128)*W),m[L++]=l((u[F+52+Q]-128)*$),m[L++]=l((u[F+56+J]-128)*W),m[L++]=l((u[F+56+Q]-128)*$),m[L++]=l((u[F+60+J]-128)*W),m[L++]=l((u[F+60+Q]-128)*$);if(Z===et)for(d=k>>>24&255,g=k>>>16&255,v=k>>>8&255,C=255&k,G=0,T=0,M=0,S=0,F=0;O>F;F+=4,G++)G>=_&&(G=0,T++,M+=n,S+=c),A>T||T>b||x>G||G>w||(N=G+y,Y=T+R,B=N+M+I<<2,L=G+S<<1,V=N+m[L],q=Y+m[L+1],q>j||0>q||V>P||0>V?(e[B]=g,e[B+1]=v,e[B+2]=C,e[B+3]=d):(U=V+q*n<<2,e[B]=D[U],e[B+1]=D[U+1],e[B+2]=D[U+2],e[B+3]=D[U+3]));else if(K===et)for(G=0,T=0,M=0,S=0,F=0;O>F;F+=4,G++)G>=_&&(G=0,T++,M+=n,S+=c),A>T||T>b||x>G||G>w||(N=G+y,Y=T+R,B=N+M+I<<2,L=G+S<<1,V=N+m[L],q=Y+m[L+1],q>j||0>q||V>P||0>V||(U=V+q*n<<2,e[B]=D[U],e[B+1]=D[U+1],e[B+2]=D[U+2],e[B+3]=D[U+3]));else if(tt===et)for(G=0,T=0,M=0,S=0,F=0;O>F;F+=4,G++)G>=_&&(G=0,T++,M+=n,S+=c),A>T||T>b||x>G||G>w||(N=G+y,Y=T+R,B=N+M+I<<2,L=G+S<<1,V=N+m[L],q=Y+m[L+1],q=q>j?q-a:0>q?q+a:q,V=V>P?V-n:0>V?V+n:V,U=V+q*n<<2,e[B]=D[U],e[B+1]=D[U+1],e[B+2]=D[U+2],e[B+3]=D[U+3]);else for(G=0,T=0,M=0,S=0,F=0;O>F;F+=4,G++)G>=_&&(G=0,T++,M+=n,S+=c),A>T||T>b||x>G||G>w||(N=G+y,Y=T+R,B=N+M+I<<2,L=G+S<<1,V=N+m[L],q=Y+m[L+1],q=q>j?j:0>q?0:q,V=V>P?P:0>V?0:V,U=V+q*n<<2,e[B]=D[U],e[B+1]=D[U+1],e[B+2]=D[U+2],e[B+3]=D[U+3]);return e}})}(e),!function(t,e){function i(e,n){var i=n?a(n):"",r=a(e);return new Function("FILTER",'"use strict"; return function( im, w, h ){    var self = this;    if ( !self._map ) return im;    var x, y, i, j, imLen = im.length, dst = new FILTER.ImArray(imLen), t = new FILTER.Array32F(2),        COLOR = FILTER.MODE.COLOR, CLAMP = FILTER.MODE.CLAMP, WRAP = FILTER.MODE.WRAP, IGNORE = FILTER.MODE.IGNORE,        mode = self.mode||IGNORE, color = self.color||0, r, g, b, a, bx = w-1, by = h-1;    '+i+";        if ( COLOR === mode )    {        a = (color >>> 24)&255;        r = (color >>> 16)&255;        g = (color >>> 8)&255;        b = (color)&255;            for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+r+";                        if ( 0>t[0] || t[0]>bx || 0>t[1] || t[1]>by )            {                /* color */                dst[i] = r;   dst[i+1] = g;                dst[i+2] = b;  dst[i+3] = a;                continue;            }                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if ( IGNORE === mode )    {        for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+r+";                        /* ignore */            t[1] = t[1] > by || t[1] < 0 ? y : t[1];            t[0] = t[0] > bx || t[0] < 0 ? x : t[0];                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if ( WRAP === mode )    {        for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+r+";                        /* wrap */            t[1] = t[1] > by ? t[1]-h : (t[1] < 0 ? t[1]+h : t[1]);            t[0] = t[0] > bx ? t[0]-w : (t[0] < 0 ? t[0]+w : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else /*if ( CLAMP === mode )*/    {        for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+r+";                        /* clamp */            t[1] = t[1] > by ? by : (t[1] < 0 ? 0 : t[1]);            t[0] = t[0] > bx ? bx : (t[0] < 0 ? 0 : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    return dst;};")(t)}var r,l=t.MODE,a=t.Util.String.function_body;t.Create({name:"GeometricMapFilter",init:function(t,e){var n=this;t&&n.set(t,e)},path:n,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,color:0,centerX:0,centerY:0,angle:0,radius:0,mode:l.CLAMP,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.color=0,t.centerX=null,t.centerY=null,t.angle=null,t.radius=null,t.$super("dispose"),t},serialize:function(){var t,e=this;return t={_mapName:e._mapName||null,_map:"generic"===e._mapName&&e._map&&e._mapChanged?e._map.toString():null,_mapInit:"generic"===e._mapName&&e._mapInit&&e._mapChanged?e._mapInit.toString():null,color:e.color,centerX:e.centerX,centerY:e.centerY,angle:e.angle,radius:e.radius},e._mapChanged=!1,t},unserialize:function(t){var e=this;return e.color=t.color,e.centerX=t.centerX,e.centerY=t.centerY,e.angle=t.angle,e.radius=t.radius,!t._map&&t._mapName&&r.hasOwnProperty(t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},polar:function(t,e){return this},cartesian:function(t,e){return this},twirl:function(t,e,n,i){var r=this;return r.angle=t||0,r.radius=e||0,r.centerX=n||0,r.centerY=i||0,r.set("twirl")},sphere:function(t,e,n){var i=this;return i.radius=t||0,i.centerX=e||0,i.centerY=n||0,i.set("sphere")},set:function(t,e){var n=this;return t&&r.hasOwnProperty(String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=r[n._mapName],n._mapInit=r["init__"+n._mapName],n._apply=i(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=t,n._mapInit=e||null,n._apply=i(n._map,n._mapInit),n._mapChanged=!0),n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t},canRun:function(){return this._isOn&&this._map}}),r={twirl:"function( ){        TX = t[0]-CX; TY = t[1]-CY;        D = Sqrt(TX*TX + TY*TY);        if ( D < R )        {            theta = Atan2(TY, TX) + fact*(R-D);            t[0] = CX + D*Cos(theta);  t[1] = CY + D*Sin(theta);        }    }",init__twirl:"function( ){        var Sqrt = Math.sqrt, Atan2 = Math.atan2, Sin = Math.sin, Cos = Math.cos,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            angle = self.angle, R = self.radius, fact = angle/R,            D, TX, TY, theta;    }",sphere:"function( ){        TX = t[0]-CX;  TY = t[1]-CY;        TX2 = TX*TX; TY2 = TY*TY;        D2 = TX2 + TY2;        if ( D2 < R2 )        {            D2 = R2 - D2; D = Sqrt(D2);            thetax = Asin(TX / Sqrt(TX2 + D2)) * invrefraction;            thetay = Asin(TY / Sqrt(TY2 + D2)) * invrefraction;            t[0] = t[0] - D * Tan(thetax);  t[1] = t[1] - D * Tan(thetay);        }    }",init__sphere:"function( ){        var Sqrt = Math.sqrt, Asin = Math.asin, Tan = Math.tan,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            invrefraction = 1-0.555556,            R = self.radius, R2 = R*R,            D, TX, TY, TX2, TY2, R2, D2, thetax, thetay;    }"}}(e),!function(t,e){function i(t){for(var e=0,n=0,i=t.length;i>n;n++)e+=t[n];return e}function r(t,e){var n,i,r,l=[],a=[],s=[],o=t.length,u=e,c=u>>>1;for(i=0,r=0,n=0;o>n;)a.push(i-c),a.push(r-c),t[n]&&(l.push(i-c),l.push(r-c),s.push(t[n])),n++,i++,i>=u&&(i=0,r++);return[new v(l),new v(a),new d(s)]}function l(t,e){var n,i,r,l=new Array(t);for(n=0,i=0,r=0;t>r;r++,n++)l[r]=e(n,i,t);return l}function a(t){var e,n=new Array(t);for(e=0;t>e;e++)n[e]=1;return n}function s(t,e){var n,i=t>>>1,r=new Array(t);if(e)for(n=0;t>n;n++)r[t-1-n]=n-i;else for(n=0;t>n;n++)r[n]=n-i;return r}function o(t){var e,n,i,r,l=E.length;if(t--,l>t)e=E[t];else for(e=E[l-1];t>=l;){for(n=e,e=new Array(n.length+1),e[0]=1,i=0,r=n.length-1;r>i;i++)e[i+1]=n[i]+n[i+1];e[n.length]=1,20>l&&E.push(e),l++}return e.slice()}function u(t){var e=o(t);return C(e,e)}function c(t,e){return 1===e?C(s(t,1),o(t)):C(o(t),s(t,0))}function f(t,e){return 1===e?C(s(t,1),a(t)):C(a(t),s(t,0))}function h(t,e,n){e=e||1,n=n||e;var i,r=t*t,l=new d(r);for(i=0;t>i;i++)l[i]=e;return l[r>>>1]=n,l}function m(t,e,n,i){var r,l,a,s,o,u=t*t,c=t>>>1,f=u>>>1,h=new d(u);for(s=0,r=0;c>=r;r++,s+=e)for(l=0,o=0,a=0;c>=a;a++,l+=t,o+=n)h[f+r+l]=s+o,h[f-r-l]=-s-o,h[f-r+l]=-s+o,h[f+r-l]=s-o;return h[f]=i||1,h}function _(t,e,n,i){var r,l,a,s,o,u,c=t*t,f=t>>1,h=c>>1,m=new d(c),_=new d(c),p=1/t,g=1e-8;for(x(e)>g?(o=1,u=n/e):(o=e/n,u=1),r=0,a=0,s=0,l=u*t;f>=r;)_[h+r]=h+a+s+.5|0,_[h-r]=h-a-s+.5|0,r++,a+=o,s+=l;for(r=0;f>=r;)m[_[h+r]]=m[_[h-r]]=p,r++;return m[h]=i||1,m}var p=t.MODE,d=t.ConvolutionMatrix,g=t.ImArray,v=(t.Array32F,t.Array16I),C=(t.Array8U,t.Util.Filter.cm_convolve),R=t.Util.Array.typed,y=t._notSupportClamp,I=(Math.SQRT2,t.CONST.toRad),x=(t.CONST.toDeg,Math.abs),A=Math.sqrt,w=Math.sin,b=Math.cos,E=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],F=t.Create({name:"ConvolutionMatrixFilter",init:function(t,e,n,i){var r=this;r._coeff=new d([1,0]),r.matrix2=null,r.dim2=0,r._isGrad=!1,r._doIntegral=0,r._doSeparable=!1,t&&t.length?r.set(t,A(t.length)+.5|0,e||1,n||0):(r.matrix=null,r.dim=0),r.mode=i||p.RGB},path:n,dim:0,dim2:0,matrix:null,matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,mode:p.RGB,dispose:function(){var t=this;return t.dim=null,t.dim2=null,t.matrix=null,t.matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t.$super("dispose"),t},serialize:function(){var t=this;return{dim:t.dim,dim2:t.dim2,matrix:t.matrix,matrix2:t.matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2}},unserialize:function(t){var e=this;return e.dim=t.dim,e.dim2=t.dim2,e.matrix=R(t.matrix,d),e.matrix2=R(t.matrix2,d),e._mat=R(t._mat,d),e._mat2=R(t._mat2,d),e._coeff=R(t._coeff,d),e._isGrad=t._isGrad,e._doIntegral=t._doIntegral,e._doSeparable=t._doSeparable,e._indices=R(t._indices,v),e._indices2=R(t._indices2,v),e._indicesf=R(t._indicesf,v),e._indicesf2=R(t._indicesf2,v),e},functional:function(t,n){n=n===e?3:1&n?n:n+1;var r=l(n,t),a=1/i(r);return this.set(r,n,a,a,n,r),this._doSeparable=!0,this},fastGauss:function(t,n){return n=n===e?3:1&n?n:n+1,t=0|(t||1),1>t?t=1:t>7&&(t=7),this.set(h(n),n,1/(n*n),0),this._doIntegral=t,this},lowPass:function(t){return t=t===e?3:1&t?t:t+1,this.set(h(t),t,1/(t*t),0),this._doIntegral=1,this},boxBlur:null,highPass:function(t,n){t=t===e?3:1&t?t:t+1,n=n===e?1:n;var i=-n/(t*t);return this.set(h(t,i,1+i),t,1,0),this._doIntegral=1,this},glow:function(t,n){return t=t===e?.5:t,this.highPass(n,-t)},sharpen:function(t,n){return t=t===e?.5:t,this.highPass(n,t)},verticalBlur:function(t){return t=t===e?3:1&t?t:t+1,this.set(a(t),1,1/t,0,t),this._doIntegral=1,this},horizontalBlur:function(t){return t=t===e?3:1&t?t:t+1,this.set(a(t),t,1/t,0,1),this._doIntegral=1,this},directionalBlur:function(t,n){return n=n===e?3:1&n?n:n+1,t*=I,this.set(_(n,b(t),-w(t),1/n),n,1,0)},binomialLowPass:function(t){t=t===e?3:1&t?t:t+1;var n=o(t),i=1/(1<<t-1);return this.set(n,t,i,i,t,n),this._doSeparable=!0,this},gaussBlur:null,binomialHighPass:function(n){n=n===e?3:1&n?n:n+1;var r=u(n);return this.set(t.Util.Filter.cm_combine(h(n),r,1,-1/i(r)),n,1,0)},prewittX:function(t){return t=t===e?3:1&t?t:t+1,this.set(a(t),t,1,0,t,s(t,0)),this._doSeparable=!0,this},gradX:null,prewittY:function(t){return t=t===e?3:1&t?t:t+1,this.set(s(t,1),t,1,0,t,a(t)),this._doSeparable=!0,this},gradY:null,prewittDirectional:function(n,i){return i=i===e?3:1&i?i:i+1,n*=I,this.set(t.Util.Filter.cm_combine(f(i,0),f(i,1),b(n),w(n)),i,1,0)},gradDirectional:null,prewitt:function(t){return t=t===e?3:1&t?t:t+1,this.set(f(t,0),t,1,0,t,f(t,1)),this._isGrad=!0,this},grad:null,sobelX:function(t){return t=t===e?3:1&t?t:t+1,this.set(o(t),t,1,0,t,s(t,0)),this._doSeparable=!0,this},sobelY:function(t){return t=t===e?3:1&t?t:t+1,this.set(s(t,1),t,1,0,t,o(t)),this._doSeparable=!0,this},sobelDirectional:function(n,i){return i=i===e?3:1&i?i:i+1,n*=I,this.set(t.Util.Filter.cm_combine(c(i,0),c(i,1),b(n),w(n)),i,1,0)},sobel:function(t){return t=t===e?3:1&t?t:t+1,this.set(c(t,0),t,1,0,t,c(t,1)),this._isGrad=!0,this},laplace:function(t){return t=t===e?3:1&t?t:t+1,this.set(h(t,-1,t*t-1),t,1,0),this._doIntegral=1,this},emboss:function(t,n,i){return i=i===e?3:1&i?i:i+1,t=t===e?-.25*Math.PI:t*I,n=n||1,this.set(m(i,n*b(t),-n*w(t),1),i,1,0)},bump:null,edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,n,i,l,a){var s,o=this;return o._isGrad=!1,o._doIntegral=0,o._doSeparable=!1,o.matrix2=null,o.dim2=0,o._indices2=o._indicesf2=null,o._mat2=null,o.matrix=new d(t),o.dim=e,o._coeff[0]=n||1,o._coeff[1]=i||0,s=r(o.matrix,o.dim),o._indices=s[0],o._indicesf=s[1],o._mat=s[2],a?(o.matrix2=new d(a),o.dim2=l,s=r(o.matrix2,o.dim2),o._indices2=s[0],o._indicesf2=s[1],o._mat2=s[2]):l&&(o.dim2=l),o},reset:function(){var t=this;return t.matrix=t.matrix2=null,t.dim=t.dim2=0,t._mat=t._mat2=null,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t},combineWith:function(t){var e=this;return t.matrix?e.matrix?e.set(C(e.matrix,t.matrix),e.dim*t.dim,e._coeff[0]*t._coeff[0]):e.set(t.matrix,t.dim,t._coeff[0],t._coeff[1]):e},_apply:y?function(e,n,i){var r=this,l=r.mode;if(!r.matrix)return e;if(r._doIntegral)return r.matrix2?t.Util.Filter.integral_convolution(l,e,n,i,2,r.matrix,r.matrix2,r.dim,r.dim2,r._coeff[0],r._coeff[1],r._doIntegral):t.Util.Filter.integral_convolution(l,e,n,i,2,r.matrix,null,r.dim,r.dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return t.Util.Filter.separable_convolution(l,e,n,i,2,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,s,o,u,c,f,h,m,_,d,C,R,y,I,A,w,b,E,F,L,G,T,M,S,Y=e.length,N=Y>>>2,B=new g(Y),U=n-1,O=N-n,H=r._coeff[0],X=r._coeff[1],z=r.matrix,D=r.matrix2,V=r._isGrad;if(p.GRAY===l)if(D){for(T=r._indicesf.length,S=new v(r._indicesf),f=0;T>f;f+=2)S[f+1]*=n;for(M=z.length,h=0,m=0,u=0;Y>u;u+=4,h++){for(h>=n&&(h=0,m+=n),R=y=I=A=w=b=E=F=0,f=0,c=0;M>f;f++,c+=2)_=h+S[c],d=m+S[c+1],0>_||_>U||0>d||d>O||(C=_+d<<2,L=z[f],R+=e[C]*L,G=D[f],w+=e[C]*G);a=V?x(R)+x(w):H*R+X*w,a=0>a?0:a>255?255:a,B[u]=0|a,B[u+1]=0|a,B[u+2]=0|a,B[u+3]=e[u+3]}}else{for(T=r._indices.length,S=new v(r._indices),f=0;T>f;f+=2)S[f+1]*=n;for(z=r._mat,M=z.length,h=0,m=0,u=0;Y>u;u+=4,h++){for(h>=n&&(h=0,m+=n),R=y=I=A=0,f=0,c=0;M>f;f++,c+=2)_=h+S[c],d=m+S[c+1],0>_||_>U||0>d||d>O||(C=_+d<<2,L=z[f],R+=e[C]*L);a=H*R+X,a=0>a?0:a>255?255:a,B[u]=0|a,B[u+1]=0|a,B[u+2]=0|a,B[u+3]=e[u+3]}}else if(D){for(T=r._indicesf.length,S=new v(r._indicesf),f=0;T>f;f+=2)S[f+1]*=n;for(M=z.length,h=0,m=0,u=0;Y>u;u+=4,h++){for(h>=n&&(h=0,m+=n),R=y=I=A=w=b=E=F=0,f=0,c=0;M>f;f++,c+=2)_=h+S[c],d=m+S[c+1],0>_||_>U||0>d||d>O||(C=_+d<<2,L=z[f],R+=e[C]*L,y+=e[C+1]*L,I+=e[C+2]*L,G=D[f],w+=e[C]*G,b+=e[C+1]*G,E+=e[C+2]*G);V?(a=x(R)+x(w),s=x(y)+x(b),o=x(I)+x(E)):(a=H*R+X*w,s=H*y+X*b,o=H*I+X*E),a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,o=0>o?0:o>255?255:o,B[u]=0|a,B[u+1]=0|s,B[u+2]=0|o,B[u+3]=e[u+3]}}else{for(T=r._indices.length,S=new v(r._indices),f=0;T>f;f+=2)S[f+1]*=n;for(z=r._mat,M=z.length,h=0,m=0,u=0;Y>u;u+=4,h++){for(h>=n&&(h=0,m+=n),R=y=I=A=0,f=0,c=0;M>f;f++,c+=2)_=h+S[c],d=m+S[c+1],0>_||_>U||0>d||d>O||(C=_+d<<2,L=z[f],R+=e[C]*L,y+=e[C+1]*L,I+=e[C+2]*L);a=H*R+X,s=H*y+X,o=H*I+X,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,o=0>o?0:o>255?255:o,B[u]=0|a,B[u+1]=0|s,B[u+2]=0|o,B[u+3]=e[u+3]}}return B}:function(e,n,i){var r=this,l=r.mode;if(!r.matrix)return e;if(r._doIntegral)return r.matrix2?t.Util.Filter.integral_convolution(l,e,n,i,2,r.matrix,r.matrix2,r.dim,r.dim2,r._coeff[0],r._coeff[1],r._doIntegral):t.Util.Filter.integral_convolution(l,e,n,i,2,r.matrix,null,r.dim,r.dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return t.Util.Filter.separable_convolution(l,e,n,i,2,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,s,o,u,c,f,h,m,_,d,C,R,y,I,A,w,b,E,F,L,G,T,M,S,Y=e.length,N=Y>>>2,B=new g(Y),U=n-1,O=N-n,H=r._coeff[0],X=r._coeff[1],z=r.matrix,D=r.matrix2,V=r._isGrad;if(p.GRAY===l)if(D){for(T=r._indicesf.length,S=new v(r._indicesf),f=0;T>f;f+=2)S[f+1]*=n;for(M=z.length,h=0,m=0,u=0;Y>u;u+=4,h++){for(h>=n&&(h=0,m+=n),R=y=I=A=w=b=E=F=0,f=0,c=0;M>f;f++,c+=2)_=h+S[c],d=m+S[c+1],0>_||_>U||0>d||d>O||(C=_+d<<2,L=z[f],R+=e[C]*L,G=D[f],w+=e[C]*G);a=V?x(R)+x(w):H*R+X*w,B[u]=0|a,B[u+1]=0|a,B[u+2]=0|a,B[u+3]=e[u+3]}}else{for(T=r._indices.length,S=new v(r._indices),f=0;T>f;f+=2)S[f+1]*=n;for(z=r._mat,M=z.length,h=0,m=0,u=0;Y>u;u+=4,h++){for(h>=n&&(h=0,m+=n),R=y=I=A=0,f=0,c=0;M>f;f++,c+=2)_=h+S[c],d=m+S[c+1],0>_||_>U||0>d||d>O||(C=_+d<<2,L=z[f],R+=e[C]*L);a=H*R+X,B[u]=0|a,B[u+1]=0|a,B[u+2]=0|a,B[u+3]=e[u+3]}}else if(D){for(T=r._indicesf.length,S=new v(r._indicesf),f=0;T>f;f+=2)S[f+1]*=n;for(M=z.length,h=0,m=0,u=0;Y>u;u+=4,h++){for(h>=n&&(h=0,m+=n),R=y=I=A=w=b=E=F=0,f=0,c=0;M>f;f++,c+=2)_=h+S[c],d=m+S[c+1],0>_||_>U||0>d||d>O||(C=_+d<<2,L=z[f],R+=e[C]*L,y+=e[C+1]*L,I+=e[C+2]*L,G=D[f],w+=e[C]*G,b+=e[C+1]*G,E+=e[C+2]*G);V?(a=x(R)+x(w),s=x(y)+x(b),o=x(I)+x(E)):(a=H*R+X*w,s=H*y+X*b,o=H*I+X*E),B[u]=0|a,B[u+1]=0|s,B[u+2]=0|o,B[u+3]=e[u+3]}}else{for(T=r._indices.length,S=new v(r._indices),f=0;T>f;f+=2)S[f+1]*=n;for(z=r._mat,M=z.length,h=0,m=0,u=0;Y>u;u+=4,h++){for(h>=n&&(h=0,m+=n),R=y=I=A=0,f=0,c=0;M>f;f++,c+=2)_=h+S[c],d=m+S[c+1],0>_||_>U||0>d||d>O||(C=_+d<<2,L=z[f],R+=e[C]*L,y+=e[C+1]*L,I+=e[C+2]*L);a=H*R+X,s=H*y+X,o=H*I+X,B[u]=0|a,B[u+1]=0|s,B[u+2]=0|o,B[u+3]=e[u+3]}}return B},canRun:function(){return this._isOn&&this.matrix}});F.prototype.gradX=F.prototype.prewittX,F.prototype.gradY=F.prototype.prewittY,F.prototype.gradDirectional=F.prototype.prewittDirectional,F.prototype.grad=F.prototype.prewitt,F.prototype.bump=F.prototype.emboss,F.prototype.boxBlur=F.prototype.lowPass,F.prototype.gaussBlur=F.prototype.binomialLowPass}(e),!function(t,e){var i,r=t.MODE,l=t.ImArray,a=t.Array8U,s=t.Array32I,o=Math.sqrt,u=t.Util.Array.typed,c=function(t){var e,n=t*t,i=new a(n);for(e=0;n>e;e++)i[e]=1;return i},f=c(3);t.Create({name:"MorphologicalFilter",init:function(){var t=this;t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null,t.mode=r.RGB},path:n,_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,mode:r.RGB,dispose:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=null,t._structureElement=null,t._indices=null,t.$super("dispose"),t},serialize:function(){var t=this;return{_filterName:t._filterName,_dim:t._dim,_structureElement:t._structureElement,_indices:t._indices}},unserialize:function(t){var e=this;return e._dim=t._dim,e._structureElement=u(t._structureElement,a),e._indices=u(t._indices,s),e._filterName=t._filterName,e._filterName&&i[e._filterName]&&(e._filter=i[e._filterName]),e},erode:function(t){return this.set(t,"erode")},dilate:function(t){return this.set(t,"dilate")},opening:function(t){return this.set(t,"open")},closing:function(t){return this.set(t,"close")},gradient:function(t){return this.set(t,"gradient")},laplacian:function(t){return this.set(t,"laplacian")},set:function(t,e){var n=this;n._filterName=e,n._filter=i[e],t&&t.length?(n._structureElement=new a(t),n._dim=o(n._structureElement.length)+.5|0):t&&t===+t?(n._structureElement=c(t),n._dim=t):(n._structureElement=f,n._dim=3);var r,l,u,h=[],t=n._structureElement,m=t.length,_=n._dim,p=_>>>1;for(l=0,u=0,r=0;m>r;r++,l++)l>=_&&(l=0,u++),t[r]&&(h.push(l-p),h.push(u-p));return n._indices=new s(h),n},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null,t},_apply:function(t,e,n){var i=this;return i._dim&&i._filter?i._filter(i,t,e,n):t},canRun:function(){return this._isOn&&this._dim&&this._filter}}),i={dilate:function(t,e,n,i){var a,o,u,c,f,h,m,_,p,d,g,v,C,R=t._structureElement,y=(R.length,t._dim,t._indices),I=y.length,x=I>>>1,A=new s(I),w=e.length,b=w>>>2,E=new l(w),F=n-1,L=b-n;for(o=0;I>o;o+=2)A[o]=y[o],A[o+1]=y[o+1]*n;if(r.GRAY===t.mode)for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=0,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],_>g&&(g=_));E[a]=g,E[a+1]=g,E[a+2]=g,E[a+3]=e[a+3]}else for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=v=C=0,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],_>g&&(g=_),p>v&&(v=p),d>C&&(C=d));E[a]=g,E[a+1]=v,E[a+2]=C,E[a+3]=e[a+3]}return E},erode:function(t,e,n,i){var a,o,u,c,f,h,m,_,p,d,g,v,C,R=t._structureElement,y=(R.length,t._dim,t._indices),I=y.length,x=I>>>1,A=new s(I),w=e.length,b=w>>>2,E=new l(w),F=n-1,L=b-n;for(o=0;I>o;o+=2)A[o]=y[o],A[o+1]=y[o+1]*n;if(r.GRAY===t.mode)for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=255,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],g>_&&(g=_));E[a]=g,E[a+1]=g,E[a+2]=g,E[a+3]=e[a+3]}else for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=v=C=255,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],g>_&&(g=_),v>p&&(v=p),C>d&&(C=d));E[a]=g,E[a+1]=v,E[a+2]=C,E[a+3]=e[a+3]}return E},open:function(t,e,n,i){var a,o,u,c,f,h,m,_,p,d,g,v,C,R=t._structureElement,y=(R.length,t._dim,t._indices),I=y.length,x=I>>>1,A=new s(I),w=e.length,b=w>>>2,E=new l(w),F=n-1,L=b-n;for(o=0;I>o;o+=2)A[o]=y[o],A[o+1]=y[o+1]*n;if(r.GRAY===t.mode){for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=255,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],g>_&&(g=_));E[a]=g,E[a+1]=g,E[a+2]=g,E[a+3]=e[a+3]}var G=e;for(e=E,E=G,u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=0,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],_>g&&(g=_));E[a]=g,E[a+1]=g,E[a+2]=g,E[a+3]=e[a+3]}}else{for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=v=C=255,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],g>_&&(g=_),v>p&&(v=p),C>d&&(C=d));E[a]=g,E[a+1]=v,E[a+2]=C,E[a+3]=e[a+3]}var G=e;for(e=E,E=G,u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=v=C=0,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],_>g&&(g=_),p>v&&(v=p),d>C&&(C=d));E[a]=g,E[a+1]=v,E[a+2]=C,E[a+3]=e[a+3]}}return E},close:function(t,e,n,i){var a,o,u,c,f,h,m,_,p,d,g,v,C,R=t._structureElement,y=(R.length,t._dim,t._indices),I=y.length,x=I>>>1,A=new s(I),w=e.length,b=w>>>2,E=new l(w),F=n-1,L=b-n;for(o=0;I>o;o+=2)A[o]=y[o],A[o+1]=y[o+1]*n;if(r.GRAY===t.mode){for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=0,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],_>g&&(g=_));E[a]=g,E[a+1]=g,E[a+2]=g,E[a+3]=e[a+3]}var G=e;for(e=E,E=G,u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=255,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],g>_&&(g=_));E[a]=g,E[a+1]=g,E[a+2]=g,E[a+3]=e[a+3]}}else{for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),
g=v=C=0,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],_>g&&(g=_),p>v&&(v=p),d>C&&(C=d));E[a]=g,E[a+1]=v,E[a+2]=C,E[a+3]=e[a+3]}var G=e;for(e=E,E=G,u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=v=C=255,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],g>_&&(g=_),v>p&&(v=p),C>d&&(C=d));E[a]=g,E[a+1]=v,E[a+2]=C,E[a+3]=e[a+3]}}return E},gradient:function(t,e,n,i){var a,o,u,c,f,h,m,_,p,d,g,v,C,R=t._structureElement,y=(R.length,t._dim,t._indices),I=y.length,x=I>>>1,A=new s(I),w=e.length,b=w>>>2,E=new l(w),F=n-1,L=b-n;for(o=0;I>o;o+=2)A[o]=y[o],A[o+1]=y[o+1]*n;if(r.GRAY===t.mode){for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=0,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],_>g&&(g=_));E[a]=g,E[a+1]=g,E[a+2]=g,E[a+3]=e[a+3]}for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=255,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],g>_&&(g=_));g=.5*(E[a]-g)|0,E[a]=g,E[a+1]=g,E[a+2]=g}}else{for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=v=C=0,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],_>g&&(g=_),p>v&&(v=p),d>C&&(C=d));E[a]=g,E[a+1]=v,E[a+2]=C,E[a+3]=e[a+3]}for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=v=C=255,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],g>_&&(g=_),v>p&&(v=p),C>d&&(C=d));g=.5*(E[a]-g)|0,v=.5*(E[a+1]-v)|0,C=.5*(E[a+2]-C)|0,E[a]=g,E[a+1]=v,E[a+2]=C}}return E},laplacian:function(t,e,n,i){var a,o,u,c,f,h,m,_,p,d,g,v,C,R=t._structureElement,y=(R.length,t._dim,t._indices),I=y.length,x=I>>>1,A=new s(I),w=e.length,b=w>>>2,E=new l(w),F=n-1,L=b-n;for(o=0;I>o;o+=2)A[o]=y[o],A[o+1]=y[o+1]*n;if(r.GRAY===t.mode){for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=0,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],_>g&&(g=_));E[a]=g,E[a+1]=g,E[a+2]=g,E[a+3]=e[a+3]}for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=255,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],g>_&&(g=_));g=.5*(E[a]+g)-e[a]|0,E[a]=g,E[a+1]=g,E[a+2]=g}}else{for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=v=C=0,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],_>g&&(g=_),p>v&&(v=p),d>C&&(C=d));E[a]=g,E[a+1]=v,E[a+2]=C,E[a+3]=e[a+3]}for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=v=C=255,o=0;x>o;o+=2)f=u+A[o],h=c+A[o+1],0>f||f>F||0>h||h>L||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],g>_&&(g=_),v>p&&(v=p),C>d&&(C=d));g=.5*(E[a]+g)-e[a]|0,v=.5*(E[a+1]+v)-e[a+1]|0,C=.5*(E[a+2]+C)-e[a+2]|0,E[a]=g,E[a+1]=v,E[a+2]=C}}return E}}}(e),!function(t,e){var i,r=t.MODE,l=t.ImArray,a=t.Array32I,s=t.Array32U,o=t.Util.Array.typed,u=Math.min,c=Math.max,f=t.Create({name:"StatisticalFilter",init:function(){var t=this;t.d=0,t.k=0,t._gray=!1,t._filter=null,t._indices=null,t.mode=r.RGB},path:n,d:0,k:0,_filter:null,_indices:null,mode:r.RGB,dispose:function(){var t=this;return t.d=null,t.k=null,t._filter=null,t._indices=null,t.$super("dispose"),t},serialize:function(){var t=this;return{d:t.d,k:t.k,_filter:t._filter,_indices:t._indices}},unserialize:function(t){var e=this;return e.d=t.d,e.k=t.k,e._filter=t._filter,e._indices=o(t._indices,a),e},kth:function(t,e){return this.set(null==e?3:1&e?e:e+1,t)},median:function(t){return this.set(null==t?3:1&t?t:t+1,.5)},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,0)},erode:null,maximum:function(t){return this.set(null==t?3:1&t?t:t+1,1)},dilate:null,set:function(t,e){var n=this;n.d=t=t||3,n.k=e=u(1,c(0,e||0)),n._filter=0===e?"0th":1===e?"1th":"kth";var i,r,l,s=t*t<<1,o=t>>>1,f=new a(s);for(r=0,l=0,i=0;s>i;i+=2,r++)r>=t&&(r=0,l++),f[i]=r-o,f[i+1]=l-o;return n._indices=f,n},reset:function(){var t=this;return t.d=0,t.k=0,t._filter=null,t._indices=null,t},_apply:function(t,e,n){var r=this;return r.d?i[r._filter](r,t,e,n):t},canRun:function(){return this._isOn&&this.d}});f.prototype.erode=f.prototype.minimum,f.prototype.dilate=f.prototype.maximum,i={"1th":function(t,e,n,i){var s,o,u,c,f,h,m,_,p,d,g,v,C,R=(t.d,e.length),y=R>>>2,I=new l(R),x=n-1,A=y-n,w=t._indices,b=w.length,E=new a(b);for(o=0;b>o;o+=2)E[o]=w[o],E[o+1]=w[o+1]*n;if(r.GRAY===t.mode)for(s=0,u=0,c=0;R>s;s+=4,u++){for(u>=n&&(u=0,c+=n),v=0,o=0;b>o;o+=2)f=u+E[o],h=c+E[o+1],0>f||f>x||0>h||h>A||(m=f+h<<2,p=e[m],p>v&&(v=p));I[s]=v,I[s+1]=v,I[s+2]=v,I[s+3]=e[s+3]}else for(s=0,u=0,c=0;R>s;s+=4,u++){for(u>=n&&(u=0,c+=n),g=v=C=0,o=0;b>o;o+=2)f=u+E[o],h=c+E[o+1],0>f||f>x||0>h||h>A||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],_>g&&(g=_),p>v&&(v=p),d>C&&(C=d));I[s]=g,I[s+1]=v,I[s+2]=C,I[s+3]=e[s+3]}return I},"0th":function(t,e,n,i){var s,o,u,c,f,h,m,_,p,d,g,v,C,R=(t.d,e.length),y=R>>>2,I=new l(R),x=n-1,A=y-n,w=t._indices,b=w.length,E=new a(b);for(o=0;b>o;o+=2)E[o]=w[o],E[o+1]=w[o+1]*n;if(r.GRAY===t.mode)for(s=0,u=0,c=0;R>s;s+=4,u++){for(u>=n&&(u=0,c+=n),v=255,o=0;b>o;o+=2)f=u+E[o],h=c+E[o+1],0>f||f>x||0>h||h>A||(m=f+h<<2,p=e[m],v>p&&(v=p));I[s]=v,I[s+1]=v,I[s+2]=v,I[s+3]=e[s+3]}else for(s=0,u=0,c=0;R>s;s+=4,u++){for(u>=n&&(u=0,c+=n),g=v=C=255,o=0;b>o;o+=2)f=u+E[o],h=c+E[o+1],0>f||f>x||0>h||h>A||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],g>_&&(g=_),v>p&&(v=p),C>d&&(C=d));I[s]=g,I[s+1]=v,I[s+2]=C,I[s+3]=e[s+3]}return I},kth:function(t,e,n,i){var o,u,c,f,h,m,_,p,d,g,v,C,R,y,I,x,A,w,b,E,F,L,G,T,M=(t.d,t.k),S=e.length,Y=S>>>2,N=new l(S),B=n-1,U=Y-n,O=t._indices,H=O.length,X=new a(H);for(u=0;H>u;u+=2)X[u]=O[u],X[u+1]=O[u+1]*n;if(r.GRAY===t.mode)for(F=new s(256),o=0,c=0,f=0;S>o;o+=4,c++){for(c>=n&&(c=0,f+=n),G=0,C=255,I=0,u=0;H>u;u+=2)h=c+X[u],m=f+X[u+1],0>h||h>B||0>m||m>U||(_=h+m<<2,d=e[_],C>d&&(C=d),d>I&&(I=d),G++,F[d]++);for(G*=M,T=0,w=-1,u=C;I>=u;u++)T+=F[u],F[u]=0,0>w&&T>=G&&(w=u);N[o]=w,N[o+1]=w,N[o+2]=w,N[o+3]=e[o+3]}else for(E=new s(256),F=new s(256),L=new s(256),o=0,c=0,f=0;S>o;o+=4,c++){for(c>=n&&(c=0,f+=n),G=0,v=C=R=255,y=I=x=0,u=0;H>u;u+=2)h=c+X[u],m=f+X[u+1],0>h||h>B||0>m||m>U||(_=h+m<<2,p=e[_],d=e[_+1],g=e[_+2],E[p]++,F[d]++,L[g]++,G++,v>p&&(v=p),C>d&&(C=d),R>g&&(R=g),p>y&&(y=p),d>I&&(I=d),g>x&&(x=g));for(G*=M,T=0,A=-1,u=v;y>=u;u++)T+=E[u],E[u]=0,0>A&&T>=G&&(A=u);for(T=0,w=-1,u=C;I>=u;u++)T+=F[u],F[u]=0,0>w&&T>=G&&(w=u);for(T=0,b=-1,u=R;x>=u;u++)T+=L[u],L[u]=0,0>b&&T>=G&&(b=u);N[o]=A,N[o+1]=w,N[o+2]=b,N[o+3]=e[o+3]}return N}}}(e),!function(t,e){var i="hasOwnProperty";t.Create({name:"InlineFilter",init:function(t,e){var n=this;n._params={},n.set(t,e)},path:n,_filter:null,_params:null,_changed:!1,dispose:function(){var t=this;return t._filter=null,t._params=null,t._changed=null,t.$super("dispose"),t},serialize:function(){var t,e=this;return t={_filter:!1===e._filter?!1:e._changed&&e._filter?e._filter.toString():null,_params:e._params},e._changed=!1,t},unserialize:function(e){var n=this;return null!=e._filter&&(n._filter=!1===e._filter?null:new Function("FILTER",'"use strict"; return '+e._filter+";")(t)),n._params=e._params||{},n},params:function(t){var e=this;if(arguments.length){for(var n in t)t[i](n)&&(e._params[n]=t[n]);return e}return e._params},set:function(t,e){var n=this;return!1===t?(n._filter=!1,n._changed=!0):("function"==typeof t&&(n._filter=t,n._changed=!0),e&&n.params(e)),n},_apply:function(t,e,n,i){var r=this;return r._filter?r._filter(r._params,t,e,n,i):t},canRun:function(){return this._isOn&&this._filter}}),t.CustomFilter=t.InlineFilter}(e),!function(t,e){t.Create({name:"ResampleFilter",init:function(t,e,n){var i=this;i.sX=t||1,i.sY=e||1,i.interpolation=n},path:n,sX:1,sY:1,interpolation:null,hasMeta:!0,dispose:function(){var t=this;return t.sX=null,t.sY=null,t.interpolation=null,t.$super("dispose"),t},serialize:function(){var t=this;return{sX:t.sX,sY:t.sY,interpolation:t.interpolation}},unserialize:function(t){var e=this;return e.sX=t.sX,e.sY=t.sY,e.interpolation=t.interpolation,e},_apply:function(e,n,i){var r,l,a,s=this,o=s.sX,u=s.sY;return s.hasMeta=!1,s.meta=null,1===o&&1===u?e:(a=t.Interpolation[s.interpolation||"bilinear"])?(r=s.sX*n|0,l=s.sY*i|0,s.hasMeta=!0,s.meta={_IMG_WIDTH:r,_IMG_HEIGHT:l},a(e,n,i,r,l)):e}}),t.InterpolationFilter=t.ResizeFilter=t.RescaleFilter=t.ResampleFilter}(e),!function(t,e){var i=Math.max,r=Math.min;t.Create({name:"SelectionFilter",init:function(t){var e=this;e.selection=t||null},path:n,_apply:function(e,n,l){var a,s,o,u,c=this,f=c.selection;return c.hasMeta=!1,c.meta=null,f?(f[4]?(a=0|r(n-1,i(0,f[0]*(n-1))),s=0|r(l-1,i(0,f[1]*(l-1))),o=0|r(n-1,i(0,f[2]*(n-1))),u=0|r(l-1,i(0,f[3]*(l-1)))):(a=0|r(n-1,i(0,f[0])),s=0|r(l-1,i(0,f[1])),o=0|r(n-1,i(0,f[2])),u=0|r(l-1,i(0,f[3]))),0===a&&0===s&&n===o+1&&l===u+1?e:(c.hasMeta=!0,c.meta={_IMG_WIDTH:o-a+1,_IMG_HEIGHT:u-s+1},t.Util.Image.get_data(e,n,l,a,s,o,u,!0))):e}}),t.CropFilter=t.SubSelectionFilter=t.SelectionFilter}(e),e});