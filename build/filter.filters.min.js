/**
*
*   FILTER.js Generic Filters
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Generic Filters)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,n){"use strict";"object"==typeof module&&module.exports?module.exports=n.call(t,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_FILTERS")?define("FILTER_FILTERS",["module","FILTER"],function(e,i){return n.moduleUri=e.uri,n.call(t,i),i}):(n.call(t,t.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return t.FILTER})}(this,function t(n){"use strict";var e=n.getPath(t.moduleUri);return!function(t,n){var i=(Object.prototype,Function.prototype,Array.prototype),r=i.slice,a=i.splice,s=i.push,l=t.Filter.get,o=t.CompositeFilter=t.Class(t.Filter,{name:"CompositeFilter",constructor:function u(t){var n=this;return n instanceof u?(n.$super("constructor"),void(n._stack=t&&t.length?t.slice():[])):new u(t)},path:e,_stack:null,_meta:null,_stable:!0,dispose:function(t){var n,e=this,i=e._stack;if(!0===t)for(n=0;n<i.length;n++)i[n]&&i[n].dispose(t),i[n]=null;return e._stack=null,e._meta=null,e.$super("dispose"),e},serialize:function(){var t,n=this,e=n._stack,i={filter:n.name,_isOn:!!n._isOn,_stable:!!n._stable,_update:n._update,filters:[]};for(t=0;t<e.length;t++)i.filters.push(e[t].serialize());return i},unserialize:function(t){var n,e,i,r,a,s=this,o=s._stack;if(t&&s.name===t.filter)if(s._isOn=t._isOn,s._update=t._update,s._stable=t._stable,r=t.filters||[],e=r.length,i=o.length,e===i&&s._stable)for(n=0;e>n;n++)o[n].unserialize(r[n]);else{for(n=0;i>n;n++)o[n]&&o[n].dispose(!0),o[n]=null;for(o=[],n=0;e>n;n++){if(a=r[n]&&r[n].filter?l(r[n].filter):null,!a)throw new Error('Filter "'+r[n].filter+'" could not be created');o.push((new a).unserialize(r[n]))}s._stack=o}return s},getMeta:function(){return this._meta},setMeta:function(t){var n,e,i=this,r=i._stack;if(t&&(e=t.length)&&r.length)for(n=0;e>n;n++)r[t[n][0]].setMeta(t[n][1]);return i},stable:function(t){return arguments.length||(t=!0),this._stable=!!t,this},filters:function(t){return arguments.length?(this._stack=t.slice(),this):this._stack.slice()},push:function(){return arguments.length&&s.apply(this._stack,arguments),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){return arguments.length&&a.apply(this._stack,s.apply([0,0],arguments)),this},getAt:function(t){return this._stack.length>t?this._stack[t]:null},setAt:function(t,n){return this._stack.length>t?this._stack[t]=n:this._stack.push(n),this},insertAt:function(t){var n=r.call(arguments);n.length;return argslen>1&&(n.shift(),a.apply(this._stack,[t,0].concat(n))),this},removeAt:function(t){return this._stack.splice(t,1)},remove:function(t){for(var n=this._stack.length;--n>=0;)t===this._stack[n]&&this._stack.splice(n,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(t,n,e,i){var r=this,a={};if(r._meta=[],r._isOn&&r._stack.length){var s,l,o=r._stack,u=o.length;for(s=0;u>s;s++)l=o[s],l&&l._isOn&&(t=l._apply(t,n,e,i,a),l.hasMeta&&r._meta.push([s,l.getMeta()]))}return r.hasMeta=r._meta.length>0,t},canRun:function(){return this._isOn&&this._stack.length},toString:function(){var t,n="  ",e=this._stack,i=[],r=e.length;for(t=0;r>t;t++)i.push(n+e[t].toString().split("\n").join("\n"+n));return["[FILTER: "+this.name+"]","[",i.join("\n"),"]",""].join("\n")}});o.prototype.get=o.prototype.getAt,o.prototype.set=o.prototype.setAt,o.prototype.empty=o.prototype.reset,o.prototype.concat=o.prototype.push}(n),!function(t,n){var i=t.CHANNEL,r=t.ColorTable,a=t.Color.clampPixel,s=t.Util.Filter,l=s.ct_eye,o=s.ct_multiply,u=Math.pow,c=Math.exp,f=1/255,m=t.Util.Array.typed,h=t.ColorTableFilter=t.Class(t.Filter,{name:"ColorTableFilter",constructor:function _(t,n,e,r){var a=this;return a instanceof _?(a.$super("constructor"),a._table=[null,null,null,null],t=t||null,n=n||t,e=e||n,r=r||null,a._table[i.R]=t,a._table[i.G]=n,a._table[i.B]=e,void(a._table[i.A]=r)):new _(t,n,e,r)},path:e,_table:null,dispose:function(){var t=this;return t._table=null,t.$super("dispose"),t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_tableR:t._table[i.R],_tableG:t._table[i.G],_tableB:t._table[i.B],_tableA:t._table[i.A]}}},unserialize:function(t){var n,e=this;return t&&e.name===t.filter&&(e._isOn=!!t._isOn,n=t.params,e._table[i.R]=m(n._tableR,r),e._table[i.G]=m(n._tableG,r),e._table[i.B]=m(n._tableB,r),e._table[i.A]=m(n._tableA,r)),e},channel:function(t){if(null==t)return this;var n,e,r;switch(t||i.R){case i.B:n=l(0,0),e=l(0,0),r=l();break;case i.G:n=l(0,0),e=l(),r=l(0,0);break;case i.R:default:n=l(),e=l(0,0),r=l(0,0)}return this.set(n,e,r)},redChannel:function(){return this.channel(i.R)},greenChannel:function(){return this.channel(i.G)},blueChannel:function(){return this.channel(i.B)},channelInvert:function(t){if(null==t)return this;var n,e,r;switch(t||i.R){case i.B:n=l(),e=l(),r=l(-1,255);break;case i.G:n=l(),e=l(-1,255),r=l();break;case i.R:default:n=l(-1,255),e=l(),r=l()}return this.set(n,e,r)},redInvert:function(){return this.channelInvert(i.R)},greenInvert:function(){return this.channelInvert(i.G)},blueInvert:function(){return this.channelInvert(i.B)},invert:function(){return this.set(l(-1,255))},thresholds:function(t,n,e){t.length||(t=[t]),n||(n=t),e||(e=n);var i,s,l=t.length,o=l+1,u=n.length,c=u+1,f=e.length,m=f+1,h=new r(256),_=new r(o),p=new r(256),d=new r(c),g=new r(256),v=new r(m),C=255/(o-1),R=255/(c-1),y=255/(m-1);for(i=0;o>i;)_[i]=~~(C*i),i++;for(t[0]=~~(255*t[0]),i=1;l>i;)t[i]=t[i-1]+~~(255*t[i]),i++;for(i=0;c>i;)d[i]=~~(R*i),i++;for(n[0]=~~(255*n[0]),i=1;u>i;)n[i]=n[i-1]+~~(255*n[i]),i++;for(i=0;m>i;)v[i]=~~(y*i),i++;for(e[0]=~~(255*e[0]),i=1;f>i;)e[i]=e[i-1]+~~(255*e[i]),i++;for(i=0;256>i;i++){for(s=0;l>s&&i>t[s];)s++;for(h[i]=a(_[s]),s=0;u>s&&i>n[s];)s++;for(p[i]=a(d[s]),s=0;f>s&&i>e[s];)s++;g[i]=a(v[s])}return this.set(h,p,g)},threshold:function(t,n,e){return t=null==t?.5:t,n=null==n?t:n,e=null==e?n:e,this.thresholds([t],[n],[e])},quantize:function(t){null==t&&(t=64),2>t&&(t=2);var n,e=new r(256),i=new r(t),s=255/(t-1),l=t/256;for(n=0;t>n;)i[n]=~~(s*n),n++;for(n=0;256>n;n++)e[n]=a(i[~~(l*n)]);return this.set(e)},binarize:function(){return this.quantize(2)},solarize:function(t,n){null==n&&(n=1),null==t&&(t=.5);var e,i,s,l=new r(256),o=2/255;if(-1===n)for(t*=256,e=0;256>e;e++)l[e]=e>t?255-e:e;else if(2===n)for(t=1-t,e=0;256>e;e++)i=o*e,s=t>i?255-255*i:255*i-255,l[e]=~~a(s);else for(e=0;256>e;e++)i=o*e,s=i>t?255-255*i:255*i-255,l[e]=~~a(s);return this.set(l)},solarize2:function(t){return this.solarize(t,2)},solarizeInverse:function(t){return this.solarize(t,-1)},mask:function(t){var n=0,e=new r(256),i=new r(256),s=new r(256),l=t>>>16&255,o=t>>>8&255,u=255&t;for(n=0;256>n;n++)e[n]=a(n&l),i[n]=a(n&o),s[n]=a(n&u);return this.set(e,i,s)},replace:function(t,n){if(t==n)return this;var e=t>>>16&255,i=t>>>8&255,r=255&t,a=n>>>16&255,s=n>>>8&255,o=255&n,u=l(),c=l(),f=l();return u[e]=a,c[i]=s,f[r]=o,this.set(u,c,f)},extract:function(t,n,e){if(!n||!n.length)return this;e=e||0;var r,s,o=e>>>16&255,u=e>>>8&255,c=255&e,f=l(0,o),m=l(0,u),h=l(0,c);switch(t||i.R){case i.B:for(r=n[0],s=n[1];s>=r;)h[r]=a(r),r++;break;case i.G:for(r=n[0],s=n[1];s>=r;)m[r]=a(r),r++;break;case i.R:default:for(r=n[0],s=n[1];s>=r;)f[r]=a(r),r++}return this.set(f,m,h)},gammaCorrection:function(t,n,e){t=t||1,n=n||t,e=e||n,t=1/t,n=1/n,e=1/e;var i=new r(256),s=new r(256),l=new r(256),o=0;for(o=0;256>o;o++)i[o]=a(~~(255*u(f*o,t))),s[o]=a(~~(255*u(f*o,n))),l[o]=a(~~(255*u(f*o,e)));return this.set(i,s,l)},exposure:function(t){null==t&&(t=1);var n=0,e=new r(256);for(n=0;256>n;n++)e[n]=a(~~(255*(1-c(-t*n*f))));return this.set(e)},set:function(t,n,e,r){if(!t)return this;var a,s,u=this._table,c=u[i.R]||l();return n||e?(n=n||t,e=e||n,a=u[i.G]||c,s=u[i.B]||a,u[i.R]=o(t,c),u[i.G]=o(n,a),u[i.B]=o(e,s)):(u[i.R]=o(t,c),u[i.G]=u[i.R],u[i.B]=u[i.R]),this},reset:function(){return this._table=[null,null,null,null],this},combineWith:function(t){return this.set(t.getTable(i.R),t.getTable(i.G),t.getTable(i.B))},getTable:function(t){return this._table[t||i.R]||null},setTable:function(t,n){return this._table[n||i.R]=t||null,this},_apply:function(t,n,e){var r=this,a=r._table;if(!r._isOn||!a||!a[i.R])return t;var s,l=t.length,o=l>>>2,u=(15&o)<<2,c=a[0],f=a[1],m=a[2],h=a[3];if(h){for(s=0;l>s;s+=64)t[s]=c[t[s]],t[s+1]=f[t[s+1]],t[s+2]=m[t[s+2]],t[s+3]=h[t[s+3]],t[s+4]=c[t[s+4]],t[s+5]=f[t[s+5]],t[s+6]=m[t[s+6]],t[s+7]=h[t[s+7]],t[s+8]=c[t[s+8]],t[s+9]=f[t[s+9]],t[s+10]=m[t[s+10]],t[s+11]=h[t[s+11]],t[s+12]=c[t[s+12]],t[s+13]=f[t[s+13]],t[s+14]=m[t[s+14]],t[s+15]=h[t[s+15]],t[s+16]=c[t[s+16]],t[s+17]=f[t[s+17]],t[s+18]=m[t[s+18]],t[s+19]=h[t[s+19]],t[s+20]=c[t[s+20]],t[s+21]=f[t[s+21]],t[s+22]=m[t[s+22]],t[s+23]=h[t[s+23]],t[s+24]=c[t[s+24]],t[s+25]=f[t[s+25]],t[s+26]=m[t[s+26]],t[s+27]=h[t[s+27]],t[s+28]=c[t[s+28]],t[s+29]=f[t[s+29]],t[s+30]=m[t[s+30]],t[s+31]=h[t[s+31]],t[s+32]=c[t[s+32]],t[s+33]=f[t[s+33]],t[s+34]=m[t[s+34]],t[s+35]=h[t[s+35]],t[s+36]=c[t[s+36]],t[s+37]=f[t[s+37]],t[s+38]=m[t[s+38]],t[s+39]=h[t[s+39]],t[s+40]=c[t[s+40]],t[s+41]=f[t[s+41]],t[s+42]=m[t[s+42]],t[s+43]=h[t[s+43]],t[s+44]=c[t[s+44]],t[s+45]=f[t[s+45]],t[s+46]=m[t[s+46]],t[s+47]=h[t[s+47]],t[s+48]=c[t[s+48]],t[s+49]=f[t[s+49]],t[s+50]=m[t[s+50]],t[s+51]=h[t[s+51]],t[s+52]=c[t[s+52]],t[s+53]=f[t[s+53]],t[s+54]=m[t[s+54]],t[s+55]=h[t[s+55]],t[s+56]=c[t[s+56]],t[s+57]=f[t[s+57]],t[s+58]=m[t[s+58]],t[s+59]=h[t[s+59]],t[s+60]=c[t[s+60]],t[s+61]=f[t[s+61]],t[s+62]=m[t[s+62]],t[s+63]=h[t[s+63]];if(u){for(s=l-u;l>s;s+=4)t[s]=c[t[s]];t[s+1]=f[t[s+1]],t[s+2]=m[t[s+2]],t[s+3]=h[t[s+3]]}}else{for(s=0;l>s;s+=64)t[s]=c[t[s]],t[s+1]=f[t[s+1]],t[s+2]=m[t[s+2]],t[s+4]=c[t[s+4]],t[s+5]=f[t[s+5]],t[s+6]=m[t[s+6]],t[s+8]=c[t[s+8]],t[s+9]=f[t[s+9]],t[s+10]=m[t[s+10]],t[s+12]=c[t[s+12]],t[s+13]=f[t[s+13]],t[s+14]=m[t[s+14]],t[s+16]=c[t[s+16]],t[s+17]=f[t[s+17]],t[s+18]=m[t[s+18]],t[s+20]=c[t[s+20]],t[s+21]=f[t[s+21]],t[s+22]=m[t[s+22]],t[s+24]=c[t[s+24]],t[s+25]=f[t[s+25]],t[s+26]=m[t[s+26]],t[s+28]=c[t[s+28]],t[s+29]=f[t[s+29]],t[s+30]=m[t[s+30]],t[s+32]=c[t[s+32]],t[s+33]=f[t[s+33]],t[s+34]=m[t[s+34]],t[s+36]=c[t[s+36]],t[s+37]=f[t[s+37]],t[s+38]=m[t[s+38]],t[s+40]=c[t[s+40]],t[s+41]=f[t[s+41]],t[s+42]=m[t[s+42]],t[s+44]=c[t[s+44]],t[s+45]=f[t[s+45]],t[s+46]=m[t[s+46]],t[s+48]=c[t[s+48]],t[s+49]=f[t[s+49]],t[s+50]=m[t[s+50]],t[s+52]=c[t[s+52]],t[s+53]=f[t[s+53]],t[s+54]=m[t[s+54]],t[s+56]=c[t[s+56]],t[s+57]=f[t[s+57]],t[s+58]=m[t[s+58]],t[s+60]=c[t[s+60]],t[s+61]=f[t[s+61]],t[s+62]=m[t[s+62]];if(u){for(s=l-u;l>s;s+=4)t[s]=c[t[s]];t[s+1]=f[t[s+1]],t[s+2]=m[t[s+2]]}}return t},canRun:function(){return this._isOn&&this._table&&this._table[i.R]}});h.prototype.posterize=h.prototype.levels=h.prototype.quantize,t.TableLookupFilter=t.ColorTableFilter}(n),!function(t,n){function i(t,n,e){var i=new a(20);return i[0]=t[0]+e*(n[0]-t[0]),i[1]=t[1]+e*(n[1]-t[1]),i[2]=t[2]+e*(n[2]-t[2]),i[3]=t[3]+e*(n[3]-t[3]),i[4]=t[4]+e*(n[4]-t[4]),i[5]=t[5]+e*(n[5]-t[5]),i[6]=t[6]+e*(n[6]-t[6]),i[7]=t[7]+e*(n[7]-t[7]),i[8]=t[8]+e*(n[8]-t[0]),i[9]=t[9]+e*(n[9]-t[9]),i[10]=t[10]+e*(n[10]-t[10]),i[11]=t[11]+e*(n[11]-t[11]),i[12]=t[12]+e*(n[12]-t[12]),i[13]=t[13]+e*(n[13]-t[13]),i[14]=t[14]+e*(n[14]-t[14]),i[15]=t[15]+e*(n[15]-t[15]),i[16]=t[16]+e*(n[16]-t[16]),i[17]=t[17]+e*(n[17]-t[17]),i[18]=t[18]+e*(n[18]-t[18]),i[19]=t[19]+e*(n[19]-t[19]),i}var r=t.CHANNEL,a=t.ColorMatrix,s=t.Array8U,l=t.Util.Filter,o=(l.cm_eye,l.cm_multiply),u=l.cm_rechannel,c=Math.sin,f=Math.cos,m=t.CONST.toRad,h=(t.CONST.toDeg,t.Util.Array.typed),_=t._notSupportClamp,p=t.ColorMatrixFilter=t.Class(t.Filter,{name:"ColorMatrixFilter",constructor:function d(t){var n=this;return n instanceof d?(n.$super("constructor"),void(n.matrix=t&&t.length?new a(t):null)):new d(t)},path:e,matrix:null,dispose:function(){var t=this;return t.matrix=null,t.$super("dispose"),t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{matrix:t.matrix}}},unserialize:function(t){var n,e=this;return t&&e.name===t.filter&&(e._isOn=!!t._isOn,n=t.params,e.matrix=h(n.matrix,a)),e},channel:function(t,n){t=t||0;var e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],i=r.A===t||n?1:0;return e[5*r.R+t]=r.R===t?1:i,e[5*r.G+t]=r.G===t?1:i,e[5*r.B+t]=r.B===t?1:i,this.set(e)},redChannel:function(t){return this.channel(r.R,t)},greenChannel:function(t){return this.channel(r.G,t)},blueChannel:function(t){return this.channel(r.B,t)},alphaChannel:function(t){return this.channel(r.A,!0)},maskChannel:function(t){if(t=t||0,r.A===t)return this;var n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return n[5*t+t]=0,this.set(n)},swapChannels:function(t,n){if(t===n)return this;var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return e[5*t+t]=0,e[5*n+n]=0,e[5*t+n]=1,e[5*n+t]=1,this.set(e)},invertChannel:function(t){if(t=t||0,r.A===t)return this;var n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return n[5*t+t]=-1,n[5*t+4]=255,this.set(n)},invertRed:function(){return this.invertChannel(r.R)},invertGreen:function(){return this.invertChannel(r.G)},invertBlue:function(){return this.invertChannel(r.B)},invertAlpha:function(){return this.invertChannel(r.A)},invert:function(){return this.set(u([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},desaturate:function(){var n=t.LUMA;return this.set(u([n[0],n[1],n[2],0,0,n[0],n[1],n[2],0,0,n[0],n[1],n[2],0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},saturate:function(n){var e,i,a,s,l=t.LUMA;return e=1-n,i=e*l[0],a=e*l[1],s=e*l[2],this.set(u([i+n,a,s,0,0,i,a+n,s,0,0,i,a,s+n,0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},colorize:function(n,e){var i,a,s,l,o=t.LUMA;return null==e&&(e=1),i=.00392156862745098*(n>>16&255),a=.00392156862745098*(n>>8&255),s=.00392156862745098*(255&n),l=1-e,this.set(u([l+e*i*o[0],e*i*o[1],e*i*o[2],0,0,e*a*o[0],l+e*a*o[1],e*a*o[2],0,0,e*s*o[0],e*s*o[1],l+e*s*o[2],0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},contrast:function(t,n,e){return null==n&&(n=t),null==e&&(e=t),t+=1,n+=1,e+=1,this.set(u([t,0,0,0,128*(1-t),0,n,0,0,128*(1-n),0,0,e,0,128*(1-e),0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},brightness:function(t,n,e){return null==n&&(n=t),null==e&&(e=t),this.set(u([1,0,0,0,t,0,1,0,0,n,0,0,1,0,e,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},adjustHue:function(n){n*=m;var e=f(n),i=c(n),a=t.LUMA;return this.set(u([a[0]+e*(1-a[0])+i*-a[0],a[1]+e*-a[1]+i*-a[1],a[2]+e*-a[2]+i*(1-a[2]),0,0,a[0]+e*-a[0]+.143*i,a[1]+e*(1-a[1])+.14*i,a[2]+e*-a[2]+i*-.283,0,0,a[0]+e*-a[0]+i*-(1-a[0]),a[1]+e*-a[1]+i*a[1],a[2]+e*(1-a[2])+i*a[2],0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},average:function(t,n,e){return null==t&&(t=.3333),null==n&&(n=.3333),null==e&&(e=.3334),this.set(u([t,n,e,0,0,t,n,e,0,0,t,n,e,0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},quickContrastCorrection:function(t){return null==t&&(t=1.2),this.set(u([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},sepia:function(t){return null==t&&(t=.5),t>1?t=1:0>t&&(t=0),this.set(u([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},sepia2:function(n){null==n&&(n=10),n>100&&(n=100),n*=2.55;var e=t.LUMA;return this.set(u([e[0],e[1],e[2],0,40,e[0],e[1],e[2],0,20,e[0],e[1],e[2],0,-n,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},threshold:function(n,e,i){null==e&&(e=256);var a=t.LUMA;return this.set(u(!1!==i?[a[0]*e,a[1]*e,a[2]*e,0,-(e-1)*n,a[0]*e,a[1]*e,a[2]*e,0,-(e-1)*n,a[0]*e,a[1]*e,a[2]*e,0,-(e-1)*n,0,0,0,1,0]:[e,0,0,0,-(e-1)*n,0,e,0,0,-(e-1)*n,0,0,e,0,-(e-1)*n,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},thresholdRGB:function(t,n){return this.threshold(t,n,!1)},thresholdChannel:function(n,e,i,a){null==i&&(i=256);var s=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],l=t.LUMA;return r.A===n?(s[5*n+n]=i,s[5*n+4]=-i*e):!1!==a?(s[5*n+r.R]=l[0]*i,s[5*n+r.G]=l[1]*i,s[5*n+r.B]=l[2]*i,s[5*n+4]=-(i-1)*e):(s[5*n+r.R]=i,s[5*n+r.G]=i,s[5*n+r.B]=i,s[5*n+4]=-(i-1)*e),this.set(s)},thresholdRed:function(t,n,e){return this.thresholdChannel(r.R,t,n,e)},thresholdGreen:function(t,n,e){return this.thresholdChannel(r.G,t,n,e)},thresholdBlue:function(t,n,e){return this.thresholdChannel(r.B,t,n,e)},thresholdAlpha:function(t,n,e){return this.thresholdChannel(r.A,t,n,e)},RGB2YCbCr:function(){return this.set(u([.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,.5,-.418688,-.081312,0,128,0,0,0,1,0],r.R,r.G,r.B,r.A,r.Y,r.CB,r.CR,r.A))},YCbCr2RGB:function(){return this.set(u([1,0,1.402,0,-179.456,1,-.34414,-.71414,0,135.45984,1,1.772,0,0,-226.816,0,0,0,1,0],r.Y,r.CB,r.CR,r.A,r.R,r.G,r.B,r.A))},blend:function(t,n){return this.matrix=this.matrix?i(this.matrix,t.matrix,n):new a(t.matrix),this},set:function(t){var n=this;return n.matrix=n.matrix?o(n.matrix,t):new a(t),n},reset:function(){return this.matrix=null,this},combineWith:function(t){return this.set(t.matrix)},_apply:_?function(t,n,e){var i=this,r=i.matrix;if(!i._isOn||!r)return t;var l,o=t.length,u=o>>>2,c=(7&u)<<2,f=new a(32),m=new s(4),h=new a(4);for(l=0;o>l;l+=32)m[0]=t[l],m[1]=t[l+1],m[2]=t[l+2],m[3]=t[l+3],f[0]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[1]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[2]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[3]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+4],m[1]=t[l+5],m[2]=t[l+6],m[3]=t[l+7],f[4]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[5]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[6]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[7]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+8],m[1]=t[l+9],m[2]=t[l+10],m[3]=t[l+11],f[8]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[9]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[10]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[11]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+12],m[1]=t[l+13],m[2]=t[l+14],m[3]=t[l+15],f[12]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[13]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[14]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[15]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+16],m[1]=t[l+17],m[2]=t[l+18],m[3]=t[l+19],f[16]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[17]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[18]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[19]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+20],m[1]=t[l+21],m[2]=t[l+22],m[3]=t[l+23],f[20]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[21]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[22]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[23]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+24],m[1]=t[l+25],m[2]=t[l+26],m[3]=t[l+27],f[24]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[25]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[26]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[27]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+28],m[1]=t[l+29],m[2]=t[l+30],m[3]=t[l+31],f[28]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[29]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[30]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[31]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],f[0]=f[0]<0?0:f[0]>255?255:f[0],f[1]=f[1]<0?0:f[1]>255?255:f[1],f[2]=f[2]<0?0:f[2]>255?255:f[2],f[3]=f[3]<0?0:f[3]>255?255:f[3],f[4]=f[4]<0?0:f[4]>255?255:f[4],f[5]=f[5]<0?0:f[5]>255?255:f[5],f[6]=f[6]<0?0:f[6]>255?255:f[6],f[7]=f[7]<0?0:f[7]>255?255:f[7],f[8]=f[8]<0?0:f[8]>255?255:f[8],f[9]=f[9]<0?0:f[9]>255?255:f[9],f[10]=f[10]<0?0:f[10]>255?255:f[10],f[11]=f[11]<0?0:f[11]>255?255:f[11],f[12]=f[12]<0?0:f[12]>255?255:f[12],f[13]=f[13]<0?0:f[13]>255?255:f[13],f[14]=f[14]<0?0:f[14]>255?255:f[14],f[15]=f[15]<0?0:f[15]>255?255:f[15],f[16]=f[16]<0?0:f[16]>255?255:f[16],f[17]=f[17]<0?0:f[17]>255?255:f[17],f[18]=f[18]<0?0:f[18]>255?255:f[18],f[19]=f[19]<0?0:f[19]>255?255:f[19],f[20]=f[20]<0?0:f[20]>255?255:f[20],f[21]=f[21]<0?0:f[21]>255?255:f[21],f[22]=f[22]<0?0:f[22]>255?255:f[22],f[23]=f[23]<0?0:f[23]>255?255:f[23],f[24]=f[24]<0?0:f[24]>255?255:f[24],f[25]=f[25]<0?0:f[25]>255?255:f[25],f[26]=f[26]<0?0:f[26]>255?255:f[26],f[27]=f[27]<0?0:f[27]>255?255:f[27],f[28]=f[28]<0?0:f[28]>255?255:f[28],f[29]=f[29]<0?0:f[29]>255?255:f[29],f[30]=f[30]<0?0:f[30]>255?255:f[30],f[31]=f[31]<0?0:f[31]>255?255:f[31],t[l]=~~f[0],t[l+1]=~~f[1],t[l+2]=~~f[2],t[l+3]=~~f[3],t[l+4]=~~f[4],t[l+5]=~~f[5],t[l+6]=~~f[6],t[l+7]=~~f[7],t[l+8]=~~f[8],t[l+9]=~~f[9],t[l+10]=~~f[10],t[l+11]=~~f[11],t[l+12]=~~f[12],t[l+13]=~~f[13],t[l+14]=~~f[14],t[l+15]=~~f[15],t[l+16]=~~f[16],t[l+17]=~~f[17],t[l+18]=~~f[18],t[l+19]=~~f[19],t[l+20]=~~f[20],t[l+21]=~~f[21],t[l+22]=~~f[22],t[l+23]=~~f[23],t[l+24]=~~f[24],t[l+25]=~~f[25],t[l+26]=~~f[26],t[l+27]=~~f[27],t[l+28]=~~f[28],t[l+29]=~~f[29],t[l+30]=~~f[30],t[l+31]=~~f[31];if(c)for(l=o-c;o>l;l+=4)m[0]=t[l],m[1]=t[l+1],m[2]=t[l+2],m[3]=t[l+3],h[0]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],h[1]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],h[2]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],h[3]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],h[0]=h[0]<0?0:h[0]>255?255:h[0],h[1]=h[1]<0?0:h[1]>255?255:h[1],h[2]=h[2]<0?0:h[2]>255?255:h[2],h[3]=h[3]<0?0:h[3]>255?255:h[3],t[l]=~~h[0],t[l+1]=~~h[1],t[l+2]=~~h[2],t[l+3]=~~h[3];return t}:function(t,n,e){var i=this,r=i.matrix;if(!i._isOn||!r)return t;var l,o=t.length,u=o>>>2,c=(7&u)<<2,f=new a(32),m=new s(4),h=new a(4);for(l=0;o>l;l+=32)m[0]=t[l],m[1]=t[l+1],m[2]=t[l+2],m[3]=t[l+3],f[0]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[1]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[2]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[3]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+4],m[1]=t[l+5],m[2]=t[l+6],m[3]=t[l+7],f[4]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[5]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[6]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[7]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+8],m[1]=t[l+9],m[2]=t[l+10],m[3]=t[l+11],f[8]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[9]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[10]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[11]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+12],m[1]=t[l+13],m[2]=t[l+14],m[3]=t[l+15],f[12]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[13]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[14]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[15]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+16],m[1]=t[l+17],m[2]=t[l+18],m[3]=t[l+19],f[16]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[17]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[18]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[19]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+20],m[1]=t[l+21],m[2]=t[l+22],m[3]=t[l+23],f[20]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[21]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[22]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[23]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+24],m[1]=t[l+25],m[2]=t[l+26],m[3]=t[l+27],f[24]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[25]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[26]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[27]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],m[0]=t[l+28],m[1]=t[l+29],m[2]=t[l+30],m[3]=t[l+31],f[28]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],f[29]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],f[30]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],f[31]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],t[l]=~~f[0],t[l+1]=~~f[1],t[l+2]=~~f[2],t[l+3]=~~f[3],t[l+4]=~~f[4],t[l+5]=~~f[5],t[l+6]=~~f[6],t[l+7]=~~f[7],t[l+8]=~~f[8],t[l+9]=~~f[9],t[l+10]=~~f[10],t[l+11]=~~f[11],t[l+12]=~~f[12],t[l+13]=~~f[13],t[l+14]=~~f[14],t[l+15]=~~f[15],t[l+16]=~~f[16],t[l+17]=~~f[17],t[l+18]=~~f[18],t[l+19]=~~f[19],t[l+20]=~~f[20],t[l+21]=~~f[21],t[l+22]=~~f[22],t[l+23]=~~f[23],t[l+24]=~~f[24],t[l+25]=~~f[25],t[l+26]=~~f[26],t[l+27]=~~f[27],t[l+28]=~~f[28],t[l+29]=~~f[29],t[l+30]=~~f[30],t[l+31]=~~f[31];if(c)for(l=o-c;o>l;l+=4)m[0]=t[l],m[1]=t[l+1],m[2]=t[l+2],m[3]=t[l+3],h[0]=r[0]*m[0]+r[1]*m[1]+r[2]*m[2]+r[3]*m[3]+r[4],h[1]=r[5]*m[0]+r[6]*m[1]+r[7]*m[2]+r[8]*m[3]+r[9],h[2]=r[10]*m[0]+r[11]*m[1]+r[12]*m[2]+r[13]*m[3]+r[14],h[3]=r[15]*m[0]+r[16]*m[1]+r[17]*m[2]+r[18]*m[3]+r[19],t[l]=~~h[0],t[l+1]=~~h[1],t[l+2]=~~h[2],t[l+3]=~~h[3];return t},canRun:function(){return this._isOn&&this.matrix}});p.prototype.grayscale=p.prototype.desaturate,p.prototype.rotateHue=p.prototype.adjustHue,p.prototype.threshold_rgb=p.prototype.thresholdRGB,p.prototype.threshold_alpha=p.prototype.thresholdAlpha,p.blend=i}(n),!function(t,n){function i(n,e){var i=e?o(e):"",r=o(n),a=l?"c[0] = 0>c[0] ? 0 : (255<c[0] ? 255: c[0]); c[1] = 0>c[1] ? 0 : (255<c[1] ? 255: c[1]); c[2] = 0>c[2] ? 0 : (255<c[2] ? 255: c[2]); c[3] = 0>c[3] ? 0 : (255<c[3] ? 255: c[3]);":"";return new Function("FILTER","return function( im, w, h ){    var self = this;    if ( !self._isOn || !self._map ) return im;    var x, y, i, imLen = im.length, imArea = imLen>>>2, rem = (imArea&7)<<2, c = new FILTER.ColorMatrix(4);    "+i+";        for (x=0,y=0,i=0; i<imLen; i+=32)    {        c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+r+";        "+a+";        im[i] = ~~c[0]; im[i+1] = ~~c[1]; im[i+2] = ~~c[2]; im[i+3] = ~~c[3];                if (++x>=w) {x=0; y++;}        c[0] = im[i+4]; c[1] = im[i+5]; c[2] = im[i+6]; c[3] = im[i+7];        "+r+";        "+a+";        im[i+4] = ~~c[0]; im[i+5] = ~~c[1]; im[i+6] = ~~c[2]; im[i+7] = ~~c[3];                if (++x>=w) {x=0; y++;}        c[0] = im[i+8]; c[1] = im[i+9]; c[2] = im[i+10]; c[3] = im[i+11];        "+r+";        "+a+";        im[i+8] = ~~c[0]; im[i+9] = ~~c[1]; im[i+10] = ~~c[2]; im[i+11] = ~~c[3];                if (++x>=w) {x=0; y++;}        c[0] = im[i+12]; c[1] = im[i+13]; c[2] = im[i+14]; c[3] = im[i+15];        "+r+";        "+a+";        im[i+12] = ~~c[0]; im[i+13] = ~~c[1]; im[i+14] = ~~c[2]; im[i+15] = ~~c[3];                if (++x>=w) {x=0; y++;}        c[0] = im[i+16]; c[1] = im[i+17]; c[2] = im[i+18]; c[3] = im[i+19];        "+r+";        "+a+";        im[i+16] = ~~c[0]; im[i+17] = ~~c[1]; im[i+18] = ~~c[2]; im[i+19] = ~~c[3];                if (++x>=w) {x=0; y++;}        c[0] = im[i+20]; c[1] = im[i+21]; c[2] = im[i+22]; c[3] = im[i+23];        "+r+";        "+a+";        im[i+20] = ~~c[0]; im[i+21] = ~~c[1]; im[i+22] = ~~c[2]; im[i+23] = ~~c[3];                if (++x>=w) {x=0; y++;}        c[0] = im[i+24]; c[1] = im[i+25]; c[2] = im[i+26]; c[3] = im[i+27];        "+r+";        "+a+";        im[i+24] = ~~c[0]; im[i+25] = ~~c[1]; im[i+26] = ~~c[2]; im[i+27] = ~~c[3];                if (++x>=w) {x=0; y++;}        c[0] = im[i+28]; c[1] = im[i+29]; c[2] = im[i+30]; c[3] = im[i+31];        "+r+";        "+a+";        im[i+28] = ~~c[0]; im[i+29] = ~~c[1]; im[i+30] = ~~c[2]; im[i+31] = ~~c[3];                if (++x>=w) {x=0; y++;}    }    if ( rem )    {        for (i=imLen-rem; i<imLen; i+=4,x++)        {            if (x>=w) {x=0; y++;}            c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];            "+r+";            "+a+";            im[i] = ~~c[0]; im[i+1] = ~~c[1]; im[i+2] = ~~c[2]; im[i+3] = ~~c[3];        }    }    return im;};")(t)}var r,a=(t.CHANNEL,t.MODE),s=(t.Color,t.ColorMatrix,t.Util.Array.typed),l=t._notSupportClamp,o=t.Util.String.function_body,u=t.ColorMapFilter=t.Class(t.Filter,{name:"ColorMapFilter",constructor:function c(t,n){var e=this;return e instanceof c?(e.$super("constructor"),void(t&&e.set(t,n))):new c(t,n)},path:e,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,thresholds:null,quantizedColors:null,mode:a.COLOR,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.thresholds=null,t.quantizedColors=null,t.$super("dispose"),t},serialize:function(){var t,n=this;return t={filter:n.name,_isOn:!!n._isOn,params:{_mapName:n._mapName||null,_map:"generic"===n._mapName&&n._map&&n._mapChanged?n._map.toString():null,_mapInit:"generic"===n._mapName&&n._mapInit&&n._mapChanged?n._mapInit.toString():null,thresholds:n.thresholds,quantizedColors:n.quantizedColors,mode:n.mode}},n._mapChanged=!1,t},unserialize:function(t){var n,e=this;return t&&e.name===t.filter&&(e._isOn=!!t._isOn,n=t.params,e.mode=n.mode,e.thresholds=s(n.thresholds,Array),e.quantizedColors=s(n.quantizedColors,Array),!n._map&&n._mapName&&r.hasOwnProperty(n._mapName)?e.set(n._mapName):n._map&&"generic"===n._mapName&&e.set(n._map,n._mapInit||null,1)),e},RGB2HSV:function(){return this.set("rgb2hsv")},HSV2RGB:function(){return this.set("hsv2rgb")},RGB2CMYK:function(){return this.set("rgb2cmyk")},hue:function(){return this.set("hue")},saturation:function(){return this.set("saturation")},quantize:function(t,n){var e=this;return e.thresholds=t,e.quantizedColors=n,e.set("quantize")},mask:function(t,n,e){var i=this;return i.thresholds=[t,n],i.quantizedColors=[e||0],i.set("mask")},set:function(t,n,e){var a=this;return e||"function"==typeof t?(a._mapName="generic",a._map=T,a._mapInit=n||null,a._apply=i(a._map,a._mapInit),a._mapChanged=!e):t&&r.hasOwnProperty(String(t))&&a._mapName!==String(t)&&(a._mapName=String(t),a._map=r[a._mapName],a._mapInit=r["init__"+a._mapName],a._apply=i(a._map,a._mapInit),a._mapChanged=!1),a},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t},canRun:function(){return this._isOn&&this._map}});u.prototype.threshold=u.prototype.quantize,u.prototype.extract=u.prototype.mask,r={rgb2hsv:"function( ){        if ( 0 !== c[3] )        {            RGB2HSV(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CV] = C2;        }    }",init__rgb2hsv:"function( ){        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, RGB2HSV = FILTER.Color.RGB2HSV;    }",hsv2rgb:"function( ){        if ( 0 !== c[3] )        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CV];            c[0] = C0; c[1] = C1; c[2] = C2;            HSV2RGB(c, 0);        }    }",init__hsv2rgb:"function( ){        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, HSV2RGB = FILTER.Color.HSV2RGB;    }",rgb2cmyk:"function( ){        if ( 0 !== c[3] )        {            RGB2CMYK(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CY] = C0; c[MA] = C1; c[YE] = C2;        }    }",init__rgb2cmyk:"function( ){        var C0, C1, C2, CY = FILTER.CHANNEL.CY, MA = FILTER.CHANNEL.MA, YE = FILTER.CHANNEL.YE, RGB2CMYK = FILTER.Color.RGB2CMYK;    }",hue:"function( ){        if ( 0 !== c[3] )        {            HHH = HUE(c[0], c[1], c[2])*0.70833333333333333333333333333333;            c[0] = HHH; c[1] = HHH; c[2] = HHH;        }    }",init__hue:"function( ){        var HUE = FILTER.Color.hue, HHH;    }",saturation:"function( ){        if ( 0 !== c[3] )        {            SSS = SATURATION(c[0], c[1], c[2]);            c[0] = SSS; c[1] = SSS; c[2] = SSS;        }    }",init__saturation:"function( ){        var SATURATION = FILTER.Color.saturation, SSS;    }",quantize:"function( ){        if ( 0 !== c[3] )        {            J = 0; V = VALUE(c[0], c[1], c[2]);            while (J<THRESH_LEN && V>THRESH[J]) J++;            COLVAL = J < COLORS_LEN ? COLORS[j] : 0xffffff;            c[0] = (COLVAL >>> 16) & 255; c[1] = (COLVAL >>> 8) & 255; c[2] = COLVAL & 255;        }    }",init__quantize:"function( ){        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            THRESH = self.thresholds, THRESH_LEN = THRESH.length,            COLORS = self.quantizedColors, COLORS_LEN = COLORS.length, J, COLVAL, V;    }",mask:"function( ){        if ( 0 !== c[3] )        {            V = VALUE(c[0], c[1], c[2]);            if ( (V < MIN_VALUE) || (V > MAX_VALUE) )            {                c[0] = COLVAL[0];                c[1] = COLVAL[1];                c[2] = COLVAL[2];                c[3] = COLVAL[3];            }        }    }",
init__mask:"function( ){        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            MIN_VALUE = self.thresholds[0], MAX_VALUE = self.thresholds[self.thresholds.length-1],            COLVAL = [(self.quantizedColors[0] >>> 16) & 255, (self.quantizedColors[0] >>> 8) & 255, self.quantizedColors[0] & 255, (self.quantizedColors[0] >>> 24) & 255], V;    }"}}(n),!function(t,n){var i=t.ImArray,r=t.AffineMatrix,a=t.Util.Array.typed,s=t.Util.Filter,l=(s.am_eye,s.am_multiply),o=t.MODE,u=(t.CONST.toRad,Math.sin),c=Math.cos,f=Math.tan,m=t.AffineMatrixFilter=t.Class(t.Filter,{name:"AffineMatrixFilter",constructor:function h(t){var n=this;return n instanceof h?(n.$super("constructor"),void(n.matrix=t&&t.length?new r(t):null)):new h(t)},path:e,matrix:null,mode:o.CLAMP,color:0,dispose:function(){var t=this;return t.matrix=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{matrix:t.matrix,mode:t.mode,color:t.color}}},unserialize:function(t){var n,e=this;return t&&e.name===t.filter&&(e._isOn=!!t._isOn,n=t.params,e.matrix=a(n.matrix,r),e.mode=n.mode,e.color=n.color),e},flipX:function(){return this.set([-1,0,0,1,0,1,0,0])},flipY:function(){return this.set([1,0,0,0,0,-1,0,1])},flipXY:function(){return this.set([-1,0,0,1,0,-1,0,1])},translate:function(t,n,e){return this.set(e?[1,0,0,t,0,1,0,n]:[1,0,t,0,0,1,n,0])},rotate:function(t){var n=u(t),e=c(t);return this.set([e,-n,0,0,n,e,0,0])},scale:function(t,n){return this.set([t,0,0,0,0,n,0,0])},skew:function(t,n){return this.set([1,t?f(t):0,0,0,n?f(n):0,1,0,0])},set:function(t){var n=this;return n.matrix=n.matrix?l(n.matrix,t):new r(t),n},reset:function(){return this.matrix=null,this},combineWith:function(t){return this.set(t.matrix)},_apply:function(t,n,e){var r=this,a=r.matrix;if(!r._isOn||!a)return t;var s,l,u,c,f,m,h,_,p,d,g,v=t.length,C=v>>>2,R=n-1,y=C-n,w=new i(v),A=r.color||0,x=o.COLOR,b=o.CLAMP,O=o.WRAP,L=o.IGNORE,I=a[0],E=a[1],T=a[2]+a[3]*R,N=a[4]*n,S=a[5],F=a[6]*n+a[7]*y,M=r.mode||b;if(x===M)for(g=A>>>24&255,_=A>>>16&255,p=A>>>8&255,d=255&A,s=0,l=0,u=0,m=0;v>m;m+=4,s++)s>=n&&(s=0,l++,u+=n),c=I*s+E*l+T,f=N*s+S*u+F,0>c||c>R||0>f||f>y?(w[m]=_,w[m+1]=p,w[m+2]=d,w[m+3]=g):(h=~~c+~~f<<2,w[m]=t[h],w[m+1]=t[h+1],w[m+2]=t[h+2],w[m+3]=t[h+3]);else if(L===M)for(s=0,l=0,u=0,m=0;v>m;m+=4,s++)s>=n&&(s=0,l++,u+=n),c=I*s+E*l+T,f=N*s+S*u+F,f=f>y||0>f?u:f,c=c>R||0>c?s:c,h=~~c+~~f<<2,w[m]=t[h],w[m+1]=t[h+1],w[m+2]=t[h+2],w[m+3]=t[h+3];else if(O===M)for(s=0,l=0,u=0,m=0;v>m;m+=4,s++)s>=n&&(s=0,l++,u+=n),c=I*s+E*l+T,f=N*s+S*u+F,f=f>y?f-C:0>f?f+C:f,c=c>R?c-n:0>c?c+n:c,h=~~c+~~f<<2,w[m]=t[h],w[m+1]=t[h+1],w[m+2]=t[h+2],w[m+3]=t[h+3];else for(s=0,l=0,u=0,m=0;v>m;m+=4,s++)s>=n&&(s=0,l++,u+=n),c=I*s+E*l+T,f=N*s+S*u+F,f=f>y?y:0>f?0:f,c=c>R?R:0>c?0:c,h=~~c+~~f<<2,w[m]=t[h],w[m+1]=t[h+1],w[m+2]=t[h+2],w[m+3]=t[h+3];return w},canRun:function(){return this._isOn&&this.matrix}});m.prototype.shift=m.prototype.translate}(n),!function(t,n){var i=t.ImArray,r=t.ImArrayCopy,a=t.Util.Array.typed,s=t.MODE,l=t.Array16I,o=Math.min,u=(Math.max,Math.floor);t.DisplacementMapFilter=t.Class(t.Filter,{name:"DisplacementMapFilter",constructor:function c(t){var n=this;return n instanceof c?(n.$super("constructor"),void(t&&n.setMap(t))):new c(t)},path:e,_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:s.CLAMP,dispose:function(){var t=this;return t._map=null,t.map=null,t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this,n=t.map;return{filter:t.name,_isOn:!!t._isOn,params:{_map:t._map||(n?{data:n.getData(),width:n.width,height:n.height}:null),scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color,mode:t.mode}}},unserialize:function(t){var n,e=this;return t&&e.name===t.filter&&(e._isOn=!!t._isOn,n=t.params,e.map=null,e._map=n._map,e._map&&(e._map.data=a(e._map.data,i)),e.scaleX=n.scaleX,e.scaleY=n.scaleY,e.startX=n.startX,e.startY=n.startY,e.componentX=n.componentX,e.componentY=n.componentY,e.color=n.color,e.mode=n.mode),e},reset:function(){var t=this;return t._map=null,t.map=null,t},getMap:function(){return this.map},setMap:function(t){var n=this;return t&&(n.map=t,n._map=null),n},_apply:function(t,n,e){var i=this,a=i.map;if(!i._isOn||!a&&!i._map)return t;var c,f,m,h,_,p,d,g,v,C,R,y,w,A,x,b,O,L,I,E,T,N,S,F,M,G,B,Y,H,X,z,k,D,U,V,q,P=i._map||{data:a.getData(),width:a.width,height:a.height},j=i.color||0,$=n-1,W=e-1,J=.00390625*i.scaleX,K=.00390625*i.scaleY,Q=i.componentX,Z=i.componentY,tt=s.IGNORE,nt=s.CLAMP,et=s.COLOR,it=s.WRAP,rt=i.mode||nt;for(c=P.data,f=P.width,m=P.height,D=c.length,h=D>>>2,p=o(f,n),d=o(m,e),k=t.length,X=p*d<<2,z=k>>>2,w=u(i.startX*$),y=u(i.startY*W),A=y*n,x=-w,b=-y,O=$-w,L=W-y,_=new l(h<<1),U=new r(t),I=(15&h)<<2,T=0,E=0;D>E;E+=64)_[T++]=u((c[E+Q]-128)*J),_[T++]=u((c[E+Z]-128)*K),_[T++]=u((c[E+4+Q]-128)*J),_[T++]=u((c[E+4+Z]-128)*K),_[T++]=u((c[E+8+Q]-128)*J),_[T++]=u((c[E+8+Z]-128)*K),_[T++]=u((c[E+12+Q]-128)*J),_[T++]=u((c[E+12+Z]-128)*K),_[T++]=u((c[E+16+Q]-128)*J),_[T++]=u((c[E+16+Z]-128)*K),_[T++]=u((c[E+20+Q]-128)*J),_[T++]=u((c[E+20+Z]-128)*K),_[T++]=u((c[E+24+Q]-128)*J),_[T++]=u((c[E+24+Z]-128)*K),_[T++]=u((c[E+28+Q]-128)*J),_[T++]=u((c[E+28+Z]-128)*K),_[T++]=u((c[E+32+Q]-128)*J),_[T++]=u((c[E+32+Z]-128)*K),_[T++]=u((c[E+36+Q]-128)*J),_[T++]=u((c[E+36+Z]-128)*K),_[T++]=u((c[E+40+Q]-128)*J),_[T++]=u((c[E+40+Z]-128)*K),_[T++]=u((c[E+44+Q]-128)*J),_[T++]=u((c[E+44+Z]-128)*K),_[T++]=u((c[E+48+Q]-128)*J),_[T++]=u((c[E+48+Z]-128)*K),_[T++]=u((c[E+52+Q]-128)*J),_[T++]=u((c[E+52+Z]-128)*K),_[T++]=u((c[E+56+Q]-128)*J),_[T++]=u((c[E+56+Z]-128)*K),_[T++]=u((c[E+60+Q]-128)*J),_[T++]=u((c[E+60+Z]-128)*K);if(I)for(E=D-I;D>E;E+=4)_[T++]=u((c[E+Q]-128)*J),_[T++]=u((c[E+Z]-128)*K);if(et===rt)for(g=j>>>24&255,v=j>>>16&255,C=j>>>8&255,R=255&j,N=0,S=0,F=0,M=0,E=0;X>E;E+=4,N++)N>=p&&(N=0,S++,F+=n,M+=f),b>S||S>L||x>N||N>O||(B=N+w,G=S+y,Y=B+F+A<<2,T=N+M<<1,V=B+_[T],q=G+_[T+1],q>W||0>q||V>$||0>V?(t[Y]=v,t[Y+1]=C,t[Y+2]=R,t[Y+3]=g):(H=V+q*n<<2,t[Y]=U[H],t[Y+1]=U[H+1],t[Y+2]=U[H+2],t[Y+3]=U[H+3]));else if(tt===rt)for(N=0,S=0,F=0,M=0,E=0;X>E;E+=4,N++)N>=p&&(N=0,S++,F+=n,M+=f),b>S||S>L||x>N||N>O||(B=N+w,G=S+y,Y=B+F+A<<2,T=N+M<<1,V=B+_[T],q=G+_[T+1],q>W||0>q||V>$||0>V||(H=V+q*n<<2,t[Y]=U[H],t[Y+1]=U[H+1],t[Y+2]=U[H+2],t[Y+3]=U[H+3]));else if(it===rt)for(N=0,S=0,F=0,M=0,E=0;X>E;E+=4,N++)N>=p&&(N=0,S++,F+=n,M+=f),b>S||S>L||x>N||N>O||(B=N+w,G=S+y,Y=B+F+A<<2,T=N+M<<1,V=B+_[T],q=G+_[T+1],q=q>W?q-e:0>q?q+e:q,V=V>$?V-n:0>V?V+n:V,H=V+q*n<<2,t[Y]=U[H],t[Y+1]=U[H+1],t[Y+2]=U[H+2],t[Y+3]=U[H+3]);else for(N=0,S=0,F=0,M=0,E=0;X>E;E+=4,N++)N>=p&&(N=0,S++,F+=n,M+=f),b>S||S>L||x>N||N>O||(B=N+w,G=S+y,Y=B+F+A<<2,T=N+M<<1,V=B+_[T],q=G+_[T+1],q=q>W?W:0>q?0:q,V=V>$?$:0>V?0:V,H=V+q*n<<2,t[Y]=U[H],t[Y+1]=U[H+1],t[Y+2]=U[H+2],t[Y+3]=U[H+3]);return t},canRun:function(){return this._isOn&&(this._map||this.map)}})}(n),!function(t,n){function i(n,e){var i=e?s(e):"",r=s(n);return new Function("FILTER","return function( im, w, h ){    var self = this;    if ( !self._isOn || !self._map ) return im;    var x, y, i, j, imLen = im.length, dst = new FILTER.ImArray(imLen), t = new FILTER.Array32F(2),        COLOR = FILTER.MODE.COLOR, CLAMP = FILTER.MODE.CLAMP, WRAP = FILTER.MODE.WRAP, IGNORE = FILTER.MODE.IGNORE,        mode = self.mode||CLAMP, color = self.color||0, r, g, b, a, bx = w-1, by = h-1;    "+i+";        if ( COLOR === mode )    {        a = (color >>> 24)&255;        r = (color >>> 16)&255;        g = (color >>> 8)&255;        b = (color)&255;            for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+r+";                        if ( 0>t[0] || t[0]>bx || 0>t[1] || t[1]>by )            {                /* color */                dst[i] = r;   dst[i+1] = g;                dst[i+2] = b;  dst[i+3] = a;                continue;            }                        j = (~~t[0] + (~~t[1])*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if ( IGNORE === mode )    {        for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+r+";                        /* ignore */            t[1] = t[1] > by || t[1] < 0 ? y : t[1];            t[0] = t[0] > bx || t[0] < 0 ? x : t[0];                        j = (~~t[0] + (~~t[1])*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if ( WRAP === mode )    {        for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+r+";                        /* wrap */            t[1] = t[1] > by ? t[1]-h : (t[1] < 0 ? t[1]+h : t[1]);            t[0] = t[0] > bx ? t[0]-w : (t[0] < 0 ? t[0]+w : t[0]);                        j = (~~t[0] + (~~t[1])*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else /*if ( CLAMP === mode )*/    {        for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+r+";                        /* clamp */            t[1] = t[1] > by ? by : (t[1] < 0 ? 0 : t[1]);            t[0] = t[0] > bx ? bx : (t[0] < 0 ? 0 : t[0]);                        j = (~~t[0] + (~~t[1])*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    return dst;};")(t)}var r,a=t.MODE,s=t.Util.String.function_body;t.GeometricMapFilter=t.Class(t.Filter,{name:"GeometricMapFilter",constructor:function l(t,n){var e=this;return e instanceof l?(e.$super("constructor"),void(t&&e.set(t,n))):new l(t,n)},path:e,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,color:0,centerX:0,centerY:0,angle:0,radius:0,mode:a.CLAMP,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.color=0,t.centerX=null,t.centerY=null,t.angle=null,t.radius=null,t.$super("dispose"),t},serialize:function(){var t,n=this;return t={filter:n.name,_isOn:!!n._isOn,params:{_mapName:n._mapName||null,_map:"generic"===n._mapName&&n._map&&n._mapChanged?n._map.toString():null,_mapInit:"generic"===n._mapName&&n._mapInit&&n._mapChanged?n._mapInit.toString():null,color:n.color,centerX:n.centerX,centerY:n.centerY,angle:n.angle,radius:n.radius,mode:n.mode}},n._mapChanged=!1,t},unserialize:function(t){var n,e=this;return t&&e.name===t.filter&&(e._isOn=!!t._isOn,n=t.params,e.color=n.color,e.centerX=n.centerX,e.centerY=n.centerY,e.angle=n.angle,e.radius=n.radius,e.mode=n.mode,!n._map&&n._mapName&&r.hasOwnProperty(n._mapName)?e.set(n._mapName):n._map&&"generic"===n._mapName&&e.set(n._map,n._mapInit||null,1)),e},polar:function(t,n){return this},cartesian:function(t,n){return this},twirl:function(t,n,e,i){var r=this;return r.angle=t||0,r.radius=n||0,r.centerX=e||0,r.centerY=i||0,r.set("twirl")},sphere:function(t,n,e){var i=this;return i.radius=t||0,i.centerX=n||0,i.centerY=e||0,i.set("sphere")},set:function(t,n,e){var a=this;return e||"function"==typeof t?(a._mapName="generic",a._map=t,a._mapInit=n||null,a._apply=i(a._map,a._mapInit),a._mapChanged=!e):t&&r.hasOwnProperty(String(t))&&a._mapName!==String(t)&&(a._mapName=String(t),a._map=r[a._mapName],a._mapInit=r["init__"+a._mapName],a._apply=i(a._map,a._mapInit),a._mapChanged=!1),a},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t},canRun:function(){return this._isOn&&this._map}});r={twirl:"function( ){        TX = t[0]-CX; TY = t[1]-CY;        D = Sqrt(TX*TX + TY*TY);        if ( D < R )        {            theta = Atan2(TY, TX) + fact*(R-D);            t[0] = CX + D*Cos(theta);  t[1] = CY + D*Sin(theta);        }    }",init__twirl:"function( ){        var Sqrt = Math.sqrt, Atan2 = Math.atan2, Sin = Math.sin, Cos = Math.cos,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            angle = self.angle, R = self.radius, fact = angle/R,            D, TX, TY, theta;    }",sphere:"function( ){        TX = t[0]-CX;  TY = t[1]-CY;        TX2 = TX*TX; TY2 = TY*TY;        D2 = TX2 + TY2;        if ( D2 < R2 )        {            D2 = R2 - D2; D = Sqrt(D2);            thetax = Asin(TX / Sqrt(TX2 + D2)) * invrefraction;            thetay = Asin(TY / Sqrt(TY2 + D2)) * invrefraction;            t[0] = t[0] - D * Tan(thetax);  t[1] = t[1] - D * Tan(thetay);        }    }",init__sphere:"function( ){        var Sqrt = Math.sqrt, Asin = Math.asin, Tan = Math.tan,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            invrefraction = 1-0.555556,            R = self.radius, R2 = R*R,            D, TX, TY, TX2, TY2, R2, D2, thetax, thetay;    }"}}(n),!function(t,n){function i(t){for(var n=0,e=0,i=t.length;i>e;e++)n+=t[e];return n}function r(t,n){var e,i,r,a=[],s=[],l=[],o=t.length,u=n,c=u>>>1;for(i=0,r=0,e=0;o>e;)s.push(i-c),s.push(r-c),t[e]&&(a.push(i-c),a.push(r-c),l.push(t[e])),e++,i++,i>=u&&(i=0,r++);return[new v(a),new v(s),new d(l)]}function a(t,n){var e,i=new Array(t);for(e=0;t>e;e++)i[e]=n(e);return i}function s(t){var n,e=new Array(t);for(n=0;t>n;n++)e[n]=1;return e}function l(t,n){var e,i=t>>>1,r=new Array(t);if(n)for(e=0;t>e;e++)r[t-1-e]=e-i;else for(e=0;t>e;e++)r[e]=e-i;return r}function o(t){var n,e,i,r,a=T.length;if(t--,a>t)n=new d(T[t]);else for(n=new d(T[a-1]);t>=a;){for(e=n,n=new d(e.length+1),n[0]=1,i=0,r=e.length-1;r>i;i++)n[i+1]=e[i]+e[i+1];n[e.length]=1,40>a&&T.push(new Array(n)),a++}return n}function u(t){var n=o(t);return w(n,n)}function c(t,n){return 1===n?w(l(t,1),o(t)):w(o(t),l(t,0))}function f(t,n){return 1===n?w(l(t,1),s(t)):w(s(t),l(t,0))}function m(t,n,e){n=n||1,e=e||n;var i,r=t*t,a=new d(r);for(i=0;t>i;i++)a[i]=n;return a[r>>>1]=e,a}function h(t,n,e,i){var r,a,s,l,o,u=t*t,c=t>>>1,f=u>>>1,m=new d(u);for(l=0,r=0;c>=r;r++,l+=n)for(a=0,o=0,s=0;c>=s;s++,a+=t,o+=e)m[f+r+a]=l+o,m[f-r-a]=-l-o,m[f-r+a]=-l+o,m[f+r-a]=l-o;return m[f]=i||1,m}function _(t,n,e,i){var r,a,s,l,o,u,c=t*t,f=t>>1,m=c>>1,h=new d(c),_=new d(c),p=1/t,g=1e-8;for(O(n)>g?(o=1,u=e/n):(o=n/e,u=1),r=0,s=0,l=0,a=u*t;f>=r;)_[m+r]=~~(m+s+l+.5),_[m-r]=~~(m-s-l+.5),r++,s+=o,l+=a;for(r=0;f>=r;)h[_[m+r]]=h[_[m-r]]=p,r++;return h[m]=i||1,h}var p=t.Util.Filter,d=t.ConvolutionMatrix,g=t.ImArray,v=(t.Array32F,t.Array16I),C=(t.Array8U,p.integral_convolution),R=p.separable_convolution,y=p.cm_combine,w=p.cm_convolve,A=t.Util.Array.typed,x=t._notSupportClamp,b=(t.CONST.SQRT2,t.CONST.toRad),O=(t.CONST.toDeg,Math.abs),L=Math.sqrt,I=Math.sin,E=Math.cos,T=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],N=t.ConvolutionMatrixFilter=t.Class(t.Filter,{name:"ConvolutionMatrixFilter",constructor:function S(t,n,e,i){var r=this;return r instanceof S?(r.$super("constructor"),r._coeff=new d([1,0]),r.matrix2=null,r.dim2=0,r._isGrad=!1,r._doIntegral=0,r._doSeparable=!1,r._rgba=!!i,void(t&&t.length?r.set(t,~~(L(t.length)+.5),n||1,e||0):(r.matrix=null,r.dim=0))):new S(t,n,e,i)},path:e,dim:0,dim2:0,matrix:null,matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_rgba:!1,dispose:function(){var t=this;return t.dim=null,t.dim2=null,t.matrix=null,t.matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t._rgba=null,t.$super("dispose"),t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{dim:t.dim,dim2:t.dim2,matrix:t.matrix,matrix2:t.matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2,_rgba:t._rgba}}},unserialize:function(t){var n,e=this;return t&&e.name===t.filter&&(e._isOn=!!t._isOn,n=t.params,e.dim=n.dim,e.dim2=n.dim2,e.matrix=A(n.matrix,d),e.matrix2=A(n.matrix2,d),e._mat=A(n._mat,d),e._mat2=A(n._mat2,d),e._coeff=A(n._coeff,d),e._isGrad=n._isGrad,e._doIntegral=n._doIntegral,e._doSeparable=n._doSeparable,e._indices=A(n._indices,v),e._indices2=A(n._indices2,v),e._indicesf=A(n._indicesf,v),e._indicesf2=A(n._indicesf2,v),e._rgba=n._rgba),e},rgba:function(t){var n=this;return arguments.length?(n._rgba=!!t,n):n._rgba},functional:function(t,e){e=e===n?3:1&e?e:e+1;var r=a(e,t),s=1/i(r);return this.set(r,e,s,s,e,r),this._doSeparable=!0,this},fastGauss:function(t,e){return e=e===n?3:1&e?e:e+1,t=~~(t||1),1>t?t=1:t>3&&(t=3),this.set(m(e),e,1/(e*e),0),this._doIntegral=t,this},lowPass:function(t){return t=t===n?3:1&t?t:t+1,this.set(m(t),t,1/(t*t),0),this._doIntegral=1,this},boxBlur:null,highPass:function(t,e){t=t===n?3:1&t?t:t+1,e=e===n?1:e;var i=-e/(t*t);return this.set(m(t,i,1+i),t,1,0),this._doIntegral=1,this},glow:function(t,e){return t=t===n?.5:t,this.highPass(e,-t)},sharpen:function(t,e){return t=t===n?.5:t,this.highPass(e,t)},verticalBlur:function(t){return t=t===n?3:1&t?t:t+1,this.set(s(t),1,1/t,0,t),this._doIntegral=1,this},horizontalBlur:function(t){return t=t===n?3:1&t?t:t+1,this.set(s(t),t,1/t,0,1),this._doIntegral=1,this},directionalBlur:function(t,e){return e=e===n?3:1&e?e:e+1,t*=b,this.set(_(e,E(t),-I(t),1/e),e,1,0)},binomialLowPass:function(t){t=t===n?3:1&t?t:t+1;var e=o(t),i=1/(1<<t-1);return this.set(e,t,i,i,t,e),this._doSeparable=!0,this},gaussBlur:null,binomialHighPass:function(t){t=t===n?3:1&t?t:t+1;var e=u(t);return this.set(y(m(t),e,1,-1/i(e)),t,1,0)},prewittX:function(t){return t=t===n?3:1&t?t:t+1,this.set(s(t),t,1,0,t,l(t,0)),this._doSeparable=!0,this},gradX:null,prewittY:function(t){return t=t===n?3:1&t?t:t+1,this.set(l(t,1),t,1,0,t,s(t)),this._doSeparable=!0,this},gradY:null,prewittDirectional:function(t,e){return e=e===n?3:1&e?e:e+1,t*=b,this.set(y(f(e,0),f(e,1),E(t),I(t)),e,1,0)},gradDirectional:null,prewitt:function(t){return t=t===n?3:1&t?t:t+1,this.set(f(t,0),t,1,0,t,f(t,1)),this._isGrad=!0,this},grad:null,sobelX:function(t){return t=t===n?3:1&t?t:t+1,this.set(o(t),t,1,0,t,l(t,0)),this._doSeparable=!0,this},sobelY:function(t){return t=t===n?3:1&t?t:t+1,this.set(l(t,1),t,1,0,t,o(t)),this._doSeparable=!0,this},sobelDirectional:function(t,e){return e=e===n?3:1&e?e:e+1,t*=b,this.set(y(c(e,0),c(e,1),E(t),I(t)),e,1,0)},sobel:function(t){return t=t===n?3:1&t?t:t+1,this.set(c(t,0),t,1,0,t,c(t,1)),this._isGrad=!0,this},laplace:function(t){return t=t===n?3:1&t?t:t+1,this.set(m(t,-1,t*t-1),t,1,0),this._doIntegral=1,this},emboss:function(t,e,i){return i=i===n?3:1&i?i:i+1,t=t===n?-.25*Math.PI:t*b,e=e||1,this.set(h(i,e*E(t),-e*I(t),1),i,1,0)},bump:null,edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,n,e,i,a,s){var l,o=this;return o._isGrad=!1,o._doIntegral=0,o._doSeparable=!1,o.matrix2=null,o.dim2=0,o._indices2=o._indicesf2=null,o._mat2=null,o.matrix=new d(t),o.dim=n,o._coeff[0]=e||1,o._coeff[1]=i||0,l=r(o.matrix,o.dim),o._indices=l[0],o._indicesf=l[1],o._mat=l[2],s?(o.matrix2=new d(s),o.dim2=a,l=r(o.matrix2,o.dim2),o._indices2=l[0],o._indicesf2=l[1],o._mat2=l[2]):a&&(o.dim2=a),o},reset:function(){var t=this;return t.matrix=t.matrix2=null,t.dim=t.dim2=0,t._mat=t._mat2=null,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t},combineWith:function(t){return this},getMatrix:function(){return this.matrix},setMatrix:function(t,n){return this.set(t,n)},_apply:x?function(t,n,e){var i=this,r=i._rgba;if(!i._isOn||!i.matrix)return t;if(i._doIntegral)return i.matrix2?C(r,t,n,e,i.matrix,i.matrix2,i.dim,i.dim2,i._coeff[0],i._coeff[1],i._doIntegral):C(r,t,n,e,i.matrix,null,i.dim,i.dim,i._coeff[0],i._coeff[1],i._doIntegral);if(i._doSeparable)return R(r,t,n,e,i._mat,i._mat2,i._indices,i._indices2,i._coeff[0],i._coeff[1]);var a,s,l,o,u,c,f,m,h,_,p,d,y,w,A,x,b,L,I,E,T,N,S,F,M=t.length,G=M>>>2,B=new g(M),Y=n-1,H=G-n,X=i._coeff[0],z=i._coeff[1],k=i.matrix,D=i.matrix2,U=i._isGrad;if(D){for(N=i._indicesf.length,F=new v(i._indicesf),c=0;N>c;c+=2)F[c+1]*=n;for(S=k.length,f=0,m=0,o=0;M>o;o+=4,f++){for(f>=n&&(f=0,m+=n),d=y=w=A=x=b=L=I=0,c=0,u=0;S>c;c++,u+=2)h=f+F[u],_=m+F[u+1],0>h||h>Y||0>_||_>H||(p=h+_<<2,E=k[c],d+=t[p]*E,y+=t[p+1]*E,w+=t[p+2]*E,T=D[c],x+=t[p]*T,b+=t[p+1]*T,L+=t[p+2]*T);U?(a=O(d)+O(x),s=O(y)+O(b),l=O(w)+O(L)):(a=X*d+z*x,s=X*y+z*b,l=X*w+z*L),a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l,B[o]=~~a,B[o+1]=~~s,B[o+2]=~~l,B[o+3]=t[o+3]}}else{for(N=i._indices.length,F=new v(i._indices),c=0;N>c;c+=2)F[c+1]*=n;for(k=i._mat,S=k.length,f=0,m=0,o=0;M>o;o+=4,f++){for(f>=n&&(f=0,m+=n),d=y=w=A=0,c=0,u=0;S>c;c++,u+=2)h=f+F[u],_=m+F[u+1],0>h||h>Y||0>_||_>H||(p=h+_<<2,E=k[c],d+=t[p]*E,y+=t[p+1]*E,w+=t[p+2]*E);a=X*d+z,s=X*y+z,l=X*w+z,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l,B[o]=~~a,B[o+1]=~~s,B[o+2]=~~l,B[o+3]=t[o+3]}}return B}:function(t,n,e){var i=this,r=i._rgba;if(!i._isOn||!i.matrix)return t;if(i._doIntegral)return i.matrix2?C(r,t,n,e,i.matrix,i.matrix2,i.dim,i.dim2,i._coeff[0],i._coeff[1],i._doIntegral):C(r,t,n,e,i.matrix,null,i.dim,i.dim,i._coeff[0],i._coeff[1],i._doIntegral);if(i._doSeparable)return R(r,t,n,e,i._mat,i._mat2,i._indices,i._indices2,i._coeff[0],i._coeff[1]);var a,s,l,o,u,c,f,m,h,_,p,d,y,w,A,x,b,L,I,E,T,N,S,F,M=t.length,G=M>>>2,B=new g(M),Y=n-1,H=G-n,X=i._coeff[0],z=i._coeff[1],k=i.matrix,D=i.matrix2,U=i._isGrad;if(D){for(N=i._indicesf.length,F=new v(i._indicesf),c=0;N>c;c+=2)F[c+1]*=n;for(S=k.length,f=0,m=0,o=0;M>o;o+=4,f++){for(f>=n&&(f=0,m+=n),d=y=w=A=x=b=L=I=0,c=0,u=0;S>c;c++,u+=2)h=f+F[u],_=m+F[u+1],0>h||h>Y||0>_||_>H||(p=h+_<<2,E=k[c],d+=t[p]*E,y+=t[p+1]*E,w+=t[p+2]*E,T=D[c],x+=t[p]*T,b+=t[p+1]*T,L+=t[p+2]*T);U?(a=O(d)+O(x),s=O(y)+O(b),l=O(w)+O(L)):(a=X*d+z*x,s=X*y+z*b,l=X*w+z*L),B[o]=~~a,B[o+1]=~~s,B[o+2]=~~l,B[o+3]=t[o+3]}}else{for(N=i._indices.length,F=new v(i._indices),c=0;N>c;c+=2)F[c+1]*=n;for(k=i._mat,S=k.length,f=0,m=0,o=0;M>o;o+=4,f++){for(f>=n&&(f=0,m+=n),d=y=w=A=0,c=0,u=0;S>c;c++,u+=2)h=f+F[u],_=m+F[u+1],0>h||h>Y||0>_||_>H||(p=h+_<<2,E=k[c],d+=t[p]*E,y+=t[p+1]*E,w+=t[p+2]*E);a=X*d+z,s=X*y+z,l=X*w+z,B[o]=~~a,B[o+1]=~~s,B[o+2]=~~l,B[o+3]=t[o+3]}}return B},canRun:function(){return this._isOn&&this.matrix}});N.prototype.gradX=N.prototype.prewittX,N.prototype.gradY=N.prototype.prewittY,N.prototype.gradDirectional=N.prototype.prewittDirectional,N.prototype.grad=N.prototype.prewitt,N.prototype.bump=N.prototype.emboss,N.prototype.boxBlur=N.prototype.lowPass,N.prototype.gaussBlur=N.prototype.binomialLowPass}(n),!function(t,n){var i,r=t.ImArray,a=t.Array8U,s=t.Array32I,l=Math.sqrt,o=t.Util.Array.typed,u=function(t){var n,e=t*t,i=new a(e);for(n=0;e>n;n++)i[n]=1;return i},c=u(3);t.MorphologicalFilter=t.Class(t.Filter,{name:"MorphologicalFilter",constructor:function f(){var t=this;return t instanceof f?(t.$super("constructor"),t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,void(t._indices=null)):new f},path:e,_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=null,t._structureElement=null,t._indices=null,t.$super("dispose"),t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_structureElement:t._structureElement,_indices:t._indices}}},unserialize:function(t){var n,e=this;return t&&e.name===t.filter&&(e._isOn=!!t._isOn,n=t.params,e._dim=n._dim,e._structureElement=o(n._structureElement,a),e._indices=o(n._indices,s),e._filterName=n._filterName,e._filterName&&i[e._filterName]&&(e._filter=i[e._filterName])),e},erode:function(t){return this.set(t,"erode")},dilate:function(t){return this.set(t,"dilate")},opening:function(t){return this.set(t,"open")},closing:function(t){return this.set(t,"close")},set:function(t,n){var e=this;e._filterName=n,e._filter=i[n],t&&t.length?(e._structureElement=new a(t),e._dim=~~(l(e._structureElement.length)+.5)):t&&t===t-0?(e._structureElement=u(t),e._dim=t):(e._structureElement=c,e._dim=3);var r,o,f,m=[],t=e._structureElement,h=t.length,_=e._dim,p=_>>1;for(o=0,f=0,r=0;h>r;)t[r]&&(m.push(o-p),m.push(f-p)),r++,o++,o>=_&&(o=0,f++);return e._indices=new s(m),e},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null,t},_apply:function(t,n,e){var i=this;return i._isOn&&i._dim&&i._filter?i._filter(i,t,n,e):t},canRun:function(){return this._isOn&&this._dim&&this._filter}});i={dilate:function(t,n,e,i){var a,l,o,u,c,f,m,h,_,p,d,g,v,C,R=t._structureElement,y=(R.length,t._dim,new s(t._indices)),w=n.length,A=w>>2,x=new r(w),b=y.length,O=b>>1,L=e-1,I=A-e;for(o=0;b>o;o+=2)y[o+1]*=e;for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=e&&(u=0,c+=e),g=0,v=0,C=0,l=0;O>l;l+=2)f=u+y[l],m=c+y[l+1],f>=0&&L>=f&&m>=0&&I>=m&&(h=f+m<<2,_=n[h],p=n[h+1],d=n[h+2],_>g&&(g=_),p>v&&(v=p),d>C&&(C=d));x[a]=g,x[a+1]=v,x[a+2]=C,x[a+3]=n[a+3]}return x},erode:function(t,n,e,i){var a,l,o,u,c,f,m,h,_,p,d,g,v,C,R=t._structureElement,y=(R.length,t._dim,new s(t._indices)),w=n.length,A=w>>2,x=new r(w),b=y.length,O=b>>1,L=e-1,I=A-e;for(o=0;b>o;o+=2)y[o+1]*=e;for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=e&&(u=0,c+=e),g=255,v=255,C=255,l=0;O>l;l+=2)f=u+y[l],m=c+y[l+1],f>=0&&L>=f&&m>=0&&I>=m&&(h=f+m<<2,_=n[h],p=n[h+1],d=n[h+2],g>_&&(g=_),v>p&&(v=p),C>d&&(C=d));x[a]=g,x[a+1]=v,x[a+2]=C,x[a+3]=n[a+3]}return x},open:function(t,n,e,i){var a,l,o,u,c,f,m,h,_,p,d,g,v,C,R=t._structureElement,y=(R.length,t._dim,new s(t._indices)),w=n.length,A=w>>2,x=new r(w),b=y.length,O=b>>1,L=e-1,I=A-e;for(o=0;b>o;o+=2)y[o+1]*=e;for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=e&&(u=0,c+=e),g=255,v=255,C=255,l=0;O>l;l+=2)f=u+y[l],m=c+y[l+1],f>=0&&L>=f&&m>=0&&I>=m&&(h=f+m<<2,_=n[h],p=n[h+1],d=n[h+2],g>_&&(g=_),v>p&&(v=p),C>d&&(C=d));x[a]=g,x[a+1]=v,x[a+2]=C,x[a+3]=n[a+3]}for(n=x,x=new r(w),u=0,c=0,a=0;w>a;a+=4,u++){for(u>=e&&(u=0,c+=e),g=255,v=255,C=255,l=0;O>l;l+=2)f=u+y[l],m=c+y[l+1],f>=0&&L>=f&&m>=0&&I>=m&&(h=f+m<<2,_=n[h],p=n[h+1],d=n[h+2],g>_&&(g=_),v>p&&(v=p),C>d&&(C=d));x[a]=g,x[a+1]=v,x[a+2]=C,x[a+3]=n[a+3]}return x},close:function(t,n,e,i){var a,l,o,u,c,f,m,h,_,p,d,g,v,C,R=t._structureElement,y=(R.length,t._dim,new s(t._indices)),w=n.length,A=w>>2,x=new r(w),b=y.length,O=b>>1,L=e-1,I=A-e;for(o=0;b>o;o+=2)y[o+1]*=e;for(u=0,c=0,a=0;w>a;a+=4,u++){for(u>=e&&(u=0,c+=e),g=255,v=255,C=255,l=0;O>l;l+=2)f=u+y[l],m=c+y[l+1],f>=0&&L>=f&&m>=0&&I>=m&&(h=f+m<<2,_=n[h],p=n[h+1],d=n[h+2],g>_&&(g=_),v>p&&(v=p),C>d&&(C=d));x[a]=g,x[a+1]=v,x[a+2]=C,x[a+3]=n[a+3]}for(n=x,x=new r(w),u=0,c=0,a=0;w>a;a+=4,u++){for(u>=e&&(u=0,c+=e),g=255,v=255,C=255,l=0;O>l;l+=2)f=u+y[l],m=c+y[l+1],f>=0&&L>=f&&m>=0&&I>=m&&(h=f+m<<2,_=n[h],p=n[h+1],d=n[h+2],g>_&&(g=_),v>p&&(v=p),C>d&&(C=d));x[a]=g,x[a+1]=v,x[a+2]=C,x[a+3]=n[a+3]}return x}}}(n),!function(t,n){var i,r=t.ImArray,a=t.Array32I,s=t.Util.Array.typed,l=(Math.min,Math.max,t.StatisticalFilter=t.Class(t.Filter,{name:"StatisticalFilter",constructor:function o(){var t=this;return t instanceof o?(t.$super("constructor"),t._dim=0,t._indices=null,t._filterName=null,void(t._filter=null)):new o},path:e,_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var t=this;return t._dim=null,t._indices=null,t._filter=null,t._filterName=null,t.$super("dispose"),t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_indices:t._indices}}},unserialize:function(t){var n,e=this;return t&&e.name===t.filter&&(e._isOn=!!t._isOn,n=t.params,e._dim=n._dim,e._indices=s(n._indices,a),e._filterName=n._filterName,e._filterName&&i[e._filterName]&&(e._filter=i[e._filterName])),e},median:function(t){return this.set(null==t?3:1&t?t:t+1,"median")},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,"minimum")},maximum:function(t){return this.set(null==t?3:1&t?t:t+1,"maximum")},set:function(t,n){var e=this;e._filterName=n,e._filter=i[n],e._dim=t;var r,s,l,o=[],u=t*t,c=t,f=c>>1;for(s=0,l=0,r=0;u>r;)o.push(s-f),o.push(l-f),r++,s++,s>=c&&(s=0,l++);return e._indices=new a(o),e},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._indices=null,t},_apply:function(t,n,e){var i=this;return i._isOn&&i._dim?i._filter(i,t,n,e):t},canRun:function(){return this._isOn&&this._dim}}));l.prototype.erode=l.prototype.minimum,l.prototype.dilate=l.prototype.maximum,i={median:function(t,n,e,i){var s,l,o,u,c,f,m,h,_,p,d,g,v,C,R,y,w,A,x=t._dim,b=x*x,O=new a(t._indices),L=n.length,I=L>>2,E=new r(L),T=b<<1,N=e-1,S=I-e;for(h=[],_=[],p=[],l=0;T>l;l+=2)O[l+1]*=e;for(s=0,o=0,u=0;L>s;){for(h.length=0,_.length=0,p.length=0,l=0;T>l;)c=o+O[l],f=u+O[l+1],c>=0&&N>=c&&f>=0&&S>=f&&(m=c+f<<2,d=n[m],g=n[m+1],v=n[m+2],h.push(d),_.push(g),p.push(v)),l+=2;h.sort(),_.sort(),p.sort(),w=h.length,A=w>>>1,C=1&w?h[A]:~~(.5*h[A-1]+.5*h[A]),R=1&w?_[A]:~~(.5*_[A-1]+.5*_[A]),y=1&w?p[A]:~~(.5*p[A-1]+.5*p[A]),E[s]=C,E[s+1]=R,E[s+2]=y,E[s+3]=n[s+3],s+=4,o++,o>=e&&(o=0,u+=e)}return E},maximum:function(t,n,e,i){var s,l,o,u,c,f,m,h,_,p,d,g,v,C=t._dim,R=C*C,y=new a(t._indices),w=n.length,A=w>>2,x=new r(w),b=R<<1,O=e-1,L=A-e;for(l=0;b>l;l+=2)y[l+1]*=e;for(s=0,o=0,u=0;w>s;){for(d=0,g=0,v=0,l=0;b>l;)c=o+y[l],f=u+y[l+1],c>=0&&O>=c&&f>=0&&L>=f&&(m=c+f<<2,h=n[m],_=n[m+1],p=n[m+2],h>d&&(d=h),_>g&&(g=_),p>v&&(v=p)),l+=2;x[s]=d,x[s+1]=g,x[s+2]=v,x[s+3]=n[s+3],s+=4,o++,o>=e&&(o=0,u+=e)}return x},minimum:function(t,n,e,i){var s,l,o,u,c,f,m,h,_,p,d,g,v,C=t._dim,R=C*C,y=new a(t._indices),w=n.length,A=w>>2,x=new r(w),b=R<<1,O=e-1,L=A-e;for(l=0;b>l;l+=2)y[l+1]*=e;for(s=0,o=0,u=0;w>s;){for(d=255,g=255,v=255,l=0;b>l;)c=o+y[l],f=u+y[l+1],c>=0&&O>=c&&f>=0&&L>=f&&(m=c+f<<2,h=n[m],_=n[m+1],p=n[m+2],d>h&&(d=h),g>_&&(g=_),v>p&&(v=p)),l+=2;x[s]=d,x[s+1]=g,x[s+2]=v,x[s+3]=n[s+3],s+=4,o++,o>=e&&(o=0,u+=e)}return x}}}(n),!function(t,n){var i="hasOwnProperty";t.InlineFilter=t.Class(t.Filter,{name:"InlineFilter",constructor:function r(t,n){var e=this;return e instanceof r?(e.$super("constructor"),e._params={},void e.set(t,n)):new r(t,n)},path:e,_filter:null,_params:null,_changed:!1,dispose:function(){var t=this;return t._filter=null,t._params=null,t._changed=null,t.$super("dispose"),t},serialize:function(){var t,n=this;return t={filter:n.name,_isOn:!!n._isOn,_update:n._update,params:{_filter:!1===n._filter?!1:n._changed&&n._filter?n._filter.toString():null,_params:n._params}},n._changed=!1,t},unserialize:function(n){var e,i=this;return n&&i.name===n.filter&&(i._isOn=!!n._isOn,i._update=n._update,e=n.params,null!=e._filter&&(i._filter=!1===e._filter?null:new Function("FILTER",'"use strict"; return '+e._filter+";")(t)),i._params=e._params||{}),i},params:function(t){var n=this;if(arguments.length){for(var e in t)t[i](e)&&(n._params[e]=t[e]);return n}return n._params},set:function(t,n){var e=this;return!1===t?(e._filter=!1,e._changed=!0):("function"==typeof t&&(e._filter=t,e._changed=!0),n&&e.params(n)),e},_apply:function(t,n,e,i){var r=this;return r._isOn&&r._filter?r._filter(r._params,t,n,e,i):t},canRun:function(){return this._isOn&&this._filter}});t.CustomFilter=t.InlineFilter}(n),n});