/**
*
*   FILTER.js Generic Filters
*   @version: 0.9.0
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Generic Filters)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e){"use strict";"object"==typeof module&&module.exports?module.exports=e.call(t,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_FILTERS")?define("FILTER_FILTERS",["module","FILTER"],function(r,n){return e.moduleUri=r.uri,e.call(t,n),n}):(e.call(t,t.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return t.FILTER})}(this,function ModuleFactory__FILTER_FILTERS(FILTER){return!function(t,e){"use strict";var r=(Object.prototype,Function.prototype,Array.prototype),n=r.slice,i=r.splice,a=r.concat,s=t.CompositeFilter=t.Class(t.Filter,{name:"CompositeFilter",constructor:function(t){var e=this;e.$super("constructor"),e._stack=t&&t.length?t.slice():[]},path:t.getPath(ModuleFactory__FILTER_FILTERS.moduleUri),_stack:null,_meta:null,_stable:!0,dispose:function(t){var e,r=this,n=r._stack;if(r.$super("dispose"),!0===t)for(e=0;e<n.length;e++)n[e]&&n[e].dispose(t),n[e]=null;return r._stack=null,r._meta=null,r},serialize:function(){var t,e=this,r={filter:e.name,_isOn:!!e._isOn,_stable:!!e._stable,filters:[]},n=e._stack;for(t=0;t<n.length;t++)r.filters.push(n[t].serialize());return r},unserialize:function(e){var r,n,i,a,s,l=this,u=l._stack;if(e&&l.name===e.filter){if(l._isOn=!!e._isOn,l._stable=!!e._stable,a=e.filters||[],n=a.length,i=u.length,n===i&&l._stable)for(r=0;n>r;r++)u[r]=u[r].unserialize(a[r]);else{for(r=0;i>r;r++)u[r]&&u[r].dispose(!0),u[r]=null;for(u=[],r=0;n>r;r++){if(s=a[r]&&a[r].filter?t[a[r].filter]:null,!s)throw new Error('Filter "'+a[r].filter+'" could not be created');u.push((new s).unserialize(a[r]))}}l._stack=u}return l},getMeta:function(){return this._meta},setMeta:function(t){var e,r,n=this,i=n._stack;if(t&&(r=t.length)&&i.length)for(e=0;r>e;e++)i[t[e][0]].setMeta(t[e][1]);return n},stable:function(t){return arguments.length||(t=!0),this._stable=!!t,this},filters:function(t){return arguments.length?(this._stack=t.slice(),this):this._stack.slice()},push:function(){var t=n.call(arguments),e=t.length;return e&&(this._stack=a.apply(this._stack,t)),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){var t=n.call(arguments),e=t.length;return e&&i.apply(this._stack,[0,0].concat(t)),this},getAt:function(t){return this._stack.length>t?this._stack[t]:null},setAt:function(t,e){return this._stack.length>t?this._stack[t]=e:this._stack.push(e),this},insertAt:function(t){var e=n.call(arguments);e.length;return argslen>1&&(e.shift(),i.apply(this._stack,[t,0].concat(e))),this},removeAt:function(t){return this._stack.splice(t,1)},remove:function(t){for(var e=this._stack.length;--e>=0;)t===this._stack[e]&&this._stack.splice(e,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(t,e,r,n){var i=this;if(i.hasMeta=!1,i._meta=[],i._isOn&&i._stack.length){var a,s,l=i._stack,u=l.length;for(a=0;u>a;a++)s=l[a],s&&s._isOn&&(t=s._apply(t,e,r,n),s.hasMeta&&i._meta.push([a,s.getMeta()]))}return i.hasMeta=i._meta.length>0,t},canRun:function(){return this._isOn&&this._stack.length},toString:function(){var t,e=arguments.length&&arguments[0].substr?arguments[0]:"  ",r=e+e,n=this._stack,i=[],a=n.length;for(t=0;a>t;t++)i.push(n[t].toString(r));return["[FILTER: "+this.name+"]","[","  "+i.join("\n  "),"]",""].join("\n")}});s.prototype.empty=s.prototype.reset,s.prototype.concat=s.prototype.push}(FILTER),!function(t,e){"use strict";var r="hasOwnProperty";t.InlineFilter=t.CustomFilter=t.Class(t.Filter,{name:"InlineFilter",constructor:function(t){var e=this;e.$super("constructor"),e._handler=t&&"function"==typeof t?t:null,e._params={}},path:t.getPath(ModuleFactory__FILTER_FILTERS.moduleUri),_handler:null,_params:null,dispose:function(){var t=this;return t.$super("dispose"),t._handler=null,t._params=null,t},params:function(t){var e=this;if(arguments.length){for(var n in t)t[r](n)&&(e._params[n]=t[n]);return e}return e._params},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_handler:t._handler?t._handler.toString():null,_params:t._params}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n._handler=null,r._handler&&(n._handler=new Function("FILTER",'"use strict"; return '+r._handler+";")(t)),n._params=r._params||{}),n},_apply:function(t,e,r,n){var i=this;return i._isOn&&i._handler?i._handler(i,t,e,r,n):t},canRun:function(){return this._isOn&&this._handler}})}(FILTER),!function(t,e){"use strict";function r(t,e){var r,n,i,a,l,u=new s(20);return r=e[0],n=e[1],i=e[2],a=e[3],l=e[4],u[0]=r*t[0]+n*t[5]+i*t[10]+a*t[15],u[1]=r*t[1]+n*t[6]+i*t[11]+a*t[16],u[2]=r*t[2]+n*t[7]+i*t[12]+a*t[17],u[3]=r*t[3]+n*t[8]+i*t[13]+a*t[18],u[4]=r*t[4]+n*t[9]+i*t[14]+a*t[19]+l,r=e[5],n=e[6],i=e[7],a=e[8],l=e[9],u[5]=r*t[0]+n*t[5]+i*t[10]+a*t[15],u[6]=r*t[1]+n*t[6]+i*t[11]+a*t[16],u[7]=r*t[2]+n*t[7]+i*t[12]+a*t[17],u[8]=r*t[3]+n*t[8]+i*t[13]+a*t[18],u[9]=r*t[4]+n*t[9]+i*t[14]+a*t[19]+l,r=e[10],n=e[11],i=e[12],a=e[13],l=e[14],u[10]=r*t[0]+n*t[5]+i*t[10]+a*t[15],u[11]=r*t[1]+n*t[6]+i*t[11]+a*t[16],u[12]=r*t[2]+n*t[7]+i*t[12]+a*t[17],u[13]=r*t[3]+n*t[8]+i*t[13]+a*t[18],u[14]=r*t[4]+n*t[9]+i*t[14]+a*t[19]+l,r=e[15],n=e[16],i=e[17],a=e[18],l=e[19],u[15]=r*t[0]+n*t[5]+i*t[10]+a*t[15],u[16]=r*t[1]+n*t[6]+i*t[11]+a*t[16],u[17]=r*t[2]+n*t[7]+i*t[12]+a*t[17],u[18]=r*t[3]+n*t[8]+i*t[13]+a*t[18],u[19]=r*t[4]+n*t[9]+i*t[14]+a*t[19]+l,u}function n(t,e,r){var n=1-r,i=new s(20);return i[0]=n*t[0]+r*e[0],i[1]=n*t[1]+r*e[1],i[2]=n*t[2]+r*e[2],i[3]=n*t[3]+r*e[3],i[4]=n*t[4]+r*e[4],i[5]=n*t[5]+r*e[5],i[6]=n*t[6]+r*e[6],i[7]=n*t[7]+r*e[7],i[8]=n*t[8]+r*e[8],i[9]=n*t[9]+r*e[9],i[10]=n*t[10]+r*e[10],i[11]=n*t[11]+r*e[11],i[12]=n*t[12]+r*e[12],i[13]=n*t[13]+r*e[13],i[14]=n*t[14]+r*e[14],i[15]=n*t[15]+r*e[15],i[16]=n*t[16]+r*e[16],i[17]=n*t[17]+r*e[17],i[18]=n*t[18]+r*e[18],i[19]=n*t[19]+r*e[19],i}var i=Math.sin,a=Math.cos,s=t.Array32F,l=t.CONST.toRad,u=(t.CONST.toDeg,t._notSupportClamp),o=t.ColorMatrixFilter=t.Class(t.Filter,{name:"ColorMatrixFilter",constructor:function(e){var r=this;r.$super("constructor"),e&&e.length?r._matrix=new s(e):r._matrix=null,t.useWebGL&&(r._webglInstance=t.WebGLColorMatrixFilterInstance||null)},path:t.getPath(ModuleFactory__FILTER_FILTERS.moduleUri),_matrix:null,_webglInstance:null,dispose:function(){var t=this;return t.$super("dispose"),t._webglInstance=null,t._matrix=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_matrix:t._matrix}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r._matrix=e._matrix),r},channel:function(r,n){n=n===e?!1:n;var i=n?1:0;switch(r){case t.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case t.CHANNEL.BLUE:return this.set([0,0,i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,0,0,255]);case t.CHANNEL.GREEN:return this.set([0,i,0,0,0,0,1,0,0,0,0,i,0,0,0,0,0,0,0,255]);case t.CHANNEL.RED:default:return this.set([1,0,0,0,0,i,0,0,0,0,i,0,0,0,0,0,0,0,0,255])}},redChannel:function(e){return this.channel(t.CHANNEL.RED,e)},greenChannel:function(e){return this.channel(t.CHANNEL.GREEN,e)},blueChannel:function(e){return this.channel(t.CHANNEL.BLUE,e)},alphaChannel:function(e){return this.channel(t.CHANNEL.ALPHA,!0)},maskChannel:function(e){switch(e){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(e,r){switch(e){case t.CHANNEL.ALPHA:switch(r){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case t.CHANNEL.BLUE:switch(r){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.BLUE:return this;case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case t.CHANNEL.GREEN:switch(r){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this;case t.CHANNEL.RED:default:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case t.CHANNEL.RED:default:switch(r){case t.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case t.CHANNEL.BLUE:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this}}},desaturate:function(){return this.set([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,0,0,0,1,0])},colorize:function(r,n){var i,a,s,l;return n===e&&(n=1),i=.00392156862745098*(r>>16&255),a=.00392156862745098*(r>>8&255),s=.00392156862745098*(255&r),l=1-n,this.set([l+n*i*t.LUMA[0],n*i*t.LUMA[1],n*i*t.LUMA[2],0,0,n*a*t.LUMA[0],l+n*a*t.LUMA[1],n*a*t.LUMA[2],0,0,n*s*t.LUMA[0],n*s*t.LUMA[1],l+n*s*t.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.set([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(e){var r,n,i,a;return r=1-e,n=r*t.LUMA[0],i=r*t.LUMA[1],a=r*t.LUMA[2],this.set([n+e,i,a,0,0,n,i+e,a,0,0,n,i,a+e,0,0,0,0,0,1,0])},contrast:function(t,r,n){return r===e&&(r=t),n===e&&(n=t),t+=1,r+=1,n+=1,this.set([t,0,0,0,128*(1-t),0,r,0,0,128*(1-r),0,0,n,0,128*(1-n),0,0,0,1,0])},brightness:function(t,r,n){return r===e&&(r=t),n===e&&(n=t),this.set([1,0,0,0,t,0,1,0,0,r,0,0,1,0,n,0,0,0,1,0])},adjustHue:function(e){e*=l;var r=a(e),n=i(e);return this.set([t.LUMA[0]+r*(1-t.LUMA[0])+n*-t.LUMA[0],t.LUMA[1]+r*-t.LUMA[1]+n*-t.LUMA[1],t.LUMA[2]+r*-t.LUMA[2]+n*(1-t.LUMA[2]),0,0,t.LUMA[0]+r*-t.LUMA[0]+.143*n,t.LUMA[1]+r*(1-t.LUMA[1])+.14*n,t.LUMA[2]+r*-t.LUMA[2]+n*-.283,0,0,t.LUMA[0]+r*-t.LUMA[0]+n*-(1-t.LUMA[0]),t.LUMA[1]+r*-t.LUMA[1]+n*t.LUMA[1],t.LUMA[2]+r*(1-t.LUMA[2])+n*t.LUMA[2],0,0,0,0,0,1,0])},average:function(t,r,n){return t===e&&(t=.3333),r===e&&(r=.3333),n===e&&(n=.3334),this.set([t,r,n,0,0,t,r,n,0,0,t,r,n,0,0,0,0,0,1,0])},quickContrastCorrection:function(t){return t===e&&(t=1.2),this.set([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0])},sepia:function(t){return t===e&&(t=.5),t>1?t=1:0>t&&(t=0),this.set([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0])},sepia2:function(r){return r===e&&(r=10),r>100&&(r=100),r*=2.55,this.set([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,40,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,20,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,-r,0,0,0,1,0])},threshold:function(r,n){return n===e&&(n=256),this.set([t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*r,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*r,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*r,0,0,0,1,0])},threshold_rgb:function(t,r){return r===e&&(r=256),this.set([r,0,0,0,-(r-1)*t,0,r,0,0,-(r-1)*t,0,0,r,0,-(r-1)*t,0,0,0,1,0])},threshold_alpha:function(t,r){return t===e&&(t=.5),r===e&&(r=256),this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,r,-r*t])},RGB2YCbCr:function(){return this.set([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.set([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(t,e){return this._matrix=this._matrix?n(this._matrix,t.getMatrix(),e):new s(t.getMatrix()),this},set:function(t){return this._matrix=this._matrix?r(this._matrix,new s(t)):new s(t),this},reset:function(){return this._matrix=null,this},combineWith:function(t){return this.set(t.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(t){return this._matrix=new s(t),this},_apply:function(t,e,r){var n=this;if(n._isOn&&n._matrix){var i,a,s,l,u,o,c,f,_,h,m,p,d,L,v,g,A,E,M,N,w,I=t.length,b=n._matrix,R=(I>>2)%4;for(i=0;I>i;i+=16)E=t[i],M=t[i+1],N=t[i+2],w=t[i+3],a=b[0]*E+b[1]*M+b[2]*N+b[3]*w+b[4],s=b[5]*E+b[6]*M+b[7]*N+b[8]*w+b[9],l=b[10]*E+b[11]*M+b[12]*N+b[13]*w+b[14],u=b[15]*E+b[16]*M+b[17]*N+b[18]*w+b[19],E=t[i+4],M=t[i+5],N=t[i+6],w=t[i+7],o=b[0]*E+b[1]*M+b[2]*N+b[3]*w+b[4],c=b[5]*E+b[6]*M+b[7]*N+b[8]*w+b[9],f=b[10]*E+b[11]*M+b[12]*N+b[13]*w+b[14],_=b[15]*E+b[16]*M+b[17]*N+b[18]*w+b[19],E=t[i+8],M=t[i+9],N=t[i+10],w=t[i+11],h=b[0]*E+b[1]*M+b[2]*N+b[3]*w+b[4],m=b[5]*E+b[6]*M+b[7]*N+b[8]*w+b[9],p=b[10]*E+b[11]*M+b[12]*N+b[13]*w+b[14],d=b[15]*E+b[16]*M+b[17]*N+b[18]*w+b[19],E=t[i+12],M=t[i+13],N=t[i+14],w=t[i+15],L=b[0]*E+b[1]*M+b[2]*N+b[3]*w+b[4],v=b[5]*E+b[6]*M+b[7]*N+b[8]*w+b[9],g=b[10]*E+b[11]*M+b[12]*N+b[13]*w+b[14],A=b[15]*E+b[16]*M+b[17]*N+b[18]*w+b[19],t[i]=~~a,t[i+1]=~~s,t[i+2]=~~l,t[i+3]=~~u,t[i+4]=~~o,t[i+5]=~~c,t[i+6]=~~f,t[i+7]=~~_,t[i+8]=~~h,t[i+9]=~~m,t[i+10]=~~p,t[i+11]=~~d,t[i+12]=~~L,t[i+13]=~~v,t[i+14]=~~g,t[i+15]=~~A;if(R)for(R<<=2,i=I-R;I>i;i+=4)E=t[i],M=t[i+1],N=t[i+2],w=t[i+3],a=b[0]*E+b[1]*M+b[2]*N+b[3]*w+b[4],s=b[5]*E+b[6]*M+b[7]*N+b[8]*w+b[9],l=b[10]*E+b[11]*M+b[12]*N+b[13]*w+b[14],u=b[15]*E+b[16]*M+b[17]*N+b[18]*w+b[19],t[i]=~~a,t[i+1]=~~s,t[i+2]=~~l,t[i+3]=~~u}return t},canRun:function(){return this._isOn&&this._matrix}});o.prototype.grayscale=o.prototype.desaturate,o.prototype.rotateHue=o.prototype.adjustHue,o.prototype.thresholdRgb=o.prototype.threshold_rgb,o.prototype.thresholdAlpha=o.prototype.threshold_alpha,u&&(o.prototype._apply=function(t,e,r){var n=this;if(n._isOn&&n._matrix){var i,a,s,l,u,o,c,f,_,h,m,p,d,L,v,g,A,E,M,N,w,I=t.length,b=n._matrix,R=(I>>2)%4;for(i=0;I>i;i+=16)E=t[i],M=t[i+1],N=t[i+2],w=t[i+3],a=b[0]*E+b[1]*M+b[2]*N+b[3]*w+b[4],s=b[5]*E+b[6]*M+b[7]*N+b[8]*w+b[9],l=b[10]*E+b[11]*M+b[12]*N+b[13]*w+b[14],u=b[15]*E+b[16]*M+b[17]*N+b[18]*w+b[19],E=t[i+4],M=t[i+5],N=t[i+6],w=t[i+7],o=b[0]*E+b[1]*M+b[2]*N+b[3]*w+b[4],c=b[5]*E+b[6]*M+b[7]*N+b[8]*w+b[9],f=b[10]*E+b[11]*M+b[12]*N+b[13]*w+b[14],_=b[15]*E+b[16]*M+b[17]*N+b[18]*w+b[19],E=t[i+8],M=t[i+9],N=t[i+10],w=t[i+11],h=b[0]*E+b[1]*M+b[2]*N+b[3]*w+b[4],m=b[5]*E+b[6]*M+b[7]*N+b[8]*w+b[9],p=b[10]*E+b[11]*M+b[12]*N+b[13]*w+b[14],d=b[15]*E+b[16]*M+b[17]*N+b[18]*w+b[19],E=t[i+12],M=t[i+13],N=t[i+14],w=t[i+15],L=b[0]*E+b[1]*M+b[2]*N+b[3]*w+b[4],v=b[5]*E+b[6]*M+b[7]*N+b[8]*w+b[9],g=b[10]*E+b[11]*M+b[12]*N+b[13]*w+b[14],A=b[15]*E+b[16]*M+b[17]*N+b[18]*w+b[19],a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,o=0>o?0:o>255?255:o,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,_=0>_?0:_>255?255:_,h=0>h?0:h>255?255:h,m=0>m?0:m>255?255:m,p=0>p?0:p>255?255:p,d=0>d?0:d>255?255:d,L=0>L?0:L>255?255:L,v=0>v?0:v>255?255:v,g=0>g?0:g>255?255:g,A=0>A?0:A>255?255:A,t[i]=~~a,t[i+1]=~~s,t[i+2]=~~l,t[i+3]=~~u,t[i+4]=~~o,t[i+5]=~~c,t[i+6]=~~f,t[i+7]=~~_,t[i+8]=~~h,t[i+9]=~~m,t[i+10]=~~p,t[i+11]=~~d,t[i+12]=~~L,t[i+13]=~~v,t[i+14]=~~g,t[i+15]=~~A;if(R)for(R<<=2,i=I-R;I>i;i+=4)E=t[i],M=t[i+1],N=t[i+2],w=t[i+3],a=b[0]*E+b[1]*M+b[2]*N+b[3]*w+b[4],s=b[5]*E+b[6]*M+b[7]*N+b[8]*w+b[9],l=b[10]*E+b[11]*M+b[12]*N+b[13]*w+b[14],u=b[15]*E+b[16]*M+b[17]*N+b[18]*w+b[19],a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,t[i]=~~a,t[i+1]=~~s,t[i+2]=~~l,t[i+3]=~~u}return t})}(FILTER),!function(t,e){"use strict";var r=t.ImArrayCopy,n=t.Color.clampPixel,i=function(){var t,e=new r(256);for(t=0;256>t;t++)e[t]=t;return e},a=function(){var t,e=new r(256);for(t=0;256>t;t++)e[t]=255-t;return e},s=function(t){var e,n=new r(256);for(e=0;256>e;e++)n[e]=t;return n},l=function(t){return t?new r(t):null},u=Math.pow,o=Math.exp,c=1/255,f=t.TableLookupFilter=t.Class(t.Filter,{name:"TableLookupFilter",constructor:function(t,e,r,n){var i=this;i.$super("constructor"),i._tableR=t||null,i._tableG=e||i._tableR,i._tableB=r||i._tableG,i._tableA=n||null},path:t.getPath(ModuleFactory__FILTER_FILTERS.moduleUri),_tableR:null,_tableG:null,_tableB:null,_tableA:null,dispose:function(){var t=this;return t.$super("dispose"),t._tableR=null,t._tableG=null,t._tableB=null,t._tableA=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_tableR:t._tableR,_tableG:t._tableG,_tableB:t._tableB,_tableA:t._tableA}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r._tableR=e._tableR,r._tableG=e._tableG,r._tableB=e._tableB,r._tableA=e._tableA),r},thresholds:function(t,e,i){t.length||(t=[t]),e||(e=t),i||(i=e);var a,s,l=t.length,u=l+1,o=e.length,c=o+1,f=i.length,_=f+1,h=new r(256),m=new r(u),p=new r(256),d=new r(c),L=new r(256),v=new r(_),g=255/(u-1),A=255/(c-1),E=255/(_-1);for(a=0;u>a;)m[a]=~~(g*a),a++;for(t[0]=~~(255*t[0]),a=1;l>a;)t[a]=t[a-1]+~~(255*t[a]),a++;for(a=0;c>a;)d[a]=~~(A*a),a++;for(e[0]=~~(255*e[0]),a=1;o>a;)e[a]=e[a-1]+~~(255*e[a]),a++;for(a=0;_>a;)v[a]=~~(E*a),a++;for(i[0]=~~(255*i[0]),a=1;f>a;)i[a]=i[a-1]+~~(255*i[a]),a++;for(a=0;256>a;a++){for(s=0;l>s&&a>t[s];)s++;for(h[a]=n(m[s]),s=0;o>s&&a>e[s];)s++;for(p[a]=n(d[s]),s=0;f>s&&a>i[s];)s++;L[a]=n(v[s])}return this.set(h,p,L)},threshold:function(t,e,r){return t=t||.5,e=e||t,r=r||e,this.thresholds([t],[e],[r])},quantize:function(t){t===e&&(t=64),2>t&&(t=2);var i,a=new r(256),s=new r(t),l=255/(t-1),u=t/256;for(i=0;t>i;)s[i]=~~(l*i),i++;for(i=0;256>i;i++)a[i]=n(s[~~(u*i)]);return this.set(a)},binarize:function(){return this.quantize(2)},channel:function(e){if(null==e)return this;var r,n,a;switch(e){case t.CHANNEL.BLUE:r=s(0),n=s(0),a=i();break;case t.CHANNEL.GREEN:r=s(0),n=i(),a=s(0);break;case t.CHANNEL.RED:default:r=i(),n=s(0),a=s(0)}return this.set(r,n,a)},solarize:function(t){t===e&&(t=.5);var i,a,s=0,l=new r(256),u=2/255;for(s=0;256>s;s++)i=u*s,a=i>t?255-255*i:255*i-255,l[s]=~~n(a);return this.set(l)},solarize2:function(t){t===e&&(t=.5),t=1-t;var i,a,s=0,l=new r(256),u=2/255;for(s=0;256>s;s++)i=u*s,a=t>i?255-255*i:255*i-255,l[s]=~~n(a);return this.set(l)},solarizeInverse:function(t){t===e&&(t=.5),t*=256;var n=0,i=new r(256);for(n=0;256>n;n++)i[n]=n>t?255-n:n;return this.set(i)},invert:function(){return this.set(a())},mask:function(t){var e=0,i=t>>16&255,a=t>>8&255,s=255&t;for(tR=new r(256),tG=new r(256),tB=new r(256),e=0;256>e;e++)tR[e]=n(e&i),tG[e]=n(e&a),tB[e]=n(e&s);return this.set(tR,tG,tB)},replace:function(t,e){if(t==e)return this;var r=t>>16&255,n=t>>8&255,a=255&t,s=e>>16&255,l=e>>8&255,u=255&e,o=i(),c=i(),f=i();return o[r]=s,c[n]=l,f[a]=u,this.set(o,c,f)},extract:function(e,r,i){if(!r||!r.length)return this;i=i||0;var a,l,u=i>>16&255,o=i>>8&255,c=255&i,f=s(u),_=s(o),h=s(c);switch(e){case t.CHANNEL.BLUE:for(a=r[0],l=r[1];l>=a;)h[a]=n(a),a++;break;case t.CHANNEL.GREEN:for(a=r[0],l=r[1];l>=a;)_[a]=n(a),a++;break;case t.CHANNEL.RED:default:for(a=r[0],l=r[1];l>=a;)f[a]=n(a),a++}return this.set(f,_,h)},gammaCorrection:function(t,e,i){t=t||1,e=e||t,i=i||e,t=1/t,e=1/e,i=1/i;var a=new r(256),s=new r(256),l=new r(256),o=0;for(o=0;256>o;o++)a[o]=n(~~(255*u(c*o,t))),s[o]=n(~~(255*u(c*o,e))),l[o]=n(~~(255*u(c*o,i)));return this.set(a,s,l)},exposure:function(t){t===e&&(t=1);var i=0,a=new r(256);for(i=0;256>i;i++)a[i]=n(~~(255*(1-o(-t*i*c))));return this.set(a)},set:function(t,e,r,a){if(!t)return this;e=e||t,r=r||e;var s,u,o,c,f,_=this._tableR||i(),h=l(_);if(e&&r){for(s=this._tableG||l(_),u=this._tableB||l(s),o=l(s),c=l(u),f=0;256>f;f++)_[f]=n(t[n(h[f])]),s[f]=n(e[n(o[f])]),u[f]=n(r[n(c[f])]);this._tableR=_,this._tableG=s,this._tableB=u}else{for(f=0;256>f;f++)_[f]=n(t[n(h[f])]);this._tableR=_,this._tableG=this._tableR,this._tableB=this._tableR}return this},reset:function(){return this._tableR=this._tableG=this._tableB=this._tableA=null,this},combineWith:function(t){return this.set(t.getTable(0),t.getTable(1),t.getTable(2))},getTable:function(e){switch(e=e||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA;case t.CHANNEL.BLUE:return this._tableB;case t.CHANNEL.GREEN:return this._tableG;case t.CHANNEL.RED:default:return this._tableR}},setTable:function(e,r){switch(r=r||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA=e,this;case t.CHANNEL.BLUE:return this._tableB=e,this;case t.CHANNEL.GREEN:return this._tableG=e,this;case t.CHANNEL.RED:default:return this._tableR=e,this}},_apply:function(t,e,r){var n=this;if(!n._isOn||!n._tableR)return t;var i,a,s,l,u,o=t.length,c=(o>>2)%4,f=n._tableR,_=n._tableG,h=n._tableB,m=n._tableA;if(m){for(i=0;o>i;i+=16)a=t[i],s=t[i+1],l=t[i+2],u=t[i+3],t[i]=f[a],t[i+1]=_[s],t[i+2]=h[l],t[i+3]=m[u],a=t[i+4],s=t[i+5],l=t[i+6],u=t[i+7],t[i+4]=f[a],t[i+5]=_[s],t[i+6]=h[l],t[i+7]=m[u],a=t[i+8],s=t[i+9],l=t[i+10],u=t[i+11],t[i+8]=f[a],t[i+9]=_[s],t[i+10]=h[l],t[i+11]=m[u],a=t[i+12],s=t[i+13],l=t[i+14],u=t[i+15],t[i+12]=f[a],t[i+13]=_[s],t[i+14]=h[l],t[i+15]=m[u];if(c)for(c<<=2,i=o-c;o>i;i+=4)a=t[i],s=t[i+1],l=t[i+2],u=t[i+3],t[i]=f[a],t[i+1]=_[s],t[i+2]=h[l],t[i+3]=m[u]}else{for(i=0;o>i;i+=16)a=t[i],s=t[i+1],l=t[i+2],t[i]=f[a],t[i+1]=_[s],t[i+2]=h[l],a=t[i+4],s=t[i+5],l=t[i+6],t[i+4]=f[a],t[i+5]=_[s],t[i+6]=h[l],a=t[i+8],s=t[i+9],l=t[i+10],t[i+8]=f[a],t[i+9]=_[s],t[i+10]=h[l],a=t[i+12],s=t[i+13],l=t[i+14],t[i+12]=f[a],t[i+13]=_[s],t[i+14]=h[l];if(c)for(c<<=2,i=o-c;o>i;i+=4)a=t[i],s=t[i+1],l=t[i+2],t[i]=f[a],t[i+1]=_[s],t[i+2]=h[l]}return t},canRun:function(){return this._isOn&&this._tableR}});f.prototype.posterize=f.prototype.levels=f.prototype.quantize}(FILTER),!function(t,e){"use strict";var r=(t.ImArray,t.ImArrayCopy),n=t.Array16I,i=Math.min,a=(Math.max,Math.floor);t.DisplacementMapFilter=t.Class(t.Filter,{name:"DisplacementMapFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&e.setMap(t)},path:t.getPath(ModuleFactory__FILTER_FILTERS.moduleUri),_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,red:0,green:0,blue:0,alpha:0,mode:t.MODE.CLAMP,dispose:function(){var t=this;return t.$super("dispose"),t._map=null,t.map=null,t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.red=null,t.green=null,t.blue=null,t.alpha=null,t.mode=null,t},serialize:function(){var t=this,e=t.map;return{filter:t.name,_isOn:!!t._isOn,params:{_map:t._map||(e?{data:e.getData(),width:e.width,height:e.height}:null),scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color,red:t.red,green:t.green,blue:t.blue,alpha:t.alpha,mode:t.mode}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.map=null,r._map=e._map,r.scaleX=e.scaleX,r.scaleY=e.scaleY,r.startX=e.startX,r.startY=e.startY,r.componentX=e.componentX,r.componentY=e.componentY,r.color=e.color,r.red=e.red,r.green=e.green,r.blue=e.blue,r.alpha=e.alpha,r.mode=e.mode),r},reset:function(){var t=this;return t._map=null,t.map=null,t},getMap:function(){return this.map},setMap:function(t){var e=this;return t&&(e.map=t,e._map=null),e},setColor:function(t){var e=this;return e.color=t,e.alpha=t>>24&255,e.red=t>>16&255,e.green=t>>8&255,e.blue=255&t,e},_apply:function(e,s,l){var u=this;if(!u._isOn||!u.map&&!u._map)return e;var o,c,f,_,h,m,p,d,L,v,g,A,E,M,N,w,I,b,R,F,y,C,x,T,O,U,P,G,H,k,S,D=u.map,Y=u._map||{data:D.getData(),width:D.width,height:D.height},X=.00390625*u.scaleX,B=.00390625*u.scaleY,W=u.componentX,z=u.componentY,q=u.alpha,$=u.red,j=u.green,Q=u.blue,J=u.mode,K=t.MODE.IGNORE,V=(t.MODE.CLAMP,t.MODE.COLOR),Z=t.MODE.WRAP;for(o=Y.data,c=Y.width,f=Y.height,_=o.length>>2,m=i(c,s),p=i(f,l),G=e.length,U=m*p<<2,P=G>>2,L=a(u.startX*(s-1)),d=a(u.startY*(l-1)),v=d*s,g=-L,A=-d,E=s-L-1,M=l-d-1,h=new n(_<<1),H=new r(e),w=0,I=0,b=0,R=0,N=0;_>N;N++,w+=2,I++)I>=c&&(I=0,b++,R+=c),x=I+R<<2,h[w]=a((o[x+W]-128)*X),h[w+1]=a((o[x+z]-128)*B);for(I=0,b=0,R=0,F=0,N=0;U>N;N+=4,I++)if(I>=m&&(I=0,b++,R+=s,F+=c),!(A>b||b>M||g>I||I>E)){if(C=I+L,y=b+d,T=C+R+v<<2,w=I+F<<1,k=C+h[w],S=y+h[w+1],S>=l||0>S||k>=s||0>k){if(J==K)continue;if(J==V){e[T]=$,e[T+1]=j,e[T+2]=Q,e[T+3]=q;continue}J==Z?(S>M?S-=l:0>S&&(S+=l),k>E?k-=s:0>k&&(k+=s)):(S>M?S=M:0>S&&(S=0),k>E?k=E:0>k&&(k=0))}O=k+S*s<<2,e[T]=H[O],e[T+1]=H[O+1],e[T+2]=H[O+2],e[T+3]=H[O+3]}return e},canRun:function(){return this._isOn&&(this._map||this.map)}})}(FILTER),!function(FILTER,undef){"use strict";var IMG=FILTER.ImArray,IMGcopy=FILTER.ImArrayCopy,PI=FILTER.CONST.PI,DoublePI=FILTER.CONST.PI2,HalfPI=FILTER.CONST.PI_2,ThreePI2=1.5*PI,Sqrt=Math.sqrt,Atan2=Math.atan2,Atan=Math.atan,Sin=Math.sin,Cos=Math.cos,Floor=Math.floor,Round=Math.round,Asin=Math.asin,Tan=Math.tan,Abs=Math.abs,Max=Math.max,toRad=FILTER.CONST.toRad,Maps,GeometricMapFilter=FILTER.GeometricMapFilter=FILTER.Class(FILTER.Filter,{name:"GeometricMapFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&e.generic(t)},path:FILTER.getPath(ModuleFactory__FILTER_FILTERS.moduleUri),_map:null,_mapName:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,dx:0,dy:0,angle:0,radius:0,wavelength:0,amplitude:0,phase:0,xAmplitude:0,yAmplitude:0,xWavelength:0,yWavelength:0,mode:FILTER.MODE.CLAMP,dispose:function(){var t=this;return t.$super("dispose"),t._map=null,t._mapName=null,t.inverseTransform=null,t.matrix=null,t.centerX=null,t.centerY=null,t.dx=null,t.dy=null,t.angle=null,t.radius=null,t.wavelength=null,t.amplitude=null,t.phase=null,t.xAmplitude=null,t.yAmplitude=null,t.xWavelength=null,t.yWavelength=null,t.mode=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_mapName:t._mapName,inverseTransform:t.inverseTransform?t.inverseTransform.toString():null,matrix:t.matrix,centerX:t.centerX,centerY:t.centerY,dx:t.dx,dy:t.dy,angle:t.angle,radius:t.radius,wavelength:t.wavelength,amplitude:t.amplitude,phase:t.phase,xAmplitude:t.xAmplitude,yAmplitude:t.yAmplitude,xWavelength:t.xWavelength,yWavelength:t.yWavelength,mode:t.mode}}},unserialize:function(json){var self=this,params;return json&&self.name===json.filter&&(self._isOn=!!json._isOn,params=json.params,self.inverseTransform=null,self.matrix=params.matrix,self.centerX=params.centerX,self.centerY=params.centerY,self.dx=params.dx,self.dy=params.dy,self.angle=params.angle,self.radius=params.radius,self.wavelength=params.wavelength,self.amplitude=params.amplitude,self.phase=params.phase,self.xAmplitude=params.xAmplitude,self.yAmplitude=params.yAmplitude,self.xWavelength=params.xWavelength,self.yWavelength=params.yWavelength,self.mode=params.mode,params.inverseTransform&&(self.inverseTransform=eval('(function(){ "use strict"; return '+params.inverseTransform+"})();")),self._mapName=params._mapName,self._map=null,self._mapName&&Maps[self._mapName]&&(self._map=Maps[self._mapName])),self},generic:function(t){var e=this;return t&&(e.inverseTransform=t,e._mapName="generic",e._map=Maps.generic),e},affine:function(t){var e=this;return t&&(e.matrix=t,e._mapName="affine",e._map=Maps.affine),e},flipX:function(){var t=this;return t._mapName="flipX",t._map=Maps.flipX,t},flipY:function(){var t=this;return t._mapName="flipY",t._map=Maps.flipY,t},flipXY:function(){var t=this;return t._mapName="flipXY",t._map=Maps.flipXY,t},rotateCW:function(){var t=this;return t._mapName="rotateCW",t._map=Maps.rotateCW,t},rotateCCW:function(){var t=this;return t._mapName="rotateCCW",t._map=Maps.rotateCCW,t},polar:function(t,e){var r=this;return r.centerX=t||0,r.centerY=e||0,r._mapName="polar",r._map=Maps.polar,r},cartesian:function(t,e){var r=this;return r.centerX=t||0,r.centerY=e||0,r._mapName="cartesian",r._map=Maps.cartesian,r},twirl:function(t,e,r,n){var i=this;return i.angle=t||0,i.radius=e||0,i.centerX=r||0,i.centerY=n||0,i._mapName="twirl",i._map=Maps.twirl,i},sphere:function(t,e,r){var n=this;return n.radius=t||0,n.centerX=e||0,n.centerY=r||0,n._mapName="sphere",n._map=Maps.sphere,n},ripple:function(t,e,r,n,i,a){var s=this;return s.radius=t!==undef?t:50,s.centerX=i||0,s.centerY=a||0,s.wavelength=e!==undef?e:16,s.amplitude=r!==undef?r:10,s.phase=n||0,s._mapName="ripple",s._map=Maps.ripple,s},shift:function(t,e){var r=this;return r.dx=t!==undef?t:0,r.dy=e!==undef?e:r.dx,r._mapName="shift",r._map=Maps.shift,r},reset:function(){var t=this;return t._mapName=null,t._map=null,t},getMap:function(){return this._map},setMap:function(t){var e=this;return e._mapName=null,e._map=t,e},_apply:function(t,e,r,n){var i=this;return i._isOn&&i._map?i._map(i,t,e,r,n):t},canRun:function(){return this._isOn&&this._map}});GeometricMapFilter.prototype.translate=GeometricMapFilter.prototype.shift,Maps={generic:function(t,e,r,n){var i,a,s,l,u,o,c,f=e.length,_=new IMG(f),h=t.inverseTransform,m=t.mode,p=FILTER.MODE.CLAMP,d=FILTER.MODE.WRAP;for(i=0,a=0,s=0;f>s;s+=4,i++){if(i>=r&&(i=0,a++),u=h([i,a],r,n),o=~~u[0],c=~~u[1],0>o||o>=r||0>c||c>=n)switch(m){case d:c>=n?c-=n:0>c&&(c+=n),o>=r?o-=r:0>o&&(o+=r);break;case p:default:c>=n?c=n-1:0>c&&(c=0),o>=r?o=r-1:0>o&&(o=0)}l=o+c*r<<2,_[s]=e[l],_[s+1]=e[l+1],_[s+2]=e[l+2],_[s+3]=e[l+3]}return _},affine:function(t,e,r,n){var i,a,s,l,u,o,c,f,_,h=e.length,m=h>>2,p=new IMG(h),d=t.matrix,L=d[0],v=d[1],g=d[3],A=d[4],E=d[2],M=d[5],N=t.mode,w=FILTER.MODE.CLAMP,I=FILTER.MODE.WRAP,b=r-1,R=m-r;for(i=0,a=0,u=M*r,o=g*r,c=A*r,s=0;h>s;s+=4,i++){if(i>=r&&(i=0,a++),f=~~(L*i+v*a+E),_=~~(o*i+c*a+u),0>f||f>b||0>_||_>R)switch(N){case I:_>R?_-=m:0>_&&(_+=m),f>=r?f-=r:0>f&&(f+=r);break;case w:default:_>R?_=R:0>_&&(_=0),f>b?f=b:0>f&&(f=0)}l=f+_<<2,p[s]=e[l],p[s+1]=e[l+1],p[s+2]=e[l+2],p[s+3]=e[l+3]}return p},shift:function(t,e,r,n){var i,a,s,l,u,o=e.length,c=new IMG(o),f=-t.dx,_=-t.dy;for(0>f&&(f+=r),0>_&&(_+=n),i=0,a=0,s=0,l=0;o>l;l+=4,i++)i>=r&&(i=0,a++,s+=r),u=(i+f)%r+(a+_)%n*r<<2,c[l]=e[u],c[l+1]=e[u+1],c[l+2]=e[u+2],c[l+3]=e[u+3];return c},flipX:function(t,e,r,n){var i,a,s,l,u,o=e.length,c=new IMG(o);for(i=0,a=0,s=0,l=0;o>l;l+=4,i++)i>=r&&(i=0,a++,s+=r),u=r-1-i+s<<2,c[l]=e[u],c[l+1]=e[u+1],c[l+2]=e[u+2],c[l+3]=e[u+3];return c},flipY:function(t,e,r,n){var i,a,s,l,u,o=e.length,c=new IMG(o);for(i=0,a=0,s=(n-1)*r,l=0;o>l;l+=4,i++)i>=r&&(i=0,a++,s-=r),u=i+s<<2,c[l]=e[u],c[l+1]=e[u+1],c[l+2]=e[u+2],c[l+3]=e[u+3];return c},flipXY:function(t,e,r,n){var i,a,s,l,u,o,c=e.length,f=new IMG(c);for(i=0,a=0,l=(n-1)*r,u=0;c>u;u+=4,i++)i>=r&&(i=0,a++,s+=r,l-=r),o=r-1-i+l<<2,f[u]=e[o],f[u+1]=e[o+1],f[u+2]=e[o+2],f[u+3]=e[o+3];return f},rotateCW:function(t,e,r,n){var i,a,s,l,u,o=e.length,c=new IMG(o),f=o>>2;for(i=0,a=0,s=f-1,l=0;o>l;l+=4,i++,s-=r)i>=r&&(i=0,s=f-1,a++),u=a+s<<2,c[l]=e[u],c[l+1]=e[u+1],c[l+2]=e[u+2],c[l+3]=e[u+3];return c},rotateCCW:function(t,e,r,n){var i,a,s,l,u,o=e.length,c=new IMG(o);for(i=0,a=0,s=0,l=0;o>l;l+=4,i++,s+=r)i>=r&&(i=0,s=0,a++),u=r-1-a+s<<2,c[l]=e[u],c[l+1]=e[u+1],c[l+2]=e[u+2],c[l+3]=e[u+3];return c},twirl:function(t,e,r,n){if(0>=t.radius)return e;var i,a,s,l,u,o,c,f,_=e.length,h=new IMGcopy(e),m=t.centerX,p=t.centerY,d=t.angle,L=t.radius,v=t.mode,g=FILTER.MODE.CLAMP,A=FILTER.MODE.WRAP,E=d/L,M=r-1,N=n-1;for(m=Floor(m*(r-1)),p=Floor(p*(n-1)),i=0,a=0,s=0;_>s;s+=4,i++)if(i>=r&&(i=0,a++),o=i-m,c=a-p,u=Sqrt(o*o+c*c),L>u){if(f=Atan2(c,o)+E*(L-u),o=~~(m+u*Cos(f)),c=~~(p+u*Sin(f)),0>o||o>M||0>c||c>N)switch(v){case A:c>N?c-=n:0>c&&(c+=n),o>M?o-=r:0>o&&(o+=r);break;case g:default:c>N?c=N:0>c&&(c=0),o>M?o=M:0>o&&(o=0)}l=o+c*r<<2,e[s]=h[l],e[s+1]=h[l+1],e[s+2]=h[l+2],e[s+3]=h[l+3]}return e},sphere:function(t,e,r,n){if(0>=t.radius)return e;var i,a,s,l,u,o,c,f,_,h,m,p,d,L=e.length,v=new IMGcopy(e),g=t.centerX,A=t.centerY,E=t.radius,M=t.mode,N=FILTER.MODE.CLAMP,w=FILTER.MODE.WRAP,I=E*E,b=.555556,R=1-b,F=r-1,y=n-1;for(g=Floor(g*(r-1)),A=Floor(A*(n-1)),i=0,a=0,s=0;L>s;s+=4,i++)if(i>=r&&(i=0,a++),u=i-g,o=a-A,p=u*u,d=o*o,c=p+d,I>c){if(h=I-c,m=Sqrt(h),f=Asin(u/Sqrt(p+h))*R,_=Asin(o/Sqrt(d+h))*R,u=~~(i-m*Tan(f)),o=~~(a-m*Tan(_)),0>u||u>F||0>o||o>y)switch(M){case w:o>y?o-=n:0>o&&(o+=n),u>F?u-=r:0>u&&(u+=r);break;case N:default:o>y?o=y:0>o&&(o=0),u>F?u=F:0>u&&(u=0)}l=u+o*r<<2,e[s]=v[l],e[s+1]=v[l+1],e[s+2]=v[l+2],e[s+3]=v[l+3]}return e},ripple:function(t,e,r,n){if(0>=t.radius)return e;
var i,a,s,l,u,o,c,f,_,h,m,p=e.length,d=new IMGcopy(e),L=FILTER.MODE.CLAMP,v=FILTER.MODE.WRAP,g=r-1,A=n-1,E=t.centerX,M=t.centerY,N=t.radius,w=t.mode,I=N*N,b=t.wavelength,R=t.amplitude,F=t.phase;for(E=Floor(E*(r-1)),M=Floor(M*(n-1)),i=0,a=0,s=0;p>s;s+=4,i++)if(i>=r&&(i=0,a++),o=i-E,c=a-M,h=o*o,m=c*c,_=h+m,I>_){if(u=Sqrt(_),f=R*Sin(u/b*Math.PI*2-F),f*=(N-u)/N,u&&(f*=b/u),o=~~(i+o*f),c=~~(a+c*f),0>o||o>g||0>c||c>A)switch(w){case v:c>A?c-=n:0>c&&(c+=n),o>g?o-=r:0>o&&(o+=r);break;case L:default:c>A?c=A:0>c&&(c=0),o>g?o=g:0>o&&(o=0)}l=o+c*r<<2,e[s]=d[l],e[s+1]=d[l+1],e[s+2]=d[l+2],e[s+3]=d[l+3]}return e},polar:function(t,e,r,n){var i,a,s,l,u,o,c,f,_,h,m,p,d=e.length,L=new IMGcopy(e),v=FILTER.MODE.CLAMP,g=FILTER.MODE.WRAP,A=r-1,E=n-1,M=0,N=t.mode;for(m=~~(.5*r+.5),p=~~(.5*n+.5),h=Max(p,m),i=0,a=0,s=0;d>s;s+=4,i++){if(i>=r&&(i=0,a++),l=i-m,u=a-p,_=0,l>=0?u>0?(_=PI-Atan(l/u),M=Sqrt(l*l+u*u)):0>u?(_=Atan(l/u),M=Sqrt(l*l+u*u)):(_=HalfPI,M=l):0>l&&(0>u?(_=DoublePI-Atan(l/u),M=Sqrt(l*l+u*u)):u>0?(_=PI+Atan(l/u),M=Sqrt(l*l+u*u)):(_=ThreePI2,M=-l)),o=r-1-(r-1)/DoublePI*_,c=n*M/h,o=Round(o),c=Round(c),0>o||o>A||0>c||c>E)switch(N){case g:c>E?c-=n:0>c&&(c+=n),o>A?o-=r:0>o&&(o+=r);break;case v:default:c>E?c=E:0>c&&(c=0),o>A?o=A:0>o&&(o=0)}f=o+c*r<<2,e[s]=L[f],e[s+1]=L[f+1],e[s+2]=L[f+2],e[s+3]=L[f+3]}return e},cartesian:function(t,e,r,n){var i,a,s,l,u,o,c,f,_,h,m,p,d,L=e.length,v=new IMGcopy(e),g=FILTER.MODE.CLAMP,A=FILTER.MODE.WRAP,E=r-1,M=n-1,N=0,w=t.mode;for(p=~~(.5*r+.5),d=~~(.5*n+.5),m=Max(d,p),i=0,a=0,s=0;L>s;s+=4,i++){if(i>=r&&(i=0,a++),_=i/r*DoublePI,h=_>=ThreePI2?DoublePI-_:_>=PI?_-PI:_>=HalfPI?PI-_:_,N=m*(a/n),c=-N*Sin(h),f=N*Cos(h),_>=ThreePI2?(l=p-c,u=d-f):_>=PI?(l=p-c,u=d+f):_>=HalfPI?(l=p+c,u=d+f):(l=p+c,u=d-f),l=Round(l),u=Round(u),0>l||l>E||0>u||u>M)switch(w){case A:u>M?u-=n:0>u&&(u+=n),l>E?l-=r:0>l&&(l+=r);break;case g:default:u>M?u=M:0>u&&(u=0),l>E?l=E:0>l&&(l=0)}o=l+u*r<<2,e[s]=v[o],e[s+1]=v[o+1],e[s+2]=v[o+2],e[s+3]=v[o+3]}return e}}}(FILTER),!function(t,e){"use strict";function r(t,e,r,n){var i,a=t.length,s=new A(t.length);for(r=r||1,n=n||1,i=0;a>i;)s[i]=r*t[i]+n*e[i],i++;return s}function n(t,e){var r,n,i,a=t.length,s=[],l=0;for(r=0;a>r;r++)for(n=0;a>n;n++)i=t[r]*e[n],l+=i,s.push(i);return{kernel:s,sum:l}}function i(t){var e,r=new Array(t);for(e=0;t>e;)r[e]=1,e++;return r}function a(t){var e,r,n,i,a=I.length;if(t--,a>t)e=new A(I[t]);else for(e=new A(I[a-1]);t>=a;){for(r=e,e=new A(r.length+1),e[0]=1,n=0,i=r.length-1;i>n;n++)e[n+1]=r[n]+r[n+1];e[r.length]=1,40>a&&I.push(new Array(e)),a++}return e}function s(t){var e,r=t>>1,n=-r,i=new Array(t);for(e=0;t>e;)i[e]=n,n++,e++;return i}function l(t){var e=a(t);return n(e,e)}function u(t,e){var r=a(t),i=s(t);return 1==e?n(i.reverse(),r):n(r,i)}function o(t,e){var r=i(t),a=s(t);return 1==e?n(a.reverse(),r):n(r,a)}function c(t,e,r){e=e||1,r=r||e;var n,i=t*t,a=i>>1,s=new A(i);for(n=0;i>n;)s[n]=e,n++;return s[a]=r,s}function f(t,e,r,n){var i,a,s,l,u,o=t*t,c=t>>1,f=o>>1,_=new A(o);for(l=0,i=0;c>=i;i++){for(a=0,u=0,s=0;c>=s;s++)_[f+i+a]=l+u,_[f-i-a]=-l-u,_[f-i+a]=-l+u,_[f+i-a]=l-u,a+=t,u+=r;l+=e}return _[f]=n||1,_}function _(t,e,r,n){var i,a,s,l,u,o,c=t*t,f=t>>1,_=c>>1,h=new A(c),m=new A(c),p=1/t,L=1e-8;for(d(e)>L?(u=1,o=r/e):(u=e/r,o=1),i=0,s=0,l=0,a=o*t;f>=i;)m[_+i]=~~(_+s+l+.5),m[_-i]=~~(_-s-l+.5),i++,s+=u,l+=a;for(i=0;f>=i;)h[m[_+i]]=h[m[_-i]]=p,i++;return h[_]=n||1,h}function h(t,e,r,n,i,a,s,l,u,o){var c,f,_,h,m,p,d,L,v,g,A,N,I,b,R,F,y,C,x,T,O,U,P,G,H,k,S,D,Y,X,B,W,z,q,$,j,Q,J,K,V,Z,tt,et,rt,nt,it,at,st=t.length,lt=st>>2,ut=a,ot=s;if(L=ut*ot,p=ut>>1,d=e*(ot>>1),A=-p-1,I=-d-e,N=p,b=d,X=0,W=e-1,B=0,z=lt-e,f=(lt<<1)+lt,g=(e<<1)+e,o=o||1,at=0,i)for(T=n[0],O=n[L>>1],U=O-T,P=i[0],G=i[L>>1],H=G-P;o>at;){for(v=new E(st),c=new M(f),R=0,F=0,_=h=m=0,y=0;e>y;y++,R+=4,F+=3)_+=t[R],h+=t[R+1],m+=t[R+2],c[F]=_,c[F+1]=h,c[F+2]=m;for(F=0,y=0,_=h=m=0,R=g+e;st>R;R+=4,F+=3,y++)y>=e&&(y=0,_=h=m=0),_+=t[R],h+=t[R+1],m+=t[R+2],c[F+g]=c[F]+_,c[F+g+1]=c[F+1]+h,c[F+g+2]=c[F+2]+m;for(y=0,C=0,x=0,R=0;st>R;R+=4,y++)y>=e&&(y=0,C++,x+=e),k=y+A,S=x+I,D=y+N,Y=x+b,k=X>k?X:k,D=D>W?W:D,S=B>S?B:S,Y=Y>z?z:Y,q=k+S,Q=D+Y,$=D+S,j=k+Y,q=(q<<1)+q,$=($<<1)+$,j=(j<<1)+j,Q=(Q<<1)+Q,Z=T*(c[Q]-c[$]-c[j]+c[q])+U*t[R],tt=T*(c[Q+1]-c[$+1]-c[j+1]+c[q+1])+U*t[R+1],et=T*(c[Q+2]-c[$+2]-c[j+2]+c[q+2])+U*t[R+2],rt=P*(c[Q]-c[$]-c[j]+c[q])+H*t[R],nt=P*(c[Q+1]-c[$+1]-c[j+1]+c[q+1])+H*t[R+1],it=P*(c[Q+2]-c[$+2]-c[j+2]+c[q+2])+H*t[R+2],J=l*Z+u*rt,K=l*tt+u*nt,V=l*et+u*it,w&&(J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K,V=0>V?0:V>255?255:V),v[R]=~~J,v[R+1]=~~K,v[R+2]=~~V,v[R+3]=t[R+3];t=v,at++}else for(T=n[0],O=n[L>>1],U=O-T;o>at;){for(v=new E(st),c=new M(f),R=0,F=0,_=h=m=0,y=0;e>y;y++,R+=4,F+=3)_+=t[R],h+=t[R+1],m+=t[R+2],c[F]=_,c[F+1]=h,c[F+2]=m;for(F=0,y=0,_=h=m=0,R=g+e;st>R;R+=4,F+=3,y++)y>=e&&(y=0,_=h=m=0),_+=t[R],h+=t[R+1],m+=t[R+2],c[F+g]=c[F]+_,c[F+g+1]=c[F+1]+h,c[F+g+2]=c[F+2]+m;for(y=0,C=0,x=0,R=0;st>R;R+=4,y++)y>=e&&(y=0,C++,x+=e),k=y+A,S=x+I,D=y+N,Y=x+b,k=X>k?X:k,D=D>W?W:D,S=B>S?B:S,Y=Y>z?z:Y,q=k+S,Q=D+Y,$=D+S,j=k+Y,q=(q<<1)+q,$=($<<1)+$,j=(j<<1)+j,Q=(Q<<1)+Q,Z=T*(c[Q]-c[$]-c[j]+c[q])+U*t[R],tt=T*(c[Q+1]-c[$+1]-c[j+1]+c[q+1])+U*t[R+1],et=T*(c[Q+2]-c[$+2]-c[j+2]+c[q+2])+U*t[R+2],J=l*Z+u,K=l*tt+u,V=l*et+u,w&&(J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K,V=0>V?0:V>255?255:V),v[R]=~~J,v[R+1]=~~K,v[R+2]=~~V,v[R+3]=t[R+3];t=v,at++}return v}function m(t,e,r,n,i,a,s,l,u){var o,c,f,_,h,m,p,d,L,v,g,A,M,I,b,R,F,y,C,x,T,O,U,P,G,H,k,S=t.length,D=S>>2;for(o=[i,n],c=[s,a],G=[u,l],R=e-1,F=D-e,k=2;k--;){for(p=new E(S),_=o[k],h=c[k],f=_.length,m=h.length,H=G[k],d=new N(h),g=0;m>g;g+=2)d[g+1]*=e;if(w)for(A=0,M=0,L=0;S>L;L+=4,A++){for(A>=e&&(A=0,M+=e),O=0,U=0,P=0,g=0,v=0;f>g;g++,v+=2)I=A+d[v],b=M+d[v+1],I>=0&&R>=I&&b>=0&&F>=b&&(srcOff=I+b<<2,T=_[g],O+=t[srcOff]*T,U+=t[srcOff+1]*T,P+=t[srcOff+2]*T);y=H*O,C=H*U,x=H*P,y=0>y?0:y>255?255:y,C=0>C?0:C>255?255:C,x=0>x?0:x>255?255:x,p[L]=~~y,p[L+1]=~~C,p[L+2]=~~x,p[L+3]=t[L+3]}else for(A=0,M=0,L=0;S>L;L+=4,A++){for(A>=e&&(A=0,M+=e),O=0,U=0,P=0,g=0,v=0;f>g;g++,v+=2)I=A+d[v],b=M+d[v+1],I>=0&&R>=I&&b>=0&&F>=b&&(srcOff=I+b<<2,T=_[g],O+=t[srcOff]*T,U+=t[srcOff+1]*T,P+=t[srcOff+2]*T);y=H*O,C=H*U,x=H*P,p[L]=~~y,p[L+1]=~~C,p[L+2]=~~x,p[L+3]=t[L+3]}t=p}return p}var p=(t.CONST.SQRT2,t.CONST.toRad),d=(t.CONST.toDeg,Math.abs),L=Math.sqrt,v=Math.sin,g=Math.cos,A=t.Array32F,E=t.ImArray,M=t.Array32F,N=t.Array16I,w=(t.Array8U,t._notSupportClamp),I=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],b=t.ConvolutionMatrixFilter=t.Class(t.Filter,{name:"ConvolutionMatrixFilter",constructor:function(e,r,n){var i=this;i.$super("constructor"),i._coeff=new A([1,0]),e&&e.length?i.set(e,~~(L(e.length)+.5),r||1,n||0):(i._matrix=null,i._dim=0),i._matrix2=null,i._dim2=0,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,t.useWebGL&&(i._webglInstance=t.WebGLConvolutionMatrixFilterInstance||null)},path:t.getPath(ModuleFactory__FILTER_FILTERS.moduleUri),_dim:0,_dim2:0,_matrix:null,_matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_webglInstance:null,dispose:function(){var t=this;return t.$super("dispose"),t._webglInstance=null,t._dim=null,t._dim2=null,t._matrix=null,t._matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_dim:t._dim,_dim2:t._dim2,_matrix:t._matrix,_matrix2:t._matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r._dim=e._dim,r._dim2=e._dim2,r._matrix=e._matrix,r._matrix2=e._matrix2,r._mat=e._mat,r._mat2=e._mat2,r._coeff=e._coeff,r._isGrad=e._isGrad,r._doIntegral=e._doIntegral,r._doSeparable=e._doSeparable,r._indices=e._indices,r._indices2=e._indices2,r._indicesf=e._indicesf,r._indicesf2=e._indicesf2),r},lowPass:function(t){return t=t===e?3:t%2?t:t+1,this.set(c(t),t,1/(t*t),0),this._doIntegral=1,this},highPass:function(t,r){t=t===e?3:t%2?t:t+1,r=r===e?1:r;var n=t*t,i=-r/n,a=c(t,i,1+i);return this.set(a,t,1,0),this._doIntegral=1,this},glow:function(t,r){return t=t===e?.5:t,this.highPass(r,-t)},sharpen:function(t,r){return t=t===e?.5:t,this.highPass(r,t)},verticalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(i(t),1,1/t,0),this._dim2=t,this._doIntegral=1,this},horizontalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(i(t),t,1/t,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(t,r){r=r===e?3:r%2?r:r+1,t*=p;var n=g(t),i=-v(t),a=_(r,n,i,1/r);return this.set(a,r,1,0)},fastGauss:function(t,r){return r=r===e?3:r%2?r:r+1,t=~~(t||1),1>t?t=1:t>3&&(t=3),this.set(c(r),r,1/(r*r),0),this._doIntegral=t,this},binomialLowPass:function(t){t=t===e?3:t%2?t:t+1;var r=a(t),n=1<<t-1,i=1/n;this.set(r,t,i,i),this._matrix2=new A(r);var s=this._computeIndices(this._matrix2,this._dim2);return this._indices2=s[0],this._indicesf2=s[1],this._mat2=s[2],this._doSeparable=!0,this},binomialHighPass:function(t){t=t===e?3:t%2?t:t+1;var n=l(t);return this.set(r(c(t),new A(n.kernel),1,-1/n.sum),t,1,0)},prewittX:function(t){t=t===e?3:t%2?t:t+1;var r=o(t,0);return this.set(r.kernel,t,1,0)},prewittY:function(t){t=t===e?3:t%2?t:t+1;var r=o(t,1);return this.set(r.kernel,t,1,0)},prewittDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=p;var i=g(t),a=v(t),s=o(n,0),l=o(n,1);return this.set(r(new A(s.kernel),new A(l.kernel),i,a),n,1,0)},prewitt:function(t){t=t===e?3:t%2?t:t+1;var r=o(t,0),n=o(t,1);this.set(r.kernel,t,1,0),this._isGrad=!0,this._matrix2=new A(n.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this},sobelX:function(t){t=t===e?3:t%2?t:t+1;var r=u(t,0);return this.set(r.kernel,t,1,0)},sobelY:function(t){t=t===e?3:t%2?t:t+1;var r=u(t,1);return this.set(r.kernel,t,1,0)},sobelDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=p;var i=g(t),a=v(t),s=u(n,0),l=u(n,1);return this.set(r(new A(s.kernel),new A(l.kernel),i,a),n,1,0)},sobel:function(t){t=t===e?3:t%2?t:t+1;var r=u(t,0),n=u(t,1);this.set(r.kernel,t,1,0),this._matrix2=new A(n.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this._isGrad=!0,this},laplace:function(t){t=t===e?3:t%2?t:t+1;var r=t*t,n=c(t,-1,r-1);return this.set(n,t,1,0),this._doIntegral=1,this},emboss:function(t,r,n){n=n===e?3:n%2?n:n+1,t=t===e?-.25*Math.PI:t*p,r=r||1;var i=r*g(t),a=-r*v(t),s=f(n,i,a,1);return this.set(s,n,1,0)},edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,r,n){var i=this;i._matrix2=null,i._dim2=0,i._indices2=i._indicesf2=null,i._mat2=null,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,i._matrix=new A(t),i._dim=e,i._coeff[0]=r||1,i._coeff[1]=n||0;var a=i._computeIndices(i._matrix,i._dim);return i._indices=a[0],i._indicesf=a[1],i._mat=a[2],i},_computeIndices:function(t,e){var r,n,i,a=[],s=[],l=[],u=t.length,o=e,c=o>>1;for(n=0,i=0,r=0;u>r;)s.push(n-c),s.push(i-c),t[r]&&(a.push(n-c),a.push(i-c),l.push(t[r])),r++,n++,n>=o&&(n=0,i++);return[new N(a),new N(s),new A(l)]},reset:function(){var t=this;return t._matrix=t._matrix2=null,t._mat=t._mat2=null,t._dim=t._dim2=0,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t},combineWith:function(t){return this},getMatrix:function(){return this._matrix},setMatrix:function(t,e){return this.set(t,e)},_apply:function(t,e,r){var n=this;if(!n._isOn||!n._matrix)return t;if(n._doIntegral)return n._matrix2?h(t,e,r,n._matrix,n._matrix2,n._dim,n._dim2,n._coeff[0],n._coeff[1],n._doIntegral):h(t,e,r,n._matrix,null,n._dim,n._dim,n._coeff[0],n._coeff[1],n._doIntegral);if(n._doSeparable)return m(t,e,r,n._mat,n._mat2,n._indices,n._indices2,n._coeff[0],n._coeff[1]);var i,a,s,l,u,o,c,f,_,p,L,v,g,A,M,I,b,R,F,y,C,x,T=t.length,O=T>>2,U=new E(T),P=e-1,G=O-e,H=n._coeff[0],k=n._coeff[1],S=n._matrix,D=n._matrix2,Y=n._isGrad;if(D){for(y=n._indicesf.length,x=new N(n._indicesf),o=0;y>o;o+=2)x[o+1]*=e;for(C=S.length,c=0,f=0,l=0;T>l;l+=4,c++){for(c>=e&&(c=0,f+=e),v=0,g=0,A=0,M=0,I=0,b=0,o=0,u=0;C>o;o++,u+=2)_=c+x[u],p=f+x[u+1],_>=0&&P>=_&&p>=0&&G>=p&&(L=_+p<<2,R=S[o],v+=t[L]*R,g+=t[L+1]*R,A+=t[L+2]*R,F=D[o],M+=t[L]*F,I+=t[L+1]*F,b+=t[L+2]*F);Y?(i=d(v)+d(M),a=d(g)+d(I),s=d(A)+d(b)):(i=H*v+k*M,a=H*g+k*I,s=H*A+k*b),w&&(i=0>i?0:i>255?255:i,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s),U[l]=~~i,U[l+1]=~~a,U[l+2]=~~s,U[l+3]=t[l+3]}}else{for(y=n._indices.length,x=new N(n._indices),o=0;y>o;o+=2)x[o+1]*=e;for(S=n._mat,C=S.length,c=0,f=0,l=0;T>l;l+=4,c++){for(c>=e&&(c=0,f+=e),v=0,g=0,A=0,o=0,u=0;C>o;o++,u+=2)_=c+x[u],p=f+x[u+1],_>=0&&P>=_&&p>=0&&G>=p&&(L=_+p<<2,R=S[o],v+=t[L]*R,g+=t[L+1]*R,A+=t[L+2]*R);i=H*v+k,a=H*g+k,s=H*A+k,w&&(i=0>i?0:i>255?255:i,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s),U[l]=~~i,U[l+1]=~~a,U[l+2]=~~s,U[l+3]=t[l+3]}}return U},canRun:function(){return this._isOn&&this._matrix}});b.prototype.bump=b.prototype.emboss,b.prototype.boxBlur=b.prototype.lowPass,b.prototype.gaussBlur=b.prototype.binomialLowPass,b.prototype.gradX=b.prototype.prewittX,b.prototype.gradY=b.prototype.prewittY,b.prototype.gradDirectional=b.prototype.prewittDirectional,b.prototype.grad=b.prototype.prewitt}(FILTER),!function(t,e){"use strict";var r,n=t.ImArray,i=t.Array8U,a=t.Array32I,s=Math.sqrt,l=function(t){var e,r=t*t,n=new i(r);for(e=0;r>e;e++)n[e]=1;return n},u=l(3);t.MorphologicalFilter=t.Class(t.Filter,{name:"MorphologicalFilter",constructor:function(){var t=this;t.$super("constructor"),t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null},path:t.getPath(ModuleFactory__FILTER_FILTERS.moduleUri),_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var t=this;return t.$super("dispose"),t._filterName=null,t._filter=null,t._dim=null,t._structureElement=null,t._indices=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_structureElement:t._structureElement,_indices:t._indices}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._structureElement=e._structureElement,n._indices=e._indices,n._filterName=e._filterName,n._filterName&&r[n._filterName]&&(n._filter=r[n._filterName])),n},erode:function(t){return this.set(t,"erode")},dilate:function(t){return this.set(t,"dilate")},opening:function(t){return this.set(t,"open")},closing:function(t){return this.set(t,"close")},set:function(t,e){var n=this;n._filterName=e,n._filter=r[e],t&&t.length?(n._structureElement=new i(t),n._dim=~~(s(n._structureElement.length)+.5)):t&&t===t-0?(n._structureElement=l(t),n._dim=t):(n._structureElement=u,n._dim=3);var o,c,f,_=[],t=n._structureElement,h=t.length,m=n._dim,p=m>>1;for(c=0,f=0,o=0;h>o;)t[o]&&(_.push(c-p),_.push(f-p)),o++,c++,c>=m&&(c=0,f++);return n._indices=new a(_),n},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null,t},_apply:function(t,e,r){var n=this;return n._isOn&&n._dim&&n._filter?n._filter(n,t,e,r):t},canRun:function(){return this._isOn&&this._dim&&this._filter}});r={dilate:function(t,e,r,i){var s,l,u,o,c,f,_,h,m,p,d,L,v,g,A=t._structureElement,E=(A.length,t._dim,new a(t._indices)),M=e.length,N=M>>2,w=new n(M),I=E.length,b=I>>1,R=r-1,F=N-r;for(u=0;I>u;u+=2)E[u+1]*=r;for(o=0,c=0,s=0;M>s;s+=4,o++){for(o>=r&&(o=0,c+=r),L=0,v=0,g=0,l=0;b>l;l+=2)f=o+E[l],_=c+E[l+1],f>=0&&R>=f&&_>=0&&F>=_&&(h=f+_<<2,m=e[h],p=e[h+1],d=e[h+2],m>L&&(L=m),p>v&&(v=p),d>g&&(g=d));w[s]=L,w[s+1]=v,w[s+2]=g,w[s+3]=e[s+3]}return w},erode:function(t,e,r,i){var s,l,u,o,c,f,_,h,m,p,d,L,v,g,A=t._structureElement,E=(A.length,t._dim,new a(t._indices)),M=e.length,N=M>>2,w=new n(M),I=E.length,b=I>>1,R=r-1,F=N-r;for(u=0;I>u;u+=2)E[u+1]*=r;for(o=0,c=0,s=0;M>s;s+=4,o++){for(o>=r&&(o=0,c+=r),L=255,v=255,g=255,l=0;b>l;l+=2)f=o+E[l],_=c+E[l+1],f>=0&&R>=f&&_>=0&&F>=_&&(h=f+_<<2,m=e[h],p=e[h+1],d=e[h+2],L>m&&(L=m),v>p&&(v=p),g>d&&(g=d));w[s]=L,w[s+1]=v,w[s+2]=g,w[s+3]=e[s+3]}return w},open:function(t,e,r,i){var s,l,u,o,c,f,_,h,m,p,d,L,v,g,A=t._structureElement,E=(A.length,t._dim,new a(t._indices)),M=e.length,N=M>>2,w=new n(M),I=E.length,b=I>>1,R=r-1,F=N-r;for(u=0;I>u;u+=2)E[u+1]*=r;for(o=0,c=0,s=0;M>s;s+=4,o++){for(o>=r&&(o=0,c+=r),L=255,v=255,g=255,l=0;b>l;l+=2)f=o+E[l],_=c+E[l+1],f>=0&&R>=f&&_>=0&&F>=_&&(h=f+_<<2,m=e[h],p=e[h+1],d=e[h+2],L>m&&(L=m),v>p&&(v=p),g>d&&(g=d));w[s]=L,w[s+1]=v,w[s+2]=g,w[s+3]=e[s+3]}for(e=w,w=new n(M),o=0,c=0,s=0;M>s;s+=4,o++){for(o>=r&&(o=0,c+=r),L=255,v=255,g=255,l=0;b>l;l+=2)f=o+E[l],_=c+E[l+1],f>=0&&R>=f&&_>=0&&F>=_&&(h=f+_<<2,m=e[h],p=e[h+1],d=e[h+2],L>m&&(L=m),v>p&&(v=p),g>d&&(g=d));w[s]=L,w[s+1]=v,w[s+2]=g,w[s+3]=e[s+3]}return w},close:function(t,e,r,i){var s,l,u,o,c,f,_,h,m,p,d,L,v,g,A=t._structureElement,E=(A.length,t._dim,new a(t._indices)),M=e.length,N=M>>2,w=new n(M),I=E.length,b=I>>1,R=r-1,F=N-r;for(u=0;I>u;u+=2)E[u+1]*=r;for(o=0,c=0,s=0;M>s;s+=4,o++){for(o>=r&&(o=0,c+=r),L=255,v=255,g=255,l=0;b>l;l+=2)f=o+E[l],_=c+E[l+1],f>=0&&R>=f&&_>=0&&F>=_&&(h=f+_<<2,m=e[h],p=e[h+1],d=e[h+2],L>m&&(L=m),v>p&&(v=p),g>d&&(g=d));w[s]=L,w[s+1]=v,w[s+2]=g,w[s+3]=e[s+3]}for(e=w,w=new n(M),o=0,c=0,s=0;M>s;s+=4,o++){for(o>=r&&(o=0,c+=r),L=255,v=255,g=255,l=0;b>l;l+=2)f=o+E[l],_=c+E[l+1],f>=0&&R>=f&&_>=0&&F>=_&&(h=f+_<<2,m=e[h],p=e[h+1],d=e[h+2],L>m&&(L=m),v>p&&(v=p),g>d&&(g=d));w[s]=L,w[s+1]=v,w[s+2]=g,w[s+3]=e[s+3]}return w}}}(FILTER),!function(t,e){"use strict";var r,n=t.ImArray,i=t.Array32I,a=(Math.min,Math.max,t.StatisticalFilter=t.Class(t.Filter,{name:"StatisticalFilter",constructor:function(){var t=this;t.$super("constructor"),t._dim=0,t._indices=null,t._filterName=null,t._filter=null},path:t.getPath(ModuleFactory__FILTER_FILTERS.moduleUri),_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var t=this;return t.$super("dispose"),t._dim=null,t._indices=null,t._filter=null,t._filterName=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_indices:t._indices}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._indices=e._indices,n._filterName=e._filterName,n._filterName&&r[n._filterName]&&(n._filter=r[n._filterName])),n},median:function(t){return this.set(null==t?3:1&t?t:t+1,"median")},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,"minimum")},maximum:function(t){return this.set(null==t?3:1&t?t:t+1,"maximum")},set:function(t,e){var n=this;n._filterName=e,n._filter=r[e],n._dim=t;var a,s,l,u=[],o=t*t,c=t,f=c>>1;for(s=0,l=0,a=0;o>a;)u.push(s-f),u.push(l-f),a++,s++,s>=c&&(s=0,l++);return n._indices=new i(u),n},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._indices=null,t},_apply:function(t,e,r){var n=this;return n._isOn&&n._dim?n._filter(n,t,e,r):t},canRun:function(){return this._isOn&&this._dim}}));a.prototype.erode=a.prototype.minimum,a.prototype.dilate=a.prototype.maximum,r={median:function(t,e,r,a){var s,l,u,o,c,f,_,h,m,p,d,L,v,g,A,E,M,N,w=t._dim,I=w*w,b=new i(t._indices),R=e.length,F=R>>2,y=new n(R),C=I<<1,x=r-1,T=F-r;for(h=[],m=[],p=[],l=0;C>l;l+=2)b[l+1]*=r;for(s=0,u=0,o=0;R>s;){for(h.length=0,m.length=0,p.length=0,l=0;C>l;)c=u+b[l],f=o+b[l+1],c>=0&&x>=c&&f>=0&&T>=f&&(_=c+f<<2,d=e[_],L=e[_+1],v=e[_+2],h.push(d),m.push(L),p.push(v)),l+=2;h.sort(),m.sort(),p.sort(),M=h.length,N=M>>>1,g=1&M?h[N]:~~(.5*h[N-1]+.5*h[N]),A=1&M?m[N]:~~(.5*m[N-1]+.5*m[N]),E=1&M?p[N]:~~(.5*p[N-1]+.5*p[N]),y[s]=g,y[s+1]=A,y[s+2]=E,y[s+3]=e[s+3],s+=4,u++,u>=r&&(u=0,o+=r)}return y},maximum:function(t,e,r,a){var s,l,u,o,c,f,_,h,m,p,d,L,v,g=t._dim,A=g*g,E=new i(t._indices),M=e.length,N=M>>2,w=new n(M),I=A<<1,b=r-1,R=N-r;for(l=0;I>l;l+=2)E[l+1]*=r;for(s=0,u=0,o=0;M>s;){for(d=0,L=0,v=0,l=0;I>l;)c=u+E[l],f=o+E[l+1],c>=0&&b>=c&&f>=0&&R>=f&&(_=c+f<<2,h=e[_],m=e[_+1],p=e[_+2],h>d&&(d=h),m>L&&(L=m),p>v&&(v=p)),l+=2;w[s]=d,w[s+1]=L,w[s+2]=v,w[s+3]=e[s+3],s+=4,u++,u>=r&&(u=0,o+=r)}return w},minimum:function(t,e,r,a){var s,l,u,o,c,f,_,h,m,p,d,L,v,g=t._dim,A=g*g,E=new i(t._indices),M=e.length,N=M>>2,w=new n(M),I=A<<1,b=r-1,R=N-r;for(l=0;I>l;l+=2)E[l+1]*=r;for(s=0,u=0,o=0;M>s;){for(d=255,L=255,v=255,l=0;I>l;)c=u+E[l],f=o+E[l+1],c>=0&&b>=c&&f>=0&&R>=f&&(_=c+f<<2,h=e[_],m=e[_+1],p=e[_+2],d>h&&(d=h),L>m&&(L=m),v>p&&(v=p)),l+=2;w[s]=d,w[s+1]=L,w[s+2]=v,w[s+3]=e[s+3],s+=4,u++,u>=r&&(u=0,o+=r)}return w}}}(FILTER),FILTER});