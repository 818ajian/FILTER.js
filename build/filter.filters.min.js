/**
*
*   FILTER.js Generic Filters
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Generic Filters)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,n){"use strict";"object"==typeof module&&module.exports?module.exports=n.call(t,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_FILTERS")?define("FILTER_FILTERS",["module","FILTER"],function(e,r){return n.moduleUri=e.uri,n.call(t,r),r}):(n.call(t,t.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return t.FILTER})}(this,function t(n){"use strict";var e=n.getPath(t.moduleUri);return!function(t,n){var r=(Object.prototype,Function.prototype,Array.prototype),i=r.slice,a=r.splice,l=r.push,s=t.Filter.get,o=t.Create({name:"CompositeFilter",init:function(t){var n=this;n.filters=t&&t.length?t:[]},path:e,filters:null,hasInputs:!0,_stable:!0,dispose:function(t){var n,e=this,r=e.filters;if(!0===t)for(n=0;n<r.length;n++)r[n]&&r[n].dispose(t),r[n]=null;return e.filters=null,e.$super("dispose"),e},serializeInputs:function(t){var n,e,r,i=this,a=i.filters,l=[],s=!1;for(n=0,e=a.length;e>n;n++)l.push(r=a[n].serializeInputs(t)),r&&(s=!0);return s?l:null},unserializeInputs:function(t,n){var e=this;if(!t)return e;var r,i,a=e.filters;for(r=0,i=a.length;i>r;r++)t[r]&&a[r].unserializeInputs(t[r],n);return e},serialize:function(){var t,n,e=this,r=e.filters,i=[];for(t=0,n=r.length;n>t;t++)i.push(r[t].serializeFilter());return{_stable:e._stable,filters:i}},unserialize:function(t){var n,e,r,i,a,l=this,o=l.filters;if(l._stable=t._stable,i=t.filters||[],e=i.length,r=o.length,e===r&&l._stable)for(n=0;e>n;n++)o[n].unserializeFilter(i[n]);else{for(n=0;r>n;n++)o[n]&&o[n].dispose(!0),o[n]=null;for(o=[],n=0;e>n;n++){if(a=i[n]&&i[n].filter?s(i[n].filter):null,!a)throw new Error('Filter "'+i[n].filter+'" could not be created');o.push((new a).unserializeFilter(i[n]))}l.filters=o}return l},setMeta:function(t,n){var e,r,i=this,a=i.filters;if(t&&t.filters&&(r=t.filters.length)&&a.length)for(e=0;r>e;e++)a[t.filters[e][0]].setMeta(t.filters[e][1],n);return t&&null!=t._IMG_WIDTH&&(i._meta={_IMG_WIDTH:t._IMG_WIDTH,_IMG_HEIGHT:t._IMG_HEIGHT},i.hasMeta=!0),i},stable:function(t){return arguments.length||(t=!0),this._stable=!!t,this},set:function(t){return t&&t.length&&(this.filters=t),this},filter:function(t,n){return arguments.length>1?(this.filters.length>t?this.filters[t]=n:this.filters.push(n),this):this.filters.length>t?this.filters[t]:null},get:null,push:function(){return arguments.length&&l.apply(this.filters,arguments),this},concat:null,pop:function(){return this.filters.pop()},shift:function(){return this.filters.shift()},unshift:function(){return arguments.length&&a.apply(this.filters,l.apply([0,0],arguments)),this},insertAt:function(t){var n=i.call(arguments);n.length;return argslen>1&&(n.shift(),a.apply(this.filters,[t,0].concat(n))),this},removeAt:function(t){return this.filters.splice(t,1)},remove:function(t){for(var n=this.filters.length;--n>=0;)t===this.filters[n]&&this.filters.splice(n,1);return this},reset:function(){return this.filters.length=0,this},empty:null,_apply:function(t,n,e,r){var i,a,l=this;if(a={filters:[]},l.filters.length){r=r||{},r.container=l,r.index=0;var s,o,u=l.filters,c=u.length;for(s=0;c>s;s++)o=u[s],o&&o._isOn&&(r.index=s,t=o._apply(t,n,e,r),o.hasMeta&&(a.filters.push([s,i=o.getMeta()]),null!=i._IMG_WIDTH&&(a._IMG_WIDTH=n=i._IMG_WIDTH,a._IMG_HEIGHT=e=i._IMG_HEIGHT)))}return a.filters.length>0?(l.hasMeta=!0,l._meta=a):(l.hasMeta=!1,l._meta=null),t},canRun:function(){return this._isOn&&this.filters.length},toString:function(){var t,n="	",e=this.filters,r=[],i=e.length;for(t=0;i>t;t++)r.push(n+e[t].toString().split("\n").join("\n"+n));return["[FILTER: "+this.name+"]","[",r.join("\n"),"]",""].join("\n")}});o.prototype.get=o.prototype.filter,o.prototype.empty=o.prototype.reset,o.prototype.concat=o.prototype.push,t.CompositionFilter=t.CompositeFilter}(n),!function(t,n){var r=Math.min,i=Math.max,a=(Math.floor,t.Array32F),l=t._notSupportClamp;t.Create({name:"AlgebraicFilter",init:function(t){var n=this;n.set(t)},path:e,matrix:null,raw:!1,hasInputs:!0,dispose:function(){var t=this;return t.matrix=null,t.raw=null,t.$super("dispose"),t},serialize:function(){var t=this;return{matrix:t.matrix,raw:t.raw}},unserialize:function(t){var n=this;return n.matrix=t.matrix,n.raw=t.raw,n},set:function(t){var n=this;return t&&t.length&&(n.matrix=t),n},setInputValues:function(t,e){var r,i=this,a=i.matrix;return e&&(a||(a=i.matrix=[1,0,0,0,0,null,null]),r=7*(t-1),null!=e.a&&(a[r]=+e.a),null!=e.b&&(a[r+1]=+e.b),null!=e.c&&(a[r+2]=+e.c),null!=e.tx&&(a[r+3]=+e.tx),null!=e.ty&&(a[r+4]=+e.ty),n!==e.co&&(a[r+5]=e.co),n!==e.ci&&(a[r+6]=e.ci)),i},reset:function(){var t=this;return t.matrix=null,t.resetInputs(),t},_apply:function(t,n,e){var s=this,o=s.matrix;if(!o)return t;var u,c,f,h,m,_,p,d,g,v,C,y,x,R,I,A,w,b,L,E,T,M,G,S,F,N,Y,H,O,B,X,z=o.length,D=t.length,U=D>>>2,V=new a(D);for(f=0,b=n,L=e,w=t,c=0;z>c;c+=7){if(E=r(n,b),T=r(e,L),X=E*T,y=o[c+0],x=o[c+1],R=o[c+2]||0,v=(o[c+3]||0)*(n-1)|0,C=(o[c+4]||0)*(e-1)*n|0,A=o[c+5],I=o[c+6],null!==I&&null!==A)for(d=0,p=C,g=0,u=0;X>u;u++,d++)d>=E&&(d=0,p+=n,g+=b),_=d+v,0>_||_>=n||0>p||p>=U||(h=_+p<<2,m=d+g<<2,V[h+A]=y*V[h+A]+x*w[m+I]+R);else if(null!==I)for(d=0,p=C,g=0,u=0;X>u;u++,d++)d>=E&&(d=0,p+=n,g+=b),_=d+v,0>_||_>=n||0>p||p>=U||(h=_+p<<2,m=d+g<<2,B=x*w[m+I]+R,V[h]=y*V[h]+B,V[h+1]=y*V[h+1]+B,V[h+2]=y*V[h+2]+B,V[h+3]=y*V[h+3]+B);else if(null!==A)for(M=(x>>>16&255)/255,G=(x>>>8&255)/255,S=(255&x)/255,F=(x>>>24&255)/255,N=R>>>16&255,Y=R>>>8&255,H=255&R,O=R>>>24&255,d=0,p=C,g=0,u=0;X>u;u++,d++)d>=E&&(d=0,p+=n,g+=b),_=d+v,0>_||_>=n||0>p||p>=U||(h=_+p<<2,m=d+g<<2,V[h+A]=y*V[h+A]+M*w[m]+N+G*w[m+1]+Y+S*w[m+2]+H+F*w[m+3]+O);else for(d=0,p=C,g=0,u=0;X>u;u++,d++)d>=E&&(d=0,p+=n,g+=b),_=d+v,0>_||_>=n||0>p||p>=U||(h=_+p<<2,m=d+g<<2,V[h]=y*V[h]+x*w[m]+R,V[h+1]=y*V[h+1]+x*w[m+1]+R,V[h+2]=y*V[h+2]+x*w[m+2]+R,V[h+3]=y*V[h+3]+x*w[m+3]+R);w=s.input(++f),b=w[1],L=w[2],w=w[0]}if(l)for(u=0;D>u;u+=4)t[u]=r(255,i(0,0|V[u])),t[u+1]=r(255,i(0,0|V[u+1])),t[u+2]=r(255,i(0,0|V[u+2])),t[u+3]=r(255,i(0,0|V[u+3]));else for(u=0;D>u;u+=4)t[u]=0|V[u],t[u+1]=0|V[u+1],t[u+2]=0|V[u+2],t[u+3]=0|V[u+3];return t}})}(n),!function(t,n){var r="hasOwnProperty",i=t.ImArray,a=(t.ImArrayCopy,Math.min),l=Math.round,s=t.Util.Array.hasArrayset,o=t.Util.Array.arrayset,u=t._notSupportClamp,c=t.Color.Blend;t.Create({name:"BlendFilter",init:function(t){var n=this;n.set(t)},path:e,matrix:null,hasInputs:!0,dispose:function(){var t=this;return t.matrix=null,t.$super("dispose"),t},serialize:function(){var t=this;return{matrix:t.matrix}},unserialize:function(t){var n=this;return n.matrix=t.matrix,n},set:function(t){var n=this;return t&&t.length&&(n.matrix=t),n},setInputValues:function(t,e){var r,i=this,a=i.matrix;return e&&(a||(a=i.matrix=["normal",0,0,1,1]),r=t-1<<2,n!==e.mode&&(a[r]=e.mode||"normal"),null!=e.startX&&(a[r+1]=+e.startX),null!=e.startY&&(a[r+2]=+e.startY),null!=e.alpha&&(a[r+3]=+e.alpha),null!=e.enabled&&(a[r+4]=!!e.enabled)),i},reset:function(){var t=this;return t.matrix=null,t.resetInputs(),t},_apply:function(t,n,e){var f=this,h=f.matrix;if(!h||!h.length)return t;var m,_,p,d,g,v,C,y,x,R,I,A,w,b,L,E,T,M,G,S,F,N,Y,H,O,B=h.length,X=t.length;for(O=new i(X),s?O.set(t):o(O,t),m=0,_=1;B>m;m+=5,_++)if(h[m+4]&&(d=h[m+3]||0,0!==d&&(H=h[m]||"normal",Y=c[r](H)?c[H]:null,Y&&(p=f.input(_),p&&(I=p[0],A=p[1],w=p[2],g=h[m+1]||0,v=h[m+2]||0,C=0,y=0,0>g&&(C=-g,g=0),0>v&&(y=-v,v=0),!(g>=n||v>=e||C>=A||y>=w||(g=l(g),v=l(v),C=l(C),y=l(y),x=a(n-g,A-C),R=a(e-v,w-y),0>=x||0>=R)))))))for(M=g,G=v*n,S=C,F=y*A,b=g+x,L=C+x,E=0,T=R*x;T>E;E++)N=S+F<<2,0<I[N+3]&&Y(O,I,M+G<<2,N,d,u),++M>=b&&(M=g,G+=n),++S>=L&&(S=C,F+=A);return O}}),t.CombineFilter=t.BlendFilter}(n),!function(t,n){var r=t.CHANNEL,i=t.ColorTable,a=t.Color.clampPixel,l=t.Util.Filter,s=l.ct_eye,o=l.ct_multiply,u=Math.pow,c=Math.exp,f=1/255,h=t.Util.Array.typed,m=t.Create({name:"ColorTableFilter",init:function(t,n,e,i){var a=this;a._table=[null,null,null,null],t=t||null,n=n||t,e=e||n,i=i||null,a._table[r.R]=t,a._table[r.G]=n,a._table[r.B]=e,a._table[r.A]=i},path:e,_table:null,dispose:function(){var t=this;return t._table=null,t.$super("dispose"),t},serialize:function(){var t=this;return{_tableR:t._table[r.R],_tableG:t._table[r.G],_tableB:t._table[r.B],_tableA:t._table[r.A]}},unserialize:function(t){var n=this;return n._table[r.R]=h(t._tableR,i),n._table[r.G]=h(t._tableG,i),n._table[r.B]=h(t._tableB,i),n._table[r.A]=h(t._tableA,i),n},channel:function(t){if(null==t)return this;var n,e,i;switch(t||r.R){case r.B:n=s(0,0),e=s(0,0),i=s();break;case r.G:n=s(0,0),e=s(),i=s(0,0);break;case r.R:default:n=s(),e=s(0,0),i=s(0,0)}return this.set(n,e,i)},redChannel:function(){return this.channel(r.R)},greenChannel:function(){return this.channel(r.G)},blueChannel:function(){return this.channel(r.B)},channelInvert:function(t){if(null==t)return this;var n,e,i;switch(t||r.R){case r.B:n=s(),e=s(),i=s(-1,255);break;case r.G:n=s(),e=s(-1,255),i=s();break;case r.R:default:n=s(-1,255),e=s(),i=s()}return this.set(n,e,i)},redInvert:function(){return this.channelInvert(r.R)},greenInvert:function(){return this.channelInvert(r.G)},blueInvert:function(){return this.channelInvert(r.B)},invert:function(){return this.set(s(-1,255))},thresholds:function(t,n,e){t.length||(t=[t]),n||(n=t),e||(e=n);var r,l,s=t.length,o=s+1,u=n.length,c=u+1,f=e.length,h=f+1,m=new i(256),_=new i(o),p=new i(256),d=new i(c),g=new i(256),v=new i(h),C=255/(o-1),y=255/(c-1),x=255/(h-1);for(r=0;o>r;)_[r]=C*r|0,r++;for(t[0]=255*t[0]|0,r=1;s>r;)t[r]=t[r-1]+255*t[r]|0,r++;for(r=0;c>r;)d[r]=y*r|0,r++;for(n[0]=255*n[0]|0,r=1;u>r;)n[r]=n[r-1]+255*n[r]|0,r++;for(r=0;h>r;)v[r]=x*r|0,r++;for(e[0]=255*e[0]|0,r=1;f>r;)e[r]=e[r-1]+255*e[r]|0,r++;for(r=0;256>r;r++){for(l=0;s>l&&r>t[l];)l++;for(m[r]=a(_[l]),l=0;u>l&&r>n[l];)l++;for(p[r]=a(d[l]),l=0;f>l&&r>e[l];)l++;g[r]=a(v[l])}return this.set(m,p,g)},threshold:function(t,n,e){return t=null==t?.5:t,n=null==n?t:n,e=null==e?n:e,this.thresholds([t],[n],[e])},quantize:function(t){null==t&&(t=64),2>t&&(t=2);var n,e=new i(256),r=new i(t),l=255/(t-1),s=t/256;for(n=0;t>n;)r[n]=l*n|0,n++;for(n=0;256>n;n++)e[n]=a(r[s*n|0]);return this.set(e)},posterize:null,binarize:function(){return this.quantize(2)},solarize:function(t,n){null==n&&(n=1),null==t&&(t=.5);var e,r,l,s=new i(256),o=2/255;if(-1===n)for(t*=256,e=0;256>e;e++)s[e]=e>t?255-e:e;else if(2===n)for(t=1-t,e=0;256>e;e++)r=o*e,l=t>r?255-255*r|0:255*r-255|0,s[e]=a(l);else for(e=0;256>e;e++)r=o*e,l=r>t?255-255*r|0:255*r-255|0,s[e]=a(l);return this.set(s)},solarize2:function(t){return this.solarize(t,2)},solarizeInverse:function(t){return this.solarize(t,-1)},mask:function(t){var n=0,e=new i(256),r=new i(256),l=new i(256),s=t>>>16&255,o=t>>>8&255,u=255&t;for(n=0;256>n;n++)e[n]=a(n&s),r[n]=a(n&o),l[n]=a(n&u);return this.set(e,r,l)},replace:function(t,n){if(t==n)return this;var e=t>>>16&255,r=t>>>8&255,i=255&t,a=n>>>16&255,l=n>>>8&255,o=255&n,u=s(),c=s(),f=s();return u[e]=a,c[r]=l,f[i]=o,this.set(u,c,f)},extract:function(t,n,e){if(!n||!n.length)return this;e=e||0;var i,l,o=e>>>16&255,u=e>>>8&255,c=255&e,f=s(0,o),h=s(0,u),m=s(0,c);switch(t||r.R){case r.B:for(i=n[0],l=n[1];l>=i;)m[i]=a(i),i++;break;case r.G:for(i=n[0],l=n[1];l>=i;)h[i]=a(i),i++;break;case r.R:default:for(i=n[0],l=n[1];l>=i;)f[i]=a(i),i++}return this.set(f,h,m)},gammaCorrection:function(t,n,e){t=t||1,n=n||t,e=e||n,t=1/t,n=1/n,e=1/e;var r=new i(256),l=new i(256),s=new i(256),o=0;for(o=0;256>o;o++)r[o]=a(255*u(f*o,t)|0),l[o]=a(255*u(f*o,n)|0),s[o]=a(255*u(f*o,e)|0);return this.set(r,l,s)},exposure:function(t){null==t&&(t=1);var n=0,e=new i(256);for(n=0;256>n;n++)e[n]=a(255*(1-c(-t*n*f))|0);return this.set(e)},set:function(t,n,e,i){if(!t)return this;var a,l,u=this._table,c=u[r.R]||s();return n||e?(n=n||t,e=e||n,a=u[r.G]||c,l=u[r.B]||a,u[r.R]=o(t,c),u[r.G]=o(n,a),u[r.B]=o(e,l)):(u[r.R]=o(t,c),u[r.G]=u[r.R],u[r.B]=u[r.R]),this},reset:function(){return this._table=[null,null,null,null],this},combineWith:function(t){return this.set(t.getTable(r.R),t.getTable(r.G),t.getTable(r.B))},getTable:function(t){return this._table[t||r.R]||null},setTable:function(t,n){return this._table[n||r.R]=t||null,this},_apply:function(t,n,e){var i=this,a=i._table;if(!a||!a[r.R])return t;var l,s,o=t.length,u=o>>>2,c=(15&u)<<2,f=a[0],h=a[1],m=a[2],_=a[3];if(_){for(s=0;o>s;s+=64)l=s,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]],t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],t[l]=_[t[l++]];if(c){for(l=o-c;o>l;l+=4)t[l]=f[t[l]];t[l+1]=h[t[l+1]],t[l+2]=m[t[l+2]],t[l+3]=_[t[l+3]]}}else{for(s=0;o>s;s+=64)l=s,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l,t[l]=f[t[l++]],t[l]=h[t[l++]],t[l]=m[t[l++]],++l;if(c){for(l=o-c;o>l;l+=4)t[l]=f[t[l]];t[l+1]=h[t[l+1]],t[l+2]=m[t[l+2]]}}return t},canRun:function(){return this._isOn&&this._table&&this._table[r.R]}});m.prototype.posterize=m.prototype.levels=m.prototype.quantize,t.TableLookupFilter=t.ColorTableFilter}(n),!function(t,n){var r=t.CHANNEL,i=t.ColorMatrix,a=t.Array8U,l=t.Util.Filter,s=(l.cm_eye,l.cm_multiply),o=l.cm_combine,u=l.cm_rechannel,c=Math.sin,f=Math.cos,h=t.CONST.toRad,m=(t.CONST.toDeg,t.Util.Array.typed),_=t._notSupportClamp,p=t.Create({name:"ColorMatrixFilter",init:function(t){var n=this;n.matrix=t&&t.length?new i(t):null},path:e,matrix:null,dispose:function(){var t=this;return t.matrix=null,t.$super("dispose"),t},serialize:function(){var t=this;return{matrix:t.matrix}},unserialize:function(t){var n=this;return n.matrix=m(t.matrix,i),n},channel:function(t,n){t=t||0;var e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],i=r.A===t||n?1:0;return e[5*r.R+t]=r.R===t?1:i,e[5*r.G+t]=r.G===t?1:i,e[5*r.B+t]=r.B===t?1:i,this.set(e)},redChannel:function(t){return this.channel(r.R,t)},greenChannel:function(t){return this.channel(r.G,t)},blueChannel:function(t){return this.channel(r.B,t)},alphaChannel:function(t){return this.channel(r.A,!0)},maskChannel:function(t){if(t=t||0,r.A===t)return this;var n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return n[5*t+t]=0,this.set(n)},swapChannels:function(t,n){if(t===n)return this;var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return e[5*t+t]=0,e[5*n+n]=0,e[5*t+n]=1,e[5*n+t]=1,this.set(e)},invertChannel:function(t){if(t=t||0,r.A===t)return this;var n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return n[5*t+t]=-1,n[5*t+4]=255,this.set(n)},invertRed:function(){return this.invertChannel(r.R)},invertGreen:function(){return this.invertChannel(r.G)},invertBlue:function(){return this.invertChannel(r.B)},invertAlpha:function(){return this.invertChannel(r.A)},invert:function(){return this.set(u([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},desaturate:function(){var n=t.LUMA;return this.set(u([n[0],n[1],n[2],0,0,n[0],n[1],n[2],0,0,n[0],n[1],n[2],0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},grayscale:null,saturate:function(n){var e,i,a,l,s=t.LUMA;return e=1-n,i=e*s[0],a=e*s[1],l=e*s[2],this.set(u([i+n,a,l,0,0,i,a+n,l,0,0,i,a,l+n,0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},colorize:function(n,e){var i,a,l,s,o=t.LUMA;return null==e&&(e=1),i=(n>>16&255)/255,a=(n>>8&255)/255,l=(255&n)/255,s=1-e,this.set(u([s+e*i*o[0],e*i*o[1],e*i*o[2],0,0,e*a*o[0],s+e*a*o[1],e*a*o[2],0,0,e*l*o[0],e*l*o[1],s+e*l*o[2],0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},contrast:function(t,n,e){return null==n&&(n=t),null==e&&(e=t),t+=1,n+=1,e+=1,this.set(u([t,0,0,0,128*(1-t),0,n,0,0,128*(1-n),0,0,e,0,128*(1-e),0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},brightness:function(t,n,e){return null==n&&(n=t),null==e&&(e=t),this.set(u([1,0,0,0,t,0,1,0,0,n,0,0,1,0,e,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},adjustHue:function(n){n*=h;var e=f(n),i=c(n),a=t.LUMA;return this.set(u([a[0]+e*(1-a[0])+i*-a[0],a[1]+e*-a[1]+i*-a[1],a[2]+e*-a[2]+i*(1-a[2]),0,0,a[0]+e*-a[0]+.143*i,a[1]+e*(1-a[1])+.14*i,a[2]+e*-a[2]+i*-.283,0,0,a[0]+e*-a[0]+i*-(1-a[0]),a[1]+e*-a[1]+i*a[1],a[2]+e*(1-a[2])+i*a[2],0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},rotateHue:null,average:function(t,n,e){return null==t&&(t=.3333),null==n&&(n=.3333),null==e&&(e=.3333),this.set(u([t,n,e,0,0,t,n,e,0,0,t,n,e,0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},quickContrastCorrection:function(t){return null==t&&(t=1.2),this.set(u([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},sepia:function(t){return null==t&&(t=.5),t>1?t=1:0>t&&(t=0),this.set(u([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},sepia2:function(n){null==n&&(n=10),n>100&&(n=100),n*=2.55;var e=t.LUMA;return this.set(u([e[0],e[1],e[2],0,40,e[0],e[1],e[2],0,20,e[0],e[1],e[2],0,-n,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},threshold:function(n,e,i){null==e&&(e=256);var a=t.LUMA;return this.set(u(!1!==i?[a[0]*e,a[1]*e,a[2]*e,0,-(e-1)*n,a[0]*e,a[1]*e,a[2]*e,0,-(e-1)*n,a[0]*e,a[1]*e,a[2]*e,0,-(e-1)*n,0,0,0,1,0]:[e,0,0,0,-(e-1)*n,0,e,0,0,-(e-1)*n,0,0,e,0,-(e-1)*n,0,0,0,1,0],r.R,r.G,r.B,r.A,r.R,r.G,r.B,r.A))},thresholdRGB:function(t,n){return this.threshold(t,n,!1)},threshold_rgb:null,thresholdChannel:function(n,e,i,a){null==i&&(i=256);var l=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],s=t.LUMA;return r.A===n?(l[5*n+n]=i,l[5*n+4]=-i*e):!1!==a?(l[5*n+r.R]=s[0]*i,l[5*n+r.G]=s[1]*i,l[5*n+r.B]=s[2]*i,l[5*n+4]=-(i-1)*e):(l[5*n+r.R]=i,l[5*n+r.G]=i,l[5*n+r.B]=i,l[5*n+4]=-(i-1)*e),this.set(l)},thresholdRed:function(t,n,e){return this.thresholdChannel(r.R,t,n,e)},thresholdGreen:function(t,n,e){return this.thresholdChannel(r.G,t,n,e)},thresholdBlue:function(t,n,e){return this.thresholdChannel(r.B,t,n,e)},thresholdAlpha:function(t,n,e){return this.thresholdChannel(r.A,t,n,e)},threshold_alpha:null,RGB2YCbCr:function(){return this.set(u([.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,.5,-.418688,-.081312,0,128,0,0,0,1,0],r.R,r.G,r.B,r.A,r.Y,r.CB,r.CR,r.A))},YCbCr2RGB:function(){return this.set(u([1,0,1.402,0,-179.456,1,-.34414,-.71414,0,135.45984,1,1.772,0,0,-226.816,0,0,0,1,0],r.Y,r.CB,r.CR,r.A,r.R,r.G,r.B,r.A))},blend:function(t,n){var e=this;return e.matrix=e.matrix?o(e.matrix,t.matrix,1-n,n,i):new i(t.matrix),e},set:function(t){var n=this;return n.matrix=n.matrix?s(n.matrix,t):new i(t),n},reset:function(){return this.matrix=null,this},combineWith:function(t){return this.set(t.matrix)},_apply:_?function(t,n,e){var r=this,l=r.matrix;if(!l)return t;var s,o=t.length,u=o>>>2,c=(7&u)<<2,f=new i(32),h=new a(4),m=new i(4);for(s=0;o>s;s+=32)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],f[0]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[1]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[2]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[3]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+4],h[1]=t[s+5],h[2]=t[s+6],h[3]=t[s+7],f[4]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[5]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[6]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[7]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+8],h[1]=t[s+9],h[2]=t[s+10],h[3]=t[s+11],f[8]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[9]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[10]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[11]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+12],h[1]=t[s+13],h[2]=t[s+14],h[3]=t[s+15],f[12]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[13]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[14]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[15]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+16],h[1]=t[s+17],h[2]=t[s+18],h[3]=t[s+19],f[16]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[17]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[18]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[19]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+20],h[1]=t[s+21],h[2]=t[s+22],h[3]=t[s+23],f[20]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[21]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[22]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[23]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+24],h[1]=t[s+25],h[2]=t[s+26],h[3]=t[s+27],f[24]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[25]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[26]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[27]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+28],h[1]=t[s+29],h[2]=t[s+30],h[3]=t[s+31],f[28]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[29]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[30]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[31]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],f[0]=f[0]<0?0:f[0]>255?255:f[0],f[1]=f[1]<0?0:f[1]>255?255:f[1],f[2]=f[2]<0?0:f[2]>255?255:f[2],f[3]=f[3]<0?0:f[3]>255?255:f[3],f[4]=f[4]<0?0:f[4]>255?255:f[4],f[5]=f[5]<0?0:f[5]>255?255:f[5],f[6]=f[6]<0?0:f[6]>255?255:f[6],f[7]=f[7]<0?0:f[7]>255?255:f[7],f[8]=f[8]<0?0:f[8]>255?255:f[8],f[9]=f[9]<0?0:f[9]>255?255:f[9],f[10]=f[10]<0?0:f[10]>255?255:f[10],f[11]=f[11]<0?0:f[11]>255?255:f[11],f[12]=f[12]<0?0:f[12]>255?255:f[12],f[13]=f[13]<0?0:f[13]>255?255:f[13],f[14]=f[14]<0?0:f[14]>255?255:f[14],f[15]=f[15]<0?0:f[15]>255?255:f[15],f[16]=f[16]<0?0:f[16]>255?255:f[16],f[17]=f[17]<0?0:f[17]>255?255:f[17],f[18]=f[18]<0?0:f[18]>255?255:f[18],f[19]=f[19]<0?0:f[19]>255?255:f[19],f[20]=f[20]<0?0:f[20]>255?255:f[20],f[21]=f[21]<0?0:f[21]>255?255:f[21],f[22]=f[22]<0?0:f[22]>255?255:f[22],f[23]=f[23]<0?0:f[23]>255?255:f[23],f[24]=f[24]<0?0:f[24]>255?255:f[24],f[25]=f[25]<0?0:f[25]>255?255:f[25],f[26]=f[26]<0?0:f[26]>255?255:f[26],f[27]=f[27]<0?0:f[27]>255?255:f[27],f[28]=f[28]<0?0:f[28]>255?255:f[28],f[29]=f[29]<0?0:f[29]>255?255:f[29],f[30]=f[30]<0?0:f[30]>255?255:f[30],f[31]=f[31]<0?0:f[31]>255?255:f[31],t[s]=0|f[0],t[s+1]=0|f[1],t[s+2]=0|f[2],t[s+3]=0|f[3],t[s+4]=0|f[4],t[s+5]=0|f[5],t[s+6]=0|f[6],t[s+7]=0|f[7],t[s+8]=0|f[8],t[s+9]=0|f[9],t[s+10]=0|f[10],t[s+11]=0|f[11],t[s+12]=0|f[12],t[s+13]=0|f[13],t[s+14]=0|f[14],t[s+15]=0|f[15],t[s+16]=0|f[16],t[s+17]=0|f[17],t[s+18]=0|f[18],t[s+19]=0|f[19],t[s+20]=0|f[20],t[s+21]=0|f[21],t[s+22]=0|f[22],t[s+23]=0|f[23],t[s+24]=0|f[24],t[s+25]=0|f[25],t[s+26]=0|f[26],t[s+27]=0|f[27],t[s+28]=0|f[28],t[s+29]=0|f[29],t[s+30]=0|f[30],t[s+31]=0|f[31];if(c)for(s=o-c;o>s;s+=4)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],m[0]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],m[1]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],m[2]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],m[3]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],m[0]=m[0]<0?0:m[0]>255?255:m[0],m[1]=m[1]<0?0:m[1]>255?255:m[1],m[2]=m[2]<0?0:m[2]>255?255:m[2],m[3]=m[3]<0?0:m[3]>255?255:m[3],t[s]=0|m[0],t[s+1]=0|m[1],t[s+2]=0|m[2],t[s+3]=0|m[3];return t}:function(t,n,e){var r=this,l=r.matrix;if(!l)return t;var s,o=t.length,u=o>>>2,c=(7&u)<<2,f=new i(32),h=new a(4),m=new i(4);for(s=0;o>s;s+=32)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],f[0]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[1]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[2]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[3]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+4],h[1]=t[s+5],h[2]=t[s+6],h[3]=t[s+7],f[4]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[5]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[6]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[7]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+8],h[1]=t[s+9],h[2]=t[s+10],h[3]=t[s+11],f[8]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[9]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[10]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[11]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+12],h[1]=t[s+13],h[2]=t[s+14],h[3]=t[s+15],f[12]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[13]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[14]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[15]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+16],h[1]=t[s+17],h[2]=t[s+18],h[3]=t[s+19],f[16]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[17]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[18]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[19]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+20],h[1]=t[s+21],h[2]=t[s+22],h[3]=t[s+23],f[20]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[21]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[22]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[23]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+24],h[1]=t[s+25],h[2]=t[s+26],h[3]=t[s+27],f[24]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[25]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[26]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[27]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],h[0]=t[s+28],h[1]=t[s+29],h[2]=t[s+30],h[3]=t[s+31],f[28]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],f[29]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],f[30]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],f[31]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],t[s]=0|f[0],t[s+1]=0|f[1],t[s+2]=0|f[2],t[s+3]=0|f[3],t[s+4]=0|f[4],t[s+5]=0|f[5],t[s+6]=0|f[6],t[s+7]=0|f[7],t[s+8]=0|f[8],t[s+9]=0|f[9],t[s+10]=0|f[10],t[s+11]=0|f[11],t[s+12]=0|f[12],t[s+13]=0|f[13],t[s+14]=0|f[14],t[s+15]=0|f[15],t[s+16]=0|f[16],t[s+17]=0|f[17],t[s+18]=0|f[18],t[s+19]=0|f[19],t[s+20]=0|f[20],t[s+21]=0|f[21],t[s+22]=0|f[22],t[s+23]=0|f[23],t[s+24]=0|f[24],t[s+25]=0|f[25],t[s+26]=0|f[26],t[s+27]=0|f[27],t[s+28]=0|f[28],t[s+29]=0|f[29],t[s+30]=0|f[30],t[s+31]=0|f[31];if(c)for(s=o-c;o>s;s+=4)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],m[0]=l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]+l[4],m[1]=l[5]*h[0]+l[6]*h[1]+l[7]*h[2]+l[8]*h[3]+l[9],m[2]=l[10]*h[0]+l[11]*h[1]+l[12]*h[2]+l[13]*h[3]+l[14],m[3]=l[15]*h[0]+l[16]*h[1]+l[17]*h[2]+l[18]*h[3]+l[19],t[s]=0|m[0],t[s+1]=0|m[1],t[s+2]=0|m[2],t[s+3]=0|m[3];return t},canRun:function(){return this._isOn&&this.matrix}});p.prototype.grayscale=p.prototype.desaturate,p.prototype.rotateHue=p.prototype.adjustHue,p.prototype.threshold_rgb=p.prototype.thresholdRGB,p.prototype.threshold_alpha=p.prototype.thresholdAlpha}(n),!function(t,n){function r(n,e){var r=e?o(e):"",i=o(n),a=s?"c[0] = 0>c[0] ? 0 : (255<c[0] ? 255: c[0]); c[1] = 0>c[1] ? 0 : (255<c[1] ? 255: c[1]); c[2] = 0>c[2] ? 0 : (255<c[2] ? 255: c[2]); c[3] = 0>c[3] ? 0 : (255<c[3] ? 255: c[3]);":"";return new Function("FILTER",'"use strict"; return function( im, w, h ){    var self = this;    if ( !self._map ) return im;    var x, y, i, imLen = im.length, imArea = imLen>>>2, rem = (imArea&7)<<2, c = new FILTER.ColorMatrix(4);    '+r+";        for (x=0,y=0,i=0; i<imLen; i+=32)    {        c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+i+";        "+a+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+4]; c[1] = im[i+5]; c[2] = im[i+6]; c[3] = im[i+7];        "+i+";        "+a+";        im[i+4] = c[0]|0; im[i+5] = c[1]|0; im[i+6] = c[2]|0; im[i+7] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+8]; c[1] = im[i+9]; c[2] = im[i+10]; c[3] = im[i+11];        "+i+";        "+a+";        im[i+8] = c[0]|0; im[i+9] = c[1]|0; im[i+10] = c[2]|0; im[i+11] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+12]; c[1] = im[i+13]; c[2] = im[i+14]; c[3] = im[i+15];        "+i+";        "+a+";        im[i+12] = c[0]|0; im[i+13] = c[1]|0; im[i+14] = c[2]|0; im[i+15] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+16]; c[1] = im[i+17]; c[2] = im[i+18]; c[3] = im[i+19];        "+i+";        "+a+";        im[i+16] = c[0]|0; im[i+17] = c[1]|0; im[i+18] = c[2]|0; im[i+19] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+20]; c[1] = im[i+21]; c[2] = im[i+22]; c[3] = im[i+23];        "+i+";        "+a+";        im[i+20] = c[0]|0; im[i+21] = c[1]|0; im[i+22] = c[2]|0; im[i+23] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+24]; c[1] = im[i+25]; c[2] = im[i+26]; c[3] = im[i+27];        "+i+";        "+a+";        im[i+24] = c[0]|0; im[i+25] = c[1]|0; im[i+26] = c[2]|0; im[i+27] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+28]; c[1] = im[i+29]; c[2] = im[i+30]; c[3] = im[i+31];        "+i+";        "+a+";        im[i+28] = c[0]|0; im[i+29] = c[1]|0; im[i+30] = c[2]|0; im[i+31] = c[3]|0;                if (++x>=w) {x=0; y++;}    }    if ( rem )    {        for (i=imLen-rem; i<imLen; i+=4,x++)        {            if (x>=w) {x=0; y++;}            c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];            "+i+";            "+a+";            im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;        }    }    return im;};")(t)}var i,a=(t.CHANNEL,t.MODE),l=(t.Color,t.ColorMatrix,t.Util.Array.typed),s=t._notSupportClamp,o=t.Util.String.function_body,u=t.Create({name:"ColorMapFilter",init:function(t,n){var e=this;t&&e.set(t,n)},path:e,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,thresholds:null,quantizedColors:null,mode:a.COLOR,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.thresholds=null,t.quantizedColors=null,t.$super("dispose"),t},serialize:function(){var t,n=this;return t={_mapName:n._mapName||null,_map:"generic"===n._mapName&&n._map&&n._mapChanged?n._map.toString():null,_mapInit:"generic"===n._mapName&&n._mapInit&&n._mapChanged?n._mapInit.toString():null,thresholds:n.thresholds,quantizedColors:n.quantizedColors,mode:n.mode},n._mapChanged=!1,t},unserialize:function(t){var n=this;return n.mode=t.mode,n.thresholds=l(t.thresholds,Array),n.quantizedColors=l(t.quantizedColors,Array),!t._map&&t._mapName&&i.hasOwnProperty(t._mapName)?n.set(t._mapName):t._map&&"generic"===t._mapName&&n.set(t._map,t._mapInit||null),n},RGB2HSV:function(){return this.set("rgb2hsv")},HSV2RGB:function(){return this.set("hsv2rgb")},RGB2CMYK:function(){return this.set("rgb2cmyk")},hue:function(){return this.set("hue")},saturation:function(){return this.set("saturation")},quantize:function(t,n){var e=this;return e.thresholds=t,e.quantizedColors=n,e.set("quantize")},threshold:null,mask:function(t,n,e){var r=this;return r.thresholds=[t,n],r.quantizedColors=[e||0],r.set("mask")},extract:null,set:function(t,n){var e=this;return t&&i.hasOwnProperty(String(t))?(e._mapName!==String(t)&&(e._mapName=String(t),e._map=i[e._mapName],e._mapInit=i["init__"+e._mapName],e._apply=r(e._map,e._mapInit)),e._mapChanged=!1):t&&(e._mapName="generic",e._map=T,e._mapInit=n||null,e._apply=r(e._map,e._mapInit),e._mapChanged=!0),e},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,
t._mapChanged=!1,t},canRun:function(){return this._isOn&&this._map}});u.prototype.threshold=u.prototype.quantize,u.prototype.extract=u.prototype.mask,i={rgb2hsv:"function( ){        if ( 0 !== c[3] )        {            RGB2HSV(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CV] = C2;        }    }",init__rgb2hsv:"function( ){        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, RGB2HSV = FILTER.Color.RGB2HSV;    }",hsv2rgb:"function( ){        if ( 0 !== c[3] )        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CV];            c[0] = C0; c[1] = C1; c[2] = C2;            HSV2RGB(c, 0);        }    }",init__hsv2rgb:"function( ){        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, HSV2RGB = FILTER.Color.HSV2RGB;    }",rgb2cmyk:"function( ){        if ( 0 !== c[3] )        {            RGB2CMYK(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CY] = C0; c[MA] = C1; c[YE] = C2;        }    }",init__rgb2cmyk:"function( ){        var C0, C1, C2, CY = FILTER.CHANNEL.CY, MA = FILTER.CHANNEL.MA, YE = FILTER.CHANNEL.YE, RGB2CMYK = FILTER.Color.RGB2CMYK;    }",hue:"function( ){        if ( 0 !== c[3] )        {            HHH = HUE(c[0], c[1], c[2])*0.70833333333333333333333333333333;            c[0] = HHH; c[1] = HHH; c[2] = HHH;        }    }",init__hue:"function( ){        var HUE = FILTER.Color.hue, HHH;    }",saturation:"function( ){        if ( 0 !== c[3] )        {            SSS = SATURATION(c[0], c[1], c[2]);            c[0] = SSS; c[1] = SSS; c[2] = SSS;        }    }",init__saturation:"function( ){        var SATURATION = FILTER.Color.saturation, SSS;    }",quantize:"function( ){        if ( 0 !== c[3] )        {            J = 0; V = VALUE(c[0], c[1], c[2]);            while (J<THRESH_LEN && V>THRESH[J]) J++;            COLVAL = J < COLORS_LEN ? COLORS[j] : 0xffffff;            c[0] = (COLVAL >>> 16) & 255; c[1] = (COLVAL >>> 8) & 255; c[2] = COLVAL & 255;        }    }",init__quantize:"function( ){        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            THRESH = self.thresholds, THRESH_LEN = THRESH.length,            COLORS = self.quantizedColors, COLORS_LEN = COLORS.length, J, COLVAL, V;    }",mask:"function( ){        if ( 0 !== c[3] )        {            V = VALUE(c[0], c[1], c[2]);            if ( (V < MIN_VALUE) || (V > MAX_VALUE) )            {                c[0] = COLVAL[0];                c[1] = COLVAL[1];                c[2] = COLVAL[2];                c[3] = COLVAL[3];            }        }    }",init__mask:"function( ){        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            MIN_VALUE = self.thresholds[0], MAX_VALUE = self.thresholds[self.thresholds.length-1],            COLVAL = [(self.quantizedColors[0] >>> 16) & 255, (self.quantizedColors[0] >>> 8) & 255, self.quantizedColors[0] & 255, (self.quantizedColors[0] >>> 24) & 255], V;    }"}}(n),!function(t,n){var r=t.ImArray,i=t.AffineMatrix,a=t.Util.Array.typed,l=t.Util.Filter,s=(l.am_eye,l.am_multiply),o=t.MODE,u=(t.CONST.toRad,Math.sin),c=Math.cos,f=Math.tan,h=t.Create({name:"AffineMatrixFilter",init:function(t){var n=this;n.matrix=t&&t.length?new i(t):null},path:e,matrix:null,mode:o.CLAMP,color:0,dispose:function(){var t=this;return t.matrix=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{matrix:t.matrix,mode:t.mode,color:t.color}},unserialize:function(t){var n=this;return n.matrix=a(t.matrix,i),n.mode=t.mode,n.color=t.color,n},flipX:function(){return this.set([-1,0,0,1,0,1,0,0])},flipY:function(){return this.set([1,0,0,0,0,-1,0,1])},flipXY:function(){return this.set([-1,0,0,1,0,-1,0,1])},translate:function(t,n,e){return this.set(e?[1,0,0,t,0,1,0,n]:[1,0,t,0,0,1,n,0])},shift:null,rotate:function(t){var n=u(t),e=c(t);return this.set([e,-n,0,0,n,e,0,0])},scale:function(t,n){return this.set([t,0,0,0,0,n,0,0])},skew:function(t,n){return this.set([1,t?f(t):0,0,0,n?f(n):0,1,0,0])},set:function(t){var n=this;return n.matrix=n.matrix?s(n.matrix,t):new i(t),n},reset:function(){return this.matrix=null,this},combineWith:function(t){return this.set(t.matrix)},_apply:function(t,n,e){var i=this,a=i.matrix;if(!a)return t;var l,s,u,c,f,h,m,_,p,d,g,v=t.length,C=v>>>2,y=n-1,x=C-n,R=new r(v),I=i.color||0,A=o.COLOR,w=o.CLAMP,b=o.WRAP,L=o.IGNORE,E=a[0],T=a[1],M=a[2]+a[3]*y,G=a[4]*n,S=a[5],F=a[6]*n+a[7]*x,N=i.mode||w;if(A===N)for(g=I>>>24&255,_=I>>>16&255,p=I>>>8&255,d=255&I,l=0,s=0,u=0,h=0;v>h;h+=4,l++)l>=n&&(l=0,s++,u+=n),c=E*l+T*s+M,f=G*l+S*u+F,0>c||c>y||0>f||f>x?(R[h]=_,R[h+1]=p,R[h+2]=d,R[h+3]=g):(m=(0|c)+(0|f)<<2,R[h]=t[m],R[h+1]=t[m+1],R[h+2]=t[m+2],R[h+3]=t[m+3]);else if(L===N)for(l=0,s=0,u=0,h=0;v>h;h+=4,l++)l>=n&&(l=0,s++,u+=n),c=E*l+T*s+M,f=G*l+S*u+F,f=f>x||0>f?u:f,c=c>y||0>c?l:c,m=(0|c)+(0|f)<<2,R[h]=t[m],R[h+1]=t[m+1],R[h+2]=t[m+2],R[h+3]=t[m+3];else if(b===N)for(l=0,s=0,u=0,h=0;v>h;h+=4,l++)l>=n&&(l=0,s++,u+=n),c=E*l+T*s+M,f=G*l+S*u+F,f=f>x?f-C:0>f?f+C:f,c=c>y?c-n:0>c?c+n:c,m=(0|c)+(0|f)<<2,R[h]=t[m],R[h+1]=t[m+1],R[h+2]=t[m+2],R[h+3]=t[m+3];else for(l=0,s=0,u=0,h=0;v>h;h+=4,l++)l>=n&&(l=0,s++,u+=n),c=E*l+T*s+M,f=G*l+S*u+F,f=f>x?x:0>f?0:f,c=c>y?y:0>c?0:c,m=(0|c)+(0|f)<<2,R[h]=t[m],R[h+1]=t[m+1],R[h+2]=t[m+2],R[h+3]=t[m+3];return R},canRun:function(){return this._isOn&&this.matrix}});h.prototype.shift=h.prototype.translate}(n),!function(t,n){var r=(t.ImArray,t.ImArrayCopy),i=(t.Util.Array.typed,t.MODE),a=t.Array16I,l=Math.min,s=(Math.max,Math.floor);t.Create({name:"DisplacementMapFilter",init:function(t){var n=this;t&&n.setInput("map",t)},path:e,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:i.CLAMP,hasInputs:!0,dispose:function(){var t=this;return t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color,mode:t.mode}},unserialize:function(t){var n=this;return n.scaleX=t.scaleX,n.scaleY=t.scaleY,n.startX=t.startX,n.startY=t.startY,n.componentX=t.componentX,n.componentY=t.componentY,n.color=t.color,n.mode=t.mode,n},reset:function(){return this.unsetInput("map"),this},_apply:function(t,n,e){var o,u=this;if(o=u.input("map"),!o)return t;var c,f,h,m,_,p,d,g,v,C,y,x,R,I,A,w,b,L,E,T,M,G,S,F,N,Y,H,O,B,X,z,D,U,V,q,k,P=u.color||0,j=n-1,W=e-1,$=.00390625*u.scaleX,J=.00390625*u.scaleY,K=u.componentX,Q=u.componentY,Z=i.IGNORE,tt=i.CLAMP,nt=i.COLOR,et=i.WRAP,rt=u.mode||tt;for(c=o[0],f=o[1],h=o[2],U=c.length,m=U>>>2,p=l(f,n),d=l(h,e),D=t.length,X=p*d<<2,z=D>>>2,R=s(u.startX*j),x=s(u.startY*W),I=x*n,A=-R,w=-x,b=j-R,L=W-x,_=new a(m<<1),V=new r(t),E=(15&m)<<2,M=0,T=0;U>T;T+=64)_[M++]=s((c[T+K]-128)*$),_[M++]=s((c[T+Q]-128)*J),_[M++]=s((c[T+4+K]-128)*$),_[M++]=s((c[T+4+Q]-128)*J),_[M++]=s((c[T+8+K]-128)*$),_[M++]=s((c[T+8+Q]-128)*J),_[M++]=s((c[T+12+K]-128)*$),_[M++]=s((c[T+12+Q]-128)*J),_[M++]=s((c[T+16+K]-128)*$),_[M++]=s((c[T+16+Q]-128)*J),_[M++]=s((c[T+20+K]-128)*$),_[M++]=s((c[T+20+Q]-128)*J),_[M++]=s((c[T+24+K]-128)*$),_[M++]=s((c[T+24+Q]-128)*J),_[M++]=s((c[T+28+K]-128)*$),_[M++]=s((c[T+28+Q]-128)*J),_[M++]=s((c[T+32+K]-128)*$),_[M++]=s((c[T+32+Q]-128)*J),_[M++]=s((c[T+36+K]-128)*$),_[M++]=s((c[T+36+Q]-128)*J),_[M++]=s((c[T+40+K]-128)*$),_[M++]=s((c[T+40+Q]-128)*J),_[M++]=s((c[T+44+K]-128)*$),_[M++]=s((c[T+44+Q]-128)*J),_[M++]=s((c[T+48+K]-128)*$),_[M++]=s((c[T+48+Q]-128)*J),_[M++]=s((c[T+52+K]-128)*$),_[M++]=s((c[T+52+Q]-128)*J),_[M++]=s((c[T+56+K]-128)*$),_[M++]=s((c[T+56+Q]-128)*J),_[M++]=s((c[T+60+K]-128)*$),_[M++]=s((c[T+60+Q]-128)*J);if(E)for(T=U-E;U>T;T+=4)_[M++]=s((c[T+K]-128)*$),_[M++]=s((c[T+Q]-128)*J);if(nt===rt)for(g=P>>>24&255,v=P>>>16&255,C=P>>>8&255,y=255&P,G=0,S=0,F=0,N=0,T=0;X>T;T+=4,G++)G>=p&&(G=0,S++,F+=n,N+=f),w>S||S>L||A>G||G>b||(H=G+R,Y=S+x,O=H+F+I<<2,M=G+N<<1,q=H+_[M],k=Y+_[M+1],k>W||0>k||q>j||0>q?(t[O]=v,t[O+1]=C,t[O+2]=y,t[O+3]=g):(B=q+k*n<<2,t[O]=V[B],t[O+1]=V[B+1],t[O+2]=V[B+2],t[O+3]=V[B+3]));else if(Z===rt)for(G=0,S=0,F=0,N=0,T=0;X>T;T+=4,G++)G>=p&&(G=0,S++,F+=n,N+=f),w>S||S>L||A>G||G>b||(H=G+R,Y=S+x,O=H+F+I<<2,M=G+N<<1,q=H+_[M],k=Y+_[M+1],k>W||0>k||q>j||0>q||(B=q+k*n<<2,t[O]=V[B],t[O+1]=V[B+1],t[O+2]=V[B+2],t[O+3]=V[B+3]));else if(et===rt)for(G=0,S=0,F=0,N=0,T=0;X>T;T+=4,G++)G>=p&&(G=0,S++,F+=n,N+=f),w>S||S>L||A>G||G>b||(H=G+R,Y=S+x,O=H+F+I<<2,M=G+N<<1,q=H+_[M],k=Y+_[M+1],k=k>W?k-e:0>k?k+e:k,q=q>j?q-n:0>q?q+n:q,B=q+k*n<<2,t[O]=V[B],t[O+1]=V[B+1],t[O+2]=V[B+2],t[O+3]=V[B+3]);else for(G=0,S=0,F=0,N=0,T=0;X>T;T+=4,G++)G>=p&&(G=0,S++,F+=n,N+=f),w>S||S>L||A>G||G>b||(H=G+R,Y=S+x,O=H+F+I<<2,M=G+N<<1,q=H+_[M],k=Y+_[M+1],k=k>W?W:0>k?0:k,q=q>j?j:0>q?0:q,B=q+k*n<<2,t[O]=V[B],t[O+1]=V[B+1],t[O+2]=V[B+2],t[O+3]=V[B+3]);return t}})}(n),!function(t,n){function r(n,e){var r=e?l(e):"",i=l(n);return new Function("FILTER",'"use strict"; return function( im, w, h ){    var self = this;    if ( !self._map ) return im;    var x, y, i, j, imLen = im.length, dst = new FILTER.ImArray(imLen), t = new FILTER.Array32F(2),        COLOR = FILTER.MODE.COLOR, CLAMP = FILTER.MODE.CLAMP, WRAP = FILTER.MODE.WRAP, IGNORE = FILTER.MODE.IGNORE,        mode = self.mode||CLAMP, color = self.color||0, r, g, b, a, bx = w-1, by = h-1;    '+r+";        if ( COLOR === mode )    {        a = (color >>> 24)&255;        r = (color >>> 16)&255;        g = (color >>> 8)&255;        b = (color)&255;            for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+i+";                        if ( 0>t[0] || t[0]>bx || 0>t[1] || t[1]>by )            {                /* color */                dst[i] = r;   dst[i+1] = g;                dst[i+2] = b;  dst[i+3] = a;                continue;            }                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if ( IGNORE === mode )    {        for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+i+";                        /* ignore */            t[1] = t[1] > by || t[1] < 0 ? y : t[1];            t[0] = t[0] > bx || t[0] < 0 ? x : t[0];                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if ( WRAP === mode )    {        for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+i+";                        /* wrap */            t[1] = t[1] > by ? t[1]-h : (t[1] < 0 ? t[1]+h : t[1]);            t[0] = t[0] > bx ? t[0]-w : (t[0] < 0 ? t[0]+w : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else /*if ( CLAMP === mode )*/    {        for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+i+";                        /* clamp */            t[1] = t[1] > by ? by : (t[1] < 0 ? 0 : t[1]);            t[0] = t[0] > bx ? bx : (t[0] < 0 ? 0 : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    return dst;};")(t)}var i,a=t.MODE,l=t.Util.String.function_body;t.Create({name:"GeometricMapFilter",init:function(t,n){var e=this;t&&e.set(t,n)},path:e,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,color:0,centerX:0,centerY:0,angle:0,radius:0,mode:a.CLAMP,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.color=0,t.centerX=null,t.centerY=null,t.angle=null,t.radius=null,t.$super("dispose"),t},serialize:function(){var t,n=this;return t={_mapName:n._mapName||null,_map:"generic"===n._mapName&&n._map&&n._mapChanged?n._map.toString():null,_mapInit:"generic"===n._mapName&&n._mapInit&&n._mapChanged?n._mapInit.toString():null,color:n.color,centerX:n.centerX,centerY:n.centerY,angle:n.angle,radius:n.radius,mode:n.mode},n._mapChanged=!1,t},unserialize:function(t){var n=this;return n.color=t.color,n.centerX=t.centerX,n.centerY=t.centerY,n.angle=t.angle,n.radius=t.radius,n.mode=t.mode,!t._map&&t._mapName&&i.hasOwnProperty(t._mapName)?n.set(t._mapName):t._map&&"generic"===t._mapName&&n.set(t._map,t._mapInit||null),n},polar:function(t,n){return this},cartesian:function(t,n){return this},twirl:function(t,n,e,r){var i=this;return i.angle=t||0,i.radius=n||0,i.centerX=e||0,i.centerY=r||0,i.set("twirl")},sphere:function(t,n,e){var r=this;return r.radius=t||0,r.centerX=n||0,r.centerY=e||0,r.set("sphere")},set:function(t,n){var e=this;return t&&i.hasOwnProperty(String(t))?(e._mapName!==String(t)&&(e._mapName=String(t),e._map=i[e._mapName],e._mapInit=i["init__"+e._mapName],e._apply=r(e._map,e._mapInit)),e._mapChanged=!1):t&&(e._mapName="generic",e._map=t,e._mapInit=n||null,e._apply=r(e._map,e._mapInit),e._mapChanged=!0),e},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t},canRun:function(){return this._isOn&&this._map}}),i={twirl:"function( ){        TX = t[0]-CX; TY = t[1]-CY;        D = Sqrt(TX*TX + TY*TY);        if ( D < R )        {            theta = Atan2(TY, TX) + fact*(R-D);            t[0] = CX + D*Cos(theta);  t[1] = CY + D*Sin(theta);        }    }",init__twirl:"function( ){        var Sqrt = Math.sqrt, Atan2 = Math.atan2, Sin = Math.sin, Cos = Math.cos,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            angle = self.angle, R = self.radius, fact = angle/R,            D, TX, TY, theta;    }",sphere:"function( ){        TX = t[0]-CX;  TY = t[1]-CY;        TX2 = TX*TX; TY2 = TY*TY;        D2 = TX2 + TY2;        if ( D2 < R2 )        {            D2 = R2 - D2; D = Sqrt(D2);            thetax = Asin(TX / Sqrt(TX2 + D2)) * invrefraction;            thetay = Asin(TY / Sqrt(TY2 + D2)) * invrefraction;            t[0] = t[0] - D * Tan(thetax);  t[1] = t[1] - D * Tan(thetay);        }    }",init__sphere:"function( ){        var Sqrt = Math.sqrt, Asin = Math.asin, Tan = Math.tan,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            invrefraction = 1-0.555556,            R = self.radius, R2 = R*R,            D, TX, TY, TX2, TY2, R2, D2, thetax, thetay;    }"}}(n),!function(t,n){function r(t){for(var n=0,e=0,r=t.length;r>e;e++)n+=t[e];return n}function i(t,n){var e,r,i,a=[],l=[],s=[],o=t.length,u=n,c=u>>>1;for(r=0,i=0,e=0;o>e;)l.push(r-c),l.push(i-c),t[e]&&(a.push(r-c),a.push(i-c),s.push(t[e])),e++,r++,r>=u&&(r=0,i++);return[new v(a),new v(l),new d(s)]}function a(t,n){var e,r,i,a=new Array(t);for(e=0,r=0,i=0;t>i;i++,e++)a[i]=n(e,r,t);return a}function l(t){var n,e=new Array(t);for(n=0;t>n;n++)e[n]=1;return e}function s(t,n){var e,r=t>>>1,i=new Array(t);if(n)for(e=0;t>e;e++)i[t-1-e]=e-r;else for(e=0;t>e;e++)i[e]=e-r;return i}function o(t){var n,e,r,i,a=M.length;if(t--,a>t)n=M[t];else for(n=M[a-1];t>=a;){for(e=n,n=new Array(e.length+1),n[0]=1,r=0,i=e.length-1;i>r;r++)n[r+1]=e[r]+e[r+1];n[e.length]=1,20>a&&M.push(n),a++}return n.slice()}function u(t){var n=o(t);return R(n,n)}function c(t,n){return 1===n?R(s(t,1),o(t)):R(o(t),s(t,0))}function f(t,n){return 1===n?R(s(t,1),l(t)):R(l(t),s(t,0))}function h(t,n,e){n=n||1,e=e||n;var r,i=t*t,a=new d(i);for(r=0;t>r;r++)a[r]=n;return a[i>>>1]=e,a}function m(t,n,e,r){var i,a,l,s,o,u=t*t,c=t>>>1,f=u>>>1,h=new d(u);for(s=0,i=0;c>=i;i++,s+=n)for(a=0,o=0,l=0;c>=l;l++,a+=t,o+=e)h[f+i+a]=s+o,h[f-i-a]=-s-o,h[f-i+a]=-s+o,h[f+i-a]=s-o;return h[f]=r||1,h}function _(t,n,e,r){var i,a,l,s,o,u,c=t*t,f=t>>1,h=c>>1,m=new d(c),_=new d(c),p=1/t,g=1e-8;for(b(n)>g?(o=1,u=e/n):(o=n/e,u=1),i=0,l=0,s=0,a=u*t;f>=i;)_[h+i]=h+l+s+.5|0,_[h-i]=h-l-s+.5|0,i++,l+=o,s+=a;for(i=0;f>=i;)m[_[h+i]]=m[_[h-i]]=p,i++;return m[h]=r||1,m}var p=t.Util.Filter,d=t.ConvolutionMatrix,g=t.ImArray,v=(t.Array32F,t.Array16I),C=(t.Array8U,p.integral_convolution),y=p.separable_convolution,x=p.cm_combine,R=p.cm_convolve,I=t.Util.Array.typed,A=t._notSupportClamp,w=(Math.SQRT2,t.CONST.toRad),b=(t.CONST.toDeg,Math.abs),L=Math.sqrt,E=Math.sin,T=Math.cos,M=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],G=t.Create({name:"ConvolutionMatrixFilter",init:function(t,n,e,r){var i=this;i._coeff=new d([1,0]),i.matrix2=null,i.dim2=0,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,i._rgba=!!r,t&&t.length?i.set(t,L(t.length)+.5|0,n||1,e||0):(i.matrix=null,i.dim=0)},path:e,dim:0,dim2:0,matrix:null,matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_rgba:!1,dispose:function(){var t=this;return t.dim=null,t.dim2=null,t.matrix=null,t.matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t._rgba=null,t.$super("dispose"),t},serialize:function(){var t=this;return{dim:t.dim,dim2:t.dim2,matrix:t.matrix,matrix2:t.matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2,_rgba:t._rgba}},unserialize:function(t){var n=this;return n.dim=t.dim,n.dim2=t.dim2,n.matrix=I(t.matrix,d),n.matrix2=I(t.matrix2,d),n._mat=I(t._mat,d),n._mat2=I(t._mat2,d),n._coeff=I(t._coeff,d),n._isGrad=t._isGrad,n._doIntegral=t._doIntegral,n._doSeparable=t._doSeparable,n._indices=I(t._indices,v),n._indices2=I(t._indices2,v),n._indicesf=I(t._indicesf,v),n._indicesf2=I(t._indicesf2,v),n._rgba=t._rgba,n},rgba:function(t){var n=this;return arguments.length?(n._rgba=!!t,n):n._rgba},functional:function(t,e){e=e===n?3:1&e?e:e+1;var i=a(e,t),l=1/r(i);return this.set(i,e,l,l,e,i),this._doSeparable=!0,this},fastGauss:function(t,e){return e=e===n?3:1&e?e:e+1,t=0|(t||1),1>t?t=1:t>3&&(t=3),this.set(h(e),e,1/(e*e),0),this._doIntegral=t,this},lowPass:function(t){return t=t===n?3:1&t?t:t+1,this.set(h(t),t,1/(t*t),0),this._doIntegral=1,this},boxBlur:null,highPass:function(t,e){t=t===n?3:1&t?t:t+1,e=e===n?1:e;var r=-e/(t*t);return this.set(h(t,r,1+r),t,1,0),this._doIntegral=1,this},glow:function(t,e){return t=t===n?.5:t,this.highPass(e,-t)},sharpen:function(t,e){return t=t===n?.5:t,this.highPass(e,t)},verticalBlur:function(t){return t=t===n?3:1&t?t:t+1,this.set(l(t),1,1/t,0,t),this._doIntegral=1,this},horizontalBlur:function(t){return t=t===n?3:1&t?t:t+1,this.set(l(t),t,1/t,0,1),this._doIntegral=1,this},directionalBlur:function(t,e){return e=e===n?3:1&e?e:e+1,t*=w,this.set(_(e,T(t),-E(t),1/e),e,1,0)},binomialLowPass:function(t){t=t===n?3:1&t?t:t+1;var e=o(t),r=1/(1<<t-1);return this.set(e,t,r,r,t,e),this._doSeparable=!0,this},gaussBlur:null,binomialHighPass:function(t){t=t===n?3:1&t?t:t+1;var e=u(t);return this.set(x(h(t),e,1,-1/r(e)),t,1,0)},prewittX:function(t){return t=t===n?3:1&t?t:t+1,this.set(l(t),t,1,0,t,s(t,0)),this._doSeparable=!0,this},gradX:null,prewittY:function(t){return t=t===n?3:1&t?t:t+1,this.set(s(t,1),t,1,0,t,l(t)),this._doSeparable=!0,this},gradY:null,prewittDirectional:function(t,e){return e=e===n?3:1&e?e:e+1,t*=w,this.set(x(f(e,0),f(e,1),T(t),E(t)),e,1,0)},gradDirectional:null,prewitt:function(t){return t=t===n?3:1&t?t:t+1,this.set(f(t,0),t,1,0,t,f(t,1)),this._isGrad=!0,this},grad:null,sobelX:function(t){return t=t===n?3:1&t?t:t+1,this.set(o(t),t,1,0,t,s(t,0)),this._doSeparable=!0,this},sobelY:function(t){return t=t===n?3:1&t?t:t+1,this.set(s(t,1),t,1,0,t,o(t)),this._doSeparable=!0,this},sobelDirectional:function(t,e){return e=e===n?3:1&e?e:e+1,t*=w,this.set(x(c(e,0),c(e,1),T(t),E(t)),e,1,0)},sobel:function(t){return t=t===n?3:1&t?t:t+1,this.set(c(t,0),t,1,0,t,c(t,1)),this._isGrad=!0,this},laplace:function(t){return t=t===n?3:1&t?t:t+1,this.set(h(t,-1,t*t-1),t,1,0),this._doIntegral=1,this},emboss:function(t,e,r){return r=r===n?3:1&r?r:r+1,t=t===n?-.25*Math.PI:t*w,e=e||1,this.set(m(r,e*T(t),-e*E(t),1),r,1,0)},bump:null,edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,n,e,r,a,l){var s,o=this;return o._isGrad=!1,o._doIntegral=0,o._doSeparable=!1,o.matrix2=null,o.dim2=0,o._indices2=o._indicesf2=null,o._mat2=null,o.matrix=new d(t),o.dim=n,o._coeff[0]=e||1,o._coeff[1]=r||0,s=i(o.matrix,o.dim),o._indices=s[0],o._indicesf=s[1],o._mat=s[2],l?(o.matrix2=new d(l),o.dim2=a,s=i(o.matrix2,o.dim2),o._indices2=s[0],o._indicesf2=s[1],o._mat2=s[2]):a&&(o.dim2=a),o},reset:function(){var t=this;return t.matrix=t.matrix2=null,t.dim=t.dim2=0,t._mat=t._mat2=null,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t},combineWith:function(t){var n=this;return t.matrix?n.matrix?n.set(R(n.matrix,t.matrix),n.dim*t.dim,n._coeff[0]*t._coeff[0]):n.set(t.matrix,t.dim,t._coeff[0],t._coeff[1]):n},_apply:A?function(t,n,e){var r=this,i=r._rgba;if(!r.matrix)return t;if(r._doIntegral)return r.matrix2?C(i,t,n,e,r.matrix,r.matrix2,r.dim,r.dim2,r._coeff[0],r._coeff[1],r._doIntegral):C(i,t,n,e,r.matrix,null,r.dim,r.dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return y(i,t,n,e,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,l,s,o,u,c,f,h,m,_,p,d,x,R,I,A,w,L,E,T,M,G,S,F,N=t.length,Y=N>>>2,H=new g(N),O=n-1,B=Y-n,X=r._coeff[0],z=r._coeff[1],D=r.matrix,U=r.matrix2,V=r._isGrad;if(U){for(G=r._indicesf.length,F=new v(r._indicesf),c=0;G>c;c+=2)F[c+1]*=n;for(S=D.length,f=0,h=0,o=0;N>o;o+=4,f++){for(f>=n&&(f=0,h+=n),d=x=R=I=A=w=L=E=0,c=0,u=0;S>c;c++,u+=2)m=f+F[u],_=h+F[u+1],0>m||m>O||0>_||_>B||(p=m+_<<2,T=D[c],d+=t[p]*T,x+=t[p+1]*T,R+=t[p+2]*T,M=U[c],A+=t[p]*M,w+=t[p+1]*M,L+=t[p+2]*M);V?(a=b(d)+b(A)|0,l=b(x)+b(w)|0,s=b(R)+b(L)|0):(a=X*d+z*A|0,l=X*x+z*w|0,s=X*R+z*L|0),a=0>a?0:a>255?255:a,l=0>l?0:l>255?255:l,s=0>s?0:s>255?255:s,H[o]=a,H[o+1]=l,H[o+2]=s,H[o+3]=t[o+3]}}else{for(G=r._indices.length,F=new v(r._indices),c=0;G>c;c+=2)F[c+1]*=n;for(D=r._mat,S=D.length,f=0,h=0,o=0;N>o;o+=4,f++){for(f>=n&&(f=0,h+=n),d=x=R=I=0,c=0,u=0;S>c;c++,u+=2)m=f+F[u],_=h+F[u+1],0>m||m>O||0>_||_>B||(p=m+_<<2,T=D[c],d+=t[p]*T,x+=t[p+1]*T,R+=t[p+2]*T);a=X*d+z|0,l=X*x+z|0,s=X*R+z|0,a=0>a?0:a>255?255:a,l=0>l?0:l>255?255:l,s=0>s?0:s>255?255:s,H[o]=a,H[o+1]=l,H[o+2]=s,H[o+3]=t[o+3]}}return H}:function(t,n,e){var r=this,i=r._rgba;if(!r.matrix)return t;if(r._doIntegral)return r.matrix2?C(i,t,n,e,r.matrix,r.matrix2,r.dim,r.dim2,r._coeff[0],r._coeff[1],r._doIntegral):C(i,t,n,e,r.matrix,null,r.dim,r.dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return y(i,t,n,e,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,l,s,o,u,c,f,h,m,_,p,d,x,R,I,A,w,L,E,T,M,G,S,F,N=t.length,Y=N>>>2,H=new g(N),O=n-1,B=Y-n,X=r._coeff[0],z=r._coeff[1],D=r.matrix,U=r.matrix2,V=r._isGrad;if(U){for(G=r._indicesf.length,F=new v(r._indicesf),c=0;G>c;c+=2)F[c+1]*=n;for(S=D.length,f=0,h=0,o=0;N>o;o+=4,f++){for(f>=n&&(f=0,h+=n),d=x=R=I=A=w=L=E=0,c=0,u=0;S>c;c++,u+=2)m=f+F[u],_=h+F[u+1],0>m||m>O||0>_||_>B||(p=m+_<<2,T=D[c],d+=t[p]*T,x+=t[p+1]*T,R+=t[p+2]*T,M=U[c],A+=t[p]*M,w+=t[p+1]*M,L+=t[p+2]*M);V?(a=b(d)+b(A)|0,l=b(x)+b(w)|0,s=b(R)+b(L)|0):(a=X*d+z*A|0,l=X*x+z*w|0,s=X*R+z*L|0),H[o]=a,H[o+1]=l,H[o+2]=s,H[o+3]=t[o+3]}}else{for(G=r._indices.length,F=new v(r._indices),c=0;G>c;c+=2)F[c+1]*=n;for(D=r._mat,S=D.length,f=0,h=0,o=0;N>o;o+=4,f++){for(f>=n&&(f=0,h+=n),d=x=R=I=0,c=0,u=0;S>c;c++,u+=2)m=f+F[u],_=h+F[u+1],0>m||m>O||0>_||_>B||(p=m+_<<2,T=D[c],d+=t[p]*T,x+=t[p+1]*T,R+=t[p+2]*T);a=X*d+z|0,l=X*x+z|0,s=X*R+z|0,H[o]=a,H[o+1]=l,H[o+2]=s,H[o+3]=t[o+3]}}return H},canRun:function(){return this._isOn&&this.matrix}});G.prototype.gradX=G.prototype.prewittX,G.prototype.gradY=G.prototype.prewittY,G.prototype.gradDirectional=G.prototype.prewittDirectional,G.prototype.grad=G.prototype.prewitt,G.prototype.bump=G.prototype.emboss,G.prototype.boxBlur=G.prototype.lowPass,G.prototype.gaussBlur=G.prototype.binomialLowPass}(n),!function(t,n){var r,i=t.ImArray,a=t.Array8U,l=t.Array32I,s=Math.sqrt,o=t.Util.Array.typed,u=function(t){var n,e=t*t,r=new a(e);for(n=0;e>n;n++)r[n]=1;return r},c=u(3);t.Create({name:"MorphologicalFilter",init:function(){var t=this;t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null},path:e,_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=null,t._structureElement=null,t._indices=null,t.$super("dispose"),t},serialize:function(){var t=this;return{_filterName:t._filterName,_dim:t._dim,_structureElement:t._structureElement,_indices:t._indices}},unserialize:function(t){var n=this;return n._dim=t._dim,n._structureElement=o(t._structureElement,a),n._indices=o(t._indices,l),n._filterName=t._filterName,n._filterName&&r[n._filterName]&&(n._filter=r[n._filterName]),n},erode:function(t){return this.set(t,"erode")},dilate:function(t){return this.set(t,"dilate")},opening:function(t){return this.set(t,"open")},closing:function(t){return this.set(t,"close")},set:function(t,n){var e=this;e._filterName=n,e._filter=r[n],t&&t.length?(e._structureElement=new a(t),e._dim=s(e._structureElement.length)+.5|0):t&&t===+t?(e._structureElement=u(t),e._dim=t):(e._structureElement=c,e._dim=3);var i,o,f,h=[],t=e._structureElement,m=t.length,_=e._dim,p=_>>>1;for(o=0,f=0,i=0;m>i;i++,o++)o>=_&&(o=0,f++),t[i]&&(h.push(o-p),h.push(f-p));return e._indices=new l(h),e},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null,t},_apply:function(t,n,e){var r=this;return r._dim&&r._filter?r._filter(r,t,n,e):t},canRun:function(){return this._isOn&&this._dim&&this._filter}}),r={dilate:function(t,n,e,r){var a,s,o,u,c,f,h,m,_,p,d,g,v,C=t._structureElement,y=(C.length,t._dim,t._indices),x=y.length,R=x>>>1,I=new l(x),A=n.length,w=A>>>2,b=new i(A),L=e-1,E=w-e;for(s=0;x>s;s+=2)I[s]=y[s],I[s+1]=y[s+1]*e;for(o=0,u=0,a=0;A>a;a+=4,o++){for(o>=e&&(o=0,u+=e),d=g=v=0,s=0;R>s;s+=2)c=o+I[s],f=u+I[s+1],0>c||c>L||0>f||f>E||(h=c+f<<2,m=n[h],_=n[h+1],p=n[h+2],m>d&&(d=m),_>g&&(g=_),p>v&&(v=p));b[a]=d,b[a+1]=g,b[a+2]=v,b[a+3]=n[a+3]}return b},erode:function(t,n,e,r){var a,s,o,u,c,f,h,m,_,p,d,g,v,C=t._structureElement,y=(C.length,t._dim,t._indices),x=y.length,R=x>>>1,I=new l(x),A=n.length,w=A>>>2,b=new i(A),L=e-1,E=w-e;for(s=0;x>s;s+=2)I[s]=y[s],I[s+1]=y[s+1]*e;for(o=0,u=0,a=0;A>a;a+=4,o++){for(o>=e&&(o=0,u+=e),d=g=v=255,s=0;R>s;s+=2)c=o+I[s],f=u+I[s+1],0>c||c>L||0>f||f>E||(h=c+f<<2,m=n[h],_=n[h+1],p=n[h+2],d>m&&(d=m),g>_&&(g=_),v>p&&(v=p));b[a]=d,b[a+1]=g,b[a+2]=v,b[a+3]=n[a+3]}return b},open:function(t,n,e,r){var a,s,o,u,c,f,h,m,_,p,d,g,v,C=t._structureElement,y=(C.length,t._dim,t._indices),x=y.length,R=x>>>1,I=new l(x),A=n.length,w=A>>>2,b=new i(A),L=e-1,E=w-e;for(s=0;x>s;s+=2)I[s]=y[s],I[s+1]=y[s+1]*e;for(o=0,u=0,a=0;A>a;a+=4,o++){for(o>=e&&(o=0,u+=e),d=g=v=255,s=0;R>s;s+=2)c=o+I[s],f=u+I[s+1],0>c||c>L||0>f||f>E||(h=c+f<<2,m=n[h],_=n[h+1],p=n[h+2],d>m&&(d=m),g>_&&(g=_),v>p&&(v=p));b[a]=d,b[a+1]=g,b[a+2]=v,b[a+3]=n[a+3]}var T=n;for(n=b,b=T,o=0,u=0,a=0;A>a;a+=4,o++){for(o>=e&&(o=0,u+=e),d=g=v=0,s=0;R>s;s+=2)c=o+I[s],f=u+I[s+1],0>c||c>L||0>f||f>E||(h=c+f<<2,m=n[h],_=n[h+1],p=n[h+2],m>d&&(d=m),_>g&&(g=_),p>v&&(v=p));b[a]=d,b[a+1]=g,b[a+2]=v,b[a+3]=n[a+3]}return b},close:function(t,n,e,r){var a,s,o,u,c,f,h,m,_,p,d,g,v,C=t._structureElement,y=(C.length,t._dim,t._indices),x=y.length,R=x>>>1,I=new l(x),A=n.length,w=A>>>2,b=new i(A),L=e-1,E=w-e;for(s=0;x>s;s+=2)I[s]=y[s],I[s+1]=y[s+1]*e;for(o=0,u=0,a=0;A>a;a+=4,o++){for(o>=e&&(o=0,u+=e),d=g=v=0,s=0;R>s;s+=2)c=o+I[s],f=u+I[s+1],0>c||c>L||0>f||f>E||(h=c+f<<2,m=n[h],_=n[h+1],p=n[h+2],m>d&&(d=m),_>g&&(g=_),p>v&&(v=p));b[a]=d,b[a+1]=g,b[a+2]=v,b[a+3]=n[a+3]}var T=n;for(n=b,b=T,o=0,u=0,a=0;A>a;a+=4,o++){for(o>=e&&(o=0,u+=e),d=g=v=255,s=0;R>s;s+=2)c=o+I[s],f=u+I[s+1],0>c||c>L||0>f||f>E||(h=c+f<<2,m=n[h],_=n[h+1],p=n[h+2],d>m&&(d=m),g>_&&(g=_),v>p&&(v=p));b[a]=d,b[a+1]=g,b[a+2]=v,b[a+3]=n[a+3]}return b}}}(n),!function(t,n){var r,i=t.ImArray,a=t.Array32I,l=t.Array32U,s=t.Util.Array.typed,o=Math.min,u=Math.max,c=t.Create({name:"StatisticalFilter",init:function(){var t=this;t.d=0,t.k=0,t._gray=!1,t._filter=null,t._indices=null},path:e,d:0,k:0,_gray:!1,_filter:null,_indices:null,dispose:function(){var t=this;return t.d=null,t.k=null,t._gray=null,t._filter=null,t._indices=null,t.$super("dispose"),t},serialize:function(){var t=this;return{d:t.d,k:t.k,_gray:t._gray,_filter:t._filter,_indices:t._indices}},unserialize:function(t){var n=this;return n.d=t.d,n.k=t.k,n._gray=t._gray,n._filter=t._filter,n._indices=s(t._indices,a),n},kth:function(t,n){return this.set(null==n?3:1&n?n:n+1,t)},median:function(t){return this.set(null==t?3:1&t?t:t+1,.5)},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,0)},erode:null,maximum:function(t){return this.set(null==t?3:1&t?t:t+1,1)},dilate:null,grayscale:function(t){return arguments.length||(t=!0),this._gray=!!t,this},set:function(t,n){var e=this;e.d=t=t||3,e.k=n=o(1,u(0,n||0)),e._filter=0===n?"0th":1===n?"1th":"kth";var r,i,l,s=t*t<<1,c=t>>>1,f=new a(s);for(i=0,l=0,r=0;s>r;r+=2,i++)i>=t&&(i=0,l++),f[r]=i-c,f[r+1]=l-c;return e._indices=f,e},reset:function(){var t=this;return t.d=0,t.k=0,t._filter=null,t._indices=null,t},_apply:function(t,n,e){var i=this;return i.d?r[i._filter+(i._gray?"_gray":"")](i,t,n,e):t},canRun:function(){return this._isOn&&this.d}});c.prototype.erode=c.prototype.minimum,c.prototype.dilate=c.prototype.maximum,r={"1th":function(t,n,e,r){var l,s,o,u,c,f,h,m,_,p,d,g,v,C=(t.d,n.length),y=C>>>2,x=new i(C),R=e-1,I=y-e,A=t._indices,w=A.length,b=new a(w);for(s=0;w>s;s+=2)b[s]=A[s],b[s+1]=A[s+1]*e;for(l=0,o=0,u=0;C>l;l+=4,o++){for(o>=e&&(o=0,u+=e),d=g=v=0,s=0;w>s;s+=2)c=o+b[s],f=u+b[s+1],0>c||c>R||0>f||f>I||(h=c+f<<2,m=n[h],_=n[h+1],p=n[h+2],m>d&&(d=m),_>g&&(g=_),p>v&&(v=p));x[l]=d,x[l+1]=g,x[l+2]=v,x[l+3]=n[l+3]}return x},"0th":function(t,n,e,r){var l,s,o,u,c,f,h,m,_,p,d,g,v,C=(t.d,n.length),y=C>>>2,x=new i(C),R=e-1,I=y-e,A=t._indices,w=A.length,b=new a(w);for(s=0;w>s;s+=2)b[s]=A[s],b[s+1]=A[s+1]*e;for(l=0,o=0,u=0;C>l;l+=4,o++){for(o>=e&&(o=0,u+=e),d=g=v=255,s=0;w>s;s+=2)c=o+b[s],f=u+b[s+1],0>c||c>R||0>f||f>I||(h=c+f<<2,m=n[h],_=n[h+1],p=n[h+2],d>m&&(d=m),g>_&&(g=_),v>p&&(v=p));x[l]=d,x[l+1]=g,x[l+2]=v,x[l+3]=n[l+3]}return x},kth:function(t,n,e,r){var s,o,u,c,f,h,m,_,p,d,g,v,C,y,x,R,I,A,w,b,L,E,T,M,G,S,F,N,Y=(t.d,t.k),H=n.length,O=H>>>2,B=new i(H),X=e-1,z=O-e,D=t._indices,U=D.length,V=new a(U);for(b=new l(256),L=new l(256),E=new l(256),o=0;U>o;o+=2)V[o]=D[o],V[o+1]=D[o+1]*e;for(s=0,u=0,c=0;H>s;s+=4,u++){for(u>=e&&(u=0,c+=e),T=M=G=0,g=v=C=255,y=x=R=0,o=0;U>o;o+=2)f=u+V[o],h=c+V[o+1],0>f||f>X||0>h||h>z||(m=f+h<<2,_=n[m],p=n[m+1],d=n[m+2],b[_]++,L[p]++,E[d]++,T++,M++,G++,g>_&&(g=_),v>p&&(v=p),C>d&&(C=d),_>y&&(y=_),p>x&&(x=p),d>R&&(R=d));for(T*=Y,S=0,I=-1,o=g;y>=o;o++)S+=b[o],b[o]=0,0>I&&S>=T&&(I=o);for(M*=Y,F=0,A=-1,o=v;x>=o;o++)F+=L[o],L[o]=0,0>A&&F>=M&&(A=o);for(G*=Y,N=0,w=-1,o=C;R>=o;o++)N+=E[o],E[o]=0,0>w&&N>=G&&(w=o);B[s]=I,B[s+1]=A,B[s+2]=w,B[s+3]=n[s+3]}return B},"1th_gray":function(t,n,e,r){var l,s,o,u,c,f,h,m,_,p=(t.d,n.length),d=p>>>2,g=new i(p),v=e-1,C=d-e,y=t._indices,x=y.length,R=new a(x);for(s=0;x>s;s+=2)R[s]=y[s],R[s+1]=y[s+1]*e;for(l=0,o=0,u=0;p>l;l+=4,o++){for(o>=e&&(o=0,u+=e),_=0,s=0;x>s;s+=2)c=o+R[s],f=u+R[s+1],0>c||c>v||0>f||f>C||(h=c+f<<2,m=n[h],
m>_&&(_=m));g[l]=_,g[l+1]=_,g[l+2]=_,g[l+3]=n[l+3]}return g},"0th_gray":function(t,n,e,r){var l,s,o,u,c,f,h,m,_,p=(t.d,n.length),d=p>>>2,g=new i(p),v=e-1,C=d-e,y=t._indices,x=y.length,R=new a(x);for(s=0;x>s;s+=2)R[s]=y[s],R[s+1]=y[s+1]*e;for(l=0,o=0,u=0;p>l;l+=4,o++){for(o>=e&&(o=0,u+=e),_=255,s=0;x>s;s+=2)c=o+R[s],f=u+R[s+1],0>c||c>v||0>f||f>C||(h=c+f<<2,m=n[h],_>m&&(_=m));g[l]=_,g[l+1]=_,g[l+2]=_,g[l+3]=n[l+3]}return g},kth_gray:function(t,n,e,r){var s,o,u,c,f,h,m,_,p,d,g,v,C,y,x=(t.d,t.k),R=n.length,I=R>>>2,A=new i(R),w=e-1,b=I-e,L=t._indices,E=L.length,T=new a(E);for(v=new l(256),o=0;E>o;o+=2)T[o]=L[o],T[o+1]=L[o+1]*e;for(s=0,u=0,c=0;R>s;s+=4,u++){for(u>=e&&(u=0,c+=e),C=0,p=255,d=0,o=0;E>o;o+=2)f=u+T[o],h=c+T[o+1],0>f||f>w||0>h||h>b||(m=f+h<<2,_=n[m],p>_&&(p=_),_>d&&(d=_),C++,v[_]++);for(C*=x,y=0,g=-1,o=p;d>=o;o++)y+=v[o],v[o]=0,0>g&&y>=C&&(g=o);A[s]=g,A[s+1]=g,A[s+2]=g,A[s+3]=n[s+3]}return A}}}(n),!function(t,n){var r="hasOwnProperty";t.Create({name:"InlineFilter",init:function(t,n){var e=this;e._params={},e.set(t,n)},path:e,_filter:null,_params:null,_changed:!1,dispose:function(){var t=this;return t._filter=null,t._params=null,t._changed=null,t.$super("dispose"),t},serialize:function(){var t,n=this;return t={_filter:!1===n._filter?!1:n._changed&&n._filter?n._filter.toString():null,_params:n._params},n._changed=!1,t},unserialize:function(n){var e=this;return null!=n._filter&&(e._filter=!1===n._filter?null:new Function("FILTER",'"use strict"; return '+n._filter+";")(t)),e._params=n._params||{},e},params:function(t){var n=this;if(arguments.length){for(var e in t)t[r](e)&&(n._params[e]=t[e]);return n}return n._params},set:function(t,n){var e=this;return!1===t?(e._filter=!1,e._changed=!0):("function"==typeof t&&(e._filter=t,e._changed=!0),n&&e.params(n)),e},_apply:function(t,n,e,r){var i=this;return i._filter?i._filter(i._params,t,n,e,r):t},canRun:function(){return this._isOn&&this._filter}}),t.CustomFilter=t.InlineFilter}(n),!function(t,n){var r=t.Interpolation;t.Create({name:"ResampleFilter",init:function(t,n,e){var r=this;r.sX=t||1,r.sY=n||1,r.interpolation=e},path:e,sX:1,sY:1,interpolation:null,hasMeta:!0,dispose:function(){var t=this;return t.sX=null,t.sY=null,t.interpolation=null,t.$super("dispose"),t},serialize:function(){var t=this;return{sX:t.sX,sY:t.sY,interpolation:t.interpolation}},unserialize:function(t){var n=this;return n.sX=t.sX,n.sY=t.sY,n.interpolation=t.interpolation,n},_apply:function(t,n,e){var i,a,l,s=this,o=s.sX,u=s.sY;return s.hasMeta=!1,s._meta=null,1===o&&1===u?t:(l=r[s.interpolation||"bilinear"])?(i=s.sX*n|0,a=s.sY*e|0,s.hasMeta=!0,s._meta={_IMG_WIDTH:i,_IMG_HEIGHT:a},l(t,n,e,i,a)):t}}),t.InterpolationFilter=t.ResizeFilter=t.RescaleFilter=t.ResampleFilter}(n),!function(t,n){var r=Math.max,i=Math.min,a=t.Util.Image.get_data;t.Create({name:"SelectionFilter",init:function(t,n,e,r){var i=this;i.x1=null==t?0:+t,i.y1=null==n?0:+n,i.x2=null==e?1:+e,i.y2=null==r?1:+r},path:e,x1:0,y1:0,x2:1,y2:1,hasMeta:!0,dispose:function(){var t=this;return t.x1=null,t.y1=null,t.x2=null,t.y2=null,t.$super("dispose"),t},serialize:function(){var t=this;return{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}},unserialize:function(t){var n=this;return n.x1=t.x1,n.y1=t.y1,n.x2=t.x2,n.y2=t.y2,n},_apply:function(t,n,e){var l,s,o,u,c=this;return c.hasMeta=!1,c._meta=null,l=i(1,r(0,+c.x1))*(n-1)|0,s=i(1,r(0,+c.y1))*(e-1)|0,o=i(1,r(0,+c.x2))*(n-1)|0,u=i(1,r(0,+c.y2))*(e-1)|0,0===l&&0===s&&n===o+1&&e===u+1?t:(c.hasMeta=!0,c._meta={_IMG_WIDTH:o-l+1,_IMG_HEIGHT:u-s+1},a(t,n,e,l,s,o,u,!0))}}),t.CropFilter=t.SubSelectionFilter=t.SelectionFilter}(n),n});