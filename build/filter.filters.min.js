/**
*
*   FILTER.js Generic Filters
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Generic Filters)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e){"use strict";"object"==typeof module&&module.exports?module.exports=e.call(t,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_FILTERS")?define("FILTER_FILTERS",["module","FILTER"],function(n,r){return e.moduleUri=n.uri,e.call(t,r),r}):(e.call(t,t.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return t.FILTER})}(this,function t(e){"use strict";var n=e.getPath(t.moduleUri);return!function(t,e){var r=(Object.prototype,Function.prototype,Array.prototype),i=r.slice,a=r.splice,s=r.concat,l=t.CompositeFilter=t.Class(t.Filter,{name:"CompositeFilter",constructor:function(t){var e=this;e.$super("constructor"),e._stack=t&&t.length?t.slice():[]},path:n,_stack:null,_meta:null,_stable:!0,dispose:function(t){var e,n=this,r=n._stack;if(n.$super("dispose"),!0===t)for(e=0;e<r.length;e++)r[e]&&r[e].dispose(t),r[e]=null;return n._stack=null,n._meta=null,n},serialize:function(){var t,e=this,n={filter:e.name,_isOn:!!e._isOn,_stable:!!e._stable,filters:[]},r=e._stack;for(t=0;t<r.length;t++)n.filters.push(r[t].serialize());return n},unserialize:function(e){var n,r,i,a,s,l=this,u=l._stack;if(e&&l.name===e.filter){if(l._isOn=!!e._isOn,l._stable=!!e._stable,a=e.filters||[],r=a.length,i=u.length,r===i&&l._stable)for(n=0;r>n;n++)u[n]=u[n].unserialize(a[n]);else{for(n=0;i>n;n++)u[n]&&u[n].dispose(!0),u[n]=null;for(u=[],n=0;r>n;n++){if(s=a[n]&&a[n].filter?t[a[n].filter]:null,!s)throw new Error('Filter "'+a[n].filter+'" could not be created');u.push((new s).unserialize(a[n]))}}l._stack=u}return l},getMeta:function(){return this._meta},setMeta:function(t){var e,n,r=this,i=r._stack;if(t&&(n=t.length)&&i.length)for(e=0;n>e;e++)i[t[e][0]].setMeta(t[e][1]);return r},stable:function(t){return arguments.length||(t=!0),this._stable=!!t,this},filters:function(t){return arguments.length?(this._stack=t.slice(),this):this._stack.slice()},push:function(){var t=i.call(arguments),e=t.length;return e&&(this._stack=s.apply(this._stack,t)),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){var t=i.call(arguments),e=t.length;return e&&a.apply(this._stack,[0,0].concat(t)),this},getAt:function(t){return this._stack.length>t?this._stack[t]:null},setAt:function(t,e){return this._stack.length>t?this._stack[t]=e:this._stack.push(e),this},insertAt:function(t){var e=i.call(arguments);e.length;return argslen>1&&(e.shift(),a.apply(this._stack,[t,0].concat(e))),this},removeAt:function(t){return this._stack.splice(t,1)},remove:function(t){for(var e=this._stack.length;--e>=0;)t===this._stack[e]&&this._stack.splice(e,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(t,e,n,r){var i=this,a=!1;if(i.hasMeta=!1,i._meta=[],i._isOn&&i._stack.length){var s,l,u=i._stack,o=u.length;for(s=0;o>s;s++)l=u[s],l&&l._isOn&&(t=l._apply(t,e,n,r),a=a||l._update,l.hasMeta&&i._meta.push([s,l.getMeta()]))}return i._update=a,i.hasMeta=i._meta.length>0,t},canRun:function(){return this._isOn&&this._stack.length},toString:function(){var t,e=arguments.length&&arguments[0].substr?arguments[0]:"  ",n=e+e,r=this._stack,i=[],a=r.length;for(t=0;a>t;t++)i.push(r[t].toString(n));return["[FILTER: "+this.name+"]","[","  "+i.join("\n  "),"]",""].join("\n")}});l.prototype.empty=l.prototype.reset,l.prototype.concat=l.prototype.push}(e),!function(t,e){var r="hasOwnProperty";t.InlineFilter=t.CustomFilter=t.Class(t.Filter,{name:"InlineFilter",constructor:function(t){var e=this;e.$super("constructor"),e._handler=t&&"function"==typeof t?t:null,e._params={}},path:n,_handler:null,_params:null,dispose:function(){var t=this;return t.$super("dispose"),t._handler=null,t._params=null,t},params:function(t){var e=this;if(arguments.length){for(var n in t)t[r](n)&&(e._params[n]=t[n]);return e}return e._params},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_handler:t._handler?t._handler.toString():null,_params:t._params}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r._handler=null,n._handler&&(r._handler=new Function("FILTER",'"use strict"; return '+n._handler+";")(t)),r._params=n._params||{}),r},_apply:function(t,e,n,r){var i=this;return i._isOn&&i._handler?i._handler(i,t,e,n,r):t},canRun:function(){return this._isOn&&this._handler}})}(e),!function(t,e){function r(t,e,n){var r=new a(20);return r[0]=t[0]+n*(e[0]-t[0]),r[1]=t[1]+n*(e[1]-t[1]),r[2]=t[2]+n*(e[2]-t[2]),r[3]=t[3]+n*(e[3]-t[3]),r[4]=t[4]+n*(e[4]-t[4]),r[5]=t[5]+n*(e[5]-t[5]),r[6]=t[6]+n*(e[6]-t[6]),r[7]=t[7]+n*(e[7]-t[7]),r[8]=t[8]+n*(e[8]-t[0]),r[9]=t[9]+n*(e[9]-t[9]),r[10]=t[10]+n*(e[10]-t[10]),r[11]=t[11]+n*(e[11]-t[11]),r[12]=t[12]+n*(e[12]-t[12]),r[13]=t[13]+n*(e[13]-t[13]),r[14]=t[14]+n*(e[14]-t[14]),r[15]=t[15]+n*(e[15]-t[15]),r[16]=t[16]+n*(e[16]-t[16]),r[17]=t[17]+n*(e[17]-t[17]),r[18]=t[18]+n*(e[18]-t[18]),r[19]=t[19]+n*(e[19]-t[19]),r}var i=t.CHANNEL,a=t.ColorMatrix,s=(t.Util.Filter.cm_eye,t.Util.Filter.cm_multiply),l=t.Util.Filter.cm_rechannel,u=Math.sin,o=Math.cos,c=t.CONST.toRad,_=(t.CONST.toDeg,t.Util.Array.typed),f=t._notSupportClamp,h=t.ColorMatrixFilter=t.Class(t.Filter,{name:"ColorMatrixFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&t.length?e._matrix=new a(t):e._matrix=null},path:n,_matrix:null,_webglInstance:null,dispose:function(){var t=this;return t.$super("dispose"),t._webglInstance=null,t._matrix=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_matrix:t._matrix}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._matrix=_(e._matrix,a)),n},channel:function(t,e){t=t||0;var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],r=i.A===t||e?1:0;return n[5*i.R+t]=i.R===t?1:r,n[5*i.G+t]=i.G===t?1:r,n[5*i.B+t]=i.B===t?1:r,this.set(n)},redChannel:function(t){return this.channel(i.R,t)},greenChannel:function(t){return this.channel(i.G,t)},blueChannel:function(t){return this.channel(i.B,t)},alphaChannel:function(t){return this.channel(i.A,!0)},maskChannel:function(t){if(t=t||0,i.A===t)return this;var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return e[5*t+t]=0,this.set(e)},swapChannels:function(t,e){if(t===e)return this;var n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return n[5*t+t]=0,n[5*e+e]=0,n[5*t+e]=1,n[5*e+t]=1,this.set(n)},desaturate:function(){var e=t.LUMA;return this.set(l([e[0],e[1],e[2],0,0,e[0],e[1],e[2],0,0,e[0],e[1],e[2],0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},colorize:function(n,r){var a,s,u,o,c=t.LUMA;return r===e&&(r=1),a=.00392156862745098*(n>>16&255),s=.00392156862745098*(n>>8&255),u=.00392156862745098*(255&n),o=1-r,this.set(l([o+r*a*c[0],r*a*c[1],r*a*c[2],0,0,r*s*c[0],o+r*s*c[1],r*s*c[2],0,0,r*u*c[0],r*u*c[1],o+r*u*c[2],0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},invert:function(){return this.set(l([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},invertAlpha:function(){return this.set(l([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},saturate:function(e){var n,r,a,s,u=t.LUMA;return n=1-e,r=n*u[0],a=n*u[1],s=n*u[2],this.set(l([r+e,a,s,0,0,r,a+e,s,0,0,r,a,s+e,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},contrast:function(t,n,r){return n===e&&(n=t),r===e&&(r=t),t+=1,n+=1,r+=1,this.set(l([t,0,0,0,128*(1-t),0,n,0,0,128*(1-n),0,0,r,0,128*(1-r),0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},brightness:function(t,n,r){return n===e&&(n=t),r===e&&(r=t),this.set(l([1,0,0,0,t,0,1,0,0,n,0,0,1,0,r,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},adjustHue:function(e){e*=c;var n=o(e),r=u(e),a=t.LUMA;return this.set(l([a[0]+n*(1-a[0])+r*-a[0],a[1]+n*-a[1]+r*-a[1],a[2]+n*-a[2]+r*(1-a[2]),0,0,a[0]+n*-a[0]+.143*r,a[1]+n*(1-a[1])+.14*r,a[2]+n*-a[2]+r*-.283,0,0,a[0]+n*-a[0]+r*-(1-a[0]),a[1]+n*-a[1]+r*a[1],a[2]+n*(1-a[2])+r*a[2],0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},average:function(t,n,r){return t===e&&(t=.3333),n===e&&(n=.3333),r===e&&(r=.3334),this.set(l([t,n,r,0,0,t,n,r,0,0,t,n,r,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},quickContrastCorrection:function(t){return t===e&&(t=1.2),this.set(l([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},sepia:function(t){return t===e&&(t=.5),t>1?t=1:0>t&&(t=0),this.set(l([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},sepia2:function(n){n===e&&(n=10),n>100&&(n=100),n*=2.55;var r=t.LUMA;return this.set(l([r[0],r[1],r[2],0,40,r[0],r[1],r[2],0,20,r[0],r[1],r[2],0,-n,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},threshold:function(n,r){r===e&&(r=256);var a=t.LUMA;return this.set(l([a[0]*r,a[1]*r,a[2]*r,0,-(r-1)*n,a[0]*r,a[1]*r,a[2]*r,0,-(r-1)*n,a[0]*r,a[1]*r,a[2]*r,0,-(r-1)*n,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},threshold_rgb:function(t,n){return n===e&&(n=256),this.set(l([n,0,0,0,-(n-1)*t,0,n,0,0,-(n-1)*t,0,0,n,0,-(n-1)*t,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},threshold_alpha:function(t,n){return t===e&&(t=.5),n===e&&(n=256),this.set(l([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,n,-n*t],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},RGB2YCbCr:function(){return this.set(l([.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,.5,-.418688,-.081312,0,128,0,0,0,1,0],i.R,i.G,i.B,i.A,i.Y,i.CB,i.CR,i.A))},YCbCr2RGB:function(){return this.set(l([1,0,1.402,0,-179.456,1,-.34414,-.71414,0,135.45984,1,1.772,0,0,-226.816,0,0,0,1,0],i.Y,i.CB,i.CR,i.A,i.R,i.G,i.B,i.A))},blend:function(t,e){return this._matrix=this._matrix?r(this._matrix,t.getMatrix(),e):new a(t.getMatrix()),this},set:function(t){return this._matrix=this._matrix?s(this._matrix,new a(t)):new a(t),this},reset:function(){return this._matrix=null,this},combineWith:function(t){return this.set(t.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(t){return this._matrix=new a(t),this},_apply:f?function(t,e,n){var r=this,i=r._matrix;if(!r._isOn||!i)return t;var a,s,l,u,o,c,_,f,h,m,p,d,v,g,w,y,x,b,A,R,C,M=t.length,O=(M>>>2)%4;for(a=0;M>a;a+=16)b=t[a],A=t[a+1],R=t[a+2],C=t[a+3],s=i[0]*b+i[1]*A+i[2]*R+i[3]*C+i[4],l=i[5]*b+i[6]*A+i[7]*R+i[8]*C+i[9],u=i[10]*b+i[11]*A+i[12]*R+i[13]*C+i[14],o=i[15]*b+i[16]*A+i[17]*R+i[18]*C+i[19],b=t[a+4],A=t[a+5],R=t[a+6],C=t[a+7],c=i[0]*b+i[1]*A+i[2]*R+i[3]*C+i[4],_=i[5]*b+i[6]*A+i[7]*R+i[8]*C+i[9],f=i[10]*b+i[11]*A+i[12]*R+i[13]*C+i[14],h=i[15]*b+i[16]*A+i[17]*R+i[18]*C+i[19],b=t[a+8],A=t[a+9],R=t[a+10],C=t[a+11],m=i[0]*b+i[1]*A+i[2]*R+i[3]*C+i[4],p=i[5]*b+i[6]*A+i[7]*R+i[8]*C+i[9],d=i[10]*b+i[11]*A+i[12]*R+i[13]*C+i[14],v=i[15]*b+i[16]*A+i[17]*R+i[18]*C+i[19],b=t[a+12],A=t[a+13],R=t[a+14],C=t[a+15],g=i[0]*b+i[1]*A+i[2]*R+i[3]*C+i[4],w=i[5]*b+i[6]*A+i[7]*R+i[8]*C+i[9],y=i[10]*b+i[11]*A+i[12]*R+i[13]*C+i[14],x=i[15]*b+i[16]*A+i[17]*R+i[18]*C+i[19],s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,o=0>o?0:o>255?255:o,c=0>c?0:c>255?255:c,_=0>_?0:_>255?255:_,f=0>f?0:f>255?255:f,h=0>h?0:h>255?255:h,m=0>m?0:m>255?255:m,p=0>p?0:p>255?255:p,d=0>d?0:d>255?255:d,v=0>v?0:v>255?255:v,g=0>g?0:g>255?255:g,w=0>w?0:w>255?255:w,y=0>y?0:y>255?255:y,x=0>x?0:x>255?255:x,t[a]=~~s,t[a+1]=~~l,t[a+2]=~~u,t[a+3]=~~o,t[a+4]=~~c,t[a+5]=~~_,t[a+6]=~~f,t[a+7]=~~h,t[a+8]=~~m,t[a+9]=~~p,t[a+10]=~~d,t[a+11]=~~v,t[a+12]=~~g,t[a+13]=~~w,t[a+14]=~~y,t[a+15]=~~x;if(O)for(a=M-(O<<2);M>a;a+=4)b=t[a],A=t[a+1],R=t[a+2],C=t[a+3],s=i[0]*b+i[1]*A+i[2]*R+i[3]*C+i[4],l=i[5]*b+i[6]*A+i[7]*R+i[8]*C+i[9],u=i[10]*b+i[11]*A+i[12]*R+i[13]*C+i[14],o=i[15]*b+i[16]*A+i[17]*R+i[18]*C+i[19],s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,o=0>o?0:o>255?255:o,t[a]=~~s,t[a+1]=~~l,t[a+2]=~~u,t[a+3]=~~o;return t}:function(t,e,n){var r=this,i=r._matrix;if(!r._isOn||!i)return t;var a,s,l,u,o,c,_,f,h,m,p,d,v,g,w,y,x,b,A,R,C,M=t.length,O=(M>>>2)%4;for(a=0;M>a;a+=16)b=t[a],A=t[a+1],R=t[a+2],C=t[a+3],s=i[0]*b+i[1]*A+i[2]*R+i[3]*C+i[4],l=i[5]*b+i[6]*A+i[7]*R+i[8]*C+i[9],u=i[10]*b+i[11]*A+i[12]*R+i[13]*C+i[14],o=i[15]*b+i[16]*A+i[17]*R+i[18]*C+i[19],b=t[a+4],A=t[a+5],R=t[a+6],C=t[a+7],c=i[0]*b+i[1]*A+i[2]*R+i[3]*C+i[4],_=i[5]*b+i[6]*A+i[7]*R+i[8]*C+i[9],f=i[10]*b+i[11]*A+i[12]*R+i[13]*C+i[14],h=i[15]*b+i[16]*A+i[17]*R+i[18]*C+i[19],b=t[a+8],A=t[a+9],R=t[a+10],C=t[a+11],m=i[0]*b+i[1]*A+i[2]*R+i[3]*C+i[4],p=i[5]*b+i[6]*A+i[7]*R+i[8]*C+i[9],d=i[10]*b+i[11]*A+i[12]*R+i[13]*C+i[14],v=i[15]*b+i[16]*A+i[17]*R+i[18]*C+i[19],b=t[a+12],A=t[a+13],R=t[a+14],C=t[a+15],g=i[0]*b+i[1]*A+i[2]*R+i[3]*C+i[4],w=i[5]*b+i[6]*A+i[7]*R+i[8]*C+i[9],y=i[10]*b+i[11]*A+i[12]*R+i[13]*C+i[14],x=i[15]*b+i[16]*A+i[17]*R+i[18]*C+i[19],t[a]=~~s,t[a+1]=~~l,t[a+2]=~~u,t[a+3]=~~o,t[a+4]=~~c,t[a+5]=~~_,t[a+6]=~~f,t[a+7]=~~h,t[a+8]=~~m,t[a+9]=~~p,t[a+10]=~~d,t[a+11]=~~v,t[a+12]=~~g,t[a+13]=~~w,t[a+14]=~~y,t[a+15]=~~x;if(O)for(a=M-(O<<2);M>a;a+=4)b=t[a],A=t[a+1],R=t[a+2],C=t[a+3],s=i[0]*b+i[1]*A+i[2]*R+i[3]*C+i[4],l=i[5]*b+i[6]*A+i[7]*R+i[8]*C+i[9],u=i[10]*b+i[11]*A+i[12]*R+i[13]*C+i[14],o=i[15]*b+i[16]*A+i[17]*R+i[18]*C+i[19],t[a]=~~s,t[a+1]=~~l,t[a+2]=~~u,t[a+3]=~~o;return t},canRun:function(){return this._isOn&&this._matrix}});h.prototype.grayscale=h.prototype.desaturate,h.prototype.rotateHue=h.prototype.adjustHue,h.prototype.thresholdRgb=h.prototype.threshold_rgb,h.prototype.thresholdAlpha=h.prototype.threshold_alpha,h.blend=r}(e),!function(t,e){var r=t.CHANNEL,i=t.ColorTable,a=t.Color.clampPixel,s=t.Util.Filter,l=s.ct_eye,u=s.ct_multiply,o=function(t){var e,n=new i(256);for(e=0;256>e;e++)n[e]=t;return n},c=Math.pow,_=Math.exp,f=1/255,h=t.Util.Array.typed,m=t.TableLookupFilter=t.Class(t.Filter,{name:"TableLookupFilter",constructor:function(t,e,n,i){var a=this;a.$super("constructor"),a._table=[null,null,null,null],t=t||null,e=e||t,n=n||e,i=i||null,a._table[r.R]=t,a._table[r.G]=e,a._table[r.B]=n,a._table[r.A]=i},path:n,_table:null,dispose:function(){var t=this;return t.$super("dispose"),t._table=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_tableR:t._table[r.R],_tableG:t._table[r.G],_tableB:t._table[r.B],_tableA:t._table[r.A]}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._table[r.R]=h(e._tableR,i),n._table[r.G]=h(e._tableG,i),n._table[r.B]=h(e._tableB,i),n._table[r.A]=h(e._tableA,i)),n},thresholds:function(t,e,n){t.length||(t=[t]),e||(e=t),n||(n=e);var r,s,l=t.length,u=l+1,o=e.length,c=o+1,_=n.length,f=_+1,h=new i(256),m=new i(u),p=new i(256),d=new i(c),v=new i(256),g=new i(f),w=255/(u-1),y=255/(c-1),x=255/(f-1);for(r=0;u>r;)m[r]=~~(w*r),r++;for(t[0]=~~(255*t[0]),r=1;l>r;)t[r]=t[r-1]+~~(255*t[r]),r++;for(r=0;c>r;)d[r]=~~(y*r),r++;for(e[0]=~~(255*e[0]),r=1;o>r;)e[r]=e[r-1]+~~(255*e[r]),r++;for(r=0;f>r;)g[r]=~~(x*r),r++;for(n[0]=~~(255*n[0]),r=1;_>r;)n[r]=n[r-1]+~~(255*n[r]),r++;for(r=0;256>r;r++){for(s=0;l>s&&r>t[s];)s++;for(h[r]=a(m[s]),s=0;o>s&&r>e[s];)s++;for(p[r]=a(d[s]),s=0;_>s&&r>n[s];)s++;v[r]=a(g[s])}return this.set(h,p,v)},threshold:function(t,e,n){return t=t||.5,e=e||t,n=n||e,this.thresholds([t],[e],[n])},quantize:function(t){t===e&&(t=64),2>t&&(t=2);var n,r=new i(256),s=new i(t),l=255/(t-1),u=t/256;for(n=0;t>n;)s[n]=~~(l*n),n++;for(n=0;256>n;n++)r[n]=a(s[~~(u*n)]);return this.set(r)},binarize:function(){return this.quantize(2)},channel:function(t){if(null==t)return this;var e,n,i;switch(t||r.R){case r.B:e=o(0),n=o(0),i=l();break;case r.G:e=o(0),n=l(),i=o(0);break;case r.R:default:e=l(),n=o(0),i=o(0)}return this.set(e,n,i)},redChannel:function(){return this.channel(r.R)},greenChannel:function(){return this.channel(r.G)},blueChannel:function(){return this.channel(r.B)},solarize:function(t){t===e&&(t=.5);var n,r,s=0,l=new i(256),u=2/255;for(s=0;256>s;s++)n=u*s,r=n>t?255-255*n:255*n-255,l[s]=~~a(r);return this.set(l)},solarize2:function(t){t===e&&(t=.5),t=1-t;var n,r,s=0,l=new i(256),u=2/255;for(s=0;256>s;s++)n=u*s,r=t>n?255-255*n:255*n-255,l[s]=~~a(r);return this.set(l)},solarizeInverse:function(t){t===e&&(t=.5),t*=256;var n=0,r=new i(256);for(n=0;256>n;n++)r[n]=n>t?255-n:n;return this.set(r)},invert:function(){return this.set(l(-1))},mask:function(t){var e=0,n=t>>16&255,r=t>>8&255,s=255&t;for(tR=new i(256),tG=new i(256),tB=new i(256),e=0;256>e;e++)tR[e]=a(e&n),tG[e]=a(e&r),tB[e]=a(e&s);return this.set(tR,tG,tB)},replace:function(t,e){if(t==e)return this;var n=t>>16&255,r=t>>8&255,i=255&t,a=e>>16&255,s=e>>8&255,u=255&e,o=l(),c=l(),_=l();return o[n]=a,c[r]=s,_[i]=u,this.set(o,c,_)},extract:function(t,e,n){if(!e||!e.length)return this;n=n||0;var i,s,l=n>>>16&255,u=n>>>8&255,c=255&n,_=o(l),f=o(u),h=o(c);switch(t||r.R){case r.B:for(i=e[0],s=e[1];s>=i;)h[i]=a(i),i++;break;case r.G:for(i=e[0],s=e[1];s>=i;)f[i]=a(i),i++;break;case r.R:default:for(i=e[0],s=e[1];s>=i;)_[i]=a(i),i++}return this.set(_,f,h)},gammaCorrection:function(t,e,n){t=t||1,e=e||t,n=n||e,t=1/t,e=1/e,n=1/n;var r=new i(256),s=new i(256),l=new i(256),u=0;for(u=0;256>u;u++)r[u]=a(~~(255*c(f*u,t))),s[u]=a(~~(255*c(f*u,e))),l[u]=a(~~(255*c(f*u,n)));return this.set(r,s,l)},exposure:function(t){t===e&&(t=1);var n=0,r=new i(256);for(n=0;256>n;n++)r[n]=a(~~(255*(1-_(-t*n*f))));return this.set(r)},set:function(t,e,n,i){if(!t)return this;var a,s,o=this._table,c=o[r.R]||l();return e=e||t,n=n||e,e||n?(e=e||t,n=n||e,a=o[r.G]||c,s=o[r.B]||a,o[r.R]=u(t,c),o[r.G]=u(e,a),o[r.B]=u(n,s)):(o[r.R]=u(t,c),o[r.G]=o[r.R],o[r.B]=o[r.R]),this},reset:function(){return this._table=[null,null,null,null],this},combineWith:function(t){return this.set(t.getTable(r.R),t.getTable(r.G),t.getTable(r.B))},getTable:function(t){return this._table[t||r.R]||null},setTable:function(t,e){return this._table[e||r.R]=t||null,this},_apply:function(t,e,n){var i=this,a=i._table;if(!i._isOn||!a||!a[r.R])return t;var s,l,u,o,c,_=t.length,f=(_>>>2)%4,h=a[r.R],m=a[r.G],p=a[r.B],d=a[r.A];if(d){for(s=0;_>s;s+=16)l=t[s],u=t[s+1],o=t[s+2],c=t[s+3],t[s]=h[l],t[s+1]=m[u],t[s+2]=p[o],t[s+3]=d[c],l=t[s+4],u=t[s+5],o=t[s+6],c=t[s+7],t[s+4]=h[l],t[s+5]=m[u],t[s+6]=p[o],t[s+7]=d[c],l=t[s+8],u=t[s+9],o=t[s+10],c=t[s+11],t[s+8]=h[l],t[s+9]=m[u],t[s+10]=p[o],t[s+11]=d[c],l=t[s+12],u=t[s+13],o=t[s+14],c=t[s+15],t[s+12]=h[l],t[s+13]=m[u],t[s+14]=p[o],t[s+15]=d[c];if(f)for(s=_-(f<<2);_>s;s+=4)l=t[s],u=t[s+1],o=t[s+2],c=t[s+3],t[s]=h[l],t[s+1]=m[u],t[s+2]=p[o],t[s+3]=d[c]}else{for(s=0;_>s;s+=16)l=t[s],u=t[s+1],o=t[s+2],t[s]=h[l],t[s+1]=m[u],t[s+2]=p[o],l=t[s+4],u=t[s+5],o=t[s+6],t[s+4]=h[l],t[s+5]=m[u],t[s+6]=p[o],l=t[s+8],u=t[s+9],o=t[s+10],t[s+8]=h[l],t[s+9]=m[u],t[s+10]=p[o],l=t[s+12],u=t[s+13],o=t[s+14],t[s+12]=h[l],t[s+13]=m[u],t[s+14]=p[o];if(f)for(s=_-(f<<2);_>s;s+=4)l=t[s],u=t[s+1],o=t[s+2],t[s]=h[l],t[s+1]=m[u],t[s+2]=p[o]}return t},canRun:function(){return this._isOn&&this._table&&this._table[r.R]}});m.prototype.posterize=m.prototype.levels=m.prototype.quantize}(e),!function(t,e){var r=t.ImArray,i=t.ImArrayCopy,a=t.Util.Array.typed,s=t.MODE,l=t.Array16I,u=Math.min,o=(Math.max,Math.floor);t.DisplacementMapFilter=t.Class(t.Filter,{name:"DisplacementMapFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&e.setMap(t)},path:n,_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,red:0,green:0,blue:0,alpha:0,mode:s.CLAMP,dispose:function(){var t=this;return t.$super("dispose"),t._map=null,t.map=null,t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.red=null,t.green=null,t.blue=null,t.alpha=null,t.mode=null,t},serialize:function(){var t=this,e=t.map;return{filter:t.name,_isOn:!!t._isOn,params:{_map:t._map||(e?{data:e.getData(),width:e.width,height:e.height}:null),scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color,red:t.red,green:t.green,blue:t.blue,alpha:t.alpha,mode:t.mode}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n.map=null,n._map=e._map,n._map&&(n._map.data=a(n._map.data,r)),n.scaleX=e.scaleX,n.scaleY=e.scaleY,n.startX=e.startX,n.startY=e.startY,n.componentX=e.componentX,n.componentY=e.componentY,n.color=e.color,n.red=e.red,n.green=e.green,n.blue=e.blue,n.alpha=e.alpha,n.mode=e.mode),n},reset:function(){var t=this;return t._map=null,t.map=null,t},getMap:function(){return this.map},setMap:function(t){var e=this;return t&&(e.map=t,e._map=null),e},setColor:function(t){var e=this;return e.color=t,e.alpha=t>>24&255,e.red=t>>16&255,e.green=t>>8&255,e.blue=255&t,e},_apply:function(t,e,n){var r=this,a=r.map;if(!r._isOn||!a&&!r._map)return t;var c,_,f,h,m,p,d,v,g,w,y,x,b,A,R,C,M,O,G,N,B,I,k,F,Y,X,T,E,L,z,S,W=r._map||{data:a.getData(),width:a.width,height:a.height},P=.00390625*r.scaleX,U=.00390625*r.scaleY,$=r.componentX,D=r.componentY,q=r.alpha,j=r.red,H=r.green,Q=r.blue,J=r.mode,K=s.IGNORE,V=(s.CLAMP,s.COLOR),Z=s.WRAP;for(c=W.data,_=W.width,f=W.height,h=c.length>>2,p=u(_,e),d=u(f,n),E=t.length,X=p*d<<2,T=E>>2,g=o(r.startX*(e-1)),v=o(r.startY*(n-1)),w=v*e,y=-g,x=-v,b=e-g-1,A=n-v-1,m=new l(h<<1),L=new i(t),C=0,M=0,O=0,G=0,R=0;h>R;R++,C+=2,M++)M>=_&&(M=0,O++,G+=_),k=M+G<<2,m[C]=o((c[k+$]-128)*P),m[C+1]=o((c[k+D]-128)*U);for(M=0,O=0,G=0,N=0,R=0;X>R;R+=4,M++)if(M>=p&&(M=0,O++,G+=e,N+=_),!(x>O||O>A||y>M||M>b)){if(I=M+g,B=O+v,F=I+G+w<<2,C=M+N<<1,z=I+m[C],S=B+m[C+1],S>=n||0>S||z>=e||0>z){if(J==K)continue;if(J==V){t[F]=j,t[F+1]=H,t[F+2]=Q,t[F+3]=q;continue}J==Z?(S>A?S-=n:0>S&&(S+=n),z>b?z-=e:0>z&&(z+=e)):(S>A?S=A:0>S&&(S=0),z>b?z=b:0>z&&(z=0))}Y=z+S*e<<2,t[F]=L[Y],t[F+1]=L[Y+1],t[F+2]=L[Y+2],t[F+3]=L[Y+3]}return t},canRun:function(){return this._isOn&&(this._map||this.map)}})}(e),!function(t,e){var r,i=t.ImArray,a=t.ImArrayCopy,s=t.Util.Array.typed,l=(t.CONST.PI,t.CONST.PI2,t.CONST.PI_2,t.MODE),u=(t.CONST.toRad,Math.sqrt),o=Math.atan2,c=(Math.atan,Math.sin),_=Math.cos,f=Math.floor,h=(Math.round,Math.asin),m=Math.tan,p=(Math.abs,Math.max,t.Util.Filter),d=p.generic_transform,v=p.affine_transform,g=p.cyclic_shift,w=p.flip_x,y=p.flip_y,x=p.flip_xy,b=t.GeometricMapFilter=t.Class(t.Filter,{name:"GeometricMapFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&e.generic(t)},path:n,_map:null,_mapName:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,dx:0,dy:0,angle:0,radius:0,wavelength:0,amplitude:0,phase:0,xAmplitude:0,yAmplitude:0,xWavelength:0,yWavelength:0,mode:l.CLAMP,dispose:function(){var t=this;return t.$super("dispose"),t._map=null,t._mapName=null,t.inverseTransform=null,t.matrix=null,t.centerX=null,t.centerY=null,t.dx=null,t.dy=null,t.angle=null,t.radius=null,t.wavelength=null,t.amplitude=null,t.phase=null,t.xAmplitude=null,t.yAmplitude=null,t.xWavelength=null,t.yWavelength=null,t.mode=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_mapName:t._mapName,inverseTransform:t.inverseTransform?t.inverseTransform.toString():null,matrix:t.matrix,centerX:t.centerX,centerY:t.centerY,dx:t.dx,dy:t.dy,angle:t.angle,radius:t.radius,wavelength:t.wavelength,amplitude:t.amplitude,phase:t.phase,xAmplitude:t.xAmplitude,yAmplitude:t.yAmplitude,xWavelength:t.xWavelength,yWavelength:t.yWavelength,mode:t.mode}}},unserialize:function(e){var n,i=this;return e&&i.name===e.filter&&(i._isOn=!!e._isOn,n=e.params,i.inverseTransform=null,i.matrix=s(n.matrix,Array),i.centerX=n.centerX,i.centerY=n.centerY,i.dx=n.dx,i.dy=n.dy,i.angle=n.angle,i.radius=n.radius,i.wavelength=n.wavelength,i.amplitude=n.amplitude,i.phase=n.phase,i.xAmplitude=n.xAmplitude,i.yAmplitude=n.yAmplitude,i.xWavelength=n.xWavelength,i.yWavelength=n.yWavelength,i.mode=n.mode,n.inverseTransform&&(i.inverseTransform=new Function("FILTER",'"use strict"; return '+n.inverseTransform)(t)),i._mapName=n._mapName,i._map=null,i._mapName&&r[i._mapName]&&(i._map=r[i._mapName])),i},generic:function(t){var e=this;return t&&(e.inverseTransform=t,e._mapName="generic",e._map=r.generic),e},affine:function(t){var e=this;return t&&(e.matrix=t,e._mapName="affine",e._map=r.affine),e},flipX:function(){var t=this;return t._mapName="flipX",t._map=r.flipX,t},flipY:function(){var t=this;return t._mapName="flipY",t._map=r.flipY,t},flipXY:function(){var t=this;return t._mapName="flipXY",t._map=r.flipXY,t},rotateCW:function(){var t=this;return t._mapName="rotateCW",t._map=r.rotateCW,t},rotateCCW:function(){var t=this;return t._mapName="rotateCCW",t._map=r.rotateCCW,t},polar:function(t,e){var n=this;return n.centerX=t||0,n.centerY=e||0,n._mapName=null,n._map=null,n},cartesian:function(t,e){var n=this;return n.centerX=t||0,n.centerY=e||0,n._mapName=null,n._map=null,n},twirl:function(t,e,n,i){var a=this;return a.angle=t||0,a.radius=e||0,a.centerX=n||0,a.centerY=i||0,a._mapName="twirl",a._map=r.twirl,a},sphere:function(t,e,n){var i=this;return i.radius=t||0,i.centerX=e||0,i.centerY=n||0,i._mapName="sphere",i._map=r.sphere,i},ripple:function(t,n,i,a,s,l){var u=this;return u.radius=t!==e?t:50,u.centerX=s||0,u.centerY=l||0,u.wavelength=n!==e?n:16,u.amplitude=i!==e?i:10,u.phase=a||0,u._mapName="ripple",u._map=r.ripple,u},shift:function(t,n){var i=this;return i.dx=t!==e?t:0,i.dy=n!==e?n:i.dx,i._mapName="shift",i._map=r.shift,i},reset:function(){var t=this;return t._mapName=null,t._map=null,t},getMap:function(){return this._map},setMap:function(t){var e=this;return e._mapName=null,e._map=t,e},_apply:function(t,e,n,r){var i=this;return i._isOn&&i._map?i._map(i,t,e,n,r):t},canRun:function(){return this._isOn&&this._map}});b.prototype.translate=b.prototype.shift,r={generic:function(t,e,n,r){return d(e,n,r,t.inverseTransform,t.mode)},affine:function(t,e,n,r){return v(e,n,r,t.matrix[0],t.matrix[1],t.matrix[3],t.matrix[4],t.matrix[2],t.matrix[5],t.mode)},shift:function(t,e,n,r){return g(e,n,r,-t.dx,-t.dy)},flipX:function(t,e,n,r){return w(e,n,r)},flipY:function(t,e,n,r){return y(e,n,r)},flipXY:function(t,e,n,r){return x(e,n,r)},rotateCW:function(t,e,n,r){var a,s,l,u,o,c=e.length,_=new i(c),f=c>>2;for(a=0,s=0,l=f-1,u=0;c>u;u+=4,a++,l-=n)a>=n&&(a=0,l=f-1,s++),o=s+l<<2,_[u]=e[o],_[u+1]=e[o+1],_[u+2]=e[o+2],_[u+3]=e[o+3];return _},rotateCCW:function(t,e,n,r){var a,s,l,u,o,c=e.length,_=new i(c);for(a=0,s=0,l=0,u=0;c>u;u+=4,a++,l+=n)a>=n&&(a=0,l=0,s++),o=n-1-s+l<<2,_[u]=e[o],_[u+1]=e[o+1],_[u+2]=e[o+2],_[u+3]=e[o+3];return _},twirl:function(t,e,n,r){if(0>=t.radius)return e;var i,s,h,m,p,d,v,g,w=e.length,y=new a(e),x=t.centerX,b=t.centerY,A=t.angle,R=t.radius,C=t.mode,M=(l.CLAMP,l.WRAP),O=A/R,G=n-1,N=r-1;for(x=f(x*(n-1)),b=f(b*(r-1)),i=0,s=0,h=0;w>h;h+=4,i++)i>=n&&(i=0,s++),d=i-x,v=s-b,p=u(d*d+v*v),R>p&&(g=o(v,d)+O*(R-p),d=~~(x+p*_(g)),v=~~(b+p*c(g)),(0>d||d>G||0>v||v>N)&&(M===C?(v>N?v-=r:0>v&&(v+=r),d>G?d-=n:0>d&&(d+=n)):(v>N?v=N:0>v&&(v=0),d>G?d=G:0>d&&(d=0))),m=d+v*n<<2,e[h]=y[m],e[h+1]=y[m+1],e[h+2]=y[m+2],e[h+3]=y[m+3]);return e},sphere:function(t,e,n,r){if(0>=t.radius)return e;var i,s,o,c,_,p,d,v,g,w,y,x,b,A=e.length,R=new a(e),C=t.centerX,M=t.centerY,O=t.radius,G=t.mode,N=(l.CLAMP,l.WRAP),B=O*O,I=.555556,k=1-I,F=n-1,Y=r-1;for(C=f(C*(n-1)),M=f(M*(r-1)),i=0,s=0,o=0;A>o;o+=4,i++)i>=n&&(i=0,s++),_=i-C,p=s-M,x=_*_,b=p*p,d=x+b,B>d&&(w=B-d,y=u(w),v=h(_/u(x+w))*k,g=h(p/u(b+w))*k,_=~~(i-y*m(v)),p=~~(s-y*m(g)),(0>_||_>F||0>p||p>Y)&&(N===G?(p>Y?p-=r:0>p&&(p+=r),_>F?_-=n:0>_&&(_+=n)):(p>Y?p=Y:0>p&&(p=0),_>F?_=F:0>_&&(_=0))),c=_+p*n<<2,e[o]=R[c],e[o+1]=R[c+1],e[o+2]=R[c+2],e[o+3]=R[c+3]);return e},ripple:function(t,e,n,r){if(0>=t.radius)return e;var i,s,o,_,h,m,p,d,v,g,w,y=e.length,x=new a(e),b=(l.CLAMP,l.WRAP),A=n-1,R=r-1,C=t.centerX,M=t.centerY,O=t.radius,G=t.mode,N=O*O,B=t.wavelength,I=t.amplitude,k=t.phase;for(C=f(C*(n-1)),M=f(M*(r-1)),i=0,s=0,o=0;y>o;o+=4,i++)i>=n&&(i=0,s++),m=i-C,p=s-M,g=m*m,w=p*p,v=g+w,N>v&&(h=u(v),d=I*c(h/B*Math.PI*2-k),d*=(O-h)/O,h&&(d*=B/h),m=~~(i+m*d),p=~~(s+p*d),(0>m||m>A||0>p||p>R)&&(b===G?(p>R?p-=r:0>p&&(p+=r),m>A?m-=n:0>m&&(m+=n)):(p>R?p=R:0>p&&(p=0),m>A?m=A:0>m&&(m=0))),_=m+p*n<<2,e[o]=x[_],e[o+1]=x[_+1],e[o+2]=x[_+2],e[o+3]=x[_+3]);return e}}}(e),!function(t,e){function r(t,e,n,r){var i,a=t.length,s=new p(t.length);for(n=n||1,r=r||1,i=0;a>i;)s[i]=n*t[i]+r*e[i],i++;return s}function i(t,e){var n,r,i,a=t.length,s=[],l=0;for(n=0;a>n;n++)for(r=0;a>r;r++)i=t[n]*e[r],l+=i,s.push(i);return{kernel:s,sum:l}}function a(t){var e,n=new Array(t);for(e=0;t>e;)n[e]=1,e++;return n}function s(t){var e,n,r,i,a=O.length;if(t--,a>t)e=new p(O[t]);else for(e=new p(O[a-1]);t>=a;){for(n=e,e=new p(n.length+1),e[0]=1,r=0,i=n.length-1;i>r;r++)e[r+1]=n[r]+n[r+1];e[n.length]=1,40>a&&O.push(new Array(e)),a++}return e}function l(t){var e,n=t>>1,r=-n,i=new Array(t);for(e=0;t>e;)i[e]=r,r++,e++;return i}function u(t){var e=s(t);return i(e,e)}function o(t,e){var n=s(t),r=l(t);return 1==e?i(r.reverse(),n):i(n,r)}function c(t,e){var n=a(t),r=l(t);return 1==e?i(r.reverse(),n):i(n,r)}function _(t,e,n){e=e||1,n=n||e;var r,i=t*t,a=i>>1,s=new p(i);for(r=0;i>r;)s[r]=e,r++;return s[a]=n,s}function f(t,e,n,r){var i,a,s,l,u,o=t*t,c=t>>1,_=o>>1,f=new p(o);for(l=0,i=0;c>=i;i++){for(a=0,u=0,s=0;c>=s;s++)f[_+i+a]=l+u,f[_-i-a]=-l-u,f[_-i+a]=-l+u,f[_+i-a]=l-u,a+=t,u+=n;l+=e}return f[_]=r||1,f}function h(t,e,n,r){var i,a,s,l,u,o,c=t*t,_=t>>1,f=c>>1,h=new p(c),m=new p(c),d=1/t,v=1e-8;for(A(e)>v?(u=1,o=n/e):(u=e/n,o=1),i=0,s=0,l=0,a=o*t;_>=i;)m[f+i]=~~(f+s+l+.5),m[f-i]=~~(f-s-l+.5),i++,s+=u,l+=a;for(i=0;_>=i;)h[m[f+i]]=h[m[f-i]]=d,i++;return h[f]=r||1,h}var m=t.Util.Filter,p=t.ConvolutionMatrix,d=t.ImArray,v=(t.Array32F,t.Array16I),g=(t.Array8U,m.integral_convolution),w=m.separable_convolution,y=t.Util.Array.typed,x=t._notSupportClamp,b=(t.CONST.SQRT2,t.CONST.toRad),A=(t.CONST.toDeg,Math.abs),R=Math.sqrt,C=Math.sin,M=Math.cos,O=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],G=t.ConvolutionMatrixFilter=t.Class(t.Filter,{name:"ConvolutionMatrixFilter",constructor:function(t,e,n,r){var i=this;i.$super("constructor"),i._coeff=new p([1,0]),t&&t.length?i.set(t,~~(R(t.length)+.5),e||1,n||0):(i._matrix=null,i._dim=0),i._matrix2=null,i._dim2=0,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,i._rgba=!!r},path:n,_dim:0,_dim2:0,_matrix:null,_matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_rgba:!1,_webglInstance:null,dispose:function(){var t=this;return t.$super("dispose"),t._webglInstance=null,t._dim=null,t._dim2=null,t._matrix=null,t._matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t._rgba=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_dim:t._dim,_dim2:t._dim2,_matrix:t._matrix,_matrix2:t._matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2,_rgba:t._rgba}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._dim2=e._dim2,n._matrix=y(e._matrix,p),n._matrix2=y(e._matrix2,p),n._mat=y(e._mat,p),n._mat2=y(e._mat2,p),n._coeff=y(e._coeff,p),n._isGrad=e._isGrad,n._doIntegral=e._doIntegral,n._doSeparable=e._doSeparable,n._indices=y(e._indices,v),n._indices2=y(e._indices2,v),n._indicesf=y(e._indicesf,v),n._indicesf2=y(e._indicesf2,v),n._rgba=e._rgba),n},rgba:function(t){var e=this;return arguments.length?(e._rgba=!!t,e):e._rgba},lowPass:function(t){return t=t===e?3:t%2?t:t+1,this.set(_(t),t,1/(t*t),0),this._doIntegral=1,this},highPass:function(t,n){t=t===e?3:t%2?t:t+1,n=n===e?1:n;var r=t*t,i=-n/r,a=_(t,i,1+i);return this.set(a,t,1,0),this._doIntegral=1,this},glow:function(t,n){return t=t===e?.5:t,this.highPass(n,-t)},sharpen:function(t,n){return t=t===e?.5:t,this.highPass(n,t)},verticalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(a(t),1,1/t,0),this._dim2=t,this._doIntegral=1,this},horizontalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(a(t),t,1/t,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(t,n){n=n===e?3:n%2?n:n+1,t*=b;
var r=M(t),i=-C(t),a=h(n,r,i,1/n);return this.set(a,n,1,0)},fastGauss:function(t,n){return n=n===e?3:n%2?n:n+1,t=~~(t||1),1>t?t=1:t>3&&(t=3),this.set(_(n),n,1/(n*n),0),this._doIntegral=t,this},binomialLowPass:function(t){t=t===e?3:t%2?t:t+1;var n=s(t),r=1<<t-1,i=1/r;this.set(n,t,i,i),this._matrix2=new p(n);var a=this._computeIndices(this._matrix2,this._dim2);return this._indices2=a[0],this._indicesf2=a[1],this._mat2=a[2],this._doSeparable=!0,this},binomialHighPass:function(t){t=t===e?3:t%2?t:t+1;var n=u(t);return this.set(r(_(t),new p(n.kernel),1,-1/n.sum),t,1,0)},prewittX:function(t){t=t===e?3:t%2?t:t+1;var n=c(t,0);return this.set(n.kernel,t,1,0)},prewittY:function(t){t=t===e?3:t%2?t:t+1;var n=c(t,1);return this.set(n.kernel,t,1,0)},prewittDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=b;var i=M(t),a=C(t),s=c(n,0),l=c(n,1);return this.set(r(new p(s.kernel),new p(l.kernel),i,a),n,1,0)},prewitt:function(t){t=t===e?3:t%2?t:t+1;var n=c(t,0),r=c(t,1);this.set(n.kernel,t,1,0),this._isGrad=!0,this._matrix2=new p(r.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this},sobelX:function(t){t=t===e?3:t%2?t:t+1;var n=o(t,0);return this.set(n.kernel,t,1,0)},sobelY:function(t){t=t===e?3:t%2?t:t+1;var n=o(t,1);return this.set(n.kernel,t,1,0)},sobelDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=b;var i=M(t),a=C(t),s=o(n,0),l=o(n,1);return this.set(r(new p(s.kernel),new p(l.kernel),i,a),n,1,0)},sobel:function(t){t=t===e?3:t%2?t:t+1;var n=o(t,0),r=o(t,1);this.set(n.kernel,t,1,0),this._matrix2=new p(r.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this._isGrad=!0,this},laplace:function(t){t=t===e?3:t%2?t:t+1;var n=t*t,r=_(t,-1,n-1);return this.set(r,t,1,0),this._doIntegral=1,this},emboss:function(t,n,r){r=r===e?3:r%2?r:r+1,t=t===e?-.25*Math.PI:t*b,n=n||1;var i=n*M(t),a=-n*C(t),s=f(r,i,a,1);return this.set(s,r,1,0)},edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,n,r){var i=this;i._matrix2=null,i._dim2=0,i._indices2=i._indicesf2=null,i._mat2=null,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,i._matrix=new p(t),i._dim=e,i._coeff[0]=n||1,i._coeff[1]=r||0;var a=i._computeIndices(i._matrix,i._dim);return i._indices=a[0],i._indicesf=a[1],i._mat=a[2],i},_computeIndices:function(t,e){var n,r,i,a=[],s=[],l=[],u=t.length,o=e,c=o>>1;for(r=0,i=0,n=0;u>n;)s.push(r-c),s.push(i-c),t[n]&&(a.push(r-c),a.push(i-c),l.push(t[n])),n++,r++,r>=o&&(r=0,i++);return[new v(a),new v(s),new p(l)]},reset:function(){var t=this;return t._matrix=t._matrix2=null,t._mat=t._mat2=null,t._dim=t._dim2=0,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t},combineWith:function(t){return this},getMatrix:function(){return this._matrix},setMatrix:function(t,e){return this.set(t,e)},_apply:function(t,e,n){var r=this,i=r._rgba;if(!r._isOn||!r._matrix)return t;if(r._doIntegral)return r._matrix2?g(i,t,e,n,r._matrix,r._matrix2,r._dim,r._dim2,r._coeff[0],r._coeff[1],r._doIntegral):g(i,t,e,n,r._matrix,null,r._dim,r._dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return w(i,t,e,n,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,s,l,u,o,c,_,f,h,m,p,y,b,R,C,M,O,G,N,B,I,k,F,Y,X=t.length,T=X>>2,E=new d(X),L=e-1,z=T-e,S=r._coeff[0],W=r._coeff[1],P=r._matrix,U=r._matrix2,$=r._isGrad;if(U){for(k=r._indicesf.length,Y=new v(r._indicesf),c=0;k>c;c+=2)Y[c+1]*=e;for(F=P.length,_=0,f=0,u=0;X>u;u+=4,_++){for(_>=e&&(_=0,f+=e),y=b=R=C=M=O=G=N=0,c=0,o=0;F>c;c++,o+=2)h=_+Y[o],m=f+Y[o+1],h>=0&&L>=h&&m>=0&&z>=m&&(p=h+m<<2,B=P[c],y+=t[p]*B,b+=t[p+1]*B,R+=t[p+2]*B,I=U[c],M+=t[p]*I,O+=t[p+1]*I,G+=t[p+2]*I);$?(a=A(y)+A(M),s=A(b)+A(O),l=A(R)+A(G)):(a=S*y+W*M,s=S*b+W*O,l=S*R+W*G),x&&(a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l),E[u]=~~a,E[u+1]=~~s,E[u+2]=~~l,E[u+3]=t[u+3]}}else{for(k=r._indices.length,Y=new v(r._indices),c=0;k>c;c+=2)Y[c+1]*=e;for(P=r._mat,F=P.length,_=0,f=0,u=0;X>u;u+=4,_++){for(_>=e&&(_=0,f+=e),y=b=R=C=0,c=0,o=0;F>c;c++,o+=2)h=_+Y[o],m=f+Y[o+1],h>=0&&L>=h&&m>=0&&z>=m&&(p=h+m<<2,B=P[c],y+=t[p]*B,b+=t[p+1]*B,R+=t[p+2]*B);a=S*y+W,s=S*b+W,l=S*R+W,x&&(a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l),E[u]=~~a,E[u+1]=~~s,E[u+2]=~~l,E[u+3]=t[u+3]}}return E},canRun:function(){return this._isOn&&this._matrix}});G.prototype.bump=G.prototype.emboss,G.prototype.boxBlur=G.prototype.lowPass,G.prototype.gaussBlur=G.prototype.binomialLowPass,G.prototype.gradX=G.prototype.prewittX,G.prototype.gradY=G.prototype.prewittY,G.prototype.gradDirectional=G.prototype.prewittDirectional,G.prototype.grad=G.prototype.prewitt}(e),!function(t,e){var r,i=t.ImArray,a=t.Array8U,s=t.Array32I,l=Math.sqrt,u=t.Util.Array.typed,o=function(t){var e,n=t*t,r=new a(n);for(e=0;n>e;e++)r[e]=1;return r},c=o(3);t.MorphologicalFilter=t.Class(t.Filter,{name:"MorphologicalFilter",constructor:function(){var t=this;t.$super("constructor"),t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null},path:n,_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var t=this;return t.$super("dispose"),t._filterName=null,t._filter=null,t._dim=null,t._structureElement=null,t._indices=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_structureElement:t._structureElement,_indices:t._indices}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._structureElement=u(e._structureElement,a),n._indices=u(e._indices,s),n._filterName=e._filterName,n._filterName&&r[n._filterName]&&(n._filter=r[n._filterName])),n},erode:function(t){return this.set(t,"erode")},dilate:function(t){return this.set(t,"dilate")},opening:function(t){return this.set(t,"open")},closing:function(t){return this.set(t,"close")},set:function(t,e){var n=this;n._filterName=e,n._filter=r[e],t&&t.length?(n._structureElement=new a(t),n._dim=~~(l(n._structureElement.length)+.5)):t&&t===t-0?(n._structureElement=o(t),n._dim=t):(n._structureElement=c,n._dim=3);var i,u,_,f=[],t=n._structureElement,h=t.length,m=n._dim,p=m>>1;for(u=0,_=0,i=0;h>i;)t[i]&&(f.push(u-p),f.push(_-p)),i++,u++,u>=m&&(u=0,_++);return n._indices=new s(f),n},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null,t},_apply:function(t,e,n){var r=this;return r._isOn&&r._dim&&r._filter?r._filter(r,t,e,n):t},canRun:function(){return this._isOn&&this._dim&&this._filter}});r={dilate:function(t,e,n,r){var a,l,u,o,c,_,f,h,m,p,d,v,g,w,y=t._structureElement,x=(y.length,t._dim,new s(t._indices)),b=e.length,A=b>>2,R=new i(b),C=x.length,M=C>>1,O=n-1,G=A-n;for(u=0;C>u;u+=2)x[u+1]*=n;for(o=0,c=0,a=0;b>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=0,g=0,w=0,l=0;M>l;l+=2)_=o+x[l],f=c+x[l+1],_>=0&&O>=_&&f>=0&&G>=f&&(h=_+f<<2,m=e[h],p=e[h+1],d=e[h+2],m>v&&(v=m),p>g&&(g=p),d>w&&(w=d));R[a]=v,R[a+1]=g,R[a+2]=w,R[a+3]=e[a+3]}return R},erode:function(t,e,n,r){var a,l,u,o,c,_,f,h,m,p,d,v,g,w,y=t._structureElement,x=(y.length,t._dim,new s(t._indices)),b=e.length,A=b>>2,R=new i(b),C=x.length,M=C>>1,O=n-1,G=A-n;for(u=0;C>u;u+=2)x[u+1]*=n;for(o=0,c=0,a=0;b>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,w=255,l=0;M>l;l+=2)_=o+x[l],f=c+x[l+1],_>=0&&O>=_&&f>=0&&G>=f&&(h=_+f<<2,m=e[h],p=e[h+1],d=e[h+2],v>m&&(v=m),g>p&&(g=p),w>d&&(w=d));R[a]=v,R[a+1]=g,R[a+2]=w,R[a+3]=e[a+3]}return R},open:function(t,e,n,r){var a,l,u,o,c,_,f,h,m,p,d,v,g,w,y=t._structureElement,x=(y.length,t._dim,new s(t._indices)),b=e.length,A=b>>2,R=new i(b),C=x.length,M=C>>1,O=n-1,G=A-n;for(u=0;C>u;u+=2)x[u+1]*=n;for(o=0,c=0,a=0;b>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,w=255,l=0;M>l;l+=2)_=o+x[l],f=c+x[l+1],_>=0&&O>=_&&f>=0&&G>=f&&(h=_+f<<2,m=e[h],p=e[h+1],d=e[h+2],v>m&&(v=m),g>p&&(g=p),w>d&&(w=d));R[a]=v,R[a+1]=g,R[a+2]=w,R[a+3]=e[a+3]}for(e=R,R=new i(b),o=0,c=0,a=0;b>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,w=255,l=0;M>l;l+=2)_=o+x[l],f=c+x[l+1],_>=0&&O>=_&&f>=0&&G>=f&&(h=_+f<<2,m=e[h],p=e[h+1],d=e[h+2],v>m&&(v=m),g>p&&(g=p),w>d&&(w=d));R[a]=v,R[a+1]=g,R[a+2]=w,R[a+3]=e[a+3]}return R},close:function(t,e,n,r){var a,l,u,o,c,_,f,h,m,p,d,v,g,w,y=t._structureElement,x=(y.length,t._dim,new s(t._indices)),b=e.length,A=b>>2,R=new i(b),C=x.length,M=C>>1,O=n-1,G=A-n;for(u=0;C>u;u+=2)x[u+1]*=n;for(o=0,c=0,a=0;b>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,w=255,l=0;M>l;l+=2)_=o+x[l],f=c+x[l+1],_>=0&&O>=_&&f>=0&&G>=f&&(h=_+f<<2,m=e[h],p=e[h+1],d=e[h+2],v>m&&(v=m),g>p&&(g=p),w>d&&(w=d));R[a]=v,R[a+1]=g,R[a+2]=w,R[a+3]=e[a+3]}for(e=R,R=new i(b),o=0,c=0,a=0;b>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,w=255,l=0;M>l;l+=2)_=o+x[l],f=c+x[l+1],_>=0&&O>=_&&f>=0&&G>=f&&(h=_+f<<2,m=e[h],p=e[h+1],d=e[h+2],v>m&&(v=m),g>p&&(g=p),w>d&&(w=d));R[a]=v,R[a+1]=g,R[a+2]=w,R[a+3]=e[a+3]}return R}}}(e),!function(t,e){var r,i=t.ImArray,a=t.Array32I,s=t.Util.Array.typed,l=(Math.min,Math.max,t.StatisticalFilter=t.Class(t.Filter,{name:"StatisticalFilter",constructor:function(){var t=this;t.$super("constructor"),t._dim=0,t._indices=null,t._filterName=null,t._filter=null},path:n,_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var t=this;return t.$super("dispose"),t._dim=null,t._indices=null,t._filter=null,t._filterName=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_indices:t._indices}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._indices=s(e._indices,a),n._filterName=e._filterName,n._filterName&&r[n._filterName]&&(n._filter=r[n._filterName])),n},median:function(t){return this.set(null==t?3:1&t?t:t+1,"median")},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,"minimum")},maximum:function(t){return this.set(null==t?3:1&t?t:t+1,"maximum")},set:function(t,e){var n=this;n._filterName=e,n._filter=r[e],n._dim=t;var i,s,l,u=[],o=t*t,c=t,_=c>>1;for(s=0,l=0,i=0;o>i;)u.push(s-_),u.push(l-_),i++,s++,s>=c&&(s=0,l++);return n._indices=new a(u),n},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._indices=null,t},_apply:function(t,e,n){var r=this;return r._isOn&&r._dim?r._filter(r,t,e,n):t},canRun:function(){return this._isOn&&this._dim}}));l.prototype.erode=l.prototype.minimum,l.prototype.dilate=l.prototype.maximum,r={median:function(t,e,n,r){var s,l,u,o,c,_,f,h,m,p,d,v,g,w,y,x,b,A,R=t._dim,C=R*R,M=new a(t._indices),O=e.length,G=O>>2,N=new i(O),B=C<<1,I=n-1,k=G-n;for(h=[],m=[],p=[],l=0;B>l;l+=2)M[l+1]*=n;for(s=0,u=0,o=0;O>s;){for(h.length=0,m.length=0,p.length=0,l=0;B>l;)c=u+M[l],_=o+M[l+1],c>=0&&I>=c&&_>=0&&k>=_&&(f=c+_<<2,d=e[f],v=e[f+1],g=e[f+2],h.push(d),m.push(v),p.push(g)),l+=2;h.sort(),m.sort(),p.sort(),b=h.length,A=b>>>1,w=1&b?h[A]:~~(.5*h[A-1]+.5*h[A]),y=1&b?m[A]:~~(.5*m[A-1]+.5*m[A]),x=1&b?p[A]:~~(.5*p[A-1]+.5*p[A]),N[s]=w,N[s+1]=y,N[s+2]=x,N[s+3]=e[s+3],s+=4,u++,u>=n&&(u=0,o+=n)}return N},maximum:function(t,e,n,r){var s,l,u,o,c,_,f,h,m,p,d,v,g,w=t._dim,y=w*w,x=new a(t._indices),b=e.length,A=b>>2,R=new i(b),C=y<<1,M=n-1,O=A-n;for(l=0;C>l;l+=2)x[l+1]*=n;for(s=0,u=0,o=0;b>s;){for(d=0,v=0,g=0,l=0;C>l;)c=u+x[l],_=o+x[l+1],c>=0&&M>=c&&_>=0&&O>=_&&(f=c+_<<2,h=e[f],m=e[f+1],p=e[f+2],h>d&&(d=h),m>v&&(v=m),p>g&&(g=p)),l+=2;R[s]=d,R[s+1]=v,R[s+2]=g,R[s+3]=e[s+3],s+=4,u++,u>=n&&(u=0,o+=n)}return R},minimum:function(t,e,n,r){var s,l,u,o,c,_,f,h,m,p,d,v,g,w=t._dim,y=w*w,x=new a(t._indices),b=e.length,A=b>>2,R=new i(b),C=y<<1,M=n-1,O=A-n;for(l=0;C>l;l+=2)x[l+1]*=n;for(s=0,u=0,o=0;b>s;){for(d=255,v=255,g=255,l=0;C>l;)c=u+x[l],_=o+x[l+1],c>=0&&M>=c&&_>=0&&O>=_&&(f=c+_<<2,h=e[f],m=e[f+1],p=e[f+2],d>h&&(d=h),v>m&&(v=m),g>p&&(g=p)),l+=2;R[s]=d,R[s+1]=v,R[s+2]=g,R[s+3]=e[s+3],s+=4,u++,u>=n&&(u=0,o+=n)}return R}}}(e),e});