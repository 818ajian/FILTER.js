/**
*
*   FILTER.js Generic Filters
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Generic Filters)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e){"use strict";"object"==typeof module&&module.exports?module.exports=e.call(t,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_FILTERS")?define("FILTER_FILTERS",["module","FILTER"],function(n,r){return e.moduleUri=n.uri,e.call(t,r),r}):(e.call(t,t.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return t.FILTER})}(this,function t(e){"use strict";var n=e.getPath(t.moduleUri);return!function(t,e){var r=(Object.prototype,Function.prototype,Array.prototype),i=r.slice,a=r.splice,l=r.concat,s=t.CompositeFilter=t.Class(t.Filter,{name:"CompositeFilter",constructor:function(t){var e=this;e.$super("constructor"),e._stack=t&&t.length?t.slice():[]},path:n,_stack:null,_meta:null,_stable:!0,dispose:function(t){var e,n=this,r=n._stack;if(n.$super("dispose"),!0===t)for(e=0;e<r.length;e++)r[e]&&r[e].dispose(t),r[e]=null;return n._stack=null,n._meta=null,n},serialize:function(){var t,e=this,n={filter:e.name,_isOn:!!e._isOn,_stable:!!e._stable,filters:[]},r=e._stack;for(t=0;t<r.length;t++)n.filters.push(r[t].serialize());return n},unserialize:function(e){var n,r,i,a,l,s=this,u=s._stack;if(e&&s.name===e.filter){if(s._isOn=!!e._isOn,s._stable=!!e._stable,a=e.filters||[],r=a.length,i=u.length,r===i&&s._stable)for(n=0;r>n;n++)u[n]=u[n].unserialize(a[n]);else{for(n=0;i>n;n++)u[n]&&u[n].dispose(!0),u[n]=null;for(u=[],n=0;r>n;n++){if(l=a[n]&&a[n].filter?t[a[n].filter]:null,!l)throw new Error('Filter "'+a[n].filter+'" could not be created');u.push((new l).unserialize(a[n]))}}s._stack=u}return s},getMeta:function(){return this._meta},setMeta:function(t){var e,n,r=this,i=r._stack;if(t&&(n=t.length)&&i.length)for(e=0;n>e;e++)i[t[e][0]].setMeta(t[e][1]);return r},stable:function(t){return arguments.length||(t=!0),this._stable=!!t,this},filters:function(t){return arguments.length?(this._stack=t.slice(),this):this._stack.slice()},push:function(){var t=i.call(arguments),e=t.length;return e&&(this._stack=l.apply(this._stack,t)),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){var t=i.call(arguments),e=t.length;return e&&a.apply(this._stack,[0,0].concat(t)),this},getAt:function(t){return this._stack.length>t?this._stack[t]:null},setAt:function(t,e){return this._stack.length>t?this._stack[t]=e:this._stack.push(e),this},insertAt:function(t){var e=i.call(arguments);e.length;return argslen>1&&(e.shift(),a.apply(this._stack,[t,0].concat(e))),this},removeAt:function(t){return this._stack.splice(t,1)},remove:function(t){for(var e=this._stack.length;--e>=0;)t===this._stack[e]&&this._stack.splice(e,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(t,e,n,r){var i=this,a=!1;if(i.hasMeta=!1,i._meta=[],i._isOn&&i._stack.length){var l,s,u=i._stack,o=u.length;for(l=0;o>l;l++)s=u[l],s&&s._isOn&&(t=s._apply(t,e,n,r),a=a||s._update,s.hasMeta&&i._meta.push([l,s.getMeta()]))}return i._update=a,i.hasMeta=i._meta.length>0,t},canRun:function(){return this._isOn&&this._stack.length},toString:function(){var t,e=arguments.length&&arguments[0].substr?arguments[0]:"  ",n=e+e,r=this._stack,i=[],a=r.length;for(t=0;a>t;t++)i.push(r[t].toString(n));return["[FILTER: "+this.name+"]","[","  "+i.join("\n  "),"]",""].join("\n")}});s.prototype.empty=s.prototype.reset,s.prototype.concat=s.prototype.push}(e),!function(t,e){var r="hasOwnProperty";t.InlineFilter=t.CustomFilter=t.Class(t.Filter,{name:"InlineFilter",constructor:function(t){var e=this;e.$super("constructor"),e._handler=t&&"function"==typeof t?t:null,e._params={}},path:n,_handler:null,_params:null,dispose:function(){var t=this;return t.$super("dispose"),t._handler=null,t._params=null,t},params:function(t){var e=this;if(arguments.length){for(var n in t)t[r](n)&&(e._params[n]=t[n]);return e}return e._params},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_handler:t._handler?t._handler.toString():null,_params:t._params}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r._handler=null,n._handler&&(r._handler=new Function("FILTER",'"use strict"; return '+n._handler+";")(t)),r._params=n._params||{}),r},_apply:function(t,e,n,r){var i=this;return i._isOn&&i._handler?i._handler(i,t,e,n,r):t},canRun:function(){return this._isOn&&this._handler}})}(e),!function(t,e){function r(t,e,n){var r=new a(20);return r[0]=t[0]+n*(e[0]-t[0]),r[1]=t[1]+n*(e[1]-t[1]),r[2]=t[2]+n*(e[2]-t[2]),r[3]=t[3]+n*(e[3]-t[3]),r[4]=t[4]+n*(e[4]-t[4]),r[5]=t[5]+n*(e[5]-t[5]),r[6]=t[6]+n*(e[6]-t[6]),r[7]=t[7]+n*(e[7]-t[7]),r[8]=t[8]+n*(e[8]-t[0]),r[9]=t[9]+n*(e[9]-t[9]),r[10]=t[10]+n*(e[10]-t[10]),r[11]=t[11]+n*(e[11]-t[11]),r[12]=t[12]+n*(e[12]-t[12]),r[13]=t[13]+n*(e[13]-t[13]),r[14]=t[14]+n*(e[14]-t[14]),r[15]=t[15]+n*(e[15]-t[15]),r[16]=t[16]+n*(e[16]-t[16]),r[17]=t[17]+n*(e[17]-t[17]),r[18]=t[18]+n*(e[18]-t[18]),r[19]=t[19]+n*(e[19]-t[19]),r}var i=t.CHANNEL,a=t.ColorMatrix,l=t.Array8U,s=(t.Util.Filter.cm_eye,t.Util.Filter.cm_multiply),u=t.Util.Filter.cm_rechannel,o=Math.sin,c=Math.cos,h=t.CONST.toRad,_=(t.CONST.toDeg,t.Util.Array.typed),f=t._notSupportClamp,m=t.ColorMatrixFilter=t.Class(t.Filter,{name:"ColorMatrixFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&t.length?e._matrix=new a(t):e._matrix=null},path:n,_matrix:null,_webglInstance:null,dispose:function(){var t=this;return t.$super("dispose"),t._webglInstance=null,t._matrix=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_matrix:t._matrix}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._matrix=_(e._matrix,a)),n},channel:function(t,e){t=t||0;var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],r=i.A===t||e?1:0;return n[5*i.R+t]=i.R===t?1:r,n[5*i.G+t]=i.G===t?1:r,n[5*i.B+t]=i.B===t?1:r,this.set(n)},redChannel:function(t){return this.channel(i.R,t)},greenChannel:function(t){return this.channel(i.G,t)},blueChannel:function(t){return this.channel(i.B,t)},alphaChannel:function(t){return this.channel(i.A,!0)},maskChannel:function(t){if(t=t||0,i.A===t)return this;var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return e[5*t+t]=0,this.set(e)},swapChannels:function(t,e){if(t===e)return this;var n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return n[5*t+t]=0,n[5*e+e]=0,n[5*t+e]=1,n[5*e+t]=1,this.set(n)},invertChannel:function(t){if(t=t||0,i.A===t)return this;var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return e[5*t+t]=-1,e[5*t+4]=255,this.set(e)},invertRed:function(){return this.invertChannel(i.R)},invertGreen:function(){return this.invertChannel(i.G)},invertBlue:function(){return this.invertChannel(i.B)},invertAlpha:function(){return this.invertChannel(i.A)},invert:function(){return this.set(u([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},desaturate:function(){var e=t.LUMA;return this.set(u([e[0],e[1],e[2],0,0,e[0],e[1],e[2],0,0,e[0],e[1],e[2],0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},saturate:function(e){var n,r,a,l,s=t.LUMA;return n=1-e,r=n*s[0],a=n*s[1],l=n*s[2],this.set(u([r+e,a,l,0,0,r,a+e,l,0,0,r,a,l+e,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},colorize:function(e,n){var r,a,l,s,o=t.LUMA;return null==n&&(n=1),r=.00392156862745098*(e>>16&255),a=.00392156862745098*(e>>8&255),l=.00392156862745098*(255&e),s=1-n,this.set(u([s+n*r*o[0],n*r*o[1],n*r*o[2],0,0,n*a*o[0],s+n*a*o[1],n*a*o[2],0,0,n*l*o[0],n*l*o[1],s+n*l*o[2],0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),t+=1,e+=1,n+=1,this.set(u([t,0,0,0,128*(1-t),0,e,0,0,128*(1-e),0,0,n,0,128*(1-n),0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},brightness:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(u([1,0,0,0,t,0,1,0,0,e,0,0,1,0,n,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},adjustHue:function(e){e*=h;var n=c(e),r=o(e),a=t.LUMA;return this.set(u([a[0]+n*(1-a[0])+r*-a[0],a[1]+n*-a[1]+r*-a[1],a[2]+n*-a[2]+r*(1-a[2]),0,0,a[0]+n*-a[0]+.143*r,a[1]+n*(1-a[1])+.14*r,a[2]+n*-a[2]+r*-.283,0,0,a[0]+n*-a[0]+r*-(1-a[0]),a[1]+n*-a[1]+r*a[1],a[2]+n*(1-a[2])+r*a[2],0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},average:function(t,e,n){return null==t&&(t=.3333),null==e&&(e=.3333),null==n&&(n=.3334),this.set(u([t,e,n,0,0,t,e,n,0,0,t,e,n,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},quickContrastCorrection:function(t){return null==t&&(t=1.2),this.set(u([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},sepia:function(t){return null==t&&(t=.5),t>1?t=1:0>t&&(t=0),this.set(u([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},sepia2:function(e){null==e&&(e=10),e>100&&(e=100),e*=2.55;var n=t.LUMA;return this.set(u([n[0],n[1],n[2],0,40,n[0],n[1],n[2],0,20,n[0],n[1],n[2],0,-e,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},threshold:function(e,n,r){null==n&&(n=256);var a=t.LUMA;return this.set(u(!1!==r?[a[0]*n,a[1]*n,a[2]*n,0,-(n-1)*e,a[0]*n,a[1]*n,a[2]*n,0,-(n-1)*e,a[0]*n,a[1]*n,a[2]*n,0,-(n-1)*e,0,0,0,1,0]:[n,0,0,0,-(n-1)*e,0,n,0,0,-(n-1)*e,0,0,n,0,-(n-1)*e,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},thresholdRGB:function(t,e){return this.threshold(t,e,!1)},thresholdChannel:function(e,n,r,a){null==r&&(r=256);var l=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],s=t.LUMA;return i.A===e?(l[5*e+e]=r,l[5*e+4]=-r*n):!1!==a?(l[5*e+i.R]=s[0]*r,l[5*e+i.G]=s[1]*r,l[5*e+i.B]=s[2]*r,l[5*e+4]=-(r-1)*n):(l[5*e+i.R]=r,l[5*e+i.G]=r,l[5*e+i.B]=r,l[5*e+4]=-(r-1)*n),this.set(l)},thresholdRed:function(t,e,n){return this.thresholdChannel(i.R,t,e,n)},thresholdGreen:function(t,e,n){return this.thresholdChannel(i.G,t,e,n)},thresholdBlue:function(t,e,n){return this.thresholdChannel(i.B,t,e,n)},thresholdAlpha:function(t,e,n){return this.thresholdChannel(i.A,t,e,n)},RGB2YCbCr:function(){return this.set(u([.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,.5,-.418688,-.081312,0,128,0,0,0,1,0],i.R,i.G,i.B,i.A,i.Y,i.CB,i.CR,i.A))},YCbCr2RGB:function(){return this.set(u([1,0,1.402,0,-179.456,1,-.34414,-.71414,0,135.45984,1,1.772,0,0,-226.816,0,0,0,1,0],i.Y,i.CB,i.CR,i.A,i.R,i.G,i.B,i.A))},blend:function(t,e){return this._matrix=this._matrix?r(this._matrix,t.getMatrix(),e):new a(t.getMatrix()),this},set:function(t){return this._matrix=this._matrix?s(this._matrix,new a(t)):new a(t),this},reset:function(){return this._matrix=null,this},combineWith:function(t){return this.set(t.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(t){return this._matrix=new a(t),this},_apply:f?function(t,e,n){var r=this,i=r._matrix;if(!r._isOn||!i)return t;var s,u=t.length,o=(u>>>2)%8,c=new a(32),h=new l(4),_=new a(4);for(s=0;u>s;s+=32)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],c[0]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[1]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[2]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[3]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+4],h[1]=t[s+5],h[2]=t[s+6],h[3]=t[s+7],c[4]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[5]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[6]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[7]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+8],h[1]=t[s+9],h[2]=t[s+10],h[3]=t[s+11],c[8]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[9]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[10]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[11]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+12],h[1]=t[s+13],h[2]=t[s+14],h[3]=t[s+15],c[12]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[13]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[14]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[15]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+16],h[1]=t[s+17],h[2]=t[s+18],h[3]=t[s+19],c[16]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[17]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[18]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[19]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+20],h[1]=t[s+21],h[2]=t[s+22],h[3]=t[s+23],c[20]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[21]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[22]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[23]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+24],h[1]=t[s+25],h[2]=t[s+26],h[3]=t[s+27],c[24]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[25]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[26]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[27]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+28],h[1]=t[s+29],h[2]=t[s+30],h[3]=t[s+31],c[28]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[29]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[30]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[31]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],c[0]=c[0]<0?0:c[0]>255?255:c[0],c[1]=c[1]<0?0:c[1]>255?255:c[1],c[2]=c[2]<0?0:c[2]>255?255:c[2],c[3]=c[3]<0?0:c[3]>255?255:c[3],c[4]=c[4]<0?0:c[4]>255?255:c[4],c[5]=c[5]<0?0:c[5]>255?255:c[5],c[6]=c[6]<0?0:c[6]>255?255:c[6],c[7]=c[7]<0?0:c[7]>255?255:c[7],c[8]=c[8]<0?0:c[8]>255?255:c[8],c[9]=c[9]<0?0:c[9]>255?255:c[9],c[10]=c[10]<0?0:c[10]>255?255:c[10],c[11]=c[11]<0?0:c[11]>255?255:c[11],c[12]=c[12]<0?0:c[12]>255?255:c[12],c[13]=c[13]<0?0:c[13]>255?255:c[13],c[14]=c[14]<0?0:c[14]>255?255:c[14],c[15]=c[15]<0?0:c[15]>255?255:c[15],c[16]=c[16]<0?0:c[16]>255?255:c[16],c[17]=c[17]<0?0:c[17]>255?255:c[17],c[18]=c[18]<0?0:c[18]>255?255:c[18],c[19]=c[19]<0?0:c[19]>255?255:c[19],c[20]=c[20]<0?0:c[20]>255?255:c[20],c[21]=c[21]<0?0:c[21]>255?255:c[21],c[22]=c[22]<0?0:c[22]>255?255:c[22],c[23]=c[23]<0?0:c[23]>255?255:c[23],c[24]=c[24]<0?0:c[24]>255?255:c[24],c[25]=c[25]<0?0:c[25]>255?255:c[25],c[26]=c[26]<0?0:c[26]>255?255:c[26],c[27]=c[27]<0?0:c[27]>255?255:c[27],c[28]=c[28]<0?0:c[28]>255?255:c[28],c[29]=c[29]<0?0:c[29]>255?255:c[29],c[30]=c[30]<0?0:c[30]>255?255:c[30],c[31]=c[31]<0?0:c[31]>255?255:c[31],t[s]=~~c[0],t[s+1]=~~c[1],t[s+2]=~~c[2],t[s+3]=~~c[3],t[s+4]=~~c[4],t[s+5]=~~c[5],t[s+6]=~~c[6],t[s+7]=~~c[7],t[s+8]=~~c[8],t[s+9]=~~c[9],t[s+10]=~~c[10],t[s+11]=~~c[11],t[s+12]=~~c[12],t[s+13]=~~c[13],t[s+14]=~~c[14],t[s+15]=~~c[15],t[s+16]=~~c[16],t[s+17]=~~c[17],t[s+18]=~~c[18],t[s+19]=~~c[19],t[s+20]=~~c[20],t[s+21]=~~c[21],t[s+22]=~~c[22],t[s+23]=~~c[23],t[s+24]=~~c[24],t[s+25]=~~c[25],t[s+26]=~~c[26],t[s+27]=~~c[27],t[s+28]=~~c[28],t[s+29]=~~c[29],t[s+30]=~~c[30],t[s+31]=~~c[31];if(o)for(s=u-(o<<2);u>s;s+=4)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],_[0]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],_[1]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],_[2]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],_[3]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],_[0]=_[0]<0?0:_[0]>255?255:_[0],_[1]=_[1]<0?0:_[1]>255?255:_[1],_[2]=_[2]<0?0:_[2]>255?255:_[2],_[3]=_[3]<0?0:_[3]>255?255:_[3],t[s]=~~_[0],t[s+1]=~~_[1],t[s+2]=~~_[2],t[s+3]=~~_[3];return t}:function(t,e,n){var r=this,i=r._matrix;if(!r._isOn||!i)return t;var s,u=t.length,o=(u>>>2)%8,c=new a(32),h=new l(4),_=new a(4);for(s=0;u>s;s+=32)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],c[0]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[1]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[2]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[3]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+4],h[1]=t[s+5],h[2]=t[s+6],h[3]=t[s+7],c[4]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[5]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[6]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[7]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+8],h[1]=t[s+9],h[2]=t[s+10],h[3]=t[s+11],c[8]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[9]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[10]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[11]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+12],h[1]=t[s+13],h[2]=t[s+14],h[3]=t[s+15],c[12]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[13]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[14]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[15]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+16],h[1]=t[s+17],h[2]=t[s+18],h[3]=t[s+19],c[16]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[17]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[18]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[19]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+20],h[1]=t[s+21],h[2]=t[s+22],h[3]=t[s+23],c[20]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[21]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[22]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[23]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+24],h[1]=t[s+25],h[2]=t[s+26],h[3]=t[s+27],c[24]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[25]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[26]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[27]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],h[0]=t[s+28],h[1]=t[s+29],h[2]=t[s+30],h[3]=t[s+31],c[28]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],c[29]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],c[30]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],c[31]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],t[s]=~~c[0],t[s+1]=~~c[1],t[s+2]=~~c[2],t[s+3]=~~c[3],t[s+4]=~~c[4],t[s+5]=~~c[5],t[s+6]=~~c[6],t[s+7]=~~c[7],t[s+8]=~~c[8],t[s+9]=~~c[9],t[s+10]=~~c[10],t[s+11]=~~c[11],t[s+12]=~~c[12],t[s+13]=~~c[13],t[s+14]=~~c[14],t[s+15]=~~c[15],t[s+16]=~~c[16],t[s+17]=~~c[17],t[s+18]=~~c[18],t[s+19]=~~c[19],t[s+20]=~~c[20],t[s+21]=~~c[21],t[s+22]=~~c[22],t[s+23]=~~c[23],t[s+24]=~~c[24],t[s+25]=~~c[25],t[s+26]=~~c[26],t[s+27]=~~c[27],t[s+28]=~~c[28],t[s+29]=~~c[29],t[s+30]=~~c[30],t[s+31]=~~c[31];if(o)for(s=u-(o<<2);u>s;s+=4)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],_[0]=i[0]*h[0]+i[1]*h[1]+i[2]*h[2]+i[3]*h[3]+i[4],_[1]=i[5]*h[0]+i[6]*h[1]+i[7]*h[2]+i[8]*h[3]+i[9],_[2]=i[10]*h[0]+i[11]*h[1]+i[12]*h[2]+i[13]*h[3]+i[14],_[3]=i[15]*h[0]+i[16]*h[1]+i[17]*h[2]+i[18]*h[3]+i[19],t[s]=~~_[0],t[s+1]=~~_[1],t[s+2]=~~_[2],t[s+3]=~~_[3];return t},canRun:function(){return this._isOn&&this._matrix}});m.prototype.grayscale=m.prototype.desaturate,m.prototype.rotateHue=m.prototype.adjustHue,m.prototype.threshold_rgb=m.prototype.thresholdRGB,m.prototype.threshold_alpha=m.prototype.thresholdAlpha,m.blend=r}(e),!function(t,e){var r=t.CHANNEL,i=t.ColorTable,a=t.Color.clampPixel,l=t.Util.Filter,s=l.ct_eye,u=l.ct_multiply,o=Math.pow,c=Math.exp,h=1/255,_=t.Util.Array.typed,f=t.TableLookupFilter=t.Class(t.Filter,{name:"TableLookupFilter",constructor:function(t,e,n,i){var a=this;a.$super("constructor"),a._table=[null,null,null,null],t=t||null,e=e||t,n=n||e,i=i||null,a._table[r.R]=t,a._table[r.G]=e,a._table[r.B]=n,a._table[r.A]=i},path:n,_table:null,dispose:function(){var t=this;return t.$super("dispose"),t._table=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_tableR:t._table[r.R],_tableG:t._table[r.G],_tableB:t._table[r.B],_tableA:t._table[r.A]}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._table[r.R]=_(e._tableR,i),n._table[r.G]=_(e._tableG,i),n._table[r.B]=_(e._tableB,i),n._table[r.A]=_(e._tableA,i)),n},channel:function(t){if(null==t)return this;var e,n,i;switch(t||r.R){case r.B:e=s(0,0),n=s(0,0),i=s();break;case r.G:e=s(0,0),n=s(),i=s(0,0);break;case r.R:default:e=s(),n=s(0,0),i=s(0,0)}return this.set(e,n,i)},redChannel:function(){return this.channel(r.R)},greenChannel:function(){return this.channel(r.G)},blueChannel:function(){return this.channel(r.B)},channelInvert:function(t){if(null==t)return this;var e,n,i;switch(t||r.R){case r.B:e=s(),n=s(),i=s(-1,255);break;case r.G:e=s(),n=s(-1,255),i=s();break;case r.R:default:e=s(-1,255),n=s(),i=s()}return this.set(e,n,i)},redInvert:function(){return this.channelInvert(r.R)},greenInvert:function(){return this.channelInvert(r.G)},blueInvert:function(){return this.channelInvert(r.B)},invert:function(){return this.set(s(-1,255))},thresholds:function(t,e,n){t.length||(t=[t]),e||(e=t),n||(n=e);var r,l,s=t.length,u=s+1,o=e.length,c=o+1,h=n.length,_=h+1,f=new i(256),m=new i(u),p=new i(256),d=new i(c),v=new i(256),g=new i(_),w=255/(u-1),y=255/(c-1),b=255/(_-1);for(r=0;u>r;)m[r]=~~(w*r),r++;for(t[0]=~~(255*t[0]),r=1;s>r;)t[r]=t[r-1]+~~(255*t[r]),r++;for(r=0;c>r;)d[r]=~~(y*r),r++;for(e[0]=~~(255*e[0]),r=1;o>r;)e[r]=e[r-1]+~~(255*e[r]),r++;for(r=0;_>r;)g[r]=~~(b*r),r++;for(n[0]=~~(255*n[0]),r=1;h>r;)n[r]=n[r-1]+~~(255*n[r]),r++;for(r=0;256>r;r++){for(l=0;s>l&&r>t[l];)l++;for(f[r]=a(m[l]),l=0;o>l&&r>e[l];)l++;for(p[r]=a(d[l]),l=0;h>l&&r>n[l];)l++;v[r]=a(g[l])}return this.set(f,p,v)},threshold:function(t,e,n){return t=null==t?.5:t,e=null==e?t:e,n=null==n?e:n,this.thresholds([t],[e],[n])},quantize:function(t){null==t&&(t=64),2>t&&(t=2);var e,n=new i(256),r=new i(t),l=255/(t-1),s=t/256;for(e=0;t>e;)r[e]=~~(l*e),e++;for(e=0;256>e;e++)n[e]=a(r[~~(s*e)]);return this.set(n)},binarize:function(){return this.quantize(2)},solarize:function(t,e){null==e&&(e=1),null==t&&(t=.5);var n,r,l,s=new i(256),u=2/255;if(-1===e)for(t*=256,n=0;256>n;n++)s[n]=n>t?255-n:n;else if(2===e)for(t=1-t,n=0;256>n;n++)r=u*n,l=t>r?255-255*r:255*r-255,s[n]=~~a(l);else for(n=0;256>n;n++)r=u*n,l=r>t?255-255*r:255*r-255,s[n]=~~a(l);return this.set(s)},solarize2:function(t){return this.solarize(t,2)},solarizeInverse:function(t){return this.solarize(t,-1)},mask:function(t){var e=0,n=new i(256),r=new i(256),l=new i(256),s=t>>>16&255,u=t>>>8&255,o=255&t;for(e=0;256>e;e++)n[e]=a(e&s),r[e]=a(e&u),l[e]=a(e&o);return this.set(n,r,l)},replace:function(t,e){if(t==e)return this;var n=t>>>16&255,r=t>>>8&255,i=255&t,a=e>>>16&255,l=e>>>8&255,u=255&e,o=s(),c=s(),h=s();return o[n]=a,c[r]=l,h[i]=u,this.set(o,c,h)},extract:function(t,e,n){if(!e||!e.length)return this;n=n||0;var i,l,u=n>>>16&255,o=n>>>8&255,c=255&n,h=s(0,u),_=s(0,o),f=s(0,c);switch(t||r.R){case r.B:for(i=e[0],l=e[1];l>=i;)f[i]=a(i),i++;break;case r.G:for(i=e[0],l=e[1];l>=i;)_[i]=a(i),i++;break;case r.R:default:for(i=e[0],l=e[1];l>=i;)h[i]=a(i),i++}return this.set(h,_,f)},gammaCorrection:function(t,e,n){t=t||1,e=e||t,n=n||e,t=1/t,e=1/e,n=1/n;var r=new i(256),l=new i(256),s=new i(256),u=0;for(u=0;256>u;u++)r[u]=a(~~(255*o(h*u,t))),l[u]=a(~~(255*o(h*u,e))),s[u]=a(~~(255*o(h*u,n)));return this.set(r,l,s)},exposure:function(t){null==t&&(t=1);var e=0,n=new i(256);for(e=0;256>e;e++)n[e]=a(~~(255*(1-c(-t*e*h))));return this.set(n)},set:function(t,e,n,i){if(!t)return this;var a,l,o=this._table,c=o[r.R]||s();return e||n?(e=e||t,n=n||e,a=o[r.G]||c,l=o[r.B]||a,o[r.R]=u(t,c),o[r.G]=u(e,a),o[r.B]=u(n,l)):(o[r.R]=u(t,c),o[r.G]=o[r.R],o[r.B]=o[r.R]),this},reset:function(){return this._table=[null,null,null,null],this},combineWith:function(t){return this.set(t.getTable(r.R),t.getTable(r.G),t.getTable(r.B))},getTable:function(t){return this._table[t||r.R]||null},setTable:function(t,e){return this._table[e||r.R]=t||null,this},_apply:function(t,e,n){var i=this,a=i._table;if(!i._isOn||!a||!a[r.R])return t;var l,s=t.length,u=(s>>>2)%16,o=a[0],c=a[1],h=a[2],_=a[3];if(_){for(l=0;s>l;l+=64)t[l]=o[t[l]],t[l+1]=c[t[l+1]],t[l+2]=h[t[l+2]],t[l+3]=_[t[l+3]],t[l+4]=o[t[l+4]],t[l+5]=c[t[l+5]],t[l+6]=h[t[l+6]],t[l+7]=_[t[l+7]],t[l+8]=o[t[l+8]],t[l+9]=c[t[l+9]],t[l+10]=h[t[l+10]],t[l+11]=_[t[l+11]],t[l+12]=o[t[l+12]],t[l+13]=c[t[l+13]],t[l+14]=h[t[l+14]],t[l+15]=_[t[l+15]],t[l+16]=o[t[l+16]],t[l+17]=c[t[l+17]],t[l+18]=h[t[l+18]],t[l+19]=_[t[l+19]],t[l+20]=o[t[l+20]],t[l+21]=c[t[l+21]],t[l+22]=h[t[l+22]],t[l+23]=_[t[l+23]],t[l+24]=o[t[l+24]],t[l+25]=c[t[l+25]],t[l+26]=h[t[l+26]],t[l+27]=_[t[l+27]],t[l+28]=o[t[l+28]],t[l+29]=c[t[l+29]],t[l+30]=h[t[l+30]],t[l+31]=_[t[l+31]],t[l+32]=o[t[l+32]],t[l+33]=c[t[l+33]],t[l+34]=h[t[l+34]],t[l+35]=_[t[l+35]],t[l+36]=o[t[l+36]],t[l+37]=c[t[l+37]],t[l+38]=h[t[l+38]],t[l+39]=_[t[l+39]],t[l+40]=o[t[l+40]],t[l+41]=c[t[l+41]],t[l+42]=h[t[l+42]],t[l+43]=_[t[l+43]],t[l+44]=o[t[l+44]],t[l+45]=c[t[l+45]],t[l+46]=h[t[l+46]],t[l+47]=_[t[l+47]],t[l+48]=o[t[l+48]],t[l+49]=c[t[l+49]],t[l+50]=h[t[l+50]],t[l+51]=_[t[l+51]],t[l+52]=o[t[l+52]],t[l+53]=c[t[l+53]],t[l+54]=h[t[l+54]],t[l+55]=_[t[l+55]],t[l+56]=o[t[l+56]],t[l+57]=c[t[l+57]],t[l+58]=h[t[l+58]],t[l+59]=_[t[l+59]],t[l+60]=o[t[l+60]],t[l+61]=c[t[l+61]],t[l+62]=h[t[l+62]],t[l+63]=_[t[l+63]];if(u){for(l=s-(u<<2);s>l;l+=4)t[l]=o[t[l]];t[l+1]=c[t[l+1]],t[l+2]=h[t[l+2]],t[l+3]=_[t[l+3]]}}else{for(l=0;s>l;l+=64)t[l]=o[t[l]],t[l+1]=c[t[l+1]],t[l+2]=h[t[l+2]],t[l+4]=o[t[l+4]],t[l+5]=c[t[l+5]],t[l+6]=h[t[l+6]],t[l+8]=o[t[l+8]],t[l+9]=c[t[l+9]],t[l+10]=h[t[l+10]],t[l+12]=o[t[l+12]],t[l+13]=c[t[l+13]],t[l+14]=h[t[l+14]],t[l+16]=o[t[l+16]],t[l+17]=c[t[l+17]],t[l+18]=h[t[l+18]],t[l+20]=o[t[l+20]],t[l+21]=c[t[l+21]],t[l+22]=h[t[l+22]],t[l+24]=o[t[l+24]],t[l+25]=c[t[l+25]],t[l+26]=h[t[l+26]],t[l+28]=o[t[l+28]],t[l+29]=c[t[l+29]],t[l+30]=h[t[l+30]],t[l+32]=o[t[l+32]],t[l+33]=c[t[l+33]],t[l+34]=h[t[l+34]],t[l+36]=o[t[l+36]],t[l+37]=c[t[l+37]],t[l+38]=h[t[l+38]],t[l+40]=o[t[l+40]],t[l+41]=c[t[l+41]],t[l+42]=h[t[l+42]],t[l+44]=o[t[l+44]],t[l+45]=c[t[l+45]],t[l+46]=h[t[l+46]],t[l+48]=o[t[l+48]],t[l+49]=c[t[l+49]],t[l+50]=h[t[l+50]],t[l+52]=o[t[l+52]],t[l+53]=c[t[l+53]],t[l+54]=h[t[l+54]],t[l+56]=o[t[l+56]],t[l+57]=c[t[l+57]],t[l+58]=h[t[l+58]],t[l+60]=o[t[l+60]],t[l+61]=c[t[l+61]],t[l+62]=h[t[l+62]];if(u){for(l=s-(u<<2);s>l;l+=4)t[l]=o[t[l]];t[l+1]=c[t[l+1]],t[l+2]=h[t[l+2]]}}return t},canRun:function(){return this._isOn&&this._table&&this._table[r.R]}});f.prototype.posterize=f.prototype.levels=f.prototype.quantize}(e),!function(t,e){var r=t.ImArray,i=t.ImArrayCopy,a=t.Util.Array.typed,l=t.MODE,s=t.Array16I,u=Math.min,o=(Math.max,Math.floor);t.DisplacementMapFilter=t.Class(t.Filter,{name:"DisplacementMapFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&e.setMap(t)},path:n,_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,red:0,green:0,blue:0,alpha:0,mode:l.CLAMP,dispose:function(){var t=this;return t.$super("dispose"),t._map=null,t.map=null,t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.red=null,t.green=null,t.blue=null,t.alpha=null,t.mode=null,t},serialize:function(){var t=this,e=t.map;return{filter:t.name,_isOn:!!t._isOn,params:{_map:t._map||(e?{data:e.getData(),width:e.width,height:e.height}:null),scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color,red:t.red,green:t.green,blue:t.blue,alpha:t.alpha,mode:t.mode}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n.map=null,n._map=e._map,n._map&&(n._map.data=a(n._map.data,r)),n.scaleX=e.scaleX,n.scaleY=e.scaleY,n.startX=e.startX,n.startY=e.startY,n.componentX=e.componentX,n.componentY=e.componentY,n.color=e.color,n.red=e.red,n.green=e.green,n.blue=e.blue,n.alpha=e.alpha,n.mode=e.mode),n},reset:function(){var t=this;return t._map=null,t.map=null,t},getMap:function(){return this.map},setMap:function(t){var e=this;return t&&(e.map=t,e._map=null),e},setColor:function(t){var e=this;return e.color=t,e.alpha=t>>24&255,e.red=t>>16&255,e.green=t>>8&255,e.blue=255&t,e},_apply:function(t,e,n){var r=this,a=r.map;if(!r._isOn||!a&&!r._map)return t;var c,h,_,f,m,p,d,v,g,w,y,b,x,A,R,C,M,O,G,I,N,B,k,F,Y,X,T,E,z,L,S,W=r._map||{data:a.getData(),width:a.width,height:a.height},P=.00390625*r.scaleX,U=.00390625*r.scaleY,$=r.componentX,D=r.componentY,q=r.alpha,j=r.red,H=r.green,Q=r.blue,J=r.mode,K=l.IGNORE,V=(l.CLAMP,l.COLOR),Z=l.WRAP;for(c=W.data,h=W.width,_=W.height,f=c.length>>2,p=u(h,e),d=u(_,n),E=t.length,X=p*d<<2,T=E>>2,g=o(r.startX*(e-1)),v=o(r.startY*(n-1)),w=v*e,y=-g,b=-v,x=e-g-1,A=n-v-1,m=new s(f<<1),z=new i(t),C=0,M=0,O=0,G=0,R=0;f>R;R++,C+=2,M++)M>=h&&(M=0,O++,G+=h),k=M+G<<2,m[C]=o((c[k+$]-128)*P),m[C+1]=o((c[k+D]-128)*U);for(M=0,O=0,G=0,I=0,R=0;X>R;R+=4,M++)if(M>=p&&(M=0,O++,G+=e,I+=h),!(b>O||O>A||y>M||M>x)){if(B=M+g,N=O+v,F=B+G+w<<2,C=M+I<<1,L=B+m[C],S=N+m[C+1],S>=n||0>S||L>=e||0>L){if(J==K)continue;if(J==V){t[F]=j,t[F+1]=H,t[F+2]=Q,t[F+3]=q;continue}J==Z?(S>A?S-=n:0>S&&(S+=n),L>x?L-=e:0>L&&(L+=e)):(S>A?S=A:0>S&&(S=0),L>x?L=x:0>L&&(L=0))}Y=L+S*e<<2,t[F]=z[Y],t[F+1]=z[Y+1],t[F+2]=z[Y+2],t[F+3]=z[Y+3]}return t},canRun:function(){return this._isOn&&(this._map||this.map)}})}(e),!function(t,e){var r,i=t.ImArray,a=t.ImArrayCopy,l=t.Util.Array.typed,s=(t.CONST.PI,t.CONST.PI2,t.CONST.PI_2,t.MODE),u=(t.CONST.toRad,Math.sqrt),o=Math.atan2,c=(Math.atan,Math.sin),h=Math.cos,_=Math.floor,f=(Math.round,Math.asin),m=Math.tan,p=(Math.abs,Math.max,t.Util.Filter),d=p.generic_transform,v=p.affine_transform,g=p.cyclic_shift,w=p.flip_x,y=p.flip_y,b=p.flip_xy,x=t.GeometricMapFilter=t.Class(t.Filter,{name:"GeometricMapFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&e.generic(t)},path:n,_map:null,_mapName:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,dx:0,dy:0,angle:0,radius:0,wavelength:0,amplitude:0,phase:0,xAmplitude:0,yAmplitude:0,xWavelength:0,yWavelength:0,mode:s.CLAMP,dispose:function(){var t=this;return t.$super("dispose"),t._map=null,t._mapName=null,t.inverseTransform=null,t.matrix=null,t.centerX=null,t.centerY=null,t.dx=null,t.dy=null,t.angle=null,t.radius=null,t.wavelength=null,t.amplitude=null,t.phase=null,t.xAmplitude=null,t.yAmplitude=null,t.xWavelength=null,t.yWavelength=null,t.mode=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_mapName:t._mapName,inverseTransform:t.inverseTransform?t.inverseTransform.toString():null,matrix:t.matrix,centerX:t.centerX,centerY:t.centerY,dx:t.dx,dy:t.dy,angle:t.angle,radius:t.radius,wavelength:t.wavelength,amplitude:t.amplitude,phase:t.phase,xAmplitude:t.xAmplitude,yAmplitude:t.yAmplitude,xWavelength:t.xWavelength,yWavelength:t.yWavelength,mode:t.mode}}},unserialize:function(e){var n,i=this;return e&&i.name===e.filter&&(i._isOn=!!e._isOn,n=e.params,i.inverseTransform=null,i.matrix=l(n.matrix,Array),i.centerX=n.centerX,i.centerY=n.centerY,i.dx=n.dx,i.dy=n.dy,i.angle=n.angle,i.radius=n.radius,i.wavelength=n.wavelength,i.amplitude=n.amplitude,i.phase=n.phase,i.xAmplitude=n.xAmplitude,i.yAmplitude=n.yAmplitude,i.xWavelength=n.xWavelength,i.yWavelength=n.yWavelength,i.mode=n.mode,n.inverseTransform&&(i.inverseTransform=new Function("FILTER",'"use strict"; return '+n.inverseTransform)(t)),i._mapName=n._mapName,i._map=null,i._mapName&&r[i._mapName]&&(i._map=r[i._mapName])),i},generic:function(t){var e=this;return t&&(e.inverseTransform=t,e._mapName="generic",e._map=r.generic),e},affine:function(t){var e=this;return t&&(e.matrix=t,e._mapName="affine",e._map=r.affine),e},flipX:function(){var t=this;return t._mapName="flipX",t._map=r.flipX,t},flipY:function(){var t=this;return t._mapName="flipY",t._map=r.flipY,t},flipXY:function(){var t=this;return t._mapName="flipXY",t._map=r.flipXY,t},rotateCW:function(){var t=this;return t._mapName="rotateCW",t._map=r.rotateCW,t},rotateCCW:function(){var t=this;return t._mapName="rotateCCW",t._map=r.rotateCCW,t},polar:function(t,e){var n=this;return n.centerX=t||0,n.centerY=e||0,n._mapName=null,n._map=null,n},cartesian:function(t,e){var n=this;return n.centerX=t||0,n.centerY=e||0,n._mapName=null,n._map=null,n},twirl:function(t,e,n,i){var a=this;return a.angle=t||0,a.radius=e||0,a.centerX=n||0,a.centerY=i||0,a._mapName="twirl",a._map=r.twirl,a},sphere:function(t,e,n){var i=this;return i.radius=t||0,i.centerX=e||0,i.centerY=n||0,i._mapName="sphere",i._map=r.sphere,i},ripple:function(t,n,i,a,l,s){var u=this;return u.radius=t!==e?t:50,u.centerX=l||0,u.centerY=s||0,u.wavelength=n!==e?n:16,u.amplitude=i!==e?i:10,u.phase=a||0,u._mapName="ripple",u._map=r.ripple,u},shift:function(t,n){var i=this;return i.dx=t!==e?t:0,i.dy=n!==e?n:i.dx,i._mapName="shift",i._map=r.shift,i},reset:function(){var t=this;return t._mapName=null,t._map=null,t},getMap:function(){return this._map},setMap:function(t){var e=this;return e._mapName=null,e._map=t,e},_apply:function(t,e,n,r){
var i=this;return i._isOn&&i._map?i._map(i,t,e,n,r):t},canRun:function(){return this._isOn&&this._map}});x.prototype.translate=x.prototype.shift,r={generic:function(t,e,n,r){return d(e,n,r,t.inverseTransform,t.mode)},affine:function(t,e,n,r){return v(e,n,r,t.matrix[0],t.matrix[1],t.matrix[3],t.matrix[4],t.matrix[2],t.matrix[5],t.mode)},shift:function(t,e,n,r){return g(e,n,r,-t.dx,-t.dy)},flipX:function(t,e,n,r){return w(e,n,r)},flipY:function(t,e,n,r){return y(e,n,r)},flipXY:function(t,e,n,r){return b(e,n,r)},rotateCW:function(t,e,n,r){var a,l,s,u,o,c=e.length,h=new i(c),_=c>>2;for(a=0,l=0,s=_-1,u=0;c>u;u+=4,a++,s-=n)a>=n&&(a=0,s=_-1,l++),o=l+s<<2,h[u]=e[o],h[u+1]=e[o+1],h[u+2]=e[o+2],h[u+3]=e[o+3];return h},rotateCCW:function(t,e,n,r){var a,l,s,u,o,c=e.length,h=new i(c);for(a=0,l=0,s=0,u=0;c>u;u+=4,a++,s+=n)a>=n&&(a=0,s=0,l++),o=n-1-l+s<<2,h[u]=e[o],h[u+1]=e[o+1],h[u+2]=e[o+2],h[u+3]=e[o+3];return h},twirl:function(t,e,n,r){if(0>=t.radius)return e;var i,l,f,m,p,d,v,g,w=e.length,y=new a(e),b=t.centerX,x=t.centerY,A=t.angle,R=t.radius,C=t.mode,M=(s.CLAMP,s.WRAP),O=A/R,G=n-1,I=r-1;for(b=_(b*(n-1)),x=_(x*(r-1)),i=0,l=0,f=0;w>f;f+=4,i++)i>=n&&(i=0,l++),d=i-b,v=l-x,p=u(d*d+v*v),R>p&&(g=o(v,d)+O*(R-p),d=~~(b+p*h(g)),v=~~(x+p*c(g)),(0>d||d>G||0>v||v>I)&&(M===C?(v>I?v-=r:0>v&&(v+=r),d>G?d-=n:0>d&&(d+=n)):(v>I?v=I:0>v&&(v=0),d>G?d=G:0>d&&(d=0))),m=d+v*n<<2,e[f]=y[m],e[f+1]=y[m+1],e[f+2]=y[m+2],e[f+3]=y[m+3]);return e},sphere:function(t,e,n,r){if(0>=t.radius)return e;var i,l,o,c,h,p,d,v,g,w,y,b,x,A=e.length,R=new a(e),C=t.centerX,M=t.centerY,O=t.radius,G=t.mode,I=(s.CLAMP,s.WRAP),N=O*O,B=.555556,k=1-B,F=n-1,Y=r-1;for(C=_(C*(n-1)),M=_(M*(r-1)),i=0,l=0,o=0;A>o;o+=4,i++)i>=n&&(i=0,l++),h=i-C,p=l-M,b=h*h,x=p*p,d=b+x,N>d&&(w=N-d,y=u(w),v=f(h/u(b+w))*k,g=f(p/u(x+w))*k,h=~~(i-y*m(v)),p=~~(l-y*m(g)),(0>h||h>F||0>p||p>Y)&&(I===G?(p>Y?p-=r:0>p&&(p+=r),h>F?h-=n:0>h&&(h+=n)):(p>Y?p=Y:0>p&&(p=0),h>F?h=F:0>h&&(h=0))),c=h+p*n<<2,e[o]=R[c],e[o+1]=R[c+1],e[o+2]=R[c+2],e[o+3]=R[c+3]);return e},ripple:function(t,e,n,r){if(0>=t.radius)return e;var i,l,o,h,f,m,p,d,v,g,w,y=e.length,b=new a(e),x=(s.CLAMP,s.WRAP),A=n-1,R=r-1,C=t.centerX,M=t.centerY,O=t.radius,G=t.mode,I=O*O,N=t.wavelength,B=t.amplitude,k=t.phase;for(C=_(C*(n-1)),M=_(M*(r-1)),i=0,l=0,o=0;y>o;o+=4,i++)i>=n&&(i=0,l++),m=i-C,p=l-M,g=m*m,w=p*p,v=g+w,I>v&&(f=u(v),d=B*c(f/N*Math.PI*2-k),d*=(O-f)/O,f&&(d*=N/f),m=~~(i+m*d),p=~~(l+p*d),(0>m||m>A||0>p||p>R)&&(x===G?(p>R?p-=r:0>p&&(p+=r),m>A?m-=n:0>m&&(m+=n)):(p>R?p=R:0>p&&(p=0),m>A?m=A:0>m&&(m=0))),h=m+p*n<<2,e[o]=b[h],e[o+1]=b[h+1],e[o+2]=b[h+2],e[o+3]=b[h+3]);return e}}}(e),!function(t,e){function r(t,e,n,r){var i,a=t.length,l=new p(t.length);for(n=n||1,r=r||1,i=0;a>i;)l[i]=n*t[i]+r*e[i],i++;return l}function i(t,e){var n,r,i,a=t.length,l=[],s=0;for(n=0;a>n;n++)for(r=0;a>r;r++)i=t[n]*e[r],s+=i,l.push(i);return{kernel:l,sum:s}}function a(t){var e,n=new Array(t);for(e=0;t>e;)n[e]=1,e++;return n}function l(t){var e,n,r,i,a=O.length;if(t--,a>t)e=new p(O[t]);else for(e=new p(O[a-1]);t>=a;){for(n=e,e=new p(n.length+1),e[0]=1,r=0,i=n.length-1;i>r;r++)e[r+1]=n[r]+n[r+1];e[n.length]=1,40>a&&O.push(new Array(e)),a++}return e}function s(t){var e,n=t>>1,r=-n,i=new Array(t);for(e=0;t>e;)i[e]=r,r++,e++;return i}function u(t){var e=l(t);return i(e,e)}function o(t,e){var n=l(t),r=s(t);return 1==e?i(r.reverse(),n):i(n,r)}function c(t,e){var n=a(t),r=s(t);return 1==e?i(r.reverse(),n):i(n,r)}function h(t,e,n){e=e||1,n=n||e;var r,i=t*t,a=i>>1,l=new p(i);for(r=0;i>r;)l[r]=e,r++;return l[a]=n,l}function _(t,e,n,r){var i,a,l,s,u,o=t*t,c=t>>1,h=o>>1,_=new p(o);for(s=0,i=0;c>=i;i++){for(a=0,u=0,l=0;c>=l;l++)_[h+i+a]=s+u,_[h-i-a]=-s-u,_[h-i+a]=-s+u,_[h+i-a]=s-u,a+=t,u+=n;s+=e}return _[h]=r||1,_}function f(t,e,n,r){var i,a,l,s,u,o,c=t*t,h=t>>1,_=c>>1,f=new p(c),m=new p(c),d=1/t,v=1e-8;for(A(e)>v?(u=1,o=n/e):(u=e/n,o=1),i=0,l=0,s=0,a=o*t;h>=i;)m[_+i]=~~(_+l+s+.5),m[_-i]=~~(_-l-s+.5),i++,l+=u,s+=a;for(i=0;h>=i;)f[m[_+i]]=f[m[_-i]]=d,i++;return f[_]=r||1,f}var m=t.Util.Filter,p=t.ConvolutionMatrix,d=t.ImArray,v=(t.Array32F,t.Array16I),g=(t.Array8U,m.integral_convolution),w=m.separable_convolution,y=t.Util.Array.typed,b=t._notSupportClamp,x=(t.CONST.SQRT2,t.CONST.toRad),A=(t.CONST.toDeg,Math.abs),R=Math.sqrt,C=Math.sin,M=Math.cos,O=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],G=t.ConvolutionMatrixFilter=t.Class(t.Filter,{name:"ConvolutionMatrixFilter",constructor:function(t,e,n,r){var i=this;i.$super("constructor"),i._coeff=new p([1,0]),t&&t.length?i.set(t,~~(R(t.length)+.5),e||1,n||0):(i._matrix=null,i._dim=0),i._matrix2=null,i._dim2=0,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,i._rgba=!!r},path:n,_dim:0,_dim2:0,_matrix:null,_matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_rgba:!1,_webglInstance:null,dispose:function(){var t=this;return t.$super("dispose"),t._webglInstance=null,t._dim=null,t._dim2=null,t._matrix=null,t._matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t._rgba=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_dim:t._dim,_dim2:t._dim2,_matrix:t._matrix,_matrix2:t._matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2,_rgba:t._rgba}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._dim2=e._dim2,n._matrix=y(e._matrix,p),n._matrix2=y(e._matrix2,p),n._mat=y(e._mat,p),n._mat2=y(e._mat2,p),n._coeff=y(e._coeff,p),n._isGrad=e._isGrad,n._doIntegral=e._doIntegral,n._doSeparable=e._doSeparable,n._indices=y(e._indices,v),n._indices2=y(e._indices2,v),n._indicesf=y(e._indicesf,v),n._indicesf2=y(e._indicesf2,v),n._rgba=e._rgba),n},rgba:function(t){var e=this;return arguments.length?(e._rgba=!!t,e):e._rgba},lowPass:function(t){return t=t===e?3:t%2?t:t+1,this.set(h(t),t,1/(t*t),0),this._doIntegral=1,this},highPass:function(t,n){t=t===e?3:t%2?t:t+1,n=n===e?1:n;var r=t*t,i=-n/r,a=h(t,i,1+i);return this.set(a,t,1,0),this._doIntegral=1,this},glow:function(t,n){return t=t===e?.5:t,this.highPass(n,-t)},sharpen:function(t,n){return t=t===e?.5:t,this.highPass(n,t)},verticalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(a(t),1,1/t,0),this._dim2=t,this._doIntegral=1,this},horizontalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(a(t),t,1/t,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(t,n){n=n===e?3:n%2?n:n+1,t*=x;var r=M(t),i=-C(t),a=f(n,r,i,1/n);return this.set(a,n,1,0)},fastGauss:function(t,n){return n=n===e?3:n%2?n:n+1,t=~~(t||1),1>t?t=1:t>3&&(t=3),this.set(h(n),n,1/(n*n),0),this._doIntegral=t,this},binomialLowPass:function(t){t=t===e?3:t%2?t:t+1;var n=l(t),r=1<<t-1,i=1/r;this.set(n,t,i,i),this._matrix2=new p(n);var a=this._computeIndices(this._matrix2,this._dim2);return this._indices2=a[0],this._indicesf2=a[1],this._mat2=a[2],this._doSeparable=!0,this},binomialHighPass:function(t){t=t===e?3:t%2?t:t+1;var n=u(t);return this.set(r(h(t),new p(n.kernel),1,-1/n.sum),t,1,0)},prewittX:function(t){t=t===e?3:t%2?t:t+1;var n=c(t,0);return this.set(n.kernel,t,1,0)},prewittY:function(t){t=t===e?3:t%2?t:t+1;var n=c(t,1);return this.set(n.kernel,t,1,0)},prewittDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=x;var i=M(t),a=C(t),l=c(n,0),s=c(n,1);return this.set(r(new p(l.kernel),new p(s.kernel),i,a),n,1,0)},prewitt:function(t){t=t===e?3:t%2?t:t+1;var n=c(t,0),r=c(t,1);this.set(n.kernel,t,1,0),this._isGrad=!0,this._matrix2=new p(r.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this},sobelX:function(t){t=t===e?3:t%2?t:t+1;var n=o(t,0);return this.set(n.kernel,t,1,0)},sobelY:function(t){t=t===e?3:t%2?t:t+1;var n=o(t,1);return this.set(n.kernel,t,1,0)},sobelDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=x;var i=M(t),a=C(t),l=o(n,0),s=o(n,1);return this.set(r(new p(l.kernel),new p(s.kernel),i,a),n,1,0)},sobel:function(t){t=t===e?3:t%2?t:t+1;var n=o(t,0),r=o(t,1);this.set(n.kernel,t,1,0),this._matrix2=new p(r.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this._isGrad=!0,this},laplace:function(t){t=t===e?3:t%2?t:t+1;var n=t*t,r=h(t,-1,n-1);return this.set(r,t,1,0),this._doIntegral=1,this},emboss:function(t,n,r){r=r===e?3:r%2?r:r+1,t=t===e?-.25*Math.PI:t*x,n=n||1;var i=n*M(t),a=-n*C(t),l=_(r,i,a,1);return this.set(l,r,1,0)},edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,n,r){var i=this;i._matrix2=null,i._dim2=0,i._indices2=i._indicesf2=null,i._mat2=null,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,i._matrix=new p(t),i._dim=e,i._coeff[0]=n||1,i._coeff[1]=r||0;var a=i._computeIndices(i._matrix,i._dim);return i._indices=a[0],i._indicesf=a[1],i._mat=a[2],i},_computeIndices:function(t,e){var n,r,i,a=[],l=[],s=[],u=t.length,o=e,c=o>>1;for(r=0,i=0,n=0;u>n;)l.push(r-c),l.push(i-c),t[n]&&(a.push(r-c),a.push(i-c),s.push(t[n])),n++,r++,r>=o&&(r=0,i++);return[new v(a),new v(l),new p(s)]},reset:function(){var t=this;return t._matrix=t._matrix2=null,t._mat=t._mat2=null,t._dim=t._dim2=0,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t},combineWith:function(t){return this},getMatrix:function(){return this._matrix},setMatrix:function(t,e){return this.set(t,e)},_apply:function(t,e,n){var r=this,i=r._rgba;if(!r._isOn||!r._matrix)return t;if(r._doIntegral)return r._matrix2?g(i,t,e,n,r._matrix,r._matrix2,r._dim,r._dim2,r._coeff[0],r._coeff[1],r._doIntegral):g(i,t,e,n,r._matrix,null,r._dim,r._dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return w(i,t,e,n,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,l,s,u,o,c,h,_,f,m,p,y,x,R,C,M,O,G,I,N,B,k,F,Y,X=t.length,T=X>>2,E=new d(X),z=e-1,L=T-e,S=r._coeff[0],W=r._coeff[1],P=r._matrix,U=r._matrix2,$=r._isGrad;if(U){for(k=r._indicesf.length,Y=new v(r._indicesf),c=0;k>c;c+=2)Y[c+1]*=e;for(F=P.length,h=0,_=0,u=0;X>u;u+=4,h++){for(h>=e&&(h=0,_+=e),y=x=R=C=M=O=G=I=0,c=0,o=0;F>c;c++,o+=2)f=h+Y[o],m=_+Y[o+1],f>=0&&z>=f&&m>=0&&L>=m&&(p=f+m<<2,N=P[c],y+=t[p]*N,x+=t[p+1]*N,R+=t[p+2]*N,B=U[c],M+=t[p]*B,O+=t[p+1]*B,G+=t[p+2]*B);$?(a=A(y)+A(M),l=A(x)+A(O),s=A(R)+A(G)):(a=S*y+W*M,l=S*x+W*O,s=S*R+W*G),b&&(a=0>a?0:a>255?255:a,l=0>l?0:l>255?255:l,s=0>s?0:s>255?255:s),E[u]=~~a,E[u+1]=~~l,E[u+2]=~~s,E[u+3]=t[u+3]}}else{for(k=r._indices.length,Y=new v(r._indices),c=0;k>c;c+=2)Y[c+1]*=e;for(P=r._mat,F=P.length,h=0,_=0,u=0;X>u;u+=4,h++){for(h>=e&&(h=0,_+=e),y=x=R=C=0,c=0,o=0;F>c;c++,o+=2)f=h+Y[o],m=_+Y[o+1],f>=0&&z>=f&&m>=0&&L>=m&&(p=f+m<<2,N=P[c],y+=t[p]*N,x+=t[p+1]*N,R+=t[p+2]*N);a=S*y+W,l=S*x+W,s=S*R+W,b&&(a=0>a?0:a>255?255:a,l=0>l?0:l>255?255:l,s=0>s?0:s>255?255:s),E[u]=~~a,E[u+1]=~~l,E[u+2]=~~s,E[u+3]=t[u+3]}}return E},canRun:function(){return this._isOn&&this._matrix}});G.prototype.bump=G.prototype.emboss,G.prototype.boxBlur=G.prototype.lowPass,G.prototype.gaussBlur=G.prototype.binomialLowPass,G.prototype.gradX=G.prototype.prewittX,G.prototype.gradY=G.prototype.prewittY,G.prototype.gradDirectional=G.prototype.prewittDirectional,G.prototype.grad=G.prototype.prewitt}(e),!function(t,e){var r,i=t.ImArray,a=t.Array8U,l=t.Array32I,s=Math.sqrt,u=t.Util.Array.typed,o=function(t){var e,n=t*t,r=new a(n);for(e=0;n>e;e++)r[e]=1;return r},c=o(3);t.MorphologicalFilter=t.Class(t.Filter,{name:"MorphologicalFilter",constructor:function(){var t=this;t.$super("constructor"),t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null},path:n,_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var t=this;return t.$super("dispose"),t._filterName=null,t._filter=null,t._dim=null,t._structureElement=null,t._indices=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_structureElement:t._structureElement,_indices:t._indices}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._structureElement=u(e._structureElement,a),n._indices=u(e._indices,l),n._filterName=e._filterName,n._filterName&&r[n._filterName]&&(n._filter=r[n._filterName])),n},erode:function(t){return this.set(t,"erode")},dilate:function(t){return this.set(t,"dilate")},opening:function(t){return this.set(t,"open")},closing:function(t){return this.set(t,"close")},set:function(t,e){var n=this;n._filterName=e,n._filter=r[e],t&&t.length?(n._structureElement=new a(t),n._dim=~~(s(n._structureElement.length)+.5)):t&&t===t-0?(n._structureElement=o(t),n._dim=t):(n._structureElement=c,n._dim=3);var i,u,h,_=[],t=n._structureElement,f=t.length,m=n._dim,p=m>>1;for(u=0,h=0,i=0;f>i;)t[i]&&(_.push(u-p),_.push(h-p)),i++,u++,u>=m&&(u=0,h++);return n._indices=new l(_),n},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null,t},_apply:function(t,e,n){var r=this;return r._isOn&&r._dim&&r._filter?r._filter(r,t,e,n):t},canRun:function(){return this._isOn&&this._dim&&this._filter}});r={dilate:function(t,e,n,r){var a,s,u,o,c,h,_,f,m,p,d,v,g,w,y=t._structureElement,b=(y.length,t._dim,new l(t._indices)),x=e.length,A=x>>2,R=new i(x),C=b.length,M=C>>1,O=n-1,G=A-n;for(u=0;C>u;u+=2)b[u+1]*=n;for(o=0,c=0,a=0;x>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=0,g=0,w=0,s=0;M>s;s+=2)h=o+b[s],_=c+b[s+1],h>=0&&O>=h&&_>=0&&G>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],m>v&&(v=m),p>g&&(g=p),d>w&&(w=d));R[a]=v,R[a+1]=g,R[a+2]=w,R[a+3]=e[a+3]}return R},erode:function(t,e,n,r){var a,s,u,o,c,h,_,f,m,p,d,v,g,w,y=t._structureElement,b=(y.length,t._dim,new l(t._indices)),x=e.length,A=x>>2,R=new i(x),C=b.length,M=C>>1,O=n-1,G=A-n;for(u=0;C>u;u+=2)b[u+1]*=n;for(o=0,c=0,a=0;x>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,w=255,s=0;M>s;s+=2)h=o+b[s],_=c+b[s+1],h>=0&&O>=h&&_>=0&&G>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),w>d&&(w=d));R[a]=v,R[a+1]=g,R[a+2]=w,R[a+3]=e[a+3]}return R},open:function(t,e,n,r){var a,s,u,o,c,h,_,f,m,p,d,v,g,w,y=t._structureElement,b=(y.length,t._dim,new l(t._indices)),x=e.length,A=x>>2,R=new i(x),C=b.length,M=C>>1,O=n-1,G=A-n;for(u=0;C>u;u+=2)b[u+1]*=n;for(o=0,c=0,a=0;x>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,w=255,s=0;M>s;s+=2)h=o+b[s],_=c+b[s+1],h>=0&&O>=h&&_>=0&&G>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),w>d&&(w=d));R[a]=v,R[a+1]=g,R[a+2]=w,R[a+3]=e[a+3]}for(e=R,R=new i(x),o=0,c=0,a=0;x>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,w=255,s=0;M>s;s+=2)h=o+b[s],_=c+b[s+1],h>=0&&O>=h&&_>=0&&G>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),w>d&&(w=d));R[a]=v,R[a+1]=g,R[a+2]=w,R[a+3]=e[a+3]}return R},close:function(t,e,n,r){var a,s,u,o,c,h,_,f,m,p,d,v,g,w,y=t._structureElement,b=(y.length,t._dim,new l(t._indices)),x=e.length,A=x>>2,R=new i(x),C=b.length,M=C>>1,O=n-1,G=A-n;for(u=0;C>u;u+=2)b[u+1]*=n;for(o=0,c=0,a=0;x>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,w=255,s=0;M>s;s+=2)h=o+b[s],_=c+b[s+1],h>=0&&O>=h&&_>=0&&G>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),w>d&&(w=d));R[a]=v,R[a+1]=g,R[a+2]=w,R[a+3]=e[a+3]}for(e=R,R=new i(x),o=0,c=0,a=0;x>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,w=255,s=0;M>s;s+=2)h=o+b[s],_=c+b[s+1],h>=0&&O>=h&&_>=0&&G>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),w>d&&(w=d));R[a]=v,R[a+1]=g,R[a+2]=w,R[a+3]=e[a+3]}return R}}}(e),!function(t,e){var r,i=t.ImArray,a=t.Array32I,l=t.Util.Array.typed,s=(Math.min,Math.max,t.StatisticalFilter=t.Class(t.Filter,{name:"StatisticalFilter",constructor:function(){var t=this;t.$super("constructor"),t._dim=0,t._indices=null,t._filterName=null,t._filter=null},path:n,_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var t=this;return t.$super("dispose"),t._dim=null,t._indices=null,t._filter=null,t._filterName=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_indices:t._indices}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._indices=l(e._indices,a),n._filterName=e._filterName,n._filterName&&r[n._filterName]&&(n._filter=r[n._filterName])),n},median:function(t){return this.set(null==t?3:1&t?t:t+1,"median")},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,"minimum")},maximum:function(t){return this.set(null==t?3:1&t?t:t+1,"maximum")},set:function(t,e){var n=this;n._filterName=e,n._filter=r[e],n._dim=t;var i,l,s,u=[],o=t*t,c=t,h=c>>1;for(l=0,s=0,i=0;o>i;)u.push(l-h),u.push(s-h),i++,l++,l>=c&&(l=0,s++);return n._indices=new a(u),n},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._indices=null,t},_apply:function(t,e,n){var r=this;return r._isOn&&r._dim?r._filter(r,t,e,n):t},canRun:function(){return this._isOn&&this._dim}}));s.prototype.erode=s.prototype.minimum,s.prototype.dilate=s.prototype.maximum,r={median:function(t,e,n,r){var l,s,u,o,c,h,_,f,m,p,d,v,g,w,y,b,x,A,R=t._dim,C=R*R,M=new a(t._indices),O=e.length,G=O>>2,I=new i(O),N=C<<1,B=n-1,k=G-n;for(f=[],m=[],p=[],s=0;N>s;s+=2)M[s+1]*=n;for(l=0,u=0,o=0;O>l;){for(f.length=0,m.length=0,p.length=0,s=0;N>s;)c=u+M[s],h=o+M[s+1],c>=0&&B>=c&&h>=0&&k>=h&&(_=c+h<<2,d=e[_],v=e[_+1],g=e[_+2],f.push(d),m.push(v),p.push(g)),s+=2;f.sort(),m.sort(),p.sort(),x=f.length,A=x>>>1,w=1&x?f[A]:~~(.5*f[A-1]+.5*f[A]),y=1&x?m[A]:~~(.5*m[A-1]+.5*m[A]),b=1&x?p[A]:~~(.5*p[A-1]+.5*p[A]),I[l]=w,I[l+1]=y,I[l+2]=b,I[l+3]=e[l+3],l+=4,u++,u>=n&&(u=0,o+=n)}return I},maximum:function(t,e,n,r){var l,s,u,o,c,h,_,f,m,p,d,v,g,w=t._dim,y=w*w,b=new a(t._indices),x=e.length,A=x>>2,R=new i(x),C=y<<1,M=n-1,O=A-n;for(s=0;C>s;s+=2)b[s+1]*=n;for(l=0,u=0,o=0;x>l;){for(d=0,v=0,g=0,s=0;C>s;)c=u+b[s],h=o+b[s+1],c>=0&&M>=c&&h>=0&&O>=h&&(_=c+h<<2,f=e[_],m=e[_+1],p=e[_+2],f>d&&(d=f),m>v&&(v=m),p>g&&(g=p)),s+=2;R[l]=d,R[l+1]=v,R[l+2]=g,R[l+3]=e[l+3],l+=4,u++,u>=n&&(u=0,o+=n)}return R},minimum:function(t,e,n,r){var l,s,u,o,c,h,_,f,m,p,d,v,g,w=t._dim,y=w*w,b=new a(t._indices),x=e.length,A=x>>2,R=new i(x),C=y<<1,M=n-1,O=A-n;for(s=0;C>s;s+=2)b[s+1]*=n;for(l=0,u=0,o=0;x>l;){for(d=255,v=255,g=255,s=0;C>s;)c=u+b[s],h=o+b[s+1],c>=0&&M>=c&&h>=0&&O>=h&&(_=c+h<<2,f=e[_],m=e[_+1],p=e[_+2],d>f&&(d=f),v>m&&(v=m),g>p&&(g=p)),s+=2;R[l]=d,R[l+1]=v,R[l+2]=g,R[l+3]=e[l+3],l+=4,u++,u>=n&&(u=0,o+=n)}return R}}}(e),e});