/**
*
*   FILTER.js
*   @version: 0.9.5
*   @built on 2016-07-28 14:21:27
*   @dependencies: Classy.js, Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n){"use strict";function r(e,t,n,r){return e?t.map(function(t,a){return(n?e[a]:e[t])||(r?r(t):null)}):[]}var a="Classy,Asynchronous".split(/\s*,\s*/);"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[t]=n.apply(e,r(module.$deps,a,!1,function(e){return require("./"+e.toLowerCase())}))):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["module"].concat(a),function(t){return n.moduleUri=t.uri,n.apply(e,r(Array.prototype.slice.call(arguments,1),a,!0))}):t in e||(e[t]=n.apply(e,r(e,a)))&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}(this,"FILTER",function e(t,n){"use strict";var r=t.Merge({Classy:t,Asynchronous:n,Path:n.path(e.moduleUri)},t);return r.VERSION="0.9.5",!function(e,t,n){var r,a,i="prototype",o=(Object[i],Function[i],Array[i]),s=t.Path,l=t.Merge,u=t.Asynchronous,h=u.isPlatform(u.Platform.NODE),c=u.isPlatform(u.Platform.BROWSER),f=u.supportsMultiThreading(),d=u.isThread(null,!0),g=u.isThread(),p="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",m="undefined"!=typeof navigator&&navigator.platform?navigator.platform:"",v="undefined"!=typeof navigator&&navigator.vendor?navigator.vendor:"",_=function(){return"[FILTER Plugin: "+this.name+"]"},y=function(e,t,n,r){return e},w=function(){},C=function(e){return function(){this.$super("constructor"),e.apply(this,arguments)}},R=(t.devicePixelRatio=(c&&!g?window.devicePixelRatio:1)||1,t._notSupportClamp="undefined"==typeof Uint8ClampedArray),I="undefined"==typeof Int16Array||"function"!=typeof Int16Array[i].set,b=0,A=t.Browser={isNode:h,isBrowser:c,isWorker:d,isInsideWorker:g,supportsWorker:f,isPhantom:/PhantomJS/.test(p),isOpera:c&&/Opera|OPR\//.test(p),isFirefox:c&&/Firefox\//.test(p),isChrome:c&&/Chrome\//.test(p),isSafari:c&&/Apple Computer/.test(v),isKhtml:c&&/KHTML\//.test(p),isIE:c&&(/MSIE \d/.test(p)||/Trident\/\d/.test(p)),isGecko:c&&/gecko\/\d/i.test(p),isWebkit:c&&/WebKit\//.test(p),isMac_geLion:c&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(p),isMac_geMountainLion:c&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(p),isMobile:!1,isIOS:/AppleWebKit/.test(p)&&/Mobile\/\w+/.test(p),isWin:/windows/i.test(m),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1};A.isMobile=A.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(p),A.isMac=A.isIOS||/Mac/.test(m),A.isIE_lt8=A.isIE&&!g&&(null==document.documentMode||document.documentMode<8),A.isIE_lt9=A.isIE&&!g&&(null==document.documentMode||document.documentMode<9),A.isQtWebkit=A.isWebkit&&/Qt\/\d+\.\d+/.test(p),t.getPath=u.path,t.uuid=function(e){return[e||"filter",(new Date).getTime(),++b].join("_")},t.Array=Array,t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,t.ImArray=R?t.Array8U:Uint8ClampedArray,t.ImArrayCopy=A.isOpera?t.Array8U:t.ImArray,t.ColorTable=t.ImArrayCopy,t.ColorMatrix=t.Array32F,t.ConvolutionMatrix=t.Array32F,t.CHANNEL={R:0,G:1,B:2,A:3,RED:0,GREEN:1,BLUE:2,ALPHA:3,Y:1,CB:2,CR:0,H:0,S:1,V:2,I:2,HUE:0,SATURATION:1,INTENSITY:2},t.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:3,TILE:4,STRETCH:5,INTENSITY:6,HUE:7,SATURATION:8,GRAY:9,RGB:10,HSV:11},t.LUMA=new t.Array32F([.212671,.71516,.072169]),t.FORMAT={IMAGE:1024,DATA:2048,PNG:2,JPG:3,JPEG:4,GIF:5,BMP:6,TGA:7,RGBE:8},t.MIME={PNG:"image/png",JPG:"image/jpeg",JPEG:"image/jpeg",GIF:"image/gif",BMP:"image/bmp"},t.CONSTANTS=t.CONST={X:0,Y:1,Z:2,PI:Math.PI,PI2:2*Math.PI,PI_2:Math.PI/2,toRad:Math.PI/180,toDeg:180/Math.PI,SQRT2:Math.SQRT2,LN2:Math.LN2},t.IO={},t.Codec={},t.Interpolation={},t.Transform={},t.MachineLearning=t.ML={},t.Util={Math:{},Array:{arrayset:I?function(e,t,n){n=n||0;for(var r=0,a=t.length;a>r;r++)e[r+n]=t[r]}:function(e,t,n){e.set(t,n||0)},subarray:t.Array32F[i].subarray?function(e,t,n){return e.subarray(t,n)}:function(e,t,n){return e.slice(t,n)},typed:r=h?function(e,t){return null==e||e instanceof t?e:Array.isArray(e)?Array===t?e:new t(e):(null==e.length&&(e.length=Object.keys(e).length),Array===t?Array.prototype.slice.call(e):new t(Array.prototype.slice.call(e)))}:function(e,t){return e},typed_obj:h?function(e,t){return null==e?e:t?JSON.parse(e):JSON.stringify(e)}:function(e){return e}},String:{},IO:{},Filter:{},Image:{}},R=t._notSupportClamp=R||A.isOpera,t.NotImplemented=function(e){return e=e||"",function(){throw new Error("Method "+e+" not Implemented!")}},t.useWebGL=!1,t.useWebGLSharedResources=!1,t.useWebGLIfAvailable=function(e){},t.useWebGLSharedResourcesIfAvailable=function(e){},a=t.log=d?u.log:"undefine"!=typeof console&&console.log?function(e){console.log(e)}:function(e){},t.warning=function(e){a("WARNING: "+e)},t.error=function(e,t){if(a("ERROR: "+e),t)throw new Error(e)};var x=t.FilterThread=t.Class(u,{path:s,name:null,_listener:null,constructor:function(){var e=this,n=null;d&&e.initThread().listen("load",function(e){e&&e.filter&&(n&&(n.dispose(!0),n=null),n=u.load("FILTER."+e.filter))}).listen("import",function(e){e&&e["import"]&&e["import"].length&&u.importScripts(e["import"].join?e["import"].join(","):e["import"])}).listen("params",function(e){n&&n.unserialize(e)}).listen("apply",function(a){if(n&&a&&a.im){a.params&&n.unserialize(a.params);var i=r(a.im[0],t.ImArray);i=n._apply(i,a.im[1],a.im[2]),e.send("apply",{im:n._update?i:!1,meta:n.hasMeta?n.getMeta():null})}else e.send("apply",{im:null})}).listen("dispose",function(t){n&&(n.dispose(!0),n=null),e.dispose(!0)})},dispose:function(e){var t=this;return t.path=null,t.name=null,t._listener&&(t._listener.cb=null,t._listener=null),t.$super("dispose",e),t},thread:function(e,t){var n=this;return arguments.length||(e=!0),e=!!e,e&&!n.$thread?(n.fork("FILTER.FilterThread",s.file!==n.path.file?[s.file,n.path.file]:n.path.file),t&&t.length&&n.send("import",{"import":t.join?t.join(","):t}),n.send("load",{filter:n.name}),n.listen("apply",n._listener=function r(e){r.cb&&r.cb(e)})):!e&&n.$thread&&(n._listener.cb=null,n._listener=null,n.unfork()),n},sources:function(){if(!arguments.length)return this;var e=arguments[0]instanceof Array?arguments[0]:o.slice.call(arguments);if(e.length){var t,n=[];for(t=0;t<e.length;t++)"function"==typeof e[t]?n.push(u.blob(e[t].toString())):n.push(u.blob(e[t]));this.send("import",{"import":n.join(",")})}return this},scripts:function(){if(!arguments.length)return this;var e=arguments[0]instanceof Array?arguments[0]:o.slice.call(arguments);return e.length&&this.send("import",{"import":e.join(",")}),this}}),S=t.Filter=t.Class(x,{name:"Filter",constructor:function(){},id:null,_isOn:!0,_update:!0,_onComplete:null,hasMeta:!1,dispose:function(){var e=this;return e.$super("dispose"),e.name=null,e.id=null,e._isOn=null,e._update=null,e._onComplete=null,e.hasMeta=null,e},worker:x[i].thread,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{}}},unserialize:function(e){var t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn),t},complete:function(e){return this._onComplete=e||null,this},isOn:function(){return this._isOn},update:function(e){return arguments.length||(e=!0),this._update=!!e,this},turnOn:function(e){return arguments.length||(e=!0),this._isOn=!!e,this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this},canRun:function(){return this._isOn},getMeta:function(){},setMeta:function(e){return this},combineWith:function(e){return this},_apply:function(e,t,n,r){return e},apply:function(e,n,a){var i,o,s=this;return s.canRun()?(arguments.length<3&&(n&&n.setSelectedData?a=null:"function"==typeof n?(a=n,n=e):(n=e,a=null)),e&&n&&(a=a||s._onComplete,i=e.getSelectedData(),s.$thread?(s._listener.cb=function(e){s._listener.cb=null,e&&(e.meta&&s.setMeta(e.meta),e.im&&n.setSelectedData(r(e.im,t.ImArray))),a&&a.call(s)},s.send("apply",{im:i,params:s.serialize()})):(o=s._apply(i[0],i[1],i[2],e),s._update&&n.setSelectedData(o),a&&a.call(s))),e):e},toString:function(){return"[FILTER: "+this.name+"]"}});t.Create=function(e){e=l({init:w,name:"PluginFilter",toString:_,apply:y},e),e.constructor=C(e.init),e._apply=e.apply,delete e.init,delete e.apply;var n=e.name;return t[n]=t.Class(S,e)}}(this,r),!function(e,t){function n(e,t,n){return e>n?n:t>e?t:e}function r(e){return $(2,V(le(e)))}function a(e,t){var n=new H(2);return n[0]=e||0,n[1]=t||0,n}function i(e,t,n){var r=new H(3);return r[0]=e||0,r[1]=t||0,r[2]=n||0,r}function o(e,t,n){return a(e[0]+n*(t[0]-e[0]),e[1]+n*(t[1]-e[1]))}function s(e,t,n){return i(e[0]+n*(t[0]-e[0]),e[1]+n*(t[1]-e[1]),e[2]+n*(t[2]-e[2]))}function l(e,t){return e[0]*t[1]-t[0]*e[1]}function u(e,t){var n;return 0>e&&(e=-e),0>t&&(t=-t),0===e?t:0===t?e:e>t?(n=t/e,e*q(1+n*n)):(n=e/t,t*q(1+n*n))}function h(e,t){var n,r,i,o,s;return n=a(e[0]-t[0],e[1]-t[1]),0===n[1]&&0===n[0]?null:(r=a(0,0),0===n[0]&&(r[0]=10),0===n[1]&&(r[1]=10),0!==n[1]&&0!==n[0]&&(i=n[1]/n[0],o=-n[0]/n[1],r[0]=10,r[1]=o*r[0]),s=u(r[0],r[1]),r[0]/=s,r[1]/=s,0>l(n,r)&&(r[0]=-r[0],r[1]=-r[1]),r)}function c(e,t,n,r,a,i,o){i=Z(i,t-1),o=Z(o,n-1);var s,l,u,h,c=i-r+1,f=o-a+1,d=c*f<<2,g=new G(d),p=c<<2;for(s=a,l=a*t,u=0;o>=s;s++,l+=t,u+=p)h=l+r<<2,ue(g,he(e,h,h+p),u);return g}function f(e,t,n,r,a,i,o){r=r||0,a=a||0,i=i||0,o=o||0;var s,l,u,h,c=t+i+r,f=n+o+a,d=c*f<<2,g=new G(d),p=t<<2,m=c<<2,v=o*m,_=i<<2;for(s=0,l=0,u=v;n>s;s++,l+=t,u+=m)h=l<<2,ue(g,he(e,h,h+p),_+u);return g}function d(e,t,n,r,a,i,o,s){if(r=Z(r,t-1),a=Z(a,n-1),i=Z(i,t-1),o=Z(o,n-1),0===r&&0===a&&t===i+1&&n===o+1)return!0===s?e:new U(e);if(!e.length||r>i||a>o)return new G(0);var l,u,h,c,f=i-r+1,d=o-a+1,g=f*d<<2,p=new G(g);for(l=r,u=a,h=0;o>=u;h+=4,l++)l>i&&(l=r,u++),c=u*t+l<<2,p[h]=e[c],p[h+1]=e[c+1],p[h+2]=e[c+2],p[h+3]=e[c+3];return p}function g(e,t,n,r,a,i,o,s,l,u,h,c){var f,d,g,p;if(!(e.length&&r.length&&a&&i&&t&&n))return e;for(o=Z(o,a-1),s=Z(s,i-1),h=Z(h,t-1),c=Z(c,n-1),l=Z(l,a-1),u=Z(u,i-1),h-=o,c-=s,g=o,p=s;u>=p;g++)g>l&&(g=o,p++),p+c>=n||g+h>=t||(f=p*a+g<<2,d=(p+c)*t+g+h<<2,e[d]=r[f],e[d+1]=r[f+1],e[d+2]=r[f+2],e[d+3]=r[f+3]);return e}function p(e,t,n,r,a,i,o,s){if(a=Z(a,t-1),i=Z(i,n-1),o=Z(o,t-1),s=Z(s,n-1),!e.length||a>o||i>s)return e;var l,u,h,c=255&r[0],f=255&r[1],d=255&r[2],g=3<r.length?255&r[3]:255;for(l=a,u=i;s>=u;l++)l>o&&(l=a,u++),h=u*t+l<<2,e[h]=c,e[h+1]=f,e[h+2]=d,e[h+3]=g;return e}function m(e,t,n,r,a){var i,o,s,l,u,h,c,f=e.length,d=new G(f),g=ce.CLAMP,p=ce.WRAP;for(a=a||g,i=0,o=0,s=0;f>s;s+=4,i++)i>=t&&(i=0,o++),u=r([i,o],t,n),h=~~u[0],c=~~u[1],(0>h||h>=t||0>c||c>=n)&&(p===a?(c>=n?c-=n:0>c&&(c+=n),h>=t?h-=t:0>h&&(h+=t)):(c>=n?c=n-1:0>c&&(c=0),h>=t?h=t-1:0>h&&(h=0))),l=h+c*t<<2,d[s]=e[l],d[s+1]=e[l+1],d[s+2]=e[l+2],d[s+3]=e[l+3];return d}function v(e,t,n,r,a,i,o,s,l,u){var h,c,f,d,g,p,m,v,_,y=e.length,w=y>>>2,C=new G(y),R=ce.CLAMP,I=ce.WRAP,b=t-1,A=w-t;for(u=u||R,h=0,c=0,g=l*t,p=i*t,m=o*t,f=0;y>f;f+=4,h++)h>=t&&(h=0,c++),v=~~(r*h+a*c+s),_=~~(p*h+m*c+g),(0>v||v>b||0>_||_>A)&&(I===u?(_>A?_-=w:0>_&&(_+=w),v>=t?v-=t:0>v&&(v+=t)):(_>A?_=A:0>_&&(_=0),v>b?v=b:0>v&&(v=0))),d=v+_<<2,C[f]=e[d],C[f+1]=e[d+1],C[f+2]=e[d+2],C[f+3]=e[d+3];return C}function _(e,t,n,r,a){var i,o,s,l,u,h=e.length,c=new G(h);for(0>r&&(r+=t),0>a&&(a+=n),i=0,o=0,s=0,l=0;h>l;l+=4,i++)i>=t&&(i=0,o++,s+=t),u=(i+r)%t+(o+a)%n*t<<2,c[l]=e[u],c[l+1]=e[u+1],c[l+2]=e[u+2],c[l+3]=e[u+3];return c}function y(e,t,n){var r,a,i,o,s,l=e.length,u=new G(l);for(r=0,a=0,i=0,o=0;l>o;o+=4,r++)r>=t&&(r=0,a++,i+=t),s=t-1-r+i<<2,u[o]=e[s],u[o+1]=e[s+1],u[o+2]=e[s+2],u[o+3]=e[s+3];return u}function w(e,t,n){var r,a,i,o,s,l=e.length,u=new G(l);for(r=0,a=0,i=(n-1)*t,o=0;l>o;o+=4,r++)r>=t&&(r=0,a++,i-=t),s=r+i<<2,u[o]=e[s],u[o+1]=e[s+1],u[o+2]=e[s+2],u[o+3]=e[s+3];return u}function C(e,t,n){var r,a,i,o,s,l,u=e.length,h=new G(u);for(r=0,a=0,o=(n-1)*t,s=0;u>s;s+=4,r++)r>=t&&(r=0,a++,i+=t,o-=t),l=t-1-r+o<<2,h[s]=e[l],h[s+1]=e[l+1],h[s+2]=e[l+2],h[s+3]=e[l+3];return h}function R(e,t,n,r){var a,i,o,s,l,u=t<<2,h=e.length,c=h>>2;for(r=r||0,a=new H(c),l=0,s=0,o=0,i=0;t>l;l++,o+=4,s++)i+=e[o+r],a[s]=i;for(l=0,s=0,i=0,o=u;h>o;o+=4,s++,l++)l>=t&&(l=0,i=0),i+=e[o+r],a[s+t]=a[s]+i;return a}function I(e,t,n,r){var a,i,o,s=e.length,l=1/(s>>2);for(r=r||0,i=new H(256),a=0;s>a;a+=4)i[e[a+r]]+=l;for(o=0,a=0;256>a;a+=32)o+=i[a],i[a]=o,o+=i[a+1],i[a+1]=o,o+=i[a+2],i[a+2]=o,o+=i[a+3],i[a+3]=o,o+=i[a+4],i[a+4]=o,o+=i[a+5],i[a+5]=o,o+=i[a+6],i[a+6]=o,o+=i[a+7],i[a+7]=o,o+=i[a+8],i[a+8]=o,o+=i[a+9],i[a+9]=o,o+=i[a+10],i[a+10]=o,o+=i[a+11],i[a+11]=o,o+=i[a+12],i[a+12]=o,o+=i[a+13],i[a+13]=o,o+=i[a+14],i[a+14]=o,o+=i[a+15],i[a+15]=o,o+=i[a+16],i[a+16]=o,o+=i[a+17],i[a+17]=o,o+=i[a+18],i[a+18]=o,o+=i[a+19],i[a+19]=o,o+=i[a+20],i[a+20]=o,o+=i[a+21],i[a+21]=o,o+=i[a+22],i[a+22]=o,o+=i[a+23],i[a+23]=o,o+=i[a+24],i[a+24]=o,o+=i[a+25],i[a+25]=o,o+=i[a+26],i[a+26]=o,o+=i[a+27],i[a+27]=o,o+=i[a+28],i[a+28]=o,o+=i[a+29],i[a+29]=o,o+=i[a+30],i[a+30]=o,o+=i[a+31],i[a+31]=o;return i}function b(e,t,n,r){return null}function A(e,t,n,r,a,i,o,s,l,u,h){var c,f,d,g,p,m,v,_,y,w,C,R,I,b,A,x,S,M,D,E,k,O,P,L,T,F,U,B,N,W,j,X,K,Y,q,$,V,J,z,Q,Z,ee,te,ne,re,ae,ie,oe,se=t.length,le=se>>2,ue=o,he=s;if(_=ue*he,m=ue>>1,v=n*(he>>1),C=-m-1,I=-v-n,R=m,b=v,W=0,X=n-1,j=0,K=le-n,f=(le<<1)+le,w=(n<<1)+n,y=t,t=new G(se),c=new H(f),h=h||1,i)for(E=a[0],k=a[_>>1],O=k-E,P=i[0],L=i[_>>1],T=L-P,ie=0;h>ie;ie++){for(oe=t,t=y,y=oe,A=0,x=0,d=g=p=0,S=0;n>S;S++,A+=4,x+=3)d+=t[A],g+=t[A+1],p+=t[A+2],c[x]=d,c[x+1]=g,c[x+2]=p;for(x=0,S=0,d=g=p=0,A=w+n;se>A;A+=4,x+=3,S++)S>=n&&(S=0,d=g=p=0),d+=t[A],g+=t[A+1],p+=t[A+2],c[x+w]=c[x]+d,c[x+w+1]=c[x+1]+g,c[x+w+2]=c[x+2]+p;for(S=0,M=0,D=0,A=0;se>A;A+=4,S++)S>=n&&(S=0,M++,D+=n),F=S+C,U=D+I,B=S+R,N=D+b,F=W>F?W:F,B=B>X?X:B,U=j>U?j:U,N=N>K?K:N,Y=F+U,V=B+N,q=B+U,$=F+N,Y=(Y<<1)+Y,q=(q<<1)+q,$=($<<1)+$,V=(V<<1)+V,Z=E*(c[V]-c[q]-c[$]+c[Y])+O*t[A],ee=E*(c[V+1]-c[q+1]-c[$+1]+c[Y+1])+O*t[A+1],te=E*(c[V+2]-c[q+2]-c[$+2]+c[Y+2])+O*t[A+2],ne=P*(c[V]-c[q]-c[$]+c[Y])+T*t[A],re=P*(c[V+1]-c[q+1]-c[$+1]+c[Y+1])+T*t[A+1],ae=P*(c[V+2]-c[q+2]-c[$+2]+c[Y+2])+T*t[A+2],J=l*Z+u*ne,z=l*ee+u*re,Q=l*te+u*ae,fe&&(J=0>J?0:J>255?255:J,z=0>z?0:z>255?255:z,Q=0>Q?0:Q>255?255:Q),y[A]=~~J,y[A+1]=~~z,y[A+2]=~~Q,y[A+3]=t[A+3]}else for(E=a[0],k=a[_>>1],O=k-E,ie=0;h>ie;ie++){for(oe=t,t=y,y=oe,A=0,x=0,d=g=p=0,S=0;n>S;S++,A+=4,x+=3)d+=t[A],g+=t[A+1],p+=t[A+2],c[x]=d,c[x+1]=g,c[x+2]=p;for(x=0,S=0,d=g=p=0,A=w+n;se>A;A+=4,x+=3,S++)S>=n&&(S=0,d=g=p=0),d+=t[A],g+=t[A+1],p+=t[A+2],c[x+w]=c[x]+d,c[x+w+1]=c[x+1]+g,c[x+w+2]=c[x+2]+p;for(S=0,M=0,D=0,A=0;se>A;A+=4,S++)S>=n&&(S=0,M++,D+=n),F=S+C,U=D+I,B=S+R,N=D+b,F=W>F?W:F,B=B>X?X:B,U=j>U?j:U,N=N>K?K:N,Y=F+U,V=B+N,q=B+U,$=F+N,Y=(Y<<1)+Y,q=(q<<1)+q,$=($<<1)+$,V=(V<<1)+V,Z=E*(c[V]-c[q]-c[$]+c[Y])+O*t[A],ee=E*(c[V+1]-c[q+1]-c[$+1]+c[Y+1])+O*t[A+1],te=E*(c[V+2]-c[q+2]-c[$+2]+c[Y+2])+O*t[A+2],J=l*Z+u,z=l*ee+u,Q=l*te+u,fe&&(J=0>J?0:J>255?255:J,z=0>z?0:z>255?255:z,Q=0>Q?0:Q>255?255:Q),y[A]=~~J,y[A+1]=~~z,y[A+2]=~~Q,y[A+3]=t[A+3]}return y}function x(e,t,n,r,a,i,o,s,l,u){var h,c,f,d,g,p,m,v,_,y,w,C,R,I,b,A,x,S,M,D,E,k,O,P,L,T,F,U,H=t.length,N=H>>2;for(A=n-1,x=N-n,m=new B(o),w=0,d=o.length;d>w;w+=2)m[w+1]*=n;for(v=new B(s),w=0,d=s.length;d>w;w+=2)v[w+1]*=n;for(F=2,c=a,f=o,T=l,p=m,g=t,t=new G(H);F--;){if(U=t,t=g,g=U,h=c.length,d=f.length,fe)for(C=0,R=0,_=0;H>_;_+=4,C++){for(C>=n&&(C=0,R+=n),k=O=P=L=0,w=0,y=0;h>w;w++,y+=2)I=C+p[y],b=R+p[y+1],I>=0&&A>=I&&b>=0&&x>=b&&(srcOff=I+b<<2,E=c[w],k+=t[srcOff]*E,O+=t[srcOff+1]*E,P+=t[srcOff+2]*E);S=T*k,M=T*O,D=T*P,S=0>S?0:S>255?255:S,M=0>M?0:M>255?255:M,D=0>D?0:D>255?255:D,g[_]=~~S,g[_+1]=~~M,g[_+2]=~~D,g[_+3]=t[_+3]}else for(C=0,R=0,_=0;H>_;_+=4,C++){for(C>=n&&(C=0,R+=n),k=O=P=L=0,w=0,y=0;h>w;w++,y+=2)I=C+p[y],b=R+p[y+1],I>=0&&A>=I&&b>=0&&x>=b&&(srcOff=I+b<<2,E=c[w],k+=t[srcOff]*E,O+=t[srcOff+1]*E,P+=t[srcOff+2]*E);S=T*k,M=T*O,D=T*P,g[_]=~~S,g[_+1]=~~M,g[_+2]=~~D,g[_+3]=t[_+3]}c=i,f=s,T=u,p=v}return g}function S(e){var t,n=new N(256);if(e)for(t=0;256>t;t+=16)n[t]=255-t,n[t+1]=255-t-1,n[t+2]=255-t-2,n[t+3]=255-t-3,n[t+4]=255-t-4,n[t+5]=255-t-5,n[t+6]=255-t-6,n[t+7]=255-t-7,n[t+8]=255-t-8,n[t+9]=255-t-9,n[t+10]=255-t-10,n[t+11]=255-t-11,n[t+12]=255-t-12,n[t+13]=255-t-13,n[t+14]=255-t-14,n[t+15]=255-t-15;else for(t=0;256>t;t+=16)n[t]=t,n[t+1]=t+1,n[t+2]=t+2,n[t+3]=t+3,n[t+4]=t+4,n[t+5]=t+5,n[t+6]=t+6,n[t+7]=t+7,n[t+8]=t+8,n[t+9]=t+9,n[t+10]=t+10,n[t+11]=t+11,n[t+12]=t+12,n[t+13]=t+13,n[t+14]=t+14,n[t+15]=t+15;return n}function M(e,t){var r,a=new N(256);for(r=0;256>r;r+=16)a[r]=n(e[n(t[r],0,255)],0,255),a[r+1]=n(e[n(t[r+1],0,255)],0,255),a[r+2]=n(e[n(t[r+2],0,255)],0,255),a[r+3]=n(e[n(t[r+3],0,255)],0,255),a[r+4]=n(e[n(t[r+4],0,255)],0,255),a[r+5]=n(e[n(t[r+5],0,255)],0,255),a[r+6]=n(e[n(t[r+6],0,255)],0,255),a[r+7]=n(e[n(t[r+7],0,255)],0,255),a[r+8]=n(e[n(t[r+8],0,255)],0,255),a[r+9]=n(e[n(t[r+9],0,255)],0,255),a[r+10]=n(e[n(t[r+10],0,255)],0,255),a[r+11]=n(e[n(t[r+11],0,255)],0,255),a[r+12]=n(e[n(t[r+12],0,255)],0,255),a[r+13]=n(e[n(t[r+13],0,255)],0,255),a[r+14]=n(e[n(t[r+14],0,255)],0,255),a[r+15]=n(e[n(t[r+15],0,255)],0,255);return a}function D(){return new W([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}function E(e,t){var n=new W(20);return n[0]=t[0]*e[0]+t[1]*e[5]+t[2]*e[10]+t[3]*e[15],n[1]=t[0]*e[1]+t[1]*e[6]+t[2]*e[11]+t[3]*e[16],n[2]=t[0]*e[2]+t[1]*e[7]+t[2]*e[12]+t[3]*e[17],n[3]=t[0]*e[3]+t[1]*e[8]+t[2]*e[13]+t[3]*e[18],n[4]=t[0]*e[4]+t[1]*e[9]+t[2]*e[14]+t[3]*e[19]+t[4],n[5]=t[5]*e[0]+t[6]*e[5]+t[7]*e[10]+t[8]*e[15],n[6]=t[5]*e[1]+t[6]*e[6]+t[7]*e[11]+t[8]*e[16],n[7]=t[5]*e[2]+t[6]*e[7]+t[7]*e[12]+t[8]*e[17],n[8]=t[5]*e[3]+t[6]*e[8]+t[7]*e[13]+t[8]*e[18],n[9]=t[5]*e[4]+t[6]*e[9]+t[7]*e[14]+t[8]*e[19]+t[9],n[10]=t[10]*e[0]+t[11]*e[5]+t[12]*e[10]+t[13]*e[15],n[11]=t[10]*e[1]+t[11]*e[6]+t[12]*e[11]+t[13]*e[16],n[12]=t[10]*e[2]+t[11]*e[7]+t[12]*e[12]+t[13]*e[17],n[13]=t[10]*e[3]+t[11]*e[8]+t[12]*e[13]+t[13]*e[18],n[14]=t[10]*e[4]+t[11]*e[9]+t[12]*e[14]+t[13]*e[19]+t[14],n[15]=t[15]*e[0]+t[16]*e[5]+t[17]*e[10]+t[18]*e[15],n[16]=t[15]*e[1]+t[16]*e[6]+t[17]*e[11]+t[18]*e[16],n[17]=t[15]*e[2]+t[16]*e[7]+t[17]*e[12]+t[18]*e[17],n[18]=t[15]*e[3]+t[16]*e[8]+t[17]*e[13]+t[18]*e[18],n[19]=t[15]*e[4]+t[16]*e[9]+t[17]*e[14]+t[18]*e[19]+t[19],n}function k(e,t,n,r,a,i,o,s,l){var u=new W(20);return u[5*i+t]=e[0],u[5*i+n]=e[1],u[5*i+r]=e[2],u[5*i+a]=e[3],u[5*i+4]=e[4],u[5*o+t]=e[5],u[5*o+n]=e[6],u[5*o+r]=e[7],u[5*o+a]=e[8],u[5*o+4]=e[9],u[5*s+t]=e[10],u[5*s+n]=e[11],u[5*s+r]=e[12],u[5*s+a]=e[13],u[5*s+4]=e[14],u[5*l+t]=e[15],u[5*l+n]=e[16],u[5*l+r]=e[17],u[5*l+a]=e[18],u[5*l+4]=e[19],u}function O(e,t,n,r,a){e[t]=255&~~(n[0]+a*(r[0]-n[0])),e[t+1]=255&~~(n[1]+a*(r[1]-n[1])),e[t+2]=255&~~(n[2]+a*(r[2]-n[2])),e[t+3]=255&~~(n[3]+a*(r[3]-n[3]))}function P(e,t){t=t?t.slice():t,e=e?e.slice():e;var n,r=e.length;if(t){if(t.length<r){var a=t.length,i=t[a-1];for(n=a;r>n;n++)t.push(n+1===r?1:i+(n-a+1)/(r-1))}}else if(1===r)t=[1];else for(t=new Array(r),n=0;r>n;n++)t[n]=n+1===r?1:n/(r-1);return 1!=t[t.length-1]&&(t.push(1),e.push(e[e.length-1])),[e,t]}function L(e,t,n,r,a,i,o){var s,l,u,h,c,f,d,g,p,m,v,_=e.length;if(i=i||0,0>i&&(i+=ie),i>ie&&(i-=ie),p=ee(z(i)),m=ee(Q(i)),v=m*t+p*n,i>oe&&ae>=i)for(l=0,u=0,s=0;_>s;s+=4,l++){for(l>=t&&(l=0,u++),c=t-1-l,f=u,h=Z(1,(m*c+p*f)/v),g=0;h>a[g];)++g;d=0===g?0:g-1,o(e,s,r[d],r[g],a[g]>a[d]?(h-a[d])/(a[g]-a[d]):h)}else if(i>ae&&se>=i)for(l=0,u=0,s=0;_>s;s+=4,l++){for(l>=t&&(l=0,u++),c=t-1-l,f=n-1-u,h=Z(1,(m*c+p*f)/v),g=0;h>a[g];)++g;d=0===g?0:g-1,o(e,s,r[d],r[g],a[g]>a[d]?(h-a[d])/(a[g]-a[d]):h)}else if(i>se&&ie>i)for(l=0,u=0,s=0;_>s;s+=4,l++){for(l>=t&&(l=0,u++),c=l,f=n-1-u,h=Z(1,(m*c+p*f)/v),g=0;h>a[g];)++g;d=0===g?0:g-1,o(e,s,r[d],r[g],a[g]>a[d]?(h-a[d])/(a[g]-a[d]):h)}else for(l=0,u=0,s=0;_>s;s+=4,l++){for(l>=t&&(l=0,u++),c=l,f=u,h=Z(1,(m*c+p*f)/v),g=0;h>a[g];)++g;d=0===g?0:g-1,o(e,s,r[d],r[g],a[g]>a[d]?(h-a[d])/(a[g]-a[d]):h)}return e}function T(e,t,n,r,a,i,o,s,l,u){var h,c,f,d,g,p,m,v,_=e.length;for(i=i||0,o=o||0,s=s||1,l=l||1,l>s?(s/=l,l=1):s>l?(l/=s,s=1):(l=1,s=1),c=0,f=0,h=0;_>h;h+=4,c++){for(c>=t&&(c=0,f++),g=s*(c-i)/(t-i),p=l*(f-o)/(n-o),d=Z(1,q(g*g+p*p)),v=0;d>a[v];)++v;m=0===v?0:v-1,u(e,h,r[m],r[v],a[v]>a[m]?(d-a[m])/(a[v]-a[m]):d)}return e}function F(e){return e.replace(de,"\\$1")}var G=e.ImArray,U=e.ImArrayCopy,H=e.Array32F,B=(e.Array64F,e.Array16I),N=(e.Array8U,e.ColorTable),W=e.ColorMatrix,j=e.Util.Math,X=e.Util.String,K=e.Util.Image,Y=e.Util.Filter,q=Math.sqrt,$=Math.pow,V=Math.ceil,J=Math.log,z=Math.sin,Q=Math.cos,Z=Math.min,ee=(Math.max,Math.abs),te=Math.PI,ne=te+te,re=.5*te,ae=te,ie=ne,oe=re,se=3*oe,le=Math.log2||function(e){return J(e)/Math.LN2},ue=e.Util.Array.arrayset,he=e.Util.Array.subarray,ce=e.MODE,fe=e._notSupportClamp,de=/([.*+?^${}()|\[\]\/\\\-])/g,ge=/^\s+|\s+$/g;j.clamp=n,j.closest_power2=r,j.Geometry={Point2:a,Point3:i,enorm2:u,cross2:l,normal2:h,interpolate2:o,interpolate3:s},X.esc=F,X.trim=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(ge,"")},K.crop=e.Interpolation.crop=c,K.pad=e.Interpolation.pad=f,K.get_data=d,K.set_data=g,K.fill=p,K.integral=R,K.histogram=I,K.spectrum=b,K.gradient=L,K.radial_gradient=T,K.lerp=O,K.colors_stops=P,Y.ct_eye=S,Y.ct_multiply=M,Y.cm_eye=D,Y.cm_multiply=E,Y.cm_rechannel=k,Y.integral_convolution=A,Y.separable_convolution=x,Y.generic_transform=m,Y.affine_transform=v,Y.cyclic_shift=_,Y.flip_x=y,Y.flip_y=w,Y.flip_xy=C}(r),!function(e,t){var n=e.Util.Math.clamp,r=e.ImArray;e.Interpolation.bilinear=function(e,t,a,i,o){var s,l,u,h,c,f,d,g,p,m,v,_,y,w,C,R,I,b,A,x=i*o<<2,S=new r(x),M=(t-1)/i,D=(a-1)/o,E=t<<2;for(p=0,m=0,v=0,_=0,w=0,I=0,A=0,R=0;x>R;R+=4,m++,v+=M)m>=i&&(m=0,v=0,p++,_+=D,w=~~_,A=_-w,I=w*t),y=~~v,b=v-y,c=(1-b)*(1-A),f=b*(1-A),d=A*(1-b),g=b*A,C=I+y<<2,s=e[C],l=e[C+4],u=e[C+E],h=e[C+E+4],S[R]=n(~~(s*c+l*f+u*d+h*g+.5),0,255),s=e[C+1],l=e[C+5],u=e[C+E+1],h=e[C+E+5],S[R+1]=n(~~(s*c+l*f+u*d+h*g+.5),0,255),s=e[C+2],l=e[C+6],u=e[C+E+2],h=e[C+E+6],S[R+2]=n(~~(s*c+l*f+u*d+h*g+.5),0,255),s=e[C+3],l=e[C+7],u=e[C+E+3],h=e[C+E+7],S[R+3]=n(~~(s*c+l*f+u*d+h*g+.5),0,255);return S}}(r),!function(e,t){var n=(e.Util.Math.clamp,e.ImArray);e.Interpolation.nearest=function(e,t,r,a,i){var o,s,l,u,h,c,f,d,g,p,m,v=a*i<<2,_=new n(v),y=(t-1)/a,w=(r-1)/i,C=t<<2;for(o=0,s=0,l=0,u=0,c=0,g=0,m=0,d=0;v>d;d+=4,s++,l+=y)s>=a&&(s=0,l=0,o++,u+=w,c=~~u,g=c*t,m=.5>u-c?0:C),h=~~l,p=.5>l-h?0:4,f=(g+h<<2)+p+m,_[d]=e[f],_[d+1]=e[f+1],_[d+2]=e[f+2],_[d+3]=e[f+3];return _}}(r),!function(e,t){var n=e.Util.Math.clamp,r=e.ImArray,a=e.Array32F,i=e.Util.Array.subarray;e.Interpolation.bicubic=function(e,t,o,s,l){var u,h,c,f,d,g,p,m,v,_,y,w,C,R,I,b,A,x,S,M,D,E,k,O,P,L,T,F,G,U,H,B,N,W,j,X,K,Y,q,$=s*l<<2,V=new r($),J=(t-1)/s,z=(o-1)/l,Q=new r(4),Z=new a(4),ee=new a(4),te=new a(4),ne=new a(4),re=t<<2;for(u=0,h=0,c=0,f=0,g=0,v=0,y=R=I=0,m=0;$>m;m+=4,h++,c+=J)h>=s&&(h=0,c=0,u++,f+=z,g=~~f,y=f-g,R=y*y,I=R*I,v=g*t),d=~~c,_=c-d,w=_*_,C=w*_,p=v+d<<2,X=0===g,K=o-1===g,Y=0===d,q=t-1===d,O=i(e,p,p+4),P=Y?O:i(e,p-4,p),L=q?O:i(e,p+4,p+8),T=q?O:i(e,p+8,p+12),b=K?O:i(e,p+re,p+re+4),M=K?O:i(e,p+re+re,p+re+re+4),A=K||Y?O:i(e,p+re-4,p+re),x=K||q?O:i(e,p+re+4,p+re+8),S=K||q?O:i(e,p+re+8,p+re+12),D=K||Y?O:i(e,p+re+re-4,p+re+re),E=K||q?O:i(e,p+re+re+4,p+re+re+8),k=K||q?O:i(e,p+re+re+8,p+re+re+12),F=X?O:i(e,p-re,p-re+4),G=X||Y?O:i(e,p-re-4,p-re),U=X||q?O:i(e,p-re+4,p-re+8),H=X||q?O:i(e,p-re+8,p-re+12),B=H[0]-U[0]-(G[0]-F[0]),N=G[0]-F[0]-B,W=U[0]-G[0],j=F[0],Z[0]=B*C+N*w+W*_+j,B=H[1]-U[1]-(G[1]-F[1]),N=G[1]-F[1]-B,W=U[1]-G[1],j=F[1],Z[1]=B*C+N*w+W*_+j,B=H[2]-U[2]-(G[2]-F[2]),N=G[2]-F[2]-B,W=U[2]-G[2],j=F[2],Z[2]=B*C+N*w+W*_+j,B=H[3]-U[3]-(G[3]-F[3]),N=G[3]-F[3]-B,W=U[3]-G[3],j=F[3],Z[3]=B*C+N*w+W*_+j,B=T[0]-L[0]-(P[0]-O[0]),N=P[0]-O[0]-B,W=L[0]-P[0],j=O[0],ee[0]=B*C+N*w+W*_+j,B=T[1]-L[1]-(P[1]-O[1]),N=P[1]-O[1]-B,W=L[1]-P[1],j=O[1],ee[1]=B*C+N*w+W*_+j,B=T[2]-L[2]-(P[2]-O[2]),N=P[2]-O[2]-B,W=L[2]-P[2],j=O[2],ee[2]=B*C+N*w+W*_+j,B=T[3]-L[3]-(P[3]-O[3]),N=P[3]-O[3]-B,W=L[3]-P[3],j=O[3],ee[3]=B*C+N*w+W*_+j,B=S[0]-x[0]-(A[0]-b[0]),N=A[0]-b[0]-B,W=x[0]-A[0],j=b[0],te[0]=B*C+N*w+W*_+j,B=S[1]-x[1]-(A[1]-b[1]),N=A[1]-b[1]-B,W=x[1]-A[1],j=b[1],te[1]=B*C+N*w+W*_+j,B=S[2]-x[2]-(A[2]-b[2]),N=A[2]-b[2]-B,W=x[2]-A[2],j=b[2],te[2]=B*C+N*w+W*_+j,B=S[3]-x[3]-(A[3]-b[3]),N=A[3]-b[3]-B,W=x[3]-A[3],j=b[3],te[3]=B*C+N*w+W*_+j,B=k[0]-E[0]-(D[0]-M[0]),N=D[0]-M[0]-B,W=E[0]-D[0],j=M[0],ne[0]=B*C+N*w+W*_+j,B=k[1]-E[1]-(D[1]-M[1]),N=D[1]-M[1]-B,W=E[1]-D[1],j=M[1],ne[1]=B*C+N*w+W*_+j,B=k[2]-E[2]-(D[2]-M[2]),N=D[2]-M[2]-B,W=E[2]-D[2],j=M[2],ne[2]=B*C+N*w+W*_+j,B=k[3]-E[3]-(D[3]-M[3]),N=D[3]-M[3]-B,W=E[3]-D[3],j=M[3],ne[3]=B*C+N*w+W*_+j,B=ne[0]-te[0]-(Z[0]-ee[0]),N=Z[0]-ee[0]-B,W=te[0]-Z[0],j=ee[0],Q[0]=n(~~(B*I+N*R+W*y+j+.5),0,255),B=ne[1]-te[1]-(Z[1]-ee[1]),N=Z[1]-ee[1]-B,W=te[1]-Z[1],j=ee[1],Q[1]=n(~~(B*I+N*R+W*y+j+.5),0,255),B=ne[2]-te[2]-(Z[2]-ee[2]),N=Z[2]-ee[2]-B,W=te[2]-Z[2],j=ee[2],Q[2]=n(~~(B*I+N*R+W*y+j+.5),0,255),B=ne[3]-te[3]-(Z[3]-ee[3]),N=Z[3]-ee[3]-B,W=te[3]-Z[3],j=ee[3],Q[3]=n(~~(B*I+N*R+W*y+j+.5),0,255),V[m]=Q[0],V[m+1]=Q[1],V[m+2]=Q[2],V[m+3]=Q[3];return V}}(r),!function(e,t){var n=Math.sqrt,r=Math.round,a=(Math.floor,Math.min),i=Math.max,o=Math.abs,s=e.Util.Math.clamp,l=e.Util.String.esc,u=e.Util.String.trim,h=e.LUMA,c=(e.CHANNEL,1/255),f=100/255,d=2.55,g={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},m=e.Color=e.Class({__static__:{clamp:s,clampPixel:function(e){return a(255,i(e,0))},intensity:function(e,t,n){return~~(h[0]*e+h[1]*t+h[2]*n)},hue:function(e,t,n){var r=i(e,t,n);return e===t&&t===n?0:e===r?60*o(t-n)/(r-a(e,t,n)):t===r?120+60*o(n-e)/(r-a(e,t,n)):240+60*o(e-t)/(r-a(e,t,n))},saturation:function(e,t,n){var r=i(e,t,n);return e===t&&t===n?0:255*(r-a(e,t,n))/r},dist:function(e,t,r,a){var i=e[r+0]-t[a+0],o=e[r+1]-t[a+1],s=e[r+2]-t[a+2];return n(i*i+o*o+s*s)},RGB2Color:function(e,t){return(255&e[t+0])<<16|(255&e[t+1])<<8|255&e[t+2]},RGBA2Color:function(e){return(255&e[p+3])<<24|(255&e[p+0])<<16|(255&e[p+1])<<8|255&e[p+2]},Color2RGBA:function(e,t,n){return e=~~e,t[n+0]=e>>>16&255,t[n+1]=e>>>8&255,t[n+2]=255&e,t[n+3]=e>>>24&255,t},RGB2YCbCr:function(e,t){var n=e[t+0],r=e[t+1],a=e[t+2];return e[t+0]=~~(0+.299*n+.587*r+.114*a),e[t+1]=~~(128-.168736*n-.331264*r+.5*a),e[t+2]=~~(128+.5*n-.418688*r-.081312*a),e},YCbCr2RGB:function(e,t){var n=e[t+0],r=e[t+1],a=e[t+2];return e[t+0]=~~(n+1.402*(a-128)),e[t+1]=~~(n-.34414*(r-128)-.71414*(a-128)),e[t+2]=~~(n+1.772*(r-128)),e},RGB2HSV:function(e,t){var n,r,s,l,u,h,c=e[t+0],f=e[t+1],d=e[t+2];return r=i(c,f,d),h=r,c===f&&f===d?(u=0,l=0):(n=a(c,f,d),s=r-n,u=s/r,l=c===r?60*o(f-d)/s:f===r?120+60*o(d-c)/s:240+60*o(c-f)/s),e[t+0]=l,e[t+1]=u,e[t+2]=h,e},HSV2RGB:function(e,t){var n,r,a,i,o,s,l,u,h=e[t+0],c=e[t+1],f=e[t+2];return 0===c?s=l=u=f:(h/=60,n=~~h,r=h-n,a=f*(1-c),i=f*(1-c*r),o=f*(1-c*(1-r)),0===n?(s=f,l=o,u=a):1===n?(s=i,l=f,u=a):2===n?(s=a,l=f,u=o):3===n?(s=a,l=i,u=f):4===n?(s=o,l=a,u=f):(s=f,l=a,u=i)),e[t+0]=s,e[t+1]=l,e[t+2]=u,e},toString:function(){return"[FILTER: "+this.name+"]"},C2F:c,C2P:f,P2C:d,Keywords:g,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(g).map(l).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(e,t){return e*f+(t||"")},per2col:function(e){return e*d},rgb2cmyk:function(e,t,n,i){var o,l,u=0,h=0,f=0,g=0;return i&&(e=s(r(e*d),0,255),t=s(r(t*d),0,255),n=s(r(n*d),0,255)),0==e&&0==t&&0==n?(g=1,[0,0,0,1]):(u=1-e*c,h=1-t*c,f=1-n*c,o=a(u,h,f),l=1/(1-o),u=(u-o)*l,h=(h-o)*l,f=(f-o)*l,g=o,[u,h,f,g])},cmyk2rgb:function(e,t,n,a){var i,o,l=0,u=0,h=0;return 0==e&&0==t&&0==n?[0,0,0]:(i=a,o=1-i,e=e*o+i,t=t*o+i,n=n*o+i,l=255*(1-e),u=255*(1-t),h=255*(1-n),[s(r(l),0,255),s(r(u),0,255),s(r(h),0,255)])},rgb2hex:function(e,t,n,a,i){var o;return i&&(e=s(r(e*d),0,255),t=s(r(t*d),0,255),n=s(r(n*d),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),n=16>n?"0"+n.toString(16):n.toString(16),o=a&&e[0]==e[1]&&t[0]==t[1]&&n[0]==n[1]?"#"+e[0]+t[0]+n[0]:"#"+e+t+n},rgb2hexIE:function(e,t,n,a,i){var o;return i&&(e=s(r(e*d),0,255),t=s(r(t*d),0,255),n=s(r(n*d),0,255),a=s(r(a*d),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),n=16>n?"0"+n.toString(16):n.toString(16),
a=16>a?"0"+a.toString(16):a.toString(16),o="#"+a+e+t+n},hex2rgb:function(e){return!e||3>e.length?[0,0,0]:6>e.length?[s(parseInt(e[0]+e[0],16),0,255),s(parseInt(e[1]+e[1],16),0,255),s(parseInt(e[2]+e[2],16),0,255)]:[s(parseInt(e[0]+e[1],16),0,255),s(parseInt(e[2]+e[3],16),0,255),s(parseInt(e[4]+e[5],16),0,255)]},hue2rgb:function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e},hsl2rgb:function(e,t,n){var a,i,o,l,u,h=m.hue2rgb;return e=(e+360)%360/360,t*=.01,n*=.01,0==t?(a=1,i=1,o=1):(u=.5>n?n*(1+t):n+t-n*t,l=2*n-u,a=h(l,u,e+1/3),i=h(l,u,e),o=h(l,u,e-1/3)),[s(r(255*a),0,255),s(r(255*i),0,255),s(r(255*o),0,255)]},rgb2hsl:function(e,t,n,o){var l,u,h,f,d,g;return o?(e*=.01,t*=.01,n*=.01):(e*=c,t*=c,n*=c),u=i(e,t,n),l=a(e,t,n),d=.5*(u+l),u==l?h=f=0:(g=u-l,f=d>.5?g/(2-i-a):g/(i+a),h=u==e?(t-n)/g+(n>t?6:0):u==t?(n-e)/g+2:(e-t)/g+4,h/=6),[r(360*h)%360,s(100*f,0,100),s(100*d,0,100)]},parse:function(e,t,n,r){var a,i,o,s,l,h=0,c=0;if("hsl"===n||!n&&(a=e.match(m.hslRE))){if("hsl"===n){l="hsla"===e[0].toLowerCase();var d=e[1].split(",").map(u)}else{h=a[0].length,c=0,l="hsla"===a[1].toLowerCase();var d=a[2].split(",").map(u)}var g=d[0]?d[0]:"0",e=d[1]?d[1]:"0",p=d[2]?d[2]:"0",v=l&&null!=d[3]?d[3]:"1";return g=parseFloat(g,10),e="%"===e.slice(-1)?parseFloat(e,10):parseFloat(e,10)*f,p="%"===p.slice(-1)?parseFloat(p,10):parseFloat(p,10)*f,v=parseFloat(v,10),s=(new m).fromHSL([g,e,p,v]),t&&(o=e.substr(h),(i=o.match(m.colorstopRE))&&(s.colorStop(i[1]),c=i[0].length)),r?s:[s,0,h+c]}if("rgb"===n||!n&&(a=e.match(m.rgbRE))){if("rgb"===n){l="rgba"===e[0].toLowerCase();var d=e[1].split(",").map(u)}else{h=a[0].length,c=0,l="rgba"===a[1].toLowerCase();var d=a[2].split(",").map(u)}var _=d[0]?d[0]:"0",y=d[1]?d[1]:"0",w=d[2]?d[2]:"0",v=l&&null!=d[3]?d[3]:"1";return _="%"===_.slice(-1)?2.55*parseFloat(_,10):parseFloat(_,10),y="%"===y.slice(-1)?2.55*parseFloat(y,10):parseFloat(y,10),w="%"===w.slice(-1)?2.55*parseFloat(w,10):parseFloat(w,10),v=parseFloat(v,10),s=(new m).fromRGB([_,y,w,v]),t&&(o=e.substr(h),(i=o.match(m.colorstopRE))&&(s.colorStop(i[1]),c=i[0].length)),r?s:[s,0,h+c]}if("hex"===n||!n&&(a=e.match(m.hexRE))){if("hex"===n)var d=m.hex2rgb(e[0]);else{h=a[0].length,c=0;var d=m.hex2rgb(a[1])}var C=d[0]?d[0]:0,R=d[1]?d[1]:0,I=d[2]?d[2]:0,v=null!=d[3]?d[3]:255;return s=(new m).fromHEX([C,R,I,v]),t&&(o=e.substr(h),(i=o.match(m.colorstopRE))&&(s.colorStop(i[1]),c=i[0].length)),r?s:[s,0,h+c]}if("keyword"===n||!n&&(a=e.match(m.keywordRE))){if("keyword"===n)var d=e[0];else{h=a[0].length,c=0;var d=a[1]}return s=(new m).fromKeyword(d),t&&(o=e.substr(h),(i=o.match(m.colorstopRE))&&(s.colorStop(i[1]),c=i[0].length)),r?s:[s,0,h+c]}return null},fromString:function(e,t,n){return m.parse(e,t,n,1)},fromRGB:function(e){return(new m).fromRGB(e)},fromHSL:function(e){return(new m).fromHSL(e)},fromCMYK:function(e){return(new m).fromCMYK(e)},fromHEX:function(e){return(new m).fromHEX(e)},fromKeyword:function(e){return(new m).fromKeyword(e)},fromPixel:function(e){return(new m).fromPixel(e)}},constructor:function v(e,t){return this instanceof v?(this.reset(),void(e&&this.set(e,t))):new v(e,t)},name:"Color",col:null,cstop:null,kword:null,clone:function(){var e=new m;return e.col=this.col.slice(),e.cstop=this.cstop+"",e.kword=this.kword,e},reset:function(){return this.col=[0,0,0,1],this.cstop="",this.kword=null,this},set:function(e,n){return e&&(t!==e[0]&&(this.col[0]=s(e[0],0,255)),t!==e[1]&&(this.col[1]=s(e[1],0,255)),t!==e[2]&&(this.col[2]=s(e[2],0,255)),t!==e[3]?this.col[3]=s(e[3],0,1):this.col[3]=1,n&&(this.cstop=n),this.kword=null),this},colorStop:function(e){return this.cstop=e,this},isTransparent:function(){return 1>this.col[3]},isKeyword:function(){return!!this.kword},fromPixel:function(e){return e=e||0,this.col=[s(e>>16&255,0,255),s(e>>8&255,0,255),s(255&e,0,255),s((e>>24&255)*c,0,1)],this.kword=null,this},fromKeyword:function(e){return e=e.toLowerCase(),m.Keywords[e]&&(this.col=m.Keywords[e].slice(),this.kword=e),this},fromHEX:function(e){return this.col[0]=e[0]?s(parseInt(e[0],10),0,255):0,this.col[1]=e[1]?s(parseInt(e[1],10),0,255):0,this.col[2]=e[2]?s(parseInt(e[2],10),0,255):0,this.col[3]=t!==e[3]?s(parseInt(e[3],10)*c,0,1):1,this.kword=null,this},fromRGB:function(e){return this.col[0]=e[0]?s(r(e[0]),0,255):0,this.col[1]=e[1]?s(r(e[1]),0,255):0,this.col[2]=e[2]?s(r(e[2]),0,255):0,this.col[3]=t!==e[3]?s(e[3],0,1):1,this.kword=null,this},fromCMYK:function(e){var n=m.cmyk2rgb(e[0]||0,e[1]||0,e[2]||0,e[3]||0);return this.col[0]=n[0],this.col[1]=n[1],this.col[2]=n[2],this.col[3]=t!==e[4]?s(e[4],0,1):1,this.kword=null,this},fromHSL:function(e){var n=m.hsl2rgb(e[0]||0,e[1]||0,e[2]||0);return this.col[0]=n[0],this.col[1]=n[1],this.col[2]=n[2],this.col[3]=t!==e[3]?s(e[3],0,1):1,this.kword=null,this},toPixel:function(e){return e?s(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(e,t,n){var r=m.rgb2cmyk(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toKeyword:function(e,t,n){return this.kword?this.kword:this.toHEX(1,t,n)},toHEX:function(e,t,n){return n?m.rgb2hexIE(this.col[0],this.col[1],this.col[2],s(r(255*this.col[3]),0,255)):m.rgb2hex(this.col[0],this.col[1],this.col[2],t)},toRGB:function(e,t,n){var r=this.col[3];return e?(t&&(r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(e,t,n){var r=this.col[3],a=m.rgb2hsl(this.col[0],this.col[1],this.col[2]);return e?(t&&(a[1]=0==a[1]?a[1]:a[1]+"%",a[2]=0==a[2]?a[2]:a[2]+"%",r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[a[0],a[1],a[2]].join(",")+")":"hsla("+[a[0],a[1],a[2],r].join(",")+")"):n?a:a.concat(this.col[3])},toColorStop:function(e){var t=this.cstop;return e?(t=t.length?t+",":"",1>this.col[3]?"color-stop("+t+this.toRGB(1,1)+")":"color-stop("+t+this.toHEX(1,1)+")"):(t=t.length?" "+t:"",1>this.col[3]?this.toRGB(1,1)+t:this.toHEX(1,1)+t)},toString:function(e,t){return e=e?e.toLowerCase():"hex","rgb"==e||"rgba"==e?this.toRGB(1,!1!==t,"rgb"==e):"hsl"==e||"hsla"==e?this.toHSL(1,!1!==t,"hsl"==e):"keyword"==e?this.toKeyword(1):this.toHEX(1,!1!==t,"hexie"==e)}});m.toGray=m.intensity,m.Blend=m.Combine={normal:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=f,o=d,s=g,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},lighten:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=u>f?u:f,o=h>d?h:d,s=c>g?c:g,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},darken:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=u>f?f:u,o=h>d?d:h,s=c>g?g:c,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},multiply:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=u*f*.003921568627451,o=h*d*.003921568627451,s=c*g*.003921568627451,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},average:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=.5*(u+f),o=.5*(h+d),s=.5*(c+g),u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},add:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=u+f,o=h+d,s=c+g,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},subtract:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=255>u+f?0:u+f-255,o=255>h+d?0:h+d-255,s=255>c+g?0:c+g-255,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},difference:function(e,t,n,r,a){var i,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];i=o(d-h),s=o(g-c),l=o(p-f),h+=u*(i-h),c+=u*(s-c),f+=u*(l-f),a&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},negation:function(e,t,n,r,a){var i,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];i=255-o(255-d-h),s=255-o(255-g-c),l=255-o(255-p-f),h+=u*(i-h),c+=u*(s-c),f+=u*(l-f),a&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},screen:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=255-((255-f)*(255-u)>>8),o=255-((255-d)*(255-h)>>8),s=255-((255-g)*(255-c)>>8),u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},exclusion:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=f+u-2*f*u*.003921568627451,o=d+h-2*d*h*.003921568627451,s=g+c-2*g*c*.003921568627451,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},overlay:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=128>u?2*f*u*.003921568627451:255-2*(255-f)*(255-u)*.003921568627451,o=128>h?2*d*h*.003921568627451:255-2*(255-d)*(255-h)*.003921568627451,i=128>c?2*g*c*.003921568627451:255-2*(255-g)*(255-c)*.003921568627451,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},softlight:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=128>u?2*((f>>1)+64)*(.003921568627451*u):255-2*(255-((f>>1)+64))*(255-u)*.003921568627451,o=128>h?2*((d>>1)+64)*(.003921568627451*h):255-2*(255-((d>>1)+64))*(255-h)*.003921568627451,s=128>c?2*((g>>1)+64)*(.003921568627451*c):255-2*(255-((g>>1)+64))*(255-c)*.003921568627451,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},hardlight:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=128>f?2*u*f*.003921568627451:255-2*(255-u)*(255-f)*.003921568627451,o=128>d?2*h*d*.003921568627451:255-2*(255-h)*(255-d)*.003921568627451,s=128>g?2*c*g*.003921568627451:255-2*(255-c)*(255-g)*.003921568627451,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},colordodge:function(e,t,n,r,i){var o,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];o=255===h?h:a(255,(d<<8)/(255-h)),s=255===c?c:a(255,(g<<8)/(255-c)),l=255===f?f:a(255,(p<<8)/(255-f)),h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},colorburn:function(e,t,n,r,a){var o,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];o=0===h?h:i(0,255-(255-d<<8)/h),s=0===c?c:i(0,255-(255-g<<8)/c),l=0===f?f:i(0,255-(255-p<<8)/f),h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),a&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},linearlight:function(e,t,n,r,a){var i,o,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];128>h?(l=2*h,i=255>l+d?0:l+d-255):(l=2*(h-128),i=l+d),128>c?(l=2*c,o=255>l+g?0:l+g-255):(l=2*(c-128),o=l+g),128>f?(l=2*f,s=255>l+p?0:l+p-255):(l=2*(f-128),s=l+p),h+=u*(i-h),c+=u*(o-c),f+=u*(s-f),a&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},reflect:function(e,t,n,r,i){var o,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];o=255===h?h:a(255,d*d/(255-h)),s=255===c?c:a(255,g*g/(255-c)),l=255===f?f:a(255,p*p/(255-f)),h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},glow:function(e,t,n,r,i){var o,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];o=255===d?d:a(255,h*h/(255-d)),s=255===g?g:a(255,c*c/(255-g)),l=255===p?p:a(255,f*f/(255-p)),h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},phoenix:function(e,t,n,r,o){var s,l,u,h=.003921568627451*t[r+3],c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];s=a(g,c)-i(g,c)+255,l=a(p,f)-i(p,f)+255,u=a(m,d)-i(m,d)+255,c+=h*(s-c),f+=h*(l-f),d+=h*(u-d),o&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},vividlight:function(e,t,n,r,o){var s,l,u,h,c=.003921568627451*t[r+3],f=e[n],d=e[n+1],g=e[n+2],p=t[r],m=t[r+1],v=t[r+2];128>f?(h=2*f,s=0===h?h:i(0,255-(255-p<<8)/h)):(h=2*(f-128),s=255===h?h:a(255,(p<<8)/(255-h))),128>d?(h=2*d,l=0===h?h:i(0,255-(255-m<<8)/h)):(h=2*(d-128),l=255===h?h:a(255,(m<<8)/(255-h))),128>g?(h=2*g,u=0===h?h:i(0,255-(255-v<<8)/h)):(h=2*(d-128),u=255===h?h:a(255,(v<<8)/(255-h))),f+=c*(s-f),d+=c*(l-d),g+=c*(u-g),o&&(f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g),e[n]=~~f,e[n+1]=~~d,e[n+2]=~~g},pinlight:function(e,t,n,r,a){var i,o,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];128>h?(l=2*h,i=l>d?l:d):(l=2*(h-128),i=l>d?d:l),128>c?(l=2*c,o=l>g?l:g):(l=2*(h-128),o=l>g?g:l),128>f?(l=2*f,s=l>p?l:p):(l=2*(f-128),s=l>p?p:l),h+=u*(i-h),c+=u*(o-c),f+=u*(s-f),a&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},hardmix:function(e,t,n,r,o){var s,l,u,h,c=.003921568627451*t[r+3],f=e[n],d=e[n+1],g=e[n+2],p=t[r],m=t[r+1],v=t[r+2];128>f?(h=2*f,s=0===h?h:i(0,255-(255-p<<8)/h)):(h=2*(f-128),s=255===h?h:a(255,(p<<8)/(255-h))),s=128>s?0:255,128>d?(h=2*d,l=0===h?h:i(0,255-(255-m<<8)/h)):(h=2*(d-128),l=255===h?h:a(255,(m<<8)/(255-h))),l=128>l?0:255,128>g?(h=2*g,u=0===h?h:i(0,255-(255-v<<8)/h)):(h=2*(g-128),u=255===h?h:a(255,(v<<8)/(255-h))),u=128>u?0:255,f+=c*(s-f),d+=c*(l-d),g+=c*(u-g),o&&(f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g),e[n]=~~f,e[n+1]=~~d,e[n+2]=~~g}},m.Blend.lineardodge=m.Blend.add,m.Blend.linearburn=m.Blend.subtract}(r),!function(e,t){function n(e,t,n,r,a){return t===r&&n===a?e:h(e,t,n,r,a)}var r,a,i=e.ImArray,o=e.Util.Image,s=e.Color,l=Math.min,u=Math.max,h=e.Interpolation.bilinear,c=o.get_data,f=o.set_data,d=o.fill;a=e.Class({constructor:function(e){var t=this;t._cnv=e,t._transform={scale:[1,1],translate:[0,0],rotate:[0,0]},t._data=null},_cnv:null,_w:0,_h:0,_transform:null,_data:null,fillStyle:null,dispose:function(){var e=this;return e._cnv=null,e._data=null,e._transform=null,e},fillRect:function(e,t,n,r){var a,i=this,o=i._w,l=i._h,u=i.fillStyle;null==e&&(e=0),null==t&&(t=0),null==n&&(n=o),null==r&&(r=l),u===+u?a=s.Color2RGBA(u,[0,0,0,0],0):u&&u.substr?(a=s.fromString(u).toRGB(!1),a[3]=~~(255*a[3])):a=u&&2<u.length?u:[0,0,0,0],d(i._data,o,l,a,e,t,e+n-1,t+r-1)},clearRect:function(e,t,n,r){var a=this,i=a._w,o=a._h;null==e&&(e=0),null==t&&(t=0),null==n&&(n=i),null==r&&(r=o),d(a._data,i,o,[0,0,0,0],e,t,e+n-1,t+r-1)},drawImage:function(e,t,r,a,i,o,s,l,u){var h=this,d=h._w,g=h._h,p=e._ctx._w,m=e._ctx._h,v=e._ctx._data,_=arguments.length;3===_?(o=t,s=r,f(h._data,d,g,v,p,m,0,0,p-1,m-1,o,s)):5===_?(o=t,s=r,l=a,u=i,f(h._data,d,g,n(v,p,m,l,u),l,u,0,0,l-1,u-1,o,s)):f(h._data,d,g,n(c(v,p,m,t,r,t+a-1,r+i-1,!0),a,i,l,u),l,u,0,0,l-1,u-1,o,s)},createImageData:function(e,t){var n=this;return n._data=new i(e*t<<2),n._w=e,n._h=t,d(n._data,e,t,[0,0,0,0],0,0,e-1,t-1),n},putImageData:function(e,t,n){var r=this,a=r._w,i=r._h,o=e.width,s=e.height;null==t&&(t=0),null==n&&(n=0),f(r._data,a,i,e.data,o,s,0,0,o-1,s-1,t,n)},getImageData:function(e,t,n,r){var a,i,o,s,h=this,f=h._w,d=h._h;return null==e&&(e=0),null==t&&(t=0),null==n&&(n=f),null==r&&(r=d),a=u(0,l(e,n-1,f-1)),i=u(0,l(t,r-1,d-1)),o=l(a+n-1,n-1,f-1),s=l(i+r-1,r-1,d-1),{data:c(h._data,f,d,a,i,o,s),width:o-a+1,height:s-i+1}},scale:function(e,t){var n=this;return n._transform.scale[0]=e,n._transform.scale[1]=t,n},translate:function(e,t){var n=this;return n._transform.translate[0]=e,n._transform.translate[1]=t,n}}),r=e.CanvasProxy=e.Class({constructor:function(e,t){var n=this;n.width=e||0,n.height=t||0,n.style={},n._ctx=new a(n)},_ctx:null,width:null,height:null,style:null,dispose:function(){var e=this;return e.width=null,e.height=null,e.style=null,e._ctx.dispose(),e._ctx=null,e},getContext:function(e){return this._ctx},toDataURL:function(e){return""}}),e.Canvas=function(t,n){var a=e.Browser.isNode?new r:document.createElement("canvas");return t=t||0,n=n||0,a.style.width=t+"px",a.style.height=n+"px",a.width=t*e.devicePixelRatio,a.height=n*e.devicePixelRatio,a}}(r),!function(e,t){function n(e){var t=e.width,n=e.height,r=c(t,n);return r.width=t*s,r.height=n*s,r}function r(e,t,n,r){return r=r||S,r&A&&(e.width=t,e.oCanvas.style.width=t+"px",e.oCanvas.width=t*s,e._restorable&&(e.iCanvas.style.width=e.oCanvas.style.width,e.iCanvas.width=e.oCanvas.width),e.tmpCanvas&&(e.tmpCanvas.style.width=e.oCanvas.style.width,e.tmpCanvas.width=e.oCanvas.width)),r&x&&(e.height=n,e.oCanvas.style.height=n+"px",e.oCanvas.height=n*s,e._restorable&&(e.iCanvas.style.height=e.oCanvas.style.height,e.iCanvas.height=e.oCanvas.height),e.tmpCanvas&&(e.tmpCanvas.style.height=e.oCanvas.style.height,e.tmpCanvas.height=e.oCanvas.height)),e}function a(e,t){var n=e.width,r=e.height;return t=t||255,e._restorable&&t&_&&e._needsRefresh&_&&(e.iData=e.ictx.getImageData(0,0,n,r),e._needsRefresh&=~_),t&y&&e._needsRefresh&y&&(e.oData=e.octx.getImageData(0,0,n,r),e._needsRefresh&=~y),e}function i(e,t){if(e.selection){var n=e.selection,r=e.width-1,a=e.height-1,i=v(n[0]*r),o=v(n[1]*a),s=v(n[2]*r)-i+1,l=v(n[3]*a)-o+1;t=t||255,e._restorable&&t&w&&e._needsRefresh&w&&(e.iDataSel=e.ictx.getImageData(i,o,s,l),e._needsRefresh&=~w),t&C&&e._needsRefresh&C&&(e.oDataSel=e.octx.getImageData(i,o,s,l),e._needsRefresh&=~C)}return e}var o="prototype",s=e.devicePixelRatio,l=e.ImArray,u=e.ImArrayCopy,h=(e.Array32F,e.Util.Image),c=e.Canvas,f=e.CanvasProxy,d=e.FORMAT,g=e.MIME,p=0,m=(e._notSupportTypedArrays,e.Util.Array.arrayset),v=(e.Util.Array.subarray,Math.min,Math.floor),_=1,y=2,w=4,C=8,R=16,I=32,b=64,A=2,x=4,S=A|x,M=w|C,D=_|y,E=~M,k=~R,O=~I,P=e.Image=e.Class({name:"Image",constructor:function T(e){var t=this,n=0,r=0;return t instanceof T?(t.id=++p,t.width=n,t.height=r,t.iData=null,t.iDataSel=null,t.oData=null,t.oDataSel=null,t.iCanvas=c(n,r),t.oCanvas=c(n,r),t.tmpCanvas=null,t.domElement=t.oCanvas,t.ictx=t.iCanvas.getContext("2d"),t.octx=t.oCanvas.getContext("2d"),t.webgl=null,t._histogram=[null,null,null,null],t._integral=[null,null,null,null],t._spectrum=[null,null,null,null],t._histogramRefresh=[0,0,0,0],t._integralRefresh=[0,0,0,0],t._spectrumRefresh=[0,0,0,0],t.selection=null,t._needsRefresh=0,t._restorable=!0,t._grayscale=!1,void(e&&t.image(e))):new T(e)},id:null,width:0,height:0,selection:null,iCanvas:null,oCanvas:null,tmpCanvas:null,ictx:null,octx:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,webgl:null,_histogram:null,_integral:null,_spectrum:null,_needsRefresh:0,_restorable:!0,_grayscale:!1,dispose:function(){var e=this;return e.id=null,e.width=null,e.height=null,e.selection=null,e.ictx=null,e.octx=null,e.iData=null,e.iDataSel=null,e.oData=null,e.oDataSel=null,e.iCanvas=null,e.oCanvas=null,e.tmpCanvas=null,e.domElement=null,e.webgl=null,e._histogram=null,e._integral=null,e._spectrum=null,e._histogramRefresh=null,e._integralRefresh=null,e._spectrumRefresh=null,e._needsRefresh=null,e._restorable=null,e._grayscale=null,e},clone:function(e){return new P(!0===e?this.iCanvas:this.oCanvas)},grayscale:function(e){var t=this;return arguments.length?(t._grayscale=!!e,t):t._grayscale},restorable:function(e){var t=this;return arguments.length||(e=!0),t._restorable=!!e,t},apply:function(e,t){return e.apply(this,this,t||null),this},apply2:function(e,t,n){return e.apply(this,t,n||null),this},select:function(e,t,n,r){var a=this,i=arguments.length;return 1>i&&(e=0),2>i&&(t=0),3>i&&(n=1),4>i&&(r=1),a.selection=[0>e?0:e>1?1:e,0>t?0:t>1?1:t,0>n?0:n>1?1:n,0>r?0:r>1?1:r],a._needsRefresh|=M,a},deselect:function(){var e=this;return e.selection=null,e.iDataSel=null,e.oDataSel=null,e._needsRefresh&=E,e},store:function(){var e=this;return e._restorable&&(e.ictx.drawImage(e.oCanvas,0,0),e._needsRefresh|=_,e.selection&&(e._needsRefresh|=w)),e},restore:function(){var e=this;return e._restorable&&(e.octx.drawImage(e.iCanvas,0,0),e._needsRefresh|=y|R|I|b,e._histogramRefresh=[1,1,1,1],e._integralRefresh=[1,1,1,1],e._spectrumRefresh=[1,1,1,1],e.selection&&(e._needsRefresh|=C)),e},dimensions:function(e,t){var n=this;return r(n,e,t,S),n._needsRefresh|=D|R|I|b,n._histogramRefresh=[1,1,1,1],n._integralRefresh=[1,1,1,1],n._spectrumRefresh=[1,1,1,1],n.selection&&(n._needsRefresh|=M),n},scale:function(e,t){var r=this;if(e=e||1,t=t||e,1==e&&1==t)return r;r.tmpCanvas=r.tmpCanvas||n(r);var a=r.tmpCanvas.getContext("2d"),i=r.width,o=r.height;return a.scale(e,t),i=r.width=~~(e*i+.5),o=r.height=~~(t*o+.5),a.drawImage(r.oCanvas,0,0),r.oCanvas.style.width=i+"px",r.oCanvas.style.height=o+"px",r.oCanvas.width=i*s,r.oCanvas.height=o*s,r.octx.drawImage(r.tmpCanvas,0,0),r._restorable&&(a.drawImage(r.iCanvas,0,0),r.iCanvas.style.width=r.oCanvas.style.width,r.iCanvas.style.height=r.oCanvas.style.height,r.iCanvas.width=r.oCanvas.width,r.iCanvas.height=r.oCanvas.height,r.ictx.drawImage(r.tmpCanvas,0,0)),r.tmpCanvas.width=r.oCanvas.width,r.tmpCanvas.height=r.oCanvas.height,r._needsRefresh|=D|R|I|b,r._histogramRefresh=[1,1,1,1],r._integralRefresh=[1,1,1,1],r._spectrumRefresh=[1,1,1,1],r.selection&&(r._needsRefresh|=M),r},flipHorizontal:function(){var e=this;e.tmpCanvas=e.tmpCanvas||n(e);var t=e.tmpCanvas.getContext("2d");return t.translate(e.width,0),t.scale(-1,1),t.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(t.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=D|I|b,e._integralRefresh=[1,1,1,1],e._spectrumRefresh=[1,1,1,1],e.selection&&(e._needsRefresh|=M),e},flipVertical:function(){var e=this;e.tmpCanvas=e.tmpCanvas||n(e);var t=e.tmpCanvas.getContext("2d");return t.translate(0,e.height),t.scale(1,-1),t.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(t.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=D|I|b,e._integralRefresh=[1,1,1,1],e._spectrumRefresh=[1,1,1,1],e.selection&&(e._needsRefresh|=M),e},draw:function(e,t,n,r){return this},clear:function(){var e=this,t=e.width,n=e.height;return t&&n&&(e._restorable&&e.ictx.clearRect(0,0,t,n),e.octx.clearRect(0,0,t,n),e._needsRefresh|=D|R|I|b,e._histogramRefresh=[1,1,1,1],e._integralRefresh=[1,1,1,1],e._spectrumRefresh=[1,1,1,1],e.selection&&(e._needsRefresh|=M)),e},crop:function(e,t,r,a){var i,o,l,u,h,c,f,d,g=this,p=g.selection,m=g.width,_=g.height;if(arguments.length)h=e,c=t,f=r-e+1,d=a-t+1;else{if(!p)return g;i=v(p[0]*(m-1)),o=v(p[1]*(_-1)),l=v(p[2]*(m-1))-i+1,u=v(p[3]*(_-1))-o+1,h=i,c=o,f=l,d=u,p[0]=0,p[1]=0,p[2]=1,p[3]=1}g.tmpCanvas=g.tmpCanvas||n(g);var y=g.tmpCanvas.getContext("2d");return y.drawImage(g.oCanvas,0,0,m,_,h,c,f,d),g.oCanvas.style.width=f+"px",g.oCanvas.style.height=d+"px",g.oCanvas.width=f*s,g.oCanvas.height=d*s,g.octx.drawImage(g.tmpCanvas,0,0),g._restorable&&(y.drawImage(g.iCanvas,0,0,m,_,h,c,f,d),g.iCanvas.style.width=g.oCanvas.style.width,g.iCanvas.style.height=g.oCanvas.style.height,g.iCanvas.width=g.oCanvas.width,g.iCanvas.height=g.oCanvas.height,g.ictx.drawImage(g.tmpCanvas,0,0)),g.tmpCanvas.width=g.oCanvas.width,g.tmpCanvas.height=g.oCanvas.height,g._needsRefresh|=D|R|I|b,g._histogramRefresh=[1,1,1,1],g._integralRefresh=[1,1,1,1],g._spectrumRefresh=[1,1,1,1],p&&(g._needsRefresh|=M),g},fill:function(e,n,r,a,i){var o,s,l,u,h=this,c=h.selection,f=h.width,d=h.height;c?(o=v(c[0]*(f-1)),s=v(c[1]*(d-1)),l=v(c[2]*(f-1))-o+1,u=v(c[3]*(d-1))-s+1):(o=0,s=0,l=f,u=d),t===n&&(n=o),t===r&&(r=s),t===a&&(a=l),t===i&&(i=u),a&&!f&&i&&!d&&h.createImageData(a,i);var g=h.ictx,p=h.octx;return e=e||0,h._restorable&&(g.fillStyle=e,g.fillRect(n,r,a,i)),p.fillStyle=e,p.fillRect(n,r,a,i),h._needsRefresh|=D|R|I|b,h._histogramRefresh=[1,1,1,1],h._integralRefresh=[1,1,1,1],h._spectrumRefresh=[1,1,1,1],c&&(h._needsRefresh|=M),h},getData:function(){var e,t=this;return t._restorable?(t._needsRefresh&_&&a(t,_),e=t.iData):(t._needsRefresh&y&&a(t,y),e=t.oData),new u(e.data)},getSelectedData:function(){var e,t=this;return t.selection?t._restorable?(t._needsRefresh&w&&i(t,w),e=t.iDataSel):(t._needsRefresh&C&&i(t,C),e=t.oDataSel):t._restorable?(t._needsRefresh&_&&a(t,_),e=t.iData):(t._needsRefresh&y&&a(t,y),e=t.oData),[new u(e.data),e.width,e.height]},getProcessedData:function(){var e=this;return e._needsRefresh&y&&a(e,y),new u(e.oData.data)},getProcessedSelectedData:function(){var e,t=this;return t.selection?(t._needsRefresh&C&&i(t,C),e=t.oDataSel):(t._needsRefresh&y&&a(t,y),e=t.oData),[new u(e.data),e.width,e.height]},setData:function(e){var t=this;return t._needsRefresh&y&&a(t,y),m(t.oData.data,e),t.octx.putImageData(t.oData,0,0),t._needsRefresh|=R|I|b,t._histogramRefresh=[1,1,1,1],t._integralRefresh=[1,1,1,1],t._spectrumRefresh=[1,1,1,1],t.selection&&(t._needsRefresh|=C),t},setSelectedData:function(e){var t=this;if(t.selection){var n=t.selection,r=t.width-1,o=t.height-1,s=v(n[0]*r),l=v(n[1]*o);t._needsRefresh&C&&i(t,C),m(t.oDataSel.data,e),t.octx.putImageData(t.oDataSel,s,l),t._needsRefresh|=y}else t._needsRefresh&y&&a(t,y),m(t.oData.data,e),t.octx.putImageData(t.oData,0,0);return t._needsRefresh|=R|I|b,t._histogramRefresh=[1,1,1,1],t._integralRefresh=[1,1,1,1],t._spectrumRefresh=[1,1,1,1],t},createImageData:function(e,t){var n,a,i=this;return r(i,e,t,S),i._restorable&&(n=i.ictx=i.iCanvas.getContext("2d"),n.createImageData(e,t)),a=i.octx=i.oCanvas.getContext("2d"),a.createImageData(e,t),i._needsRefresh|=D,i.selection&&(i._needsRefresh|=M),i},image:function(e){if(!e)return this;var t,n,i,o,s,l,u,h=this;return e instanceof P&&(e=e.oCanvas),s="undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement,l="undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||e instanceof f,u="undefined"!=typeof Image&&e instanceof Image,s?(i=e.videoWidth,o=e.videoHeight):(i=e.width,o=e.height),u||l||s?(r(h,i,o,S),h._restorable&&(t=h.ictx=h.iCanvas.getContext("2d"),t.drawImage(e,0,0)),n=h.octx=h.oCanvas.getContext("2d"),n.drawImage(e,0,0),h._needsRefresh|=D):(h.oData||(h.createImageData(i,o),a(h,D)),h._restorable&&(t=h.ictx=h.iCanvas.getContext("2d"),m(h.iData.data,e.data),t.putImageData(h.iData,0,0)),n=h.octx=h.oCanvas.getContext("2d"),m(h.oData.data,e.data),n.putImageData(h.oData,0,0)),h._needsRefresh|=R|I|b,h._histogramRefresh=[1,1,1,1],h._integralRefresh=[1,1,1,1],h._spectrumRefresh=[1,1,1,1],h.selection&&(h._needsRefresh|=M),h},getPixel:function(e,t){var n=this;n._needsRefresh&y&&a(n,y);var r=~~(t*n.width+e+.5)<<2,i=n.oData.data;return{r:i[r],g:i[r+1],b:i[r+2],a:i[r+3]}},setPixel:function(e,t,n,r,a,i){var o=this;return o.octx.putImageData(new l([255&n,255&r,255&a,255&i]),e,t),o._needsRefresh|=y|R|I|b,o._histogramRefresh=[1,1,1,1],o._integralRefresh=[1,1,1,1],o._spectrumRefresh=[1,1,1,1],o.selection&&(o._needsRefresh|=C),o},getPixelData:function(){return this._needsRefresh&y&&a(this,y),this.oData},setPixelData:function(e){var t=this;return t.octx.putImageData(e,0,0),t._needsRefresh|=y|R|I|b,t._histogramRefresh=[1,1,1,1],t._integralRefresh=[1,1,1,1],t._spectrumRefresh=[1,1,1,1],t.selection&&(t._needsRefresh|=C),t},integral:function(e){var t=this,n=h.integral,r=t._grayscale;if(null==e){if(t._needsRefresh&I){var a=t.getPixelData().data,i=t.width,o=t.height,s=n(a,i,o,0);t._integral=[s,r?s:n(a,i,o,1),r?s:n(a,i,o,2),n(a,i,o,3)],t._integralRefresh=[0,0,0,0],t._needsRefresh&=O}}else e=e||0,(t._needsRefresh&I||t._integralRefresh[e])&&(r&&!t._integralRefresh[0]?t._integral[e]=t._integral[0]:t._integral[e]=n(t.getPixelData().data,t.width,t.height,e),t._integralRefresh[e]=0,t._needsRefresh&=O);return null==e?t._integral:t._integral[e||0]},histogram:function(e){var t=this,n=h.histogram,r=t._grayscale;if(null==e){if(t._needsRefresh&R){var a=t.getPixelData().data,i=t.width,o=t.height,s=n(a,i,o,0);t._histogram=[s,r?s:n(a,i,o,1),r?s:n(a,i,o,2),null],t._histogramRefresh=[0,0,0,0],t._needsRefresh&=k}}else e=e||0,(t._needsRefresh&R||t._histogramRefresh[e])&&(r&&!t._histogramRefresh[0]?t._histogram[e]=t._histogram[0]:t._histogram[e]=n(t.getPixelData().data,t.width,t.height,e),t._histogramRefresh[e]=0,t._needsRefresh&=k);return null==e?t._histogram:t._histogram[e||0]},spectrum:function(e){var t=this;h.spectrum;return null==e?t._spectrum:t._spectrum[e||0]},toImage:function(e){var t,n=this.oCanvas,r=1;if(t=d.JPG===(16&e)?n.toDataURL(g.JPG,r):d.GIF===(16&e)?n.toDataURL(g.GIF,r):n.toDataURL(g.PNG,r),e&d.IMAGE){var a=new Image;return a.src=t,a}return t},toString:function(){return"[FILTER Image: "+this.name+"]"}});P[o].setImage=P[o].image,P[o].setDimensions=P[o].dimensions,P.Gradient=function(e,t,n,r,a,i){var o=(new P).restorable(!1).createImageData(e,t),s=h.colors_stops(n,r);return o.setData(h.gradient(o.getData(),e,t,s[0],s[1],a,i||h.lerp)),o},P.RadialGradient=function(e,t,n,r,a,i,o,s,l){var u=(new P).restorable(!1).createImageData(e,t),c=h.colors_stops(n,r);return u.setData(h.radial_gradient(u.getData(),e,t,c[0],c[1],a,i,o,s,l||h.lerp)),u},P.PerlinNoise=function(e,t,n,r,a,i,o,s,l,u,c,f){var d=(new P).restorable(!1).createImageData(e,t);return h.perlin&&(n&&h.perlin.seed(n),d.setData(h.perlin(d.getData(),e,t,r,a,i,o,s,l,u,c,f))),d},h.scale=h.resize=e.Interpolation.bilinear;var L=e.ScaledImage=e.Class(P,{name:"ScaledImage",constructor:function F(e,t,n){var r=this;return r instanceof F?(r.scaleX=e||1,r.scaleY=t||r.scaleX,void r.$super("constructor",n)):new F(e,t,n)},scaleX:1,scaleY:1,dispose:function(){var e=this;return e.scaleX=null,e.scaleY=null,e.$super("dispose"),e},clone:function(e){var t=this;return new L(t.scaleX,t.scaleY,!0===e?t.iCanvas:t.oCanvas)},setScale:function(e,t){var n=this,r=arguments.length;return r>0&&null!=e&&(n.scaleX=e,n.scaleY=e),r>1&&null!=t&&(n.scaleY=t),n},image:function(e){if(!e)return this;var t,n,a,i,o,s,l,u,h,c=this,d=c.scaleX,g=c.scaleY;return e instanceof P&&(e=e.oCanvas),l="undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement,u="undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||e instanceof f,h="undefined"!=typeof Image&&e instanceof Image,l?(a=e.videoWidth,i=e.videoHeight):(a=e.width,i=e.height),(h||u||l)&&(o=~~(d*a+.5),s=~~(g*i+.5),r(c,o,s,S),c._restorable&&(t=c.ictx=c.iCanvas.getContext("2d"),t.drawImage(e,0,0,a,i,0,0,o,s)),n=c.octx=c.oCanvas.getContext("2d"),n.drawImage(e,0,0,a,i,0,0,o,s),c._needsRefresh|=D|R|I|b,c._histogramRefresh=[1,1,1,1],c._integralRefresh=[1,1,1,1],c._spectrumRefresh=[1,1,1,1],c.selection&&(c._needsRefresh|=M)),c}});L[o].setImage=L[o].image}(r),!function(e,t){e.IO.Loader=e.IO.Reader=e.Class({name:"IO.Loader",__static__:{load:e.Method(function(e,t,n){return function(e,t,r){return(new n).load(e,t,r)}},e.LATE|e.STATIC)},constructor:function(){},_crossOrigin:null,_responseType:null,dispose:function(){var e=this;return e._crossOrigin=null,e._responseType=null,e},load:function(e,t,n){return null},responseType:function(e){var t=this;return arguments.length?(t._responseType=e,t):t._responseType},crossOrigin:function(e){var t=this;return arguments.length?(t._crossOrigin=e,t):t._crossOrigin}}),e.IO.Loader.prototype.read=e.IO.Loader.prototype.load,e.IO.Writer=e.Class({name:"IO.Writer",__static__:{write:e.Method(function(e,t,n){return function(e,t,r,a){
return(new n).write(e,t,r,a)}},e.LATE|e.STATIC)},constructor:function(){},_encoding:null,dispose:function(){var e=this;return e._encoding=null,e},write:function(e,t,n,r){return null},encoding:function(e){var t=this;return arguments.length?(t._encoding=e,t):t._encoding}})}(r),!function(e,t){function n(e){var t,n;for(e>0&&1>e&&(e*=65536),e=c(e),256>e&&(e|=e<<8),n=0;256>n;n++)t=1&n?d[n]^255&e:d[n]^e>>8&255,g[n]=g[n+256]=t}function r(e,t,n){var r=7&e,a=4>r?t:n,i=4>r?n:t;return(1&r?-a:a)+(2&r?-2*i:2*i)}function a(e,t){var n,a,i,o,s,l=.366025403,u=.211324865,h=(e+t)*l,f=e+h,d=t+h,p=c(f),m=c(d),v=(p+m)*u,_=p-v,y=m-v,w=e-_,C=t-y;w>C?(o=1,s=0):(o=0,s=1);var R=w-o+u,I=C-s+u,b=w-1+2*u,A=C-1+2*u,x=255&p,S=255&m,M=.5-w*w-C*C;0>M?n=0:(M*=M,n=M*M*r(g[x+g[S]],w,C));var D=.5-R*R-I*I;0>D?a=0:(D*=D,a=D*D*r(g[x+o+g[S+s]],R,I));var E=.5-b*b-A*A;return 0>E?i=0:(E*=E,i=E*E*r(g[x+1+g[S+1]],b,A)),40*(n+a+i)}function i(e){return e*e*e*(e*(6*e-15)+10)}function o(e,t,n){return t+e*(n-t)}function s(e,t){var n,a,s,l,u,h,f,d,p,m,v,_,y,w;return n=c(e),a=c(t),u=e-n,h=t-a,f=u-1,d=h-1,s=n+1&255,l=a+1&255,n=255&n,a=255&a,m=i(h),p=i(u),v=r(g[n+g[a]],u,h),_=r(g[n+g[l]],u,d),y=o(m,v,_),v=r(g[s+g[a]],f,h),_=r(g[s+g[l]],f,d),w=o(m,v,_),.507*o(p,y,w)}function l(e,t,n,r,a,i,o,s,l,u,h,c,f){var d,g,p,m,v=0,_=c,y=1,w=0;for(d=0;u>d;d++)g=(r+h[d][0])%i,p=(a+h[d][1])%o,v+=n(_*g*s,_*p*l)*y,_*=2,w+=y,y*=f;m=~~(255*(.5*v/w+.5)),e[t]=m,e[t+1]=m,e[t+2]=m,e[t+3]=255}function u(e,t,n,r,a,i,o,s,l,u,h,c,f){var d,g,p,m,v=0,_=c,y=1,w=0;for(d=0;u>d;d++)g=(r+h[d][0])%i,p=(a+h[d][1])%o,v+=n(_*g*s,_*p*l)*y,_*=2,w+=y,y*=f;m=~~(16777215*(.5*v/w+.5)),e[t]=m>>>16&255,e[t+1]=m>>>8&255,e[t+2]=255&m,e[t+3]=255}var h=e.Util.Image,c=(e.Image,Math.floor),f=(Math.sin,Math.cos,e.CONST.PI2,e.Array8U),d=new f([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),g=new f(d);h.perlin=function(e,t,n,r,i,o,h,c,f,d,g,p){var m,v,_,y,w,C,R=1/o,I=1/h,b=p?s:a,A=i?l:u,x=e.length,S=t>>>1,M=n>>>1;if(d=d||1,g=g||.5,c=c||1,f=f||[[0,0]],r)for(m=0,v=0,w=0;x>w;w+=4,m++)m>=t&&(m=0,v++),_=m>S?t-1-m:m,y=v>M?n-1-v:v,m>_||v>y?(C=y*t+_<<2,e[w]=e[C],e[w+1]=e[C+1],e[w+2]=e[C+2],e[w+3]=255):A(e,w,b,_,y,t,n,R,I,c,f,d,g);else for(m=0,v=0,w=0;x>w;w+=4,m++)m>=t&&(m=0,v++),A(e,w,b,m,v,t,n,R,I,c,f,d,g);return e},h.perlin.seed=n}(r),r});