/**
*
*   FILTER.js
*   @version: 0.9.5
*   @built on 2016-08-15 18:26:27
*   @dependencies: Classy.js, Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e,n){"use strict";function r(t,e,n,r){return t?e.map(function(e,a){return(n?t[a]:t[e])||(r?r(e):null)}):[]}var a="Classy,Asynchronous".split(/\s*,\s*/);"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[e]=n.apply(t,r(module.$deps,a,!1,function(t){return require("./"+t.toLowerCase())}))):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)?define(e,["module"].concat(a),function(e){return n.moduleUri=e.uri,n.apply(t,r(Array.prototype.slice.call(arguments,1),a,!0))}):e in t||(t[e]=n.apply(t,r(t,a)))&&"function"==typeof define&&define.amd&&define(function(){return t[e]})}(this,"FILTER",function e(n,r){"use strict";var a={VERSION:"0.9.5",Classy:n,Asynchronous:r,Class:n.Class,Path:r.path(e.moduleUri)};return!function(t,e,n){var r,a,i="prototype",o="hasOwnProperty",s=Object.keys,l=(Object[i],Function[i],Array[i]),u=e.Path,h=e.Classy.Merge,c=e.Asynchronous,f=c.isPlatform(c.Platform.NODE),d=c.isPlatform(c.Platform.BROWSER),g=c.supportsMultiThreading(),p=c.isThread(null,!0),m=c.isThread(),_="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",v="undefined"!=typeof navigator&&navigator.platform?navigator.platform:"",y="undefined"!=typeof navigator&&navigator.vendor?navigator.vendor:"",w=function(){},C=function(t){return function e(){var n=this;return n instanceof e?(n.$super("constructor"),void t.apply(n,1===arguments.length&&!0===arguments[0].__arguments__?arguments[0]:arguments)):arguments.length?(arguments.__arguments__=!0,new e(arguments)):new e}},I=(e.devicePixelRatio=(d&&!m?window.devicePixelRatio:1)||1,e._notSupportClamp="undefined"==typeof Uint8ClampedArray),b=0,R=e.Browser={isNode:f,isBrowser:d,isWorker:p,isInsideWorker:m,supportsWorker:g,isPhantom:/PhantomJS/.test(_),isOpera:d&&/Opera|OPR\//.test(_),isFirefox:d&&/Firefox\//.test(_),isChrome:d&&/Chrome\//.test(_),isSafari:d&&/Apple Computer/.test(y),isKhtml:d&&/KHTML\//.test(_),isIE:d&&(/MSIE \d/.test(_)||/Trident\/\d/.test(_)),isGecko:d&&/gecko\/\d/i.test(_),isWebkit:d&&/WebKit\//.test(_),isMac_geLion:d&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(_),isMac_geMountainLion:d&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(_),isMobile:!1,isIOS:/AppleWebKit/.test(_)&&/Mobile\/\w+/.test(_),isWin:/windows/i.test(v),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1};R.isMobile=R.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(_),R.isMac=R.isIOS||/Mac/.test(v),R.isIE_lt8=R.isIE&&!m&&(null==document.documentMode||document.documentMode<8),R.isIE_lt9=R.isIE&&!m&&(null==document.documentMode||document.documentMode<9),R.isQtWebkit=R.isWebkit&&/Qt\/\d+\.\d+/.test(_),e.getPath=c.path,e.uuid=function(t){return[t||"filter",(new Date).getTime(),++b].join("_")},e.Array=Array,e.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,e.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,e.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,e.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,e.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,e.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,e.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,e.ImArray=I?e.Array8U:Uint8ClampedArray,e.ImArrayCopy=R.isOpera?e.Array8U:e.ImArray,e.ColorTable=e.ImArrayCopy,e.AffineMatrix=e.ColorMatrix=e.ConvolutionMatrix=e.Array32F,e.CHANNEL={R:0,G:1,B:2,A:3,RED:0,GREEN:1,BLUE:2,ALPHA:3,Y:1,CB:2,CR:0,H:0,S:2,V:1,I:1,HUE:0,SATURATION:2,INTENSITY:1,CY:2,MA:0,YE:1,K:3,CYAN:2,MAGENTA:0,YELLOW:1,BLACK:3},e.STRIDE={CHANNEL:[0,0,1],X:[0,1,4],Y:[1,0,4],RGB:[0,1,2],ARGB:[3,0,1,2],RGBA:[0,1,2,3],BGR:[2,1,0],ABGR:[3,2,1,0],BGRA:[2,1,0,3]},e.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:3,TILE:4,STRETCH:5,INTENSITY:6,HUE:7,SATURATION:8,GRAY:9,RGB:10,HSV:11,PATTERN:12,COLOR_CHANNEL:13,COLOR_MASK:14,CHANNEL_MASK:15},e.LUMA=new e.Array32F([.212671,.71516,.072169]),e.FORMAT={IMAGE:1024,DATA:2048,PNG:2,JPG:3,JPEG:4,GIF:5,BMP:6,TGA:7,RGBE:8},e.MIME={PNG:"image/png",JPG:"image/jpeg",JPEG:"image/jpeg",GIF:"image/gif",BMP:"image/bmp"},e.CONSTANTS=e.CONST={X:0,Y:1,Z:2,PI:Math.PI,PI2:2*Math.PI,PI_2:Math.PI/2,toRad:Math.PI/180,toDeg:180/Math.PI},r=f?function(t,e){return null==t||t instanceof e?t:Array.isArray(t)?Array===e?t:new e(t):(null==t.length&&(t.length=Object.keys(t).length),Array===e?Array.prototype.slice.call(t):new e(Array.prototype.slice.call(t)))}:function(t,e){return t},I=e._notSupportClamp=I||R.isOpera,e.Util={Array:{hasClampedArray:"undefined"!=typeof Uint8ClampedArray,hasArrayset:"undefined"!=typeof Int16Array&&"function"==typeof Int16Array[i].set,hasSubarray:"function"==typeof e.Array32F[i].subarray,typed:r,typed_obj:f?function(t,e){return null==t?t:e?JSON.parse(t):JSON.stringify(t)}:function(t){return t}},String:{},List:{},Math:{},IO:{},Filter:{},Image:{},GLSL:{},SVG:{}},e.IO={},e.Codec={},e.Interpolation={},e.Transform={},e.MachineLearning=e.ML={},e.GLSL={},e.SVG={},e.NotImplemented=function(t){return t?function(){throw new Error('Method "'+t+'" not Implemented!')}:function(){throw new Error("Method not Implemented!")}},a=e.log=p?c.log:"undefine"!=typeof console&&console.log?function(t){console.log(t)}:function(t){},e.warning=function(t){a("WARNING: "+t)},e.error=function(t,e){if(a("ERROR: "+t),e)throw new Error(t)};var A=e.FilterThread=e.Class(c,{path:u,name:null,_listener:null,_rand:null,constructor:function(){var t=this,n=null;p&&t.initThread().listen("load",function(t){t&&t.filter&&(n&&(n.dispose(!0),n=null),n=c.load("FILTER."+t.filter))}).listen("import",function(t){t&&t["import"]&&t["import"].length&&c.importScripts(t["import"].join?t["import"].join(","):t["import"])}).listen("apply",function(a){if(n&&a&&a.im){var i=a.im;i[0]=r(i[0],e.ImArray),a.params&&n.unserializeFilter(a.params),a.inputs&&n.unserializeInputs(a.inputs,i),i=n._apply(i[0],i[1],i[2]),t.send("apply",{im:n._update?i:!1,meta:n.hasMeta?n.getMeta():null})}else t.send("apply",{im:null})}).listen("dispose",function(e){n&&(n.dispose(!0),n=null),t.dispose(!0)})},dispose:function(t){var e=this;return e.path=null,e.name=null,e._rand=null,e._listener&&(e._listener.cb=null,e._listener=null),e.$super("dispose",t),e},thread:function(t,e){var n=this;return arguments.length||(t=!0),t=!!t,t&&!n.$thread?(null===n._rand&&(n._rand=f?"":(-1===n.path.file.indexOf("?")?"?":"&")+(new Date).getTime()),n.fork("FILTER.FilterThread",u.file!==n.path.file?[u.file,n.path.file+n._rand]:n.path.file+n._rand),e&&e.length&&n.send("import",{"import":e.join?e.join(","):e}),n.send("load",{filter:n.name}),n.listen("apply",n._listener=function r(t){r.cb&&r.cb(t)})):!t&&n.$thread&&(n._listener.cb=null,n._listener=null,n.unfork()),n},sources:function(){if(!arguments.length)return this;var t=arguments[0]instanceof Array?arguments[0]:l.slice.call(arguments);if(t.length){var e,n=[];for(e=0;e<t.length;e++)n.push(c.blob("function"==typeof t[e]?t[e].toString():t[e]));this.send("import",{"import":n.join(",")})}return this},scripts:function(){if(!arguments.length)return this;var t=arguments[0]instanceof Array?arguments[0]:l.slice.call(arguments);return t.length&&this.send("import",{"import":t.join(",")}),this}}),x=e.Filter=e.Class(A,{name:"Filter",constructor:function(){var t=this;t._inputs={}},id:null,_isOn:!0,_update:!0,_onComplete:null,_inputs:null,hasInputs:!1,hasMeta:!1,_meta:null,mode:0,dispose:function(){var t=this;return t.name=null,t.id=null,t._isOn=null,t._update=null,t._onComplete=null,t._inputs=null,t.hasInputs=null,t.hasMeta=null,t._meta=null,t.mode=null,t.$super("dispose"),t},worker:A[i].thread,setInput:function(t,e){var n=this;return t=String(t),null===e?n._inputs[t]&&delete n._inputs[t]:n._inputs[t]=[null,e],n},unsetInput:function(t){var e=this;return t=String(t),e._inputs[t]&&delete e._inputs[t],e},delInput:null,resetInputs:function(){return this._inputs={},this},input:function(t){var e=this._inputs[String(t)];return e?((null==e[0]||e[1]&&e[1]._refresh)&&(e[0]=e[1].getSelectedData()),e[0]||null):null},getInput:null,serialize:function(){return null},unserialize:function(t){return this},serializeInputs:function(t){if(!this.hasInputs)return null;var e,n,r,a=this._inputs,i=s(a),o=i.length;if(!o)return null;for(r={},n=0;o>n;n++)e=a[i[n]],(null==e[0]||e[1]&&e[1]._refresh)&&(r[i[n]]=t===e[1]?!0:e[1].getSelectedData());return r},unserializeInputs:function(t,n){var a=this;if(!t||!a.hasInputs)return a;var i,o,l=a._inputs,u=s(t),h=u.length,c=e.ImArray;for(o=0;h>o;o++)i=t[u[o]],i&&(!0===i?i=n:i[0]=r(i[0],c),l[u[o]]=[i,null]);return a},serializeFilter:function(){var t=this;return{filter:t.name,_isOn:t._isOn,_update:t._update,params:t.serialize()}},unserializeFilter:function(t){var e=this;return t&&e.name===t.filter&&(e._isOn=t._isOn,e._update=t._update,e._isOn&&t.params&&e.unserialize(t.params)),e},complete:function(t){return this._onComplete=t||null,this},setMode:function(t){return this.mode=t,this},getMode:function(){return this.mode},isOn:function(){return this._isOn},update:function(t){return arguments.length||(t=!0),this._update=!!t,this},turnOn:function(t){return arguments.length||(t=!0),this._isOn=!!t,this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this.resetInputs(),this},canRun:function(){return this._isOn},meta:function(){return this._meta},getMeta:null,setMeta:function(t){return this._meta=t,this},combineWith:function(t){return this},_apply:function(t,e,n,r){return t},apply:function(t,n,a){var i,o,s=this;return s.canRun()?(arguments.length<3&&(n&&n.setSelectedData?a=null:"function"==typeof n?(a=n,n=t):(n=t,a=null)),t&&n&&(a=a||s._onComplete,i=t.getSelectedData(),s.$thread?(s._listener.cb=function(t){s._listener.cb=null,t&&(t.meta&&s.setMeta(t.meta),t.im&&s._update&&(s.hasMeta&&null!=s._meta._IMG_WIDTH&&n.dimensions(s._meta._IMG_WIDTH,s._meta._IMG_HEIGHT),n.setSelectedData(r(t.im,e.ImArray)))),a&&a.call(s)},s.send("apply",{im:i,params:s.serializeFilter(),inputs:s.serializeInputs(t)})):(o=s._apply(i[0],i[1],i[2],t),s._update&&(s.hasMeta&&null!=s._meta._IMG_WIDTH&&n.dimensions(s._meta._IMG_WIDTH,s._meta._IMG_HEIGHT),n.setSelectedData(o)),a&&a.call(s))),t):t},toString:function(){return"[FILTER: "+this.name+"]"}});e.Filter[i].getMeta=e.Filter[i].meta,e.Filter[i].getInput=e.Filter[i].input,e.Filter[i].delInput=e.Filter[i].unsetInput,e.Filter.get=function(t){if(!t||!t.length)return null;if(-1<t.indexOf(".")){t=t.split(".");var n,r,a=t.length,i=e;for(n=0;a>n;n++){if(r=t[n],!i[r])return null;i=i[r]}return i}return e[t]||null},e.Create=function(t){t=h({init:w,name:"PluginFilter"},t);var n=t.name;return t.constructor=C(t.init),null==t._apply&&"function"==typeof t.apply&&(t._apply=t.apply),"function"==typeof t.meta&&t.meta!==x[i].meta?t.getMeta=t.meta:"function"==typeof t.getMeta&&t.getMeta!==x[i].getMeta&&(t.meta=t.getMeta),delete t.init,t[o]("apply")&&delete t.apply,e[n]=e.Class(x,t)}}(this,a),!function(t,e){function n(t){return t.toString().match(lt)[1]||""}function r(t,e,n){n=n||0;var r,a,i=e.length,o=31&i;for(r=0;i>r;r+=32)a=r,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a,t[a+n]=e[a],++a;if(o)for(a=i-o;i>a;a++)t[a+n]=e[a]}function a(t,e,n){return t>n?n:e>t?e:t}function i(t){return Z(2,tt(at(t)))}function o(t,e){var n=new U(2);return n[0]=t||0,n[1]=e||0,n}function s(t,e,n){var r=new U(3);return r[0]=t||0,r[1]=e||0,r[2]=n||0,r}function l(t,e,n){return o(t[0]+n*(e[0]-t[0]),t[1]+n*(e[1]-t[1]))}function u(t,e,n){return s(t[0]+n*(e[0]-t[0]),t[1]+n*(e[1]-t[1]),t[2]+n*(e[2]-t[2]))}function h(t,e){return t[0]*e[1]-e[0]*t[1]}function c(t,e){var n;return 0>t&&(t=-t),0>e&&(e=-e),0===t?e:0===e?t:t>e?(n=e/t,t*Q(1+n*n)):(n=t/e,e*Q(1+n*n))}function f(t,e){var n,r,a,i,s;return n=o(t[0]-e[0],t[1]-e[1]),0===n[1]&&0===n[0]?null:(r=o(0,0),0===n[0]&&(r[0]=10),0===n[1]&&(r[1]=10),0!==n[1]&&0!==n[0]&&(a=n[1]/n[0],i=-n[0]/n[1],r[0]=10,r[1]=i*r[0]),s=c(r[0],r[1]),r[0]/=s,r[1]/=s,0>h(n,r)&&(r[0]=-r[0],r[1]=-r[1]),r)}function d(t,e,n,r,a,i,o){i=nt(i,e-1),o=nt(o,n-1);var s,l,u,h,c=i-r+1,f=o-a+1,d=c*f<<2,g=new B(d),p=c<<2;for(s=a,l=a*e,u=0;o>=s;s++,l+=e,u+=p)h=l+r<<2,g.set(t.subarray(h,h+p),u);return g}function g(t,e,n,a,i,o,s){o=nt(o,e-1),s=nt(s,n-1);var l,u,h,c,f=o-a+1,d=s-i+1,g=f*d<<2,p=new B(g),m=f<<2;for(l=i,u=i*e,h=0;s>=l;l++,u+=e,h+=m)c=u+a<<2,r(p,t.slice(c,c+m),h);return p}function p(t,e,n,r,a,i,o){r=r||0,a=a||0,i=i||0,o=o||0;var s,l,u,h,c=e+i+r,f=n+o+a,d=c*f<<2,g=new B(d),p=e<<2,m=c<<2,_=o*m,v=i<<2;for(s=0,l=0,u=_;n>s;s++,l+=e,u+=m)h=l<<2,g.set(t.subarray(h,h+p),v+u);return g}function m(t,e,n,a,i,o,s){a=a||0,i=i||0,o=o||0,s=s||0;var l,u,h,c,f=e+o+a,d=n+s+i,g=f*d<<2,p=new B(g),m=e<<2,_=f<<2,v=s*_,y=o<<2;for(l=0,u=0,h=v;n>l;l++,u+=e,h+=_)c=u<<2,r(p,t.slice(c,c+m),y+h);return p}function _(t,e,n,r,a,i,o,s){if(r=nt(r,e-1),a=nt(a,n-1),i=nt(i,e-1),o=nt(o,n-1),0===r&&0===a&&e===i+1&&n===o+1)return!0===s?t:new N(t);if(!t.length||r>i||a>o)return new B(0);var l,u,h,c,f=i-r+1,d=o-a+1,g=f*d<<2,p=new B(g);for(l=r,u=a,h=0;o>=u;h+=4,l++)l>i&&(l=r,u++),c=u*e+l<<2,p[h]=t[c],p[h+1]=t[c+1],p[h+2]=t[c+2],p[h+3]=t[c+3];return p}function v(t,e,n,r,a,i,o,s,l,u,h,c){var f,d,g,p;if(!(t.length&&r.length&&a&&i&&e&&n))return t;for(o=nt(o,a-1),s=nt(s,i-1),h=nt(h,e-1),c=nt(c,n-1),l=nt(l,a-1),u=nt(u,i-1),h-=o,c-=s,g=o,p=s;u>=p;g++)g>l&&(g=o,p++),p+c>=n||g+h>=e||(f=p*a+g<<2,d=(p+c)*e+g+h<<2,t[d]=r[f],t[d+1]=r[f+1],t[d+2]=r[f+2],t[d+3]=r[f+3]);return t}function y(t,e,n,r,a,i,o,s){if(a=nt(a,e-1),i=nt(i,n-1),o=nt(o,e-1),s=nt(s,n-1),!t.length||a>o||i>s)return t;var l,u,h,c=255&r[0],f=255&r[1],d=255&r[2],g=3<r.length?255&r[3]:255;for(l=a,u=i;s>=u;l++)l>o&&(l=a,u++),h=u*e+l<<2,t[h]=c,t[h+1]=f,t[h+2]=d,t[h+3]=g;return t}function w(t,e,n,r){r=r||0;var a,i,o,s,l=t.length,u=l>>>2,h=e<<2,c=(31&e)<<2,f=new U(u);for(o=0,a=0,i=r;i<rowlen;i+=128)a+=t[i],f[o++]=a,a+=t[i+4],f[o++]=a,a+=t[i+8],f[o++]=a,a+=t[i+12],f[o++]=a,a+=t[i+16],f[o++]=a,a+=t[i+20],f[o++]=a,a+=t[i+24],f[o++]=a,a+=t[i+28],f[o++]=a,a+=t[i+32],f[o++]=a,a+=t[i+36],f[o++]=a,a+=t[i+40],f[o++]=a,a+=t[i+44],f[o++]=a,a+=t[i+48],f[o++]=a,a+=t[i+52],f[o++]=a,a+=t[i+56],f[o++]=a,a+=t[i+60],f[o++]=a,a+=t[i+64],f[o++]=a,a+=t[i+68],f[o++]=a,a+=t[i+72],f[o++]=a,a+=t[i+76],f[o++]=a,a+=t[i+80],f[o++]=a,a+=t[i+84],f[o++]=a,a+=t[i+88],f[o++]=a,a+=t[i+92],f[o++]=a,a+=t[i+96],f[o++]=a,a+=t[i+100],f[o++]=a,a+=t[i+104],f[o++]=a,a+=t[i+108],f[o++]=a,a+=t[i+112],f[o++]=a,a+=t[i+116],f[o++]=a,a+=t[i+120],f[o++]=a,a+=t[i+124],f[o++]=a;if(c)for(i=rowlen-c+r;i<rowlen;i+=4,o++)a+=t[i],f[o]=a;for(s=0,o=0,a=0,i=h+r;l>i;i+=128)a+=t[i],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+4],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+8],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+12],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+16],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+20],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+24],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+28],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+32],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+36],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+40],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+44],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+48],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+52],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+56],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+60],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+64],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+68],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+72],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+76],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+80],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+84],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+88],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+92],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+96],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+100],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+104],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+108],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+112],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+116],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+120],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+124],f[o+e]=f[o]+a,++o,++s>=e&&(s=0,a=0);if(c)for(i=l-c+r;l>i;i+=4,s++,o++)s>=e&&(s=0,a=0),a+=t[i],f[o+e]=f[o]+a;return f}function C(t,e,n,r,a){r=r||0;var i,o,s,l=t.length,u=l>>>2,h=(31&u)<<2;for(o=new U(256),i=r;l>i;i+=128)o[t[i]]++,o[t[i+4]]++,o[t[i+8]]++,o[t[i+12]]++,o[t[i+16]]++,o[t[i+20]]++,o[t[i+24]]++,o[t[i+28]]++,o[t[i+32]]++,o[t[i+36]]++,o[t[i+40]]++,o[t[i+44]]++,o[t[i+48]]++,o[t[i+52]]++,o[t[i+56]]++,o[t[i+60]]++,o[t[i+64]]++,o[t[i+68]]++,o[t[i+72]]++,o[t[i+76]]++,o[t[i+80]]++,o[t[i+84]]++,o[t[i+88]]++,o[t[i+92]]++,o[t[i+96]]++,o[t[i+100]]++,o[t[i+104]]++,o[t[i+108]]++,o[t[i+112]]++,o[t[i+116]]++,o[t[i+120]]++,o[t[i+124]]++;if(h)for(i=l-h+r;l>i;i+=4)o[t[i]]++;if(!0===a)return o;for(s=0,i=0;256>i;i+=64)s+=o[i],o[i]=s,s+=o[i+1],o[i+1]=s,s+=o[i+2],o[i+2]=s,s+=o[i+3],o[i+3]=s,s+=o[i+4],o[i+4]=s,s+=o[i+5],o[i+5]=s,s+=o[i+6],o[i+6]=s,s+=o[i+7],o[i+7]=s,s+=o[i+8],o[i+8]=s,s+=o[i+9],o[i+9]=s,s+=o[i+10],o[i+10]=s,s+=o[i+11],o[i+11]=s,s+=o[i+12],o[i+12]=s,s+=o[i+13],o[i+13]=s,s+=o[i+14],o[i+14]=s,s+=o[i+15],o[i+15]=s,s+=o[i+16],o[i+16]=s,s+=o[i+17],o[i+17]=s,s+=o[i+18],o[i+18]=s,s+=o[i+19],o[i+19]=s,s+=o[i+20],o[i+20]=s,s+=o[i+21],o[i+21]=s,s+=o[i+22],o[i+22]=s,s+=o[i+23],o[i+23]=s,s+=o[i+24],o[i+24]=s,s+=o[i+25],o[i+25]=s,s+=o[i+26],o[i+26]=s,s+=o[i+27],o[i+27]=s,s+=o[i+28],o[i+28]=s,s+=o[i+29],o[i+29]=s,s+=o[i+30],o[i+30]=s,s+=o[i+31],o[i+31]=s,s+=o[i+32],o[i+32]=s,s+=o[i+33],o[i+33]=s,s+=o[i+34],o[i+34]=s,s+=o[i+35],o[i+35]=s,s+=o[i+36],o[i+36]=s,s+=o[i+37],o[i+37]=s,s+=o[i+38],o[i+38]=s,s+=o[i+39],o[i+39]=s,s+=o[i+40],o[i+40]=s,s+=o[i+41],o[i+41]=s,s+=o[i+42],o[i+42]=s,s+=o[i+43],o[i+43]=s,s+=o[i+44],o[i+44]=s,s+=o[i+45],o[i+45]=s,s+=o[i+46],o[i+46]=s,s+=o[i+47],o[i+47]=s,s+=o[i+48],o[i+48]=s,s+=o[i+49],o[i+49]=s,s+=o[i+50],o[i+50]=s,s+=o[i+51],o[i+51]=s,s+=o[i+52],o[i+52]=s,s+=o[i+53],o[i+53]=s,s+=o[i+54],o[i+54]=s,s+=o[i+55],o[i+55]=s,s+=o[i+56],o[i+56]=s,s+=o[i+57],o[i+57]=s,s+=o[i+58],o[i+58]=s,s+=o[i+59],o[i+59]=s,s+=o[i+60],o[i+60]=s,s+=o[i+61],o[i+61]=s,s+=o[i+62],o[i+62]=s,s+=o[i+63],o[i+63]=s;return o}function I(t,e,n,r){return null}function b(t,e,n,r,a,i){var o,s,l,u,h,c,f,d=t.length,g=e<<2,p=(31&e)<<2;for(h=0,u=0,o=s=0;g>u;u+=128)l=t[u],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+4],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+8],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+12],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+16],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+20],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+24],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+28],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+32],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+36],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+40],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+44],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+48],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+52],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+56],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+60],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+64],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+68],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+72],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+76],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+80],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+84],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+88],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+92],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+96],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+100],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+104],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+108],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+112],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+116],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+120],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+124],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s,++h;if(p)for(u=g-p;g>u;u+=4,h++)l=t[u],o+=l,r[h]=o,i[h]=l,s+=l*l,a[h]=s;for(c=0,f=1,h=0,o=0,s=0,u=g;d>u;u+=128)l=t[u],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+4],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+8],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+12],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+16],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+20],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+24],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+28],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+32],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+36],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+40],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+44],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+48],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+52],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+56],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+60],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+64],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+68],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+72],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+76],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+80],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+84],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+88],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+92],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+96],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+100],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+104],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+108],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+112],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+116],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+120],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0),l=t[u+124],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0),++h,++c>=e&&(c=0,f++,o=s=0);if(p)for(u=d-p;d>u;u+=4,c++,h++)c>=e&&(c=0,f++,o=s=0),l=t[u],o+=l,r[h+e]=r[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(f>1?i[h-e-e]:0)+(c>0?i[h-1-e]:0)}function R(t,e,n,r,a,i){var o,s,l,u,h,c,f,d,g,p,m,_,v,y=r.length,w=e-1,C=n-1,I=e-2,b=n-2,R=e<<1,A=e<<2;for(v=new Y(y),o=2,s=2,l=R;I>o;s++,l+=e)s>=b&&(s=2,l=R,o++),d=o+l<<2,g=d+A,p=g+A,m=d-A,_=m-A,u=(t[_-8]<<1)+(t[m-8]<<2)+(t[d-8]<<2)+t[d-8]+(t[g-8]<<2)+(t[p-8]<<1)+(t[_-4]<<2)+(t[m-4]<<3)+t[m-4]+(t[d-4]<<4)-(t[d-4]<<2)+(t[g-4]<<3)+t[g-4]+(t[p-4]<<2)+(t[_]<<2)+t[_]+(t[m]<<4)-(t[m]<<2)+(t[d]<<4)-t[d]+(t[g]<<4)-(t[g]<<2)+(t[p]<<2)+t[p]+(t[_+4]<<2)+(t[m+4]<<3)+t[m+4]+(t[d+4]<<4)-(t[d+4]<<2)+(t[g+4]<<3)+t[g+4]+(t[p+4]<<2)+(t[_+8]<<1)+(t[m+8]<<2)+(t[d+8]<<2)+t[d+8]+(t[g+8]<<2)+(t[p+8]<<1),v[d]=(103*u+8192&4294967295)>>>14&255|0;if(a){for(o=1,s=1,l=e;w>o;s++,l+=e)s>=C&&(s=1,l=e,o++),d=l+o,g=d+e,m=d-e,r[d]=v[m+1]-v[m-1]-v[d-1]-v[d-1]+v[d+1]+v[d+1]-v[g-1]+v[g+1],a[d]=v[m-1]+v[m]+v[m]+v[m+1]-v[g-1]-v[g]-v[g]-v[g+1];if(i){for(o=0,u=h=0;e>o;o++)u+=r[o],h+=a[o],r[o]=u,a[o]=h;for(o=e,l=0,u=h=0;y>o;o++,l++)l>=e&&(l=0,u=h=0),u+=r[o],r[o]=r[o-e]+u,h+=a[o],a[o]=a[o-e]+h}}else{for(o=1,s=1,l=e;w>o;s++,l+=e)s>=C&&(s=1,l=e,o++),d=l+o,g=d+e,m=d-e,c=v[m+1]-v[m-1]-v[d-1]-v[d-1]+v[d+1]+v[d+1]-v[g-1]+v[g+1],f=v[m-1]+v[m]+v[m]+v[m+1]-v[g-1]-v[g]-v[g]-v[g+1],r[d]=rt(c)+rt(f);if(i){for(o=0,u=0;e>o;o++)u+=r[o],r[o]=u;for(o=e,l=0,u=0;y>o;o++,l++)l>=e&&(l=0,u=0),u+=r[o],r[o]=r[o-e]+u}}}function A(t,e,n,r,a,i,o,s,l,u,h){var c,f,d,g,p,m,_,v,y,w,C,I,b,R,A,x,M,D,S,E,O,G,k,L,T,P,F,H,N,W,Y,K,j,X,z,$,q,V,J,Q,Z,tt,et,nt,rt,at,it,ot,st=e.length,lt=st>>>2,ut=o,ht=s;if(v=ut*ht,m=ut>>>1,_=n*(ht>>>1),C=-m-1,b=-_-n,I=m,R=_,W=0,K=n-1,Y=0,j=lt-n,f=(lt<<1)+lt,w=(n<<1)+n,y=e,e=new B(st),c=new U(f),h=h||1,i)for(E=a[0],O=a[v>>>1],G=O-E,k=i[0],L=i[v>>>1],T=L-k,it=0;h>it;it++){for(ot=e,e=y,y=ot,A=0,x=0,d=g=p=0,M=0;n>M;M++,A+=4,x+=3)d+=e[A],g+=e[A+1],p+=e[A+2],c[x]=d,c[x+1]=g,c[x+2]=p;for(x=0,M=0,d=g=p=0,A=w+n;st>A;A+=4,x+=3,M++)M>=n&&(M=0,d=g=p=0),d+=e[A],g+=e[A+1],p+=e[A+2],c[x+w]=c[x]+d,c[x+w+1]=c[x+1]+g,c[x+w+2]=c[x+2]+p;for(M=0,D=0,S=0,A=0;st>A;A+=4,M++)M>=n&&(M=0,D++,S+=n),P=M+C,F=S+b,H=M+I,N=S+R,P=W>P?W:P,H=H>K?K:H,F=Y>F?Y:F,N=N>j?j:N,X=P+F,q=H+N,z=H+F,$=P+N,X=(X<<1)+X,z=(z<<1)+z,$=($<<1)+$,q=(q<<1)+q,Z=E*(c[q]-c[z]-c[$]+c[X])+G*e[A],tt=E*(c[q+1]-c[z+1]-c[$+1]+c[X+1])+G*e[A+1],et=E*(c[q+2]-c[z+2]-c[$+2]+c[X+2])+G*e[A+2],nt=k*(c[q]-c[z]-c[$]+c[X])+T*e[A],rt=k*(c[q+1]-c[z+1]-c[$+1]+c[X+1])+T*e[A+1],at=k*(c[q+2]-c[z+2]-c[$+2]+c[X+2])+T*e[A+2],V=l*Z+u*nt|0,J=l*tt+u*rt|0,Q=l*et+u*at|0,y[A]=V,y[A+1]=J,y[A+2]=Q,y[A+3]=e[A+3]}else for(E=a[0],O=a[v>>>1],G=O-E,it=0;h>it;it++){for(ot=e,e=y,y=ot,A=0,x=0,d=g=p=0,M=0;n>M;M++,A+=4,x+=3)d+=e[A],g+=e[A+1],p+=e[A+2],c[x]=d,c[x+1]=g,c[x+2]=p;for(x=0,M=0,d=g=p=0,A=w+n;st>A;A+=4,x+=3,M++)M>=n&&(M=0,d=g=p=0),d+=e[A],g+=e[A+1],p+=e[A+2],c[x+w]=c[x]+d,c[x+w+1]=c[x+1]+g,c[x+w+2]=c[x+2]+p;for(M=0,D=0,S=0,A=0;st>A;A+=4,M++)M>=n&&(M=0,D++,S+=n),P=M+C,F=S+b,H=M+I,N=S+R,P=W>P?W:P,H=H>K?K:H,F=Y>F?Y:F,N=N>j?j:N,X=P+F,q=H+N,z=H+F,$=P+N,X=(X<<1)+X,z=(z<<1)+z,$=($<<1)+$,q=(q<<1)+q,Z=E*(c[q]-c[z]-c[$]+c[X])+G*e[A],tt=E*(c[q+1]-c[z+1]-c[$+1]+c[X+1])+G*e[A+1],et=E*(c[q+2]-c[z+2]-c[$+2]+c[X+2])+G*e[A+2],V=l*Z+u|0,J=l*tt+u|0,Q=l*et+u|0,y[A]=V,y[A+1]=J,y[A+2]=Q,y[A+3]=e[A+3]}return y}function x(t,e,n,r,a,i,o,s,l,u,h){var c,f,d,g,p,m,_,v,y,w,C,I,b,R,A,x,M,D,S,E,O,G,k,L,T,P,F,H,N,W,Y,K,j,X,z,$,q,V,J,Q,Z,tt,et,nt,rt,at,it,ot,st=e.length,lt=st>>>2,ut=o,ht=s;if(v=ut*ht,m=ut>>>1,_=n*(ht>>>1),C=-m-1,b=-_-n,I=m,R=_,W=0,K=n-1,Y=0,j=lt-n,f=(lt<<1)+lt,w=(n<<1)+n,y=e,e=new B(st),c=new U(f),h=h||1,i)for(E=a[0],O=a[v>>>1],G=O-E,k=i[0],L=i[v>>>1],T=L-k,it=0;h>it;it++){for(ot=e,e=y,y=ot,A=0,x=0,d=g=p=0,M=0;n>M;M++,A+=4,x+=3)d+=e[A],g+=e[A+1],p+=e[A+2],c[x]=d,c[x+1]=g,c[x+2]=p;for(x=0,M=0,d=g=p=0,A=w+n;st>A;A+=4,x+=3,M++)M>=n&&(M=0,d=g=p=0),d+=e[A],g+=e[A+1],p+=e[A+2],c[x+w]=c[x]+d,c[x+w+1]=c[x+1]+g,c[x+w+2]=c[x+2]+p;for(M=0,D=0,S=0,A=0;st>A;A+=4,M++)M>=n&&(M=0,D++,S+=n),P=M+C,F=S+b,H=M+I,N=S+R,P=W>P?W:P,H=H>K?K:H,F=Y>F?Y:F,N=N>j?j:N,X=P+F,q=H+N,z=H+F,$=P+N,X=(X<<1)+X,z=(z<<1)+z,$=($<<1)+$,q=(q<<1)+q,Z=E*(c[q]-c[z]-c[$]+c[X])+G*e[A],tt=E*(c[q+1]-c[z+1]-c[$+1]+c[X+1])+G*e[A+1],et=E*(c[q+2]-c[z+2]-c[$+2]+c[X+2])+G*e[A+2],nt=k*(c[q]-c[z]-c[$]+c[X])+T*e[A],rt=k*(c[q+1]-c[z+1]-c[$+1]+c[X+1])+T*e[A+1],at=k*(c[q+2]-c[z+2]-c[$+2]+c[X+2])+T*e[A+2],V=l*Z+u*nt|0,J=l*tt+u*rt|0,Q=l*et+u*at|0,V=0>V?0:V>255?255:V,J=0>J?0:J>255?255:J,Q=0>Q?0:Q>255?255:Q,y[A]=V,y[A+1]=J,y[A+2]=Q,y[A+3]=e[A+3]}else for(E=a[0],O=a[v>>>1],G=O-E,it=0;h>it;it++){for(ot=e,e=y,y=ot,A=0,x=0,d=g=p=0,M=0;n>M;M++,A+=4,x+=3)d+=e[A],g+=e[A+1],p+=e[A+2],c[x]=d,c[x+1]=g,c[x+2]=p;for(x=0,M=0,d=g=p=0,A=w+n;st>A;A+=4,x+=3,M++)M>=n&&(M=0,d=g=p=0),d+=e[A],g+=e[A+1],p+=e[A+2],c[x+w]=c[x]+d,c[x+w+1]=c[x+1]+g,c[x+w+2]=c[x+2]+p;for(M=0,D=0,S=0,A=0;st>A;A+=4,M++)M>=n&&(M=0,D++,S+=n),P=M+C,F=S+b,H=M+I,N=S+R,P=W>P?W:P,H=H>K?K:H,F=Y>F?Y:F,N=N>j?j:N,X=P+F,q=H+N,z=H+F,$=P+N,X=(X<<1)+X,z=(z<<1)+z,$=($<<1)+$,q=(q<<1)+q,Z=E*(c[q]-c[z]-c[$]+c[X])+G*e[A],tt=E*(c[q+1]-c[z+1]-c[$+1]+c[X+1])+G*e[A+1],et=E*(c[q+2]-c[z+2]-c[$+2]+c[X+2])+G*e[A+2],V=l*Z+u|0,J=l*tt+u|0,Q=l*et+u|0,V=0>V?0:V>255?255:V,J=0>J?0:J>255?255:J,Q=0>Q?0:Q>255?255:Q,y[A]=V,y[A+1]=J,y[A+2]=Q,y[A+3]=e[A+3]}return y}function M(t,e,n,r,a,i,o,s,l,u){var h,c,f,d,g,p,m,_,v,y,w,C,I,b,R,A,x,M,D,S,E,O,G,k,L,T,P,F,H=e.length,N=H>>>2;for(A=n-1,x=N-n,m=new W(o),w=0,d=o.length;d>w;w+=2)m[w+1]*=n;for(_=new W(s),w=0,d=s.length;d>w;w+=2)_[w+1]*=n;for(P=2,c=a,f=o,T=l,p=m,g=e,e=new B(H);P--;){for(F=e,e=g,g=F,h=c.length,d=f.length,C=0,I=0,v=0;H>v;v+=4,C++){for(C>=n&&(C=0,I+=n),O=G=k=L=0,w=0,y=0;h>w;w++,y+=2)b=C+p[y],R=I+p[y+1],b>=0&&A>=b&&R>=0&&x>=R&&(srcOff=b+R<<2,E=c[w],O+=e[srcOff]*E,G+=e[srcOff+1]*E,k+=e[srcOff+2]*E);M=T*O|0,D=T*G|0,S=T*k|0,g[v]=M,g[v+1]=D,g[v+2]=S,g[v+3]=e[v+3]}c=i,f=s,T=u,p=_}return g}function D(t,e,n,r,a,i,o,s,l,u){var h,c,f,d,g,p,m,_,v,y,w,C,I,b,R,A,x,M,D,S,E,O,G,k,L,T,P,F,H=e.length,N=H>>>2;for(A=n-1,x=N-n,m=new W(o),w=0,d=o.length;d>w;w+=2)m[w+1]*=n;for(_=new W(s),w=0,d=s.length;d>w;w+=2)_[w+1]*=n;for(P=2,c=a,f=o,T=l,p=m,g=e,e=new B(H);P--;){for(F=e,e=g,g=F,h=c.length,d=f.length,C=0,I=0,v=0;H>v;v+=4,C++){for(C>=n&&(C=0,I+=n),O=G=k=L=0,w=0,y=0;h>w;w++,y+=2)b=C+p[y],R=I+p[y+1],b>=0&&A>=b&&R>=0&&x>=R&&(srcOff=b+R<<2,E=c[w],O+=e[srcOff]*E,G+=e[srcOff+1]*E,k+=e[srcOff+2]*E);M=T*O|0,D=T*G|0,S=T*k|0,M=0>M?0:M>255?255:M,D=0>D?0:D>255?255:D,S=0>S?0:S>255?255:S,g[v]=M,g[v+1]=D,g[v+2]=S,g[v+3]=e[v+3]}c=i,f=s,T=u,p=_}return g}function S(t,e){null==e&&(e=0),null==t&&(t=1);var n,r=new K(256);for(n=0;256>n;n+=32)r[n]=0|a(e+t*n,0,255),r[n+1]=0|a(e+t*(n+1),0,255),r[n+2]=0|a(e+t*(n+2),0,255),r[n+3]=0|a(e+t*(n+3),0,255),r[n+4]=0|a(e+t*(n+4),0,255),r[n+5]=0|a(e+t*(n+5),0,255),r[n+6]=0|a(e+t*(n+6),0,255),r[n+7]=0|a(e+t*(n+7),0,255),r[n+8]=0|a(e+t*(n+8),0,255),r[n+9]=0|a(e+t*(n+9),0,255),r[n+10]=0|a(e+t*(n+10),0,255),r[n+11]=0|a(e+t*(n+11),0,255),r[n+12]=0|a(e+t*(n+12),0,255),r[n+13]=0|a(e+t*(n+13),0,255),r[n+14]=0|a(e+t*(n+14),0,255),r[n+15]=0|a(e+t*(n+15),0,255),r[n+16]=0|a(e+t*(n+16),0,255),r[n+17]=0|a(e+t*(n+17),0,255),r[n+18]=0|a(e+t*(n+18),0,255),r[n+19]=0|a(e+t*(n+19),0,255),r[n+20]=0|a(e+t*(n+20),0,255),r[n+21]=0|a(e+t*(n+21),0,255),r[n+22]=0|a(e+t*(n+22),0,255),r[n+23]=0|a(e+t*(n+23),0,255),r[n+24]=0|a(e+t*(n+24),0,255),
r[n+25]=0|a(e+t*(n+25),0,255),r[n+26]=0|a(e+t*(n+26),0,255),r[n+27]=0|a(e+t*(n+27),0,255),r[n+28]=0|a(e+t*(n+28),0,255),r[n+29]=0|a(e+t*(n+29),0,255),r[n+30]=0|a(e+t*(n+30),0,255),r[n+31]=0|a(e+t*(n+31),0,255);return r}function E(t,e){var n,r=new K(256);for(n=0;256>n;n+=64)r[n]=a(t[a(e[n],0,255)],0,255),r[n+1]=a(t[a(e[n+1],0,255)],0,255),r[n+2]=a(t[a(e[n+2],0,255)],0,255),r[n+3]=a(t[a(e[n+3],0,255)],0,255),r[n+4]=a(t[a(e[n+4],0,255)],0,255),r[n+5]=a(t[a(e[n+5],0,255)],0,255),r[n+6]=a(t[a(e[n+6],0,255)],0,255),r[n+7]=a(t[a(e[n+7],0,255)],0,255),r[n+8]=a(t[a(e[n+8],0,255)],0,255),r[n+9]=a(t[a(e[n+9],0,255)],0,255),r[n+10]=a(t[a(e[n+10],0,255)],0,255),r[n+11]=a(t[a(e[n+11],0,255)],0,255),r[n+12]=a(t[a(e[n+12],0,255)],0,255),r[n+13]=a(t[a(e[n+13],0,255)],0,255),r[n+14]=a(t[a(e[n+14],0,255)],0,255),r[n+15]=a(t[a(e[n+15],0,255)],0,255),r[n+16]=a(t[a(e[n+16],0,255)],0,255),r[n+17]=a(t[a(e[n+17],0,255)],0,255),r[n+18]=a(t[a(e[n+18],0,255)],0,255),r[n+19]=a(t[a(e[n+19],0,255)],0,255),r[n+20]=a(t[a(e[n+20],0,255)],0,255),r[n+21]=a(t[a(e[n+21],0,255)],0,255),r[n+22]=a(t[a(e[n+22],0,255)],0,255),r[n+23]=a(t[a(e[n+23],0,255)],0,255),r[n+24]=a(t[a(e[n+24],0,255)],0,255),r[n+25]=a(t[a(e[n+25],0,255)],0,255),r[n+26]=a(t[a(e[n+26],0,255)],0,255),r[n+27]=a(t[a(e[n+27],0,255)],0,255),r[n+28]=a(t[a(e[n+28],0,255)],0,255),r[n+29]=a(t[a(e[n+29],0,255)],0,255),r[n+30]=a(t[a(e[n+30],0,255)],0,255),r[n+31]=a(t[a(e[n+31],0,255)],0,255),r[n+32]=a(t[a(e[n+32],0,255)],0,255),r[n+33]=a(t[a(e[n+33],0,255)],0,255),r[n+34]=a(t[a(e[n+34],0,255)],0,255),r[n+35]=a(t[a(e[n+35],0,255)],0,255),r[n+36]=a(t[a(e[n+36],0,255)],0,255),r[n+37]=a(t[a(e[n+37],0,255)],0,255),r[n+38]=a(t[a(e[n+38],0,255)],0,255),r[n+39]=a(t[a(e[n+39],0,255)],0,255),r[n+40]=a(t[a(e[n+40],0,255)],0,255),r[n+41]=a(t[a(e[n+41],0,255)],0,255),r[n+42]=a(t[a(e[n+42],0,255)],0,255),r[n+43]=a(t[a(e[n+43],0,255)],0,255),r[n+44]=a(t[a(e[n+44],0,255)],0,255),r[n+45]=a(t[a(e[n+45],0,255)],0,255),r[n+46]=a(t[a(e[n+46],0,255)],0,255),r[n+47]=a(t[a(e[n+47],0,255)],0,255),r[n+48]=a(t[a(e[n+48],0,255)],0,255),r[n+49]=a(t[a(e[n+49],0,255)],0,255),r[n+50]=a(t[a(e[n+50],0,255)],0,255),r[n+51]=a(t[a(e[n+51],0,255)],0,255),r[n+52]=a(t[a(e[n+52],0,255)],0,255),r[n+53]=a(t[a(e[n+53],0,255)],0,255),r[n+54]=a(t[a(e[n+54],0,255)],0,255),r[n+55]=a(t[a(e[n+55],0,255)],0,255),r[n+56]=a(t[a(e[n+56],0,255)],0,255),r[n+57]=a(t[a(e[n+57],0,255)],0,255),r[n+58]=a(t[a(e[n+58],0,255)],0,255),r[n+59]=a(t[a(e[n+59],0,255)],0,255),r[n+60]=a(t[a(e[n+60],0,255)],0,255),r[n+61]=a(t[a(e[n+61],0,255)],0,255),r[n+62]=a(t[a(e[n+62],0,255)],0,255),r[n+63]=a(t[a(e[n+63],0,255)],0,255);return r}function O(){return new j([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}function G(t,e){var n=new j(20);return n[0]=e[0]*t[0]+e[1]*t[5]+e[2]*t[10]+e[3]*t[15],n[1]=e[0]*t[1]+e[1]*t[6]+e[2]*t[11]+e[3]*t[16],n[2]=e[0]*t[2]+e[1]*t[7]+e[2]*t[12]+e[3]*t[17],n[3]=e[0]*t[3]+e[1]*t[8]+e[2]*t[13]+e[3]*t[18],n[4]=e[0]*t[4]+e[1]*t[9]+e[2]*t[14]+e[3]*t[19]+e[4],n[5]=e[5]*t[0]+e[6]*t[5]+e[7]*t[10]+e[8]*t[15],n[6]=e[5]*t[1]+e[6]*t[6]+e[7]*t[11]+e[8]*t[16],n[7]=e[5]*t[2]+e[6]*t[7]+e[7]*t[12]+e[8]*t[17],n[8]=e[5]*t[3]+e[6]*t[8]+e[7]*t[13]+e[8]*t[18],n[9]=e[5]*t[4]+e[6]*t[9]+e[7]*t[14]+e[8]*t[19]+e[9],n[10]=e[10]*t[0]+e[11]*t[5]+e[12]*t[10]+e[13]*t[15],n[11]=e[10]*t[1]+e[11]*t[6]+e[12]*t[11]+e[13]*t[16],n[12]=e[10]*t[2]+e[11]*t[7]+e[12]*t[12]+e[13]*t[17],n[13]=e[10]*t[3]+e[11]*t[8]+e[12]*t[13]+e[13]*t[18],n[14]=e[10]*t[4]+e[11]*t[9]+e[12]*t[14]+e[13]*t[19]+e[14],n[15]=e[15]*t[0]+e[16]*t[5]+e[17]*t[10]+e[18]*t[15],n[16]=e[15]*t[1]+e[16]*t[6]+e[17]*t[11]+e[18]*t[16],n[17]=e[15]*t[2]+e[16]*t[7]+e[17]*t[12]+e[18]*t[17],n[18]=e[15]*t[3]+e[16]*t[8]+e[17]*t[13]+e[18]*t[18],n[19]=e[15]*t[4]+e[16]*t[9]+e[17]*t[14]+e[18]*t[19]+e[19],n}function k(t,e,n,r,a,i,o,s,l){var u=new j(20);return u[5*i+e]=t[0],u[5*i+n]=t[1],u[5*i+r]=t[2],u[5*i+a]=t[3],u[5*i+4]=t[4],u[5*o+e]=t[5],u[5*o+n]=t[6],u[5*o+r]=t[7],u[5*o+a]=t[8],u[5*o+4]=t[9],u[5*s+e]=t[10],u[5*s+n]=t[11],u[5*s+r]=t[12],u[5*s+a]=t[13],u[5*s+4]=t[14],u[5*l+e]=t[15],u[5*l+n]=t[16],u[5*l+r]=t[17],u[5*l+a]=t[18],u[5*l+4]=t[19],u}function L(t,e){var n=new X(8);return n[0]=t[0]*e[0]+t[1]*e[4],n[1]=t[0]*e[1]+t[1]*e[5],n[2]=t[0]*e[2]+t[1]*e[6]+t[2],n[3]=t[0]*e[3]+t[1]*e[7]+t[3],n[4]=t[4]*e[0]+t[5]*e[4],n[5]=t[4]*e[1]+t[5]*e[5],n[6]=t[4]*e[2]+t[5]*e[6]+t[6],n[7]=t[4]*e[3]+t[5]*e[7]+t[7],n}function T(){return new X([1,0,0,0,0,1,0,0])}function P(t,e,n,r,a){a=a||Array,n=n||1,r=r||1;for(var i=0,o=t.length,s=new a(o);o>i;i++)s[i]=n*t[i]+r*e[i];return s}function F(t,e,n){n=n||Array,e===+e&&(e=[e]);var r,a,i=t.length,o=e.length,s=new n(i*o);for(r=0,a=0;i>r;)s[r*o+a]=t[r]*e[a],++a>=o&&(a=0,r++);return s}function H(t){return t.replace(ot,"\\$1")}var B=t.ImArray,N=t.ImArrayCopy,U=t.Array32F,W=(t.Array64F,t.Array16I),Y=t.Array8U,K=t.ColorTable,j=t.ColorMatrix,X=t.AffineMatrix,z=(t.ConvolutionMatrix,t.Util.Math),$=t.Util.String,q=t.Util.Array,V=t.Util.Image,J=t.Util.Filter,Q=Math.sqrt,Z=Math.pow,tt=Math.ceil,et=Math.log,nt=(Math.sin,Math.cos,Math.min),rt=(Math.max,Math.abs),at=(Math.PI,Math.log2||function(t){return et(t)/Math.LN2}),it=(t.MODE,t._notSupportClamp),ot=(t._noTypedArraySet,/([.*+?^${}()|\[\]\/\\\-])/g),st=/^\s+|\s+$/g,lt=/^function[^{]+{([\s\S]*)}$/;z.clamp=a,z.closest_power2=i,z.Geometry={Point2:o,Point3:s,enorm2:c,cross2:h,normal2:f,interpolate2:l,interpolate3:u},q.arrayset=q.hasArrayset?function(t,e,n){t.set(e,n||0)}:r,q.subarray=q.hasSubarray?function(t,e,n){return t.subarray(e,n)}:function(t,e,n){return t.slice(e,n)},$.esc=H,$.trim=String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(st,"")},$.function_body=n,V.crop=t.Interpolation.crop=q.hasArrayset?d:g,V.pad=t.Interpolation.pad=q.hasArrayset?p:m,V.get_data=_,V.set_data=v,V.fill=y,V.integral=w,V.histogram=C,V.spectrum=I,J.ct_eye=S,J.ct_multiply=E,J.cm_eye=O,J.cm_multiply=G,J.cm_rechannel=k,J.am_eye=T,J.am_multiply=L,J.cm_combine=P,J.cm_convolve=F,J.integral_convolution=it?x:A,J.separable_convolution=it?D:M,J.SAT=b,J.GRAD=R}(a),!function(t,e){var n=t.Util.Math.clamp,r=t.ImArray;t.Interpolation.bilinear=function(t,e,a,i,o){var s,l,u,h,c,f,d,g,p,m,_,v,y,w,C,I,b,R,A,x=i*o<<2,M=new r(x),D=(e-1)/i,S=(a-1)/o,E=e<<2;for(p=0,m=0,_=0,v=0,w=0,b=0,A=0,I=0;x>I;I+=4,m++,_+=D)m>=i&&(m=0,_=0,p++,v+=S,w=~~v,A=v-w,b=w*e),y=~~_,R=_-y,c=(1-R)*(1-A),f=R*(1-A),d=A*(1-R),g=R*A,C=b+y<<2,s=t[C],l=t[C+4],u=t[C+E],h=t[C+E+4],M[I]=n(~~(s*c+l*f+u*d+h*g+.5),0,255),s=t[C+1],l=t[C+5],u=t[C+E+1],h=t[C+E+5],M[I+1]=n(~~(s*c+l*f+u*d+h*g+.5),0,255),s=t[C+2],l=t[C+6],u=t[C+E+2],h=t[C+E+6],M[I+2]=n(~~(s*c+l*f+u*d+h*g+.5),0,255),s=t[C+3],l=t[C+7],u=t[C+E+3],h=t[C+E+7],M[I+3]=n(~~(s*c+l*f+u*d+h*g+.5),0,255);return M}}(a),!function(e,n){function r(t,e,n,r,a){t[e]=255&(n[0]+a*(r[0]-n[0])|0),t[e+1]=255&(n[1]+a*(r[1]-n[1])|0),t[e+2]=255&(n[2]+a*(r[2]-n[2])|0),t[e+3]=255&(n[3]+a*(r[3]-n[3])|0)}var a=Math.sqrt,i=Math.round,o=(Math.floor,Math.min),s=Math.max,l=Math.abs,u=Math.sin,h=Math.cos,c=Math.PI,f=2*c,d=c/2,g=3*d,p=e.Util.Math.clamp,m=e.Util.String.esc,_=e.Util.String.trim,v=e.LUMA,y=(e.CHANNEL,1/255),w=100/255,C=2.55,I={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},b=e.Color=e.Class({__static__:{clamp:p,clampPixel:function(t){return o(255,s(t,0))},color24:function(t,e,n){return(255&t)<<16|(255&e)<<8|255&n},color32:function(t,e,n,r){return(255&r)<<24|(255&t)<<16|(255&e)<<8|255&n},rgb24:function(t){return[t>>>16&255,t>>>8&255,255&t]},rgba32:function(t){return[t>>>16&255,t>>>8&255,255&t,t>>>24&255]},intensity:function(t,e,n){return~~(v[0]*t+v[1]*e+v[2]*n)},hue:function(t,e,n){var r=s(t,e,n);return t===e&&e===n?0:t===r?60*l(e-n)/(r-o(t,e,n)):e===r?120+60*l(n-t)/(r-o(t,e,n)):240+60*l(t-e)/(r-o(t,e,n))},saturation:function(t,e,n){var r=s(t,e,n);return t===e&&e===n?0:255*(r-o(t,e,n))/r},dist:function(t,e,n,r){var i=t[n+0]-e[r+0],o=t[n+1]-e[r+1],s=t[n+2]-e[r+2];return a(i*i+o*o+s*s)},RGB2Gray:function(t,e){var n=v[0]*t[e+0]+v[1]*t[e+1]+v[2]*t[e+2]|0;return t[e+0]=n,t[e+1]=n,t[e+2]=n,t},RGB2Color:function(t,e){return(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},RGBA2Color:function(t,e){return(255&t[e+3])<<24|(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},Color2RGBA:function(t,e,n){return t=0|t,e[n+0]=t>>>16&255,e[n+1]=t>>>8&255,e[n+2]=255&t,e[n+3]=t>>>24&255,e},RGB2YCbCr:function(t,e){var n=t[e+0],r=t[e+1],a=t[e+2];return t[e+0]=0+.299*n+.587*r+.114*a|0,t[e+1]=128-.168736*n-.331264*r+.5*a|0,t[e+2]=128+.5*n-.418688*r-.081312*a|0,t},YCbCr2RGB:function(t,e){var n=t[e+0],r=t[e+1],a=t[e+2];return t[e+0]=n+1.402*(a-128)|0,t[e+1]=n-.34414*(r-128)-.71414*(a-128)|0,t[e+2]=n+1.772*(r-128)|0,t},RGB2HSV:function(t,e){var n,r,a,i,u,h,c=t[e+0],f=t[e+1],d=t[e+2];return r=s(c,f,d),h=r,c===f&&f===d?(u=0,i=0):(n=o(c,f,d),a=r-n,u=a/r,i=c===r?60*l(f-d)/a:f===r?120+60*l(d-c)/a:240+60*l(c-f)/a),t[e+0]=.7083333333333334*i,t[e+1]=255*u,t[e+2]=h,t},HSV2RGB:function(t,e){var n,r,a,i,o,s,l,u,h=1.411764705882353*t[e+0],c=.00392156862745098*t[e+1],f=t[e+2];return 0===c?s=l=u=f:(h/=60,n=~~h,r=h-n,a=f*(1-c),i=f*(1-c*r),o=f*(1-c*(1-r)),0===n?(s=f,l=o,u=a):1===n?(s=i,l=f,u=a):2===n?(s=a,l=f,u=o):3===n?(s=a,l=i,u=f):4===n?(s=o,l=a,u=f):(s=f,l=a,u=i)),t[e+0]=s,t[e+1]=l,t[e+2]=u,t},RGB2CMYK:function(t,e){var n,r=0,a=0,i=0,s=0,l=t[e+0],u=t[e+1],h=t[e+2];return 0===l&&0===u&&0===h?t:(r=255-l,a=255-u,i=255-h,s=o(r,a,i),n=255===s?0:255/(255-s),t[e+0]=(r-s)*n,t[e+1]=(a-s)*n,t[e+2]=(i-s)*n,t)},toString:function(){return"[FILTER: "+this.name+"]"},C2F:y,C2P:w,P2C:C,Keywords:I,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(I).map(m).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(t,e){return t*w+(e||"")},per2col:function(t){return t*C},rgb2cmyk:function(t,e,n,r){var a,s,l=0,u=0,h=0,c=0;return r&&(t=p(i(t*C),0,255),e=p(i(e*C),0,255),n=p(i(n*C),0,255)),0===t&&0===e&&0===n?[0,0,0,1]:(l=1-t*y,u=1-e*y,h=1-n*y,a=o(l,u,h),s=1/(1-a),l=(l-a)*s,u=(u-a)*s,h=(h-a)*s,c=a,[l,u,h,c])},cmyk2rgb:function(t,e,n,r){var a,o,s=0,l=0,u=0;return 0===t&&0===e&&0===n?[0,0,0]:(a=r,o=1-a,t=t*o+a,e=e*o+a,n=n*o+a,s=255*(1-t),l=255*(1-e),u=255*(1-n),[p(i(s),0,255),p(i(l),0,255),p(i(u),0,255)])},rgb2hex:function(t,e,n,r,a){var o;return a&&(t=p(i(t*C),0,255),e=p(i(e*C),0,255),n=p(i(n*C),0,255)),t=16>t?"0"+t.toString(16):t.toString(16),e=16>e?"0"+e.toString(16):e.toString(16),n=16>n?"0"+n.toString(16):n.toString(16),o=r&&t[0]===t[1]&&e[0]===e[1]&&n[0]===n[1]?"#"+t[0]+e[0]+n[0]:"#"+t+e+n},rgb2hexIE:function(t,e,n,r,a){var o;return a&&(t=p(i(t*C),0,255),e=p(i(e*C),0,255),n=p(i(n*C),0,255),r=p(i(r*C),0,255)),t=16>t?"0"+t.toString(16):t.toString(16),e=16>e?"0"+e.toString(16):e.toString(16),n=16>n?"0"+n.toString(16):n.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),o="#"+r+t+e+n},hex2rgb:function(t){return!t||3>t.length?[0,0,0]:6>t.length?[p(parseInt(t[0]+t[0],16),0,255),p(parseInt(t[1]+t[1],16),0,255),p(parseInt(t[2]+t[2],16),0,255)]:[p(parseInt(t[0]+t[1],16),0,255),p(parseInt(t[2]+t[3],16),0,255),p(parseInt(t[4]+t[5],16),0,255)]},hue2rgb:function(t,e,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?t+6*(e-t)*n:.5>n?e:2/3>n?t+(e-t)*(2/3-n)*6:t},hsl2rgb:function(t,e,n){var r,a,o,s,l,u=b.hue2rgb;return t=(t+360)%360/360,e*=.01,n*=.01,0===e?(r=1,a=1,o=1):(l=.5>n?n*(1+e):n+e-n*e,s=2*n-l,r=u(s,l,t+1/3),a=u(s,l,t),o=u(s,l,t-1/3)),[p(i(255*r),0,255),p(i(255*a),0,255),p(i(255*o),0,255)]},rgb2hsl:function(t,e,n,r){var a,l,u,h,c,f;return r?(t*=.01,e*=.01,n*=.01):(t*=y,e*=y,n*=y),l=s(t,e,n),a=o(t,e,n),c=.5*(l+a),l===a?u=h=0:(f=l-a,h=c>.5?f/(2-s-o):f/(s+o),u=l==t?(e-n)/f+(n>e?6:0):l==e?(n-t)/f+2:(t-e)/f+4,u/=6),[i(360*u)%360,p(100*h,0,100),p(100*c,0,100)]},parse:function(t,e,n,r){var a,i,o,s,l,u=0,h=0;if("hsl"===n||!n&&(a=t.match(b.hslRE))){if("hsl"===n){l="hsla"===t[0].toLowerCase();var c=t[1].split(",").map(_)}else{u=a[0].length,h=0,l="hsla"===a[1].toLowerCase();var c=a[2].split(",").map(_)}var f=c[0]?c[0]:"0",t=c[1]?c[1]:"0",d=c[2]?c[2]:"0",g=l&&null!=c[3]?c[3]:"1";return f=parseFloat(f,10),t="%"===t.slice(-1)?parseFloat(t,10):parseFloat(t,10)*w,d="%"===d.slice(-1)?parseFloat(d,10):parseFloat(d,10)*w,g=parseFloat(g,10),s=(new b).fromHSL([f,t,d,g]),e&&(o=t.substr(u),(i=o.match(b.colorstopRE))&&(s.colorStop(i[1]),h=i[0].length)),r?s:[s,0,u+h]}if("rgb"===n||!n&&(a=t.match(b.rgbRE))){if("rgb"===n){l="rgba"===t[0].toLowerCase();var c=t[1].split(",").map(_)}else{u=a[0].length,h=0,l="rgba"===a[1].toLowerCase();var c=a[2].split(",").map(_)}var p=c[0]?c[0]:"0",m=c[1]?c[1]:"0",v=c[2]?c[2]:"0",g=l&&null!=c[3]?c[3]:"1";return p="%"===p.slice(-1)?2.55*parseFloat(p,10):parseFloat(p,10),m="%"===m.slice(-1)?2.55*parseFloat(m,10):parseFloat(m,10),v="%"===v.slice(-1)?2.55*parseFloat(v,10):parseFloat(v,10),g=parseFloat(g,10),s=(new b).fromRGB([p,m,v,g]),e&&(o=t.substr(u),(i=o.match(b.colorstopRE))&&(s.colorStop(i[1]),h=i[0].length)),r?s:[s,0,u+h]}if("hex"===n||!n&&(a=t.match(b.hexRE))){if("hex"===n)var c=b.hex2rgb(t[0]);else{u=a[0].length,h=0;var c=b.hex2rgb(a[1])}var y=c[0]?c[0]:0,C=c[1]?c[1]:0,I=c[2]?c[2]:0,g=null!=c[3]?c[3]:255;return s=(new b).fromHEX([y,C,I,g]),e&&(o=t.substr(u),(i=o.match(b.colorstopRE))&&(s.colorStop(i[1]),h=i[0].length)),r?s:[s,0,u+h]}if("keyword"===n||!n&&(a=t.match(b.keywordRE))){if("keyword"===n)var c=t[0];else{u=a[0].length,h=0;var c=a[1]}return s=(new b).fromKeyword(c),e&&(o=t.substr(u),(i=o.match(b.colorstopRE))&&(s.colorStop(i[1]),h=i[0].length)),r?s:[s,0,u+h]}return null},fromString:function(t,e,n){return b.parse(t,e,n,1)},fromRGB:function(t){return(new b).fromRGB(t)},fromHSL:function(t){return(new b).fromHSL(t)},fromCMYK:function(t){return(new b).fromCMYK(t)},fromHEX:function(t){return(new b).fromHEX(t)},fromKeyword:function(t){return(new b).fromKeyword(t)},fromPixel:function(t){return(new b).fromPixel(t)}},constructor:function R(t,e){return this instanceof R?(this.reset(),void(t&&this.set(t,e))):new R(t,e)},name:"Color",col:null,cstop:null,kword:null,clone:function(){var t=new b;return t.col=this.col.slice(),t.cstop=this.cstop+"",t.kword=this.kword,t},reset:function(){return this.col=[0,0,0,1],this.cstop="",this.kword=null,this},set:function(t,e){return t&&(n!==t[0]&&(this.col[0]=p(t[0],0,255)),n!==t[1]&&(this.col[1]=p(t[1],0,255)),n!==t[2]&&(this.col[2]=p(t[2],0,255)),n!==t[3]?this.col[3]=p(t[3],0,1):this.col[3]=1,e&&(this.cstop=e),this.kword=null),this},colorStop:function(t){return this.cstop=t,this},isTransparent:function(){return 1>this.col[3]},isKeyword:function(){return!!this.kword},fromPixel:function(t){return t=t||0,this.col=[p(t>>16&255,0,255),p(t>>8&255,0,255),p(255&t,0,255),p((t>>24&255)*y,0,1)],this.kword=null,this},fromKeyword:function(t){return t=t.toLowerCase(),b.Keywords[t]&&(this.col=b.Keywords[t].slice(),this.kword=t),this},fromHEX:function(t){return this.col[0]=t[0]?p(parseInt(t[0],10),0,255):0,this.col[1]=t[1]?p(parseInt(t[1],10),0,255):0,this.col[2]=t[2]?p(parseInt(t[2],10),0,255):0,this.col[3]=n!==t[3]?p(parseInt(t[3],10)*y,0,1):1,this.kword=null,this},fromRGB:function(t){return this.col[0]=t[0]?p(i(t[0]),0,255):0,this.col[1]=t[1]?p(i(t[1]),0,255):0,this.col[2]=t[2]?p(i(t[2]),0,255):0,this.col[3]=n!==t[3]?p(t[3],0,1):1,this.kword=null,this},fromCMYK:function(t){var e=b.cmyk2rgb(t[0]||0,t[1]||0,t[2]||0,t[3]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=n!==t[4]?p(t[4],0,1):1,this.kword=null,this},fromHSL:function(t){var e=b.hsl2rgb(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=n!==t[3]?p(t[3],0,1):1,this.kword=null,this},toPixel:function(t){return t?p(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(t,e,n){var r=b.rgb2cmyk(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toKeyword:function(t,e,n){return this.kword?this.kword:this.toHEX(1,e,n)},toHEX:function(t,e,n){return n?b.rgb2hexIE(this.col[0],this.col[1],this.col[2],p(i(255*this.col[3]),0,255)):b.rgb2hex(this.col[0],this.col[1],this.col[2],e)},toRGB:function(t,e,n){var r=this.col[3];return t?(e&&(r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(t,e,n){var r=this.col[3],a=b.rgb2hsl(this.col[0],this.col[1],this.col[2]);return t?(e&&(a[1]=0==a[1]?a[1]:a[1]+"%",a[2]=0==a[2]?a[2]:a[2]+"%",r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[a[0],a[1],a[2]].join(",")+")":"hsla("+[a[0],a[1],a[2],r].join(",")+")"):n?a:a.concat(this.col[3])},toColorStop:function(t){var e=this.cstop;return t?(e=e.length?e+",":"",1>this.col[3]?"color-stop("+e+this.toRGB(1,1)+")":"color-stop("+e+this.toHEX(1,1)+")"):(e=e.length?" "+e:"",1>this.col[3]?this.toRGB(1,1)+e:this.toHEX(1,1)+e)},toString:function(t,e){return t=t?t.toLowerCase():"hex","rgb"==t||"rgba"==t?this.toRGB(1,!1!==e,"rgb"==t):"hsl"==t||"hsla"==t?this.toHSL(1,!1!==e,"hsl"==t):"keyword"==t?this.toKeyword(1):this.toHEX(1,!1!==e,"hexie"==t)}});b.toGray=b.intensity,b.Gradient={interpolate:r,stops:function(t,e){e=e?e.slice():e,t=t?t.slice():t;var n,r=t.length;if(e){if(e.length<r){var a=e.length,i=e[a-1];for(n=a;r>n;n++)e.push(n+1===r?1:i+(n-a+1)/(r-1))}}else if(1===r)e=[1];else for(e=new Array(r),n=0;r>n;n++)e[n]=n+1===r?1:n/(r-1);return 1!=e[e.length-1]&&(e.push(1),t.push(t[t.length-1])),[t,e]},linear:function(t,e,n,r,a,i,s){var p,m,_,v,y,w,C,I,b,R,A,x=t.length;if(i=i||0,0>i&&(i+=f),i>f&&(i-=f),b=l(u(i)),R=l(h(i)),A=R*e+b*n,b/=A,R/=A,i>d&&c>=i)for(m=0,_=0,p=0;x>p;p+=4,m++){for(m>=e&&(m=0,_++),y=e-1-m,w=_,v=o(1,R*y+b*w),I=0;v>a[I];)++I;C=0===I?0:I-1,s(t,p,r[C],r[I],a[I]>a[C]?(v-a[C])/(a[I]-a[C]):v)}else if(i>c&&g>=i)for(m=0,_=0,p=0;x>p;p+=4,m++){for(m>=e&&(m=0,_++),y=e-1-m,w=n-1-_,v=o(1,R*y+b*w),I=0;v>a[I];)++I;C=0===I?0:I-1,s(t,p,r[C],r[I],a[I]>a[C]?(v-a[C])/(a[I]-a[C]):v)}else if(i>g&&f>i)for(m=0,_=0,p=0;x>p;p+=4,m++){for(m>=e&&(m=0,_++),y=m,w=n-1-_,v=o(1,R*y+b*w),I=0;v>a[I];)++I;C=0===I?0:I-1,s(t,p,r[C],r[I],a[I]>a[C]?(v-a[C])/(a[I]-a[C]):v)}else for(m=0,_=0,p=0;x>p;p+=4,m++){for(m>=e&&(m=0,_++),y=m,w=_,v=o(1,R*y+b*w),I=0;v>a[I];)++I;C=0===I?0:I-1,s(t,p,r[C],r[I],a[I]>a[C]?(v-a[C])/(a[I]-a[C]):v)}return t},linearPoint:function(e,n,a,i,s,p,m,_,v){var y,w,C,I,b,R,A;if(b=l(u(v)),R=l(h(v)),A=R*s+b*p,b/=A,R/=A,v>d&&c>=v){for(y=s-1-a,w=i,t=o(1,R*y+b*w),I=0;t>_[I];)++I;C=0===I?0:I-1,r(e,n,m[C],m[I],_[I]>_[C]?(t-_[C])/(_[I]-_[C]):t)}else if(v>c&&g>=v){for(y=s-1-a,w=p-1-i,t=o(1,R*y+b*w),I=0;t>_[I];)++I;C=0===I?0:I-1,r(e,n,m[C],m[I],_[I]>_[C]?(t-_[C])/(_[I]-_[C]):t)}else if(v>g&&f>v){for(y=a,w=p-1-i,t=o(1,R*y+b*w),I=0;t>_[I];)++I;C=0===I?0:I-1,r(e,n,m[C],m[I],_[I]>_[C]?(t-_[C])/(_[I]-_[C]):t)}else{for(y=a,w=i,t=o(1,R*y+b*w),I=0;t>_[I];)++I;C=0===I?0:I-1,r(e,n,m[C],m[I],_[I]>_[C]?(t-_[C])/(_[I]-_[C]):t)}return e},radial:function(t,e,n,r,i,s,l,u,h,c){var f,d,g,p,m,_,v,y,w=t.length;for(s=s||0,l=l||0,u=u||1,h=h||1,h>u?(u/=h,h=1):u>h?(h/=u,u=1):(h=1,u=1),d=0,g=0,f=0;w>f;f+=4,d++){for(d>=e&&(d=0,g++),m=u*(d-s)/(e-s),_=h*(g-l)/(n-l),p=o(1,a(m*m+_*_)),y=0;p>i[y];)++y;v=0===y?0:y-1,c(t,f,r[v],r[y],i[y]>i[v]?(p-i[v])/(i[y]-i[v]):p)}return t},radialPoint:function(t,e,n,i,s,l,u,h,c,f,d,g){var p,m,_,v,y;for(m=d*(n-c)/(s-c),_=g*(i-f)/(l-f),p=o(1,a(m*m+_*_)),y=0;p>h[y];)++y;return v=0===y?0:y-1,r(t,e,u[v],u[y],h[y]>h[v]?(p-h[v])/(h[y]-h[v]):p),t}},b.Blend={normal:function(t,e,n,r,a,i){var o,s,l,u=a*e[r+3]*.003921568627451,h=t[n],c=t[n+1],f=t[n+2],d=e[r],g=e[r+1],p=e[r+2];o=d,s=g,l=p,h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),t[n]=0|h,t[n+1]=0|c,t[n+2]=0|f},lighten:function(t,e,n,r,a,i){var o,s,l,u=a*e[r+3]*.003921568627451,h=t[n],c=t[n+1],f=t[n+2],d=e[r],g=e[r+1],p=e[r+2];o=h>d?h:d,s=c>g?c:g,l=f>p?f:p,h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),t[n]=0|h,t[n+1]=0|c,t[n+2]=0|f},darken:function(t,e,n,r,a,i){var o,s,l,u=a*e[r+3]*.003921568627451,h=t[n],c=t[n+1],f=t[n+2],d=e[r],g=e[r+1],p=e[r+2];o=h>d?d:h,s=c>g?g:c,l=f>p?p:f,h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),t[n]=0|h,t[n+1]=0|c,t[n+2]=0|f},multiply:function(t,e,n,r,a,i){var o,s,l,u=a*e[r+3]*.003921568627451,h=t[n],c=t[n+1],f=t[n+2],d=e[r],g=e[r+1],p=e[r+2];o=h*d*.003921568627451,s=c*g*.003921568627451,l=f*p*.003921568627451,h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),t[n]=0|h,t[n+1]=0|c,t[n+2]=0|f},average:function(t,e,n,r,a,i){var o,s,l,u=a*e[r+3]*.003921568627451,h=t[n],c=t[n+1],f=t[n+2],d=e[r],g=e[r+1],p=e[r+2];o=.5*(h+d),s=.5*(c+g),l=.5*(f+p),h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),t[n]=0|h,t[n+1]=0|c,t[n+2]=0|f},add:function(t,e,n,r,a,i){var o,s,l,u=a*e[r+3]*.003921568627451,h=t[n],c=t[n+1],f=t[n+2],d=e[r],g=e[r+1],p=e[r+2];o=h+d,s=c+g,l=f+p,h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),t[n]=0|h,t[n+1]=0|c,t[n+2]=0|f},subtract:function(t,e,n,r,a,i){var o,s,l,u=a*e[r+3]*.003921568627451,h=t[n],c=t[n+1],f=t[n+2],d=e[r],g=e[r+1],p=e[r+2];o=255>h+d?0:h+d-255,s=255>c+g?0:c+g-255,l=255>f+p?0:f+p-255,h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),t[n]=0|h,t[n+1]=0|c,t[n+2]=0|f},difference:function(t,e,n,r,a,i){var o,s,u,h=a*e[r+3]*.003921568627451,c=t[n],f=t[n+1],d=t[n+2],g=e[r],p=e[r+1],m=e[r+2];o=l(g-c),s=l(p-f),u=l(m-d),c+=h*(o-c),f+=h*(s-f),d+=h*(u-d),i&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),t[n]=0|c,t[n+1]=0|f,t[n+2]=0|d},negation:function(t,e,n,r,a,i){var o,s,u,h=a*e[r+3]*.003921568627451,c=t[n],f=t[n+1],d=t[n+2],g=e[r],p=e[r+1],m=e[r+2];o=255-l(255-g-c),s=255-l(255-p-f),u=255-l(255-m-d),c+=h*(o-c),f+=h*(s-f),d+=h*(u-d),i&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),t[n]=0|c,t[n+1]=0|f,t[n+2]=0|d},screen:function(t,e,n,r,a,i){var o,s,l,u=a*e[r+3]*.003921568627451,h=t[n],c=t[n+1],f=t[n+2],d=e[r],g=e[r+1],p=e[r+2];o=255-((255-d)*(255-h)>>8),s=255-((255-g)*(255-c)>>8),l=255-((255-p)*(255-f)>>8),h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),t[n]=0|h,t[n+1]=0|c,t[n+2]=0|f},exclusion:function(t,e,n,r,a,i){var o,s,l,u=a*e[r+3]*.003921568627451,h=t[n],c=t[n+1],f=t[n+2],d=e[r],g=e[r+1],p=e[r+2];o=d+h-2*d*h*.003921568627451,s=g+c-2*g*c*.003921568627451,l=p+f-2*p*f*.003921568627451,h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),t[n]=0|h,t[n+1]=0|c,t[n+2]=0|f},overlay:function(t,e,n,r,a,i){var o,s,l,u=a*e[r+3]*.003921568627451,h=t[n],c=t[n+1],f=t[n+2],d=e[r],g=e[r+1],p=e[r+2];o=128>h?2*d*h*.003921568627451:255-2*(255-d)*(255-h)*.003921568627451,s=128>c?2*g*c*.003921568627451:255-2*(255-g)*(255-c)*.003921568627451,o=128>f?2*p*f*.003921568627451:255-2*(255-p)*(255-f)*.003921568627451,h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),t[n]=0|h,t[n+1]=0|c,t[n+2]=0|f},softlight:function(t,e,n,r,a,i){var o,s,l,u=a*e[r+3]*.003921568627451,h=t[n],c=t[n+1],f=t[n+2],d=e[r],g=e[r+1],p=e[r+2];o=128>h?2*((d>>1)+64)*(.003921568627451*h):255-2*(255-((d>>1)+64))*(255-h)*.003921568627451,s=128>c?2*((g>>1)+64)*(.003921568627451*c):255-2*(255-((g>>1)+64))*(255-c)*.003921568627451,l=128>f?2*((p>>1)+64)*(.003921568627451*f):255-2*(255-((p>>1)+64))*(255-f)*.003921568627451,h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),t[n]=0|h,t[n+1]=0|c,t[n+2]=0|f},hardlight:function(t,e,n,r,a,i){var o,s,l,u=a*e[r+3]*.003921568627451,h=t[n],c=t[n+1],f=t[n+2],d=e[r],g=e[r+1],p=e[r+2];o=128>d?2*h*d*.003921568627451:255-2*(255-h)*(255-d)*.003921568627451,s=128>g?2*c*g*.003921568627451:255-2*(255-c)*(255-g)*.003921568627451,l=128>p?2*f*p*.003921568627451:255-2*(255-f)*(255-p)*.003921568627451,h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),t[n]=0|h,t[n+1]=0|c,t[n+2]=0|f},colordodge:function(t,e,n,r,a,i){var s,l,u,h=a*e[r+3]*.003921568627451,c=t[n],f=t[n+1],d=t[n+2],g=e[r],p=e[r+1],m=e[r+2];s=255===c?c:o(255,(g<<8)/(255-c)),l=255===f?f:o(255,(p<<8)/(255-f)),u=255===d?d:o(255,(m<<8)/(255-d)),c+=h*(s-c),f+=h*(l-f),d+=h*(u-d),i&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),t[n]=0|c,t[n+1]=0|f,t[n+2]=0|d},colorburn:function(t,e,n,r,a,i){var o,l,u,h=a*e[r+3]*.003921568627451,c=t[n],f=t[n+1],d=t[n+2],g=e[r],p=e[r+1],m=e[r+2];o=0===c?c:s(0,255-(255-g<<8)/c),l=0===f?f:s(0,255-(255-p<<8)/f),u=0===d?d:s(0,255-(255-m<<8)/d),c+=h*(o-c),f+=h*(l-f),d+=h*(u-d),i&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),t[n]=0|c,t[n+1]=0|f,t[n+2]=0|d},linearlight:function(t,e,n,r,a,i){var o,s,l,u,h=a*e[r+3]*.003921568627451,c=t[n],f=t[n+1],d=t[n+2],g=e[r],p=e[r+1],m=e[r+2];128>c?(u=2*c,o=255>u+g?0:u+g-255):(u=2*(c-128),o=u+g),128>f?(u=2*f,s=255>u+p?0:u+p-255):(u=2*(f-128),s=u+p),128>d?(u=2*d,l=255>u+m?0:u+m-255):(u=2*(d-128),l=u+m),c+=h*(o-c),f+=h*(s-f),d+=h*(l-d),i&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),t[n]=0|c,t[n+1]=0|f,t[n+2]=0|d},reflect:function(t,e,n,r,a,i){var s,l,u,h=a*e[r+3]*.003921568627451,c=t[n],f=t[n+1],d=t[n+2],g=e[r],p=e[r+1],m=e[r+2];s=255===c?c:o(255,g*g/(255-c)),l=255===f?f:o(255,p*p/(255-f)),u=255===d?d:o(255,m*m/(255-d)),c+=h*(s-c),f+=h*(l-f),d+=h*(u-d),i&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),t[n]=0|c,t[n+1]=0|f,t[n+2]=0|d},glow:function(t,e,n,r,a,i){var s,l,u,h=a*e[r+3]*.003921568627451,c=t[n],f=t[n+1],d=t[n+2],g=e[r],p=e[r+1],m=e[r+2];s=255===g?g:o(255,c*c/(255-g)),l=255===p?p:o(255,f*f/(255-p)),u=255===m?m:o(255,d*d/(255-m)),c+=h*(s-c),f+=h*(l-f),d+=h*(u-d),i&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),t[n]=0|c,t[n+1]=0|f,t[n+2]=0|d},phoenix:function(t,e,n,r,a,i){var l,u,h,c=a*e[r+3]*.003921568627451,f=t[n],d=t[n+1],g=t[n+2],p=e[r],m=e[r+1],_=e[r+2];l=o(p,f)-s(p,f)+255,u=o(m,d)-s(m,d)+255,h=o(_,g)-s(_,g)+255,f+=c*(l-f),d+=c*(u-d),g+=c*(h-g),i&&(f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g),t[n]=0|f,t[n+1]=0|d,t[n+2]=0|g},vividlight:function(t,e,n,r,a,i){var l,u,h,c,f=a*e[r+3]*.003921568627451,d=t[n],g=t[n+1],p=t[n+2],m=e[r],_=e[r+1],v=e[r+2];128>d?(c=2*d,l=0===c?c:s(0,255-(255-m<<8)/c)):(c=2*(d-128),l=255===c?c:o(255,(m<<8)/(255-c))),128>g?(c=2*g,u=0===c?c:s(0,255-(255-_<<8)/c)):(c=2*(g-128),u=255===c?c:o(255,(_<<8)/(255-c))),128>p?(c=2*p,h=0===c?c:s(0,255-(255-v<<8)/c)):(c=2*(g-128),h=255===c?c:o(255,(v<<8)/(255-c))),d+=f*(l-d),g+=f*(u-g),p+=f*(h-p),i&&(d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,p=0>p?0:p>255?255:p),t[n]=0|d,t[n+1]=0|g,t[n+2]=0|p},pinlight:function(t,e,n,r,a,i){var o,s,l,u,h=a*e[r+3]*.003921568627451,c=t[n],f=t[n+1],d=t[n+2],g=e[r],p=e[r+1],m=e[r+2];128>c?(u=2*c,o=u>g?u:g):(u=2*(c-128),o=u>g?g:u),128>f?(u=2*f,s=u>p?u:p):(u=2*(c-128),s=u>p?p:u),128>d?(u=2*d,l=u>m?u:m):(u=2*(d-128),l=u>m?m:u),c+=h*(o-c),f+=h*(s-f),d+=h*(l-d),i&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),t[n]=0|c,t[n+1]=0|f,t[n+2]=0|d},hardmix:function(t,e,n,r,a,i){var l,u,h,c,f=a*e[r+3]*.003921568627451,d=t[n],g=t[n+1],p=t[n+2],m=e[r],_=e[r+1],v=e[r+2];128>d?(c=2*d,l=0===c?c:s(0,255-(255-m<<8)/c)):(c=2*(d-128),l=255===c?c:o(255,(m<<8)/(255-c))),l=128>l?0:255,128>g?(c=2*g,u=0===c?c:s(0,255-(255-_<<8)/c)):(c=2*(g-128),u=255===c?c:o(255,(_<<8)/(255-c))),u=128>u?0:255,128>p?(c=2*p,h=0===c?c:s(0,255-(255-v<<8)/c)):(c=2*(p-128),h=255===c?c:o(255,(v<<8)/(255-c))),h=128>h?0:255,d+=f*(l-d),g+=f*(u-g),p+=f*(h-p),i&&(d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,p=0>p?0:p>255?255:p),t[n]=0|d,t[n+1]=0|g,t[n+2]=0|p}},b.Blend.lineardodge=b.Blend.add,b.Blend.linearburn=b.Blend.subtract,b.Combine=b.Blend}(a),!function(t,e){var n,r,a=t.ImArray,i=t.Util.Image,o=t.Color,s=Math.min,l=Math.max,u=t.Interpolation.bilinear,h=i.get_data,c=i.set_data,f=i.fill;r=t.Class({constructor:function(t){var e=this;e._cnv=t,e._transform={scale:[1,1],translate:[0,0],rotate:[0,0]},e._data=null},_cnv:null,_w:0,_h:0,_transform:null,_data:null,fillStyle:null,dispose:function(){var t=this;return t._cnv=null,t._data=null,t._transform=null,t},fillRect:function(t,e,n,r){var a,i=this,s=i._w,l=i._h,u=i.fillStyle;null==t&&(t=0),null==e&&(e=0),null==n&&(n=s),null==r&&(r=l),u===+u?a=o.Color2RGBA(u,[0,0,0,0],0):u&&u.substr?(a=o.fromString(u).toRGB(!1),a[3]=255*a[3]|0):a=u&&2<u.length?u:[0,0,0,0],
f(i._data,s,l,a,t,e,t+n-1,e+r-1)},clearRect:function(t,e,n,r){var a=this,i=a._w,o=a._h;null==t&&(t=0),null==e&&(e=0),null==n&&(n=i),null==r&&(r=o),f(a._data,i,o,[0,0,0,0],t,e,t+n-1,e+r-1)},drawImage:function(t,e,n,r,i,o,s,l,f){var d=this,g=d._w,p=d._h,m=t._ctx._w,_=t._ctx._h,v=t._ctx._data,y=arguments.length;3===y?(d._data||(g=d._w=m,p=d._h=_,d._data=new a(g*p<<2)),o=e,s=n,c(d._data,g,p,v,m,_,0,0,m-1,_-1,o,s)):5===y?(d._data||(g=d._w=r,p=d._h=i,d._data=new a(g*p<<2)),o=e,s=n,l=r,f=i,m===l&&_===f?c(d._data,g,p,v,l,f,0,0,l-1,f-1,o,s):c(d._data,g,p,u(v,m,_,l,f),l,f,0,0,l-1,f-1,o,s)):(d._data||(g=d._w=l,p=d._h=f,d._data=new a(g*p<<2)),r===l&&i===f?c(d._data,g,p,h(v,m,_,e,n,e+r-1,n+i-1,!0),l,f,0,0,l-1,f-1,o,s):c(d._data,g,p,u(h(v,m,_,e,n,e+r-1,n+i-1,!0),r,i,l,f),l,f,0,0,l-1,f-1,o,s))},createImageData:function(t,e){var n=this;return n._data=new a(t*e<<2),n._w=t,n._h=e,n},putImageData:function(t,e,n){var r=this,a=r._w,i=r._h,o=t.width,s=t.height;null==e&&(e=0),null==n&&(n=0),c(r._data,a,i,t.data,o,s,0,0,o-1,s-1,e,n)},getImageData:function(t,e,n,r){var a,i,o,u,c=this,f=c._w,d=c._h;return null==t&&(t=0),null==e&&(e=0),null==n&&(n=f),null==r&&(r=d),a=l(0,s(t,n-1,f-1)),i=l(0,s(e,r-1,d-1)),o=s(a+n-1,n-1,f-1),u=s(i+r-1,r-1,d-1),{data:h(c._data,f,d,a,i,o,u),width:o-a+1,height:u-i+1}},scale:function(t,e){var n=this;return n._transform.scale[0]=t,n._transform.scale[1]=e,n},translate:function(t,e){var n=this;return n._transform.translate[0]=t,n._transform.translate[1]=e,n}}),n=t.CanvasProxy=t.Class({constructor:function(t,e){var n=this;n.width=t||0,n.height=e||0,n.style={},n._ctx=null},_ctx:null,width:null,height:null,style:null,dispose:function(){var t=this;return t.width=null,t.height=null,t.style=null,t._ctx&&(t._ctx.dispose(),t._ctx=null),t},getContext:function(e,n){var a=this;return-1<e.indexOf("webgl")?t.GL(a,n):(a._ctx||(a._ctx=new r(a)),a._ctx)},toDataURL:function(t){return""}}),t.Canvas=function(e,r){var a=t.Browser.isNode?new n:document.createElement("canvas");return e=e||0,r=r||0,a.style.width=e+"px",a.style.height=r+"px",a.width=e*t.devicePixelRatio,a.height=r*t.devicePixelRatio,a};var d=null;t.GL=t.Browser.isNode?function(t,e){return null}:function(t,e){e=e||{depth:!1,alpha:!0,premultipliedAlpha:!1,antialias:!0,stencil:!1,preserveDrawingBuffer:!1};var n=null;if(d)n=t.getContext(d,e);else{var r,a=["webgl2","experimental-webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"],i=a.length;for(r=0;i>r;++r){try{n=t.getContext(a[r],e)}catch(o){n=null}if(n){d=a[r];break}}}return n}}(a),!function(t,e){function n(t,e,n,r){return r=r||T,r&k&&(t.width=e,t.oCanvas.style.width=e+"px",t.oCanvas.width=e*o,t._restorable&&(t.iCanvas.style.width=t.oCanvas.style.width,t.iCanvas.width=t.oCanvas.width),t.tmpCanvas&&(t.tmpCanvas.style.width=t.oCanvas.style.width,t.tmpCanvas.width=t.oCanvas.width)),r&L&&(t.height=n,t.oCanvas.style.height=n+"px",t.oCanvas.height=n*o,t._restorable&&(t.iCanvas.style.height=t.oCanvas.style.height,t.iCanvas.height=t.oCanvas.height),t.tmpCanvas&&(t.tmpCanvas.style.height=t.oCanvas.style.height,t.tmpCanvas.height=t.oCanvas.height)),t}function r(t,e){var n=t.width,r=t.height;return e=e||255,t._restorable&&e&x&&t._refresh&x&&(t.iData=t.ictx.getImageData(0,0,n,r),t._refresh&=~x),e&M&&t._refresh&M&&(t.oData=t.octx.getImageData(0,0,n,r),t._refresh&=~M),t}function a(t,e){if(t.selection){var n=t.selection,r=t.width-1,a=t.height-1,i=w(n[0]*r),o=w(n[1]*a),s=w(n[2]*r)-i+1,l=w(n[3]*a)-o+1;e=e||255,t._restorable&&e&D&&t._refresh&D&&(t.iDataSel=t.ictx.getImageData(i,o,s,l),t._refresh&=~D),e&S&&t._refresh&S&&(t.oDataSel=t.octx.getImageData(i,o,s,l),t._refresh&=~S)}return t}var i="prototype",o=t.devicePixelRatio,s=t.ImArray,l=t.ImArrayCopy,u=(t.Array32F,t.CHANNEL,t.FORMAT),h=t.MIME,c=0,f=t.Color,d=f.Gradient,g=t.Util.Image,p=t.Canvas,m=t.CanvasProxy,_=t.Util.Array,v=_.arrayset,y=_.subarray,w=(Math.min,Math.floor),C=1,I=2,b=4,R=8,A=C|I|b|R,x=1,M=2,D=4,S=8,E=16,O=32,G=64,k=2,L=4,T=k|L,P=D|S,F=x|M,H=~P,B=~E,N=~O;g.scale=g.resize=t.Interpolation.bilinear;var U=t.Image=t.Class({name:"Image",constructor:function Y(t){var e=this,n=0,r=0;return e instanceof Y?(e.id=++c,e.width=n,e.height=r,e.tmpCanvas=null,e.iCanvas=p(n,r),e.oCanvas=p(n,r),e.iData=null,e.iDataSel=null,e.oData=null,e.oDataSel=null,e.ictx=e.iCanvas.getContext("2d"),e.octx=e.oCanvas.getContext("2d"),e.domElement=e.oCanvas,e._gl=null,e._restorable=!0,e.gray=!1,e.selection=null,e._histogram=[null,null,null,null],e._integral=[null,null,null,null],e._spectrum=[null,null,null,null],e._refresh=0,e._hstRefresh=0,e._intRefresh=0,e._spcRefresh=0,void(t&&e.image(t))):new Y(t)},id:null,width:0,height:0,gray:!1,selection:null,tmpCanvas:null,iCanvas:null,oCanvas:null,ictx:null,octx:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,_restorable:!0,_gl:e,_histogram:null,_integral:null,_spectrum:null,_refresh:0,_hstRefresh:0,_intRefresh:0,_spcRefresh:0,dispose:function(){var t=this;return t.id=null,t.width=t.height=null,t.selection=t.gray=null,t.iData=t.iDataSel=t.oData=t.oDataSel=null,t.domElement=t.tmpCanvas=t.iCanvas=t.oCanvas=t.ictx=t.octx=null,t._restorable=t._gl=null,t._histogram=t._integral=t._spectrum=null,t._hstRefresh=t._intRefresh=t._spcRefresh=t._refresh=null,t},clone:function(t){return new U(!0===t?this.iCanvas:this.oCanvas)},gl:function(n){return e===this._gl&&(this._gl=t.GL(this.oCanvas,n)),this._gl},grayscale:function(t){var e=this;return arguments.length?(e.gray=!!t,e):e.gray},restorable:function(t){var e=this;return arguments.length||(t=!0),e._restorable=!!t,e},apply:function(t,e){return t.apply(this,this,e||null),this},apply2:function(t,e,n){return t.apply(this,e,n||null),this},select:function(t,e,n,r){var a=this,i=arguments.length;return 1>i&&(t=0),2>i&&(e=0),3>i&&(n=1),4>i&&(r=1),a.selection=[0>t?0:t>1?1:t,0>e?0:e>1?1:e,0>n?0:n>1?1:n,0>r?0:r>1?1:r],a._refresh|=P,a},deselect:function(){var t=this;return t.selection=null,t.iDataSel=null,t.oDataSel=null,t._refresh&=H,t},store:function(){var t=this;return t._restorable&&(t.ictx.drawImage(t.oCanvas,0,0),t._refresh|=x,t.selection&&(t._refresh|=D)),t},restore:function(){var t=this;return t._restorable&&(t.octx.drawImage(t.iCanvas,0,0),t._refresh|=M|E|O|G,t._hstRefresh=A,t._intRefresh=A,t._spcRefresh=A,t.selection&&(t._refresh|=S)),t},dimensions:function(t,e,r){var a=this;return a._refresh|=F|E|O|G,a._hstRefresh=A,a._intRefresh=A,a._spcRefresh=A,a.selection&&(a._refresh|=P),n(a,t,e,T),a},setDimensions:null,scale:function(t,e){var n=this;if(t=t||1,e=e||t,1===t&&1===e)return n;n.tmpCanvas=n.tmpCanvas||p(n.width,n.height);var r=n.tmpCanvas.getContext("2d"),a=n.width,i=n.height;return r.scale(t,e),a=n.width=t*a+.5|0,i=n.height=e*i+.5|0,r.drawImage(n.oCanvas,0,0),n.oCanvas.style.width=a+"px",n.oCanvas.style.height=i+"px",n.oCanvas.width=a*o,n.oCanvas.height=i*o,n.octx.drawImage(n.tmpCanvas,0,0),n._restorable&&(r.drawImage(n.iCanvas,0,0),n.iCanvas.style.width=n.oCanvas.style.width,n.iCanvas.style.height=n.oCanvas.style.height,n.iCanvas.width=n.oCanvas.width,n.iCanvas.height=n.oCanvas.height,n.ictx.drawImage(n.tmpCanvas,0,0)),n.tmpCanvas.width=n.oCanvas.width,n.tmpCanvas.height=n.oCanvas.height,n._refresh|=F|E|O|G,n._hstRefresh=A,n._intRefresh=A,n._spcRefresh=A,n.selection&&(n._refresh|=P),n},flipHorizontal:function(){var t=this;t.tmpCanvas=t.tmpCanvas||p(t.width,t.height);var e=t.tmpCanvas.getContext("2d");return e.translate(t.width,0),e.scale(-1,1),e.drawImage(t.oCanvas,0,0),t.octx.drawImage(t.tmpCanvas,0,0),t._restorable&&(e.drawImage(t.iCanvas,0,0),t.ictx.drawImage(t.tmpCanvas,0,0)),t._refresh|=F|O|G,t._intRefresh=A,t.selection&&(t._refresh|=P),t},flipVertical:function(){var t=this;t.tmpCanvas=t.tmpCanvas||p(t.width,t.height);var e=t.tmpCanvas.getContext("2d");return e.translate(0,t.height),e.scale(1,-1),e.drawImage(t.oCanvas,0,0),t.octx.drawImage(t.tmpCanvas,0,0),t._restorable&&(e.drawImage(t.iCanvas,0,0),t.ictx.drawImage(t.tmpCanvas,0,0)),t._refresh|=F|O|G,t._intRefresh=A,t.selection&&(t._refresh|=P),t},clear:function(){var t=this,e=t.width,n=t.height;return e&&n&&(t._restorable&&t.ictx.clearRect(0,0,e,n),t.octx.clearRect(0,0,e,n),t._refresh|=F|E|O|G,t._hstRefresh=A,t._intRefresh=A,t._spcRefresh=A,t.selection&&(t._refresh|=P)),t},crop:function(t,e,n,r){var a,i,s,l,u,h,c,f,d=this,g=d.selection,m=d.width,_=d.height;if(arguments.length)u=t,h=e,c=n-t+1,f=r-e+1;else{if(!g)return d;a=w(g[0]*(m-1)),i=w(g[1]*(_-1)),s=w(g[2]*(m-1))-a+1,l=w(g[3]*(_-1))-i+1,u=a,h=i,c=s,f=l,g[0]=0,g[1]=0,g[2]=1,g[3]=1}d.tmpCanvas=d.tmpCanvas||p(d.width,d.height);var v=d.tmpCanvas.getContext("2d");return v.drawImage(d.oCanvas,0,0,m,_,u,h,c,f),d.oCanvas.style.width=c+"px",d.oCanvas.style.height=f+"px",d.oCanvas.width=c*o,d.oCanvas.height=f*o,d.octx.drawImage(d.tmpCanvas,0,0),d._restorable&&(v.drawImage(d.iCanvas,0,0,m,_,u,h,c,f),d.iCanvas.style.width=d.oCanvas.style.width,d.iCanvas.style.height=d.oCanvas.style.height,d.iCanvas.width=d.oCanvas.width,d.iCanvas.height=d.oCanvas.height,d.ictx.drawImage(d.tmpCanvas,0,0)),d.tmpCanvas.width=d.oCanvas.width,d.tmpCanvas.height=d.oCanvas.height,d._refresh|=F|E|O|G,d._hstRefresh=A,d._intRefresh=A,d._spcRefresh=A,g&&(d._refresh|=P),d},fill:function(t,n,r,a,i){var o,s,l,u,h=this,c=h.selection,f=h.width,d=h.height;c?(o=w(c[0]*(f-1)),s=w(c[1]*(d-1)),l=w(c[2]*(f-1))-o+1,u=w(c[3]*(d-1))-s+1):(o=0,s=0,l=f,u=d),e===n&&(n=o),e===r&&(r=s),e===a&&(a=l),e===i&&(i=u),a&&!f&&i&&!d&&h.createImageData(a,i);var g=h.ictx,p=h.octx;return t=t||0,h._restorable&&(g.fillStyle=t,g.fillRect(n,r,a,i)),p.fillStyle=t,p.fillRect(n,r,a,i),h._refresh|=F|E|O|G,h._hstRefresh=A,h._intRefresh=A,h._spcRefresh=A,c&&(h._refresh|=P),h},getData:function(t){var e,n=this;return n._restorable&&!t?(n._refresh&x&&r(n,x),e=n.iData):(n._refresh&M&&r(n,M),e=n.oData),new l(e.data)},getSelectedData:function(t){var e,n=this;return n.selection?n._restorable&&!t?(n._refresh&D&&a(n,D),e=n.iDataSel):(n._refresh&S&&a(n,S),e=n.oDataSel):n._restorable&&!t?(n._refresh&x&&r(n,x),e=n.iData):(n._refresh&M&&r(n,M),e=n.oData),[new l(e.data),e.width,e.height]},setData:_.hasArrayset?function(t){var e=this;return e._refresh&M&&r(e,M),e.oData.data.set(t),e.octx.putImageData(e.oData,0,0),e._refresh|=E|O|G,e._hstRefresh=A,e._intRefresh=A,e._spcRefresh=A,e.selection&&(e._refresh|=S),e}:function(t){var e=this;return e._refresh&M&&r(e,M),v(e.oData.data,t),e.octx.putImageData(e.oData,0,0),e._refresh|=E|O|G,e._hstRefresh=A,e._intRefresh=A,e._spcRefresh=A,e.selection&&(e._refresh|=S),e},setSelectedData:_.hasArrayset?function(t){var e=this;if(e.selection){var n=e.selection,i=e.width-1,o=e.height-1,s=w(n[0]*i),l=w(n[1]*o);e._refresh&S&&a(e,S),e.oDataSel.data.set(t),e.octx.putImageData(e.oDataSel,s,l),e._refresh|=M}else e._refresh&M&&r(e,M),e.oData.data.set(t),e.octx.putImageData(e.oData,0,0);return e._refresh|=E|O|G,e._hstRefresh=A,e._intRefresh=A,e._spcRefresh=A,e}:function(t){var e=this;if(e.selection){var n=e.selection,i=e.width-1,o=e.height-1,s=w(n[0]*i),l=w(n[1]*o);e._refresh&S&&a(e,S),v(e.oDataSel.data,t),e.octx.putImageData(e.oDataSel,s,l),e._refresh|=M}else e._refresh&M&&r(e,M),v(e.oData.data,t),e.octx.putImageData(e.oData,0,0);return e._refresh|=E|O|G,e._hstRefresh=A,e._intRefresh=A,e._spcRefresh=A,e},createImageData:function(t,e){var r,a,i=this;return n(i,t,e,T),i._restorable&&(r=i.ictx=i.iCanvas.getContext("2d"),r.createImageData(t,e)),a=i.octx=i.oCanvas.getContext("2d"),a.createImageData(t,e),i._refresh|=F,i.selection&&(i._refresh|=P),i},image:_.hasArrayset?function(t){if(!t)return this;var e,a,i,o,s,l,u,h=this;return t instanceof U&&(t=t.oCanvas),s="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,l="undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||t instanceof m,u="undefined"!=typeof Image&&t instanceof Image,s?(i=t.videoWidth,o=t.videoHeight):(i=t.width,o=t.height),u||l||s?(n(h,i,o,T),h._restorable&&(e=h.ictx=h.iCanvas.getContext("2d"),e.drawImage(t,0,0)),a=h.octx=h.oCanvas.getContext("2d"),a.drawImage(t,0,0),h._refresh|=F):(h.oData||(h.createImageData(i,o),r(h,F)),h._restorable&&(e=h.ictx=h.iCanvas.getContext("2d"),h.iData.data.set(t.data),e.putImageData(h.iData,0,0)),a=h.octx=h.oCanvas.getContext("2d"),h.oData.data.set(t.data),a.putImageData(h.oData,0,0)),h._refresh|=E|O|G,h._hstRefresh=A,h._intRefresh=A,h._spcRefresh=A,h.selection&&(h._refresh|=P),h}:function(t){if(!t)return this;var e,a,i,o,s,l,u,h=this;return t instanceof U&&(t=t.oCanvas),s="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,l="undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||t instanceof m,u="undefined"!=typeof Image&&t instanceof Image,s?(i=t.videoWidth,o=t.videoHeight):(i=t.width,o=t.height),u||l||s?(n(h,i,o,T),h._restorable&&(e=h.ictx=h.iCanvas.getContext("2d"),e.drawImage(t,0,0)),a=h.octx=h.oCanvas.getContext("2d"),a.drawImage(t,0,0)):(h.oData||(h.createImageData(i,o),r(h,F)),h._restorable&&(e=h.ictx=h.iCanvas.getContext("2d"),v(h.iData.data,t.data),e.putImageData(h.iData,0,0)),a=h.octx=h.oCanvas.getContext("2d"),v(h.oData.data,t.data),a.putImageData(h.oData,0,0)),h._refresh|=E|O|G,h._hstRefresh=A,h._intRefresh=A,h._spcRefresh=A,h.selection&&(h._refresh|=P),h},setImage:null,getPixel:function(t,e){var n,a=this,i=a.width,o=a.height;return 0>t||t>=i||0>e||e>=o?null:(a._refresh&M&&r(a,M),n=(e*i+t|0)<<2,y(a.oData.data,n,n+4))},setPixel:function(t,e,n){var r=this,a=r.width,i=r.height;return 0>t||t>=a||0>e||e>=i?r:(r.octx.putImageData(n,t,e),r._refresh|=M|E|O|G,r._hstRefresh=A,r._intRefresh=A,r._spcRefresh=A,r.selection&&(r._refresh|=S),r)},getPixelData:function(){return this._refresh&M&&r(this,M),this.oData},setPixelData:function(t){var e=this;return e.octx.putImageData(t,0,0),e._refresh|=M|E|O|G,e._hstRefresh=A,e._intRefresh=A,e._spcRefresh=A,e.selection&&(e._refresh|=S),e},integral:function(t){var e,n=this,r=n.gray,a=g.integral,i=n._integral;if(null==t){if(n._refresh&O){var o,s=n.getPixelData().data,l=n.width,u=n.height;i[0]=o=a(s,l,u,0),i[1]=r?o:a(s,l,u,1),i[2]=r?o:a(s,l,u,2),i[3]=null,n._intRefresh=0,n._refresh&=N}}else t=t||0,e=1<<t,(n._refresh&O||n._intRefresh&e)&&(!r||n._intRefresh&C?!r||n._intRefresh&I?!r||n._intRefresh&b?i[t]=a(n.getPixelData().data,n.width,n.height,t):i[t]=i[2]:i[t]=i[1]:i[t]=i[0],n._intRefresh&=~e,n._refresh&=N);return null==t?i:i[t||0]},sat:null,histogram:function(t,e){var n,r=this,a=r.gray,i=g.histogram,o=r._histogram;if(null==t){if(r._refresh&E){var s,l=r.getPixelData().data,u=r.width,h=r.height;o[0]=s=i(l,u,h,0,e),o[1]=a?s:i(l,u,h,1,e),o[2]=a?s:i(l,u,h,2,e),o[3]=null,r._hstRefresh=0,r._refresh&=B}}else t=t||0,n=1<<t,(r._refresh&E||r._hstRefresh&n)&&(!a||r._hstRefresh&C?!a||r._hstRefresh&I?!a||r._hstRefresh&b?o[t]=i(r.getPixelData().data,r.width,r.height,t,e):o[t]=o[2]:o[t]=o[1]:o[t]=o[0],r._hstRefresh&=~n,r._refresh&=B);return null==t?o:o[t||0]},spectrum:function(t){var e=this,n=e._spectrum;return null==t?n:n[t||0]},fft:null,linearGradient:function(t,e,n,r){var a=this,i=a.width,o=a.height,l=d.stops(t,e);return a.setData(d.linear(new s(i*o<<2),i,o,l[0],l[1],n,r||d.interpolate)),a},radialGradient:function(t,e,n,r,a,i,o){var l=this,u=l.width,h=l.height,c=d.stops(t,e);return l.setData(d.radial(new s(u*h<<2),u,h,c[0],c[1],n,r,a,i,o||d.interpolate)),l},perlinNoise:function(t,e,n,r,a,i,o,l,u,h){var c=this,f=c.width,d=c.height;return g.perlin&&(t&&g.perlin.seed(t),c.setData(g.perlin(new s(f*d<<2),f,d,e,n,r,a,i,o,l,u,h)),c.gray=!!n),c},toImage:function(t,e){t=t||0,e=e||1;var n=this.oCanvas,r=null,a=16&t;if(r=u.JPG===a?n.toDataURL(h.JPG,e):u.GIF===a?n.toDataURL(h.GIF,e):n.toDataURL(h.PNG,e),t&u.IMAGE){var i=new Image;return i.src=r,i}return r},toString:function(){return"[FILTER Image: "+this.name+"]"}});U[i].setImage=U[i].image,U[i].setDimensions=U[i].dimensions,U[i].sat=U[i].integral,U[i].fft=U[i].spectrum,U.LinearGradient=U.Gradient=function(t,e,n,r,a,i){return(new U).restorable(!1).createImageData(t,e).linearGradient(n,r,a,i||d.interpolate)},U.RadialGradient=function(t,e,n,r,a,i,o,s,l){return(new U).restorable(!1).createImageData(t,e).radialGradient(n,r,a,i,o,s,l||d.interpolate)},U.PerlinNoise=function(t,e,n,r,a,i,o,s,l,u,h,c){return(new U).restorable(!1).createImageData(t,e).perlinNoise(n,r,a,i,o,s,l,u,h,c)};var W=t.ScaledImage=t.Class(U,{name:"ScaledImage",constructor:function K(t,e,n){var r=this;return r instanceof K?(r.scaleX=t||1,r.scaleY=e||r.scaleX,void r.$super("constructor",n)):new K(t,e,n)},scaleX:1,scaleY:1,dispose:function(){var t=this;return t.scaleX=null,t.scaleY=null,t.$super("dispose"),t},clone:function(t){var e=this;return new W(e.scaleX,e.scaleY,!0===t?e.iCanvas:e.oCanvas)},setScale:function(t,e){var n=this,r=arguments.length;return r>0&&null!=t&&(n.scaleX=t,n.scaleY=t),r>1&&null!=e&&(n.scaleY=e),n},image:function(t){if(!t)return this;var e,r,a,i,o,s,l,u,h,c=this,f=c.scaleX,d=c.scaleY;return t instanceof U&&(t=t.oCanvas),l="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,u="undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||t instanceof m,h="undefined"!=typeof Image&&t instanceof Image,l?(a=t.videoWidth,i=t.videoHeight):(a=t.width,i=t.height),(h||u||l)&&(o=f*a+.5|0,s=d*i+.5|0,n(c,o,s,T),c._restorable&&(e=c.ictx=c.iCanvas.getContext("2d"),e.drawImage(t,0,0,a,i,0,0,o,s)),r=c.octx=c.oCanvas.getContext("2d"),r.drawImage(t,0,0,a,i,0,0,o,s),c._refresh|=F|E|O|G,c._hstRefresh=A,c._intRefresh=A,c._spcRefresh=A,c.selection&&(c._refresh|=P)),c}});W[i].setImage=W[i].image}(a),!function(t,e){t.IO.Loader=t.IO.Reader=t.Class({name:"IO.Loader",__static__:{load:t.Classy.Method(function(t,e,n){return function(t,e,r){return(new n).load(t,e,r)}},t.Classy.LATE|t.Classy.STATIC)},constructor:function(){},_crossOrigin:null,_responseType:null,dispose:function(){var t=this;return t._crossOrigin=null,t._responseType=null,t},load:function(t,e,n){return null},responseType:function(t){var e=this;return arguments.length?(e._responseType=t,e):e._responseType},crossOrigin:function(t){var e=this;return arguments.length?(e._crossOrigin=t,e):e._crossOrigin}}),t.IO.Loader.prototype.read=t.IO.Loader.prototype.load,t.IO.Writer=t.Class({name:"IO.Writer",__static__:{write:t.Classy.Method(function(t,e,n){return function(t,e,r,a){return(new n).write(t,e,r,a)}},t.Classy.LATE|t.Classy.STATIC)},constructor:function(){},_encoding:null,dispose:function(){var t=this;return t._encoding=null,t},write:function(t,e,n,r){return null},encoding:function(t){var e=this;return arguments.length?(e._encoding=t,e):e._encoding}})}(a),!function(t,e){function n(t){var e,n;for(t>0&&1>t&&(t*=65536),t=c(t),256>t&&(t|=t<<8),n=0;256>n;n++)e=1&n?d[n]^255&t:d[n]^t>>8&255,g[n]=g[n+256]=e}function r(t,e,n){var r=7&t,a=4>r?e:n,i=4>r?n:e;return(1&r?-a:a)+(2&r?-2*i:2*i)}function a(t,e){var n,a,i,o,s,l=.366025403,u=.211324865,h=(t+e)*l,f=t+h,d=e+h,p=c(f),m=c(d),_=(p+m)*u,v=p-_,y=m-_,w=t-v,C=e-y;w>C?(o=1,s=0):(o=0,s=1);var I=w-o+u,b=C-s+u,R=w-1+2*u,A=C-1+2*u,x=255&p,M=255&m,D=.5-w*w-C*C;0>D?n=0:(D*=D,n=D*D*r(g[x+g[M]],w,C));var S=.5-I*I-b*b;0>S?a=0:(S*=S,a=S*S*r(g[x+o+g[M+s]],I,b));var E=.5-R*R-A*A;return 0>E?i=0:(E*=E,i=E*E*r(g[x+1+g[M+1]],R,A)),40*(n+a+i)}function i(t){return t*t*t*(t*(6*t-15)+10)}function o(t,e,n){return e+t*(n-e)}function s(t,e){var n,a,s,l,u,h,f,d,p,m,_,v,y,w;return n=c(t),a=c(e),u=t-n,h=e-a,f=u-1,d=h-1,s=n+1&255,l=a+1&255,n=255&n,a=255&a,m=i(h),p=i(u),_=r(g[n+g[a]],u,h),v=r(g[n+g[l]],u,d),y=o(m,_,v),_=r(g[s+g[a]],f,h),v=r(g[s+g[l]],f,d),w=o(m,_,v),.507*o(p,y,w)}function l(t,e,n,r,a,i,o,s,l,u,h,c,f){var d,g,p,m,_=0,v=c,y=1,w=0;for(d=0;u>d;d++)g=(r+h[d][0])%i,p=(a+h[d][1])%o,_+=n(v*g*s,v*p*l)*y,v*=2,w+=y,y*=f;m=~~(255*(.5*_/w+.5)),t[e]=m,t[e+1]=m,t[e+2]=m,t[e+3]=255}function u(t,e,n,r,a,i,o,s,l,u,h,c,f){var d,g,p,m,_=0,v=c,y=1,w=0;for(d=0;u>d;d++)g=(r+h[d][0])%i,p=(a+h[d][1])%o,_+=n(v*g*s,v*p*l)*y,v*=2,w+=y,y*=f;m=~~(16777215*(.5*_/w+.5)),t[e]=m>>>16&255,t[e+1]=m>>>8&255,t[e+2]=255&m,t[e+3]=255}var h=t.Util.Image,c=(t.Image,Math.floor),f=(Math.sin,Math.cos,t.CONST.PI2,t.Array8U),d=new f([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),g=new f(d);h.perlin=function(t,e,n,r,i,o,h,c,f,d,g,p){var m,_,v,y,w,C,I=1/o,b=1/h,R=p?s:a,A=i?l:u,x=t.length,M=e>>>1,D=n>>>1;if(d=d||1,g=g||.5,c=c||1,f=f||[[0,0]],r)for(m=0,_=0,w=0;x>w;w+=4,m++)m>=e&&(m=0,_++),v=m>M?e-1-m:m,y=_>D?n-1-_:_,m>v||_>y?(C=y*e+v<<2,t[w]=t[C],t[w+1]=t[C+1],t[w+2]=t[C+2],t[w+3]=255):A(t,w,R,v,y,e,n,I,b,c,f,d,g);else for(m=0,_=0,w=0;x>w;w+=4,m++)m>=e&&(m=0,_++),A(t,w,R,m,_,e,n,I,b,c,f,d,g);return t},h.perlin.seed=n}(a),a});