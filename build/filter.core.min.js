/**
*
*   FILTER.js
*   @version: 0.9.0
*   @built on 2016-07-21 23:47:08
*   @dependencies: Classy.js, Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n){"use strict";function r(e,t,n,r){return e?t.map(function(t,a){return(n?e[a]:e[t])||(r?r(t):null)}):[]}var a="Classy,Asynchronous".split(/\s*,\s*/);"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[t]=n.apply(e,r(module.$deps,a,!1,function(e){return require("./"+e.toLowerCase())}))):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["module"].concat(a),function(t){return n.moduleUri=t.uri,n.apply(e,r(Array.prototype.slice.call(arguments,1),a,!0))}):t in e||(e[t]=n.apply(e,r(e,a)))&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}(this,"FILTER",function e(t,n){"use strict";var r=t.Merge({Classy:t,Asynchronous:n,Path:n.path(e.moduleUri)},t);return r.VERSION="0.9.0",!function(e,t,n){var r,a="prototype",i=(Object[a],Function[a],Array[a]),o=t.Path,s=t.Merge,l=t.Asynchronous,u=l.isPlatform(l.Platform.NODE),c=l.isPlatform(l.Platform.BROWSER),h=l.supportsMultiThreading(),d=l.isThread(),f="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",g="undefined"!=typeof navigator&&navigator.platform?navigator.platform:"",p="undefined"!=typeof navigator&&navigator.vendor?navigator.vendor:"",m=function(){return"[FILTER Plugin: "+this.name+"]"},v=function(e,t,n,r){return e},y=function(){},w=function(e){return function(){this.$super("constructor"),e.apply(this,arguments)}},_=(t.devicePixelRatio=e.devicePixelRatio||1,t._notSupportClamp="undefined"==typeof Uint8ClampedArray),C=("undefined"==typeof Int16Array||"function"!=typeof Int16Array[a].set,function(e,t){var n=e.length;for(t=t||0;--n>=0;)this[n+t]=e[n]}),I=i.slice,b=0,R=t.Browser={isNode:u,isBrowser:c,isWorker:d,supportsWorker:h,isPhantom:/PhantomJS/.test(f),isOpera:c&&/Opera|OPR\//.test(f),isFirefox:c&&/Firefox\//.test(f),isChrome:c&&/Chrome\//.test(f),isSafari:c&&/Apple Computer/.test(p),isKhtml:c&&/KHTML\//.test(f),isIE:c&&(/MSIE \d/.test(f)||/Trident\/\d/.test(f)),isGecko:c&&/gecko\/\d/i.test(f),isWebkit:c&&/WebKit\//.test(f),isMac_geLion:c&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(f),isMac_geMountainLion:c&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(f),isMobile:!1,isIOS:/AppleWebKit/.test(f)&&/Mobile\/\w+/.test(f),isWin:/windows/i.test(g),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1};R.isMobile=R.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(f),R.isMac=R.isIOS||/Mac/.test(g),R.isIE_lt8=R.isIE&&!d&&(null==document.documentMode||document.documentMode<8),R.isIE_lt9=R.isIE&&!d&&(null==document.documentMode||document.documentMode<9),R.isQtWebkit=R.isWebkit&&/Qt\/\d+\.\d+/.test(f),t.getPath=l.path,t.uuid=function(e){return[e||"filter",(new Date).getTime(),++b].join("_")},t.Array=Array,t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,t.Array32F[a].set||(t.Array32F[a].set=C,t.Array64F[a].set=C,t.Array8I[a].set=C,t.Array16I[a].set=C,t.Array32I[a].set=C,t.Array8U[a].set=C,t.Array16U[a].set=C,t.Array32U[a].set=C),t.Array32F[a].subarray||(t.Array32F[a].subarray=I,t.Array64F[a].subarray=I,t.Array8I[a].subarray=I,t.Array16I[a].subarray=I,t.Array32I[a].subarray=I,t.Array8U[a].subarray=I,t.Array16U[a].subarray=I,t.Array32U[a].subarray=I),t.ImArray=_?t.Array8U:Uint8ClampedArray,t.ImArrayCopy=R.isOpera?t.Array8U:t.ImArray,t.TypedArray=R.isNode?function(e,t){return null==e||e instanceof t?e:Array.isArray(e)?Array===t?e:new t(e):(null==e.length&&(e.length=Object.keys(e).length),Array===t?Array.prototype.slice.call(e):new t(Array.prototype.slice.call(e)))}:function(e,t){return e},_&&"undefined"!=typeof CanvasPixelArray&&"function"!==CanvasPixelArray[a].set&&(CanvasPixelArray[a].set=C),_=t._notSupportClamp=_||R.isOpera,t.NotImplemented=function(e){return e=e||"",function(){throw new Error("Method "+e+" not Implemented!")}},t.useWebGL=!1,t.useWebGLSharedResources=!1,t.useWebGLIfAvailable=function(e){},t.useWebGLSharedResourcesIfAvailable=function(e){},t.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3},t.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4,TILE:8,STRETCH:16},t.LUMA=new t.Array32F([.212671,.71516,.072169]),t.FORMAT={IMAGE:1,DATA:4,PNG:8,JPG:16,GIF:32,BMP:64,TGA:128,RGBE:256},t.MIME={PNG:"image/png",JPG:"image/jpeg",GIF:"image/gif",BMP:"image/bmp"},t.FORMAT.JPEG=t.FORMAT.JPG,t.MIME.JPEG=t.MIME.JPG,t.Util={},t.IO={},t.Codec={},t.Interpolation={},t.Transform={},t.MachineLearning=t.ML={},r=t.log=d?l.log:console&&console.log?function(e){console.log(e)}:function(e){},t.warning=function(e){r("WARNING: "+e)},t.error=function(e,t){if(r("ERROR: "+e),t)throw new Error(e)};var A=t.FilterThread=t.Class(l,{path:o,name:null,constructor:function(){var e=this,n=null;d&&e.initThread().listen("load",function(e){e&&e.filter&&(n&&(n.dispose(!0),n=null),n=l.load("FILTER."+e.filter))}).listen("import",function(e){e&&e["import"]&&e["import"].length&&l.importScripts(e["import"].join?e["import"].join(","):e["import"])}).listen("params",function(e){n&&n.unserialize(e)}).listen("apply",function(r){if(n&&r&&r.im){r.params&&n.unserialize(r.params);var a=t.TypedArray(r.im[0],t.ImArray);e.send("apply",{im:n._apply(a,r.im[1],r.im[2]),meta:n.hasMeta?n.getMeta():null})}else e.send("apply",{im:null})}).listen("dispose",function(t){n&&(n.dispose(!0),n=null),e.dispose(!0)})},thread:function(e){var t=this;return arguments.length||(e=!0),e=!!e,e&&!t.$thread?(t.fork("FILTER.FilterThread",o.file!==t.path.file?[o.file,t.path.file]:t.path.file),t.send("load",{filter:t.name})):!e&&t.$thread&&t.unfork(),t},sources:function(){var e=i.slice.call(arguments);if(e.length){var t,n=[];for(t=0;t<e.length;t++)"function"==typeof e[t]?n.push(l.blob(e[t].toString())):n.push(l.blob(e[t]));this.send("import",{"import":n.join(",")})}return this},scripts:function(){var e=i.slice.call(arguments);return e.length&&this.send("import",{"import":e.join(",")}),this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{}}},unserialize:function(e){var t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn),t}}),x=t.Filter=t.Class(A,{name:"Filter",constructor:function(){},id:null,_isOn:!0,_update:!0,_onComplete:null,hasMeta:!1,dispose:function(){var e=this;return e.$super("dispose"),e.name=null,e.id=null,e._isOn=null,e._update=null,e._onComplete=null,e.hasMeta=null,e},worker:A[a].thread,complete:function(e){return this._onComplete=e||null,this},isOn:function(){return this._isOn},update:function(e){return arguments.length||(e=!0),this._update=!!e,this},turnOn:function(e){return arguments.length||(e=!0),this._isOn=!!e,this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this},canRun:function(){return this._isOn},getMeta:function(){},setMeta:function(e){return this},combineWith:function(e){return this},_apply:function(e,t,n,r){return e},apply:function(e,n,r){var a,i,o=this;return o.canRun()?(arguments.length<3&&(n&&n.setSelectedData?r=null:"function"==typeof n?(r=n,n=e):(n=e,r=null)),e&&n&&(r=r||o._onComplete,a=e.getSelectedData(),o.$thread?o.listen("apply",function(e){o.unlisten("apply"),e&&e.im&&(e.meta&&o.setMeta(e.meta),o._update&&n.setSelectedData(t.TypedArray(e.im,t.ImArray))),r&&r.call(o)}).send("apply",{im:a,params:o.serialize()}):(i=o._apply(a[0],a[1],a[2],e),o._update&&n.setSelectedData(i),r&&r.call(o))),e):e},toString:function(){return"[FILTER: "+this.name+"]"}});t.Create=function(e){e=s({init:y,name:"PluginFilter",toString:m,apply:v},e),e.constructor=w(e.init),e._apply=e.apply,delete e.init,delete e.apply;var n=e.name;return t[n]=t.Class(x,e)}}(this,r),!function(e,t){function n(e,t,n){return e>n?n:t>e?t:e}function r(e){return w(2,_(S(e)))}function a(e,t){var n=new v(2);return n[E]=e||0,n[k]=t||0,n}function i(e,t,n){var r=new v(3);return r[E]=e||0,r[k]=t||0,r[P]=n||0,r}function o(e,t,n){var r=1-n;return a(n*e[E]+r*t[E],n*e[k]+r*t[k])}function s(e,t,n){var r=1-n;return i(n*e[E]+r*t[E],n*e[k]+r*t[k],n*e[P]+r*t[P])}function l(e,t){return e[E]*t[k]-t[E]*e[k]}function u(e,t){var n;return 0>e&&(e=-e),0>t&&(t=-t),0==e?t:0==t?e:e>t?(n=t/e,e*y(1+n*n)):(n=e/t,t*y(1+n*n))}function c(e,t){var n,r,i,o,s;return n=a(e[E]-t[E],e[k]-t[k]),0===n[k]&&0===n[E]?null:(r=a(0,0),0===n[E]&&(r[E]=10),0===n[k]&&(r[k]=10),0!==n[k]&&0!==n[E]&&(i=n[k]/n[E],o=-n[E]/n[k],r[E]=10,r[k]=o*r[E]),s=u(r[E],r[k]),r[E]/=s,r[k]/=s,0>l(n,r)&&(r[E]=-r[E],r[k]=-r[k]),r)}function h(e,t,n,r){var a,i,o,s,l,u,c,h,d,f,g=t<<2,p=e.length,m=p>>2;for(f=!0!==r,a=new v(m),h=0,c=0,s=l=u=0,d=0;t>d;d++,c+=4,h++)s+=e[c],a[h]=s;for(c=g,d=0,h=0,s=l=u=0,c=g;p>c;c+=4,h++,d++)d>=t&&(d=0,s=l=u=0),s+=e[c],a[h+t]=a[h]+s;if(f){for(i=new v(m),o=new v(m),h=0,c=0,s=l=u=0,d=0;t>d;d++,c+=4,h++)l+=e[c+1],u+=e[c+2],i[h]=l,o[h]=u;for(c=g,d=0,h=0,s=l=u=0,c=g;p>c;c+=4,h++,d++)d>=t&&(d=0,s=l=u=0),l+=e[c+1],u+=e[c+2],i[h+t]=i[h]+l,o[h+t]=o[h]+u;return[a,i,o]}return[a,a,a]}function d(e,t,n,r){var a,i,o,s,l,u,c,h,d,f,g,p=e.length,m=0,y=0,w=0,_=255,C=255,I=255,b=1/(p>>2);for(g=!0!==r,a=new v(256),f=0;256>f;f+=8)a[f]=0,a[f+1]=0,a[f+2]=0,a[f+3]=0,a[f+4]=0,a[f+5]=0,a[f+6]=0,a[f+7]=0;for(f=0;p>f;f+=4)s=e[f],a[s]+=b,s>m?m=s:_>s&&(_=s);for(c=h=d=0,f=0;256>f;f+=8)c+=a[f],a[f]=c,c+=a[f+1],a[f+1]=c,c+=a[f+2],a[f+2]=c,c+=a[f+3],a[f+3]=c,c+=a[f+4],a[f+4]=c,c+=a[f+5],a[f+5]=c,c+=a[f+6],a[f+6]=c,c+=a[f+7],a[f+7]=c;if(g){for(i=new v(256),o=new v(256),f=0;256>f;f+=8)i[f]=0,o[f]=0,i[f+1]=0,o[f+1]=0,i[f+2]=0,o[f+2]=0,i[f+3]=0,o[f+3]=0,i[f+4]=0,o[f+4]=0,i[f+5]=0,o[f+5]=0,i[f+6]=0,o[f+6]=0,i[f+7]=0,o[f+7]=0;for(f=0;p>f;f+=4)l=e[f+1],u=e[f+2],i[l]+=b,o[u]+=b,l>y?y=l:C>l&&(C=l),u>w?w=u:I>u&&(I=u);for(c=h=d=0,f=0;256>f;f+=8)h+=i[f],i[f]=h,d+=o[f],o[f]=d,h+=i[f+1],i[f+1]=h,d+=o[f+1],o[f+1]=d,h+=i[f+2],i[f+2]=h,d+=o[f+2],o[f+2]=d,h+=i[f+3],i[f+3]=h,d+=o[f+3],o[f+3]=d,h+=i[f+4],i[f+4]=h,d+=o[f+4],o[f+4]=d,h+=i[f+5],i[f+5]=h,d+=o[f+5],o[f+5]=d,h+=i[f+6],i[f+6]=h,d+=o[f+6],o[f+6]=d,h+=i[f+7],i[f+7]=h,d+=o[f+7],o[f+7]=d;return[a,i,o]}return[a,a,a]}function f(e,t,n,r){return null}function g(e,t,n,r,a,i,o){i=D(i,t-1),o=D(o,n-1);var s,l,u,c,h=i-r+1,d=o-a+1,f=h*d<<2,g=new m(f),p=h<<2;for(s=a,l=a*t,u=0;o>=s;s++,l+=t,u+=p)c=l+r<<2,g.set(e.subarray(c,c+p),u);return g}function p(e,t,n,r,a,i,o){r=r||0,a=a||0,i=i||0,o=o||0;var s,l,u,c,h=t+i+r,d=n+o+a,f=h*d<<2,g=new m(f),p=t<<2,v=h<<2,y=o*v,w=i<<2;for(s=0,l=0,u=y;n>s;s++,l+=t,u+=v)c=l<<2,g.set(e.subarray(c,c+p),w+u);return g}var m=e.ImArray,v=e.Array32F,y=(e.Array64F,Math.sqrt),w=Math.pow,_=Math.ceil,C=Math.log,I=Math.PI,b=I+I,R=.5*I,A=Math.LN2,x=Math.SQRT2,M=function(e){return C(e)/A},S=Math.log2||M,D=Math.min,E=0,k=1,P=2;e.CONSTANTS=e.CONST={PI:I,PI2:b,PI_2:R,SQRT2:x,LN2:A,toRad:I/180,toDeg:180/I,X:E,Y:k,Z:P},e.Geometry={Point2:a,Point3:i,enorm2:u,cross2:l,normal2:c,interpolate2:o,interpolate3:s},e.Math={clamp:n,closestPower2:r,integral:h,histogram:d,spectrum:f},e.Interpolation.crop=g,e.Interpolation.pad=p}(r),!function(e,t){var n=e.Math.clamp,r=e.ImArray;e.Interpolation.bilinear=function(e,t,a,i,o){var s,l,u,c,h,d,f,g,p,m,v,y,w,_,C,I,b,R,A,x=i*o<<2,M=new r(x),S=(t-1)/i,D=(a-1)/o,E=t<<2;for(p=0,m=0,v=0,y=0,_=0,b=0,A=0,I=0;x>I;I+=4,m++,v+=S)m>=i&&(m=0,v=0,p++,y+=D,_=~~y,A=y-_,b=_*t),w=~~v,R=v-w,h=(1-R)*(1-A),d=R*(1-A),f=A*(1-R),g=R*A,C=b+w<<2,s=e[C],l=e[C+4],u=e[C+E],c=e[C+E+4],M[I]=n(~~(s*h+l*d+u*f+c*g+.5),0,255),s=e[C+1],l=e[C+5],u=e[C+E+1],c=e[C+E+5],M[I+1]=n(~~(s*h+l*d+u*f+c*g+.5),0,255),s=e[C+2],l=e[C+6],u=e[C+E+2],c=e[C+E+6],M[I+2]=n(~~(s*h+l*d+u*f+c*g+.5),0,255),s=e[C+3],l=e[C+7],u=e[C+E+3],c=e[C+E+7],M[I+3]=n(~~(s*h+l*d+u*f+c*g+.5),0,255);return M}}(r),!function(e){var t=Math.sqrt,n=Math.round,r=(Math.floor,Math.min),a=Math.max,i=(Math.abs,e.Math.clamp),o=/([.*+?^${}()|\[\]\/\\\-])/g,s=function(e){return e.replace(o,"\\$1")},l=/^\s+|\s+$/g,u=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(l,"")},c=1/255,h=100/255,d=2.55,f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},g=e.Color=e.Class({__static__:{clamp:i,clampPixel:function(e){return r(255,a(e,0))},toGray:function(t,n,r){var a=e.LUMA;return~~(a[0]*t+a[1]*n+a[2]*r)},distance:function(e,n){var r=e[0]-n[0],a=e[1]-n[1],i=e[2]-n[2];return t(r*r+a*a+i*i)},RGB2Color:function(e){return e[0]<<16|e[1]<<8|255&e[2]},RGBA2Color:function(e){return e[3]<<24|e[0]<<16|e[1]<<8|255&e[2]},Color2RGBA:function(e){return e=~~e,[e>>>16&255,e>>>8&255,255&e,e>>>24&255]},RGB2YCbCr:function(e){var t,n,r,a=e[0],i=e[1],o=e[2];return t=~~(0+.299*a+.587*i+.114*o),n=~~(128-.168736*a-.331264*i+.5*o),r=~~(128+.5*a-.418688*i-.081312*o),[t,n,r]},YCbCr2RGB:function(e){var t,n,r,a=e[0],i=e[1],o=e[2];return t=~~(a+1.402*(o-128)),n=~~(a-.34414*(i-128)-.71414*(o-128)),r=~~(a+1.772*(i-128)),[t,n,r]},RGB2HSV:function(e){var t,n,i,o,s,l,u,c,h;return o=e[0],s=e[1],l=e[2],t=r(o,s,l),n=a(o,s,l),i=n-t,h=n,0==n?(c=0,u=0,[u,c,h]):(c=i/n,u=o==n?(s-l)/i:s==n?2+(l-o)/i:4+(o-s)/i,u*=60,0>u&&(u+=360),[u,c,h])},HSV2RGB:function(e){var t,n,r,a,i,o,s,l,u,c,h;return u=e[0],c=e[1],h=e[2],0==c?(o=s=l=h,[o,s,l]):(u/=60,t=~~u,n=u-t,r=h*(1-c),a=h*(1-c*n),i=h*(1-c*(1-n)),0===t?(o=h,s=i,l=r):1===t?(o=a,s=h,l=r):2===t?(o=r,s=h,l=i):3===t?(o=r,s=a,l=h):4===t?(o=i,s=r,l=h):(o=h,s=r,l=a),[o,s,l])},toString:function(){return"[FILTER: "+this.name+"]"},C2F:c,C2P:h,P2C:d,Keywords:f,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(f).map(s).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(e,t){return e*h+(t||"")},per2col:function(e){return e*d},rgb2cmyk:function(e,t,a,o){var s,l,u=0,h=0,f=0,g=0;return o&&(e=i(n(e*d),0,255),t=i(n(t*d),0,255),a=i(n(a*d),0,255)),0==e&&0==t&&0==a?(g=1,[0,0,0,1]):(u=1-e*c,h=1-t*c,f=1-a*c,s=r(u,h,f),l=1/(1-s),u=(u-s)*l,h=(h-s)*l,f=(f-s)*l,g=s,[u,h,f,g])},cmyk2rgb:function(e,t,r,a){var o,s,l=0,u=0,c=0;return 0==e&&0==t&&0==r?[0,0,0]:(o=a,s=1-o,e=e*s+o,t=t*s+o,r=r*s+o,l=255*(1-e),u=255*(1-t),c=255*(1-r),[i(n(l),0,255),i(n(u),0,255),i(n(c),0,255)])},rgb2hex:function(e,t,r,a,o){var s;return o&&(e=i(n(e*d),0,255),t=i(n(t*d),0,255),r=i(n(r*d),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),s=a&&e[0]==e[1]&&t[0]==t[1]&&r[0]==r[1]?"#"+e[0]+t[0]+r[0]:"#"+e+t+r},rgb2hexIE:function(e,t,r,a,o){var s;return o&&(e=i(n(e*d),0,255),t=i(n(t*d),0,255),r=i(n(r*d),0,255),a=i(n(a*d),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),a=16>a?"0"+a.toString(16):a.toString(16),s="#"+a+e+t+r},hex2rgb:function(e){return!e||3>e.length?[0,0,0]:6>e.length?[i(parseInt(e[0]+e[0],16),0,255),i(parseInt(e[1]+e[1],16),0,255),i(parseInt(e[2]+e[2],16),0,255)]:[i(parseInt(e[0]+e[1],16),0,255),i(parseInt(e[2]+e[3],16),0,255),i(parseInt(e[4]+e[5],16),0,255)]},hue2rgb:function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e},hsl2rgb:function(e,t,r){var a,o,s,l,u;return e=(e+360)%360/360,t*=.01,r*=.01,0==t?(a=1,o=1,s=1):(u=.5>r?r*(1+t):r+t-r*t,l=2*r-u,a=g.hue2rgb(l,u,e+1/3),o=g.hue2rgb(l,u,e),s=g.hue2rgb(l,u,e-1/3)),[i(n(255*a),0,255),i(n(255*o),0,255),i(n(255*s),0,255)]},rgb2hsl:function(e,t,o,s){var l,u,h,d,f,g;return s?(e*=.01,t*=.01,o*=.01):(e*=c,t*=c,o*=c),u=a(e,t,o),l=r(e,t,o),f=.5*(u+l),u==l?h=d=0:(g=u-l,d=f>.5?g/(2-a-r):g/(a+r),h=u==e?(t-o)/g+(o>t?6:0):u==t?(o-e)/g+2:(e-t)/g+4,h/=6),[n(360*h)%360,i(100*d,0,100),i(100*f,0,100)]},parse:function(e,t,n,r){var a,i,o,s,l,c=0,d=0;if("hsl"==n||!n&&(a=e.match(g.hslRE))){if("hsl"==n){l="hsla"==e[0].toLowerCase();var f=e[1].split(",").map(u)}else{c=a[0].length,d=0,l="hsla"==a[1].toLowerCase();var f=a[2].split(",").map(u)}var p=f[0]?f[0]:"0",e=f[1]?f[1]:"0",m=f[2]?f[2]:"0",v=l&&null!=f[3]?f[3]:"1";return p=parseFloat(p,10),e="%"==e.slice(-1)?parseFloat(e,10):parseFloat(e,10)*h,m="%"==m.slice(-1)?parseFloat(m,10):parseFloat(m,10)*h,v=parseFloat(v,10),s=(new g).fromHSL([p,e,m,v]),t&&(o=e.substr(c),(i=o.match(g.colorstopRE))&&(s.colorStop(i[1]),d=i[0].length)),r?s:[s,0,c+d]}if("rgb"==n||!n&&(a=e.match(g.rgbRE))){if("rgb"==n){l="rgba"==e[0].toLowerCase();var f=e[1].split(",").map(u)}else{c=a[0].length,d=0,l="rgba"==a[1].toLowerCase();var f=a[2].split(",").map(u)}var y=f[0]?f[0]:"0",w=f[1]?f[1]:"0",_=f[2]?f[2]:"0",v=l&&null!=f[3]?f[3]:"1";return y="%"==y.slice(-1)?2.55*parseFloat(y,10):parseFloat(y,10),w="%"==w.slice(-1)?2.55*parseFloat(w,10):parseFloat(w,10),_="%"==_.slice(-1)?2.55*parseFloat(_,10):parseFloat(_,10),v=parseFloat(v,10),s=(new g).fromRGB([y,w,_,v]),t&&(o=e.substr(c),(i=o.match(g.colorstopRE))&&(s.colorStop(i[1]),d=i[0].length)),r?s:[s,0,c+d]}if("hex"==n||!n&&(a=e.match(g.hexRE))){if("hex"==n)var f=g.hex2rgb(e[0]);else{c=a[0].length,d=0;var f=g.hex2rgb(a[1])}var C=f[0]?f[0]:0,I=f[1]?f[1]:0,b=f[2]?f[2]:0,v=null!=f[3]?f[3]:255;return s=(new g).fromHEX([C,I,b,v]),t&&(o=e.substr(c),(i=o.match(g.colorstopRE))&&(s.colorStop(i[1]),d=i[0].length)),r?s:[s,0,c+d]}if("keyword"==n||!n&&(a=e.match(g.keywordRE))){if("keyword"==n)var f=e[0];else{c=a[0].length,d=0;var f=a[1]}return s=(new g).fromKeyword(f),t&&(o=e.substr(c),(i=o.match(g.colorstopRE))&&(s.colorStop(i[1]),d=i[0].length)),r?s:[s,0,c+d]}return null},fromString:function(e,t,n){return g.parse(e,t,n,1)},fromRGB:function(e){return(new g).fromRGB(e)},fromHSL:function(e){return(new g).fromHSL(e)},fromCMYK:function(e){return(new g).fromCMYK(e)},fromHEX:function(e){return(new g).fromHEX(e)},fromKeyword:function(e){return(new g).fromKeyword(e)},fromPixel:function(e){return(new g).fromPixel(e)}},constructor:function p(e,t){return this instanceof p?(this.reset(),void(e&&this.set(e,t))):new p(e,t)},name:"Color",col:null,cstop:null,kword:null,clone:function(){var e=new g;return e.col=this.col.slice(),e.cstop=this.cstop+"",e.kword=this.kword,e},reset:function(){return this.col=[0,0,0,1],this.cstop="",this.kword=null,this},set:function(e,t){return e&&(undef!==e[0]&&(this.col[0]=i(e[0],0,255)),undef!==e[1]&&(this.col[1]=i(e[1],0,255)),undef!==e[2]&&(this.col[2]=i(e[2],0,255)),undef!==e[3]?this.col[3]=i(e[3],0,1):this.col[3]=1,t&&(this.cstop=t),this.kword=null),this},colorStop:function(e){return this.cstop=e,this},isTransparent:function(){return 1>this.col[3]},isKeyword:function(){return!!this.kword},fromPixel:function(e){return e=e||0,this.col=[i(e>>16&255,0,255),i(e>>8&255,0,255),i(255&e,0,255),i((e>>24&255)*c,0,1)],this.kword=null,this},fromKeyword:function(e){return e=e.toLowerCase(),g.Keywords[e]&&(this.col=g.Keywords[e].slice(),this.kword=e),this},fromHEX:function(e){return this.col[0]=e[0]?i(parseInt(e[0],10),0,255):0,this.col[1]=e[1]?i(parseInt(e[1],10),0,255):0,this.col[2]=e[2]?i(parseInt(e[2],10),0,255):0,this.col[3]=undef!==e[3]?i(parseInt(e[3],10)*c,0,1):1,this.kword=null,this},fromRGB:function(e){return this.col[0]=e[0]?i(n(e[0]),0,255):0,this.col[1]=e[1]?i(n(e[1]),0,255):0,this.col[2]=e[2]?i(n(e[2]),0,255):0,this.col[3]=undef!==e[3]?i(e[3],0,1):1,this.kword=null,this},fromCMYK:function(e){var t=g.cmyk2rgb(e[0]||0,e[1]||0,e[2]||0,e[3]||0);return this.col[0]=t[0],this.col[1]=t[1],this.col[2]=t[2],this.col[3]=undef!==e[4]?i(e[4],0,1):1,this.kword=null,this},fromHSL:function(e){var t=g.hsl2rgb(e[0]||0,e[1]||0,e[2]||0);return this.col[0]=t[0],this.col[1]=t[1],this.col[2]=t[2],this.col[3]=undef!==e[3]?i(e[3],0,1):1,this.kword=null,this},toPixel:function(e){return e?i(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(e,t,n){var r=g.rgb2cmyk(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toKeyword:function(e,t,n){return this.kword?this.kword:this.toHEX(1,t,n)},toHEX:function(e,t,r){return r?g.rgb2hexIE(this.col[0],this.col[1],this.col[2],i(n(255*this.col[3]),0,255)):g.rgb2hex(this.col[0],this.col[1],this.col[2],t)},toRGB:function(e,t,n){var r=this.col[3];return e?(t&&(r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(e,t,n){var r=this.col[3],a=g.rgb2hsl(this.col[0],this.col[1],this.col[2]);return e?(t&&(a[1]=0==a[1]?a[1]:a[1]+"%",a[2]=0==a[2]?a[2]:a[2]+"%",r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[a[0],a[1],a[2]].join(",")+")":"hsla("+[a[0],a[1],a[2],r].join(",")+")"):n?a:a.concat(this.col[3])},toColorStop:function(e){var t=this.cstop;return e?(t=t.length?t+",":"",1>this.col[3]?"color-stop("+t+this.toRGB(1,1)+")":"color-stop("+t+this.toHEX(1,1)+")"):(t=t.length?" "+t:"",1>this.col[3]?this.toRGB(1,1)+t:this.toHEX(1,1)+t)},toString:function(e,t){return e=e?e.toLowerCase():"hex","rgb"==e||"rgba"==e?this.toRGB(1,!1!==t,"rgb"==e):"hsl"==e||"hsla"==e?this.toHSL(1,!1!==t,"hsl"==e):"keyword"==e?this.toKeyword(1):this.toHEX(1,!1!==t,"hexie"==e)}})}(r),!function(e,t){function n(e,t,n,r,a,i,o,s){if(r=h(r,t-1),a=h(a,n-1),i=h(i,t-1),o=h(o,n-1),0===r&&0===a&&t===i+1&&n===o+1)return!0===s?e:new u(e);if(!e.length||r>i||a>o)return new l(0);var c,d,f,g,p=i-r+1,m=o-a+1,v=p*m<<2,y=new l(v);for(c=r,d=a,f=0;o>=d;f+=4,c++)c>i&&(c=r,d++),g=d*t+c<<2,y[f]=e[g],y[f+1]=e[g+1],y[f+2]=e[g+2],y[f+3]=e[g+3];return y}function r(e,t,n,r,a,i,o,s,l,u,c,d){var f,g,p,m;if(!(e.length&&r.length&&a&&i&&t&&n))return e;for(o=h(o,a-1),s=h(s,i-1),c=h(c,t-1),d=h(d,n-1),l=h(l,a-1),u=h(u,i-1),c-=o,d-=s,p=o,m=s;u>=m;p++)p>l&&(p=o,m++),m+d>=n||p+c>=t||(f=m*a+p<<2,g=(m+d)*t+p+c<<2,e[g]=r[f],e[g+1]=r[f+1],e[g+2]=r[f+2],e[g+3]=r[f+3]);return e}function a(e,t,n,r,a){return t===r&&n===a?e:f(e,t,n,r,a)}function i(e,t,n,r,a,i,o,s){if(a=h(a,t-1),i=h(i,n-1),o=h(o,t-1),s=h(s,n-1),!e.length||a>o||i>s)return e;var l,u,c,d=255&r[0],f=255&r[1],g=255&r[2],p=3<r.length?255&r[3]:255;for(l=a,u=i;s>=u;l++)l>o&&(l=a,u++),c=u*t+l<<2,e[c]=d,e[c+1]=f,e[c+2]=g,e[c+3]=p;return e}var o,s,l=e.ImArray,u=e.ImArrayCopy,c=e.Color,h=Math.min,d=Math.max,f=e.Interpolation.bilinear;s=e.Class({constructor:function(e){var t=this;t._cnv=e,t._transform={scale:[1,1],translate:[0,0],rotate:[0,0]},t._data=null},_cnv:null,_w:0,_h:0,_transform:null,_data:null,fillStyle:null,dispose:function(){var e=this;return e._cnv=null,e._data=null,e._transform=null,e},fillRect:function(e,t,n,r){var a,i=this,o=i._w,s=i._h,l=i.fillStyle;null==e&&(e=0),null==t&&(t=0),null==n&&(n=o),null==r&&(r=s),l===+l?a=c.Color2RGBA(l):l&&l.substr?(a=c.parse(l).toRGB(!1),a[3]=~~(255*a[3])):a=l&&2<l.length?l:[0,0,0,0],l(i._data,o,s,a,e,t,e+n-1,t+r-1)},clearRect:function(e,t,n,r){var a=this,o=a._w,s=a._h;null==e&&(e=0),null==t&&(t=0),null==n&&(n=o),null==r&&(r=s),i(a._data,o,s,[0,0,0,0],e,t,e+n-1,t+r-1)},drawImage:function(e,t,i,o,s,l,u,c,h){var d=this,f=d._w,g=d._h,p=e._ctx._w,m=e._ctx._h,v=e._ctx._data,y=arguments.length;3===y?(l=t,u=i,r(d._data,f,g,v,p,m,0,0,p-1,m-1,l,u)):5===y?(l=t,u=i,c=o,h=s,r(d._data,f,g,a(v,p,m,c,h),c,h,0,0,c-1,h-1,l,u)):r(d._data,f,g,a(n(v,p,m,t,i,t+o-1,i+s-1,!0),o,s,c,h),c,h,0,0,c-1,h-1,l,u)},createImageData:function(e,t){var n=this;return n._data=new l(e*t<<2),n._w=e,n._h=t,i(n._data,e,t,[0,0,0,0],0,0,e-1,t-1),n},putImageData:function(e,t,n){var a=this,i=a._w,o=a._h,s=e.width,l=e.height;null==t&&(t=0),null==n&&(n=0),r(a._data,i,o,e.data,s,l,0,0,s-1,l-1,t,n)},getImageData:function(e,t,r,a){var i,o,s,l,u=this,c=u._w,f=u._h;return null==e&&(e=0),null==t&&(t=0),null==r&&(r=c),null==a&&(a=f),i=d(0,h(e,r-1,c-1)),o=d(0,h(t,a-1,f-1)),s=h(i+r-1,r-1,c-1),l=h(o+a-1,a-1,f-1),{data:n(u._data,c,f,i,o,s,l),width:s-i+1,height:l-o+1}},scale:function(e,t){var n=this;return n._transform.scale[0]=e,n._transform.scale[1]=t,n},translate:function(e,t){var n=this;return n._transform.translate[0]=e,n._transform.translate[1]=t,n}}),o=e.CanvasProxy=e.Class({constructor:function(e,t){var n=this;n.width=e||0,n.height=t||0,n.style={},n._ctx=new s(n)},_ctx:null,width:null,height:null,style:null,dispose:function(){var e=this;return e.width=null,e.height=null,e.style=null,e._ctx.dispose(),e._ctx=null,e},getContext:function(e){return this._ctx},toDataURL:function(e){return""}}),e.Canvas=function(t,n){var r=e.Browser.isNode?new o:document.createElement("canvas");return t=t||0,n=n||0,r.style.width=t+"px",r.style.height=n+"px",r.width=t*e.devicePixelRatio,r.height=n*e.devicePixelRatio,r}}(r),!function(e,t){function n(e){var t=e.width,n=e.height,r=c(t,n);return r.width=t*s,r.height=n*s,r}function r(e,t,n,r){return r=r||A,r&b&&(e.width=t,e.oCanvas.style.width=t+"px",e.oCanvas.width=t*s,e._restorable&&(e.iCanvas.style.width=e.oCanvas.style.width,e.iCanvas.width=e.oCanvas.width),e.tmpCanvas&&(e.tmpCanvas.style.width=e.oCanvas.style.width,e.tmpCanvas.width=e.oCanvas.width)),r&R&&(e.height=n,e.oCanvas.style.height=n+"px",e.oCanvas.height=n*s,e._restorable&&(e.iCanvas.style.height=e.oCanvas.style.height,e.iCanvas.height=e.oCanvas.height),e.tmpCanvas&&(e.tmpCanvas.style.height=e.oCanvas.style.height,e.tmpCanvas.height=e.oCanvas.height)),e}function a(e,t){var n=e.width,r=e.height;return t=t||255,e._restorable&&t&m&&e._needsRefresh&m&&(e.iData=e.ictx.getImageData(0,0,n,r),e._needsRefresh&=~m),t&v&&e._needsRefresh&v&&(e.oData=e.octx.getImageData(0,0,n,r),e._needsRefresh&=~v),e}function i(e,t){if(e.selection){var n=e.selection,r=e.width-1,a=e.height-1,i=d(n[0]*r),o=d(n[1]*a),s=d(n[2]*r)-i+1,l=d(n[3]*a)-o+1;t=t||255,e._restorable&&t&y&&e._needsRefresh&y&&(e.iDataSel=e.ictx.getImageData(i,o,s,l),e._needsRefresh&=~y),t&w&&e._needsRefresh&w&&(e.oDataSel=e.octx.getImageData(i,o,s,l),e._needsRefresh&=~w)}return e}var o="prototype",s=e.devicePixelRatio,l=e.ImArray,u=e.ImArrayCopy,c=(e.Array32F,e.Canvas),h=e.CanvasProxy,d=(e._notSupportTypedArrays,Math.min,Math.floor),f=e.FORMAT,g=e.MIME,p=0,m=1,v=2,y=4,w=8,_=16,C=32,I=64,b=2,R=4,A=b|R,x=y|w,M=m|v,S=~x,D=~_,E=~C,k=e.Image=e.Class({name:"Image",constructor:function L(e){var t=this,n=0,r=0;return t instanceof L?(t.id=++p,t.width=n,t.height=r,t.iData=null,t.iDataSel=null,t.oData=null,t.oDataSel=null,t.iCanvas=c(n,r),t.oCanvas=c(n,r),t.tmpCanvas=null,t.domElement=t.oCanvas,t.ictx=t.iCanvas.getContext("2d"),t.octx=t.oCanvas.getContext("2d"),t.webgl=null,t._histogram=null,t._integral=null,t._spectrum=null,t.selection=null,t._needsRefresh=0,t._restorable=!0,t._grayscale=!1,void(e&&t.image(e))):new L(e)},id:null,width:0,height:0,selection:null,iCanvas:null,oCanvas:null,tmpCanvas:null,ictx:null,octx:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,webgl:null,_histogram:null,_integral:null,_spectrum:null,_needsRefresh:0,_restorable:!0,_grayscale:!1,dispose:function(){var e=this;return e.id=null,e.width=null,e.height=null,e.selection=null,e.ictx=null,e.octx=null,e.iData=null,e.iDataSel=null,e.oData=null,e.oDataSel=null,e.iCanvas=null,e.oCanvas=null,e.tmpCanvas=null,e.domElement=null,e.webgl=null,e._histogram=null,e._integral=null,e._spectrum=null,e._needsRefresh=null,e._restorable=null,e._grayscale=null,e},clone:function(e){return new k(!0===e?this.iCanvas:this.oCanvas)},grayscale:function(e){var t=this;return arguments.length?(t._grayscale=!!e,t):t._grayscale},restorable:function(e){var t=this;return arguments.length||(e=!0),t._restorable=!!e,t},apply:function(e,t){return e.apply(this,this,t||null),this},apply2:function(e,t,n){return e.apply(this,t,n||null),this},select:function(e,t,n,r){var a=this,i=arguments.length;return 1>i&&(e=0),2>i&&(t=0),3>i&&(n=1),4>i&&(r=1),a.selection=[0>e?0:e>1?1:e,0>t?0:t>1?1:t,0>n?0:n>1?1:n,0>r?0:r>1?1:r],a._needsRefresh|=x,a},deselect:function(){var e=this;return e.selection=null,e.iDataSel=null,e.oDataSel=null,e._needsRefresh&=S,e},store:function(){var e=this;return e._restorable&&(e.ictx.drawImage(e.oCanvas,0,0),e._needsRefresh|=m,e.selection&&(e._needsRefresh|=y)),e},restore:function(){var e=this;return e._restorable&&(e.octx.drawImage(e.iCanvas,0,0),e._needsRefresh|=v|_|C|I,e.selection&&(e._needsRefresh|=w)),e},dimensions:function(e,t){var n=this;return r(n,e,t,A),n._needsRefresh|=M|_|C|I,n.selection&&(n._needsRefresh|=x),n},scale:function(e,t){var r=this;if(e=e||1,t=t||e,1==e&&1==t)return r;r.tmpCanvas=r.tmpCanvas||n(r);var a=r.tmpCanvas.getContext("2d"),i=r.width,o=r.height;return a.scale(e,t),
i=r.width=~~(e*i+.5),o=r.height=~~(t*o+.5),a.drawImage(r.oCanvas,0,0),r.oCanvas.style.width=i+"px",r.oCanvas.style.height=o+"px",r.oCanvas.width=i*s,r.oCanvas.height=o*s,r.octx.drawImage(r.tmpCanvas,0,0),r._restorable&&(a.drawImage(r.iCanvas,0,0),r.iCanvas.style.width=r.oCanvas.style.width,r.iCanvas.style.height=r.oCanvas.style.height,r.iCanvas.width=r.oCanvas.width,r.iCanvas.height=r.oCanvas.height,r.ictx.drawImage(r.tmpCanvas,0,0)),r.tmpCanvas.width=r.oCanvas.width,r.tmpCanvas.height=r.oCanvas.height,r._needsRefresh|=M|_|C|I,r.selection&&(r._needsRefresh|=x),r},flipHorizontal:function(){var e=this;e.tmpCanvas=e.tmpCanvas||n(e);var t=e.tmpCanvas.getContext("2d");return t.translate(e.width,0),t.scale(-1,1),t.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(t.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=M|_|C|I,e.selection&&(e._needsRefresh|=x),e},flipVertical:function(){var e=this;e.tmpCanvas=e.tmpCanvas||n(e);var t=e.tmpCanvas.getContext("2d");return t.translate(0,e.height),t.scale(1,-1),t.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(t.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=M|_|C|I,e.selection&&(e._needsRefresh|=x),e},draw:function(e,t,n,r){return this},clear:function(){var e=this,t=e.width,n=e.height;return t&&n&&(e._restorable&&e.ictx.clearRect(0,0,t,n),e.octx.clearRect(0,0,t,n),e._needsRefresh|=M|_|C|I,e.selection&&(e._needsRefresh|=x)),e},crop:function(e,t,r,a){var i,o,l,u,c,h,f,g,p=this,m=p.selection,v=p.width,y=p.height;if(arguments.length)c=e,h=t,f=r-e+1,g=a-t+1;else{if(!m)return p;i=d(m[0]*(v-1)),o=d(m[1]*(y-1)),l=d(m[2]*(v-1))-i+1,u=d(m[3]*(y-1))-o+1,c=i,h=o,f=l,g=u,m[0]=0,m[1]=0,m[2]=1,m[3]=1}p.tmpCanvas=p.tmpCanvas||n(p);var w=p.tmpCanvas.getContext("2d");return w.drawImage(p.oCanvas,0,0,v,y,c,h,f,g),p.oCanvas.style.width=f+"px",p.oCanvas.style.height=g+"px",p.oCanvas.width=f*s,p.oCanvas.height=g*s,p.octx.drawImage(p.tmpCanvas,0,0),p._restorable&&(w.drawImage(p.iCanvas,0,0,v,y,c,h,f,g),p.iCanvas.style.width=p.oCanvas.style.width,p.iCanvas.style.height=p.oCanvas.style.height,p.iCanvas.width=p.oCanvas.width,p.iCanvas.height=p.oCanvas.height,p.ictx.drawImage(p.tmpCanvas,0,0)),p.tmpCanvas.width=p.oCanvas.width,p.tmpCanvas.height=p.oCanvas.height,p._needsRefresh|=M|_|C|I,m&&(p._needsRefresh|=x),p},fill:function(e,n,r,a,i){var o,s,l,u,c=this,h=c.selection,f=c.width,g=c.height;h?(o=d(h[0]*(f-1)),s=d(h[1]*(g-1)),l=d(h[2]*(f-1))-o+1,u=d(h[3]*(g-1))-s+1):(o=0,s=0,l=f,u=g),t===n&&(n=o),t===r&&(r=s),t===a&&(a=l),t===i&&(i=u),a&&!f&&i&&!g&&c.createImageData(a,i);var p=c.ictx,m=c.octx;return e=e||0,c._restorable&&(p.fillStyle=e,p.fillRect(n,r,a,i)),m.fillStyle=e,m.fillRect(n,r,a,i),c._needsRefresh|=M|_|C|I,h&&(c._needsRefresh|=x),c},getData:function(){var e,t=this;return t._restorable?(t._needsRefresh&m&&a(t,m),e=t.iData):(t._needsRefresh&v&&a(t,v),e=t.oData),new u(e.data)},getSelectedData:function(){var e,t=this;return t.selection?t._restorable?(t._needsRefresh&y&&i(t,y),e=t.iDataSel):(t._needsRefresh&w&&i(t,w),e=t.oDataSel):t._restorable?(t._needsRefresh&m&&a(t,m),e=t.iData):(t._needsRefresh&v&&a(t,v),e=t.oData),[new u(e.data),e.width,e.height]},getProcessedData:function(){var e=this;return e._needsRefresh&v&&a(e,v),new u(e.oData.data)},getProcessedSelectedData:function(){var e,t=this;return t.selection?(t._needsRefresh&w&&i(t,w),e=t.oDataSel):(t._needsRefresh&v&&a(t,v),e=t.oData),[new u(e.data),e.width,e.height]},setData:function(e){var t=this;return t._needsRefresh&v&&a(t,v),t.oData.data.set(e),t.octx.putImageData(t.oData,0,0),t._needsRefresh|=_|C|I,t.selection&&(t._needsRefresh|=w),t},setSelectedData:function(e){var t=this;if(t.selection){var n=t.selection,r=t.width-1,o=t.height-1,s=d(n[0]*r),l=d(n[1]*o);t._needsRefresh&w&&i(t,w),t.oDataSel.data.set(e),t.octx.putImageData(t.oDataSel,s,l),t._needsRefresh|=v}else t._needsRefresh&v&&a(t,v),t.oData.data.set(e),t.octx.putImageData(t.oData,0,0);return t._needsRefresh|=_|C|I,t},createImageData:function(e,t){var n,a,i=this;return r(i,e,t,A),i._restorable&&(n=i.ictx=i.iCanvas.getContext("2d"),n.createImageData(e,t)),a=i.octx=i.oCanvas.getContext("2d"),a.createImageData(e,t),i._needsRefresh|=M,i.selection&&(i._needsRefresh|=x),i},image:function(e){if(!e)return this;var t,n,i,o,s,l,u,c=this;return e instanceof k&&(e=e.oCanvas),s="undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement,l="undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||e instanceof h,u="undefined"!=typeof Image&&e instanceof Image,s?(i=e.videoWidth,o=e.videoHeight):(i=e.width,o=e.height),u||l||s?(r(c,i,o,A),c._restorable&&(t=c.ictx=c.iCanvas.getContext("2d"),t.drawImage(e,0,0)),n=c.octx=c.oCanvas.getContext("2d"),n.drawImage(e,0,0),c._needsRefresh|=M):(c.oData||(c.createImageData(i,o),a(c,M)),c._restorable&&(t=c.ictx=c.iCanvas.getContext("2d"),c.iData.data.set(e.data),t.putImageData(c.iData,0,0)),n=c.octx=c.oCanvas.getContext("2d"),c.oData.data.set(e.data),n.putImageData(c.oData,0,0)),c._needsRefresh|=_|C|I,c.selection&&(c._needsRefresh|=x),c},getPixel:function(e,t){var n=this;n._needsRefresh&v&&a(n,v);var r=~~(t*n.width+e+.5)<<2,i=n.oData.data;return{r:i[r],g:i[r+1],b:i[r+2],a:i[r+3]}},setPixel:function(e,t,n,r,a,i){var o=this;return o.octx.putImageData(new l([255&n,255&r,255&a,255&i]),e,t),o._needsRefresh|=v|_|C|I,o.selection&&(o._needsRefresh|=w),o},getPixelData:function(){return this._needsRefresh&v&&a(this,v),this.oData},setPixelData:function(e){var t=this;return t.octx.putImageData(e,0,0),t._needsRefresh|=v|_|C|I,t.selection&&(t._needsRefresh|=w),t},integral:function(){var e=this;return e._needsRefresh&C&&(e._integral=k.integral(e.getPixelData().data,e.width,e.height,e._grayscale),e._needsRefresh&=E),e._integral},histogram:function(){var e=this;return e._needsRefresh&_&&(e._histogram=k.histogram(e.getPixelData().data,e.width,e.height,e._grayscale),e._needsRefresh&=D),e._histogram},spectrum:function(){var e=this;return e._spectrum},toImage:function(e){var t,n=this.oCanvas,r=1;if(t=e&f.JPG?n.toDataURL(g.JPG,r):e&f.GIF?n.toDataURL(g.GIF,r):n.toDataURL(g.PNG,r),e&f.IMAGE){var a=new Image;return a.src=t,a}return t},toString:function(){return"[FILTER Image: "+this.name+"]"}});k[o].setImage=k[o].image,k[o].setDimensions=k[o].dimensions,k.scale=k.resize=e.Interpolation.bilinear,k.crop=e.Interpolation.crop,k.pad=e.Interpolation.pad,k.integral=e.Math.integral,k.histogram=e.Math.histogram,k.spectrum=e.Math.spectrum;var P=e.ScaledImage=e.Class(k,{name:"ScaledImage",constructor:function O(e,t,n){var r=this;return r instanceof O?(r.scaleX=e||1,r.scaleY=t||r.scaleX,void r.$super("constructor",n)):new O(e,t,n)},scaleX:1,scaleY:1,dispose:function(){var e=this;return e.scaleX=null,e.scaleY=null,e.$super("dispose"),e},clone:function(e){var t=this;return new P(t.scaleX,t.scaleY,!0===e?t.iCanvas:t.oCanvas)},setScale:function(e,t){var n=this,r=arguments.length;return r>0&&null!=e&&(n.scaleX=e,n.scaleY=e),r>1&&null!=t&&(n.scaleY=t),n},image:function(e){if(!e)return this;var t,n,a,i,o,s,l,u,c,d=this,f=d.scaleX,g=d.scaleY;return e instanceof k&&(e=e.oCanvas),l="undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement,u="undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||e instanceof h,c="undefined"!=typeof Image&&e instanceof Image,l?(a=e.videoWidth,i=e.videoHeight):(a=e.width,i=e.height),(c||u||l)&&(o=~~(f*a+.5),s=~~(g*i+.5),r(d,o,s,A),d._restorable&&(t=d.ictx=d.iCanvas.getContext("2d"),t.drawImage(e,0,0,a,i,0,0,o,s)),n=d.octx=d.oCanvas.getContext("2d"),n.drawImage(e,0,0,a,i,0,0,o,s),d._needsRefresh|=M|_|C|I,d.selection&&(d._needsRefresh|=x)),d}});P[o].setImage=P[o].image}(r),!function(e,t){e.IO.Loader=e.IO.Reader=e.Class({name:"IO.Loader",__static__:{load:e.Method(function(e,t,n){return function(e,t,r){return(new n).load(e,t,r)}},e.LATE|e.STATIC)},constructor:function(){},_crossOrigin:null,_responseType:null,dispose:function(){var e=this;return e._crossOrigin=null,e._responseType=null,e},load:function(e,t,n){return null},responseType:function(e){var t=this;return arguments.length?(t._responseType=e,t):t._responseType},crossOrigin:function(e){var t=this;return arguments.length?(t._crossOrigin=e,t):t._crossOrigin}}),e.IO.Loader.prototype.read=e.IO.Loader.prototype.load,e.IO.Writer=e.Class({name:"IO.Writer",__static__:{write:e.Method(function(e,t,n){return function(e,t,r,a){return(new n).write(e,t,r,a)}},e.LATE|e.STATIC)},constructor:function(){},_encoding:null,dispose:function(){var e=this;return e._encoding=null,e},write:function(e,t,n,r){return null},encoding:function(e){var t=this;return arguments.length?(t._encoding=e,t):t._encoding}})}(r),!function(e,t){function n(e){var t,n;for(e>0&&1>e&&(e*=65536),e=u(e),256>e&&(e|=e<<8),n=0;256>n;n++)t=1&n?h[n]^255&e:h[n]^e>>8&255,d[n]=d[n+256]=t}function r(e,t,n){var r=7&e,a=4>r?t:n,i=4>r?n:t;return(1&r?-a:a)+(2&r?-2*i:2*i)}function a(e,t){var n,a,i,o,s,l=.366025403,c=.211324865,h=(e+t)*l,f=e+h,g=t+h,p=u(f),m=u(g),v=(p+m)*c,y=p-v,w=m-v,_=e-y,C=t-w;_>C?(o=1,s=0):(o=0,s=1);var I=_-o+c,b=C-s+c,R=_-1+2*c,A=C-1+2*c,x=255&p,M=255&m,S=.5-_*_-C*C;0>S?n=0:(S*=S,n=S*S*r(d[x+d[M]],_,C));var D=.5-I*I-b*b;0>D?a=0:(D*=D,a=D*D*r(d[x+o+d[M+s]],I,b));var E=.5-R*R-A*A;return 0>E?i=0:(E*=E,i=E*E*r(d[x+1+d[M+1]],R,A)),40*(n+a+i)}function i(e){return e*e*e*(e*(6*e-15)+10)}function o(e,t,n){return t+e*(n-t)}function s(e,t){var n,a,s,l,c,h,f,g,p,m,v,y,w,_;return n=u(e),a=u(t),c=e-n,h=t-a,f=c-1,g=h-1,s=n+1&255,l=a+1&255,n=255&n,a=255&a,m=i(h),p=i(c),v=r(d[n+d[a]],c,h),y=r(d[n+d[l]],c,g),w=o(m,v,y),v=r(d[s+d[a]],f,h),y=r(d[s+d[l]],f,g),_=o(m,v,y),.507*o(p,w,_)}function l(e,t,n,r,a,i,o,s,l,u,c){var h,d,f,g=0,p=u,m=1,v=0;for(h=0;s>h;h++)d=(t+l[h][0])%r,f=(n+l[h][1])%a,g+=e(p*d*i,p*f*o)*m,p*=2,v+=m,m*=c;return g/v}var u=Math.floor,c=(Math.sin,Math.cos,e.CONST.PI2,e.Array8U),h=new c([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),d=new c(h);e.PerlinNoise={seed:n,Image:function(t,n,r,i,o,u,c,h,d,f){var g,p,m,v,y,w,_=(new e.Image).restorable(!1).fill("rgb(0,0,0)",0,0,n,r),C=1/i,I=1/o,b=f?s:a,n=_.width,r=_.height,R=_.getData(),A=R.length,x=n>>>1,M=r>>>1;if(h=h||1,d=d||.5,u=u||1,c=c||[[0,0]],t)for(g=0,p=0,y=0;A>y;y+=4,g++)g>=n&&(g=0,p++),m=g>x?n-1-g:g,v=p>M?r-1-p:p,g>m||p>v?(w=v*n+m<<2,R[y]=R[w],R[y+1]=R[w+1],R[y+2]=R[w+2]):(R[y]=~~(255*(.5*l(b,m,v,n,r,C,I,u,c,h,d)+.5)),R[y+1]=R[y],R[y+2]=R[y]);else for(g=0,p=0,y=0;A>y;y+=4,g++)g>=n&&(g=0,p++),R[y]=~~(255*(.5*l(b,m,v,n,r,C,I,u,c,h,d)+.5)),R[y+1]=R[y],R[y+2]=R[y];return _.setData(R),_}}}(r),r});