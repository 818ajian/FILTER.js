/** 
*
* FILTER.js
* JavaScript Image Processing Library
*
* http://github.com/foo123/FILTER.js
*
* @version 0.6.6
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/var FILTER=FILTER||{VERSION:"0.6.6"};!function(t){var e=navigator.userAgent.match(/Opera|OPR\//)?!0:!1;t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array;var i=t._notSupportClamp="undefined"==typeof Uint8ClampedArray;if(t.ImArray=i?t.Array8U:Uint8ClampedArray,t.ImArrayCopy=e?t.Array8U:t.ImArray,i&&"undefined"!=typeof CanvasPixelArray){var n=function(t){for(var e=t.length,i=e;--i;)this[i]=t[i];return this};CanvasPixelArray.prototype.set=n}t.CONSTANTS={PI:Math.PI,PI2:2*Math.PI,SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI},t.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3},t.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4},t.LUMA=new t.Array32F([.212671,.71516,.072169]);var r=Object.prototype.hasOwnProperty,s=Array.prototype.slice,a=Array.prototype.splice,h=function(){var t=s.call(arguments),e=t.length;if(e){var i=t.shift();if(this.__super__[i])return this.__super__[i].apply(this,t)}return null},o=t.Merge=function(t,e){t=t||{};for(var i in e)r.call(e,i)&&(t[i]=e[i]);return t},u=t.Extends=function(t,e){var i=function(){},n=e.constructor;return i.prototype=t.prototype,n.prototype=new i,n.prototype.constructor=n,n.prototype=o(n.prototype,e),n.prototype.__super__=t.prototype,n.prototype.superCall=h,n},l=t.log=window.console&&window.console.log?window.console.log:function(){};t.warning=function(t){l("WARNING: "+t)},t.error=function(t){l("ERROR: "+t)},t.useWebGL=!1,t.useWebGLSharedResources=!1,t.useWebGLIfAvailable=function(){},t.useWebGLSharedResourcesIfAvailable=function(){};var c=t.devicePixelRatio=window.devicePixelRatio||1;t.createCanvas=function(t,e){var i=document.createElement("canvas");return t=t||0,e=e||0,i.style.width=t+"px",i.style.height=e+"px",i.width=t*c,i.height=e*c,i};var f=0;t.getId=function(){return++f};var g=t.Filter=t.Extends(Object,{name:"GenericFilter",constructor:function(){},id:null,_isOn:!0,isOn:function(){return this._isOn},turnOn:function(){return this._isOn=!0,this},turnOff:function(){return this._isOn=!1,this},reset:function(){return this},combineWith:function(){return this},toString:function(){return"[FILTER: "+this.name+"]"},_apply:function(t){return t},apply:function(t){return this._isOn?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}}),m=t.CompositeFilter=t.Extends(g,{name:"CompositeFilter",constructor:function(t){this._stack=t&&t.length?t.slice():[]},_stack:null,getFilters:function(){return this._stack.slice()},setFilters:function(t){return t&&(this._stack=t.slice()),this},push:function(t){return this._stack.push(t),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(t){return this._stack.unshift(t),this},getAt:function(t){return this._stack.length>t?this._stack[t]:null},setAt:function(t,e){return this._stack.length>t?this._stack[t]=e:this._stack.push(e),this},insertAt:function(t){var e=s.call(arguments);return e.length,argslen>1&&(e.shift(),a.apply(this._stack,[t,0].concat(e))),this},removeAt:function(t){return this._stack.splice(t,1)},remove:function(t){for(var e=this._stack.length;--e>=0;)t===this._stack[e]&&this._stack.splice(e,1);return this},reset:function(){return this._stack.length=0,this},toString:function(){var t="",e=this._stack;return t+="[FILTER: "+this.name+"]"+"\n",t+="[\n",t+="    "+e.join("\n    ")+"\n",t+="]\n"},_apply:function(t,e,i,n){if(this._isOn&&this._stack.length)for(var r,s=this._stack,a=s.length,h=0;a>h;)r=s[h++],r&&r._isOn&&(t=r._apply(t,e,i,n));return t},apply:function(t){return this._isOn&&this._stack.length?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}});m.prototype.empty=m.prototype.reset,m.prototype.concat=m.prototype.push;var _=function(){return"[FILTER Plugin: "+this.name+"]"};t.Create=function(t){return t=o({init:function(){},name:"PluginFilter",toString:_,apply:function(t){return t}},t),t=o(t,{constructor:t.init,_apply:t.apply,apply:function(t){return this._isOn?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}}),t.init&&(t.init=null,delete t.init),u(g,t)}}(FILTER),function(t){var e=Math.sqrt,n=Math.min,r=Math.max;t.Color={name:"ColorTransforms",clamp:function(t,e,i){return n(i,r(t,e))},clampPixel:function(t){return n(255,r(t,0))},ubyteToFloat:function(t){return.00392156862745098*t},ubyteColorToFloatColor:function(t){var e=t.length,n=new Array(e);for(i=0;e>i;i++)n[i]=.00392156862745098*t[i];return n},hexColorToFloatColor:function(t){var e,i,n,r;return e=255&t>>16,i=255&t>>8,n=255&t,r=255&t>>24,[.00392156862745098*e,.00392156862745098*i,.00392156862745098*n,.00392156862745098*r]},blend:function(t,e,i){return{r:t.r-~~((t.r-e.r)*i+.5),g:t.g-~~((t.g-e.g)*i+.5),b:t.b-~~((t.b-e.b)*i+.5)}},toGray:function(e,i,n){var r=t.LUMA;return~~(r[0]*e+r[1]*i+r[2]*n)},distance:function(t,i){var n=t.r-i.r,r=t.g-i.g,s=t.b-i.b;return e(n*n+r*r+s*s)},RGB2Color:function(t){return t.r<<16|t.g<<8|255&t.b},RGBA2Color:function(t){return t.a<<24|t.r<<16|t.g<<8|255&t.b},Color2RGBA:function(t){return t=~~t,{r:255&t>>>16,g:255&t>>>8,b:255&t,a:255&t>>>24}},RGB2YCbCr:function(t){var e,i,n,r=t.r,s=t.g,a=t.b;return e=~~(0+.299*r+.587*s+.114*a),i=~~(128-.168736*r-.331264*s+.5*a),n=~~(128+.5*r-.418688*s-.081312*a),{y:e,cb:i,cr:n}},YCbCr2RGB:function(t){var e,i,n,r=t.y,s=t.cb,a=t.cr;return e=~~(r+1.402*(a-128)),i=~~(r-.34414*(s-128)-.71414*(a-128)),n=~~(r+1.772*(s-128)),{r:e,g:i,b:n}},RGB2HSV:function(t){var e,i,s,a,h,o,u,l,c;return a=t.r,h=t.g,o=t.b,e=n(a,h,o),i=r(a,h,o),s=i-e,c=i,0==i?(l=0,u=0,{h:u,s:l,v:c}):(l=s/i,u=a==i?(h-o)/s:h==i?2+(o-a)/s:4+(a-h)/s,u*=60,0>u&&(u+=360),{h:u,s:l,v:c})},HSV2RGB:function(t){var e,i,n,r,s,a,h,o,u,l,c;if(u=t.h,l=t.s,c=t.v,0==l)return a=h=o=c,{r:a,g:h,b:o};switch(u/=60,e=~~u,i=u-e,n=c*(1-l),r=c*(1-l*i),s=c*(1-l*(1-i)),e){case 0:a=c,h=s,o=n;break;case 1:a=r,h=c,o=n;break;case 2:a=n,h=c,o=s;break;case 3:a=n,h=r,o=c;break;case 4:a=s,h=n,o=c;break;default:a=c,h=n,o=r}return{r:a,g:h,b:o}},toString:function(){return"[FILTER: "+this.name+"]"}}}(FILTER),function(t){var e,i=t.devicePixelRatio,n=t.ImArray,r=t.Array32F,s=t.createCanvas,a=(t._notSupportTypedArrays,Math.min);e=t.blendModes={normal:function(t){return t},lighten:function(t,e){return e>t?e:t},darken:function(t,e){return e>t?t:e},multiply:function(t,e){return.003921568627451*t*e},average:function(t,e){return.5*(t+e)},add:function(t,e){return Math.min(255,t+e)},substract:function(t,e){return 255>t+e?0:t+e-255},difference:function(t,e){return Math.abs(t-e)},negation:function(t,e){return 255-Math.abs(255-t-e)},screen:function(t,e){return 255-((255-t)*(255-e)>>8)},exclusion:function(t,e){return t+e-.003921568627451*2*t*e},overlay:function(t,e){return 128>e?.003921568627451*2*t*e:255-.003921568627451*2*(255-t)*(255-e)},softLight:function(t,e){return 128>e?2*((t>>1)+64)*.003921568627451*e:255-.003921568627451*2*(255-((t>>1)+64))*(255-e)},hardLight:function(t,e){return 128>t?.003921568627451*2*e*t:255-.003921568627451*2*(255-e)*(255-t)},colorDodge:function(t,e){return 255==e?e:Math.min(255,(t<<8)/(255-e))},colorBurn:function(t,e){return 0==e?e:Math.max(0,255-(255-t<<8)/e)},linearLight:function(t,i){return 128>i?e.linearBurn(t,2*i):e.linearDodge(t,2*(i-128))},vividLight:function(t,i){return 128>i?e.colorBurn(t,2*i):e.colorDodge(t,2*(i-128))},pinLight:function(t,i){return 128>i?e.darken(t,2*i):e.lighten(t,2*(i-128))},hardMix:function(t,i){return e.vividLight(t,i)<128?0:255},reflect:function(t,e){return 255==e?e:Math.min(255,t*t/(255-e))},glow:function(t,e){return 255==t?t:Math.min(255,e*e/(255-t))},phoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}},e.linearDodge=e.add,e.linearBurn=e.substract;var h=t.Image=t.Extends(Object,{name:"ImageProxy",constructor:function(t,e){this.width=0,this.height=0,this.context=null,this.imageData=null,this.domElement=this.canvasElement=s(this.width,this.height),this.context=this.canvasElement.getContext("2d"),this._tmpCanvas=s(this.width,this.height),this.webgl=null,this._histogram=null,this._integral=null,this._histogramRefresh=!0,this._integralRefresh=!0,this.setImage(t,e)},width:0,height:0,canvasElement:null,domElement:null,context:null,webgl:null,setWidth:function(t){return this.imageData=this._setDimensions(t).context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},setHeight:function(t){return this.imageData=this._setDimensions(t).context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},setDimensions:function(t,e){return this.imageData=this._setDimensions(t,e).context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},setImage:function(e,i){if("undefined"==typeof e||null==e)return this;var n,r,s,a,h=this;return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?(n=e,s=n instanceof HTMLVideoElement?n.videoWidth:n.width,a=n instanceof HTMLVideoElement?n.videoHeight:n.height,r=h.context=h._setDimensions(s,a).canvasElement.getContext("2d"),r.drawImage(n,0,0),h.imageData=r.getImageData(0,0,s,a),h._histogramRefresh=!0,h._integralRefresh=!0,h.webgl=t.useWebGL?new t.WebGL(h.canvasElement):null):(n=new Image,n.onload=function(){s=n.width,a=n.height,r=h.context=h._setDimensions(s,a).canvasElement.getContext("2d"),r.drawImage(n,0,0),h.imageData=r.getImageData(0,0,s,a),h._histogramRefresh=!0,h._integralRefresh=!0,h.webgl=t.useWebGL?new t.WebGL(h.canvasElement):null,"undefined"!=typeof i&&i.call(h)},n.src=e),n.crossOrigin="",this},getPixel:function(t,e){var i=~~(e*this.width+t+.5),n=this.imageData.data;return{r:n[i],g:n[i+1],b:n[i+2],a:n[i+3]}},setPixel:function(t,e,i,r,s,a){var h=new n([255&i,255&r,255&s,255&a]);return this.context.putImageData(h,t,e),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},getData:function(){return new n(this.imageData.data)},setData:function(t){return this.imageData.data.set(t),this.context.putImageData(this.imageData,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},getPixelData:function(){return this.imageData},setPixelData:function(t){return this.context.putImageData(t,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},createImageData:function(t,e){return this.context=this._setDimensions(t,e).canvasElement.getContext("2d"),this.context.createImageData(t,e),this.imageData=this.context.getImageData(0,0,this.width,this.height),this.imageData},copy:function(t){return this.setData(t.getData()),this.imageData=this.context.getImageData(0,0,this.width,this.height),this},clone:function(){return new h(this.canvasElement)},scale:function(t,e){if(t=t||1,e=e||t,1==t&&1==e)return this;var n=this._tmpCanvas.getContext("2d");return n.scale(t,e),n.drawImage(this.canvasElement,0,0),this.width=~~(t*this.width+.5),this.height=~~(e*this.height+.5),this.canvasElement.style.width=this.width+"px",this.canvasElement.style.height=this.height+"px",this.canvasElement.width=this.width*i,this.canvasElement.height=this.height*i,this.context.drawImage(this._tmpCanvas,0,0),this._tmpCanvas.width=this.width,this._tmpCanvas.height=this.height,this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},flipHorizontal:function(){var t=this._tmpCanvas.getContext("2d");return t.translate(this.width,0),t.scale(-1,1),t.drawImage(this.canvasElement,0,0),this.context.drawImage(this._tmpCanvas,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},flipVertical:function(){var t=this._tmpCanvas.getContext("2d");return t.translate(0,this.height),t.scale(1,-1),t.drawImage(this.canvasElement,0,0),this.context.drawImage(this._tmpCanvas,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},clear:function(){if(this.width&&this.height){var t=this.context;t.clearRect(0,0,this.width,this.height),this.imageData=t.getImageData(0,0,this.width,this.height)}return this},fill:function(t,e,i,n,r){if(!n&&this.width&&!r&&this.height)return this;n&&!this.width&&r&&!this.height&&(this.context=this._setDimensions(n,r).canvasElement.getContext("2d"),this.context.createImageData(n,r),this.imageData=this.context.getImageData(0,0,this.width,this.height)),t=t||0,e=e||0,i=i||0,n=n||this.width,r=r||this.height;var s=this.context;return s.fillStyle=t,s.fillRect(e,i,n,r),this.imageData=s.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},draw:function(){return this},blend:function(t,i,n,r,s){"undefined"==typeof i&&(i="normal"),"undefined"==typeof n&&(n=1),n>1?n=1:0>n&&(n=0),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=0);var h=0,o=0,u=this.context;if(0>r&&(h=-r,r=0),0>s&&(o=-s,s=0),r>=this.width||s>=this.height)return this;var l=e[i];if(void 0==l||null==l)return this;var c,f,g,m,_,p,d,A=a(this.width,t.width-h),w=a(this.height,t.height-o),v=this.context.getImageData(r,s,A,w),y=t.context.getImageData(h,o,A,w),E=v.data,L=y.data,C=1-n,x=L.length;for(d=0;x>d;d+=4)m=E[d],_=E[d+1],p=E[d+2],c=l(L[d],m),f=l(L[d+1],_),g=l(L[d+2],p),E[d]=c*n+m*C,E[d+1]=f*n+_*C,E[d+2]=g*n+p*C;return u.putImageData(v,r,s),this.imageData=u.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},integral:function(){return this._integralRefresh&&this._computeIntegral(),this._integral},histogram:function(){return this._histogramRefresh&&this._computeHistogram(),this._histogram},toString:function(){return"[FILTER Image: "+this.name+"]"},_setDimensions:function(t,e){return this._tmpCanvas.style.width=this.canvasElement.style.width=t+"px",this._tmpCanvas.width=this.canvasElement.width=this.width=t*i,this._tmpCanvas.style.height=this.canvasElement.style.height=e+"px",this._tmpCanvas.height=this.canvasElement.height=this.height=e*i,this},_setWidth:function(t){return this._tmpCanvas.style.width=this.canvasElement.style.width=t+"px",this._tmpCanvas.width=this.canvasElement.width=this.width=t*i,this},_setHeight:function(t){return this._tmpCanvas.style.height=this.canvasElement.style.height=t+"px",this._tmpCanvas.height=this.canvasElement.height=this.height=t*i,this},_computeIntegral:function(){var t,e,i,n,s,a,h=this.width,o=this.height,u=h*o,l=h<<2,c=new r(u),f=new r(u),g=new r(u),m=this.getPixelData().data;for(t=0,e=0,i=0,n=s=a=0;h>i;)n+=m[t],s+=m[t+1],a+=m[t+2],c[e]=n,f[e]=s,g[e]=a,t+=4,e++,i++;for(t=l,i=0,n=s=a=0;imLen>t;)n+=m[t],s+=m[t+1],a+=m[t+2],c[e]=c[e-h]+n,f[e]=f[e-h]+s,g[e]=g[e-h]+a,t+=4,e++,i++,i>=h&&(i=0,n=s=a=0);this._integral=[c,f,g],this._integralRefresh=!1},_computeHistogram:function(){var t,e,i,n,s=this.getPixelData().data,n=0,a=s.length,h=0,o=0,u=0,l=255,c=255,f=255,g=new r(256),m=new r(256),_=new r(256),p=1/(a>>2);for(n=0;256>n;)g[n]=0,m[n]=0,_[n]=0,n++;for(n=0;a>n;)t=s[n],e=s[n+1],i=s[n+2],g[t]+=p,m[e]+=p,_[i]+=p,t>h&&(h=t),l>t&&(l=t),e>o&&(o=e),c>e&&(c=e),i>u&&(u=i),f>i&&(f=i),n+=4;this._histogram=[g,m,_],this._histogramRefresh=!1},_refresh:function(){return this.context=this.canvasElement.getContext("2d"),this.imageData=this.context.getImageData(0,0,this.width,this.height),this}})}(FILTER),function(t){t.CustomFilter=t.Extends(t.Filter,{name:"CustomFilter",constructor:function(t){this._handler=t},_handler:null,_apply:function(t,e,i,n){return this._isOn&&this._handler?this._handler.call(this,t,e,i,n):t},apply:function(t){return this._isOn&&this._handler?t.setData(this._handler.call(this,t.getData(),t.width,t.height,t)):t}})}(FILTER),function(t,e){function i(t,e){var i,n,r,s,h,o=new a(20);return i=e[0],n=e[1],r=e[2],s=e[3],h=e[4],o[0]=i*t[0]+n*t[5]+r*t[10]+s*t[15],o[1]=i*t[1]+n*t[6]+r*t[11]+s*t[16],o[2]=i*t[2]+n*t[7]+r*t[12]+s*t[17],o[3]=i*t[3]+n*t[8]+r*t[13]+s*t[18],o[4]=i*t[4]+n*t[9]+r*t[14]+s*t[19]+h,i=e[5],n=e[6],r=e[7],s=e[8],h=e[9],o[5]=i*t[0]+n*t[5]+r*t[10]+s*t[15],o[6]=i*t[1]+n*t[6]+r*t[11]+s*t[16],o[7]=i*t[2]+n*t[7]+r*t[12]+s*t[17],o[8]=i*t[3]+n*t[8]+r*t[13]+s*t[18],o[9]=i*t[4]+n*t[9]+r*t[14]+s*t[19]+h,i=e[10],n=e[11],r=e[12],s=e[13],h=e[14],o[10]=i*t[0]+n*t[5]+r*t[10]+s*t[15],o[11]=i*t[1]+n*t[6]+r*t[11]+s*t[16],o[12]=i*t[2]+n*t[7]+r*t[12]+s*t[17],o[13]=i*t[3]+n*t[8]+r*t[13]+s*t[18],o[14]=i*t[4]+n*t[9]+r*t[14]+s*t[19]+h,i=e[15],n=e[16],r=e[17],s=e[18],h=e[19],o[15]=i*t[0]+n*t[5]+r*t[10]+s*t[15],o[16]=i*t[1]+n*t[6]+r*t[11]+s*t[16],o[17]=i*t[2]+n*t[7]+r*t[12]+s*t[17],o[18]=i*t[3]+n*t[8]+r*t[13]+s*t[18],o[19]=i*t[4]+n*t[9]+r*t[14]+s*t[19]+h,o}function n(t,e,i){var n=1-i,r=new a(20);return r[0]=n*t[0]+i*e[0],r[1]=n*t[1]+i*e[1],r[2]=n*t[2]+i*e[2],r[3]=n*t[3]+i*e[3],r[4]=n*t[4]+i*e[4],r[5]=n*t[5]+i*e[5],r[6]=n*t[6]+i*e[6],r[7]=n*t[7]+i*e[7],r[8]=n*t[8]+i*e[8],r[9]=n*t[9]+i*e[9],r[10]=n*t[10]+i*e[10],r[11]=n*t[11]+i*e[11],r[12]=n*t[12]+i*e[12],r[13]=n*t[13]+i*e[13],r[14]=n*t[14]+i*e[14],r[15]=n*t[15]+i*e[15],r[16]=n*t[16]+i*e[16],r[17]=n*t[17]+i*e[17],r[18]=n*t[18]+i*e[18],r[19]=n*t[19]+i*e[19],r}var r=Math.sin,s=Math.cos,a=t.Array32F,h=t.CONSTANTS.toRad,o=(t.CONSTANTS.toDeg,t._notSupportClamp),u=t.ColorMatrixFilter=t.Extends(t.Filter,{name:"ColorMatrixFilter",constructor:function(e){this._matrix=e&&e.length?new a(e):null,t.useWebGL&&(this._webglInstance=t.WebGLColorMatrixFilterInstance)},_matrix:null,_webglInstance:null,channel:function(i,n){n=n===e?!1:n;var r=n?1:0;switch(i){case t.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case t.CHANNEL.BLUE:return this.set([0,0,r,0,0,0,0,r,0,0,0,0,1,0,0,0,0,0,0,255]);case t.CHANNEL.GREEN:return this.set([0,r,0,0,0,0,1,0,0,0,0,r,0,0,0,0,0,0,0,255]);case t.CHANNEL.RED:default:return this.set([1,0,0,0,0,r,0,0,0,0,r,0,0,0,0,0,0,0,0,255])}},redChannel:function(e){return this.channel(t.CHANNEL.RED,e)},greenChannel:function(e){return this.channel(t.CHANNEL.GREEN,e)},blueChannel:function(e){return this.channel(t.CHANNEL.BLUE,e)},alphaChannel:function(){return this.channel(t.CHANNEL.ALPHA,!0)},maskChannel:function(e){switch(e){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(e,i){switch(e){case t.CHANNEL.ALPHA:switch(i){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case t.CHANNEL.BLUE:switch(i){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.BLUE:return this;case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case t.CHANNEL.GREEN:switch(i){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this;case t.CHANNEL.RED:default:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case t.CHANNEL.RED:default:switch(i){case t.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case t.CHANNEL.BLUE:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this}}},desaturate:function(){return this.set([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,0,0,0,1,0])},colorize:function(i,n){var r,s,a,h;return n===e&&(n=1),r=.00392156862745098*(255&i>>16),s=.00392156862745098*(255&i>>8),a=.00392156862745098*(255&i),h=1-n,this.set([h+n*r*t.LUMA[0],n*r*t.LUMA[1],n*r*t.LUMA[2],0,0,n*s*t.LUMA[0],h+n*s*t.LUMA[1],n*s*t.LUMA[2],0,0,n*a*t.LUMA[0],n*a*t.LUMA[1],h+n*a*t.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.set([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(e){var i,n,r,s;return i=1-e,n=i*t.LUMA[0],r=i*t.LUMA[1],s=i*t.LUMA[2],this.set([n+e,r,s,0,0,n,r+e,s,0,0,n,r,s+e,0,0,0,0,0,1,0])},contrast:function(t,i,n){return i===e&&(i=t),n===e&&(n=t),t+=1,i+=1,n+=1,this.set([t,0,0,0,128*(1-t),0,i,0,0,128*(1-i),0,0,n,0,128*(1-n),0,0,0,1,0])},brightness:function(t,i,n){return i===e&&(i=t),n===e&&(n=t),this.set([1,0,0,0,t,0,1,0,0,i,0,0,1,0,n,0,0,0,1,0])},adjustHue:function(e){e*=h;var i=s(e),n=r(e);return this.set([t.LUMA[0]+i*(1-t.LUMA[0])+n*-t.LUMA[0],t.LUMA[1]+i*-t.LUMA[1]+n*-t.LUMA[1],t.LUMA[2]+i*-t.LUMA[2]+n*(1-t.LUMA[2]),0,0,t.LUMA[0]+i*-t.LUMA[0]+.143*n,t.LUMA[1]+i*(1-t.LUMA[1])+.14*n,t.LUMA[2]+i*-t.LUMA[2]+n*-.283,0,0,t.LUMA[0]+i*-t.LUMA[0]+n*-(1-t.LUMA[0]),t.LUMA[1]+i*-t.LUMA[1]+n*t.LUMA[1],t.LUMA[2]+i*(1-t.LUMA[2])+n*t.LUMA[2],0,0,0,0,0,1,0])},average:function(t,i,n){return t===e&&(t=.3333),i===e&&(i=.3333),n===e&&(n=.3334),this.set([t,i,n,0,0,t,i,n,0,0,t,i,n,0,0,0,0,0,1,0])},quickContrastCorrection:function(t){return t===e&&(t=1.2),this.set([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0])},sepia:function(t){return t===e&&(t=.5),t>1?t=1:0>t&&(t=0),this.set([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0])},quickSepia:function(i){return i===e&&(i=10),i>100&&(i=100),i*=2.55,this.set([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,40,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,20,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,-i,0,0,0,1,0])},threshold:function(i,n){return n===e&&(n=256),this.set([t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*i,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*i,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*i,0,0,0,1,0])},threshold_rgb:function(t,i){return i===e&&(i=256),this.set([i,0,0,0,-(i-1)*t,0,i,0,0,-(i-1)*t,0,0,i,0,-(i-1)*t,0,0,0,1,0])},threshold_alpha:function(t,i){return t===e&&(t=.5),i===e&&(i=256),this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,i,-i*t])},RGB2YCbCr:function(){return this.set([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.set([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(t,e){return this._matrix=this._matrix?n(this._matrix,t.getMatrix(),e):new a(t.getMatrix()),this},set:function(t){return this._matrix=this._matrix?i(this._matrix,new a(t)):new a(t),this},reset:function(){return this._matrix=null,this},combineWith:function(t){return this.set(t.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(t){return this._matrix=new a(t),this},_apply:function(t){if(this._isOn&&this._matrix)for(var e,i,n,r,s,a,h,u,l=t.length,c=this._matrix,f=0;l>f;)e=t[f],i=t[f+1],n=t[f+2],r=t[f+3],s=c[0]*e+c[1]*i+c[2]*n+c[3]*r+c[4],a=c[5]*e+c[6]*i+c[7]*n+c[8]*r+c[9],h=c[10]*e+c[11]*i+c[12]*n+c[13]*r+c[14],u=c[15]*e+c[16]*i+c[17]*n+c[18]*r+c[19],o&&(0>s?s=0:s>255&&(s=255),0>a?a=0:a>255&&(a=255),0>h?h=0:h>255&&(h=255),0>u?u=0:u>255&&(u=255)),t[f]=~~s,t[f+1]=~~a,t[f+2]=~~h,t[f+3]=~~u,f+=4;return t},apply:function(t){return this._isOn&&this._matrix?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}});u.prototype.grayscale=u.prototype.desaturate,u.prototype.rotateHue=u.prototype.adjustHue,u.prototype.thresholdRgb=u.prototype.threshold_rgb,u.prototype.thresholdAlpha=u.prototype.threshold_alpha}(FILTER),function(t,e){var i=t.ImArrayCopy,n=t.Color.clampPixel,r=function(t){var e=new i(256),n=0;if(t)for(;256>n;)e[n]=255-n,n++;else for(;256>n;)e[n]=n,n++;return e},s=function(t){for(var e=new i(256),n=0;256>n;)e[n]=t,n++;return e},a=function(t){return t?new i(t):null},h=Math.pow,o=Math.exp,u=1/255,l=r(),c=r(1),f=t.TableLookupFilter=t.Extends(t.Filter,{name:"TableLookupFilter",constructor:function(t,e,i,n){this._tableR=t||null,this._tableG=e||this._tableR,this._tableB=i||this._tableG,this._tableA=n||null},_tableR:null,_tableG:null,_tableB:null,_tableA:null,thresholds:function(t,e,r){t.length||(t=[t]),e||(e=t),r||(r=e);var s,a,h=t.length,o=h+1,u=e.length,l=u+1,c=r.length,f=c+1,g=new i(256),m=new i(o),_=new i(256),p=new i(l),d=new i(256),A=new i(f),w=255/(o-1),v=255/(l-1),y=255/(f-1);for(s=0;o>s;)m[s]=~~(w*s),s++;for(t[0]=~~(255*t[0]),s=1;h>s;)t[s]=t[s-1]+~~(255*t[s]),s++;for(s=0;l>s;)p[s]=~~(v*s),s++;for(e[0]=~~(255*e[0]),s=1;u>s;)e[s]=e[s-1]+~~(255*e[s]),s++;for(s=0;f>s;)A[s]=~~(y*s),s++;for(r[0]=~~(255*r[0]),s=1;c>s;)r[s]=r[s-1]+~~(255*r[s]),s++;for(s=0;256>s;){for(a=0;h>a&&s>t[a];)a++;for(g[s]=n(m[a]),a=0;u>a&&s>e[a];)a++;for(_[s]=n(p[a]),a=0;c>a&&s>r[a];)a++;d[s]=n(A[a]),s++}return this.set(g,_,d)},threshold:function(t,e,i){return t=t||.5,e=e||t,i=i||e,this.thresholds([t],[e],[i])},quantize:function(t){t===e&&(t=64),2>t&&(t=2);var r,s=new i(256),a=new i(t),h=255/(t-1),o=t/256;for(r=0;t>r;)a[r]=~~(h*r),r++;for(r=0;256>r;)s[r]=n(a[~~(o*r)]),r++;return this.set(s)},binarize:function(){return this.quantize(2)},solarize:function(t){t===e&&(t=.5);var r,s,a=0,h=new i(256),o=2/255;for(a=0;256>a;)r=o*a,s=r>t?255-255*r:255*r-255,h[a]=~~n(s),a++;return this.set(h)},solarize2:function(t){t===e&&(t=.5),t=1-t;var r,s,a=0,h=new i(256),o=2/255;for(a=0;256>a;)r=o*a,s=t>r?255-255*r:255*r-255,h[a]=~~n(s),a++;return this.set(h)},solarizeInverse:function(t){t===e&&(t=.5),t*=256;var n=0,r=new i(256);for(n=0;256>n;)r[n]=n>t?255-n:n,n++;return this.set(r)},invert:function(){return this.set(c)},mask:function(t){var e=0,r=255&t>>16,s=255&t>>8,a=255&t;for(tR=new i(256),tG=new i(256),tB=new i(256),e=0;256>e;)tR[e]=n(e&r),tG[e]=n(e&s),tB[e]=n(e&a),e++;return this.set(tR,tG,tB)},replace:function(t,e){if(t==e)return this;var i=255&t>>16,n=255&t>>8,r=255&t,s=255&e>>16,h=255&e>>8,o=255&e,u=a(l),c=a(l),f=a(l);return u[i]=s,c[n]=h,f[r]=o,this.set(u,c,f)},extract:function(e,i,r){if(!i||!i.length)return this;r=r||0;var a,h,o=255&r>>16,u=255&r>>8,l=255&r,c=s(o),f=s(u),g=s(l);switch(e){case t.CHANNEL.BLUE:for(a=i[0],h=i[1];h>=a;)g[a]=n(a),a++;break;case t.CHANNEL.GREEN:for(a=i[0],h=i[1];h>=a;)f[a]=n(a),a++;break;case t.CHANNEL.RED:default:for(a=i[0],h=i[1];h>=a;)c[a]=n(a),a++}return this.set(c,f,g)},gammaCorrection:function(t,e,r){t=t||1,e=e||t,r=r||e,t=1/t,e=1/e,r=1/r;for(var s=new i(256),a=new i(256),o=new i(256),l=0;256>l;)s[l]=n(~~(255*h(u*l,t))),a[l]=n(~~(255*h(u*l,e))),o[l]=n(~~(255*h(u*l,r))),l++;return this.set(s,a,o)},exposure:function(t){t===e&&(t=1);var r=0,s=new i(256);for(r=0;256>r;)s[r]=n(~~(255*(1-o(-t*r*u)))),r++;return this.set(s)},set:function(t,e,i){if(!t)return this;e=e||t,i=i||e;var s,h,o,u,l,c=this._tableR||r(),f=a(c);if(e&&i){for(s=this._tableG||a(c),h=this._tableB||a(s),o=a(s),u=a(h),l=0;256>l;)c[l]=n(t[n(f[l])]),s[l]=n(e[n(o[l])]),h[l]=n(i[n(u[l])]),l++;this._tableR=c,this._tableG=s,this._tableB=h}else{for(l=0;256>l;)c[l]=n(t[n(f[l])]),l++;this._tableR=c,this._tableG=this._tableR,this._tableB=this._tableR}return this},reset:function(){return this._tableR=null,this._tableG=null,this._tableB=null,this._tableA=null,this},combineWith:function(t){return this.set(t.getTable(0),t.getTable(1),t.getTable(2))},getTable:function(e){switch(e=e||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA;case t.CHANNEL.BLUE:return this._tableB;case t.CHANNEL.GREEN:return this._tableG;case t.CHANNEL.RED:default:return this._tableR}},setTable:function(e,i){switch(i=i||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA=e,this;case t.CHANNEL.BLUE:return this._tableB=e,this;case t.CHANNEL.GREEN:return this._tableG=e,this;case t.CHANNEL.RED:default:return this._tableR=e,this}},_apply:function(t){if(!this._isOn||!this._tableR)return t;var e,i,n,r,s=t.length,a=0,h=this._tableR,o=this._tableG,u=this._tableB,l=this._tableA;if(l)for(;s>a;)e=t[a],i=t[a+1],n=t[a+2],r=t[a+3],t[a]=h[e],t[a+1]=o[i],t[a+2]=u[n],t[a+3]=l[r],a+=4;else for(;s>a;)e=t[a],i=t[a+1],n=t[a+2],t[a]=h[e],t[a+1]=o[i],t[a+2]=u[n],a+=4;return t},apply:function(t){return this._isOn&&this._tableR?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}});f.prototype.posterize=f.prototype.levels=f.prototype.quantize}(FILTER),function(t){var e=(t.ImArray,t.ImArrayCopy),i=t.Array16I,n=Math.min;Math.max,t.DisplacementMapFilter=t.Extends(t.Filter,{name:"DisplacementMapFilter",constructor:function(t){t&&this.setMap(t)},_map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:t.MODE.CLAMP,combineWith:function(){return this},reset:function(){return this._map=null,this},getMap:function(){return this._map},setMap:function(t){return this._map=t,this},_apply:function(r,s,a){if(!this._isOn||!this._map)return r;var h,o,u,l,c,f,g,m,_,p,d=this._map.getData(),A=this._map.width,w=this._map.height,v=A*w,y=new i(v<<1),E=n(A,s),L=n(w,a),C=.00390625*this.scaleX,x=.00390625*this.scaleY,M=this.componentX,b=this.componentY,R=255&this.color>>24,D=255&this.color>>16,I=255&this.color>>8,N=255&this.color,F=~~this.startY,U=~~this.startX,k=this.mode,H=F*s,G=-U,O=-F,T=s-U-1,P=a-F-1,S=E*L<<2,B=(r.length,new e(r)),Y=t.MODE.IGNORE,W=t.MODE.CLAMP,X=t.MODE.COLOR,q=t.MODE.WRAP;for(h=0,o=0,u=0,l=0,c=0;v>h;)m=u+c<<2,y[o]=~~((d[m+M]-128)*C),y[o+1]=~~((d[m+b]-128)*x),h++,o+=2,u++,u>=A&&(u=0,l++,c+=A);for(h=-4,u=-1,l=0,c=0,ty2=0;S>h;)if(h+=4,u++,u>=E&&(u=0,l++,c+=s,ty2+=A),!(O>l||l>P||G>u||u>T)){if(g=u+U,f=l+F,_=g+c+H<<2,o=u+ty2<<1,srcx=g+y[o],srcy=f+y[o+1],srcy>=a||0>srcy||srcx>=s||0>srcx)switch(k){case Y:continue;case X:r[_]=D,r[_+1]=I,r[_+2]=N,r[_+3]=R;continue;case q:srcy>P?srcy-=a:0>srcy&&(srcy+=a),srcx>T?srcx-=s:0>srcx&&(srcx+=s);break;case W:default:srcy>P?srcy=P:0>srcy&&(srcy=0),srcx>T?srcx=T:0>srcx&&(srcx=0)}p=srcx+srcy*s<<2,r[_]=B[p],r[_+1]=B[p+1],r[_+2]=B[p+2],r[_+3]=B[p+3]}return r},apply:function(t){return this._isOn&&this._map?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}})}(FILTER),function(t){var e=t.ImArray,i=t.ImArrayCopy,n=(t.CONSTANTS.PI,Math.sqrt),r=Math.atan2,s=Math.sin,a=Math.cos,h=Math.asin,o=Math.tan;Math.abs,t.CONSTANTS.toRad;var u=function(i,n,r){var s,a,h,o,u,l,c,f=i.length,g=new e(f),m=this.inverseTransform,_=this.mode,p=t.MODE.CLAMP,d=t.MODE.WRAP;for(h=0,s=0,a=0;f>h;){if(u=m([s,a],n,r),l=~~u[0],c=~~u[1],0>l||l>=n||0>c||c>=r)switch(_){case d:c>=r?c-=r:0>c&&(c+=r),l>=n?l-=n:0>l&&(l+=n);break;case p:default:c>=r?c=r-1:0>c&&(c=0),l>=n?l=n-1:0>l&&(l=0)}o=l+c*n<<2,g[h]=i[o],g[h+1]=i[o+1],g[h+2]=i[o+2],g[h+3]=i[o+3],h+=4,s++,s>=n&&(s=0,a++)}return g},l=function(i,n,r){var s,a,h,o,u,l,c,f,g,m=n*r,_=i.length,p=new e(_),d=this.matrix,A=d[0],w=d[1],v=d[3],y=d[4],E=d[2],L=d[5],C=this.mode,x=t.MODE.CLAMP,M=t.MODE.WRAP,b=n-1,R=m-n;for(h=0,s=0,a=0,u=L*n,l=v*n,c=y*n;_>h;){if(f=~~(A*s+w*a+E),g=~~(l*s+c*a+u),0>f||f>b||0>g||g>R)switch(C){case M:g>R?g-=m:0>g&&(g+=m),f>=n?f-=n:0>f&&(f+=n);break;case x:default:g>R?g=R:0>g&&(g=0),f>b?f=b:0>f&&(f=0)}o=f+g<<2,p[h]=i[o],p[h+1]=i[o+1],p[h+2]=i[o+2],p[h+3]=i[o+3],h+=4,s++,s>=n&&(s=0,a++)}return p},c=function(t,i){var n,r,s,a,h,o=t.length,u=new e(o);for(a=0,n=0,r=0,s=0;o>a;)h=i-1-n+s<<2,u[a]=t[h],u[a+1]=t[h+1],u[a+2]=t[h+2],u[a+3]=t[h+3],a+=4,n++,n>=i&&(n=0,r++,s+=i);return u},f=function(t,i,n){var r,s,a,h,o,u=t.length,l=new e(u);for(h=0,r=0,s=0,a=(n-1)*i;u>h;)o=r+a<<2,l[h]=t[o],l[h+1]=t[o+1],l[h+2]=t[o+2],l[h+3]=t[o+3],h+=4,r++,r>=i&&(r=0,s++,a-=i);return l},g=function(t,i,n){var r,s,a,h,o,u,l=t.length,c=new e(l);for(o=0,r=0,s=0,h=(n-1)*i;l>o;)u=i-1-r+h<<2,c[o]=t[u],c[o+1]=t[u+1],c[o+2]=t[u+2],c[o+3]=t[u+3],o+=4,r++,r>=i&&(r=0,s++,a+=i,h-=i);return c},m=function(t,i,n){var r,s,a,h,o,u=t.length,l=new e(u),c=n*i;for(h=0,r=0,s=0,a=c-1;u>h;)o=s+a<<2,l[h]=t[o],l[h+1]=t[o+1],l[h+2]=t[o+2],l[h+3]=t[o+3],h+=4,r++,a-=i,r>=i&&(r=0,a=c-1,s++);
return l},_=function(t,i,n){var r,s,a,h,o,u=t.length,l=new e(u);for(h=0,r=0,s=0,a=0;u>h;)o=i-1-s+a<<2,l[h]=t[o],l[h+1]=t[o+1],l[h+2]=t[o+2],l[h+3]=t[o+3],h+=4,r++,a+=i,r>=i&&(r=0,a=0,s++);return l},p=function(e,h,o){if(0>=this.radius)return e;var u,l,c,f,g,m,_,p,d=e.length,A=new i(e),w=this.centerX,v=this.centerY,y=this.angle,E=this.radius,L=this.mode,C=t.MODE.CLAMP,x=t.MODE.WRAP,M=y/E,b=h-1,R=o-1;for(c=0,u=0,l=0;d>c;){if(m=u-w,_=l-v,g=n(m*m+_*_),E>g){if(p=r(_,m)+M*(E-g),m=~~(w+g*a(p)),_=~~(v+g*s(p)),0>m||m>b||0>_||_>R)switch(L){case x:_>R?_-=o:0>_&&(_+=o),m>b?m-=h:0>m&&(m+=h);break;case C:default:_>R?_=R:0>_&&(_=0),m>b?m=b:0>m&&(m=0)}f=m+_*h<<2,e[c]=A[f],e[c+1]=A[f+1],e[c+2]=A[f+2],e[c+3]=A[f+3]}c+=4,u++,u>=h&&(u=0,l++)}return e},d=function(e,r,s){if(0>=this.radius)return e;var a,u,l,c,f,g,m,_,p,d,A,w,v,y=e.length,E=new i(e),L=this.centerX,C=this.centerY,x=this.radius,M=this.mode,b=t.MODE.CLAMP,R=t.MODE.WRAP,D=x*x,I=.555556,N=1-I,F=r-1,U=s-1;for(l=0,a=0,u=0;y>l;){if(f=a-L,g=u-C,w=f*f,v=g*g,m=w+v,D>m){if(d=D-m,A=n(d),_=h(f/n(w+d))*N,p=h(g/n(v+d))*N,f=~~(a-A*o(_)),g=~~(u-A*o(p)),0>f||f>F||0>g||g>U)switch(M){case R:g>U?g-=s:0>g&&(g+=s),f>F?f-=r:0>f&&(f+=r);break;case b:default:g>U?g=U:0>g&&(g=0),f>F?f=F:0>f&&(f=0)}c=f+g*r<<2,e[l]=E[c],e[l+1]=E[c+1],e[l+2]=E[c+2],e[l+3]=E[c+3]}l+=4,a++,a>=r&&(a=0,u++)}return e},A=function(t){return t},w=function(t){return t};t.GeometricMapFilter=t.Extends(t.Filter,{name:"GeometricMapFilter",constructor:function(t){this.generic(t)},_map:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,angle:0,radius:0,mode:t.MODE.CLAMP,generic:function(t){return t&&(this.inverseTransform=t,this._map=u),this},affine:function(t){return t&&(this.matrix=t,this._map=l),this},flipX:function(){return this._map=c,this},flipY:function(){return this._map=f,this},flipXY:function(){return this._map=g,this},rotateCW:function(){return this._map=m,this},rotateCCW:function(){return this._map=_,this},polar:function(t,e){return this.centerX=t||0,this.centerY=e||0,this._map=A,this},cartesian:function(t,e){return this.centerX=t||0,this.centerY=e||0,this._map=w,this},twirl:function(t,e,i,n){return this.angle=t||0,this.radius=e||0,this.centerX=i||0,this.centerY=n||0,this._map=p,this},sphere:function(t,e,i){return this.radius=t||0,this.centerX=e||0,this.centerY=i||0,this._map=d,this},combineWith:function(){return this},reset:function(){return this._map=null,this},getMap:function(){return this._map},setMap:function(t){return this._map=t,this},_apply:function(t,e,i,n){return this._isOn&&this._map?this._map.call(this,t,e,i,n):t},apply:function(t){return this._isOn&&this._map?t.setData(this._map.call(this,t.getData(),t.width,t.height,t)):t}})}(FILTER),function(t,e){function i(t,e,i,n){var r,s=t.length,a=new E(t.length);for(i=i||1,n=n||1,r=0;s>r;)a[r]=i*t[r]+n*e[r],r++;return a}function n(t,e){var i,n,r,s=t.length,a=[],h=0;for(i=0;s>i;i++)for(n=0;s>n;n++)r=t[i]*e[n],h+=r,a.push(r);return{kernel:a,sum:h}}function r(t){var e,i=new Array(t);for(e=0;t>e;)i[e]=1,e++;return i}function s(t){var e,i,n,r,s=R.length;if(t--,s>t)e=new E(R[t]);else for(e=new E(R[s-1]);t>=s;){for(i=e,e=new E(i.length+1),e[0]=1,n=0,r=i.length-1;r>n;n++)e[n+1]=i[n]+i[n+1];e[i.length]=1,40>s&&R.push(new Array(e)),s++}return e}function a(t){var e,i=t>>1,n=-i,r=new Array(t);for(e=0;t>e;)r[e]=n,n++,e++;return r}function h(t){var e=s(t);return n(e,e)}function o(t,e){var i=s(t),r=a(t);return 1==e?n(r.reverse(),i):n(i,r)}function u(t,e){var i=r(t),s=a(t);return 1==e?n(s.reverse(),i):n(i,s)}function l(t,e,i){e=e||1,i=i||e;var n,r=t*t,s=r>>1,a=new E(r);for(n=0;r>n;)a[n]=e,n++;return a[s]=i,a}function c(t,e,i,n){var r,s,a,h,o,u=t*t,l=t>>1,c=u>>1,f=new E(u);for(h=0,r=0;l>=r;r++){for(s=0,o=0,a=0;l>=a;a++)f[c+r+s]=h+o,f[c-r-s]=-h-o,f[c-r+s]=-h+o,f[c+r-s]=h-o,s+=t,o+=i;h+=e}return n=n||1,f[c]=n,f}function f(t,e,i,n){var r,s,a,h,o,u,l=t*t,c=t>>1,f=l>>1,g=new E(l),m=new E(l),_=1/t,p=1e-8;for(A(e)>p?(o=1,u=i/e):(o=e/i,u=1),r=0,a=0,h=0,s=u*t;c>=r;)m[f+r]=~~(f+a+h+.5),m[f-r]=~~(f-a-h+.5),r++,a+=o,h+=s;for(r=0;c>=r;)g[m[f+r]]=g[m[f-r]]=_,r++;return n=n||1,g[f]=n,g}function g(t,e,i,n,r,s,a,h,o,u){var l,c,f,g,m,_,p,d,A,w,v,y,E,x,M,R,D,I,N,F,U,k,H,G,O,T,P,S,B,Y,W,X,q,z,V,j,Q,J,K,Z,$,te,ee,ie,ne,re,se,ae,he,oe,ue=t.length,le=s,ce=a;if(l=e*i,A=le*ce,p=le>>1,d=e*(ce>>1),y=-p-1,x=-d-e,E=p,M=d,W=0,q=e-1,X=0,z=l-e,f=(l<<1)+l,v=(e<<1)+e,u=u||1,oe=0,r)for(U=n[0],k=n[A>>1],H=k-U,G=r[0],O=r[A>>1],T=O-G,ae=h,he=o;u>oe;){for(w=new L(ue),c=new C(f),R=0,D=0,I=0,g=m=_=0;e>I;)g+=t[R],m+=t[R+1],_+=t[R+2],c[D]=g,c[D+1]=m,c[D+2]=_,R+=4,D+=3,I++;for(R=v+e,D=v,I=0,g=m=_=0;ue>R;)g+=t[R],m+=t[R+1],_+=t[R+2],c[D]=c[D-v]+g,c[D+1]=c[D-v+1]+m,c[D+2]=c[D-v+2]+_,R+=4,D+=3,I++,I>=e&&(I=0,g=m=_=0);for(R=0,I=0,N=0,F=0;ue>R;)P=I+y,S=F+x,B=I+E,Y=F+M,W>P?P=W:B>q&&(B=q),X>S?S=X:Y>z&&(Y=z),V=P+S,J=B+Y,j=B+S,Q=P+Y,V=(V<<1)+V,j=(j<<1)+j,Q=(Q<<1)+Q,J=(J<<1)+J,te=U*(c[J]-c[j]-c[Q]+c[V])+H*t[R],ee=U*(c[J+1]-c[j+1]-c[Q+1]+c[V+1])+H*t[R+1],ie=U*(c[J+2]-c[j+2]-c[Q+2]+c[V+2])+H*t[R+2],ne=G*(c[J]-c[j]-c[Q]+c[V])+T*t[R],re=G*(c[J+1]-c[j+1]-c[Q+1]+c[V+1])+T*t[R+1],se=G*(c[J+2]-c[j+2]-c[Q+2]+c[V+2])+T*t[R+2],K=ae*te+he*ne,Z=ae*ee+he*re,$=ae*ie+he*se,b&&(0>K?K=0:K>255&&(K=255),0>Z?Z=0:Z>255&&(Z=255),0>$?$=0:$>255&&($=255)),w[R]=~~K,w[R+1]=~~Z,w[R+2]=~~$,w[R+3]=t[R+3],R+=4,I++,I>=e&&(I=0,N++,F+=e);t=w,oe++}else for(U=n[0],k=n[A>>1],H=k-U,h=h||1,o=o||0;u>oe;){for(w=new L(ue),c=new C(f),R=0,D=0,I=0,g=m=_=0;e>I;)g+=t[R],m+=t[R+1],_+=t[R+2],c[D]=g,c[D+1]=m,c[D+2]=_,R+=4,D+=3,I++;for(R=v+e,D=v,I=0,g=m=_=0;ue>R;)g+=t[R],m+=t[R+1],_+=t[R+2],c[D]=c[D-v]+g,c[D+1]=c[D-v+1]+m,c[D+2]=c[D-v+2]+_,R+=4,D+=3,I++,I>=e&&(I=0,g=m=_=0);for(R=0,I=0,N=0,F=0;ue>R;)P=I+y,S=F+x,B=I+E,Y=F+M,W>P?P=W:B>q&&(B=q),X>S?S=X:Y>z&&(Y=z),V=P+S,J=B+Y,j=B+S,Q=P+Y,V=(V<<1)+V,j=(j<<1)+j,Q=(Q<<1)+Q,J=(J<<1)+J,te=U*(c[J]-c[j]-c[Q]+c[V])+H*t[R],ee=U*(c[J+1]-c[j+1]-c[Q+1]+c[V+1])+H*t[R+1],ie=U*(c[J+2]-c[j+2]-c[Q+2]+c[V+2])+H*t[R+2],K=h*te+o,Z=h*ee+o,$=h*ie+o,b&&(0>K?K=0:K>255&&(K=255),0>Z?Z=0:Z>255&&(Z=255),0>$?$=0:$>255&&($=255)),w[R]=~~K,w[R+1]=~~Z,w[R+2]=~~$,w[R+3]=t[R+3],R+=4,I++,I>=e&&(I=0,N++,F+=e);t=w,oe++}return w}function m(t,e,i,n,r,s,a,h,o){var u,l,c,f,g,m,_,p,d,A,w,v,y,E,C,R,D,I,N,F,U,k,H,G,O,T,P,S,B,Y,W,X,q,z,V,j,Q=t.length;for(u=e*i,m=[a,s],_=[r,n],l=[1,s],c=[a,1],f=[0,s>>1],g=[a>>1,0],z=[o,h],O=e-1,T=u-e,j=2;--j;){for(y=new L(Q),w=m[j],v=_[j],d=f[j],A=g[j],p=l[j],V=z[j],R=new x(w<<1),C=new M(w),I=0,N=0,F=0,U=0,k=0,E=A*e;w>N;)C[N]=F+U,R[I]=F-d,R[I+1]=k-E,I+=2,N++,F++,F>=p&&(F=0,U+=p,k+=e);for(D=0,F=0,U=0;Q>D;){for(W=0,X=0,q=0,I=0,N=0;w>N;)H=F+R[I],G=U+R[I+1],H>=0&&O>=H&&G>=0&&T>=G&&(srcOff=H+G<<2,Y=V*v[C[N]],W+=t[srcOff]*Y,X+=t[srcOff+1]*Y,q+=t[srcOff+2]*Y),I+=2,N++;P=W,S=X,B=q,b&&(0>P?P=0:P>255&&(P=255),0>S?S=0:S>255&&(S=255),0>B?B=0:B>255&&(B=255)),y[D]=~~P,y[D+1]=~~S,y[D+2]=~~B,y[D+3]=t[D+3],D+=4,F++,F>=e&&(F=0,U+=e)}t=y}return y}function _(t,e,i,n,r,s,a,h){var o,u,l,c,f,g,m,_,p,d,w,v,y,E,C,R,D,I,N,F,U=matRadiusY=3,k=matHalfSideY=1,H=9,G=e,O=new x(18),T=new M(9),P=e*i,S=t.length,B=new L(S),Y=e-1,W=P-e,X=s,q=a;for(m=0,_=0,p=0,d=0,w=0;H>_;)T[_]=p+d,O[m]=p-k,O[m+1]=w-G,m+=2,_++,p++,p>=U&&(p=0,d+=U,w+=e);if(r)for(g=0,p=0,d=0;S>g;)C=0,R=0,D=0,I=0,N=0,F=0,v=p+O[0],y=d+O[1],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[0]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[0]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[2],y=d+O[3],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[1]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[1]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[4],y=d+O[5],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[2]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[2]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[6],y=d+O[7],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[3]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[3]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[8],y=d+O[9],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[4]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[4]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[10],y=d+O[11],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[5]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[5]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[12],y=d+O[13],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[6]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[6]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[14],y=d+O[15],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[7]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[7]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[16],y=d+O[17],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[8]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[8]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),h?(l=A(C)+A(I),c=A(R)+A(N),f=A(D)+A(F)):(l=X*C+q*I,c=X*R+q*N,f=X*D+q*F),b&&(0>l?l=0:l>255&&(l=255),0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255)),B[g]=~~l,B[g+1]=~~c,B[g+2]=~~f,B[g+3]=t[g+3],g+=4,p++,p>=e&&(p=0,d+=e);else for(g=0,p=0,d=0;S>g;)C=0,R=0,D=0,v=p+O[0],y=d+O[1],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[0]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[2],y=d+O[3],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[1]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[4],y=d+O[5],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[2]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[6],y=d+O[7],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[3]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[8],y=d+O[9],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[4]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[10],y=d+O[11],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[5]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[12],y=d+O[13],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[6]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[14],y=d+O[15],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[7]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[16],y=d+O[17],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[8]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),l=s*C+a,c=s*R+a,f=s*D+a,b&&(0>l?l=0:l>255&&(l=255),0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255)),B[g]=~~l,B[g+1]=~~c,B[g+2]=~~f,B[g+3]=t[g+3],g+=4,p++,p>=e&&(p=0,d+=e);return B}function p(t,e,i,n,r,s,a,h){var o,u,l,c,f,g,m,_,p,d,w,v,y,E,C,R,D,I,N,F,U=matRadiusY=5,k=matHalfSideY=2,H=25,G=e,O=new x(50),T=new M(25),P=e*i,S=t.length,B=new L(S),Y=e-1,W=P-e,X=s,q=a;for(m=0,_=0,p=0,d=0,w=0;H>_;)T[_]=p+d,O[m]=p-k,O[m+1]=w-G,m+=2,_++,p++,p>=U&&(p=0,d+=U,w+=e);if(r)for(g=0,p=0,d=0;S>g;)C=0,R=0,D=0,I=0,N=0,F=0,v=p+O[0],y=d+O[1],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[0]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[0]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[2],y=d+O[3],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[1]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[1]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[4],y=d+O[5],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[2]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[2]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[6],y=d+O[7],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[3]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[3]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[8],y=d+O[9],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[4]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[4]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[10],y=d+O[11],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[5]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[5]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[12],y=d+O[13],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[6]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[6]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[14],y=d+O[15],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[7]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[7]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[16],y=d+O[17],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[8]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[8]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[18],y=d+O[19],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[9]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[9]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[20],y=d+O[21],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[10]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[10]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[22],y=d+O[23],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[11]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[11]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[24],y=d+O[25],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[12]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[12]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[26],y=d+O[27],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[13]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[13]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[28],y=d+O[29],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[14]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[14]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[30],y=d+O[31],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[15]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[15]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[32],y=d+O[33],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[16]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[16]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[34],y=d+O[35],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[17]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[17]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[36],y=d+O[27],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[18]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[18]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[38],y=d+O[39],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[19]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[19]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[40],y=d+O[41],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[20]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[20]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[42],y=d+O[43],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[21]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[21]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[44],y=d+O[45],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[22]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[22]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[46],y=d+O[47],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[23]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[23]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),v=p+O[48],y=d+O[49],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[24]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o,u=r[T[24]],I+=t[E]*u,N+=t[E+1]*u,F+=t[E+2]*u),h?(l=A(C)+A(I),c=A(R)+A(N),f=A(D)+A(F)):(l=X*C+q*I,c=X*R+q*N,f=X*D+q*F),b&&(0>l?l=0:l>255&&(l=255),0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255)),B[g]=~~l,B[g+1]=~~c,B[g+2]=~~f,B[g+3]=t[g+3],g+=4,p++,p>=e&&(p=0,d+=e);else for(g=0,p=0,d=0;S>g;)C=0,R=0,D=0,v=p+O[0],y=d+O[1],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[0]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[2],y=d+O[3],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[1]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[4],y=d+O[5],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[2]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[6],y=d+O[7],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[3]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[8],y=d+O[9],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[4]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[10],y=d+O[11],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[5]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[12],y=d+O[13],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[6]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[14],y=d+O[15],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[7]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[16],y=d+O[17],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[8]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[18],y=d+O[19],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[9]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[20],y=d+O[21],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[10]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[22],y=d+O[23],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[11]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[24],y=d+O[25],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[12]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[26],y=d+O[27],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[13]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[28],y=d+O[29],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[14]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[30],y=d+O[31],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[15]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[32],y=d+O[33],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[16]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[34],y=d+O[35],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[17]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[36],y=d+O[27],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[18]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[38],y=d+O[39],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[19]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[40],y=d+O[41],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[20]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[42],y=d+O[43],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[21]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[44],y=d+O[45],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[22]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[46],y=d+O[47],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[23]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),v=p+O[48],y=d+O[49],v>=0&&Y>=v&&y>=0&&W>=y&&(E=v+y<<2,o=n[T[24]],C+=t[E]*o,R+=t[E+1]*o,D+=t[E+2]*o),l=s*C+a,c=s*R+a,f=s*D+a,b&&(0>l?l=0:l>255&&(l=255),0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255)),B[g]=~~l,B[g+1]=~~c,B[g+2]=~~f,B[g+3]=t[g+3],g+=4,p++,p>=e&&(p=0,d+=e);return B}var d=(t.CONSTANTS.SQRT2,t.CONSTANTS.toRad),A=(t.CONSTANTS.toDeg,Math.abs),w=Math.sqrt,v=Math.sin,y=Math.cos,E=t.Array32F,L=t.ImArray,C=t.Array32F,x=t.Array16I,M=t.Array8U,b=t._notSupportClamp,R=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],D=t.ConvolutionMatrixFilter=t.Extends(t.Filter,{name:"ConvolutionMatrixFilter",constructor:function(e,i,n){this._coeff=new E([1,0]),e&&e.length?this.set(e,~~(w(e.length)+.5),i||1,n||0):(this._matrix=null,this._dim=0),this._matrix2=null,this._dim2=this._dim,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,t.useWebGL&&(this._webglInstance=t.WebGLConvolutionMatrixFilterInstance)},_dim:0,_dim2:0,_matrix:null,_matrix2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_webglInstance:null,lowPass:function(t){return t=t===e?3:t%2?t:t+1,this.set(l(t),t,1/(t*t),0),this._doIntegral=1,this},highPass:function(t,i){t=t===e?3:t%2?t:t+1,i=i===e?1:i;var n=t*t,r=-i/n,s=l(t,r,1+r);return this.set(s,t,1,0),this._doIntegral=1,this},glow:function(t,i){return t=t===e?.5:t,this.highPass(i,-t)},sharpen:function(t,i){return t=t===e?.5:t,this.highPass(i,t)},verticalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(r(t),1,1/t,0),this._dim2=t,this._doIntegral=1,this},horizontalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(r(t),t,1/t,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(t,i){i=i===e?3:i%2?i:i+1,t*=d;var n=y(t),r=-v(t),s=f(i,n,r,1/i);return this.set(s,i,1,0)},fastGauss:function(t,i){return i=i===e?3:i%2?i:i+1,t=~~(t||1),1>t?t=1:t>3&&(t=3),this.set(l(i),i,1/(i*i),0),this._doIntegral=t,this},binomialLowPass:function(t){t=t===e?3:t%2?t:t+1;var i=s(t),n=1<<t-1,r=1/n;return this.set(i,t,r,r),this._matrix2=new E(i),this._doSeparable=!0,this},binomialHighPass:function(t){t=t===e?3:t%2?t:t+1;var n=h(t);return this.set(i(l(t),new E(n.kernel),1,-1/n.sum),t,1,0)},prewittX:function(t){t=t===e?3:t%2?t:t+1;var i=u(t,0);return this.set(i.kernel,t,1,0)},prewittY:function(t){t=t===e?3:t%2?t:t+1;var i=u(t,1);return this.set(i.kernel,t,1,0)},prewittDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=d;var r=y(t),s=v(t),a=u(n,0),h=u(n,1);return this.set(i(new E(a.kernel),new E(h.kernel),r,s),n,1,0)},prewitt:function(t){t=t===e?3:t%2?t:t+1;var i=u(t,0),n=u(t,1);return this.set(i.kernel,t,1,0),this._isGrad=!0,this._matrix2=new E(n.kernel),this},sobelX:function(t){t=t===e?3:t%2?t:t+1;var i=o(t,0);return this.set(i.kernel,t,1,0)},sobelY:function(t){t=t===e?3:t%2?t:t+1;var i=o(t,1);return this.set(i.kernel,t,1,0)},sobelDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=d;var r=y(t),s=v(t),a=o(n,0),h=o(n,1);return this.set(i(new E(a.kernel),new E(h.kernel),r,s),n,1,0)},sobel:function(t){t=t===e?3:t%2?t:t+1;var i=o(t,0),n=o(t,1);return this.set(i.kernel,t,1,0),this._matrix2=new E(n.kernel),this._isGrad=!0,this},laplace:function(t){t=t===e?3:t%2?t:t+1;var i=t*t,n=l(t,-1,i-1);return this.set(n,t,1,0),this._doIntegral=1,this},emboss:function(t,i,n){n=n===e?3:n%2?n:n+1,t=t===e?-.25*Math.PI:t*d,i=i||1;var r=i*y(t),s=-i*v(t),a=c(n,r,s,1);return this.set(a,n,1,0)},edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,i,n){return this._matrix2=null,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,this._matrix=new E(t),this._dim2=this._dim=e,this._coeff[0]=i||1,this._coeff[1]=n||0,this},reset:function(){return this._matrix=null,this._matrix2=null,this._dim=0,this._dim2=0,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,this},combineWith:function(){return this},getMatrix:function(){return this._matrix},setMatrix:function(t,e){return this._matrix=t,this._dim2=this._dim=e,this._matrix2=null,this._coeff[0]=1,this._coeff[1]=0,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,this},_apply:function(t,e,i){if(!this._isOn||!this._matrix)return t;if(this._doIntegral)return this._matrix2?g(t,e,i,this._matrix,this._matrix2,this._dim,this._dim2,this._coeff[0],this._coeff[1],this._doIntegral):g(t,e,i,this._matrix,null,this._dim,this._dim2,this._coeff[0],this._coeff[1],this._doIntegral);if(this._doSeparable)return m(t,e,i,this._matrix,this._matrix2,this._dim,this._dim2,this._coeff[0],this._coeff[1]);if(3==this._dim)return this._matrix2?_(t,e,i,this._matrix,this._matrix2,this._coeff[0],this._coeff[1],this._isGrad):_(t,e,i,this._matrix,null,this._coeff[0],this._coeff[1],!1);if(5==this._dim)return this._matrix2?p(t,e,i,this._matrix,this._matrix2,this._coeff[0],this._coeff[1],this._isGrad):p(t,e,i,this._matrix,null,this._coeff[0],this._coeff[1],!1);var n,r,s,a,h,o,u,l,c,f,d,w,v,y,E,C,R,D,I,N,F=this._dim,U=this._dim,k=F>>1,H=U>>1,G=F*U,O=H*e,T=this._matrix,P=this._matrix2,S=this._isGrad,B=new x(G<<1),Y=new M(G),W=e*i,X=t.length,q=new L(X),z=e-1,V=W-e,j=this._coeff[0],Q=this._coeff[1];for(u=0,l=0,c=0,f=0,d=0;G>l;)Y[l]=c+f,B[u]=c-k,B[u+1]=d-O,u+=2,l++,c++,c>=F&&(c=0,f+=F,d+=e);if(P)for(o=0,c=0,f=0;X>o;){for(E=0,C=0,R=0,D=0,I=0,N=0,u=0,l=0;G>l;)w=c+B[u],v=f+B[u+1],w>=0&&z>=w&&v>=0&&V>=v&&(y=w+v<<2,n=T[Y[l]],E+=t[y]*n,C+=t[y+1]*n,R+=t[y+2]*n,r=P[Y[l]],D+=t[y]*r,I+=t[y+1]*r,N+=t[y+2]*r),u+=2,l++;S?(s=A(E)+A(D),a=A(C)+A(I),h=A(R)+A(N)):(s=j*E+Q*D,a=j*C+Q*I,h=j*R+Q*N),b&&(0>s?s=0:s>255&&(s=255),0>a?a=0:a>255&&(a=255),0>h?h=0:h>255&&(h=255)),q[o]=~~s,q[o+1]=~~a,q[o+2]=~~h,q[o+3]=src[o+3],o+=4,c++,c>=e&&(c=0,f+=e)}else for(o=0,c=0,f=0;X>o;){for(E=0,C=0,R=0,u=0,l=0;G>l;)w=c+B[u],v=f+B[u+1],w>=0&&z>=w&&v>=0&&V>=v&&(y=w+v<<2,n=T[Y[l]],E+=t[y]*n,C+=t[y+1]*n,R+=t[y+2]*n),u+=2,l++;s=j*E+Q,a=j*C+Q,h=j*R+Q,b&&(0>s?s=0:s>255&&(s=255),0>a?a=0:a>255&&(a=255),0>h?h=0:h>255&&(h=255)),q[o]=~~s,q[o+1]=~~a,q[o+2]=~~h,q[o+3]=src[o+3],o+=4,c++,c>=e&&(c=0,f+=e)}return q},apply:function(t){return this._isOn&&this._matrix?t.setData(this._apply(t.getData(),t.width,t.height,t)):t}});D.prototype.boxBlur=D.prototype.lowPass,D.prototype.gaussBlur=D.prototype.binomialLowPass,D.prototype.gradX=D.prototype.prewittX,D.prototype.gradY=D.prototype.prewittY,D.prototype.gradDirectional=D.prototype.prewittDirectional,D.prototype.grad=D.prototype.prewitt}(FILTER),function(t){var e=t.ImArray,i=t.Array8U,n=t.Array32I,r=Math.sqrt,s=function(t,i,r){var s,a,h,o,u,l,c,f,g,m,_,p,d,A=this._structureElement,w=(A.length,this._dim,new n(this._indices)),v=i*r,y=t.length,E=new e(y),L=w.length,C=L>>1,x=i-1,M=v-i;for(k=0;L>k;)w[k+1]*=i,k+=2;for(s=0,h=0,o=0;y>s;){for(_=0,p=0,d=0,a=0;C>a;)u=h+w[a],l=o+w[a+1],u>=0&&x>=u&&l>=0&&M>=l&&(c=u+l<<2,f=t[c],g=t[c+1],m=t[c+2],f>_&&(_=f),g>p&&(p=g),m>d&&(d=m)),a+=2;E[s]=_,E[s+1]=p,E[s+2]=d,E[s+3]=t[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}return E},a=function(t,i,r){var s,a,h,o,u,l,c,f,g,m,_,p,d,A=this._structureElement,w=(A.length,this._dim,new n(this._indices)),v=i*r,y=t.length,E=new e(y),L=w.length,C=L>>1,x=i-1,M=v-i;for(k=0;L>k;)w[k+1]*=i,k+=2;for(s=0,h=0,o=0;y>s;){for(_=255,p=255,d=255,a=0;C>a;)u=h+w[a],l=o+w[a+1],u>=0&&x>=u&&l>=0&&M>=l&&(c=u+l<<2,f=t[c],g=t[c+1],m=t[c+2],_>f&&(_=f),p>g&&(p=g),d>m&&(d=m)),a+=2;E[s]=_,E[s+1]=p,E[s+2]=d,E[s+3]=t[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}return E},h=function(t,i,r){var s,a,h,o,u,l,c,f,g,m,_,p,d,A=this._structureElement,w=(A.length,this._dim,new n(this._indices)),v=i*r,y=t.length,E=new e(y),L=w.length,C=L>>1,x=i-1,M=v-i;for(k=0;L>k;)w[k+1]*=i,k+=2;for(s=0,h=0,o=0;y>s;){for(_=255,p=255,d=255,a=0;C>a;)u=h+w[a],l=o+w[a+1],u>=0&&x>=u&&l>=0&&M>=l&&(c=u+l<<2,f=t[c],g=t[c+1],m=t[c+2],_>f&&(_=f),p>g&&(p=g),d>m&&(d=m)),a+=2;E[s]=_,E[s+1]=p,E[s+2]=d,E[s+3]=t[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}for(t=E,E=new e(y),s=0,h=0,o=0;y>s;){for(_=255,p=255,d=255,a=0;C>a;)u=h+w[a],l=o+w[a+1],u>=0&&x>=u&&l>=0&&M>=l&&(c=u+l<<2,f=t[c],g=t[c+1],m=t[c+2],_>f&&(_=f),p>g&&(p=g),d>m&&(d=m)),a+=2;E[s]=_,E[s+1]=p,E[s+2]=d,E[s+3]=t[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}return E},o=function(t,i,r){var s,a,h,o,u,l,c,f,g,m,_,p,d,A=this._structureElement,w=(A.length,this._dim,new n(this._indices)),v=i*r,y=t.length,E=new e(y),L=w.length,C=L>>1,x=i-1,M=v-i;for(k=0;L>k;)w[k+1]*=i,k+=2;for(s=0,h=0,o=0;y>s;){for(_=255,p=255,d=255,a=0;C>a;)u=h+w[a],l=o+w[a+1],u>=0&&x>=u&&l>=0&&M>=l&&(c=u+l<<2,f=t[c],g=t[c+1],m=t[c+2],_>f&&(_=f),p>g&&(p=g),d>m&&(d=m)),a+=2;E[s]=_,E[s+1]=p,E[s+2]=d,E[s+3]=t[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}for(t=E,E=new e(y),s=0,h=0,o=0;y>s;){for(_=255,p=255,d=255,a=0;C>a;)u=h+w[a],l=o+w[a+1],u>=0&&x>=u&&l>=0&&M>=l&&(c=u+l<<2,f=t[c],g=t[c+1],m=t[c+2],_>f&&(_=f),p>g&&(p=g),d>m&&(d=m)),a+=2;E[s]=_,E[s+1]=p,E[s+2]=d,E[s+3]=t[s+3],s+=4,h++,h>=i&&(h=0,o+=i)}return E},u=function(t){var e,n=t*t,r=new i(n);for(e=0;n>e;e++)r[e]=1;return r},l=u(3);t.MorphologicalFilter=t.Extends(t.Filter,{name:"MorphologicalFilter",constructor:function(){this._filter=null,this._dim=0,this._structureElement=null,this._indices=null},_filter:null,_dim:0,_structureElement:null,_indices:null,erode:function(t){return this.set(t,a)},dilate:function(t){return this.set(t,s)},opening:function(t){return this.set(t,h)},closing:function(t){return this.set(t,o)},set:function(t,e){this._filter=e,t&&t.length?(this._structureElement=new i(t),this._dim=~~(r(this._structureElement.length)+.5)):t&&t===t-0?(this._structureElement=u(t),this._dim=t):(this._structureElement=l,this._dim=3);var s,a,h,o=[],t=this._structureElement,c=t.length,f=this._dim,g=f>>1;for(a=0,h=0,s=0;c>s;)t[s]&&(o.push(a-g),o.push(h-g)),s++,a++,a>=f&&(a=0,h++);return this._indices=new n(o),this},reset:function(){return this._filter=null,this._dim=0,this._structureElement=null,this._indices=null,this},_apply:function(t,e,i){return this._isOn&&this._dim&&this._filter?this._filter.call(this,t,e,i):t},apply:function(t){return this._isOn&&this._dim&&this._filter?t.setData(this._filter.call(this,t.getData(),t.width,t.height,t)):t}})}(FILTER),function(t,e){var i=t.ImArray,n=t.Array32I;Math.min,Math.max;var r=function(t,e,r){var s,a,h,o,u,l,c,f,g,m,_,p,d,A,w,v=this._dim,y=v*v,E=new n(this._indices),L=e*r,C=t.length,x=new i(C),M=[],b=[],R=[],D=y<<1,I=e-1,N=L-e;for(a=0;D>a;)E[a+1]*=e,a+=2;for(s=0,h=0,o=0;C>s;){for(M.length=0,b.length=0,R.length=0,a=0;D>a;)u=h+E[a],l=o+E[a+1],u>=0&&I>=u&&l>=0&&N>=l&&(c=u+l<<2,f=t[c],g=t[c+1],m=t[c+2],M.push(f),b.push(g),R.push(m)),a+=2;M.sort(),b.sort(),R.sort(),A=M.length,w=A>>1,_=A%2?M[w+1]:~~(.5*(M[w]+M[w+1])),A=b.length,w=A>>1,p=A%2?b[w+1]:~~(.5*(b[w]+b[w+1])),A=R.length,w=A>>1,d=A%2?R[w+1]:~~(.5*(R[w]+R[w+1])),x[s]=_,x[s+1]=p,x[s+2]=d,x[s+3]=t[s+3],s+=4,h++,h>=e&&(h=0,o+=e)}return x},s=function(t,e,r){var s,a,h,o,u,l,c,f,g,m,_,p,d,A=this._dim,w=A*A,v=new n(this._indices),y=e*r,E=t.length,L=new i(E),C=w<<1,x=e-1,M=y-e;for(a=0;C>a;)v[a+1]*=e,a+=2;for(s=0,h=0,o=0;E>s;){for(_=0,p=0,d=0,a=0;C>a;)u=h+v[a],l=o+v[a+1],u>=0&&x>=u&&l>=0&&M>=l&&(c=u+l<<2,f=t[c],g=t[c+1],m=t[c+2],f>_&&(_=f),g>p&&(p=g),m>d&&(d=m)),a+=2;L[s]=_,L[s+1]=p,L[s+2]=d,L[s+3]=t[s+3],s+=4,h++,h>=e&&(h=0,o+=e)}return L},a=function(t,e,r){var s,a,h,o,u,l,c,f,g,m,_,p,d,A=this._dim,w=A*A,v=new n(this._indices),y=e*r,E=t.length,L=new i(E),C=w<<1,x=e-1,M=y-e;for(a=0;C>a;)v[a+1]*=e,a+=2;for(s=0,h=0,o=0;E>s;){for(_=255,p=255,d=255,a=0;C>a;)u=h+v[a],l=o+v[a+1],u>=0&&x>=u&&l>=0&&M>=l&&(c=u+l<<2,f=t[c],g=t[c+1],m=t[c+2],_>f&&(_=f),p>g&&(p=g),d>m&&(d=m)),a+=2;L[s]=_,L[s+1]=p,L[s+2]=d,L[s+3]=t[s+3],s+=4,h++,h>=e&&(h=0,o+=e)}return L},h=t.StatisticalFilter=t.Extends(t.Filter,{name:"StatisticalFilter",constructor:function(){this._dim=0,this._indices=null,this._filter=null},_dim:0,_indices:null,_filter:null,median:function(t){return t=t===e?3:t%2?t:t+1,this.set(t,r)},minimum:function(t){return t=t===e?3:t%2?t:t+1,this.set(t,a)},maximum:function(t){return t=t===e?3:t%2?t:t+1,this.set(t,s)},set:function(t,e){this._filter=e,this._dim=t;var i,r,s,a=[],h=t*t,o=t,u=o>>1;for(r=0,s=0,i=0;h>i;)a.push(r-u),a.push(s-u),i++,r++,r>=o&&(r=0,s++);return this._indices=new n(a),this},reset:function(){return this._filter=null,this._dim=0,this._indices=null,this},_apply:function(t,e,i){return this._isOn&&this._dim?this._filter.call(this,t,e,i):t},apply:function(t){return this._isOn&&this._dim?t.setData(this._filter.call(this,t.getData(),t.width,t.height,t)):t}});h.prototype.erode=h.prototype.minimum,h.prototype.dilate=h.prototype.maximum}(FILTER),function(t){var e=t._notSupportClamp,i=Math.random;t.NoiseFilter=t.Create({min:-127,max:127,name:"NoiseFilter",init:function(t,e){this.min=t||-127,this.max=e||127},apply:function(t){var n,r,s,a,h,o,u,l,c=this.max-this.min,f=this.min,g=t.length;for(n=0;g>n;)s=t[n],a=t[n+1],h=t[n+2],r=c*i()+f,o=s+r,u=a+r,l=h+r,e&&(0>o?o=0:o>255&&(o=255),0>u?u=0:u>255&&(u=255),0>l?l=0:l>255&&(l=255)),t[n]=~~o,t[n+1]=~~u,t[n+2]=~~l,n+=4;return t}})}(FILTER),function(t){var e=t._notSupportClamp,i=t.Array32F,n=t.Color.RGB2YCbCr,r=t.Color.YCbCr2RGB;t.HistogramEqualizeFilter=t.Create({name:"HistogramEqualizeFilter",apply:function(t){var s,a,h,o,u,l,c,f,g,m,_,p=0,d=255,A=new i(256),w=new i(256),v=0,y=t.length,E=y>>2,L=1/E,C=new Array(E);for(f=0;256>f;)A[f]=0,w[f]=0,f++;for(f=0,g=0;y>f;)s=t[f],a=t[f+1],h=t[f+2],m=n({r:s,g:a,b:h}),A[m.y]+=L,m.y>p&&(p=m.y),m.y<d&&(d=m.y),C[g]=m,f+=4,g++;for(v=0,f=0;256>f;)v+=A[f],w[f]=v,f++;for(A=null,o=p-d,f=0,g=0;y>f;)m=C[g],m.y=w[m.y]*o+d,_=r(m),u=~~_.r,l=~~_.g,c=~~_.b,e&&(0>u?u=0:u>255&&(u=255),0>l?l=0:l>255&&(l=255),0>c?c=0:c>255&&(c=255)),t[f]=~~u,t[f+1]=~~l,t[f+2]=~~c,f+=4,g++;return t}})}(FILTER),function(t){var e=t._notSupportClamp,i=t.Array32F;t.RGBHistogramEqualizeFilter=t.Create({name:"RGBHistogramEqualizeFilter",apply:function(t){var n,r,s,a,h,o,u,l,c,f,g,m,_,p=0,d=0,A=0,w=255,v=255,y=255,E=new i(256),L=new i(256),C=new i(256),x=new i(256),M=new i(256),b=new i(256),R=t.length,D=R>>2,I=1/D;for(_=0;256>_;)E[_]=0,L[_]=0,C[_]=0,x[_]=0,M[_]=0,b[_]=0,_++;for(_=0;R>_;)n=t[_],r=t[_+1],s=t[_+2],E[n]+=I,L[r]+=I,C[s]+=I,n>p&&(p=n),w>n&&(w=n),r>d&&(d=r),v>r&&(v=r),s>A&&(A=s),y>s&&(y=s),_+=4;for(u=l=c=0,_=0;256>_;)u+=E[_],x[_]=u,l+=L[_],M[_]=l,c+=C[_],b[_]=c,_++;for(E=null,L=null,C=null,a=p-w,h=d-v,o=A-y,_=0;R>_;)n=t[_],r=t[_+1],s=t[_+2],f=x[n]*a+w,g=M[r]*h+v,m=b[s]*o+y,e&&(0>f?f=0:f>255&&(f=255),0>g?g=0:g>255&&(g=255),0>m?m=0:m>255&&(m=255)),t[_]=~~f,t[_+1]=~~g,t[_+2]=~~m,_+=4;return t}})}(FILTER),function(t){var e=Math.sqrt,i=t._notSupportClamp,n=t.Array32F;t.PixelateFilter=t.Create({scale:1,name:"PixelateFilter",init:function(t){this.scale=t||1},apply:function(t,r,s){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var a,h,o,u,l,c,f,g,m,_,p,d,A,w,v,y,E,L,C,x,M,b,R,D,I,N,F,U,k=t.length,H=r*s,G=~~(.01*e(H)*this.scale),O=G*G,T=1/O,P=r*G,S=new n(3*H),B=G,Y=G,W=(r<<1)+r;for(u=B-1,l=(Y-1)*r,L=0,x=r-1,C=0,M=H-r,c=0,f=0,g=0,a=h=o=0;r>g;)a+=t[c],h+=t[c+1],o+=t[c+2],S[f]=a,S[f+1]=h,S[f+2]=o,c+=4,f+=3,g++;for(c=W+r,f=W,g=0,a=h=o=0;k>c;)a+=t[c],h+=t[c+1],o+=t[c+2],S[f]=S[f-W]+a,S[f+1]=S[f-W+1]+h,S[f+2]=S[f-W+2]+o,c+=4,f+=3,g++,g>=r&&(g=0,a=h=o=0);for(w=0,v=0,y=u,E=l,y>x&&(y=x),E>M&&(E=M),b=w+v,I=y+E,R=y+v,D=w+E,b=(b<<1)+b,R=(R<<1)+R,D=(D<<1)+D,I=(I<<1)+I,N=T*(S[I]-S[R]-S[D]+S[b]),F=T*(S[I+1]-S[R+1]-S[D+1]+S[b+1]),U=T*(S[I+2]-S[R+2]-S[D+2]+S[b+2]),i&&(0>N?N=0:N>255&&(N=255),0>F?F=0:F>255&&(F=255),0>U?U=0:U>255&&(U=255)),N=~~N,F=~~F,U=~~U,c=0,g=0,m=0,_=0,p=0,A=0;k>c;)d=_+g+p+m<<2,t[d]=N,t[d+1]=F,t[d+2]=U,_++,(_+g>=r||_>=G)&&(_=0,A++,p+=r),(p+m>=H||A>=G)&&(g+=G,g>=r&&(g=0,m+=P),_=0,p=0,A=0,w=g,v=m,y=g+u,E=m+l,y>x&&(y=x),E>M&&(E=M),b=w+v,I=y+E,R=y+v,D=w+E,b=(b<<1)+b,R=(R<<1)+R,D=(D<<1)+D,I=(I<<1)+I,N=T*(S[I]-S[R]-S[D]+S[b]),F=T*(S[I+1]-S[R+1]-S[D+1]+S[b+1]),U=T*(S[I+2]-S[R+2]-S[D+2]+S[b+2]),i&&(0>N?N=0:N>255&&(N=255),0>F?F=0:F>255&&(F=255),0>U?U=0:U>255&&(U=255)),N=~~N,F=~~F,U=~~U),c+=4;return t}})}(FILTER),function(t){var e=t._notSupportClamp,i=t.Color.RGB2HSV,n=.7083333333333334;
t.HSVConverterFilter=t.Create({name:"HSVConverterFilter",apply:function(t,r,s){var a,h,o,u,l,s,c,f,g,m,_,p=t.length;for(u=0;p>u;)a=t[u],h=t[u+1],o=t[u+2],l=i({r:a,g:h,b:o}),s=l.h*n,c=255*l.s,f=l.v,g=s,m=f,_=c,e&&(0>g?g=0:g>255&&(g=255),0>m?m=0:m>255&&(m=255),0>_?_=0:_>255&&(_=255)),t[u]=~~g,t[u+1]=~~m,t[u+2]=~~_,u+=4;return t}})}(FILTER),function(t){var e=(t._notSupportClamp,t.ImArray,t.Color.clampPixel),i=t.Color.RGB2HSV,n=(t.Color.HSV2RGB,t.Color.Color2RGBA);t.HueExtractorFilter=t.Create({range:null,background:0,name:"HueExtractorFilter",init:function(t,e){this.range=t,this.background=e||0},apply:function(t){if(!this.range||!this.range.length)return t;var r,s,a,h,o,u,l,c,f,g,m=t.length,_=this.range[0],p=this.range[this.range.length-1];for(f=n(this.background||0),h=~~e(f.r),o=~~e(f.g),u=~~e(f.b),l=~~e(f.a),c=0;m>c;)r=t[c],s=t[c+1],a=t[c+2],g=i({r:r,g:s,b:a}).h,(_>g||g>p)&&(t[c]=h,t[c+1]=o,t[c+2]=u,t[c+3]=l),c+=4;return t}})}(FILTER),function(t){var e=(t._notSupportClamp,Math.min);t.AlphaMaskFilter=t.Create({alphaMask:null,centerX:0,centerY:0,name:"AlphaMaskFilter",init:function(t,e,i){this.alphaMask=t||null,this.centerX=e||0,this.centerY=i||0},apply:function(t,i,n){if(!this.alphaMask)return t;var r,s,a,h,o,u,l,c,f=this.alphaMask.getData(),g=t.length,m=(f.length,this.alphaMask.width),_=this.alphaMask.height,p=e(i,m),d=e(n,_),A=i-m>>1,w=n-_>>1;for(l=this.centerX+A,c=this.centerY+w,r=0,s=0,a=0;g>r;)o=s-l,u=a-c,o>=0&&p>o&&u>=0&&d>u?(h=o+u*m<<2,t[r+3]=f[h+3]):t[r+3]=0,r+=4,s++,s>=i&&(s=0,a++);return t}})}(FILTER),function(t){var e=(t._notSupportClamp,t.Color.RGBA2Color),i=t.Color.Color2RGBA;t.ThresholdFilter=t.Create({thresholds:null,quantizedColors:null,name:"ThresholdFilter",init:function(t,e){this.thresholds=t,this.quantizedColors=e||null},apply:function(t){if(!this.thresholds||!this.thresholds.length)return t;if(!this.quantizedColors||!this.quantizedColors.length)return t;var n,r,s,a,h,o,u,l,c=t.length,f=this.thresholds,g=f.length,m=this.quantizedColors,_=m.length;for(u=0;c>u;){for(h=e({r:t[u],g:t[u+1],b:t[u+2],a:t[u+3]}),l=0;g>l&&h>f[l];)l++;h=_>l?m[l]:h=255,o=i(h),n=o.r,r=o.g,s=o.b,a=o.a,t[u]=n,t[u+1]=r,t[u+2]=s,t[u+3]=a,u+=4}return t}})}(FILTER),function(t){var e=t.Color.RGB2YCbCr;t.YCbCrConverterFilter=t.Create({name:"YCbCrConverterFilter",apply:function(t){var i,n,r,s,a,h=t.length;for(s=0;h>s;)i=t[s],n=t[s+1],r=t[s+2],a=e({r:i,g:n,b:r}),t[s]=a.cr,t[s+1]=a.y,t[s+2]=a.cb,s+=4;return t}})}(FILTER),function(t){var e=(Math.sqrt,Math.exp,Math.log),i=Math.abs,n=t._notSupportClamp,r=t.Array32F;t.BokehFilter=t.Create({centerX:0,centerY:0,radius:10,amount:10,name:"BokehFilter",init:function(t,e,i,n){this.centerX=t||0,this.centerY=e||0,this.radius=i||10,this.amount=n||10},apply:function(t,s,a){var h,o,u,l,c,f,g,m,_,p,d,A,w,v,y,E,L,C,x,M,b,R,D,I,N,F,U,k,H,G,O,T,P,S=t.length,B=this.centerX,Y=this.centerY,W=this.radius,X=this.amount;if(0>=X)return t;for(h=s*a,G=0,O=s-1,T=0,P=h-s,u=(h<<1)+h,g=(s<<1)+s,o=new r(u),m=0,_=0,p=0,l=c=f=0;s>p;)l+=t[m],c+=t[m+1],f+=t[m+2],o[_]=l,o[_+1]=c,o[_+2]=f,m+=4,_+=3,p++;for(m=g+s,_=g,p=0,l=c=f=0;S>m;)l+=t[m],c+=t[m+1],f+=t[m+2],o[_]=o[_-g]+l,o[_+1]=o[_-g+1]+c,o[_+2]=o[_-g+2]+f,m+=4,_+=3,p++,p>=s&&(p=0,l=c=f=0);for(m=0,p=0,d=0,A=0;S>m;)v=p-B,y=d-Y,w=i(v)+i(y),E=w>W?~~e((w-W)*X):~~(w/W+.5),E>0&&(L=E*s,C=.25/(E*E),x=p-E,M=A-L,b=p+E,R=A+L,G>x?x=G:b>O&&(b=O),T>M?M=T:R>P&&(R=P),D=x+M,F=b+R,I=b+M,N=x+R,D=(D<<1)+D,I=(I<<1)+I,N=(N<<1)+N,F=(F<<1)+F,U=C*(o[F]-o[I]-o[N]+o[D]),k=C*(o[F+1]-o[I+1]-o[N+1]+o[D+1]),H=C*(o[F+2]-o[I+2]-o[N+2]+o[D+2]),n&&(0>U?U=0:U>255&&(U=255),0>k?k=0:k>255&&(k=255),0>H?H=0:H>255&&(H=255)),t[m]=~~U,t[m+1]=~~k,t[m+2]=~~H),m+=4,p++,p>=s&&(p=0,d++,A+=s);return t}})}(FILTER);