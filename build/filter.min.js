/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.4.1
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/var FILTER=FILTER||{};
(function(c){var k,m=Math.min;k={normal:function(b){return b},lighten:function(b,a){return a>b?a:b},darken:function(b,a){return a>b?b:a},multiply:function(b,a){return b*a*0.003921568627451},average:function(b,a){return 0.5*(b+a)},add:function(b,a){return Math.min(255,b+a)},substract:function(b,a){return b+a<255?0:b+a-255},difference:function(b,a){return Math.abs(b-a)},negation:function(b,a){return 255-Math.abs(255-b-a)},screen:function(b,a){return 255-((255-b)*(255-a)>>8)},exclusion:function(b,a){return b+
a-2*b*a*0.003921568627451},overlay:function(b,a){return a<128?2*b*a*0.003921568627451:255-2*(255-b)*(255-a)*0.003921568627451},softLight:function(b,a){return a<128?2*((b>>1)+64)*a*0.003921568627451:255-2*(255-((b>>1)+64))*(255-a)*0.003921568627451},hardLight:function(b,a){return b<128?2*a*b*0.003921568627451:255-2*(255-a)*(255-b)*0.003921568627451},colorDodge:function(b,a){return a==255?a:Math.min(255,(b<<8)/(255-a))},colorBurn:function(b,a){return a==0?a:Math.max(0,255-(255-b<<8)/a)},linearLight:function(b,
a){return a<128?k.linearBurn(b,2*a):k.linearDodge(b,2*(a-128))},vividLight:function(b,a){return a<128?k.colorBurn(b,2*a):k.colorDodge(b,2*(a-128))},pinLight:function(b,a){return a<128?k.darken(b,2*a):k.lighten(b,2*(a-128))},hardMix:function(b,a){return k.vividLight(b,a)<128?0:255},reflect:function(b,a){return a==255?a:Math.min(255,b*b/(255-a))},glow:function(b,a){return b==255?b:Math.min(255,a*a/(255-b))},phoenix:function(b,a){return Math.min(b,a)-Math.max(b,a)+255}};k.linearDodge=k.add;k.linearBurn=
k.substract;c.blendModes=k;c.Image=function(b,a){this.height=this.width=0;this.imageData=this.context=null;this.canvasElement=document.createElement("canvas");this.canvasElement.width=0;this.canvasElement.height=0;this._tmpCanvas=document.createElement("canvas");this._tmpCanvas.width=0;this._tmpCanvas.height=0;this.context=this.canvasElement.getContext("2d");this._integral=this._histogram=null;this._integralRefresh=this._histogramRefresh=!0;this.setImage(b,a)};c.Image.prototype={width:0,height:0,
canvasElement:null,getPixel:function(b,a){var d=~~(a*this.width+b+0.5);return{red:this.imageData.data[d],green:this.imageData.data[d+1],blue:this.imageData.data[d+2],alpha:this.imageData.data[d+3]}},setPixel:function(b,a,d,l,g,e){this.context.putImageData(new c.ImArray([d,l,g,e]),b,a);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},getData:function(){return new c.ImArray(this.imageData.data)},setData:function(b){this.imageData.data.set(b);
this.context.putImageData(this.imageData,0,0);this._integralRefresh=this._histogramRefresh=!0;return this},getPixelData:function(){return this.imageData},setPixelData:function(b){this.context.putImageData(b,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setWidth:function(b){this._tmpCanvas.width=this.canvasElement.width=this.width=b;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,
0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setHeight:function(b){this._tmpCanvas.height=this.canvasElement.height=this.height=b;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setImage:function(b,a){if(typeof b=="undefined"||b==null)return this;var d=this,l;b instanceof Image||b instanceof HTMLCanvasElement||b instanceof HTMLVideoElement?
(l=b,this.width=b instanceof HTMLVideoElement?b.videoWidth:b.width,this.height=b instanceof HTMLVideoElement?b.videoHeight:b.height,this._tmpCanvas.width=this.canvasElement.width=this.width,this._tmpCanvas.height=this.canvasElement.height=this.height,this.context=this.canvasElement.getContext("2d"),this.context.drawImage(l,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._integralRefresh=this._histogramRefresh=!0):(l=new Image,l.onload=function(){d.width=l.width;d.height=
l.height;d._tmpCanvas.width=d.canvasElement.width=d.width;d._tmpCanvas.height=d.canvasElement.height=d.height;d.context=d.canvasElement.getContext("2d");d.context.drawImage(l,0,0);d.imageData=d.context.getImageData(0,0,d.width,d.height);d._histogramRefresh=!0;d._integralRefresh=!0;typeof a!="undefined"&&a.call(d)},l.src=b);l.crossOrigin="";return this},blend:function(b,a,d,l,c){typeof a=="undefined"&&(a="normal");typeof d=="undefined"&&(d=1);d>1&&(d=1);d<0&&(d=0);typeof l=="undefined"&&(l=0);typeof c==
"undefined"&&(c=0);var e=0,j=0;l<0&&(e=-l,l=0);c<0&&(j=-c,c=0);if(!(l>=this.width||c>=this.height)){a=k[a];if(a==void 0||a==null)return this;var h=m(this.width,b.width-e),t=m(this.height,b.height-j),z=this.context.getImageData(l,c,h,t),e=b.context.getImageData(e,j,h,t),b=z.data,e=e.data,u,s,p,q=1-d,n=e.length,o;for(o=0;o<n;o+=4)u=b[o],s=b[o+1],p=b[o+2],j=a(e[o],u),h=a(e[o+1],s),t=a(e[o+2],p),b[o]=j*d+u*q,b[o+1]=h*d+s*q,b[o+2]=t*d+p*q;this.context.putImageData(z,l,c);this._integralRefresh=this._histogramRefresh=
!0;return this}},_refresh:function(){this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);return this},clone:function(){return new c.Image(this.canvasElement)},integral:function(){this._integralRefresh&&this._computeIntegral();return this._integral},_computeIntegral:function(){var b=this.width,a=this.height,d=new c.Array32U(b*a),l=this.getPixelData().data,g,e,j,m,k;for(m=j=e=g=0;g<b;)ii=g+j,k=ii<<2,k=4899*l[k]+9617*l[k+1]+1868*l[k+2]+
8192>>>14,m+=(k&255)>>>0,d[ii]=g>0?d[ii-1]+m:m,e++,j+=b,a==e&&(g++,m=j=e=0);this._integral=d;this._integralRefresh=!1},histogram:function(){this._histogramRefresh&&this._computeHistogram();return this._histogram},_computeHistogram:function(){for(var b=this.getPixelData().data,a=0,d=b.length,l,g,e,m=0,h=0,k=0,z=255,u=255,s=255,p=new c.Array32F(256),q=new c.Array32F(256),n=new c.Array32F(256),o=1/(d>>2),a=0;a<256;)p[a]=0,q[a]=0,n[a]=0,a++;for(a=0;a<d;)l=b[a],g=b[a+1],e=b[a+2],p[l]+=o,q[g]+=o,n[e]+=
o,l>m&&(m=l),l<z&&(z=l),g>h&&(h=g),g<u&&(u=g),e>k&&(k=e),e<s&&(s=e),a+=4;this._histogram=[p,q,n];this._histogramRefresh=!1},createImageData:function(b,a){this.width=b;this.height=a;this._tmpCanvas.width=this.canvasElement.width=this.width;this._tmpCanvas.height=this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.context.createImageData(b,a);return this.imageData=this.context.getImageData(0,0,this.width,this.height)},scale:function(b,a){var b=b||1,a=a||b,d=this._tmpCanvas.getContext("2d");
d.scale(b,a);d.drawImage(this.canvasElement,0,0);this.canvasElement.width=this.width=~~(b*this.width+0.5);this.canvasElement.height=this.height=~~(a*this.height+0.5);this.context.drawImage(this._tmpCanvas,0,0);this._tmpCanvas.width=this.width;this._tmpCanvas.height=this.height;this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},flipHorizontal:function(){var b=this._tmpCanvas.getContext("2d");b.translate(this.width,0);b.scale(-1,
1);b.drawImage(this.canvasElement,0,0);this.context.drawImage(this._tmpCanvas,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},flipVertical:function(){var b=this._tmpCanvas.getContext("2d");b.translate(0,this.height);b.scale(1,-1);b.drawImage(this.canvasElement,0,0);this.context.drawImage(this._tmpCanvas,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=
!0;return this}}})(FILTER);
(function(c){function k(a,b){var a=a||{},c;for(c in b)b&&Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);return a}c.Array32F=typeof Float32Array!=="undefined"?Float32Array:Array;c.Array64F=typeof Float64Array!=="undefined"?Float64Array:Array;c.Array8I=typeof Int8Array!=="undefined"?Int8Array:Array;c.Array16I=typeof Int16Array!=="undefined"?Int16Array:Array;c.Array32I=typeof Int32Array!=="undefined"?Int32Array:Array;c.Array8U=typeof Uint8Array!=="undefined"?Uint8Array:Array;c.Array16U=typeof Uint16Array!==
"undefined"?Uint16Array:Array;c.Array32U=typeof Uint32Array!=="undefined"?Uint32Array:Array;c.ImArray=typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:c.Array8U;c.CONSTANTS={SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI};c.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3};c.LUMA=new c.Array32F([0.212671,0.71516,0.072169]);c.Filter=function(){};c.Filter.prototype={_apply:function(){},apply:function(){},reset:function(){}};c.CompositeFilter=function(a){this._stack=typeof a!="undefined"&&a.length?
a:[]};c.CompositeFilter.prototype={_stack:[],_apply:function(a,b,c){if(!this._stack.length)return a;for(var g=this._stack,e=g.length,m=0,h;m<e;)(h=g[m++])&&(a=h._apply(a,b,c));return a},apply:function(a){if(!this._stack.length)return a;return a.setData(this._apply(im=a.getData(),a.width,a.height))},filters:function(a){if(a)this._stack=a;return this},push:function(a){this._stack.push(a);return this},pop:function(){return this._stack.pop()},shift:function(a){this._stack.shift(a);return this},unshift:function(){return this._stack.unshift()},
concat:function(a){return this.push(a)},remove:function(a){for(var b=this._stack.length;--b>=0;)a===this._stack[b]&&this._stack.splice(b,1);return this},reset:function(){this._stack.length=0;return this}};c.Create=function(a){var b=function(){this.init.apply(this,Array.prototype.slice.call(arguments))},a=k({init:function(){},reset:function(){return this},apply:function(a){return a}},a);a._apply=a.apply;a.apply=function(a){return a.setData(this._apply(a.getData(),a.width,a.height))};b.prototype=k(b.prototype,
a);return b};var m=null,b=null;c.static={createImageData:function(a,d){m||(m=document.createElement("canvas"),b=m.getContext("2d"));return b.createImageData(a,d)}}})(FILTER);
(function(c){var k=Math.sqrt;c.Color={blend:function(c,b,a){return{red:c.red-~~((c.red-b.red)*a+0.5),green:c.green-~~((c.green-b.green)*a+0.5),blue:c.blue-~~((c.blue-b.blue)*a+0.5)}},toGray:function(m,b,a){return~~(c.LUMA[0]*m+c.LUMA[1]*b+c.LUMA[2]*a)},distance:function(c,b){var a=c.red-b.red,d=c.green-b.green,l=c.blue-b.blue;return k(a*a+d*d+l*l)},RGB2Color:function(c){return(c.red<<16)+(c.green<<8)+c.blue},RGBA2Color:function(c){return(c.alpha<<24)+(c.red<<16)+(c.green<<8)+c.blue},Color2RGBA:function(c){c=
~~c;return{red:c>>16&255,green:c>>8&255,blue:c&255,alpha:c>>24&255}},RGB2YCbCr:function(c){var b=c.red,a=c.green,c=c.blue;return{Y:~~(0.299*b+0.587*a+0.114*c),Cb:~~(128-0.169*b-0.331*a+0.5*c),Cr:~~(128+0.5*b-0.42*a-0.08*c)}},YCbCr2RGB:function(c){var b=c.Y,a=c.Cb,c=c.Cr;return{red:~~(b+1.4*(c-128)),green:~~(b-0.343*(a-128)-0.711*(c-128)),blue:~~(b+1.765*(a-128))}},RGB2HSV:function(c){var b=c.red*0.00392156862745098,a=c.green*0.00392156862745098,d=c.blue*0.00392156862745098,l;l=b<a?b<d?b:d:a<d?a:d;
c=b>a?b>d?b:d:a>d?a:d;if(l==c)return{H:NaN,S:0,V:c};b=((b==l?3:a==l?5:1)-(b==l?a-d:a==l?d-b:b-a)/(c-l))*60;b>=360?b-=360:b<0&&(b+=360);$=(c-l)/c;return{H:b,S:void 0,V:c}}}})(FILTER);(function(c){c.CustomFilter=function(c){this._handler=c};c.CustomFilter.prototype={_handler:null,_apply:function(c,m,b){if(!this._handler)return c;return this._handler.call(this,c,m,b)},apply:function(c){if(!this._handler)return c;return c.setData(this._handler.call(this,c.getData(),c.width,c.height))}}})(FILTER);
(function(c){var k=c.Array32F,m=c.CONSTANTS.toRad;c.ColorMatrixFilter=function(b){this.matrix=typeof b!="undefined"&&b.length?new k(b):null};c.ColorMatrixFilter.prototype={matrix:null,channel:function(b,a){var d=(typeof a=="undefined"?0:a)?1:0;switch(b){case c.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case c.CHANNEL.BLUE:return this.concat([0,0,d,0,0,0,0,d,0,0,0,0,1,0,0,0,0,0,0,255]);case c.CHANNEL.GREEN:return this.concat([0,d,0,0,0,0,1,0,0,0,0,d,0,0,0,0,0,0,0,
255]);default:return this.concat([1,0,0,0,0,d,0,0,0,0,d,0,0,0,0,0,0,0,0,255])}},redChannel:function(b){return this.channel(c.CHANNEL.RED,b)},greenChannel:function(b){return this.channel(c.CHANNEL.GREEN,b)},blueChannel:function(b){return this.channel(c.CHANNEL.BLUE,b)},alphaChannel:function(){return this.channel(c.CHANNEL.ALPHA,!0)},maskChannel:function(b){switch(b){case c.CHANNEL.ALPHA:return this;case c.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this.concat([1,
0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this.concat([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(b,a){switch(b){case c.CHANNEL.ALPHA:switch(a){case c.CHANNEL.ALPHA:return this;case c.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case c.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);default:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}case c.CHANNEL.BLUE:switch(a){case c.CHANNEL.ALPHA:return this.concat([1,
0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case c.CHANNEL.BLUE:return this;case c.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);default:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}case c.CHANNEL.GREEN:switch(a){case c.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case c.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this;default:return this.concat([0,1,0,0,0,1,0,0,0,0,
0,0,1,0,0,0,0,0,1,0])}default:switch(a){case c.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case c.CHANNEL.BLUE:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this}}},desaturate:function(){return this.concat([c.LUMA[0],c.LUMA[1],c.LUMA[2],0,0,c.LUMA[0],c.LUMA[1],c.LUMA[2],0,0,c.LUMA[0],c.LUMA[1],c.LUMA[2],0,0,0,0,0,1,0])},grayscale:function(){return this.desaturate()},
colorize:function(b,a){var d,l,g,e;typeof a=="undefined"&&(a=1);d=(b>>16&255)*0.00392156862745098;l=(b>>8&255)*0.00392156862745098;g=(b&255)*0.00392156862745098;e=1-a;return this.concat([e+a*d*c.LUMA[0],a*d*c.LUMA[1],a*d*c.LUMA[2],0,0,a*l*c.LUMA[0],e+a*l*c.LUMA[1],a*l*c.LUMA[2],0,0,a*g*c.LUMA[0],a*g*c.LUMA[1],e+a*g*c.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,
1,0,0,0,0,0,-1,255])},saturate:function(b){var a,d,l;a=1-b;d=a*c.LUMA[0];l=a*c.LUMA[1];a*=c.LUMA[2];return this.concat([d+b,l,a,0,0,d,l+b,a,0,0,d,l,a+b,0,0,0,0,0,1,0])},contrast:function(b,a,d){typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);b+=1;a+=1;d+=1;return this.concat([b,0,0,0,128*(1-b),0,a,0,0,128*(1-a),0,0,d,0,128*(1-d),0,0,0,1,0])},brightness:function(b,a,d){typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);return this.concat([1,0,0,0,b,0,1,0,0,a,0,0,1,0,d,0,0,0,1,0])},
adjustHue:function(b){b*=m;var a=Math.cos(b),b=Math.sin(b);return this.concat([c.LUMA[0]+a*(1-c.LUMA[0])+b*-c.LUMA[0],c.LUMA[1]+a*-c.LUMA[1]+b*-c.LUMA[1],c.LUMA[2]+a*-c.LUMA[2]+b*(1-c.LUMA[2]),0,0,c.LUMA[0]+a*-c.LUMA[0]+b*0.143,c.LUMA[1]+a*(1-c.LUMA[1])+b*0.14,c.LUMA[2]+a*-c.LUMA[2]+b*-0.283,0,0,c.LUMA[0]+a*-c.LUMA[0]+b*-(1-c.LUMA[0]),c.LUMA[1]+a*-c.LUMA[1]+b*c.LUMA[1],c.LUMA[2]+a*(1-c.LUMA[2])+b*c.LUMA[2],0,0,0,0,0,1,0])},average:function(b,a,d){typeof b=="undefined"&&(b=0.3333);typeof a=="undefined"&&
(a=0.3333);typeof d=="undefined"&&(d=0.3334);return this.concat([b,a,d,0,0,b,a,d,0,0,b,a,d,0,0,0,0,0,1,0])},quickContrastCorrection:function(b){typeof b=="undefined"&&(b=1.2);return this.concat([b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0])},quickSepia:function(b){typeof b=="undefined"&&(b=10);b>100&&(b=100);b*=2.55;return this.concat([c.LUMA[0],c.LUMA[1],c.LUMA[2],0,40,c.LUMA[0],c.LUMA[1],c.LUMA[2],0,20,c.LUMA[0],c.LUMA[1],c.LUMA[2],0,-b,0,0,0,1,0])},quickSepia2:function(b,a,d){typeof b=="undefined"&&
(b=1);typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);return this.concat([b*0.5,0.5,0.5,0,0,0.33,a*0.33,0.33,0,0,0.25,0.25,d*0.25,0,0,0,0,0,1,0])},threshold:function(b,a){typeof a=="undefined"&&(a=256);return this.concat([c.LUMA[0]*a,c.LUMA[1]*a,c.LUMA[2]*a,0,-(a-1)*b,c.LUMA[0]*a,c.LUMA[1]*a,c.LUMA[2]*a,0,-(a-1)*b,c.LUMA[0]*a,c.LUMA[1]*a,c.LUMA[2]*a,0,-(a-1)*b,0,0,0,1,0])},threshold_rgb:function(b,a){typeof a=="undefined"&&(a=256);return this.concat([a,0,0,0,-(a-1)*b,0,a,0,0,-(a-1)*b,0,
0,a,0,-(a-1)*b,0,0,0,1,0])},threshold_alpha:function(b,a){typeof b=="undefined"&&(b=0.5);typeof a=="undefined"&&(a=256);return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,a,-a*b])},blend:function(b,a){var d;if(this.matrix){d=this.matrix;for(var c=b.matrix,g=1-a,e=0,j=new k(20);e<20;)j[e]=g*d[e]+a*c[e],e++;d=j}else d=new k(b.matrix);this.matrix=d;return this},concat:function(b){var a;if(this.matrix){a=this.matrix;var b=new k(b),d=new k(20),c,g,e,j,h;c=b[0];g=b[1];e=b[2];j=b[3];h=b[4];d[0]=c*a[0]+
g*a[5]+e*a[10]+j*a[15];d[1]=c*a[1]+g*a[6]+e*a[11]+j*a[16];d[2]=c*a[2]+g*a[7]+e*a[12]+j*a[17];d[3]=c*a[3]+g*a[8]+e*a[13]+j*a[18];d[4]=c*a[4]+g*a[9]+e*a[14]+j*a[19]+h;c=b[5];g=b[6];e=b[7];j=b[8];h=b[9];d[5]=c*a[0]+g*a[5]+e*a[10]+j*a[15];d[6]=c*a[1]+g*a[6]+e*a[11]+j*a[16];d[7]=c*a[2]+g*a[7]+e*a[12]+j*a[17];d[8]=c*a[3]+g*a[8]+e*a[13]+j*a[18];d[9]=c*a[4]+g*a[9]+e*a[14]+j*a[19]+h;c=b[10];g=b[11];e=b[12];j=b[13];h=b[14];d[10]=c*a[0]+g*a[5]+e*a[10]+j*a[15];d[11]=c*a[1]+g*a[6]+e*a[11]+j*a[16];d[12]=c*a[2]+
g*a[7]+e*a[12]+j*a[17];d[13]=c*a[3]+g*a[8]+e*a[13]+j*a[18];d[14]=c*a[4]+g*a[9]+e*a[14]+j*a[19]+h;c=b[15];g=b[16];e=b[17];j=b[18];h=b[19];d[15]=c*a[0]+g*a[5]+e*a[10]+j*a[15];d[16]=c*a[1]+g*a[6]+e*a[11]+j*a[16];d[17]=c*a[2]+g*a[7]+e*a[12]+j*a[17];d[18]=c*a[3]+g*a[8]+e*a[13]+j*a[18];d[19]=c*a[4]+g*a[9]+e*a[14]+j*a[19]+h;a=d}else a=new k(b);this.matrix=a;return this},_apply:function(b){if(!this.matrix)return b;for(var a=b.length,d=this.matrix,c=0,g,e,j,h;c<a;)g=b[c],e=b[c+1],j=b[c+2],h=b[c+3],b[c]=d[0]*
g+d[1]*e+d[2]*j+d[3]*h+d[4],b[c+1]=d[5]*g+d[6]*e+d[7]*j+d[8]*h+d[9],b[c+2]=d[10]*g+d[11]*e+d[12]*j+d[13]*h+d[14],b[c+3]=d[15]*g+d[16]*e+d[17]*j+d[18]*h+d[19],c+=4;return b},apply:function(b){if(!this.matrix)return b;return b.setData(this._apply(b.getData(),b.width,b.height))},reset:function(){this.matrix=null;return this}}})(FILTER);
(function(c){function k(a){if(a)return new c.ImArray(a);return null}var m=Math.pow,b=Math.exp,a=1/255;c.TableLookupFilter=function(a,b,c){this.tableR=a||null;this.tableG=b||k(this.tableR);this.tableB=c||k(this.tableG)};c.TableLookupFilter.prototype={tableR:null,tableG:null,tableB:null,thresholds:function(a){a.length||(a=[a]);var b=a.length,g=b+1,e=new c.ImArray(256),j=new c.ImArray(g),h,k=255/(g-1);for(h=0;h<g;)j[h]=~~(k*h),h++;a[0]=~~(255*a[0]);for(h=1;h<b;)a[h]=a[h-1]+~~(255*a[h]),h++;for(h=0;h<
256;){for(g=0;g<b&&h>a[g];)g++;e[h]=j[g];h++}return this.concat(e)},threshold:function(a){return this.thresholds([a||0.5])},quantize:function(a){typeof a=="undefined"&&(a=64);a<2&&(a=2);var b=new c.ImArray(256),g=new c.ImArray(a),e,j=255/(a-1),h=a/256;for(e=0;e<a;)g[e]=~~(j*e),e++;for(e=0;e<256;)b[e]=g[~~(h*e)],e++;return this.concat(b)},levels:function(a){return this.quantize(a)},posterize:function(a){return this.quantize(a)},binarize:function(){return this.quantize(2)},solarize:function(a){typeof a==
"undefined"&&(a=0.5);for(var b=0,g=new c.ImArray(256),a=~~(a*256)-1,b=0;b<256;)g[b]=b>a?255-(b<<1):(b<<1)-255,b++;return this.concat(g)},invert:function(){for(var a=0,b=new c.ImArray(256),a=0;a<256;)b[a]=255-a,a++;return this.concat(b)},mask:function(a){var b=0,g=a>>16&255,e=a>>8&255;a&=255;tR=new c.ImArray(256);tG=new c.ImArray(256);tB=new c.ImArray(256);for(b=0;b<256;)tR[b]=b&g,tG[b]=b&e,tB[b]=b&a,b++;return this.concat(tR,tG,tB)},gammaCorrection:function(b,l,g){for(var b=b||1,l=l||b,g=g||l,b=1/
b,l=1/l,g=1/g,e=new c.ImArray(256),j=new c.ImArray(256),h=new c.ImArray(256),k=0;k<256;)e[k]=~~(255*m(a*k,b)),j[k]=~~(255*m(a*k,l)),h[k]=~~(255*m(a*k,g)),k++;return this.concat(e,j,h)},exposure:function(d){typeof d=="undefined"&&(d=1);for(var l=0,g=new c.ImArray(256),l=0;l<256;)g[l]=~~(255*(1-b(-d*l*a))),l++;return this.concat(g)},concat:function(a,b,g){if(!a)return this;var b=b||a,g=g||b,e;if(!(e=this.tableR)){e=new c.ImArray(256);for(var j=0;j<256;)e[j]=j,j++}var j=this.tableG||k(e),h=this.tableB||
k(j),m=k(e),z=k(j),u=k(h),s;for(s=0;s<256;)e[s]=a[m[s]],j[s]=b[z[s]],h[s]=g[u[s]],s++;this.tableR=e;this.tableG=j;this.tableB=h;return this},_apply:function(a){if(!this.tableR)return a;for(var b=a.length,c=0,e,j,h,k=this.tableR,z=this.tableG,u=this.tableB;c<b;)e=a[c],j=a[c+1],h=a[c+2],a[c]=k[e],a[c+1]=z[j],a[c+2]=u[h],c+=4;return a},apply:function(a){if(!this.tableR)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this.tableB=this.tableG=this.tableR=null;return this}}})(FILTER);
(function(c){c.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4};var k=Math.min;c.DisplacementMapFilter=function(c){this.map=c||null};c.DisplacementMapFilter.prototype={scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:c.MODE.CLAMP,map:null,_apply:function(m,b,a){if(!this.map)return m;var d=this.map.getData(),l=this.map.width,g=this.map.height,e=k(l,b),g=k(g,a),j=this.scaleX*0.00390625,h=this.scaleY*0.00390625,t=this.color>>24&255,z=this.color>>16&255,u=this.color>>8&255,s=this.color&
255,p=~~this.startY,q=~~this.startX,n=this.componentX,o=this.componentY,A=this.mode,v,D,w,x,r,B,y,H,I,E=p*b,C=new c.ImArray(m.length);for(y=I=H=0;y<g;y++){D=y+p;if(D>=0&&D<a)for(B=0;B<e;B++)if(v=B+q,!(v<0||v>=b)){w=I+E+v<<2;x=H+B<<2;r=D+~~((d[x+o]-128)*h);v+=~~((d[x+n]-128)*j);if(r>=a||r<0||v>=b||v<0)switch(A){case c.MODE.IGNORE:continue;case c.MODE.COLOR:C[w]=z;C[w+1]=u;C[w+2]=s;C[w+3]=t;continue;case c.MODE.WRAP:r>=a&&(r-=a);r<0&&(r+=a);v>=b&&(v-=b);v<0&&(v+=b);break;default:r>=a&&(r=a-1),r<0&&
(r=0),v>=b&&(v=b-1),v<0&&(v=0)}r=r*b+v<<2;C[w]=m[r];C[w+1]=m[r+1];C[w+2]=m[r+2];C[w+3]=m[r+3]}H+=l;I+=b}return C},apply:function(c){if(!this.map)return c;return c.setData(this._apply(c.getData(),c.width,c.height))},reset:function(){this.map=null;return this}}})(FILTER);
(function(c){function k(a){var b=h.length,c,d;a--;if(a<b)c=h[a].slice();else for(c=new j(h[b-1]);b<=a;){d=c.slice();c=[1];i=0;for(il=d.length-1;i<il;i++)c.push(d[i]+d[i+1]);c.push(1);b<12&&h.push(c.slice());b++}return c}function m(a){var b,c=-(a>>1),d=Array(a);for(b=0;b<a;b++)d[b]=c,c++;return d}function b(a,c){var d,e,g=a.length,j,h=[],l=0;if(typeof a[0].length=="undefined")for(d=0;d<g;d++)for(e=0;e<g;e++)j=a[d]*c[e],l+=j,h.push(j);else for(d=0;d<g;d++)for(e=0;e<g;e++)j=b(a[d],c[e]),l+=j.sum,h=h.concat(j.ker);
return{kernel:h,sum:l}}function a(a){a=k(a);return b(a,a)}function d(a,c){var d=k(a),e=m(a);return 1==c?b(e.reverse(),d):b(d,e)}function l(a,c){var d,e=Array(a);for(d=0;d<a;d++)e[d]=1;d=m(a);return 1==c?b(d.reverse(),e):b(e,d)}function g(a,b,c,d){var e=a.length,g,h=new j(a.length),c=c||1,d=d||1;for(g=0;g<e;g++)h[g]=c*a[g]+d*b[g];return h}function e(a,b){var b=b||1,c=a*a,d,e=new j(c);for(d=0;d<c;d++)e[d]=b;return e}var j=c.Array32F,h=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,
20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],t=c.CONSTANTS.toRad;c.ConvolutionMatrixFilter=function(a,b){this.factor=b||1;typeof a!="undefined"&&a.length?(this.matrix=new j(a),this.dim=~~(Math.sqrt(a.length)+0.5)):(this.matrix=null,this.dim=0);this.auxMatrix=null;this._isGrad=!1};c.ConvolutionMatrixFilter.prototype={dim:0,matrix:null,factor:1,lowPass:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(e(a),1/(a*a),a)},highPass:function(a,b){var a=typeof a=="undefined"?3:
a%2?a:a+1,c=a*a,d=-(typeof b=="undefined"?1:b)/c,g=e(a,d);g[c>>2]=1+d;return this.set(g,1,a)},boxBlur:function(a){return this.lowPass(a)},binomialLowPass:function(b){var b=typeof b=="undefined"?3:b%2?b:b+1,c=a(b);return this.set(new j(c.kernel),1/c.sum,b)},binomialHighPass:function(b){var b=typeof b=="undefined"?3:b%2?b:b+1,c=a(b);return this.set(g(e(b),new j(c.kernel),1,-1/c.sum),1,b)},gaussBlur:function(a){return this.binomialLowPass(a)},sharpen:function(a,b){b=typeof b=="undefined"?0.5:b;return b<=
0?this.set([0,-2,0,-2,10,-2,0,-2,0],0.5,3):this.highPass(a,b)},prewittX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=l(a,0);return this.set(new j(b.kernel),1,a)},prewittY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=l(a,1);return this.set(new j(b.kernel),1,a)},prewittDirectional:function(a,b){a=typeof a=="undefined"?3:a%2?a:a+1;b*=t;var c=Math.cos(b),d=Math.sin(b),e=l(a,0),h=l(a,1);return this.set(g(new j(e.kernel),new j(h.kernel),c,d),1,a)},prewitt:function(a){var a=typeof a=="undefined"?
3:a%2?a:a+1,b=l(a,0),c=l(a,1);this.set(new j(b.kernel),1,a);this._isGrad=!0;this.auxMatrix=new j(c.kernel);return this},gradX:function(a){return this.prewittX(a)},gradY:function(a){return this.prewittY(a)},gradDirectional:function(a,b){return this.prewittDirectional(a,b)},grad:function(a){return this.prewitt(a)},sobelX:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=d(a,0);return this.set(new j(b.kernel),1,a)},sobelY:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=d(a,1);return this.set(new j(b.kernel),
1,a)},sobelDirectional:function(a,b){a=typeof a=="undefined"?3:a%2?a:a+1;b*=t;var c=Math.cos(b),e=Math.sin(b),h=d(a,0),l=d(a,1);return this.set(g(new j(h.kernel),new j(l.kernel),c,e),1,a)},sobel:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=d(a,0),c=d(a,1);this.set(new j(b.kernel),1,a);this.auxMatrix=new j(c.kernel);this._isGrad=!0;return this},laplace:function(){return this.set([0,-1,0,-1,4,-1,0,-1,0],1,3)},emboss:function(a,b){var b=1,c=(typeof a=="undefined"||a!=1&&a!=-1?1:a)*b;return this.set([-c*
2,-c*1,0,-c*1,b*1,c*1,0,c*1,c*2],1,3)},embossHigh:function(){return this.emboss(1)},embossLow:function(){return this.emboss(-1)},edges:function(){return this.set([0,1,0,1,-4,1,0,1,0],1,3)},edges2:function(){return this.set([0,2,0,2,-8,2,0,2,0],0.5,3)},motionblur:function(a){var b=new j(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);if(a==0)for(a=0;a<9;a++)b[36+a]=1;else if(a==2)for(a=
0;a<9;a++)b[9*a+5]=1;else if(a==1)for(a=0;a<9;a++)b[9*a+a]=1;return this.set(b,1/9,9)},set:function(a,b,c){this.matrix=new j(a);this.factor=b;this.dim=c;this.auxMatrix=null;this._isGrad=!1;return this},_apply:function(a,b,d){if(!this.matrix)return a;var e=this.dim,g=e>>1,h=new c.ImArray(a.length),j,l,k,m,t,x=0,r=0,B=0,y=0,H=0,I=0,E,C,F,G,K,L,M,J=Math.abs;for(l=L=0;l<d;l++){for(j=0;j<b;j++){m=l;k=j;t=L+j<<2;for(C=I=H=y=K=B=r=x=0;C<e;C++){E=m+C-g;if(E>=0&&E<d){M=E*b;for(E=0;E<e;E++)F=k+E-g,F>=0&&F<
b&&(F=M+F<<2,G=this.matrix[K+E],x+=a[F]*G,r+=a[F+1]*G,B+=a[F+2]*G,this.auxMatrix&&(G=this.auxMatrix[K+E],y+=a[F]*G,H+=a[F+1]*G,I+=a[F+2]*G))}K+=e}this._isGrad?(h[t]=this.factor*(J(x)+J(y)),h[t+1]=this.factor*(J(r)+J(H)),h[t+2]=this.factor*(J(B)+J(I))):(h[t]=this.factor*x,h[t+1]=this.factor*r,h[t+2]=this.factor*B);h[t+3]=a[t+3]}L+=b}return h},apply:function(a){if(!this.matrix)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this.auxMatrix=this.matrix=null;this.dim=
0;return this}}})(FILTER);
(function(c){var k=function(a,b,g){var e=this.dim,j=e>>1,h=e*e,k=new c.ImArray(a.length),m,u,s,p,q,n,o,A,v,D,w,x,r,B,y;w=[];x=[];r=[];B=h%2;y=~~(0.5*h)+B;for(m=v=0;m<g;m++){for(h=0;h<b;h++){s=m;u=h;p=v+h<<2;w.length=0;x.length=0;for(n=A=r.length=0;n<e;n++){q=s+n-j;if(q>=0&&q<g){D=q*b;for(q=0;q<e;q++)o=u+q-j,o>=0&&o<b&&(o=D+o<<2,w.push(a[o]),x.push(a[o+1]),r.push(a[o+2]))}A+=e}w.sort();x.sort();r.sort();B?(k[p]=w[y],k[p+1]=x[y],k[p+2]=r[y]):(k[p]=~~(0.5*(w[y]+w[y+1])),k[p+1]=~~(0.5*(x[y]+x[y+1])),
k[p+2]=~~(0.5*(r[y]+r[y+1])));k[p+3]=a[p+3]}v+=b}return k},m=function(a,b,g){var e=this.dim,j=e>>1,h=new c.ImArray(a.length),k,m,u,s,p,q,n,o,A,v,D,w,x,r;for(m=v=0;m<g;m++){for(k=0;k<b;k++){s=m;u=k;p=v+k<<2;for(n=A=r=x=w=0;n<e;n++){q=s+n-j;if(q>=0&&q<g){D=q*b;for(q=0;q<e;q++)o=u+q-j,o>=0&&o<b&&(o=D+o<<2,a[o]>w&&(w=a[o]),a[o+1]>x&&(x=a[o+1]),a[o+2]>r&&(r=a[o+2]))}A+=e}h[p]=w;h[p+1]=x;h[p+2]=r;h[p+3]=a[p+3]}v+=b}return h},b=function(a,b,g){var e=this.dim,j=e>>1,h=new c.ImArray(a.length),k,m,u,s,p,q,
n,o,A,v,D,w,x,r;for(m=v=0;m<g;m++){for(k=0;k<b;k++){s=m;u=k;p=v+k<<2;r=x=w=255;for(n=A=0;n<e;n++){q=s+n-j;if(q>=0&&q<g){D=q*b;for(q=0;q<e;q++)o=u+q-j,o>=0&&o<b&&(o=D+o<<2,a[o]<w&&(w=a[o]),a[o+1]<x&&(x=a[o+1]),a[o+2]<r&&(r=a[o+2]))}A+=e}h[p]=w;h[p+1]=x;h[p+2]=r;h[p+3]=a[p+3]}v+=b}return h},a=function(a){return a};c.NonLinearFilter=function(){this.dim=0;this._apply=a};c.NonLinearFilter.prototype={dim:0,median:function(a){this.dim=typeof a=="undefined"?3:a%2?a:a+1;this._apply=k;return this},erode:function(a){this.dim=
typeof a=="undefined"?3:a%2?a:a+1;this._apply=b;return this},dilate:function(a){this.dim=typeof a=="undefined"?3:a%2?a:a+1;this._apply=m;return this},_apply:function(a){return a},apply:function(a){if(!this.dim)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this._apply=a;this.dim=0;return this}}})(FILTER);
(function(c){c.HistogramEqualizeFilter=c.Create({apply:function(k){var m,b,a,d;d=0;var l=255,g=new c.Array32F(256),e=new c.Array32F(256),j=0,h,t=k.length,z=1/(t>>2),u=Array(t>>2),s=c.Color.RGB2YCbCr,p=c.Color.YCbCr2RGB;for(h=0;h<256;)g[h]=0,e[h]=0,h++;for(j=h=0;h<t;){m=k[h];b=k[h+1];a=k[h+2];m=s({red:m,green:b,blue:a});g[m.Y]+=z;if(m.Y>d)d=m.Y;if(m.Y<l)l=m.Y;u[j]=m;h+=4;j++}for(h=j=0;h<256;)j+=g[h],e[h]=j,h++;d-=l;for(j=h=0;h<t;)m=u[j],m.Y=e[m.Y]*d+l,g=p(m),k[h]=g.red,k[h+1]=g.green,k[h+2]=g.blue,
h+=4,j++;return k}})})(FILTER);
(function(c){c.RGBHistogramEqualizeFilter=c.Create({init:function(){},apply:function(k){var m,b,a,d,l,g;g=l=d=0;var e=255,j=255,h=255,t=new c.Array32F(256),z=new c.Array32F(256),u=new c.Array32F(256),s=new c.Array32F(256),p=new c.Array32F(256),q=new c.Array32F(256),n,o=k.length,A=1/(o>>2);for(n=0;n<256;)t[n]=0,z[n]=0,u[n]=0,s[n]=0,p[n]=0,q[n]=0,n++;for(n=0;n<o;)m=k[n],b=k[n+1],a=k[n+2],t[m]+=A,z[b]+=A,u[a]+=A,m>d&&(d=m),m<e&&(e=m),b>l&&(l=b),b<j&&(j=b),a>g&&(g=a),a<h&&(h=a),n+=4;for(n=m=b=a=0;n<256;)m+=
t[n],s[n]=m,b+=z[n],p[n]=b,a+=u[n],q[n]=a,n++;d-=e;l-=j;g-=h;for(n=0;n<o;)m=k[n],b=k[n+1],a=k[n+2],k[n]=s[m]*d+e,k[n+1]=p[b]*l+j,k[n+2]=q[a]*g+h,n+=4;return k}})})(FILTER);(function(c){c.NoiseFilter=c.Create({min:-127,max:127,init:function(c,m){this.min=c||-127;this.max=m||127},apply:function(c){var m=this.max-this.min,b=Math.random,a=this.min,d,l=c.length,g,e,j,h;for(d=0;d<l;)e=c[d],j=c[d+1],h=c[d+2],g=m*b()+a,c[d]=e+g,c[d+1]=j+g,c[d+2]=h+g,d+=4;return c}})})(FILTER);
