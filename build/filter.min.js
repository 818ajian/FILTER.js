/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.5
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/var FILTER=FILTER||{};
(function(d){var n,l=Math.min;n={normal:function(c){return c},lighten:function(c,a){return a>c?a:c},darken:function(c,a){return a>c?c:a},multiply:function(c,a){return c*a*0.003921568627451},average:function(c,a){return 0.5*(c+a)},add:function(c,a){return Math.min(255,c+a)},substract:function(c,a){return c+a<255?0:c+a-255},difference:function(c,a){return Math.abs(c-a)},negation:function(c,a){return 255-Math.abs(255-c-a)},screen:function(c,a){return 255-((255-c)*(255-a)>>8)},exclusion:function(c,a){return c+
a-2*c*a*0.003921568627451},overlay:function(c,a){return a<128?2*c*a*0.003921568627451:255-2*(255-c)*(255-a)*0.003921568627451},softLight:function(c,a){return a<128?2*((c>>1)+64)*a*0.003921568627451:255-2*(255-((c>>1)+64))*(255-a)*0.003921568627451},hardLight:function(c,a){return c<128?2*a*c*0.003921568627451:255-2*(255-a)*(255-c)*0.003921568627451},colorDodge:function(c,a){return a==255?a:Math.min(255,(c<<8)/(255-a))},colorBurn:function(c,a){return a==0?a:Math.max(0,255-(255-c<<8)/a)},linearLight:function(c,
a){return a<128?n.linearBurn(c,2*a):n.linearDodge(c,2*(a-128))},vividLight:function(c,a){return a<128?n.colorBurn(c,2*a):n.colorDodge(c,2*(a-128))},pinLight:function(c,a){return a<128?n.darken(c,2*a):n.lighten(c,2*(a-128))},hardMix:function(c,a){return n.vividLight(c,a)<128?0:255},reflect:function(c,a){return a==255?a:Math.min(255,c*c/(255-a))},glow:function(c,a){return c==255?c:Math.min(255,a*a/(255-c))},phoenix:function(c,a){return Math.min(c,a)-Math.max(c,a)+255}};n.linearDodge=n.add;n.linearBurn=
n.substract;d.blendModes=n;d.Image=function(c,a){this.height=this.width=0;this.imageData=this.context=null;this.canvasElement=document.createElement("canvas");this.canvasElement.width=0;this.canvasElement.height=0;this._tmpCanvas=document.createElement("canvas");this._tmpCanvas.width=0;this._tmpCanvas.height=0;this.context=this.canvasElement.getContext("2d");this._integral=this._histogram=null;this._integralRefresh=this._histogramRefresh=!0;this.setImage(c,a)};d.Image.prototype={width:0,height:0,
canvasElement:null,getPixel:function(c,a){var e=~~(a*this.width+c+0.5);return{red:this.imageData.data[e],green:this.imageData.data[e+1],blue:this.imageData.data[e+2],alpha:this.imageData.data[e+3]}},setPixel:function(c,a,e,h,m,j){this.context.putImageData(new d.ImArray([e,h,m,j]),c,a);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},getData:function(){return new d.ImArray(this.imageData.data)},setData:function(c){this.imageData.data.set(c);
this.context.putImageData(this.imageData,0,0);this._integralRefresh=this._histogramRefresh=!0;return this},getPixelData:function(){return this.imageData},setPixelData:function(c){this.context.putImageData(c,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setWidth:function(c){this._tmpCanvas.width=this.canvasElement.width=this.width=c;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,
0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setHeight:function(c){this._tmpCanvas.height=this.canvasElement.height=this.height=c;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setImage:function(c,a){if(typeof c=="undefined"||c==null)return this;var e=this,d;c instanceof Image||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement?
(d=c,this.width=c instanceof HTMLVideoElement?c.videoWidth:c.width,this.height=c instanceof HTMLVideoElement?c.videoHeight:c.height,this._tmpCanvas.width=this.canvasElement.width=this.width,this._tmpCanvas.height=this.canvasElement.height=this.height,this.context=this.canvasElement.getContext("2d"),this.context.drawImage(d,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._integralRefresh=this._histogramRefresh=!0):(d=new Image,d.onload=function(){e.width=d.width;e.height=
d.height;e._tmpCanvas.width=e.canvasElement.width=e.width;e._tmpCanvas.height=e.canvasElement.height=e.height;e.context=e.canvasElement.getContext("2d");e.context.drawImage(d,0,0);e.imageData=e.context.getImageData(0,0,e.width,e.height);e._histogramRefresh=!0;e._integralRefresh=!0;typeof a!="undefined"&&a.call(e)},d.src=c);d.crossOrigin="";return this},blend:function(c,a,e,d,m){typeof a=="undefined"&&(a="normal");typeof e=="undefined"&&(e=1);e>1&&(e=1);e<0&&(e=0);typeof d=="undefined"&&(d=0);typeof m==
"undefined"&&(m=0);var j=0,k=0;d<0&&(j=-d,d=0);m<0&&(k=-m,m=0);if(!(d>=this.width||m>=this.height)){a=n[a];if(a==void 0||a==null)return this;var t=l(this.width,c.width-j),v=l(this.height,c.height-k),u=this.context.getImageData(d,m,t,v),j=c.context.getImageData(j,k,t,v),c=u.data,j=j.data,x,p,q,o=1-e,s=j.length,w;for(w=0;w<s;w+=4)x=c[w],p=c[w+1],q=c[w+2],k=a(j[w],x),t=a(j[w+1],p),v=a(j[w+2],q),c[w]=k*e+x*o,c[w+1]=t*e+p*o,c[w+2]=v*e+q*o;this.context.putImageData(u,d,m);this._integralRefresh=this._histogramRefresh=
!0;return this}},_refresh:function(){this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);return this},clone:function(){return new d.Image(this.canvasElement)},integral:function(){this._integralRefresh&&this._computeIntegral();return this._integral},_computeIntegral:function(){var c=this.width,a=this.height,e=new d.Array32U(c*a),h=this.getPixelData().data,m,j,k,t,l;for(t=k=j=m=0;m<c;)ii=m+k,l=ii<<2,l=4899*h[l]+9617*h[l+1]+1868*h[l+2]+
8192>>>14,t+=(l&255)>>>0,e[ii]=m>0?e[ii-1]+t:t,j++,k+=c,a==j&&(m++,t=k=j=0);this._integral=e;this._integralRefresh=!1},histogram:function(){this._histogramRefresh&&this._computeHistogram();return this._histogram},_computeHistogram:function(){for(var c=this.getPixelData().data,a=0,e=c.length,h,m,j,k=0,l=0,v=0,u=255,n=255,p=255,q=new d.Array32F(256),o=new d.Array32F(256),s=new d.Array32F(256),w=1/(e>>2),a=0;a<256;)q[a]=0,o[a]=0,s[a]=0,a++;for(a=0;a<e;)h=c[a],m=c[a+1],j=c[a+2],q[h]+=w,o[m]+=w,s[j]+=
w,h>k&&(k=h),h<u&&(u=h),m>l&&(l=m),m<n&&(n=m),j>v&&(v=j),j<p&&(p=j),a+=4;this._histogram=[q,o,s];this._histogramRefresh=!1},createImageData:function(c,a){this.width=c;this.height=a;this._tmpCanvas.width=this.canvasElement.width=this.width;this._tmpCanvas.height=this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.context.createImageData(c,a);return this.imageData=this.context.getImageData(0,0,this.width,this.height)},scale:function(c,a){var c=c||1,a=a||c,e=this._tmpCanvas.getContext("2d");
e.scale(c,a);e.drawImage(this.canvasElement,0,0);this.canvasElement.width=this.width=~~(c*this.width+0.5);this.canvasElement.height=this.height=~~(a*this.height+0.5);this.context.drawImage(this._tmpCanvas,0,0);this._tmpCanvas.width=this.width;this._tmpCanvas.height=this.height;this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},flipHorizontal:function(){var c=this._tmpCanvas.getContext("2d");c.translate(this.width,0);c.scale(-1,
1);c.drawImage(this.canvasElement,0,0);this.context.drawImage(this._tmpCanvas,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},flipVertical:function(){var c=this._tmpCanvas.getContext("2d");c.translate(0,this.height);c.scale(1,-1);c.drawImage(this.canvasElement,0,0);this.context.drawImage(this._tmpCanvas,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=
!0;return this}}})(FILTER);
(function(d){function n(a,c){var a=a||{},d;for(d in c)c&&Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a}d.Array32F=typeof Float32Array!=="undefined"?Float32Array:Array;d.Array64F=typeof Float64Array!=="undefined"?Float64Array:Array;d.Array8I=typeof Int8Array!=="undefined"?Int8Array:Array;d.Array16I=typeof Int16Array!=="undefined"?Int16Array:Array;d.Array32I=typeof Int32Array!=="undefined"?Int32Array:Array;d.Array8U=typeof Uint8Array!=="undefined"?Uint8Array:Array;d.Array16U=typeof Uint16Array!==
"undefined"?Uint16Array:Array;d.Array32U=typeof Uint32Array!=="undefined"?Uint32Array:Array;d.ImArray=typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:d.Array8U;d.CONSTANTS={SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI};d.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3};d.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4};d.LUMA=new d.Array32F([0.212671,0.71516,0.072169]);d.Filter=function(){};d.Filter.prototype={_apply:function(){},apply:function(){},reset:function(){}};d.CompositeFilter=function(a){this._stack=
typeof a!="undefined"&&a.length?a:[]};d.CompositeFilter.prototype={_stack:[],_apply:function(a,c,d){if(!this._stack.length)return a;for(var m=this._stack,j=m.length,k=0,l;k<j;)(l=m[k++])&&(a=l._apply(a,c,d));return a},apply:function(a){if(!this._stack.length)return a;return a.setData(this._apply(im=a.getData(),a.width,a.height))},filters:function(a){if(a)this._stack=a;return this},push:function(a){this._stack.push(a);return this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},
unshift:function(a){this._stack.unshift(a);return this},concat:function(a){return this.push(a)},remove:function(a){for(var c=this._stack.length;--c>=0;)a===this._stack[c]&&this._stack.splice(c,1);return this},reset:function(){this._stack.length=0;return this}};d.Create=function(a){var c=function(){this.init.apply(this,Array.prototype.slice.call(arguments))},a=n({init:function(){},reset:function(){return this},apply:function(a){return a}},a);a._apply=a.apply;a.apply=function(a){return a.setData(this._apply(a.getData(),
a.width,a.height))};c.prototype=n(c.prototype,a);return c};var l=null,c=null;d.static={createImageData:function(a,e){l||(l=document.createElement("canvas"),c=l.getContext("2d"));return c.createImageData(a,e)}}})(FILTER);
(function(d){var n=Math.sqrt;d.Color={blend:function(d,c,a){return{red:d.red-~~((d.red-c.red)*a+0.5),green:d.green-~~((d.green-c.green)*a+0.5),blue:d.blue-~~((d.blue-c.blue)*a+0.5)}},toGray:function(l,c,a){return~~(d.LUMA[0]*l+d.LUMA[1]*c+d.LUMA[2]*a)},distance:function(d,c){var a=d.red-c.red,e=d.green-c.green,h=d.blue-c.blue;return n(a*a+e*e+h*h)},RGB2Color:function(d){return(d.red<<16)+(d.green<<8)+d.blue},RGBA2Color:function(d){return(d.alpha<<24)+(d.red<<16)+(d.green<<8)+d.blue},Color2RGBA:function(d){d=
~~d;return{red:d>>16&255,green:d>>8&255,blue:d&255,alpha:d>>24&255}},RGB2YCbCr:function(d){var c=d.red,a=d.green,d=d.blue;return{Y:~~(0.299*c+0.587*a+0.114*d),Cb:~~(128-0.169*c-0.331*a+0.5*d),Cr:~~(128+0.5*c-0.42*a-0.08*d)}},YCbCr2RGB:function(d){var c=d.Y,a=d.Cb,d=d.Cr;return{red:~~(c+1.4*(d-128)),green:~~(c-0.343*(a-128)-0.711*(d-128)),blue:~~(c+1.765*(a-128))}},RGB2HSV:function(d){var c=d.red*0.00392156862745098,a=d.green*0.00392156862745098,e=d.blue*0.00392156862745098,h;h=c<a?c<e?c:e:a<e?a:e;
d=c>a?c>e?c:e:a>e?a:e;if(h==d)return{H:NaN,S:0,V:d};c=((c==h?3:a==h?5:1)-(c==h?a-e:a==h?e-c:c-a)/(d-h))*60;c>=360?c-=360:c<0&&(c+=360);$=(d-h)/d;return{H:c,S:void 0,V:d}}}})(FILTER);(function(d){d.CustomFilter=function(d){this._handler=d};d.CustomFilter.prototype={_handler:null,_apply:function(d,l,c){if(!this._handler)return d;return this._handler.call(this,d,l,c)},apply:function(d){if(!this._handler)return d;return d.setData(this._handler.call(this,d.getData(),d.width,d.height))}}})(FILTER);
(function(d){var n=d.Array32F,l=d.CONSTANTS.toRad;d.ColorMatrixFilter=function(c){this.matrix=typeof c!="undefined"&&c.length?new n(c):null};d.ColorMatrixFilter.prototype={matrix:null,channel:function(c,a){var e=(typeof a=="undefined"?0:a)?1:0;switch(c){case d.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case d.CHANNEL.BLUE:return this.concat([0,0,e,0,0,0,0,e,0,0,0,0,1,0,0,0,0,0,0,255]);case d.CHANNEL.GREEN:return this.concat([0,e,0,0,0,0,1,0,0,0,0,e,0,0,0,0,0,0,0,
255]);default:return this.concat([1,0,0,0,0,e,0,0,0,0,e,0,0,0,0,0,0,0,0,255])}},redChannel:function(c){return this.channel(d.CHANNEL.RED,c)},greenChannel:function(c){return this.channel(d.CHANNEL.GREEN,c)},blueChannel:function(c){return this.channel(d.CHANNEL.BLUE,c)},alphaChannel:function(){return this.channel(d.CHANNEL.ALPHA,!0)},maskChannel:function(c){switch(c){case d.CHANNEL.ALPHA:return this;case d.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case d.CHANNEL.GREEN:return this.concat([1,
0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this.concat([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(c,a){switch(c){case d.CHANNEL.ALPHA:switch(a){case d.CHANNEL.ALPHA:return this;case d.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case d.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);default:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}case d.CHANNEL.BLUE:switch(a){case d.CHANNEL.ALPHA:return this.concat([1,
0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case d.CHANNEL.BLUE:return this;case d.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);default:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}case d.CHANNEL.GREEN:switch(a){case d.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case d.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case d.CHANNEL.GREEN:return this;default:return this.concat([0,1,0,0,0,1,0,0,0,0,
0,0,1,0,0,0,0,0,1,0])}default:switch(a){case d.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case d.CHANNEL.BLUE:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case d.CHANNEL.GREEN:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this}}},desaturate:function(){return this.concat([d.LUMA[0],d.LUMA[1],d.LUMA[2],0,0,d.LUMA[0],d.LUMA[1],d.LUMA[2],0,0,d.LUMA[0],d.LUMA[1],d.LUMA[2],0,0,0,0,0,1,0])},grayscale:function(){return this.desaturate()},
colorize:function(c,a){var e,h,m,j;typeof a=="undefined"&&(a=1);e=(c>>16&255)*0.00392156862745098;h=(c>>8&255)*0.00392156862745098;m=(c&255)*0.00392156862745098;j=1-a;return this.concat([j+a*e*d.LUMA[0],a*e*d.LUMA[1],a*e*d.LUMA[2],0,0,a*h*d.LUMA[0],j+a*h*d.LUMA[1],a*h*d.LUMA[2],0,0,a*m*d.LUMA[0],a*m*d.LUMA[1],j+a*m*d.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,
1,0,0,0,0,0,-1,255])},saturate:function(c){var a,e,h;a=1-c;e=a*d.LUMA[0];h=a*d.LUMA[1];a*=d.LUMA[2];return this.concat([e+c,h,a,0,0,e,h+c,a,0,0,e,h,a+c,0,0,0,0,0,1,0])},contrast:function(c,a,d){typeof a=="undefined"&&(a=c);typeof d=="undefined"&&(d=c);c+=1;a+=1;d+=1;return this.concat([c,0,0,0,128*(1-c),0,a,0,0,128*(1-a),0,0,d,0,128*(1-d),0,0,0,1,0])},brightness:function(c,a,d){typeof a=="undefined"&&(a=c);typeof d=="undefined"&&(d=c);return this.concat([1,0,0,0,c,0,1,0,0,a,0,0,1,0,d,0,0,0,1,0])},
adjustHue:function(c){c*=l;var a=Math.cos(c),c=Math.sin(c);return this.concat([d.LUMA[0]+a*(1-d.LUMA[0])+c*-d.LUMA[0],d.LUMA[1]+a*-d.LUMA[1]+c*-d.LUMA[1],d.LUMA[2]+a*-d.LUMA[2]+c*(1-d.LUMA[2]),0,0,d.LUMA[0]+a*-d.LUMA[0]+c*0.143,d.LUMA[1]+a*(1-d.LUMA[1])+c*0.14,d.LUMA[2]+a*-d.LUMA[2]+c*-0.283,0,0,d.LUMA[0]+a*-d.LUMA[0]+c*-(1-d.LUMA[0]),d.LUMA[1]+a*-d.LUMA[1]+c*d.LUMA[1],d.LUMA[2]+a*(1-d.LUMA[2])+c*d.LUMA[2],0,0,0,0,0,1,0])},average:function(c,a,d){typeof c=="undefined"&&(c=0.3333);typeof a=="undefined"&&
(a=0.3333);typeof d=="undefined"&&(d=0.3334);return this.concat([c,a,d,0,0,c,a,d,0,0,c,a,d,0,0,0,0,0,1,0])},quickContrastCorrection:function(c){typeof c=="undefined"&&(c=1.2);return this.concat([c,0,0,0,0,0,c,0,0,0,0,0,c,0,0,0,0,0,1,0])},quickSepia:function(c){typeof c=="undefined"&&(c=10);c>100&&(c=100);c*=2.55;return this.concat([d.LUMA[0],d.LUMA[1],d.LUMA[2],0,40,d.LUMA[0],d.LUMA[1],d.LUMA[2],0,20,d.LUMA[0],d.LUMA[1],d.LUMA[2],0,-c,0,0,0,1,0])},quickSepia2:function(c,a,d){typeof c=="undefined"&&
(c=1);typeof a=="undefined"&&(a=c);typeof d=="undefined"&&(d=c);return this.concat([c*0.5,0.5,0.5,0,0,0.33,a*0.33,0.33,0,0,0.25,0.25,d*0.25,0,0,0,0,0,1,0])},threshold:function(c,a){typeof a=="undefined"&&(a=256);return this.concat([d.LUMA[0]*a,d.LUMA[1]*a,d.LUMA[2]*a,0,-(a-1)*c,d.LUMA[0]*a,d.LUMA[1]*a,d.LUMA[2]*a,0,-(a-1)*c,d.LUMA[0]*a,d.LUMA[1]*a,d.LUMA[2]*a,0,-(a-1)*c,0,0,0,1,0])},threshold_rgb:function(c,a){typeof a=="undefined"&&(a=256);return this.concat([a,0,0,0,-(a-1)*c,0,a,0,0,-(a-1)*c,0,
0,a,0,-(a-1)*c,0,0,0,1,0])},threshold_alpha:function(c,a){typeof c=="undefined"&&(c=0.5);typeof a=="undefined"&&(a=256);return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,a,-a*c])},blend:function(c,a){var d;if(this.matrix){d=this.matrix;for(var h=c.matrix,m=1-a,j=0,k=new n(20);j<20;)k[j]=m*d[j]+a*h[j],j++;d=k}else d=new n(c.matrix);this.matrix=d;return this},concat:function(c){var a;if(this.matrix){a=this.matrix;var c=new n(c),d=new n(20),h,m,j,k,t;h=c[0];m=c[1];j=c[2];k=c[3];t=c[4];d[0]=h*a[0]+
m*a[5]+j*a[10]+k*a[15];d[1]=h*a[1]+m*a[6]+j*a[11]+k*a[16];d[2]=h*a[2]+m*a[7]+j*a[12]+k*a[17];d[3]=h*a[3]+m*a[8]+j*a[13]+k*a[18];d[4]=h*a[4]+m*a[9]+j*a[14]+k*a[19]+t;h=c[5];m=c[6];j=c[7];k=c[8];t=c[9];d[5]=h*a[0]+m*a[5]+j*a[10]+k*a[15];d[6]=h*a[1]+m*a[6]+j*a[11]+k*a[16];d[7]=h*a[2]+m*a[7]+j*a[12]+k*a[17];d[8]=h*a[3]+m*a[8]+j*a[13]+k*a[18];d[9]=h*a[4]+m*a[9]+j*a[14]+k*a[19]+t;h=c[10];m=c[11];j=c[12];k=c[13];t=c[14];d[10]=h*a[0]+m*a[5]+j*a[10]+k*a[15];d[11]=h*a[1]+m*a[6]+j*a[11]+k*a[16];d[12]=h*a[2]+
m*a[7]+j*a[12]+k*a[17];d[13]=h*a[3]+m*a[8]+j*a[13]+k*a[18];d[14]=h*a[4]+m*a[9]+j*a[14]+k*a[19]+t;h=c[15];m=c[16];j=c[17];k=c[18];t=c[19];d[15]=h*a[0]+m*a[5]+j*a[10]+k*a[15];d[16]=h*a[1]+m*a[6]+j*a[11]+k*a[16];d[17]=h*a[2]+m*a[7]+j*a[12]+k*a[17];d[18]=h*a[3]+m*a[8]+j*a[13]+k*a[18];d[19]=h*a[4]+m*a[9]+j*a[14]+k*a[19]+t;a=d}else a=new n(c);this.matrix=a;return this},combine:function(c){return this.concat(c.matrix)},_apply:function(c){if(!this.matrix)return c;for(var a=c.length,d=this.matrix,h=0,m,j,
k,t;h<a;)m=c[h],j=c[h+1],k=c[h+2],t=c[h+3],c[h]=d[0]*m+d[1]*j+d[2]*k+d[3]*t+d[4],c[h+1]=d[5]*m+d[6]*j+d[7]*k+d[8]*t+d[9],c[h+2]=d[10]*m+d[11]*j+d[12]*k+d[13]*t+d[14],c[h+3]=d[15]*m+d[16]*j+d[17]*k+d[18]*t+d[19],h+=4;return c},apply:function(d){if(!this.matrix)return d;return d.setData(this._apply(d.getData(),d.width,d.height))},reset:function(){this.matrix=null;return this}}})(FILTER);
(function(d){function n(a){var c=new d.ImArray(256),k=0;if(a)for(;k<256;)c[k]=255-k,k++;else for(;k<256;)c[k]=k,k++;return c}function l(a){if(a)return new d.ImArray(a);return null}var c=Math.pow,a=Math.exp,e=1/255,h=n(1);d.TableLookupFilter=function(a,d,c){this.tableR=a||null;this.tableG=d||l(this.tableR);this.tableB=c||l(this.tableG)};d.TableLookupFilter.prototype={tableR:null,tableG:null,tableB:null,thresholds:function(a){a.length||(a=[a]);var c=a.length,k=c+1,e=new d.ImArray(256),h=new d.ImArray(k),
l,n=255/(k-1);for(l=0;l<k;)h[l]=~~(n*l),l++;a[0]=~~(255*a[0]);for(l=1;l<c;)a[l]=a[l-1]+~~(255*a[l]),l++;for(l=0;l<256;){for(k=0;k<c&&l>a[k];)k++;e[l]=h[k];l++}return this.concat(e)},threshold:function(a){return this.thresholds([a||0.5])},quantize:function(a){typeof a=="undefined"&&(a=64);a<2&&(a=2);var c=new d.ImArray(256),k=new d.ImArray(a),e,h=255/(a-1),l=a/256;for(e=0;e<a;)k[e]=~~(h*e),e++;for(e=0;e<256;)c[e]=k[~~(l*e)],e++;return this.concat(c)},levels:function(a){return this.quantize(a)},posterize:function(a){return this.quantize(a)},
binarize:function(){return this.quantize(2)},solarize:function(a){typeof a=="undefined"&&(a=0.5);for(var c=0,k=new d.ImArray(256),a=~~(a*256)-1,c=0;c<256;)k[c]=c>a?255-(c<<1):(c<<1)-255,c++;return this.concat(k)},invert:function(){return this.concat(h)},mask:function(a){var c=0,k=a>>16&255,e=a>>8&255;a&=255;tR=new d.ImArray(256);tG=new d.ImArray(256);tB=new d.ImArray(256);for(c=0;c<256;)tR[c]=c&k,tG[c]=c&e,tB[c]=c&a,c++;return this.concat(tR,tG,tB)},gammaCorrection:function(a,j,k){for(var a=a||1,
j=j||a,k=k||j,a=1/a,j=1/j,k=1/k,h=new d.ImArray(256),l=new d.ImArray(256),n=new d.ImArray(256),x=0;x<256;)h[x]=~~(255*c(e*x,a)),l[x]=~~(255*c(e*x,j)),n[x]=~~(255*c(e*x,k)),x++;return this.concat(h,l,n)},exposure:function(c){typeof c=="undefined"&&(c=1);for(var j=0,k=new d.ImArray(256),j=0;j<256;)k[j]=~~(255*(1-a(-c*j*e))),j++;return this.concat(k)},concat:function(a,c,d){if(!a)return this;var c=c||a,d=d||c,e=this.tableR||n(),h=this.tableG||l(e),u=this.tableB||l(h),x=l(e),p=l(h),q=l(u),o;for(o=0;o<
256;)e[o]=a[x[o]],h[o]=c[p[o]],u[o]=d[q[o]],o++;this.tableR=e;this.tableG=h;this.tableB=u;return this},combine:function(a){return this.concat(a.tableR,a.tableG,a.tableB)},_apply:function(a){if(!this.tableR)return a;for(var c=a.length,d=0,e,h,l,n=this.tableR,p=this.tableG,q=this.tableB;d<c;)e=a[d],h=a[d+1],l=a[d+2],a[d]=n[e],a[d+1]=p[h],a[d+2]=q[l],d+=4;return a},apply:function(a){if(!this.tableR)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this.tableB=this.tableG=
this.tableR=null;return this}}})(FILTER);
(function(d){var n=Math.min;d.DisplacementMapFilter=function(d){this.map=d||null};d.DisplacementMapFilter.prototype={scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:d.MODE.CLAMP,map:null,_apply:function(l,c,a){if(!this.map)return l;var e=this.map.getData(),h=this.map.width,m=this.map.height,j=h*m,k=new d.Array16I(j<<1),t=n(h,c),v=n(m,a),u=this.scaleX*0.00390625,x=this.scaleY*0.00390625,p=this.componentX,q=this.componentY,m=this.color>>24&255,o=this.color>>16&255,s=this.color>>
8&255,w=this.color&255,z=~~this.startY,y=~~this.startX,A=this.mode,B=z*c,D=c-y,V=a-z,F,E,L,M,S,P=t*v<<2,G=new d.ImArray(l),J=d.MODE.IGNORE,K=d.MODE.COLOR,C=d.MODE.WRAP;for(M=L=E=F=v=0;v<j;)S=E+M<<2,k[F]=~~((e[S+p]-128)*u),k[F+1]=~~((e[S+q]-128)*x),v++,F+=2,E++,E>=h&&(E=0,L++,M+=h);v=-4;E=-1;for(ty2=M=L=0;v<P;)if(v+=4,E++,E>=t&&(E=0,L++,M+=c,ty2+=h),!(L<-z||L>=V||E<-y||E>=D)){u=E+y;j=L+z;e=u+M+B<<2;F=E+ty2<<1;srcx=u+k[F];srcy=j+k[F+1];if(srcy>=a||srcy<0||srcx>=c||srcx<0)switch(A){case J:continue;case K:G[e]=
o;G[e+1]=s;G[e+2]=w;G[e+3]=m;continue;case C:srcy>=a&&(srcy-=a);srcy<0&&(srcy+=a);srcx>=c&&(srcx-=c);srcx<0&&(srcx+=c);break;default:srcy>=a&&(srcy=a-1),srcy<0&&(srcy=0),srcx>=c&&(srcx=c-1),srcx<0&&(srcx=0)}F=srcx+srcy*c<<2;G[e]=l[F];G[e+1]=l[F+1];G[e+2]=l[F+2];G[e+3]=l[F+3]}return G},apply:function(d){if(!this.map)return d;return d.setData(this._apply(d.getData(),d.width,d.height))},reset:function(){this.map=null;return this}}})(FILTER);
(function(d){function n(a,c,e){var h,l,m,p,n=c*e,o=a.length,s=new d.ImArray(a),w=this.a,z=this.b,y=this.c;p=this.d;var A;l=h=e=m=0;for(A=p*c;m<o;)p=~~(w*e+y+z*l+A),p>=0&&p<n&&(p<<=2,s[m]=a[p],s[m+1]=a[p+1],s[m+2]=a[p+2],s[m+3]=a[p+3]),m+=4,e++,e>=c&&(e=0,h++,l+=c);return s}function l(a,c){var e,h,l,m,p,n=a.length,o=new d.ImArray(n);for(l=h=e=m=0;m<n;)p=c-1-e+l<<2,o[m]=a[p],o[m+1]=a[p+1],o[m+2]=a[p+2],o[m+3]=a[p+3],m+=4,e++,e>=c&&(e=0,h++,l+=c);return o}function c(a,c,e){var h,m,l,n,q=a.length,o=new d.ImArray(q);
m=h=l=0;for(e=(e-1)*c;l<q;)n=h+e<<2,o[l]=a[n],o[l+1]=a[n+1],o[l+2]=a[n+2],o[l+3]=a[n+3],l+=4,h++,h>=c&&(h=0,m++,e-=c);return o}function a(a,c,e){var h,l,m,n,q,o=a.length,s=new d.ImArray(o);l=h=n=0;for(e=(e-1)*c;n<o;)q=c-1-h+e<<2,s[n]=a[q],s[n+1]=a[q+1],s[n+2]=a[q+2],s[n+3]=a[q+3],n+=4,h++,h>=c&&(h=0,l++,m+=c,e-=c);return s}function e(a){return a}function h(a){return a}function m(a){return a}d.GeometricMapFilter=function(a){this.map=a};d.GeometricMapFilter.prototype={map:null,a:1,b:1,c:0,d:0,mode:d.MODE.CLAMP,
affine:function(a,c,d,e){this.a=a;this.b=c;this.c=d;this.d=e;this.map=n;return this},flipX:function(){this.map=l;return this},flipY:function(){this.map=c;return this},flipXY:function(){this.map=a;return this},polar:function(){this.map=e;return this},cartesian:function(){this.map=h;return this},twirl:function(){this.map=m;return this},_apply:function(a,c,d){if(!this.map)return a;return this.map.call(this,a,c,d)},apply:function(a){if(!this.map)return a;return a.setData(this.map.call(this,a.getData(),
a.width,a.height))},reset:function(){this.map=null;return this}}})(FILTER);
(function(d){function n(a){var c=t.length,d,e;a--;if(a<c)d=t[a].slice();else for(d=new k(t[c-1]);c<=a;){e=d.slice();d=[1];i=0;for(il=e.length-1;i<il;i++)d.push(e[i]+e[i+1]);d.push(1);c<40&&t.push(d.slice());c++}return d}function l(a){var c,d=-(a>>1),e=Array(a);for(c=0;c<a;c++)e[c]=d,d++;return e}function c(a,d){var e,h,k=a.length,j,l=[],m=0;if(typeof a[0].length=="undefined")for(e=0;e<k;e++)for(h=0;h<k;h++)j=a[e]*d[h],m+=j,l.push(j);else for(e=0;e<k;e++)for(h=0;h<k;h++)j=c(a[e],d[h]),m+=j.sum,l=l.concat(j.ker);
return{kernel:l,sum:m}}function a(a){a=n(a);return c(a,a)}function e(a,d){var e=n(a),h=l(a);return 1==d?c(h.reverse(),e):c(e,h)}function h(a,d){var e,h=Array(a);for(e=0;e<a;e++)h[e]=1;e=l(a);return 1==d?c(e.reverse(),h):c(h,e)}function m(a,c,d,e){var h=a.length,j,l=new k(a.length),d=d||1,e=e||1;for(j=0;j<h;j++)l[j]=d*a[j]+e*c[j];return l}function j(a,c){var c=c||1,d=a*a,e,h=new k(d);for(e=0;e<d;e++)h[e]=c;return h}var k=d.Array32F,t=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,
20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],v=d.CONSTANTS.toRad,u=Math.abs,x=Math.sqrt,p=Math.sin,q=Math.cos;d.ConvolutionMatrixFilter=function(a,c,d){typeof a!="undefined"&&a.length?(this.set(a,c||1,~~(x(a.length)+0.5)),this.bias=d||0):(this.matrix=null,this.dim=0,this.auxMatrix=null,this._useBox=this._isGrad=!1)};d.ConvolutionMatrixFilter.prototype={dim:0,matrix:null,factor:1,bias:0,lowPass:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;this.set(j(a),1/(a*a),a);this._useBox=!0;return this},
highPass:function(a,c){var a=typeof a=="undefined"?3:a%2?a:a+1,d=a*a,e=-(typeof c=="undefined"?1:c)/d,h=j(a,e);h[d>>2]=1+e;this.set(h,1,a);this._useBox=!0;return this},boxBlur:function(a){return this.lowPass(a)},binomialLowPass:function(c){var c=typeof c=="undefined"?3:c%2?c:c+1,d=a(c);return this.set(d.kernel,1/d.sum,c)},binomialHighPass:function(c){var c=typeof c=="undefined"?3:c%2?c:c+1,d=a(c);return this.set(m(j(c),new k(d.kernel),1,-1/d.sum),1,c)},gaussBlur:function(a){return this.binomialLowPass(a)},
sharpen:function(a,c){c=typeof c=="undefined"?0.5:c;return c<=0?this.set([0,-2,0,-2,10,-2,0,-2,0],0.5,3):this.highPass(a,c)},prewittX:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(h(a,0).kernel,1,a)},prewittY:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(h(a,1).kernel,1,a)},prewittDirectional:function(a,c){a=typeof a=="undefined"?3:a%2?a:a+1;c*=v;var d=q(c),e=p(c),j=h(a,0),l=h(a,1);return this.set(m(new k(j.kernel),new k(l.kernel),d,e),1,a)},prewitt:function(a){var a=
typeof a=="undefined"?3:a%2?a:a+1,c=h(a,0),d=h(a,1);this.set(c.kernel,1,a);this._isGrad=!0;this.auxMatrix=new k(d.kernel);return this},gradX:function(a){return this.prewittX(a)},gradY:function(a){return this.prewittY(a)},gradDirectional:function(a,c){return this.prewittDirectional(a,c)},grad:function(a){return this.prewitt(a)},sobelX:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(e(a,0).kernel,1,a)},sobelY:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(e(a,1).kernel,
1,a)},sobelDirectional:function(a,c){a=typeof a=="undefined"?3:a%2?a:a+1;c*=v;var d=q(c),h=p(c),j=e(a,0),l=e(a,1);return this.set(m(new k(j.kernel),new k(l.kernel),d,h),1,a)},sobel:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=e(a,0),d=e(a,1);this.set(c.kernel,1,a);this.auxMatrix=new k(d.kernel);this._isGrad=!0;return this},laplace:function(){return this.set([0,-1,0,-1,4,-1,0,-1,0],1,3)},emboss:function(a,c){var c=1,d=(typeof a=="undefined"||a!=1&&a!=-1?1:a)*c;return this.set([-d*2,-d*1,0,
-d*1,c*1,d*1,0,d*1,d*2],1,3)},embossHigh:function(){return this.emboss(1)},embossLow:function(){return this.emboss(-1)},edges:function(){return this.set([0,1,0,1,-4,1,0,1,0],1,3)},edges2:function(){return this.set([0,2,0,2,-8,2,0,2,0],0.5,3)},motionblur:function(a){var c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];if(a==0)for(a=0;a<9;a++)c[36+a]=1;else if(a==2)for(a=0;a<9;a++)c[9*
a+5]=1;else if(a==1)for(a=0;a<9;a++)c[9*a+a]=1;return this.set(c,1/9,9)},set:function(a,c,d){this.auxMatrix=null;this._useBox=this._isGrad=!1;this.matrix=new k(a);this.factor=c;this.dim=d;return this},combine:function(){return this},_apply:function(a,c,e){if(!this.matrix)return a;var h=this.dim,j=h>>1,k=h*h,l=j*c,m=this.matrix,n=this.factor,t=this.bias,p=this.auxMatrix,q,v=this._isGrad,x=new d.Array32I(k<<1),P=new d.Array8U(k);e*=c;var G=a.length,J=new d.ImArray(G),K,C,Q,H,R,N,O,I,T,U;for(O=N=R=H=
C=K=0;K<k;)P[K]=H+N,x[C]=H-j,x[C+1]=O-l,K++,C+=2,H++,h==H&&(H=0,R++,N+=h,O+=c);for(N=R=H=K=0;K<G;){for(Q=C=U=T=O=l=j=h=0;C<k;)I=H+x[Q],q=N+x[Q+1],I>=0&&I<c&&q>=0&&q<e&&(I=I+q<<2,q=m[P[C]],h+=a[I]*q,j+=a[I+1]*q,l+=a[I+2]*q,p&&(q=p[P[C]],O+=a[I]*q,T+=a[I+1]*q,U+=a[I+2]*q)),C++,Q+=2;C=K;v?(J[C]=u(h)+u(O),J[C+1]=u(j)+u(T),J[C+2]=u(l)+u(U)):(J[C]=n*h+t,J[C+1]=n*j+t,J[C+2]=n*l+t);J[C+3]=a[C+3];K+=4;H++;H>=c&&(H=0,R++,N+=c)}return J},apply:function(a){if(!this.matrix)return a;return a.setData(this._apply(a.getData(),
a.width,a.height))},reset:function(){this.auxMatrix=this._indices=this.matrix=null;this.dim=0;return this}}})(FILTER);
(function(d){var n=function(a,c,l){var j=this.dim,k=j>>1,n=j*j,v=k*c,u=new d.Array32I(n<<1);l*=c;var x=a.length,p=new d.ImArray(x),q,o,s,w,z,y=[],A=[],B=[];for(z=w=s=o=q=0;q<n;)u[o]=s-k,u[o+1]=z-v,q++,o+=2,s++,s>=j&&(s=0,w++,z+=c);for(z=w=s=q=0;q<x;){y.length=0;A.length=0;for(j=o=B.length=0;o<n;)k=s+u[j],v=z+u[j+1],k>=0&&k<c&&v>=0&&v<l&&(k=k+v<<2,y.push(a[k]),A.push(a[k+1]),B.push(a[k+2])),o++,j+=2;y.sort();A.sort();B.sort();j=(y.length>>1)+1;k=y.length%2;o=q;k?(p[o]=y[j],p[o+1]=A[j],p[o+2]=B[j]):
(p[o]=~~(0.5*(y[j-1]+y[j])),p[o+1]=~~(0.5*(A[j-1]+A[j])),p[o+2]=~~(0.5*(B[j-1]+B[j])));p[o+3]=a[o+3];q+=4;s++;s>=c&&(s=0,w++,z+=c)}return p},l=function(a,c,l){var j=this.dim,k=j>>1,n=j*j,v=k*c,u=new d.Array32I(n<<1);l*=c;var x=a.length,p=new d.ImArray(x),q,o,s,w,z,y,A,B,D;for(y=z=w=o=q=0;q<n;)u[o]=w-k,u[o+1]=y-v,q++,o+=2,w++,w>=j&&(w=0,z++,y+=c);for(y=z=w=q=0;q<x;){for(s=o=v=k=j=0;o<n;)A=w+u[s],B=y+u[s+1],A>=0&&A<c&&B>=0&&B<l&&(D=A+B<<2,A=a[D],B=a[D+1],D=a[D+2],A>j&&(j=A),B>k&&(k=B),D>v&&(v=D)),o++,
s+=2;o=q;p[o]=j;p[o+1]=k;p[o+2]=v;p[o+3]=a[o+3];q+=4;w++;w>=c&&(w=0,z++,y+=c)}return p},c=function(a,c,l){var j=this.dim,k=j>>1,n=j*j,v=k*c,u=new d.Array32I(n<<1);l*=c;var x=a.length,p=new d.ImArray(x),q,o,s,w,z,y,A,B,D;for(y=z=w=o=q=0;q<n;)u[o]=w-k,u[o+1]=y-v,q++,o+=2,w++,w>=j&&(w=0,z++,y+=c);for(y=z=w=q=0;q<x;){v=k=j=255;for(s=o=0;o<n;)A=w+u[s],B=y+u[s+1],A>=0&&A<c&&B>=0&&B<l&&(D=A+B<<2,A=a[D],B=a[D+1],D=a[D+2],A<j&&(j=A),B<k&&(k=B),D<v&&(v=D)),o++,s+=2;o=q;p[o]=j;p[o+1]=k;p[o+2]=v;p[o+3]=a[o+3];
q+=4;w++;w>=c&&(w=0,z++,y+=c)}return p},a=function(a){return a};d.NonLinearFilter=function(){this.dim=0;this._apply=a};d.NonLinearFilter.prototype={dim:0,median:function(a){this.dim=typeof a=="undefined"?3:a%2?a:a+1;this._apply=n;return this},erode:function(a){this.dim=typeof a=="undefined"?3:a;this._apply=c;return this},dilate:function(a){this.dim=typeof a=="undefined"?3:a;this._apply=l;return this},_apply:function(a){return a},apply:function(a){if(!this.dim)return a;return a.setData(this._apply(a.getData(),
a.width,a.height))},reset:function(){this._apply=a;this.dim=0;return this}}})(FILTER);
(function(d){d.HistogramEqualizeFilter=d.Create({apply:function(n){var l,c,a,e;e=0;var h=255,m=new d.Array32F(256),j=new d.Array32F(256),k=0,t,v=n.length,u=1/(v>>2),x=Array(v>>2),p=d.Color.RGB2YCbCr,q=d.Color.YCbCr2RGB;for(t=0;t<256;)m[t]=0,j[t]=0,t++;for(k=t=0;t<v;){l=n[t];c=n[t+1];a=n[t+2];l=p({red:l,green:c,blue:a});m[l.Y]+=u;if(l.Y>e)e=l.Y;if(l.Y<h)h=l.Y;x[k]=l;t+=4;k++}for(t=k=0;t<256;)k+=m[t],j[t]=k,t++;e-=h;for(k=t=0;t<v;)l=x[k],l.Y=j[l.Y]*e+h,m=q(l),n[t]=m.red,n[t+1]=m.green,n[t+2]=m.blue,
t+=4,k++;return n}})})(FILTER);
(function(d){d.RGBHistogramEqualizeFilter=d.Create({init:function(){},apply:function(n){var l,c,a,e,h,m;m=h=e=0;var j=255,k=255,t=255,v=new d.Array32F(256),u=new d.Array32F(256),x=new d.Array32F(256),p=new d.Array32F(256),q=new d.Array32F(256),o=new d.Array32F(256),s,w=n.length,z=1/(w>>2);for(s=0;s<256;)v[s]=0,u[s]=0,x[s]=0,p[s]=0,q[s]=0,o[s]=0,s++;for(s=0;s<w;)l=n[s],c=n[s+1],a=n[s+2],v[l]+=z,u[c]+=z,x[a]+=z,l>e&&(e=l),l<j&&(j=l),c>h&&(h=c),c<k&&(k=c),a>m&&(m=a),a<t&&(t=a),s+=4;for(s=l=c=a=0;s<256;)l+=
v[s],p[s]=l,c+=u[s],q[s]=c,a+=x[s],o[s]=a,s++;e-=j;h-=k;m-=t;for(s=0;s<w;)l=n[s],c=n[s+1],a=n[s+2],n[s]=p[l]*e+j,n[s+1]=q[c]*h+k,n[s+2]=o[a]*m+t,s+=4;return n}})})(FILTER);(function(d){d.NoiseFilter=d.Create({min:-127,max:127,init:function(d,l){this.min=d||-127;this.max=l||127},apply:function(d){var l=this.max-this.min,c=Math.random,a=this.min,e,h=d.length,m,j,k,t;for(e=0;e<h;)j=d[e],k=d[e+1],t=d[e+2],m=l*c()+a,d[e]=j+m,d[e+1]=k+m,d[e+2]=t+m,e+=4;return d}})})(FILTER);
(function(d){var n=Math.sqrt;d.PixelateFilter=d.Create({scale:1,init:function(d){this.scale=d||1},apply:function(d,c,a){if(this.scale<=1)return d;var e=c*a,h=~~(n(e)*this.scale*0.01),m=1/(h*h),j=h*c,k,t,v,u,x,p,q;for(v=t=k=0;t<a;){for(pyw=x=u=b=g=r=0;x<h;)p=k+u,q=v+pyw,p<c&&q<e&&(p=p+q<<2,r+=m*d[p],g+=m*d[p+1],b+=m*d[p+2]),u++,u>=h&&(u=0,x++,pyw+=c);for(pyw=x=u=0;x<h;)p=k+u,q=v+pyw,p<c&&q<e&&(p=p+q<<2,d[p]=~~r,d[p+1]=~~g,d[p+2]=~~b),u++,u>=h&&(u=0,x++,pyw+=c);k+=h;k>=c&&(k=0,t+=h,v+=j)}return d}})})(FILTER);
