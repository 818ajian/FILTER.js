/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.6.4
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/var FILTER=FILTER||{};
(function(c){function y(c,k){var c=c||{},e;for(e in k)k&&Object.prototype.hasOwnProperty.call(k,e)&&(c[e]=k[e]);return c}c.Array32F=typeof Float32Array!=="undefined"?Float32Array:Array;c.Array64F=typeof Float64Array!=="undefined"?Float64Array:Array;c.Array8I=typeof Int8Array!=="undefined"?Int8Array:Array;c.Array16I=typeof Int16Array!=="undefined"?Int16Array:Array;c.Array32I=typeof Int32Array!=="undefined"?Int32Array:Array;c.Array8U=typeof Uint8Array!=="undefined"?Uint8Array:Array;c.Array16U=typeof Uint16Array!==
"undefined"?Uint16Array:Array;c.Array32U=typeof Uint32Array!=="undefined"?Uint32Array:Array;c.ImArray=typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:c.Array8U;c._notSupportTypedArrays=!c.ImArray.set;if(c._notSupportTypedArrays){if(!c.ImArray.prototype.set)c.ImArray.prototype.set=function(c){for(var k=c.length;--k;)this[k]=c[k]};if(typeof CanvasPixelArray!=="undefined")CanvasPixelArray.prototype.set=function(c){for(var k=c.length;--k;)this[k]=c[k]}}c.CONSTANTS={PI:Math.PI,PI2:2*Math.PI,SQRT2:Math.SQRT2,
toRad:Math.PI/180,toDeg:180/Math.PI};c.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3};c.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4};c.LUMA=new c.Array32F([0.212671,0.71516,0.072169]);c.Filter=function(){};c.Filter.prototype={_apply:function(){},apply:function(){},reset:function(){}};c.CompositeFilter=function(c){this._stack=typeof c!="undefined"&&c.length?c:[]};c.CompositeFilter.prototype={_stack:[],_apply:function(c,k,e,a){if(!this._stack.length)return c;for(var f=this._stack,j=f.length,g=0,h;g<j;)(h=f[g++])&&
(c=h._apply(c,k,e,a));return c},apply:function(c){if(!this._stack.length)return c;return c.setData(this._apply(im=c.getData(),c.width,c.height,c))},filters:function(c){if(c)this._stack=c;return this},push:function(c){this._stack.push(c);return this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(c){this._stack.unshift(c);return this},concat:function(c){return this.push(c)},getAt:function(c){return this._stack.length>c?this._stack[c]:null},setAt:function(c,
k){this._stack.length>c&&(this._stack[c]=k);return this},insertAt:function(c,k){this._stack.splice(c,0,k);return this},removeAt:function(c){this._stack.splice(c,1);return this},remove:function(c){for(var k=this._stack.length;--k>=0;)c===this._stack[k]&&this._stack.splice(k,1);return this},reset:function(){this._stack.length=0;return this}};c.Create=function(c){var k=function(){this.init.apply(this,Array.prototype.slice.call(arguments))},c=y({init:function(){},reset:function(){return this},apply:function(e){return e}},
c);c._apply=c.apply;c.apply=function(e){return e.setData(this._apply(e.getData(),e.width,e.height,e))};k.prototype=y(k.prototype,c);return k}})(FILTER);
(function(c){var y=Math.sqrt,l=Math.min,k=Math.max;c.Color={blend:function(e,a,f){return{r:e.r-~~((e.r-a.r)*f+0.5),g:e.g-~~((e.g-a.g)*f+0.5),b:e.b-~~((e.b-a.b)*f+0.5)}},toGray:function(e,a,f){var j=c.LUMA;return~~(j[0]*e+j[1]*a+j[2]*f)},distance:function(e,a){var f=e.r-a.r,c=e.g-a.g,g=e.b-a.b;return y(f*f+c*c+g*g)},RGB2Color:function(e){return e.r<<16|e.g<<8|e.b&255},RGBA2Color:function(e){return e.a<<24|e.r<<16|e.g<<8|e.b&255},Color2RGBA:function(e){e=~~e;return{r:e>>>16&255,g:e>>>8&255,b:e&255,
a:e>>>24&255}},RGB2YCbCr:function(e){var a=e.r,f=e.g,e=e.b;return{y:~~(0+0.299*a+0.587*f+0.114*e),cb:~~(128-0.168736*a-0.331264*f+0.5*e),cr:~~(128+0.5*a-0.418688*f-0.081312*e)}},YCbCr2RGB:function(e){var a=e.y,f=e.cb,e=e.cr;return{r:~~(a+1.402*(e-128)),g:~~(a-0.34414*(f-128)-0.71414*(e-128)),b:~~(a+1.772*(f-128))}},RGB2HSV:function(e){var a,f,c,g;f=e.r;c=e.g;g=e.b;a=l(f,c,g);e=k(f,c,g);a=e-a;if(e==0)return{h:0,s:0,v:e};f=f==e?(c-g)/a:c==e?2+(g-f)/a:4+(f-c)/a;f*=60;f<0&&(f+=360);return{h:f,s:a/e,v:e}},
HSV2RGB:function(e){var a,f,c,g,h;c=e.h;h=e.s;e=e.v;if(h==0)return a=f=e,{r:a,g:f,b:e};c/=60;a=~~c;f=c-a;c=e*(1-h);g=e*(1-h*f);h=e*(1-h*(1-f));switch(a){case 0:a=e;f=h;e=c;break;case 1:a=g;f=e;e=c;break;case 2:a=c;f=e;e=h;break;case 3:a=c;f=g;break;case 4:a=h;f=c;break;default:a=e,f=c,e=g}return{r:a,g:f,b:e}}}})(FILTER);
(function(c){function y(a,f){var e=document.createElement("canvas");e.width=a||0;e.height=f||0;return e}var l,k=Math.min,e=c.ImArray;l={normal:function(a){return a},lighten:function(a,f){return f>a?f:a},darken:function(a,f){return f>a?a:f},multiply:function(a,f){return a*f*0.003921568627451},average:function(a,f){return 0.5*(a+f)},add:function(a,f){return Math.min(255,a+f)},substract:function(a,f){return a+f<255?0:a+f-255},difference:function(a,f){return Math.abs(a-f)},negation:function(a,f){return 255-
Math.abs(255-a-f)},screen:function(a,f){return 255-((255-a)*(255-f)>>8)},exclusion:function(a,f){return a+f-2*a*f*0.003921568627451},overlay:function(a,f){return f<128?2*a*f*0.003921568627451:255-2*(255-a)*(255-f)*0.003921568627451},softLight:function(a,f){return f<128?2*((a>>1)+64)*f*0.003921568627451:255-2*(255-((a>>1)+64))*(255-f)*0.003921568627451},hardLight:function(a,f){return a<128?2*f*a*0.003921568627451:255-2*(255-f)*(255-a)*0.003921568627451},colorDodge:function(a,f){return f==255?f:Math.min(255,
(a<<8)/(255-f))},colorBurn:function(a,f){return f==0?f:Math.max(0,255-(255-a<<8)/f)},linearLight:function(a,f){return f<128?l.linearBurn(a,2*f):l.linearDodge(a,2*(f-128))},vividLight:function(a,f){return f<128?l.colorBurn(a,2*f):l.colorDodge(a,2*(f-128))},pinLight:function(a,f){return f<128?l.darken(a,2*f):l.lighten(a,2*(f-128))},hardMix:function(a,f){return l.vividLight(a,f)<128?0:255},reflect:function(a,f){return f==255?f:Math.min(255,a*a/(255-f))},glow:function(a,f){return a==255?a:Math.min(255,
f*f/(255-a))},phoenix:function(a,f){return Math.min(a,f)-Math.max(a,f)+255}};l.linearDodge=l.add;l.linearBurn=l.substract;c.blendModes=l;c.Image=function(a,f){this.height=this.width=0;this.imageData=this.context=null;this.domElement=this.canvasElement=y(this.width,this.height);this.context=this.canvasElement.getContext("2d");this._tmpCanvas=y(this.width,this.height);this._integral=this._histogram=null;this._integralRefresh=this._histogramRefresh=!0;this.setImage(a,f)};c.Image.prototype={width:0,height:0,
canvasElement:null,domElement:null,setWidth:function(a){this._tmpCanvas.width=this.canvasElement.width=this.width=a;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setHeight:function(a){this._tmpCanvas.height=this.canvasElement.height=this.height=a;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=
this._histogramRefresh=!0;return this},setImage:function(a,f){if(typeof a=="undefined"||a==null)return this;var e=this,c,h;a instanceof Image||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?(c=a,this.width=c instanceof HTMLVideoElement?c.videoWidth:c.width,this.height=c instanceof HTMLVideoElement?c.videoHeight:c.height,this._tmpCanvas.width=this.canvasElement.width=this.width,this._tmpCanvas.height=this.canvasElement.height=this.height,h=this.context=this.canvasElement.getContext("2d"),
h.drawImage(a,0,0),this.imageData=h.getImageData(0,0,this.width,this.height),this._integralRefresh=this._histogramRefresh=!0):(c=new Image,c.onload=function(){e.width=c.width;e.height=c.height;e._tmpCanvas.width=e.canvasElement.width=e.width;e._tmpCanvas.height=e.canvasElement.height=e.height;h=e.context=e.canvasElement.getContext("2d");h.drawImage(c,0,0);e.imageData=e.context.getImageData(0,0,e.width,e.height);e._histogramRefresh=!0;e._integralRefresh=!0;typeof f!="undefined"&&f.call(e)},c.src=a);
c.crossOrigin="";return this},getPixel:function(a,f){var e=~~(f*this.width+a+0.5),c=this.imageData.data;return{r:c[e],g:c[e+1],b:c[e+2],a:c[e+3]}},setPixel:function(a,f,c,g,h,i){this.context.putImageData(new e([c&255,g&255,h&255,i&255]),a,f);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},getData:function(){return new e(this.imageData.data)},setData:function(a){this.imageData.data.set(a);this.context.putImageData(this.imageData,
0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},getPixelData:function(){return this.imageData},setPixelData:function(a){this.context.putImageData(a,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},createImageData:function(a,f){this._tmpCanvas.width=this.canvasElement.width=this.width=a;this._tmpCanvas.height=this.canvasElement.height=
this.height=f;this.context=this.canvasElement.getContext("2d");this.context.createImageData(a,f);return this.imageData=this.context.getImageData(0,0,this.width,this.height)},copy:function(a){this.setData(a.getData());this.imageData=this.context.getImageData(0,0,this.width,this.height);return this},clone:function(){return new c.Image(this.canvasElement)},scale:function(a,f){a=a||1;f=f||a;if(1==a&&1==f)return this;var e=this._tmpCanvas.getContext("2d");e.scale(a,f);e.drawImage(this.canvasElement,0,
0);this.canvasElement.width=this.width=~~(a*this.width+0.5);this.canvasElement.height=this.height=~~(f*this.height+0.5);this.context.drawImage(this._tmpCanvas,0,0);this._tmpCanvas.width=this.width;this._tmpCanvas.height=this.height;this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},flipHorizontal:function(){var a=this._tmpCanvas.getContext("2d");a.translate(this.width,0);a.scale(-1,1);a.drawImage(this.canvasElement,0,0);
this.context.drawImage(this._tmpCanvas,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},flipVertical:function(){var a=this._tmpCanvas.getContext("2d");a.translate(0,this.height);a.scale(1,-1);a.drawImage(this.canvasElement,0,0);this.context.drawImage(this._tmpCanvas,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},clear:function(){if(this.width&&
this.height){var a=this.context;a.clearRect(0,0,this.width,this.height);this.imageData=a.getImageData(0,0,this.width,this.height)}return this},fill:function(a,f,e,c,h){if(!c&&this.width&&!h&&this.height)return this;else if(c&&!this.width&&h&&!this.height)this._tmpCanvas.width=this.canvasElement.width=this.width=c+f,this._tmpCanvas.height=this.canvasElement.height=this.height=h+e,this.context=this.canvasElement.getContext("2d"),this.context.createImageData(c,h),this.imageData=this.context.getImageData(0,
0,this.width,this.height);var c=c||this.width,h=h||this.height,i=this.context;i.fillStyle=a||0;i.fillRect(f||0,e||0,c,h);this.imageData=i.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},draw:function(){return this},blend:function(a,f,e,c,h){typeof f=="undefined"&&(f="normal");typeof e=="undefined"&&(e=1);e>1?e=1:e<0&&(e=0);typeof c=="undefined"&&(c=0);typeof h=="undefined"&&(h=0);var i=0,v=0,p=this.context;c<0&&(i=-c,c=0);h<0&&(v=-h,h=0);if(c>=
this.width||h>=this.height)return this;f=l[f];if(f==void 0||f==null)return this;var m=k(this.width,a.width-i),z=k(this.height,a.height-v),q=this.context.getImageData(c,h,m,z),i=a.context.getImageData(i,v,m,z),a=q.data,i=i.data,C,y,n,A=1-e,w=i.length,s;for(s=0;s<w;s+=4)C=a[s],y=a[s+1],n=a[s+2],v=f(i[s],C),m=f(i[s+1],y),z=f(i[s+2],n),a[s]=v*e+C*A,a[s+1]=m*e+y*A,a[s+2]=z*e+n*A;p.putImageData(q,c,h);this.imageData=p.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=
!0;return this},integral:function(){this._integralRefresh&&this._computeIntegral();return this._integral},histogram:function(){this._histogramRefresh&&this._computeHistogram();return this._histogram},_computeIntegral:function(){var a=this.width,e=a*this.height,j=a<<2,g=new c.Array32F(e),h=new c.Array32F(e),e=new c.Array32F(e),i=this.getPixelData().data,v,p,k,z,l,C;for(z=l=C=k=p=v=0;k<a;)z+=i[v],l+=i[v+1],C+=i[v+2],g[p]=z,h[p]=l,e[p]=C,v+=4,p++,k++;v=j;for(z=l=C=k=0;v<imLen;)z+=i[v],l+=i[v+1],C+=i[v+
2],g[p]=g[p-a]+z,h[p]=h[p-a]+l,e[p]=e[p-a]+C,v+=4,p++,k++,k>=a&&(z=l=C=k=0);this._integral=[g,h,e];this._integralRefresh=!1},_computeHistogram:function(){for(var a=this.getPixelData().data,e=0,j=a.length,g,h,i,v=0,p=0,k=0,z=255,l=255,C=255,y=new c.Array32F(256),n=new c.Array32F(256),A=new c.Array32F(256),w=1/(j>>2),e=0;e<256;)y[e]=0,n[e]=0,A[e]=0,e++;for(e=0;e<j;)g=a[e],h=a[e+1],i=a[e+2],y[g]+=w,n[h]+=w,A[i]+=w,g>v&&(v=g),g<z&&(z=g),h>p&&(p=h),h<l&&(l=h),i>k&&(k=i),i<C&&(C=i),e+=4;this._histogram=
[y,n,A];this._histogramRefresh=!1},_refresh:function(){this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);return this}}})(FILTER);
(function(c){c.CustomFilter=function(c){this._handler=c};c.CustomFilter.prototype={_handler:null,_apply:function(c,l,k,e){if(!this._handler)return c;return this._handler.call(this,c,l,k,e)},apply:function(c){if(!this._handler)return c;return c.setData(this._handler.call(this,c.getData(),c.width,c.height,c))}}})(FILTER);
(function(c){var y=c.Array32F,l=c.CONSTANTS.toRad,k=c._notSupportTypedArrays;c.ColorMatrixFilter=function(e){this._matrix=typeof e!="undefined"&&e.length?new y(e):null};c.ColorMatrixFilter.prototype={_matrix:null,channel:function(e,a){var f=(typeof a=="undefined"?0:a)?1:0;switch(e){case c.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case c.CHANNEL.BLUE:return this.concat([0,0,f,0,0,0,0,f,0,0,0,0,1,0,0,0,0,0,0,255]);case c.CHANNEL.GREEN:return this.concat([0,f,0,0,
0,0,1,0,0,0,0,f,0,0,0,0,0,0,0,255]);default:return this.concat([1,0,0,0,0,f,0,0,0,0,f,0,0,0,0,0,0,0,0,255])}},redChannel:function(e){return this.channel(c.CHANNEL.RED,e)},greenChannel:function(e){return this.channel(c.CHANNEL.GREEN,e)},blueChannel:function(e){return this.channel(c.CHANNEL.BLUE,e)},alphaChannel:function(){return this.channel(c.CHANNEL.ALPHA,!0)},maskChannel:function(e){switch(e){case c.CHANNEL.ALPHA:return this;case c.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,
0,0,0,1,0]);case c.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this.concat([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(e,a){switch(e){case c.CHANNEL.ALPHA:switch(a){case c.CHANNEL.ALPHA:return this;case c.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case c.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);default:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}case c.CHANNEL.BLUE:switch(a){case c.CHANNEL.ALPHA:return this.concat([1,
0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case c.CHANNEL.BLUE:return this;case c.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);default:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}case c.CHANNEL.GREEN:switch(a){case c.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case c.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this;default:return this.concat([0,1,0,0,0,1,0,0,0,0,
0,0,1,0,0,0,0,0,1,0])}default:switch(a){case c.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case c.CHANNEL.BLUE:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case c.CHANNEL.GREEN:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this}}},desaturate:function(){return this.concat([c.LUMA[0],c.LUMA[1],c.LUMA[2],0,0,c.LUMA[0],c.LUMA[1],c.LUMA[2],0,0,c.LUMA[0],c.LUMA[1],c.LUMA[2],0,0,0,0,0,1,0])},grayscale:function(){return this.desaturate()},
colorize:function(e,a){var f,j,g,h;typeof a=="undefined"&&(a=1);f=(e>>16&255)*0.00392156862745098;j=(e>>8&255)*0.00392156862745098;g=(e&255)*0.00392156862745098;h=1-a;return this.concat([h+a*f*c.LUMA[0],a*f*c.LUMA[1],a*f*c.LUMA[2],0,0,a*j*c.LUMA[0],h+a*j*c.LUMA[1],a*j*c.LUMA[2],0,0,a*g*c.LUMA[0],a*g*c.LUMA[1],h+a*g*c.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,
1,0,0,0,0,0,-1,255])},saturate:function(e){var a,f,j;a=1-e;f=a*c.LUMA[0];j=a*c.LUMA[1];a*=c.LUMA[2];return this.concat([f+e,j,a,0,0,f,j+e,a,0,0,f,j,a+e,0,0,0,0,0,1,0])},contrast:function(e,a,c){typeof a=="undefined"&&(a=e);typeof c=="undefined"&&(c=e);e+=1;a+=1;c+=1;this._log=!0;return this.concat([e,0,0,0,128*(1-e),0,a,0,0,128*(1-a),0,0,c,0,128*(1-c),0,0,0,1,0])},brightness:function(e,a,c){typeof a=="undefined"&&(a=e);typeof c=="undefined"&&(c=e);return this.concat([1,0,0,0,e,0,1,0,0,a,0,0,1,0,c,
0,0,0,1,0])},adjustHue:function(e){e*=l;var a=Math.cos(e),e=Math.sin(e);return this.concat([c.LUMA[0]+a*(1-c.LUMA[0])+e*-c.LUMA[0],c.LUMA[1]+a*-c.LUMA[1]+e*-c.LUMA[1],c.LUMA[2]+a*-c.LUMA[2]+e*(1-c.LUMA[2]),0,0,c.LUMA[0]+a*-c.LUMA[0]+e*0.143,c.LUMA[1]+a*(1-c.LUMA[1])+e*0.14,c.LUMA[2]+a*-c.LUMA[2]+e*-0.283,0,0,c.LUMA[0]+a*-c.LUMA[0]+e*-(1-c.LUMA[0]),c.LUMA[1]+a*-c.LUMA[1]+e*c.LUMA[1],c.LUMA[2]+a*(1-c.LUMA[2])+e*c.LUMA[2],0,0,0,0,0,1,0])},average:function(e,a,c){typeof e=="undefined"&&(e=0.3333);typeof a==
"undefined"&&(a=0.3333);typeof c=="undefined"&&(c=0.3334);return this.concat([e,a,c,0,0,e,a,c,0,0,e,a,c,0,0,0,0,0,1,0])},quickContrastCorrection:function(e){typeof e=="undefined"&&(e=1.2);return this.concat([e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0])},sepia:function(e){typeof e=="undefined"&&(e=0.5);e>1?e=1:e<0&&(e=0);return this.concat([1-0.607*e,0.769*e,0.189*e,0,0,0.349*e,1-0.314*e,0.168*e,0,0,0.272*e,0.534*e,1-0.869*e,0,0,0,0,0,1,0])},quickSepia:function(e){typeof e=="undefined"&&(e=10);e>100&&
(e=100);e*=2.55;return this.concat([c.LUMA[0],c.LUMA[1],c.LUMA[2],0,40,c.LUMA[0],c.LUMA[1],c.LUMA[2],0,20,c.LUMA[0],c.LUMA[1],c.LUMA[2],0,-e,0,0,0,1,0])},threshold:function(e,a){typeof a=="undefined"&&(a=256);return this.concat([c.LUMA[0]*a,c.LUMA[1]*a,c.LUMA[2]*a,0,-(a-1)*e,c.LUMA[0]*a,c.LUMA[1]*a,c.LUMA[2]*a,0,-(a-1)*e,c.LUMA[0]*a,c.LUMA[1]*a,c.LUMA[2]*a,0,-(a-1)*e,0,0,0,1,0])},threshold_rgb:function(e,a){typeof a=="undefined"&&(a=256);return this.concat([a,0,0,0,-(a-1)*e,0,a,0,0,-(a-1)*e,0,0,a,
0,-(a-1)*e,0,0,0,1,0])},threshold_alpha:function(e,a){typeof e=="undefined"&&(e=0.5);typeof a=="undefined"&&(a=256);return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,a,-a*e])},RGB2YCbCr:function(){return this.concat([0.5,-0.418688,-0.081312,0,128,0.299,0.587,0.114,0,0,-0.168736,-0.331264,0.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.concat([1.402,1,0,0,-179.456,-0.71414,1,-0.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(e,a){var c;if(this._matrix){c=this._matrix;
var j=e.getMatrix(),g=1-a,h=new y(20);h[0]=g*c[0]+a*j[0];h[1]=g*c[1]+a*j[1];h[2]=g*c[2]+a*j[2];h[3]=g*c[3]+a*j[3];h[4]=g*c[4]+a*j[4];h[5]=g*c[5]+a*j[5];h[6]=g*c[6]+a*j[6];h[7]=g*c[7]+a*j[7];h[8]=g*c[8]+a*j[8];h[9]=g*c[9]+a*j[9];h[10]=g*c[10]+a*j[10];h[11]=g*c[11]+a*j[11];h[12]=g*c[12]+a*j[12];h[13]=g*c[13]+a*j[13];h[14]=g*c[14]+a*j[14];h[15]=g*c[15]+a*j[15];h[16]=g*c[16]+a*j[16];h[17]=g*c[17]+a*j[17];h[18]=g*c[18]+a*j[18];h[19]=g*c[19]+a*j[19];c=h}else c=new y(e.getMatrix());this._matrix=c;return this},
concat:function(e){var a;if(this._matrix){a=this._matrix;var e=new y(e),c=new y(20),j,g,h,i,v;j=e[0];g=e[1];h=e[2];i=e[3];v=e[4];c[0]=j*a[0]+g*a[5]+h*a[10]+i*a[15];c[1]=j*a[1]+g*a[6]+h*a[11]+i*a[16];c[2]=j*a[2]+g*a[7]+h*a[12]+i*a[17];c[3]=j*a[3]+g*a[8]+h*a[13]+i*a[18];c[4]=j*a[4]+g*a[9]+h*a[14]+i*a[19]+v;j=e[5];g=e[6];h=e[7];i=e[8];v=e[9];c[5]=j*a[0]+g*a[5]+h*a[10]+i*a[15];c[6]=j*a[1]+g*a[6]+h*a[11]+i*a[16];c[7]=j*a[2]+g*a[7]+h*a[12]+i*a[17];c[8]=j*a[3]+g*a[8]+h*a[13]+i*a[18];c[9]=j*a[4]+g*a[9]+h*
a[14]+i*a[19]+v;j=e[10];g=e[11];h=e[12];i=e[13];v=e[14];c[10]=j*a[0]+g*a[5]+h*a[10]+i*a[15];c[11]=j*a[1]+g*a[6]+h*a[11]+i*a[16];c[12]=j*a[2]+g*a[7]+h*a[12]+i*a[17];c[13]=j*a[3]+g*a[8]+h*a[13]+i*a[18];c[14]=j*a[4]+g*a[9]+h*a[14]+i*a[19]+v;j=e[15];g=e[16];h=e[17];i=e[18];v=e[19];c[15]=j*a[0]+g*a[5]+h*a[10]+i*a[15];c[16]=j*a[1]+g*a[6]+h*a[11]+i*a[16];c[17]=j*a[2]+g*a[7]+h*a[12]+i*a[17];c[18]=j*a[3]+g*a[8]+h*a[13]+i*a[18];c[19]=j*a[4]+g*a[9]+h*a[14]+i*a[19]+v;a=c}else a=new y(e);this._matrix=a;return this},
combineWith:function(c){return this.concat(c.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(c){this._matrix=c;return this},_apply:function(c){if(!this._matrix)return c;for(var a=c.length,f=this._matrix,j=0,g,h,i,v,p,m,z;j<a;)g=c[j],h=c[j+1],i=c[j+2],v=c[j+3],p=f[0]*g+f[1]*h+f[2]*i+f[3]*v+f[4],m=f[5]*g+f[6]*h+f[7]*i+f[8]*v+f[9],z=f[10]*g+f[11]*h+f[12]*i+f[13]*v+f[14],g=f[15]*g+f[16]*h+f[17]*i+f[18]*v+f[19],k&&(p<0?p=0:p>255&&(p=255),m<0?m=0:m>255&&(m=255),z<0?z=0:z>255&&
(z=255),g<0?g=0:g>255&&(g=255)),c[j]=~~p,c[j+1]=~~m,c[j+2]=~~z,c[j+3]=~~g,j+=4;return c},apply:function(c){if(!this._matrix)return c;return c.setData(this._apply(c.getData(),c.width,c.height,c))},reset:function(){this._matrix=null;return this}}})(FILTER);
(function(c){function y(a){var c=new e(256),f=0;if(a)for(;f<256;)c[f]=255-f,f++;else for(;f<256;)c[f]=f,f++;return c}function l(a){for(var c=new e(256),f=0;f<256;)c[f]=a,f++;return c}function k(a){if(a)return new e(a);return null}var e=c.ImArray,a=Math.pow,f=Math.exp,j=1/255,g=y(),h=y(1);c.TableLookupFilter=function(a,c,e,f){this._tableR=a||null;this._tableG=c||this._tableR;this._tableB=e||this._tableG;this._tableA=f||null};c.TableLookupFilter.prototype={_tableR:null,_tableG:null,_tableB:null,_tableA:null,
thresholds:function(a,c,f){a.length||(a=[a]);c||(c=a);f||(f=c);var h=a.length,g=h+1,j=c.length,k=j+1,l=f.length,n=l+1,A=new e(256),w=new e(g),s=new e(256),E=new e(k),F=new e(256),P=new e(n),x,Q=255/(g-1),G=255/(k-1),N=255/(n-1);for(x=0;x<g;)w[x]=~~(Q*x),x++;a[0]=~~(255*a[0]);for(x=1;x<h;)a[x]=a[x-1]+~~(255*a[x]),x++;for(x=0;x<k;)E[x]=~~(G*x),x++;c[0]=~~(255*c[0]);for(x=1;x<j;)c[x]=c[x-1]+~~(255*c[x]),x++;for(x=0;x<n;)P[x]=~~(N*x),x++;f[0]=~~(255*f[0]);for(x=1;x<l;)f[x]=f[x-1]+~~(255*f[x]),x++;for(x=
0;x<256;){for(g=0;g<h&&x>a[g];)g++;A[x]=w[g];for(g=0;g<j&&x>c[g];)g++;s[x]=E[g];for(g=0;g<l&&x>f[g];)g++;F[x]=P[g];x++}return this.concat(A,s,F)},threshold:function(a,c,e){a=a||0.5;c=c||a;return this.thresholds([a],[c],[e||c])},quantize:function(a){typeof a=="undefined"&&(a=64);a<2&&(a=2);var c=new e(256),f=new e(a),g,h=255/(a-1),j=a/256;for(g=0;g<a;)f[g]=~~(h*g),g++;for(g=0;g<256;)c[g]=f[~~(j*g)],g++;return this.concat(c)},levels:function(a){return this.quantize(a)},posterize:function(a){return this.quantize(a)},
binarize:function(){return this.quantize(2)},solarize:function(a){typeof a=="undefined"&&(a=0.5);for(var c=0,f=new e(256),a=~~(a*256)-1,c=0;c<256;)f[c]=c>a?255-(c<<1):(c<<1)-255,c++;return this.concat(f)},invert:function(){return this.concat(h)},mask:function(a){var c=0,f=a>>16&255,g=a>>8&255;a&=255;tR=new e(256);tG=new e(256);tB=new e(256);for(c=0;c<256;)tR[c]=c&f,tG[c]=c&g,tB[c]=c&a,c++;return this.concat(tR,tG,tB)},replace:function(a,c){if(a==c)return this;var e=a>>16&255,f=a>>8&255,h=a&255,j=
c>>16&255,l=c>>8&255,y=c&255,n=k(g),A=k(g),w=k(g);n[e]=j;A[f]=l;w[h]=y;return this.concat(n,A,w)},extract:function(a,e,f){if(!e||!e.length)return this;var f=f||0,g=f>>8&255,h=f&255,f=l(f>>16&255),g=l(g),h=l(h);switch(a){case c.CHANNEL.BLUE:a=e[0];for(e=e[1];a<=e;)h[a]=a,a++;break;case c.CHANNEL.GREEN:a=e[0];for(e=e[1];a<=e;)g[a]=a,a++;break;default:a=e[0];for(e=e[1];a<=e;)f[a]=a,a++}return this.concat(f,g,h)},gammaCorrection:function(c,f,g){for(var c=c||1,f=f||c,g=g||f,c=1/c,f=1/f,g=1/g,h=new e(256),
k=new e(256),l=new e(256),C=0;C<256;)h[C]=~~(255*a(j*C,c)),k[C]=~~(255*a(j*C,f)),l[C]=~~(255*a(j*C,g)),C++;return this.concat(h,k,l)},exposure:function(a){typeof a=="undefined"&&(a=1);for(var c=0,g=new e(256),c=0;c<256;)g[c]=~~(255*(1-f(-a*c*j))),c++;return this.concat(g)},concat:function(a,c,e){if(!a)return this;var c=c||a,e=e||c,f=this._tableR||y(),g,h,j=k(f),l,n,A;if(c&&e){g=this._tableG||k(f);h=this._tableB||k(g);l=k(g);n=k(h);for(A=0;A<256;)f[A]=a[j[A]],g[A]=c[l[A]],h[A]=e[n[A]],A++;this._tableR=
f;this._tableG=g;this._tableB=h}else{for(A=0;A<256;)f[A]=a[j[A]],A++;this._tableB=this._tableG=this._tableR=f}return this},combineWith:function(a){return this.concat(a.getTable(0),a.getTable(1),a.getTable(2))},getTable:function(a){a=a||c.CHANNEL.RED;switch(a){case c.CHANNEL.ALPHA:return this._tableA;case c.CHANNEL.BLUE:return this._tableB;case c.CHANNEL.GREEN:return this._tableG;default:return this._tableR}},setTable:function(a,e){e=e||c.CHANNEL.RED;switch(e){case c.CHANNEL.ALPHA:return this._tableA=
a,this;case c.CHANNEL.BLUE:return this._tableB=a,this;case c.CHANNEL.GREEN:return this._tableG=a,this;default:return this._tableR=a,this}},_apply:function(a){if(!this._tableR)return a;var c=a.length,e=0,f,g,h,j,k=this._tableR,l=this._tableG,A=this._tableB,w=this._tableA;if(w)for(;e<c;)f=a[e],g=a[e+1],h=a[e+2],j=a[e+3],a[e]=k[f],a[e+1]=l[g],a[e+2]=A[h],a[e+3]=w[j],e+=4;else for(;e<c;)f=a[e],g=a[e+1],h=a[e+2],a[e]=k[f],a[e+1]=l[g],a[e+2]=A[h],e+=4;return a},apply:function(a){if(!this._tableR)return a;
return a.setData(this._apply(a.getData(),a.width,a.height,a))},reset:function(){this._tableA=this._tableB=this._tableG=this._tableR=null;return this}}})(FILTER);
(function(c){var y=c.ImArray,l=Math.min;c.DisplacementMapFilter=function(c){c&&this.setMap(c)};c.DisplacementMapFilter.prototype={scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:c.MODE.CLAMP,_map:null,combineWith:function(){return this},getMap:function(){return this._map},setMap:function(c){this._map=c;return this},_apply:function(k,e,a){if(!this._map)return k;var f=this._map.getData(),j=this._map.width,g=this._map.height,h=j*g,i=new c.Array16I(h<<1),v=l(j,e),p=l(g,a),m=
this.scaleX*0.00390625,z=this.scaleY*0.00390625,q=this.componentX,C=this.componentY,g=this.color>>24&255,H=this.color>>16&255,n=this.color>>8&255,A=this.color&255,w=~~this.startY,s=~~this.startX,E=this.mode,F=w*e,P=-s,x=-w,Q=e-s-1,G=a-w-1,N,O,S,T,D,b=v*p<<2,o=new y(k),J=c.MODE.IGNORE,u=c.MODE.COLOR,Z=c.MODE.WRAP;for(T=S=O=N=p=0;p<h;)D=O+T<<2,i[N]=~~((f[D+q]-128)*m),i[N+1]=~~((f[D+C]-128)*z),p++,N+=2,O++,O>=j&&(O=0,S++,T+=j);p=-4;O=-1;for(ty2=T=S=0;p<b;)if(p+=4,O++,O>=v&&(O=0,S++,T+=e,ty2+=j),!(S<
x||S>G||O<P||O>Q)){m=O+s;h=S+w;f=m+T+F<<2;N=O+ty2<<1;srcx=m+i[N];srcy=h+i[N+1];if(srcy>=a||srcy<0||srcx>=e||srcx<0)switch(E){case J:continue;case u:o[f]=H;o[f+1]=n;o[f+2]=A;o[f+3]=g;continue;case Z:srcy>G&&(srcy-=a);srcy<0&&(srcy+=a);srcx>Q&&(srcx-=e);srcx<0&&(srcx+=e);break;default:srcy>G&&(srcy=G),srcy<0&&(srcy=0),srcx>Q&&(srcx=Q),srcx<0&&(srcx=0)}N=srcx+srcy*e<<2;o[f]=k[N];o[f+1]=k[N+1];o[f+2]=k[N+2];o[f+3]=k[N+3]}return o},apply:function(c){if(!this._map)return c;return c.setData(this._apply(c.getData(),
c.width,c.height,c))},reset:function(){this._map=null;return this}}})(FILTER);
(function(c){function y(a,c){var e,f,F,g,x,h=a.length,G=new p(h);for(F=f=e=g=0;g<h;)x=c-1-e+F<<2,G[g]=a[x],G[g+1]=a[x+1],G[g+2]=a[x+2],G[g+3]=a[x+3],g+=4,e++,e>=c&&(e=0,f++,F+=c);return G}function l(a,c,e){var f,F,g,x,h=a.length,G=new p(h);F=f=g=0;for(e=(e-1)*c;g<h;)x=f+e<<2,G[g]=a[x],G[g+1]=a[x+1],G[g+2]=a[x+2],G[g+3]=a[x+3],g+=4,f++,f>=c&&(f=0,F++,e-=c);return G}function k(a,c,e){var f,F,g,x,h,G=a.length,j=new p(G);F=f=x=0;for(e=(e-1)*c;x<G;)h=c-1-f+e<<2,j[x]=a[h],j[x+1]=a[h+1],j[x+2]=a[h+2],j[x+
3]=a[h+3],x+=4,f++,f>=c&&(f=0,F++,g+=c,e-=c);return j}function e(a,c,e){var f,F,g,x,h=a.length,G=new p(h),j=e*c;f=e=g=0;for(F=j-1;g<h;)x=f+F<<2,G[g]=a[x],G[g+1]=a[x+1],G[g+2]=a[x+2],G[g+3]=a[x+3],g+=4,e++,F-=c,e>=c&&(e=0,F=j-1,f++);return G}function a(a,c){var e,f,F,g,x,h=a.length,G=new p(h);for(F=f=e=g=0;g<h;)x=c-1-f+F<<2,G[g]=a[x],G[g+1]=a[x+1],G[g+2]=a[x+2],G[g+3]=a[x+3],g+=4,e++,F+=c,e>=c&&(F=e=0,f++);return G}function f(a,e,f){var g,F,h,x,j=a.length,G=new p(j),k=this.inverseTransform,i=this.mode,
l=c.MODE.WRAP,z;for(F=g=h=0;h<j;){z=k([g,F],e,f);x=~~z[0];z=~~z[1];if(0>x||x>=e||0>z||z>=f)switch(i){case l:z>=f?z-=f:z<0&&(z+=f);x>=e?x-=e:x<0&&(x+=e);break;default:z>=f?z=f-1:z<0&&(z=0),x>=e?x=e-1:x<0&&(x=0)}x=x+z*e<<2;G[h]=a[x];G[h+1]=a[x+1];G[h+2]=a[x+2];G[h+3]=a[x+3];h+=4;g++;g>=e&&(g=0,F++)}return G}function j(a,e,f){var g,F,h,x;f*=e;var j=a.length,G=new p(j);g=this.matrix;var k=g[0],i=g[1],l=g[3],z=g[4],D=g[2],b=g[5],o=this.mode,J=c.MODE.WRAP,u,m=e-1,r=f-e;F=g=h=0;b*=e;l*=e;for(z*=e;h<j;){x=
~~(k*g+i*F+D);u=~~(l*g+z*F+b);if(0>x||x>m||0>u||u>r)switch(o){case J:u>r?u-=f:u<0&&(u+=f);x>=e?x-=e:x<0&&(x+=e);break;default:u>r?u=r:u<0&&(u=0),x>m?x=m:x<0&&(x=0)}x=x+u<<2;G[h]=a[x];G[h+1]=a[x+1];G[h+2]=a[x+2];G[h+3]=a[x+3];h+=4;g++;g>=e&&(g=0,F++)}return G}function g(a,e,f){if(0>=this.radius)return a;var g,F,h,x,j=a.length,G=new p(a),k=this.centerX,i=this.centerY,l=this.radius,v=this.mode,D=c.MODE.WRAP,b,o,J=this.angle/l,u=e-1,n=f-1;for(F=g=h=0;h<j;){b=g-k;o=F-i;x=m(b*b+o*o);if(x<l){o=z(o,b)+J*
(l-x);b=~~(k+x*C(o));o=~~(i+x*q(o));if(0>b||b>u||0>o||o>n)switch(v){case D:o>n?o-=f:o<0&&(o+=f);b>u?b-=e:b<0&&(b+=e);break;default:o>n?o=n:o<0&&(o=0),b>u?b=u:b<0&&(b=0)}x=b+o*e<<2;G[h]=a[x];G[h+1]=a[x+1];G[h+2]=a[x+2];G[h+3]=a[x+3]}h+=4;g++;g>=e&&(g=0,F++)}return G}function h(a,e,f){if(0>=this.radius)return a;var g,F,h,x,j=a.length,G=new p(a),k=this.centerX,i=this.centerY;g=this.radius;var l=this.mode,z=c.MODE.WRAP,D,b=g*g,o=1-0.555556,J,u,v,r,t=e-1,W=f-1;for(F=g=h=0;h<j;){x=g-k;D=F-i;v=x*x;r=D*D;
J=v+r;if(J<b){u=b-J;J=m(u);x=H(x/m(v+u))*o;D=H(D/m(r+u))*o;x=~~(g-J*n(x));D=~~(F-J*n(D));if(0>x||x>t||0>D||D>W)switch(l){case z:D>W?D-=f:D<0&&(D+=f);x>t?x-=e:x<0&&(x+=e);break;default:D>W?D=W:D<0&&(D=0),x>t?x=t:x<0&&(x=0)}x=x+D*e<<2;G[h]=a[x];G[h+1]=a[x+1];G[h+2]=a[x+2];G[h+3]=a[x+3]}h+=4;g++;g>=e&&(g=0,F++)}return G}function i(a){return a}function v(a){return a}var p=c.ImArray,m=Math.sqrt,z=Math.atan2,q=Math.sin,C=Math.cos,H=Math.asin,n=Math.tan;c.GeometricMapFilter=function(a){this.generic(a)};
c.GeometricMapFilter.prototype={_map:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,angle:0,radius:0,mode:c.MODE.CLAMP,generic:function(a){if(a)this.inverseTransform=a,this._map=f;return this},affine:function(a){if(a)this.matrix=a,this._map=j;return this},flipX:function(){this._map=y;return this},flipY:function(){this._map=l;return this},flipXY:function(){this._map=k;return this},rotateCW:function(){this._map=e;return this},rotateCCW:function(){this._map=a;return this},polar:function(a,
c){this.centerX=a||0;this.centerY=c||0;this._map=i;return this},cartesian:function(a,c){this.centerX=a||0;this.centerY=c||0;this._map=v;return this},twirl:function(a,c,e,f){this.angle=a||0;this.radius=c||0;this.centerX=e||0;this.centerY=f||0;this._map=g;return this},sphere:function(a,c,e){this.radius=a||0;this.centerX=c||0;this.centerY=e||0;this._map=h;return this},combineWith:function(){return this},getMap:function(){return this._map},setMap:function(a){this._map=a;return this},_apply:function(a,
c,e,f){if(!this._map)return a;return this._map.call(this,a,c,e,f)},apply:function(a){if(!this._map)return a;return a.setData(this._map.call(this,a.getData(),a.width,a.height,a))},reset:function(){this._map=null;return this}}})(FILTER);
(function(c){function y(a,c,e,f){var g=a.length,h,j=new q(a.length),e=e||1,f=f||1;for(h=0;h<g;)j[h]=e*a[h]+f*c[h],h++;return j}function l(a,c){var e,f,g=a.length,h,j=[],k=0;for(e=0;e<g;e++)for(f=0;f<g;f++)h=a[e]*c[f],k+=h,j.push(h);return{kernel:j,sum:k}}function k(a){var c,e=Array(a);for(c=0;c<a;)e[c]=1,c++;return e}function e(a){var c=H.length,e,f,g,h;a--;if(a<c)e=new q(H[a]);else for(e=new q(H[c-1]);c<=a;){f=e;e=new q(f.length+1);e[0]=1;g=0;for(h=f.length-1;g<h;g++)e[g+1]=f[g]+f[g+1];e[f.length]=
1;c<40&&H.push(Array(e));c++}return e}function a(a){var c,e=-(a>>1),f=Array(a);for(c=0;c<a;)f[c]=e,e++,c++;return f}function f(F,c){var f=e(F),g=a(F);return 1==c?l(g.reverse(),f):l(f,g)}function j(F,c){var e=k(F),f=a(F);return 1==c?l(f.reverse(),e):l(e,f)}function g(a,c,e){c=c||1;e=e||c;a*=a;var f=a>>1,g,h=new q(a);for(g=0;g<a;)h[g]=c,g++;h[f]=e;return h}function h(a,c,e,f){for(var g=a*a,h=a>>1,j=g>>1,k,i,D=new q(g),b,o,g=b=0;g<=h;g++){for(i=o=k=0;i<=h;i++)D[j+g+k]=b+o,D[j-g-k]=-b-o,D[j-g+k]=-b+o,
D[j+g-k]=b-o,k+=a,o+=e;b+=c}D[j]=f||1;return D}function i(a,c,e,f){var g=a*a,h=a>>1,j=g>>1,k=new q(g),g=new q(g),i,D,b,o=1/a;A(c)>1.0E-8?(D=1,b=e/c):(D=c/e,b=1);i=e=c=0;for(a*=b;c<=h;)g[j+c]=~~(j+e+i+0.5),g[j-c]=~~(j-e-i+0.5),c++,e+=D,i+=a;for(c=0;c<=h;)k[g[j+c]]=k[g[j-c]]=o,c++;k[j]=f||1;return k}function v(a,e,f,g,h,j,k,i,l,D){var b=a.length,o,J,u,p,r,t,m,v,B,d,A,n,L,q,y,s,w,E,H,M,X,Y,V;o=e*f;r=j*k;j>>=1;k=e*(k>>1);f=-j-1;v=-k-e;E=e-1;H=o-e;o=(o<<1)+o;m=(e<<1)+e;D=D||1;V=0;if(h){A=g[0];g=g[r>>1];
g-=A;n=h[0];h=h[r>>1];for(L=h-n;V<D;){t=new z(a);h=new c.Array32F(o);for(J=u=p=d=B=r=0;d<e;)J+=a[r],u+=a[r+1],p+=a[r+2],h[B]=J,h[B+1]=u,h[B+2]=p,r+=4,B+=3,d++;r=m+e;B=m;for(J=u=p=d=0;r<b;)J+=a[r],u+=a[r+1],p+=a[r+2],h[B]=h[B-m]+J,h[B+1]=h[B-m+1]+u,h[B+2]=h[B-m+2]+p,r+=4,B+=3,d++,d>=e&&(J=u=p=d=0);for(u=J=d=r=0;r<b;)q=d+f,y=u+v,s=d+j,w=u+k,q<0?q=0:s>E&&(s=E),y<0?y=0:w>H&&(w=H),p=q+y,B=s+w,y=s+y,M=q+w,p=(p<<1)+p,y=(y<<1)+y,M=(M<<1)+M,B=(B<<1)+B,s=A*(h[B]-h[y]-h[M]+h[p])+g*a[r],w=A*(h[B+1]-h[y+1]-h[M+
1]+h[p+1])+g*a[r+1],q=A*(h[B+2]-h[y+2]-h[M+2]+h[p+2])+g*a[r+2],X=n*(h[B]-h[y]-h[M]+h[p])+L*a[r],Y=n*(h[B+1]-h[y+1]-h[M+1]+h[p+1])+L*a[r+1],B=n*(h[B+2]-h[y+2]-h[M+2]+h[p+2])+L*a[r+2],p=i*s+l*X,y=i*w+l*Y,B=i*q+l*B,C&&(p<0?p=0:p>255&&(p=255),y<0?y=0:y>255&&(y=255),B<0?B=0:B>255&&(B=255)),t[r]=~~p,t[r+1]=~~y,t[r+2]=~~B,r+=4,d++,d>=e&&(d=0,J++,u+=e);a=t;V++}}else{A=g[0];g=g[r>>1];g-=A;i=i||1;for(l=l||0;V<D;){t=new z(a);h=new c.Array32F(o);for(J=u=p=d=B=r=0;d<e;)J+=a[r],u+=a[r+1],p+=a[r+2],h[B]=J,h[B+1]=
u,h[B+2]=p,r+=4,B+=3,d++;r=m+e;B=m;for(J=u=p=d=0;r<b;)J+=a[r],u+=a[r+1],p+=a[r+2],h[B]=h[B-m]+J,h[B+1]=h[B-m+1]+u,h[B+2]=h[B-m+2]+p,r+=4,B+=3,d++,d>=e&&(J=u=p=d=0);for(u=J=d=r=0;r<b;)q=d+f,y=u+v,s=d+j,w=u+k,q<0?q=0:s>E&&(s=E),y<0?y=0:w>H&&(w=H),p=q+y,B=s+w,y=s+y,M=q+w,p=(p<<1)+p,y=(y<<1)+y,M=(M<<1)+M,B=(B<<1)+B,s=A*(h[B]-h[y]-h[M]+h[p])+g*a[r],w=A*(h[B+1]-h[y+1]-h[M+1]+h[p+1])+g*a[r+1],q=A*(h[B+2]-h[y+2]-h[M+2]+h[p+2])+g*a[r+2],p=i*s+l,y=i*w+l,B=i*q+l,C&&(p<0?p=0:p>255&&(p=255),y<0?y=0:y>255&&(y=
255),B<0?B=0:B>255&&(B=255)),t[r]=~~p,t[r+1]=~~y,t[r+2]=~~B,r+=4,d++,d>=e&&(d=0,J++,u+=e);a=t;V++}}return t}function p(a,e,f,g,h,j,k,i){var p=matRadiusY=3,D=matHalfSideY=1,b,o=new c.Array16I(18),l=new c.Array8U(9),u=e*f,f=a.length,m=new z(f),r,t,v,y,B,d,n,q=e-1,s=u-e;for(B=y=u=t=v=0;t<9;)l[t]=u+y,o[v]=u-D,o[v+1]=B-e,v+=2,t++,u++,u>=p&&(u=0,y+=p,B+=e);if(h)for(y=u=p=0;p<f;)v=B=n=D=t=r=0,d=u+o[0],b=y+o[1],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[0]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b,b=h[l[0]],n+=a[d]*
b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[2],b=y+o[3],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[1]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b,b=h[l[1]],n+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[4],b=y+o[5],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[2]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b,b=h[l[2]],n+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[6],b=y+o[7],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[3]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b,b=h[l[3]],n+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[8],b=y+o[9],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,
b=g[l[4]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b,b=h[l[4]],n+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[10],b=y+o[11],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[5]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b,b=h[l[5]],n+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[12],b=y+o[13],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[6]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b,b=h[l[6]],n+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[14],b=y+o[15],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[7]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b,b=h[l[7]],n+=a[d]*b,B+=a[d+1]*
b,v+=a[d+2]*b),d=u+o[16],b=y+o[17],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[8]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b,b=h[l[8]],n+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),i?(r=A(r)+A(n),t=A(t)+A(B),D=A(D)+A(v)):(r=j*r+k*n,t=j*t+k*B,D=j*D+k*v),C&&(r<0?r=0:r>255&&(r=255),t<0?t=0:t>255&&(t=255),D<0?D=0:D>255&&(D=255)),m[p]=~~r,m[p+1]=~~t,m[p+2]=~~D,m[p+3]=a[p+3],p+=4,u++,u>=e&&(u=0,y+=e);else for(y=u=p=0;p<f;)D=t=r=0,d=u+o[0],b=y+o[1],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[0]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b),
d=u+o[2],b=y+o[3],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[1]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b),d=u+o[4],b=y+o[5],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[2]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b),d=u+o[6],b=y+o[7],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[3]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b),d=u+o[8],b=y+o[9],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[4]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b),d=u+o[10],b=y+o[11],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[5]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b),d=u+o[12],b=y+
o[13],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[6]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b),d=u+o[14],b=y+o[15],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[7]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b),d=u+o[16],b=y+o[17],d>=0&&d<=q&&b>=0&&b<=s&&(d=d+b<<2,b=g[l[8]],r+=a[d]*b,t+=a[d+1]*b,D+=a[d+2]*b),r=j*r+k,t=j*t+k,D=j*D+k,C&&(r<0?r=0:r>255&&(r=255),t<0?t=0:t>255&&(t=255),D<0?D=0:D>255&&(D=255)),m[p]=~~r,m[p+1]=~~t,m[p+2]=~~D,m[p+3]=a[p+3],p+=4,u++,u>=e&&(u=0,y+=e);return m}function m(a,e,f,g,h,j,k,l){var p=matRadiusY=
5,i=matHalfSideY=2,b,o=new c.Array16I(50),m=new c.Array8U(25),u=e*f,f=a.length,y=new z(f),r,t,v,n,B,d,q,s=e-1,w=u-e;for(B=n=u=t=v=0;t<25;)m[t]=u+n,o[v]=u-i,o[v+1]=B-e,v+=2,t++,u++,u>=p&&(u=0,n+=p,B+=e);if(h)for(n=u=p=0;p<f;)v=B=q=i=t=r=0,d=u+o[0],b=n+o[1],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[0]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[0]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[2],b=n+o[3],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[1]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[1]],q+=a[d]*b,B+=a[d+
1]*b,v+=a[d+2]*b),d=u+o[4],b=n+o[5],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[2]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[2]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[6],b=n+o[7],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[3]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[3]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[8],b=n+o[9],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[4]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[4]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[10],b=n+o[11],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[5]],
r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[5]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[12],b=n+o[13],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[6]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[6]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[14],b=n+o[15],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[7]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[7]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[16],b=n+o[17],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[8]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[8]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+
2]*b),d=u+o[18],b=n+o[19],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[9]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[9]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[20],b=n+o[21],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[10]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[10]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[22],b=n+o[23],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[11]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[11]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[24],b=n+o[25],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[12]],
r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[12]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[26],b=n+o[27],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[13]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[13]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[28],b=n+o[29],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[14]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[14]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[30],b=n+o[31],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[15]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[15]],q+=a[d]*b,B+=a[d+1]*b,
v+=a[d+2]*b),d=u+o[32],b=n+o[33],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[16]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[16]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[34],b=n+o[35],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[17]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[17]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[36],b=n+o[27],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[18]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[18]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[38],b=n+o[39],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,
b=g[m[19]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[19]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[40],b=n+o[41],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[20]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[20]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[42],b=n+o[43],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[21]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[21]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[44],b=n+o[45],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[22]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[22]],q+=a[d]*b,
B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[46],b=n+o[47],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[23]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[23]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),d=u+o[48],b=n+o[49],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[24]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b,b=h[m[24]],q+=a[d]*b,B+=a[d+1]*b,v+=a[d+2]*b),l?(r=A(r)+A(q),t=A(t)+A(B),i=A(i)+A(v)):(r=j*r+k*q,t=j*t+k*B,i=j*i+k*v),C&&(r<0?r=0:r>255&&(r=255),t<0?t=0:t>255&&(t=255),i<0?i=0:i>255&&(i=255)),y[p]=~~r,y[p+1]=~~t,y[p+2]=~~i,y[p+3]=a[p+
3],p+=4,u++,u>=e&&(u=0,n+=e);else for(n=u=p=0;p<f;)i=t=r=0,d=u+o[0],b=n+o[1],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[0]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[2],b=n+o[3],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[1]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[4],b=n+o[5],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[2]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[6],b=n+o[7],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[3]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[8],b=n+o[9],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=
g[m[4]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[10],b=n+o[11],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[5]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[12],b=n+o[13],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[6]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[14],b=n+o[15],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[7]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[16],b=n+o[17],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[8]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[18],b=n+o[19],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[9]],
r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[20],b=n+o[21],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[10]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[22],b=n+o[23],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[11]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[24],b=n+o[25],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[12]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[26],b=n+o[27],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[13]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[28],b=n+o[29],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[14]],r+=
a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[30],b=n+o[31],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[15]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[32],b=n+o[33],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[16]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[34],b=n+o[35],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[17]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[36],b=n+o[27],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[18]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[38],b=n+o[39],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[19]],r+=a[d]*
b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[40],b=n+o[41],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[20]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[42],b=n+o[43],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[21]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[44],b=n+o[45],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[22]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[46],b=n+o[47],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[23]],r+=a[d]*b,t+=a[d+1]*b,i+=a[d+2]*b),d=u+o[48],b=n+o[49],d>=0&&d<=s&&b>=0&&b<=w&&(d=d+b<<2,b=g[m[24]],r+=a[d]*b,
t+=a[d+1]*b,i+=a[d+2]*b),r=j*r+k,t=j*t+k,i=j*i+k,C&&(r<0?r=0:r>255&&(r=255),t<0?t=0:t>255&&(t=255),i<0?i=0:i>255&&(i=255)),y[p]=~~r,y[p+1]=~~t,y[p+2]=~~i,y[p+3]=a[p+3],p+=4,u++,u>=e&&(u=0,n+=e);return y}var z=c.ImArray,q=c.Array32F,C=c._notSupportTypedArrays,H=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],n=c.CONSTANTS.toRad,A=Math.abs,w=Math.sqrt,s=Math.sin,E=Math.cos;c.ConvolutionMatrixFilter=function(a,c,e){typeof a!=
"undefined"&&a.length?(this.set(a,~~(w(a.length)+0.5),c||1),this._bias=e||0):(this._matrix=null,this._dim=0);this._matrix2=null;this._coeff1=this._coeff2=0;this._dim2=this._dim;this._isGrad=!1;this._doFast=0;this._doSeparable=!1};c.ConvolutionMatrixFilter.prototype={_dim:0,_dim2:0,_matrix:null,_matrix2:null,_factor:1,_bias:0,_coeff1:0,_coeff2:0,lowPass:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;this.set(g(a),a,1/(a*a));this._doFast=1;return this},highPass:function(a,c){var a=typeof a=="undefined"?
3:a%2?a:a+1,e=-(typeof c=="undefined"?1:c)/(a*a);this.set(g(a,e,1+e),a,1);this._doFast=1;return this},boxBlur:function(a){return this.lowPass(a)},glow:function(a,c){return this.highPass(c,-(typeof a=="undefined"?0.5:a))},sharpen:function(a,c){return this.highPass(c,typeof a=="undefined"?0.5:a)},verticalBlur:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;this.set(k(a),1,1/a);this._dim2=a;this._doFast=1;return this},horizontalBlur:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;this.set(k(a),a,1/a);
this._doFast=this._dim2=1;return this},directionalBlur:function(a,c){c=typeof c=="undefined"?3:c%2?c:c+1;a*=n;var e=E(a),f=-s(a);return this.set(i(c,e,f,1/c),c,1)},fastGauss:function(a,c){c=typeof c=="undefined"?3:c%2?c:c+1;a=~~(a||1);a<1?a=1:a>3&&(a=3);this.set(g(c),c,1/(c*c));this._doFast=a;return this},binomialLowPass:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=e(a),f=1/(1<<a-1);this.set(c,a,1);this._matrix2=new q(c);this._coeff1=this._coeff2=f;this._doSeparable=!0;return this},binomialHighPass:function(a){var a=
typeof a=="undefined"?3:a%2?a:a+1,c;c=e(a);c=l(c,c);return this.set(y(g(a),new q(c.kernel),1,-1/c.sum),a,1)},gaussBlur:function(a){return this.binomialLowPass(a)},prewittX:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(j(a,0).kernel,a,1)},prewittY:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(j(a,1).kernel,a,1)},prewittDirectional:function(a,c){c=typeof c=="undefined"?3:c%2?c:c+1;a*=n;var e=E(a),f=s(a),g=j(c,0),h=j(c,1);return this.set(y(new q(g.kernel),new q(h.kernel),
e,f),c,1)},prewitt:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=j(a,0),e=j(a,1);this.set(c.kernel,a,1);this._isGrad=!0;this._matrix2=new q(e.kernel);return this},gradX:function(a){return this.prewittX(a)},gradY:function(a){return this.prewittY(a)},gradDirectional:function(a,c){return this.prewittDirectional(a,c)},grad:function(a){return this.prewitt(a)},sobelX:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(f(a,0).kernel,a,1)},sobelY:function(a){a=typeof a=="undefined"?3:
a%2?a:a+1;return this.set(f(a,1).kernel,a,1)},sobelDirectional:function(a,c){c=typeof c=="undefined"?3:c%2?c:c+1;a*=n;var e=E(a),g=s(a),h=f(c,0),j=f(c,1);return this.set(y(new q(h.kernel),new q(j.kernel),e,g),c,1)},sobel:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,c=f(a,0),e=f(a,1);this.set(c.kernel,a,1);this._matrix2=new q(e.kernel);this._isGrad=!0;return this},laplace:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;this.set(g(a,-1,a*a-1),a,1);this._doFast=1;return this},emboss:function(a,
c,e){var e=typeof e=="undefined"?3:e%2?e:e+1,a=typeof a=="undefined"?-0.25*Math.PI:a*n,c=c||1,f=c*E(a),a=-c*s(a);return this.set(h(e,f,a,1),e,1)},edges:function(a){a=a||1;return this.set([0,a,0,a,-4*a,a,0,a,0],3,1)},set:function(a,c,e){this._matrix2=null;this._coeff1=this._coeff2=0;this._isGrad=!1;this._doFast=0;this._doSeparable=!1;this._matrix=new q(a);this._dim2=this._dim=c;this._factor=e||1;return this},combineWith:function(){return this},getMatrix:function(){return this._matrix},setMatrix:function(a,
c){this._matrix=a;this._dim2=this._dim=c;this._matrix2=null;this._coeff1=this._coeff2=0;this._isGrad=!1;this._doFast=0;this._doSeparable=!1;return this},_apply:function(a,e,f){if(!this._matrix)return a;if(this._doFast)return this._matrix2?v(a,e,f,this._matrix,this._matrix2,this._dim,this._dim2,this._coeff1,this._coeff2,this._doFast):v(a,e,f,this._matrix,null,this._dim,this._dim2,this._factor,this._bias,this._doFast);else if(this._doSeparable){var g=this._dim,h=this._dim2,j=a.length,i,k,l,n,b,o,s,
u,y,r,t,q,w,B,d,E,H,L,R,U,K,I;k=[h,g];l=[this._matrix2,this._matrix];i=[1,g];g=[0,g>>1];h=[h>>1,0];U=[this._coeff2,this._coeff1];L=e-1;R=e*f-e;for(I=2;--I;){u=new z(a);f=k[I];s=l[I];b=g[I];o=h[I];n=i[I];K=U[I];r=new c.Array16I(f<<1);y=new c.Array8U(f);d=B=w=q=t=0;for(o*=e;q<f;)y[q]=w+B,r[t]=w-b,r[t+1]=d-o,t+=2,q++,w++,w>=n&&(w=0,B+=n,d+=e);for(B=w=n=0;n<j;){for(q=t=b=d=o=0;q<f;)E=w+r[t],H=B+r[t+1],E>=0&&E<=L&&H>=0&&H<=R&&(srcOff=E+H<<2,E=K*s[y[q]],o+=a[srcOff]*E,d+=a[srcOff+1]*E,b+=a[srcOff+2]*E),
t+=2,q++;t=o;q=d;C&&(t<0?t=0:t>255&&(t=255),q<0?q=0:q>255&&(q=255),b<0?b=0:b>255&&(b=255));u[n]=~~t;u[n+1]=~~q;u[n+2]=~~b;u[n+3]=a[n+3];n+=4;w++;w>=e&&(w=0,B+=e)}a=u}return u}else if(3==this._dim)return this._matrix2?p(a,e,f,this._matrix,this._matrix2,this._coeff1,this._coeff2,this._isGrad):p(a,e,f,this._matrix,null,this._factor,this._bias,!1);else if(5==this._dim)return this._matrix2?m(a,e,f,this._matrix,this._matrix2,this._coeff1,this._coeff2,this._isGrad):m(a,e,f,this._matrix,null,this._factor,
this._bias,!1);j=t=this._dim;q=t>>1;u=t*j;n=(j>>1)*e;j=this._matrix;B=this._factor;R=this._bias;i=this._matrix2;k=this._isGrad;l=new c.Array16I(u<<1);g=new c.Array8U(u);f*=e;h=a.length;L=new z(h);U=e-1;y=f-e;r=this._coeff1;w=this._coeff2;for(b=s=f=I=K=0;I<u;)g[I]=f+s,l[K]=f-q,l[K+1]=b-n,K+=2,I++,f++,f>=t&&(f=0,s+=t,b+=e);if(i)for(s=f=t=0;t<h;){for(I=K=B=R=o=q=n=b=0;I<u;)d=f+l[K],E=s+l[K+1],d>=0&&d<=U&&E>=0&&E<=y&&(d=d+E<<2,E=j[g[I]],b+=a[d]*E,n+=a[d+1]*E,q+=a[d+2]*E,E=i[g[I]],o+=a[d]*E,R+=a[d+1]*
E,B+=a[d+2]*E),K+=2,I++;k?(K=A(b)+A(o),I=A(n)+A(R),q=A(q)+A(B)):(K=r*b+w*o,I=r*n+w*R,q=r*q+w*B);C&&(K<0?K=0:K>255&&(K=255),I<0?I=0:I>255&&(I=255),q<0?q=0:q>255&&(q=255));L[t]=~~K;L[t+1]=~~I;L[t+2]=~~q;L[t+3]=a[t+3];t+=4;f++;f>=e&&(f=0,s+=e)}else for(s=f=t=0;t<h;){for(I=K=q=n=b=0;I<u;)d=f+l[K],E=s+l[K+1],d>=0&&d<=U&&E>=0&&E<=y&&(d=d+E<<2,E=j[g[I]],b+=a[d]*E,n+=a[d+1]*E,q+=a[d+2]*E),K+=2,I++;K=B*b+R;I=B*n+R;q=B*q+R;C&&(K<0?K=0:K>255&&(K=255),I<0?I=0:I>255&&(I=255),q<0?q=0:q>255&&(q=255));L[t]=~~K;L[t+
1]=~~I;L[t+2]=~~q;L[t+3]=a[t+3];t+=4;f++;f>=e&&(f=0,s+=e)}return L},apply:function(a){if(!this._matrix)return a;return a.setData(this._apply(a.getData(),a.width,a.height,a))},reset:function(){this._matrix2=this._matrix=null;this._dim=0;return this}}})(FILTER);
(function(c){var y=c.ImArray,l=function(a,e,g){var h=this._dim,i=h>>1,k=h*h,p=i*e,m=new c.Array32I(k<<1),l=e*g,g=a.length,q=new y(g),C,H,n,A=[],w=[],s=[];k<<=1;var E=e-1,F=l-e;for(H=l=C=0;C<k;)m[C]=l-i,m[C+1]=H-p,C+=2,l++,l>=h&&(l=0,H+=e);for(H=l=h=0;h<g;){A.length=0;w.length=0;for(C=s.length=0;C<k;)i=l+m[C],p=H+m[C+1],i>=0&&i<=E&&p>=0&&p<=F&&(n=i+p<<2,i=a[n],p=a[n+1],n=a[n+2],A.push(i),w.push(p),s.push(n)),C+=2;A.sort();w.sort();s.sort();p=A.length;n=p>>1;C=p%2?A[n+1]:~~(0.5*(A[n]+A[n+1]));p=w.length;
n=p>>1;i=p%2?w[n+1]:~~(0.5*(w[n]+w[n+1]));p=s.length;n=p>>1;p=p%2?s[n+1]:~~(0.5*(s[n]+s[n+1]));q[h]=C;q[h+1]=i;q[h+2]=p;q[h+3]=a[h+3];h+=4;l++;l>=e&&(l=0,H+=e)}return q},k=function(a,e,g){var h=this._dim,i=h>>1,k=h*h,l=i*e,m=new c.Array32I(k<<1),z=e*g,g=a.length,q=new y(g),C,H,n,A,w,s;k<<=1;var E=e-1,F=z-e;for(H=C=z=0;z<k;)m[z]=C-i,m[z+1]=H-l,z+=2,C++,C>=h&&(C=0,H+=e);for(H=C=h=0;h<g;){for(z=s=l=i=0;z<k;)n=C+m[z],A=H+m[z+1],n>=0&&n<=E&&A>=0&&A<=F&&(w=n+A<<2,n=a[w],A=a[w+1],w=a[w+2],n>i&&(i=n),A>l&&
(l=A),w>s&&(s=w)),z+=2;q[h]=i;q[h+1]=l;q[h+2]=s;q[h+3]=a[h+3];h+=4;C++;C>=e&&(C=0,H+=e)}return q},e=function(a,e,g){var h=this._dim,i=h>>1,k=h*h,l=i*e,m=new c.Array32I(k<<1),z=e*g,g=a.length,q=new y(g),C,H,n,A,w,s;k<<=1;var E=e-1,F=z-e;for(H=C=z=0;z<k;)m[z]=C-i,m[z+1]=H-l,z+=2,C++,C>=h&&(C=0,H+=e);for(H=C=h=0;h<g;){s=l=i=255;for(z=0;z<k;)n=C+m[z],A=H+m[z+1],n>=0&&n<=E&&A>=0&&A<=F&&(w=n+A<<2,n=a[w],A=a[w+1],w=a[w+2],n<i&&(i=n),A<l&&(l=A),w<s&&(s=w)),z+=2;q[h]=i;q[h+1]=l;q[h+2]=s;q[h+3]=a[h+3];h+=4;
C++;C>=e&&(C=0,H+=e)}return q},a=function(a){return a};c.StatisticalFilter=function(){this._dim=0;this._apply=a};c.StatisticalFilter.prototype={_dim:0,median:function(a){this._dim=typeof a=="undefined"?3:a%2?a:a+1;this._apply=l;return this},erode:function(a){this._dim=typeof a=="undefined"?3:a;this._apply=e;return this},dilate:function(a){this._dim=typeof a=="undefined"?3:a;this._apply=k;return this},_apply:function(a){return a},apply:function(a){if(!this._dim)return a;return a.setData(this._apply(a.getData(),
a.width,a.height,a))},reset:function(){this._apply=a;this._dim=0;return this}}})(FILTER);(function(c){var y=c._notSupportTypedArrays;c.NoiseFilter=c.Create({min:-127,max:127,init:function(c,k){this.min=c||-127;this.max=k||127},apply:function(c){var k=this.max-this.min,e=Math.random,a=this.min,f,j=c.length,g,h,i,v;for(f=0;f<j;)h=c[f],i=c[f+1],v=c[f+2],g=k*e()+a,h+=g,i+=g,g=v+g,y&&(h<0?h=0:h>255&&(h=255),i<0?i=0:i>255&&(i=255),g<0?g=0:g>255&&(g=255)),c[f]=~~h,c[f+1]=~~i,c[f+2]=~~g,f+=4;return c}})})(FILTER);
(function(c){var y=c._notSupportTypedArrays;c.HistogramEqualizeFilter=c.Create({apply:function(l){var k,e,a,f;f=0;var j=255,g=new c.Array32F(256),h=new c.Array32F(256),i=0,v,p,m,z=l.length;m=z>>2;v=1/m;var q=Array(m);p=c.Color.RGB2YCbCr;var C=c.Color.YCbCr2RGB;for(m=0;m<256;)g[m]=0,h[m]=0,m++;for(i=m=0;m<z;){k=l[m];e=l[m+1];a=l[m+2];k=p({r:k,g:e,b:a});g[k.y]+=v;if(k.y>f)f=k.y;if(k.y<j)j=k.y;q[i]=k;m+=4;i++}for(m=i=0;m<256;)i+=g[m],h[m]=i,m++;f-=j;for(i=m=0;m<z;)k=q[i],k.y=h[k.y]*f+j,p=C(k),g=p.r,
v=p.g,p=p.b,y&&(g<0?g=0:g>255&&(g=255),v<0?v=0:v>255&&(v=255),p<0?p=0:p>255&&(p=255)),l[m]=~~g,l[m+1]=~~v,l[m+2]=~~p,m+=4,i++;return l}})})(FILTER);
(function(c){var y=c._notSupportTypedArrays;c.RGBHistogramEqualizeFilter=c.Create({apply:function(l){var k,e,a,f,j,g;g=j=f=0;var h=255,i=255,v=255,p=new c.Array32F(256),m=new c.Array32F(256),z=new c.Array32F(256),q=new c.Array32F(256),C=new c.Array32F(256),H=new c.Array32F(256),n,A=l.length,w=1/(A>>2);for(n=0;n<256;)p[n]=0,m[n]=0,z[n]=0,q[n]=0,C[n]=0,H[n]=0,n++;for(n=0;n<A;)k=l[n],e=l[n+1],a=l[n+2],p[k]+=w,m[e]+=w,z[a]+=w,k>f&&(f=k),k<h&&(h=k),e>j&&(j=e),e<i&&(i=e),a>g&&(g=a),a<v&&(v=a),n+=4;for(n=
a=e=k=0;n<256;)a+=p[n],q[n]=a,e+=m[n],C[n]=e,k+=z[n],H[n]=k,n++;f-=h;j-=i;g-=v;for(n=0;n<A;)k=l[n],e=l[n+1],a=l[n+2],k=q[k]*f+h,e=C[e]*j+i,a=H[a]*g+v,y&&(k<0?k=0:k>255&&(k=255),e<0?e=0:e>255&&(e=255),a<0?a=0:a>255&&(a=255)),l[n]=~~k,l[n+1]=~~e,l[n+2]=~~a,n+=4;return l}})})(FILTER);
(function(c){var y=Math.sqrt,l=c._notSupportTypedArrays;c.PixelateFilter=c.Create({scale:1,init:function(c){this.scale=c||1},apply:function(k,e,a){if(this.scale<=1)return k;if(this.scale>100)this.scale=100;var f=k.length,j=e*a,a=~~(y(j)*this.scale*0.01),g=a*a,h=1/g,i=a<<2,v=e*a;g<<=2;var p=new c.Array32F(j*3),m,z,q,C=(e<<1)+e,H,n,A,w,s,E,F,P,x,Q,G;H=a-1;n=(a-1)*e;x=e-1;Q=j-e;for(m=z=q=w=A=j=0;w<e;)m+=k[j],z+=k[j+1],q+=k[j+2],p[A]=m,p[A+1]=z,p[A+2]=q,j+=4,A+=3,w++;j=C+e;A=C;for(m=z=q=w=0;j<f;)m+=k[j],
z+=k[j+1],q+=k[j+2],p[A]=p[A-C]+m,p[A+1]=p[A-C+1]+z,p[A+2]=p[A-C+2]+q,j+=4,A+=3,w++,w>=e&&(m=z=q=w=0);for(C=w=j=0;j<f;){m=w;s=C;E=w+H;z=C+n;E>x&&(E=x);z>Q&&(z=Q);A=m+s;q=E+z;s=E+s;E=m+z;A=(A<<1)+A;s=(s<<1)+s;E=(E<<1)+E;q=(q<<1)+q;m=h*(p[q]-p[s]-p[E]+p[A]);z=h*(p[q+1]-p[s+1]-p[E+1]+p[A+1]);G=h*(p[q+2]-p[s+2]-p[E+2]+p[A+2]);l&&(m<0?m=0:m>255&&(m=255),z<0?z=0:z>255&&(z=255),G<0?G=0:G>255&&(G=255));m=~~m;z=~~z;G=~~G;A=j;s=w;E=C;P=w+a;q=j+g;for(q>f&&(q=f);A<q;)if(F=s+E<<2,k[F]=m,k[F+1]=z,k[F+2]=G,A+=4,
s++,s>=e||s>=P)s=w,E+=e;j+=i;w+=a;w>=e&&(w=0,C+=v)}return k}})})(FILTER);(function(c){var y=c._notSupportTypedArrays;c.HSVConverterFilter=c.Create({apply:function(l,k,e){for(var a,f,j=l.length,g=c.Color.RGB2HSV,k=0;k<j;)a=l[k],e=l[k+1],f=l[k+2],f=g({r:a,g:e,b:f}),e=f.h*0.7083333333333334,a=f.s*255,f=f.v,y&&(e<0?e=0:e>255&&(e=255),f<0?f=0:f>255&&(f=255),a<0?a=0:a>255&&(a=255)),l[k]=~~e,l[k+1]=~~f,l[k+2]=~~a,k+=4;return l}})})(FILTER);
(function(c){var y=c._notSupportTypedArrays;c.HueExtractorFilter=c.Create({range:null,background:0,init:function(c,k){this.range=c;this.background=k||0},apply:function(l){if(!this.range||!this.range.length)return l;var k,e,a,f,j,g,h=l.length,i,v=c.Color.RGB2HSV,p=this.range[0],m=this.range[this.range.length-1];f=new c.ImArray(h);i=c.Color.Color2RGBA(this.background||0);for(g=0;g<h;)k=l[g],e=l[g+1],a=l[g+2],k=v({r:k,g:e,b:a}).h,k>=p&&k<=m?(k=l[g],e=l[g+1],a=l[g+2],j=l[g+3]):(k=i.r,e=i.g,a=i.b,j=i.a),
y&&(k<0?k=0:k>255&&(k=255),e<0?e=0:e>255&&(e=255),a<0?a=0:a>255&&(a=255),j<0?j=0:j>255&&(j=255)),f[g]=~~k,f[g+1]=~~e,f[g+2]=~~a,f[g+3]=~~j,g+=4;return f}})})(FILTER);
(function(c){c.AlphaMaskFilter=c.Create({alphaMask:null,centerX:0,centerY:0,init:function(c,l,k){this.alphaMask=c||null;this.centerX=l||0;this.centerY=k||0},apply:function(c,l,k){if(!this.alphaMask)return c;var e=this.alphaMask.getData(),a=c.length,f=this.alphaMask.width,j=this.alphaMask.height,g,h,i,v=Math.min(l,f),p=Math.min(k,j),m,z;m=this.centerX+(l-f>>1);z=this.centerY+(k-j>>1);for(g=j=k=0;k<a;)h=j-m,i=g-z,h>=0&&h<v&&i>=0&&i<p?(h=h+i*f<<2,c[k+3]=e[h+3]):c[k+3]=0,k+=4,j++,j>=l&&(j=0,g++);return c}})})(FILTER);
(function(c){var y=c._notSupportTypedArrays;c.ThresholdFilter=c.Create({thresholds:null,quantizedColors:null,init:function(c,k){this.thresholds=c;this.quantizedColors=k||null},apply:function(l){if(!this.thresholds||!this.thresholds.length)return l;else if(!this.quantizedColors||!this.quantizedColors.length)return l;var k,e,a,f,j,g=l.length,h=c.Color.RGBA2Color,i=c.Color.Color2RGBA,v=this.thresholds,p=v.length,m=this.quantizedColors,z=m.length;for(j=0;j<g;){k=h({r:l[j],g:l[j+1],b:l[j+2],a:l[j+3]});
for(e=0;e<p&&k>v[e];)e++;k=e<z?m[e]:255;f=i(k);k=f.r;e=f.g;a=f.b;f=f.a;y&&(k<0?k=0:k>255&&(k=255),e<0?e=0:e>255&&(e=255),a<0?a=0:a>255&&(a=255),f<0?f=0:f>255&&(f=255));l[j]=~~k;l[j+1]=~~e;l[j+2]=~~a;l[j+3]=~~f;j+=4}return l}})})(FILTER);(function(c){c.YCbCrConverterFilter=c.Create({apply:function(y){var l,k,e,a,f=y.length,j=c.Color.RGB2YCbCr;for(a=0;a<f;)l=y[a],k=y[a+1],e=y[a+2],l=j({r:l,g:k,b:e}),y[a]=l.cr,y[a+1]=l.y,y[a+2]=l.cb,a+=4;return y}})})(FILTER);
(function(c){var y=Math.log,l=Math.abs,k=c._notSupportTypedArrays;c.BokehFilter=c.Create({centerX:0,centerY:0,radius:10,amount:10,init:function(c,a,f,j){this.centerX=c||0;this.centerY=a||0;this.radius=f||10;this.amount=j||10},apply:function(e,a,f){var j=e.length,g,h,i,v,p,m,z,q,C,H=this.centerX,n=this.centerY,A=this.radius,w=this.amount,s,E,F,P;if(w<=0)return e;C=new c.ImArray(e);g=a*f;f=a-1;P=g-a;p=(a<<1)+a;g=new c.Array32F((g<<1)+g);for(h=i=v=q=z=m=0;q<a;)h+=e[m],i+=e[m+1],v+=e[m+2],g[z]=h,g[z+
1]=i,g[z+2]=v,m+=4,z+=3,q++;m=p+a;z=p;for(h=i=v=q=0;m<j;)h+=e[m],i+=e[m+1],v+=e[m+2],g[z]=g[z-p]+h,g[z+1]=g[z-p+1]+i,g[z+2]=g[z-p+2]+v,m+=4,z+=3,q++,q>=a&&(h=i=v=q=0);for(p=e=q=m=0;m<j;)h=q-H,i=e-n,h=l(h)+l(i),v=h>A?~~y((h-A)*w):~~(h/A+0.5),v>0&&(i=v*a,h=0.25/(v*v),z=q-v,s=p-i,E=q+v,F=p+i,z<0?z=0:E>f&&(E=f),s<0?s=0:F>P&&(F=P),i=z+s,v=E+F,s=E+s,F=z+F,i=(i<<1)+i,s=(s<<1)+s,F=(F<<1)+F,v=(v<<1)+v,z=h*(g[v]-g[s]-g[F]+g[i]),E=h*(g[v+1]-g[s+1]-g[F+1]+g[i+1]),h*=g[v+2]-g[s+2]-g[F+2]+g[i+2],k&&(z<0?z=0:z>
255&&(z=255),E<0?E=0:E>255&&(E=255),h<0?h=0:h>255&&(h=255)),C[m]=~~z,C[m+1]=~~E,C[m+2]=~~h),m+=4,q++,q>=a&&(q=0,e++,p+=a);return C}})})(FILTER);
