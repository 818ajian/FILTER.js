/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.6
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/var FILTER=FILTER||{};
(function(b){function m(b,f){var b=b||{},a;for(a in f)f&&Object.prototype.hasOwnProperty.call(f,a)&&(b[a]=f[a]);return b}b.Array32F=typeof Float32Array!=="undefined"?Float32Array:Array;b.Array64F=typeof Float64Array!=="undefined"?Float64Array:Array;b.Array8I=typeof Int8Array!=="undefined"?Int8Array:Array;b.Array16I=typeof Int16Array!=="undefined"?Int16Array:Array;b.Array32I=typeof Int32Array!=="undefined"?Int32Array:Array;b.Array8U=typeof Uint8Array!=="undefined"?Uint8Array:Array;b.Array16U=typeof Uint16Array!==
"undefined"?Uint16Array:Array;b.Array32U=typeof Uint32Array!=="undefined"?Uint32Array:Array;b.ImArray=typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:b.Array8U;b.CONSTANTS={PI:Math.PI,SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI};b.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3};b.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4};b.LUMA=new b.Array32F([0.212671,0.71516,0.072169]);b.Filter=function(){};b.Filter.prototype={_apply:function(){},apply:function(){},reset:function(){}};b.CompositeFilter=function(b){this._stack=
typeof b!="undefined"&&b.length?b:[]};b.CompositeFilter.prototype={_stack:[],_apply:function(b,f,a){if(!this._stack.length)return b;for(var d=this._stack,c=d.length,g=0,e;g<c;)(e=d[g++])&&(b=e._apply(b,f,a));return b},apply:function(b){if(!this._stack.length)return b;return b.setData(this._apply(im=b.getData(),b.width,b.height))},filters:function(b){if(b)this._stack=b;return this},push:function(b){this._stack.push(b);return this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},
unshift:function(b){this._stack.unshift(b);return this},concat:function(b){return this.push(b)},getAt:function(b){return this._stack.length>b?this._stack[b]:null},setAt:function(b,f){this._stack.length>b&&(this._stack[b]=f);return this},insertAt:function(b,f){this._stack.splice(b,0,f);return this},removeAt:function(b){this._stack.splice(b,1);return this},remove:function(b){for(var f=this._stack.length;--f>=0;)b===this._stack[f]&&this._stack.splice(f,1);return this},reset:function(){this._stack.length=
0;return this}};b.Create=function(b){var f=function(){this.init.apply(this,Array.prototype.slice.call(arguments))},b=m({init:function(){},reset:function(){return this},apply:function(a){return a}},b);b._apply=b.apply;b.apply=function(a){return a.setData(this._apply(a.getData(),a.width,a.height))};f.prototype=m(f.prototype,b);return f}})(FILTER);
(function(b){var m=Math.sqrt,j=Math.min,f=Math.max;b.Color={blend:function(a,d,c){return{r:a.r-~~((a.r-d.r)*c+0.5),g:a.g-~~((a.g-d.g)*c+0.5),b:a.b-~~((a.b-d.b)*c+0.5)}},toGray:function(a,d,c){var f=b.LUMA;return~~(f[0]*a+f[1]*d+f[2]*c)},distance:function(a,d){var c=a.r-d.r,b=a.g-d.g,f=a.b-d.b;return m(c*c+b*b+f*f)},RGB2Color:function(a){return a.r<<16|a.g<<8|a.b&255},RGBA2Color:function(a){return a.a<<24|a.r<<16|a.g<<8|a.b&255},Color2RGBA:function(a){a=~~a;return{r:a>>16&255,g:a>>8&255,b:a&255,a:a>>
24&255}},RGB2YCbCr:function(a){var d=a.r,c=a.g,a=a.b;return{y:~~(0+0.299*d+0.587*c+0.114*a),cb:~~(128-0.168736*d-0.331264*c+0.5*a),cr:~~(128+0.5*d-0.418688*c-0.081312*a)}},YCbCr2RGB:function(a){var d=a.y,c=a.cb,a=a.cr;return{r:~~(d+1.402*(a-128)),g:~~(d-0.34414*(c-128)-0.71414*(a-128)),b:~~(d+1.772*(c-128))}},RGB2HSV:function(a){var d,c,b,e;c=a.r;b=a.g;e=a.b;d=j(c,b,e);a=f(c,b,e);d=a-d;if(a==0)return{h:0,s:0,v:a};c=c==a?(b-e)/d:b==a?2+(e-c)/d:4+(c-b)/d;c*=60;c<0&&(c+=360);return{h:c,s:d/a,v:a}},HSV2RGB:function(a){var d,
c,b,f,h;b=a.h;h=a.s;a=a.v;if(h==0)return d=c=a,{r:d,g:c,b:a};b/=60;d=~~b;c=b-d;b=a*(1-h);f=a*(1-h*c);h=a*(1-h*(1-c));switch(d){case 0:d=a;c=h;a=b;break;case 1:d=f;c=a;a=b;break;case 2:d=b;c=a;a=h;break;case 3:d=b;c=f;break;case 4:d=h;c=b;break;default:d=a,c=b,a=f}return{r:d,g:c,b:a}}}})(FILTER);
(function(b){function m(a,c){var b=document.createElement("canvas");b.width=a||0;b.height=c||0;return b}var j,f=Math.min,a=b.ImArray;j={normal:function(a){return a},lighten:function(a,c){return c>a?c:a},darken:function(a,c){return c>a?a:c},multiply:function(a,c){return a*c*0.003921568627451},average:function(a,c){return 0.5*(a+c)},add:function(a,c){return Math.min(255,a+c)},substract:function(a,c){return a+c<255?0:a+c-255},difference:function(a,c){return Math.abs(a-c)},negation:function(a,c){return 255-
Math.abs(255-a-c)},screen:function(a,c){return 255-((255-a)*(255-c)>>8)},exclusion:function(a,c){return a+c-2*a*c*0.003921568627451},overlay:function(a,c){return c<128?2*a*c*0.003921568627451:255-2*(255-a)*(255-c)*0.003921568627451},softLight:function(a,c){return c<128?2*((a>>1)+64)*c*0.003921568627451:255-2*(255-((a>>1)+64))*(255-c)*0.003921568627451},hardLight:function(a,c){return a<128?2*c*a*0.003921568627451:255-2*(255-c)*(255-a)*0.003921568627451},colorDodge:function(a,c){return c==255?c:Math.min(255,
(a<<8)/(255-c))},colorBurn:function(a,c){return c==0?c:Math.max(0,255-(255-a<<8)/c)},linearLight:function(a,c){return c<128?j.linearBurn(a,2*c):j.linearDodge(a,2*(c-128))},vividLight:function(a,c){return c<128?j.colorBurn(a,2*c):j.colorDodge(a,2*(c-128))},pinLight:function(a,c){return c<128?j.darken(a,2*c):j.lighten(a,2*(c-128))},hardMix:function(a,c){return j.vividLight(a,c)<128?0:255},reflect:function(a,c){return c==255?c:Math.min(255,a*a/(255-c))},glow:function(a,c){return a==255?a:Math.min(255,
c*c/(255-a))},phoenix:function(a,c){return Math.min(a,c)-Math.max(a,c)+255}};j.linearDodge=j.add;j.linearBurn=j.substract;b.blendModes=j;b.Image=function(a,c){this.height=this.width=0;this.imageData=this.context=null;this.domElement=this.canvasElement=m(this.width,this.height);this.context=this.canvasElement.getContext("2d");this._integral=this._histogram=this._tmpCanvas=null;this._integralRefresh=this._histogramRefresh=!0;this.setImage(a,c)};b.Image.prototype={width:0,height:0,canvasElement:null,
domElement:null,clear:function(){this.context.clearRect(0,0,this.width,this.height);return this},fill:function(a,c,b,f,h){var f=f||this.width,h=h||this.height,k=this.context;k.fillStyle=a||0;k.fillRect(c||0,b||0,f,h);return this},draw:function(){return this},getPixel:function(a,c){var b=~~(c*this.width+a+0.5);return{red:this.imageData.data[b],green:this.imageData.data[b+1],blue:this.imageData.data[b+2],alpha:this.imageData.data[b+3]}},setPixel:function(b,c,f,e,h,k){this.context.putImageData(new a([f,
e,h,k]),b,c);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},getData:function(){return new a(this.imageData.data)},setData:function(a){this.imageData.data.set(a);this.context.putImageData(this.imageData,0,0);this._integralRefresh=this._histogramRefresh=!0;return this},getPixelData:function(){return this.imageData},setPixelData:function(a){this.context.putImageData(a,0,0);this.imageData=this.context.getImageData(0,0,
this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setWidth:function(a){this.canvasElement.width=this.width=a;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},setHeight:function(a){this.canvasElement.height=this.height=a;this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);
this._integralRefresh=this._histogramRefresh=!0;return this},setImage:function(a,c){if(typeof a=="undefined"||a==null)return this;var b=this,f;a instanceof Image||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?(f=a,this.width=a instanceof HTMLVideoElement?a.videoWidth:a.width,this.height=a instanceof HTMLVideoElement?a.videoHeight:a.height,this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.context=this.canvasElement.getContext("2d"),this.context.drawImage(f,
0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._integralRefresh=this._histogramRefresh=!0):(f=new Image,f.onload=function(){b.width=f.width;b.height=f.height;b.canvasElement.width=b.width;b.canvasElement.height=b.height;b.context=b.canvasElement.getContext("2d");b.context.drawImage(f,0,0);b.imageData=b.context.getImageData(0,0,b.width,b.height);b._histogramRefresh=!0;b._integralRefresh=!0;typeof c!="undefined"&&c.call(b)},f.src=a);f.crossOrigin="";return this},blend:function(a,
c,b,e,h){typeof c=="undefined"&&(c="normal");typeof b=="undefined"&&(b=1);b>1&&(b=1);b<0&&(b=0);typeof e=="undefined"&&(e=0);typeof h=="undefined"&&(h=0);var k=0,q=0;e<0&&(k=-e,e=0);h<0&&(q=-h,h=0);if(!(e>=this.width||h>=this.height)){c=j[c];if(c==void 0||c==null)return this;var v=f(this.width,a.width-k),n=f(this.height,a.height-q),o=this.context.getImageData(e,h,v,n),k=a.context.getImageData(k,q,v,n),a=o.data,k=k.data,m,u,p,l=1-b,r=k.length,w;for(w=0;w<r;w+=4)m=a[w],u=a[w+1],p=a[w+2],q=c(k[w],m),
v=c(k[w+1],u),n=c(k[w+2],p),a[w]=q*b+m*l,a[w+1]=v*b+u*l,a[w+2]=n*b+p*l;this.context.putImageData(o,e,h);this._integralRefresh=this._histogramRefresh=!0;return this}},_refresh:function(){this.context=this.canvasElement.getContext("2d");this.imageData=this.context.getImageData(0,0,this.width,this.height);return this},clone:function(){return new b.Image(this.canvasElement)},integral:function(){this._integralRefresh&&this._computeIntegral();return this._integral},_computeIntegral:function(){var a=this.width,
c=this.height,f=a*c,e=new b.Array32U(f),h=new b.Array32U(f),f=new b.Array32U(f),k=this.getPixelData().data,q,v,n,o,m,j,p,l;for(m=j=p=n=v=q=0;v<c;)o=q+n,l=o<<2,m+=k[l],j+=k[l+1],p+=k[l+2],q>0?(e[o]=e[o-1]+m,h[o]=h[o-1]+j,f[o]=f[o-1]+p):(e[o]=m,h[o]=j,f[o]=p),q++,q>=a&&(q=0,v++,n+=a,m=j=p=0);this._integral=[e,h,f];this._integralRefresh=!1},histogram:function(){this._histogramRefresh&&this._computeHistogram();return this._histogram},_computeHistogram:function(){for(var a=this.getPixelData().data,c=0,
f=a.length,e,h,k,q=0,v=0,n=0,o=255,m=255,j=255,p=new b.Array32F(256),l=new b.Array32F(256),r=new b.Array32F(256),w=1/(f>>2),c=0;c<256;)p[c]=0,l[c]=0,r[c]=0,c++;for(c=0;c<f;)e=a[c],h=a[c+1],k=a[c+2],p[e]+=w,l[h]+=w,r[k]+=w,e>q&&(q=e),e<o&&(o=e),h>v&&(v=h),h<m&&(m=h),k>n&&(n=k),k<j&&(j=k),c+=4;this._histogram=[p,l,r];this._histogramRefresh=!1},createImageData:function(a,c){this.canvasElement.width=this.width=a;this.canvasElement.height=this.height=c;this.context=this.canvasElement.getContext("2d");
this.context.createImageData(a,c);return this.imageData=this.context.getImageData(0,0,this.width,this.height)},scale:function(a,c){a=a||1;c=c||a;this._tmpCanvas=this._tmpCanvas||m(this.width,this.height);var b=this._tmpCanvas.getContext("2d");b.scale(a,c);b.drawImage(this.canvasElement,0,0);this.canvasElement.width=this.width=~~(a*this.width+0.5);this.canvasElement.height=this.height=~~(c*this.height+0.5);this.context.drawImage(this._tmpCanvas,0,0);this._tmpCanvas.width=this.width;this._tmpCanvas.height=
this.height;this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this},flipHorizontal:function(){this._tmpCanvas=this._tmpCanvas||m(this.width,this.height);var a=this._tmpCanvas.getContext("2d");a.translate(this.width,0);a.scale(-1,1);a.drawImage(this.canvasElement,0,0);this.context.drawImage(this._tmpCanvas,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;
return this},flipVertical:function(){this._tmpCanvas=this._tmpCanvas||m(this.width,this.height);var a=this._tmpCanvas.getContext("2d");a.translate(0,this.height);a.scale(1,-1);a.drawImage(this.canvasElement,0,0);this.context.drawImage(this._tmpCanvas,0,0);this.imageData=this.context.getImageData(0,0,this.width,this.height);this._integralRefresh=this._histogramRefresh=!0;return this}}})(FILTER);
(function(b){b.CustomFilter=function(b){this._handler=b};b.CustomFilter.prototype={_handler:null,_apply:function(b,j,f){if(!this._handler)return b;return this._handler.call(this,b,j,f)},apply:function(b){if(!this._handler)return b;return b.setData(this._handler.call(this,b.getData(),b.width,b.height))}}})(FILTER);
(function(b){var m=b.Array32F,j=b.CONSTANTS.toRad;b.ColorMatrixFilter=function(b){this._matrix=typeof b!="undefined"&&b.length?new m(b):null};b.ColorMatrixFilter.prototype={_matrix:null,channel:function(f,a){var d=(typeof a=="undefined"?0:a)?1:0;switch(f){case b.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case b.CHANNEL.BLUE:return this.concat([0,0,d,0,0,0,0,d,0,0,0,0,1,0,0,0,0,0,0,255]);case b.CHANNEL.GREEN:return this.concat([0,d,0,0,0,0,1,0,0,0,0,d,0,0,0,0,0,0,
0,255]);default:return this.concat([1,0,0,0,0,d,0,0,0,0,d,0,0,0,0,0,0,0,0,255])}},redChannel:function(f){return this.channel(b.CHANNEL.RED,f)},greenChannel:function(f){return this.channel(b.CHANNEL.GREEN,f)},blueChannel:function(f){return this.channel(b.CHANNEL.BLUE,f)},alphaChannel:function(){return this.channel(b.CHANNEL.ALPHA,!0)},maskChannel:function(f){switch(f){case b.CHANNEL.ALPHA:return this;case b.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case b.CHANNEL.GREEN:return this.concat([1,
0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this.concat([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(f,a){switch(f){case b.CHANNEL.ALPHA:switch(a){case b.CHANNEL.ALPHA:return this;case b.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case b.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);default:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}case b.CHANNEL.BLUE:switch(a){case b.CHANNEL.ALPHA:return this.concat([1,
0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case b.CHANNEL.BLUE:return this;case b.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);default:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}case b.CHANNEL.GREEN:switch(a){case b.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case b.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case b.CHANNEL.GREEN:return this;default:return this.concat([0,1,0,0,0,1,0,0,0,0,
0,0,1,0,0,0,0,0,1,0])}default:switch(a){case b.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case b.CHANNEL.BLUE:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case b.CHANNEL.GREEN:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);default:return this}}},desaturate:function(){return this.concat([b.LUMA[0],b.LUMA[1],b.LUMA[2],0,0,b.LUMA[0],b.LUMA[1],b.LUMA[2],0,0,b.LUMA[0],b.LUMA[1],b.LUMA[2],0,0,0,0,0,1,0])},grayscale:function(){return this.desaturate()},
colorize:function(f,a){var d,c,g,e;typeof a=="undefined"&&(a=1);d=(f>>16&255)*0.00392156862745098;c=(f>>8&255)*0.00392156862745098;g=(f&255)*0.00392156862745098;e=1-a;return this.concat([e+a*d*b.LUMA[0],a*d*b.LUMA[1],a*d*b.LUMA[2],0,0,a*c*b.LUMA[0],e+a*c*b.LUMA[1],a*c*b.LUMA[2],0,0,a*g*b.LUMA[0],a*g*b.LUMA[1],e+a*g*b.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,
1,0,0,0,0,0,-1,255])},saturate:function(f){var a,d,c;a=1-f;d=a*b.LUMA[0];c=a*b.LUMA[1];a*=b.LUMA[2];return this.concat([d+f,c,a,0,0,d,c+f,a,0,0,d,c,a+f,0,0,0,0,0,1,0])},contrast:function(b,a,d){typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);b+=1;a+=1;d+=1;return this.concat([b,0,0,0,128*(1-b),0,a,0,0,128*(1-a),0,0,d,0,128*(1-d),0,0,0,1,0])},brightness:function(b,a,d){typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);return this.concat([1,0,0,0,b,0,1,0,0,a,0,0,1,0,d,0,0,0,1,0])},
adjustHue:function(f){f*=j;var a=Math.cos(f),f=Math.sin(f);return this.concat([b.LUMA[0]+a*(1-b.LUMA[0])+f*-b.LUMA[0],b.LUMA[1]+a*-b.LUMA[1]+f*-b.LUMA[1],b.LUMA[2]+a*-b.LUMA[2]+f*(1-b.LUMA[2]),0,0,b.LUMA[0]+a*-b.LUMA[0]+f*0.143,b.LUMA[1]+a*(1-b.LUMA[1])+f*0.14,b.LUMA[2]+a*-b.LUMA[2]+f*-0.283,0,0,b.LUMA[0]+a*-b.LUMA[0]+f*-(1-b.LUMA[0]),b.LUMA[1]+a*-b.LUMA[1]+f*b.LUMA[1],b.LUMA[2]+a*(1-b.LUMA[2])+f*b.LUMA[2],0,0,0,0,0,1,0])},average:function(b,a,d){typeof b=="undefined"&&(b=0.3333);typeof a=="undefined"&&
(a=0.3333);typeof d=="undefined"&&(d=0.3334);return this.concat([b,a,d,0,0,b,a,d,0,0,b,a,d,0,0,0,0,0,1,0])},quickContrastCorrection:function(b){typeof b=="undefined"&&(b=1.2);return this.concat([b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0])},quickSepia:function(f){typeof f=="undefined"&&(f=10);f>100&&(f=100);f*=2.55;return this.concat([b.LUMA[0],b.LUMA[1],b.LUMA[2],0,40,b.LUMA[0],b.LUMA[1],b.LUMA[2],0,20,b.LUMA[0],b.LUMA[1],b.LUMA[2],0,-f,0,0,0,1,0])},quickSepia2:function(b,a,d){typeof b=="undefined"&&
(b=1);typeof a=="undefined"&&(a=b);typeof d=="undefined"&&(d=b);return this.concat([b*0.5,0.5,0.5,0,0,0.33,a*0.33,0.33,0,0,0.25,0.25,d*0.25,0,0,0,0,0,1,0])},threshold:function(f,a){typeof a=="undefined"&&(a=256);return this.concat([b.LUMA[0]*a,b.LUMA[1]*a,b.LUMA[2]*a,0,-(a-1)*f,b.LUMA[0]*a,b.LUMA[1]*a,b.LUMA[2]*a,0,-(a-1)*f,b.LUMA[0]*a,b.LUMA[1]*a,b.LUMA[2]*a,0,-(a-1)*f,0,0,0,1,0])},threshold_rgb:function(b,a){typeof a=="undefined"&&(a=256);return this.concat([a,0,0,0,-(a-1)*b,0,a,0,0,-(a-1)*b,0,
0,a,0,-(a-1)*b,0,0,0,1,0])},threshold_alpha:function(b,a){typeof b=="undefined"&&(b=0.5);typeof a=="undefined"&&(a=256);return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,a,-a*b])},RGB2YCbCr:function(){return this.concat([0.5,-0.418688,-0.081312,0,128,0.299,0.587,0.114,0,0,-0.168736,-0.331264,0.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.concat([1.402,1,0,0,-179.456,-0.71414,1,-0.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(b,a){var d;if(this._matrix){d=this._matrix;
var c=b.getMatrix(),g=1-a,e=new m(20);e[0]=g*d[0]+a*c[0];e[1]=g*d[1]+a*c[1];e[2]=g*d[2]+a*c[2];e[3]=g*d[3]+a*c[3];e[4]=g*d[4]+a*c[4];e[5]=g*d[5]+a*c[5];e[6]=g*d[6]+a*c[6];e[7]=g*d[7]+a*c[7];e[8]=g*d[8]+a*c[8];e[9]=g*d[9]+a*c[9];e[10]=g*d[10]+a*c[10];e[11]=g*d[11]+a*c[11];e[12]=g*d[12]+a*c[12];e[13]=g*d[13]+a*c[13];e[14]=g*d[14]+a*c[14];e[15]=g*d[15]+a*c[15];e[16]=g*d[16]+a*c[16];e[17]=g*d[17]+a*c[17];e[18]=g*d[18]+a*c[18];e[19]=g*d[19]+a*c[19];d=e}else d=new m(b.getMatrix());this._matrix=d;return this},
concat:function(b){var a;if(this._matrix){a=this._matrix;var b=new m(b),d=new m(20),c,g,e,h,k;c=b[0];g=b[1];e=b[2];h=b[3];k=b[4];d[0]=c*a[0]+g*a[5]+e*a[10]+h*a[15];d[1]=c*a[1]+g*a[6]+e*a[11]+h*a[16];d[2]=c*a[2]+g*a[7]+e*a[12]+h*a[17];d[3]=c*a[3]+g*a[8]+e*a[13]+h*a[18];d[4]=c*a[4]+g*a[9]+e*a[14]+h*a[19]+k;c=b[5];g=b[6];e=b[7];h=b[8];k=b[9];d[5]=c*a[0]+g*a[5]+e*a[10]+h*a[15];d[6]=c*a[1]+g*a[6]+e*a[11]+h*a[16];d[7]=c*a[2]+g*a[7]+e*a[12]+h*a[17];d[8]=c*a[3]+g*a[8]+e*a[13]+h*a[18];d[9]=c*a[4]+g*a[9]+e*
a[14]+h*a[19]+k;c=b[10];g=b[11];e=b[12];h=b[13];k=b[14];d[10]=c*a[0]+g*a[5]+e*a[10]+h*a[15];d[11]=c*a[1]+g*a[6]+e*a[11]+h*a[16];d[12]=c*a[2]+g*a[7]+e*a[12]+h*a[17];d[13]=c*a[3]+g*a[8]+e*a[13]+h*a[18];d[14]=c*a[4]+g*a[9]+e*a[14]+h*a[19]+k;c=b[15];g=b[16];e=b[17];h=b[18];k=b[19];d[15]=c*a[0]+g*a[5]+e*a[10]+h*a[15];d[16]=c*a[1]+g*a[6]+e*a[11]+h*a[16];d[17]=c*a[2]+g*a[7]+e*a[12]+h*a[17];d[18]=c*a[3]+g*a[8]+e*a[13]+h*a[18];d[19]=c*a[4]+g*a[9]+e*a[14]+h*a[19]+k;a=d}else a=new m(b);this._matrix=a;return this},
combineWith:function(b){return this.concat(b.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(b){this._matrix=b;return this},_apply:function(b){if(!this._matrix)return b;for(var a=b.length,d=this._matrix,c=0,g,e,h,k;c<a;)g=b[c],e=b[c+1],h=b[c+2],k=b[c+3],b[c]=d[0]*g+d[1]*e+d[2]*h+d[3]*k+d[4],b[c+1]=d[5]*g+d[6]*e+d[7]*h+d[8]*k+d[9],b[c+2]=d[10]*g+d[11]*e+d[12]*h+d[13]*k+d[14],b[c+3]=d[15]*g+d[16]*e+d[17]*h+d[18]*k+d[19],c+=4;return b},apply:function(b){if(!this._matrix)return b;
return b.setData(this._apply(b.getData(),b.width,b.height))},reset:function(){this._matrix=null;return this}}})(FILTER);
(function(b){function m(b){var c=new a(256),d=0;if(b)for(;d<256;)c[d]=255-d,d++;else for(;d<256;)c[d]=d,d++;return c}function j(b){for(var c=new a(256),d=0;d<256;)c[d]=b,d++;return c}function f(b){if(b)return new a(b);return null}var a=b.ImArray,d=Math.pow,c=Math.exp,g=1/255,e=m(),h=m(1);b.TableLookupFilter=function(a,b,c,d){this._tableR=a||null;this._tableG=b||this._tableR;this._tableB=c||this._tableG;this._tableA=d||null};b.TableLookupFilter.prototype={_tableR:null,_tableG:null,_tableB:null,_tableA:null,
thresholds:function(b){b.length||(b=[b]);var c=b.length,d=c+1,f=new a(256),h=new a(d),e,g=255/(d-1);for(e=0;e<d;)h[e]=~~(g*e),e++;b[0]=~~(255*b[0]);for(e=1;e<c;)b[e]=b[e-1]+~~(255*b[e]),e++;for(e=0;e<256;){for(d=0;d<c&&e>b[d];)d++;f[e]=h[d];e++}return this.concat(f)},threshold:function(a){return this.thresholds([a||0.5])},quantize:function(b){typeof b=="undefined"&&(b=64);b<2&&(b=2);var c=new a(256),d=new a(b),f,e=255/(b-1),h=b/256;for(f=0;f<b;)d[f]=~~(e*f),f++;for(f=0;f<256;)c[f]=d[~~(h*f)],f++;
return this.concat(c)},levels:function(a){return this.quantize(a)},posterize:function(a){return this.quantize(a)},binarize:function(){return this.quantize(2)},solarize:function(b){typeof b=="undefined"&&(b=0.5);for(var c=0,d=new a(256),b=~~(b*256)-1,c=0;c<256;)d[c]=c>b?255-(c<<1):(c<<1)-255,c++;return this.concat(d)},invert:function(){return this.concat(h)},mask:function(b){var c=0,d=b>>16&255,f=b>>8&255;b&=255;tR=new a(256);tG=new a(256);tB=new a(256);for(c=0;c<256;)tR[c]=c&d,tG[c]=c&f,tB[c]=c&b,
c++;return this.concat(tR,tG,tB)},replace:function(a,b){if(a==b)return this;var c=a>>16&255,d=a>>8&255,h=a&255,g=b>>16&255,j=b>>8&255,m=b&255,l=f(e),r=f(e),w=f(e);l[c]=g;r[d]=j;w[h]=m;return this.concat(l,r,w)},extract:function(a,c,d){if(!c||!c.length)return this;var d=d||0,f=d>>8&255,e=d&255,d=j(d>>16&255),f=j(f),e=j(e);switch(a){case b.CHANNEL.BLUE:a=c[0];for(c=c[1];a<=c;)e[a]=a,a++;break;case b.CHANNEL.GREEN:a=c[0];for(c=c[1];a<=c;)f[a]=a,a++;break;default:a=c[0];for(c=c[1];a<=c;)d[a]=a,a++}return this.concat(d,
f,e)},gammaCorrection:function(b,c,f){for(var b=b||1,c=c||b,f=f||c,b=1/b,c=1/c,f=1/f,e=new a(256),h=new a(256),j=new a(256),m=0;m<256;)e[m]=~~(255*d(g*m,b)),h[m]=~~(255*d(g*m,c)),j[m]=~~(255*d(g*m,f)),m++;return this.concat(e,h,j)},exposure:function(b){typeof b=="undefined"&&(b=1);for(var d=0,f=new a(256),d=0;d<256;)f[d]=~~(255*(1-c(-b*d*g))),d++;return this.concat(f)},concat:function(a,b,c){if(!a)return this;var b=b||a,c=c||b,d=this._tableR||m(),e,h,g=f(d),j,l,r;if(b&&c){e=this._tableG||f(d);h=this._tableB||
f(e);j=f(e);l=f(h);for(r=0;r<256;)d[r]=a[g[r]],e[r]=b[j[r]],h[r]=c[l[r]],r++;this._tableR=d;this._tableG=e;this._tableB=h}else{for(r=0;r<256;)d[r]=a[g[r]],r++;this._tableB=this._tableG=this._tableR=d}return this},combineWith:function(a){return this.concat(a.getTable(0),a.getTable(1),a.getTable(2))},getTable:function(a){a=a||b.CHANNEL.RED;switch(a){case b.CHANNEL.ALPHA:return this._tableA;case b.CHANNEL.BLUE:return this._tableB;case b.CHANNEL.GREEN:return this._tableG;default:return this._tableR}},
setTable:function(a,c){c=c||b.CHANNEL.RED;switch(c){case b.CHANNEL.ALPHA:return this._tableA=a,this;case b.CHANNEL.BLUE:return this._tableB=a,this;case b.CHANNEL.GREEN:return this._tableG=a,this;default:return this._tableR=a,this}},_apply:function(a){if(!this._tableR)return a;var b=a.length,c=0,d,f,e,h,g=this._tableR,j=this._tableG,r=this._tableB,w=this._tableA;if(w)for(;c<b;)d=a[c],f=a[c+1],e=a[c+2],h=a[c+3],a[c]=g[d],a[c+1]=j[f],a[c+2]=r[e],a[c+3]=w[h],c+=4;else for(;c<b;)d=a[c],f=a[c+1],e=a[c+
2],a[c]=g[d],a[c+1]=j[f],a[c+2]=r[e],c+=4;return a},apply:function(a){if(!this._tableR)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this._tableA=this._tableB=this._tableG=this._tableR=null;return this}}})(FILTER);
(function(b){var m=b.ImArray,j=Math.min;b.DisplacementMapFilter=function(b){b&&this.setMap(b)};b.DisplacementMapFilter.prototype={scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:b.MODE.CLAMP,_map:null,combineWith:function(){return this},getMap:function(){return this._map},setMap:function(b){this._map=b;return this},_apply:function(f,a,d){if(!this._map)return f;var c=this._map.getData(),g=this._map.width,e=this._map.height,h=g*e,k=new b.Array16I(h<<1),q=j(g,a),v=j(e,d),n=
this.scaleX*0.00390625,o=this.scaleY*0.00390625,t=this.componentX,u=this.componentY,e=this.color>>24&255,p=this.color>>16&255,l=this.color>>8&255,r=this.color&255,w=~~this.startY,B=~~this.startX,F=this.mode,P=w*a,aa=-B,W=-w,S=a-B-1,R=d-w-1,N,M,T,V,X,G=q*v<<2,A=new m(f),s=b.MODE.IGNORE,O=b.MODE.COLOR,E=b.MODE.WRAP;for(V=T=M=N=v=0;v<h;)X=M+V<<2,k[N]=~~((c[X+t]-128)*n),k[N+1]=~~((c[X+u]-128)*o),v++,N+=2,M++,M>=g&&(M=0,T++,V+=g);v=-4;M=-1;for(ty2=V=T=0;v<G;)if(v+=4,M++,M>=q&&(M=0,T++,V+=a,ty2+=g),!(T<
W||T>R||M<aa||M>S)){n=M+B;h=T+w;c=n+V+P<<2;N=M+ty2<<1;srcx=n+k[N];srcy=h+k[N+1];if(srcy>=d||srcy<0||srcx>=a||srcx<0)switch(F){case s:continue;case O:A[c]=p;A[c+1]=l;A[c+2]=r;A[c+3]=e;continue;case E:srcy>R&&(srcy-=d);srcy<0&&(srcy+=d);srcx>S&&(srcx-=a);srcx<0&&(srcx+=a);break;default:srcy>R&&(srcy=R),srcy<0&&(srcy=0),srcx>S&&(srcx=S),srcx<0&&(srcx=0)}N=srcx+srcy*a<<2;A[c]=f[N];A[c+1]=f[N+1];A[c+2]=f[N+2];A[c+3]=f[N+3]}return A},apply:function(b){if(!this._map)return b;return b.setData(this._apply(b.getData(),
b.width,b.height))},reset:function(){this._map=null;return this}}})(FILTER);
(function(b){function m(a,b){var c,d,f,e,h,g=a.length,j=new v(g);for(f=d=c=e=0;e<g;)h=b-1-c+f<<2,j[e]=a[h],j[e+1]=a[h+1],j[e+2]=a[h+2],j[e+3]=a[h+3],e+=4,c++,c>=b&&(c=0,d++,f+=b);return j}function j(a,b,c){var d,f,e,h,g=a.length,j=new v(g);f=d=e=0;for(c=(c-1)*b;e<g;)h=d+c<<2,j[e]=a[h],j[e+1]=a[h+1],j[e+2]=a[h+2],j[e+3]=a[h+3],e+=4,d++,d>=b&&(d=0,f++,c-=b);return j}function f(a,b,c){var d,f,e,h,g,j=a.length,k=new v(j);f=d=h=0;for(c=(c-1)*b;h<j;)g=b-1-d+c<<2,k[h]=a[g],k[h+1]=a[g+1],k[h+2]=a[g+2],k[h+
3]=a[g+3],h+=4,d++,d>=b&&(d=0,f++,e+=b,c-=b);return k}function a(a,b,c){var d,f,e,h,g=a.length,j=new v(g),k=c*b;d=c=e=0;for(f=k-1;e<g;)h=d+f<<2,j[e]=a[h],j[e+1]=a[h+1],j[e+2]=a[h+2],j[e+3]=a[h+3],e+=4,c++,f-=b,c>=b&&(c=0,f=k-1,d++);return j}function d(a,b){var c,d,f,e,h,g=a.length,j=new v(g);for(f=d=c=e=0;e<g;)h=b-1-d+f<<2,j[e]=a[h],j[e+1]=a[h+1],j[e+2]=a[h+2],j[e+3]=a[h+3],e+=4,c++,f+=b,c>=b&&(f=c=0,d++);return j}function c(a,c,d){var f,e,h,g,j=a.length,k=new v(j),m=this.inverseTransform,o=this.mode,
l=b.MODE.WRAP,p;for(e=f=h=0;h<j;){p=m([f,e],c,d);g=~~p[0];p=~~p[1];if(0>g||g>=c||0>p||p>=d)switch(o){case l:p>=d&&(p-=d);p<0&&(p+=d);g>=c&&(g-=c);g<0&&(g+=c);break;default:p>=d&&(p=d-1),p<0&&(p=0),g>=c&&(g=c-1),g<0&&(g=0)}g=g+p*c<<2;k[h]=a[g];k[h+1]=a[g+1];k[h+2]=a[g+2];k[h+3]=a[g+3];h+=4;f++;f>=c&&(f=0,e++)}return k}function g(a,c,d){var f,e,h,g,j=c*d,k=a.length,m=new v(k),p=this.a,o=this.b,l=this.c,n=this.d,q=this.mode,A=b.MODE.WRAP,s,u=c-1,t=j-c;e=f=d=h=0;for(n*=c;h<k;){g=~~(p*d+l);s=~~(o*e+n);
if(0>g||g>u||0>s||s>t)switch(q){case A:s>t&&(s-=j);s<0&&(s+=j);g>=c&&(g-=c);g<0&&(g+=c);break;default:s>t&&(s=t),s<0&&(s=0),g>u&&(g=u),g<0&&(g=0)}g=g+s<<2;m[h]=a[g];m[h+1]=a[g+1];m[h+2]=a[g+2];m[h+3]=a[g+3];h+=4;d++;d>=c&&(d=0,f++,e+=c)}return m}function e(a,c,d){if(0>=this.radius)return a;var f,e,h,g,j=a.length,k=new v(a),m=this.centerX,p=this.centerY,l=this.radius,q=this.mode,X=b.MODE.WRAP,G,A,s=this.angle/l,O=c-1,E=d-1;for(e=f=h=0;h<j;){G=f-m;A=e-p;g=n(G*G+A*A);if(g<l){A=o(A,G)+s*(l-g);G=~~(m+
g*u(A));A=~~(p+g*t(A));if(0>G||G>O||0>A||A>E)switch(q){case X:A>E&&(A-=d);A<0&&(A+=d);G>O&&(G-=c);G<0&&(G+=c);break;default:A>E&&(A=E),A<0&&(A=0),G>O&&(G=O),G<0&&(G=0)}g=G+A*c<<2;k[h]=a[g];k[h+1]=a[g+1];k[h+2]=a[g+2];k[h+3]=a[g+3]}h+=4;f++;f>=c&&(f=0,e++)}return k}function h(a,c,d){if(0>=this.radius)return a;var f,e,h,g,j=a.length,k=new v(a),m=this.centerX,o=this.centerY;f=this.radius;var q=this.mode,u=b.MODE.WRAP,t,G=f*f,A=1-0.555556,s,O,E,H,x=c-1,z=d-1;for(e=f=h=0;h<j;){g=f-m;t=e-o;E=g*g;H=t*t;
s=E+H;if(s<G){O=G-s;s=n(O);g=p(g/n(E+O))*A;t=p(t/n(H+O))*A;g=~~(f-s*l(g));t=~~(e-s*l(t));if(0>g||g>x||0>t||t>z)switch(q){case u:t>z&&(t-=d);t<0&&(t+=d);g>x&&(g-=c);g<0&&(g+=c);break;default:t>z&&(t=z),t<0&&(t=0),g>x&&(g=x),g<0&&(g=0)}g=g+t*c<<2;k[h]=a[g];k[h+1]=a[g+1];k[h+2]=a[g+2];k[h+3]=a[g+3]}h+=4;f++;f>=c&&(f=0,e++)}return k}function k(a){return a}function q(a){return a}var v=b.ImArray,n=Math.sqrt,o=Math.atan2,t=Math.sin,u=Math.cos,p=Math.asin,l=Math.tan;b.GeometricMapFilter=function(a){this.generic(a)};
b.GeometricMapFilter.prototype={_map:null,inverseTransform:null,a:1,b:1,c:0,d:0,centerX:0,centerY:0,angle:0,radius:0,mode:b.MODE.CLAMP,generic:function(a){if(a)this.inverseTransform=a,this._map=c;return this},affine:function(a,b,c,d){this.a=a;this.b=b;this.c=c;this.d=d;this._map=g;return this},flipX:function(){this._map=m;return this},flipY:function(){this._map=j;return this},flipXY:function(){this._map=f;return this},rotateCW:function(){this._map=a;return this},rotateCCW:function(){this._map=d;return this},
polar:function(a,b){this.centerX=a||0;this.centerY=b||0;this._map=k;return this},cartesian:function(a,b){this.centerX=a||0;this.centerY=b||0;this._map=q;return this},twirl:function(a,b,c,d){this.angle=a||0;this.radius=b||0;this.centerX=c||0;this.centerY=d||0;this._map=e;return this},sphere:function(a,b,c){this.radius=a||0;this.centerX=b||0;this.centerY=c||0;this._map=h;return this},combineWith:function(){return this},getMap:function(){return this._map},setMap:function(a){this._map=a;return this},
_apply:function(a,b,c){if(!this._map)return a;return this._map.call(this,a,b,c)},apply:function(a){if(!this._map)return a;return a.setData(this._map.call(this,a.getData(),a.width,a.height))},reset:function(){this._map=null;return this}}})(FILTER);
(function(b){function m(a,b,c,d){var f=a.length,e,h=new n(a.length),c=c||1,d=d||1;for(e=0;e<f;)h[e]=c*a[e]+d*b[e],e++;return h}function j(a,b){var c,d,f=a.length,e,h=[],g=0;for(c=0;c<f;c++)for(d=0;d<f;d++)e=a[c]*b[d],g+=e,h.push(e);return{kernel:h,sum:g}}function f(a){var b,c=Array(a);for(b=0;b<a;)c[b]=0,b++;c[a>>1]=1;return c}function a(a){var b,c=Array(a);for(b=0;b<a;)c[b]=1,b++;return c}function d(a){var b=o.length,c,d;a--;if(a<b)c=o[a].slice();else for(c=new n(o[b-1]);b<=a;){d=c.slice();c=[1];
i=0;for(il=d.length-1;i<il;i++)c.push(d[i]+d[i+1]);c.push(1);b<40&&o.push(c.slice());b++}return c}function c(a){var b,c=-(a>>1),d=Array(a);for(b=0;b<a;)d[b]=c,c++,b++;return d}function g(a){a=d(a);return j(a,a)}function e(a,b){var f=d(a),e=c(a);return 1==b?j(e.reverse(),f):j(f,e)}function h(b,d){var f=a(b),e=c(b);return 1==d?j(e.reverse(),f):j(f,e)}function k(a,b){var b=b||1,c=a*a,d,f=new n(c);for(d=0;d<c;)f[d]=b,d++;return f}function q(a,c,d,f,e,h,g,j,k,m){var p=a.length,o,l,q,n,s,r,u,t,x,z,D,Q,
U,J,C,I,L,Y,Z,K,ba,ca,$;o=c*d;s=h*g;h>>=1;g=c*(g>>1);d=-h-1;t=-g-c;Y=c-1;Z=o-c;o=(o<<1)+o;u=(c<<1)+c;m=m||1;$=0;if(e){D=f[0];f=f[s>>1];f-=D;Q=e[0];e=e[s>>1];for(U=e-Q;$<m;){r=new v(a);e=new b.Array32F(o);for(l=q=n=z=x=s=0;z<c;)l+=a[s],q+=a[s+1],n+=a[s+2],e[x]=l,e[x+1]=q,e[x+2]=n,s+=4,x+=3,z++;s=u+c;x=u;for(l=q=n=z=0;s<p;)l+=a[s],q+=a[s+1],n+=a[s+2],e[x]=e[x-u]+l,e[x+1]=e[x-u+1]+q,e[x+2]=e[x-u+2]+n,s+=4,x+=3,z++,z>=c&&(l=q=n=z=0);for(q=l=z=s=0;s<p;)J=z+d,C=q+t,I=z+h,L=q+g,J<0?J=0:I>Y&&(I=Y),C<0?C=
0:L>Z&&(L=Z),n=J+C,x=I+L,C=I+C,K=J+L,n=(n<<1)+n,C=(C<<1)+C,K=(K<<1)+K,x=(x<<1)+x,J=D*(e[x]-e[C]-e[K]+e[n])+f*a[s],L=D*(e[x+1]-e[C+1]-e[K+1]+e[n+1])+f*a[s+1],I=D*(e[x+2]-e[C+2]-e[K+2]+e[n+2])+f*a[s+2],ba=Q*(e[x]-e[C]-e[K]+e[n])+U*a[s],ca=Q*(e[x+1]-e[C+1]-e[K+1]+e[n+1])+U*a[s+1],n=Q*(e[x+2]-e[C+2]-e[K+2]+e[n+2])+U*a[s+2],r[s]=~~(j*J+k*ba),r[s+1]=~~(j*L+k*ca),r[s+2]=~~(j*I+k*n),s+=4,z++,z>=c&&(z=0,l++,q+=c);a=r;$++}}else{D=f[0];f=f[s>>1];f-=D;j=j||1;for(k=k||0;$<m;){r=new v(a);e=new b.Array32F(o);for(l=
q=n=z=x=s=0;z<c;)l+=a[s],q+=a[s+1],n+=a[s+2],e[x]=l,e[x+1]=q,e[x+2]=n,s+=4,x+=3,z++;s=u+c;x=u;for(l=q=n=z=0;s<p;)l+=a[s],q+=a[s+1],n+=a[s+2],e[x]=e[x-u]+l,e[x+1]=e[x-u+1]+q,e[x+2]=e[x-u+2]+n,s+=4,x+=3,z++,z>=c&&(l=q=n=z=0);for(q=l=z=s=0;s<p;)J=z+d,C=q+t,I=z+h,L=q+g,J<0?J=0:I>Y&&(I=Y),C<0?C=0:L>Z&&(L=Z),n=J+C,x=I+L,C=I+C,K=J+L,n=(n<<1)+n,C=(C<<1)+C,K=(K<<1)+K,x=(x<<1)+x,J=D*(e[x]-e[C]-e[K]+e[n])+f*a[s],L=D*(e[x+1]-e[C+1]-e[K+1]+e[n+1])+f*a[s+1],I=D*(e[x+2]-e[C+2]-e[K+2]+e[n+2])+f*a[s+2],r[s]=~~(j*
J+k),r[s+1]=~~(j*L+k),r[s+2]=~~(j*I+k),s+=4,z++,z>=c&&(z=0,l++,q+=c);a=r;$++}}return r}var v=b.ImArray,n=b.Array32F,o=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],t=b.CONSTANTS.toRad,u=Math.abs,p=Math.sqrt,l=Math.sin,r=Math.cos;b.ConvolutionMatrixFilter=function(a,b,c){typeof a!="undefined"&&a.length?(this.set(a,~~(p(a.length)+0.5),b||1),this._bias=c||0):(this._matrix=null,this._dim=0);this._coeff1=this._coeff2=this._matrix2=
null;this._isGrad=!1;this._doFast=0};b.ConvolutionMatrixFilter.prototype={_dim:0,_matrix:null,_factor:1,_bias:0,lowPass:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;this.set(k(a),a,1/(a*a));this._doFast=1;return this},highPass:function(a,b){var a=typeof a=="undefined"?3:a%2?a:a+1,c=a*a,d=-(typeof b=="undefined"?1:b)/c,e=k(a,d);e[c>>1]=1+d;this.set(e,a,1);this._doFast=1;return this},boxBlur:function(a){return this.lowPass(a)},verticalBlur:function(b){var b=typeof b=="undefined"?3:b%2?b:b+1,c,d=
b;c=f(d);d=a(d);c=j(d,c);return this.set(c.kernel,b,1/c.sum)},horizontalBlur:function(b){var b=typeof b=="undefined"?3:b%2?b:b+1,c,d=b;c=f(d);d=a(d);c=j(c,d);return this.set(c.kernel,b,1/c.sum)},binomialLowPass:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=g(a);return this.set(b.kernel,a,1/b.sum)},binomialHighPass:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=g(a);return this.set(m(k(a),new n(b.kernel),1,-1/b.sum),a,1)},gaussBlur:function(a){return this.binomialLowPass(a)},fastGauss:function(a,
b){b=typeof b=="undefined"?3:b%2?b:b+1;a=~~(a||1);a<1?a=1:a>3&&(a=3);this.set(k(b),b,1/(b*b));this._doFast=a;return this},sharpen:function(a,b){a=typeof a=="undefined"?0.5:a;return a<=0?this.set([0,-2,0,-2,10,-2,0,-2,0],3,0.5):this.highPass(b,a)},prewittX:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(h(a,0).kernel,a,1)},prewittY:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(h(a,1).kernel,a,1)},prewittDirectional:function(a,b){b=typeof b=="undefined"?3:b%2?b:b+1;
a*=t;var c=r(a),d=l(a),e=h(b,0),f=h(b,1);return this.set(m(new n(e.kernel),new n(f.kernel),c,d),b,1)},prewitt:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=h(a,0),c=h(a,1);this.set(b.kernel,a,1);this._isGrad=!0;this._matrix2=new n(c.kernel);return this},gradX:function(a){return this.prewittX(a)},gradY:function(a){return this.prewittY(a)},gradDirectional:function(a,b){return this.prewittDirectional(a,b)},grad:function(a){return this.prewitt(a)},sobelX:function(a){a=typeof a=="undefined"?3:
a%2?a:a+1;return this.set(e(a,0).kernel,a,1)},sobelY:function(a){a=typeof a=="undefined"?3:a%2?a:a+1;return this.set(e(a,1).kernel,a,1)},sobelDirectional:function(a,b){b=typeof b=="undefined"?3:b%2?b:b+1;a*=t;var c=r(a),d=l(a),f=e(b,0),h=e(b,1);return this.set(m(new n(f.kernel),new n(h.kernel),c,d),b,1)},sobel:function(a){var a=typeof a=="undefined"?3:a%2?a:a+1,b=e(a,0),c=e(a,1);this.set(b.kernel,a,1);this._matrix2=new n(c.kernel);this._isGrad=!0;return this},laplace:function(a){var a=typeof a=="undefined"?
3:a%2?a:a+1,b=k(a,-1),c=a*a;b[c>>1]=c-1;this.set(b,a,1);this._doFast=1;return this},emboss:function(a,b,c){var c=typeof c=="undefined"?3:c%2?c:c+1,a=typeof a=="undefined"?-0.25*Math.PI:a*t,b=b||1,d=b*r(a),a=-b*l(a),b=c,e=b*b,f=b>>1,h,g=new n(e),j,k,m;j=m=-f*d;k=-f*a;for(h=f=0;f<e;)g[f]=j+k,f++,h++,j+=d,h>=b&&(h=0,j=m,k+=a);g[c*c>>1]=1;return this.set(g,c,1)},edges:function(a){a=a||1;return this.set([0,a,0,a,-4*a,a,0,a,0],3,1)},set:function(a,b,c){this._coeff1=this._coeff2=this._matrix2=null;this._isGrad=
!1;this._doFast=0;this._matrix=new n(a);this._dim=b;this._factor=c||1;return this},combineWith:function(){return this},getMatrix:function(){return this._matrix},setMatrix:function(a,b){this._matrix=a;this._dim=b;this._coeff1=this._coeff2=this._matrix2=null;this._isGrad=!1;this._doFast=0;return this},_apply:function(a,c,d){if(!this._matrix)return a;if(this._doFast)return this._matrix2?q(a,c,d,this._matrix,this._matrix2,this._dim,this._dim,this._coeff1,this._coeff2,this._doFast):q(a,c,d,this._matrix,
null,this._dim,this._dim,this._factor,this._bias,this._doFast);var e=this._dim,f=this._dim,h=e>>1,g=e*f,j=(f>>1)*c,f=this._matrix,k=this._factor,m=this._bias,n=this._matrix2,l,p=this._isGrad,o=new b.Array16I(g<<1),r=new b.Array8U(g),s=c*d,d=a.length,t=new v(d),E,H,x,z,D,Q,U=c-1,J=s-c,C=this._coeff1,I=this._coeff2;for(z=x=H=E=s=0;E<g;)r[E]=H+x,o[s]=H-h,o[s+1]=z-j,s+=2,E++,H++,H>=e&&(H=0,x+=e,z+=c);if(n)for(x=H=e=0;e<d;){for(E=s=Q=m=k=z=j=h=0;E<g;)D=H+o[s],l=x+o[s+1],D>=0&&D<=U&&l>=0&&l<=J&&(D=D+l<<
2,l=f[r[E]],h+=a[D]*l,j+=a[D+1]*l,z+=a[D+2]*l,l=n[r[E]],k+=a[D]*l,m+=a[D+1]*l,Q+=a[D+2]*l),s+=2,E++;p?(t[e]=~~(u(h)+u(k)),t[e+1]=~~(u(j)+u(m)),t[e+2]=~~(u(z)+u(Q))):(t[e]=~~(C*h+I*k),t[e+1]=~~(C*j+I*m),t[e+2]=~~(C*z+I*Q));t[e+3]=a[e+3];e+=4;H++;H>=c&&(H=0,x+=c)}else for(x=H=e=0;e<d;){for(E=s=z=j=h=0;E<g;)D=H+o[s],l=x+o[s+1],D>=0&&D<=U&&l>=0&&l<=J&&(D=D+l<<2,l=f[r[E]],h+=a[D]*l,j+=a[D+1]*l,z+=a[D+2]*l),s+=2,E++;t[e]=~~(k*h+m);t[e+1]=~~(k*j+m);t[e+2]=~~(k*z+m);t[e+3]=a[e+3];e+=4;H++;H>=c&&(H=0,x+=c)}return t},
apply:function(a){if(!this._matrix)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},reset:function(){this._matrix2=this._matrix=null;this._dim=0;return this}}})(FILTER);
(function(b){var m=b.ImArray,j=function(a,d,e){var f=this._dim,j=f>>1,q=f*f,v=j*d,n=new b.Array32I(q<<1),o=d*e,e=a.length,t=new m(e),u,p,l=[],r=[],w=[];q<<=1;var B=d-1,F=o-d;for(p=o=u=0;u<q;)n[u]=o-j,n[u+1]=p-v,u+=2,o++,o>=f&&(o=0,p+=d);for(p=o=f=0;f<e;){l.length=0;r.length=0;for(u=w.length=0;u<q;)j=o+n[u],v=p+n[u+1],j>=0&&j<=B&&v>=0&&v<=F&&(j=j+v<<2,l.push(a[j]),r.push(a[j+1]),w.push(a[j+2])),u+=2;l.sort();r.sort();w.sort();u=(l.length>>1)+1;(j=l.length%2)?(t[f]=l[u],t[f+1]=r[u],t[f+2]=w[u]):(t[f]=
~~(0.5*(l[u-1]+l[u])),t[f+1]=~~(0.5*(r[u-1]+r[u])),t[f+2]=~~(0.5*(w[u-1]+w[u])));t[f+3]=a[f+3];f+=4;o++;o>=d&&(o=0,y++,p+=d)}return t},f=function(a,d,e){var f=this._dim,j=f>>1,q=f*f,v=j*d,n=new b.Array32I(q<<1),o=d*e,e=a.length,t=new m(e),u,p,l,r,w,B;q<<=1;var F=d-1,P=o-d;for(p=u=o=0;o<q;)n[o]=u-j,n[o+1]=p-v,o+=2,u++,u>=f&&(u=0,p+=d);for(p=u=f=0;f<e;){for(o=B=v=j=0;o<q;)l=u+n[o],r=p+n[o+1],l>=0&&l<=F&&r>=0&&r<=P&&(w=l+r<<2,l=a[w],r=a[w+1],w=a[w+2],l>j&&(j=l),r>v&&(v=r),w>B&&(B=w)),o+=2;t[f]=j;t[f+
1]=v;t[f+2]=B;t[f+3]=a[f+3];f+=4;u++;u>=d&&(u=0,p+=d)}return t},a=function(a,d,e){var f=this._dim,j=f>>1,q=f*f,v=j*d,n=new b.Array32I(q<<1),o=d*e,e=a.length,t=new m(e),u,p,l,r,w,B;q<<=1;var F=d-1,P=o-d;for(p=u=o=0;o<q;)n[o]=u-j,n[o+1]=p-v,o+=2,u++,u>=f&&(u=0,p+=d);for(p=u=f=0;f<e;){B=v=j=255;for(o=0;o<q;)l=u+n[o],r=p+n[o+1],l>=0&&l<=F&&r>=0&&r<=P&&(w=l+r<<2,l=a[w],r=a[w+1],w=a[w+2],l<j&&(j=l),r<v&&(v=r),w<B&&(B=w)),o+=2;t[f]=j;t[f+1]=v;t[f+2]=B;t[f+3]=a[f+3];f+=4;u++;u>=d&&(u=0,p+=d)}return t},d=
function(a){return a};b.StatisticalFilter=function(){this._dim=0;this._apply=d};b.StatisticalFilter.prototype={_dim:0,median:function(a){this._dim=typeof a=="undefined"?3:a%2?a:a+1;this._apply=j;return this},erode:function(b){this._dim=typeof b=="undefined"?3:b;this._apply=a;return this},dilate:function(a){this._dim=typeof a=="undefined"?3:a;this._apply=f;return this},_apply:function(a){return a},apply:function(a){if(!this._dim)return a;return a.setData(this._apply(a.getData(),a.width,a.height))},
reset:function(){this._apply=d;this._dim=0;return this}}})(FILTER);(function(b){b.NoiseFilter=b.Create({min:-127,max:127,init:function(b,j){this.min=b||-127;this.max=j||127},apply:function(b){var j=this.max-this.min,f=Math.random,a=this.min,d,c=b.length,g,e,h,k;for(d=0;d<c;)e=b[d],h=b[d+1],k=b[d+2],g=j*f()+a,b[d]=e+g,b[d+1]=h+g,b[d+2]=k+g,d+=4;return b}})})(FILTER);
(function(b){b.HistogramEqualizeFilter=b.Create({apply:function(m){var j,f,a,d;d=0;var c=255,g=new b.Array32F(256),e=new b.Array32F(256),h=0,k,q=m.length;k=q>>2;var v=1/k,n=Array(k),o=b.Color.RGB2YCbCr,t=b.Color.YCbCr2RGB;for(k=0;k<256;)g[k]=0,e[k]=0,k++;for(h=k=0;k<q;){j=m[k];f=m[k+1];a=m[k+2];j=o({r:j,g:f,b:a});g[j.y]+=v;if(j.y>d)d=j.y;if(j.y<c)c=j.y;n[h]=j;k+=4;h++}for(k=h=0;k<256;)h+=g[k],e[k]=h,k++;d-=c;for(h=k=0;k<q;)j=n[h],j.y=e[j.y]*d+c,g=t(j),m[k]=g.r,m[k+1]=g.g,m[k+2]=g.b,k+=4,h++;return m}})})(FILTER);
(function(b){b.RGBHistogramEqualizeFilter=b.Create({apply:function(m){var j,f,a,d,c,g;g=c=d=0;var e=255,h=255,k=255,q=new b.Array32F(256),v=new b.Array32F(256),n=new b.Array32F(256),o=new b.Array32F(256),t=new b.Array32F(256),u=new b.Array32F(256),p,l=m.length,r=1/(l>>2);for(p=0;p<256;)q[p]=0,v[p]=0,n[p]=0,o[p]=0,t[p]=0,u[p]=0,p++;for(p=0;p<l;)j=m[p],f=m[p+1],a=m[p+2],q[j]+=r,v[f]+=r,n[a]+=r,j>d&&(d=j),j<e&&(e=j),f>c&&(c=f),f<h&&(h=f),a>g&&(g=a),a<k&&(k=a),p+=4;for(p=j=f=a=0;p<256;)j+=q[p],o[p]=j,
f+=v[p],t[p]=f,a+=n[p],u[p]=a,p++;d-=e;c-=h;g-=k;for(p=0;p<l;)j=m[p],f=m[p+1],a=m[p+2],m[p]=o[j]*d+e,m[p+1]=t[f]*c+h,m[p+2]=u[a]*g+k,p+=4;return m}})})(FILTER);
(function(b){var m=Math.sqrt;b.PixelateFilter=b.Create({scale:1,init:function(b){this.scale=b||1},apply:function(j,f,a){if(this.scale<=1)return j;if(this.scale>100)this.scale=100;var d=j.length,c=f*a,a=~~(m(c)*this.scale*0.01),g=a*a,e=1/g,h=a<<2,k=f*a;g<<=2;var q=new b.Array32F(c*3),v,n,o,t=(f<<1)+f,u,p,l,r,w,B,F,P,aa,W,S,R;u=a-1;p=(a-1)*f;W=f-1;S=c-f;for(v=n=o=w=l=c=0;w<f;)v+=j[c],n+=j[c+1],o+=j[c+2],q[l]=v,q[l+1]=n,q[l+2]=o,c+=4,l+=3,w++;c=t+f;l=t;for(v=n=o=w=0;c<d;)v+=j[c],n+=j[c+1],o+=j[c+2],
q[l]=q[l-t]+v,q[l+1]=q[l-t+1]+n,q[l+2]=q[l-t+2]+o,c+=4,l+=3,w++,w>=f&&(v=n=o=w=0);for(v=t=w=c=0;c<d;){n=w;B=v;F=w+u;o=v+p;F>W&&(F=W);o>S&&(o=S);l=n+B;r=F+o;B=F+B;F=n+o;l=(l<<1)+l;B=(B<<1)+B;F=(F<<1)+F;r=(r<<1)+r;n=e*(q[r]-q[B]-q[F]+q[l]);o=e*(q[r+1]-q[B+1]-q[F+1]+q[l+1]);R=e*(q[r+2]-q[B+2]-q[F+2]+q[l+2]);n=~~n;o=~~o;R=~~R;l=c;B=w;F=v;aa=w+a;r=c+g;for(r>d&&(r=d);l<r;)if(P=B+F<<2,j[P]=n,j[P+1]=o,j[P+2]=R,l+=4,B++,B>=f||B>=aa)B=w,F+=f;c+=h;w+=a;w>=f&&(w=0,t+=a,v+=k)}return j}})})(FILTER);
(function(b){b.HSVConverterFilter=b.Create({apply:function(m,j,f){for(var a,d,c=m.length,g=b.Color.RGB2HSV,j=0;j<c;)f=m[j],a=m[j+1],d=m[j+2],d=g({r:f,g:a,b:d}),f=d.h*0.7083333333333334,a=d.s*255,d=d.v,m[j]=f,m[j+1]=d,m[j+2]=a,j+=4;return m}})})(FILTER);
(function(b){b.HueExtractorFilter=b.Create({range:null,background:0,init:function(b,j){this.range=b;this.range.sort();this.background=j||0},apply:function(m){if(!this.range||!this.range.length)return m;var j,f,a,d,c,g=m.length,e,h=b.Color.RGB2HSV,k=this.range[0],q=this.range[this.range.length-1];d=new b.ImArray(g);e=b.Color.Color2RGBA(this.background||0);for(c=0;c<g;)j=m[c],f=m[c+1],a=m[c+2],j=h({r:j,g:f,b:a}).h,j>=k&&j<=q?(d[c]=m[c],d[c+1]=m[c+1],d[c+2]=m[c+2],d[c+3]=m[c+3]):(d[c]=e.r,d[c+1]=e.g,
d[c+2]=e.b,d[c+3]=e.a),c+=4;return d}})})(FILTER);
