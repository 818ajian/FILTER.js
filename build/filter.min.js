/** 
*
* FILTER.js Image Processing Filter Library for JavaScript and HTML5 canvas
* http://github.com/foo123/FILTER.js
*
* @version 0.6.5
*
* @author Nikos M. http://nikos-web-development-netai.net
*
**/var FILTER=FILTER||{};!function(t){function e(t,e){return t&&i.call(t,e)}function n(t,n){t=t||{};for(var i in n)e(n,i)&&(t[i]=n[i]);return t}var i=Object.prototype.hasOwnProperty,r=Array.prototype.slice;t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,t.ImArray="undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:t.Array8U,t._notSupportTypedArrays=!t.ImArray.set,t._notSupportTypedArrays&&(t.ImArray.prototype.set||(t.ImArray.prototype.set=function(t){for(var e=t.length,n=e;--n;)this[n]=t[n]}),"undefined"!=typeof CanvasPixelArray&&(CanvasPixelArray.prototype.set=function(t){for(var e=t.length,n=e;--n;)this[n]=t[n]})),t.CONSTANTS={PI:Math.PI,PI2:2*Math.PI,SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI},t.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3},t.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4},t.LUMA=new t.Array32F([.212671,.71516,.072169]);var a=t.log=window.console&&window.console.log?window.console.log:function(){};t.warning=function(t){a("WARNING: "+t)},t.error=function(t){a("ERROR: "+t)},t.useWebGL=!1,t.useWebGLSharedResources=!1,t.useWebGLIfAvailable=function(){},t.useWebGLSharedResourcesIfAvailable=function(){};var s=window.devicePixelRatio||1;t.createCanvas=function(t,e){var n=document.createElement("canvas");return t=t||0,e=e||0,n.style.width=t+"px",n.style.height=e+"px",n.width=t*s,n.height=e*s,n};var h=0;t.getId=function(){return++h};var o=t.Filter=function(){};o.prototype={constructor:o,_apply:function(){},apply:function(){},reset:function(){}};var u=t.CompositeFilter=function(t){this._stack="undefined"!=typeof t&&t.length?t:[]};u.prototype={constructor:u,_stack:[],_apply:function(t,e,n,i){if(!this._stack.length)return t;for(var r,a=this._stack,s=a.length,h=0;s>h;)r=a[h++],r&&(t=r._apply(t,e,n,i));return t},apply:function(t){return this._stack.length?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},filters:function(t){return t&&(this._stack=t),this},push:function(t){return this._stack.push(t),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(t){return this._stack.unshift(t),this},concat:function(t){return this.push(t)},getAt:function(t){return this._stack.length>t?this._stack[t]:null},setAt:function(t,e){return this._stack.length>t&&(this._stack[t]=e),this},insertAt:function(t,e){return this._stack.splice(t,0,e),this},removeAt:function(t){return this._stack.splice(t,1),this},remove:function(t){for(var e=this._stack.length;--e>=0;)t===this._stack[e]&&this._stack.splice(e,1);return this},reset:function(){return this._stack.length=0,this}},t.Create=function(t){var e=function(){this.init.apply(this,r.call(arguments))};return t=n({init:function(){},reset:function(){return this},apply:function(t){return t}},t),t._apply=t.apply,t.apply=function(t){return t.setData(this._apply(t.getData(),t.width,t.height,t))},e.prototype=n(e.prototype,t),e}}(FILTER),function(t){var e=Math.sqrt,n=Math.min,r=Math.max;t.Color={ubyteToFloat:function(t){return.00392156862745098*t},ubyteColorToFloatColor:function(t){var e=t.length,n=new Array(e);for(i=0;e>i;i++)n[i]=.00392156862745098*t[i];return n},hexColorToFloatColor:function(t){var e,n,i,r;return e=255&t>>16,n=255&t>>8,i=255&t,r=255&t>>24,[.00392156862745098*e,.00392156862745098*n,.00392156862745098*i,.00392156862745098*r]},blend:function(t,e,n){return{r:t.r-~~((t.r-e.r)*n+.5),g:t.g-~~((t.g-e.g)*n+.5),b:t.b-~~((t.b-e.b)*n+.5)}},toGray:function(e,n,i){var r=t.LUMA;return~~(r[0]*e+r[1]*n+r[2]*i)},distance:function(t,n){var i=t.r-n.r,r=t.g-n.g,a=t.b-n.b;return e(i*i+r*r+a*a)},RGB2Color:function(t){return t.r<<16|t.g<<8|255&t.b},RGBA2Color:function(t){return t.a<<24|t.r<<16|t.g<<8|255&t.b},Color2RGBA:function(t){return t=~~t,{r:255&t>>>16,g:255&t>>>8,b:255&t,a:255&t>>>24}},RGB2YCbCr:function(t){var e,n,i,r=t.r,a=t.g,s=t.b;return e=~~(0+.299*r+.587*a+.114*s),n=~~(128-.168736*r-.331264*a+.5*s),i=~~(128+.5*r-.418688*a-.081312*s),{y:e,cb:n,cr:i}},YCbCr2RGB:function(t){var e,n,i,r=t.y,a=t.cb,s=t.cr;return e=~~(r+1.402*(s-128)),n=~~(r-.34414*(a-128)-.71414*(s-128)),i=~~(r+1.772*(a-128)),{r:e,g:n,b:i}},RGB2HSV:function(t){var e,i,a,s,h,o,u,c,f;return s=t.r,h=t.g,o=t.b,e=n(s,h,o),i=r(s,h,o),a=i-e,f=i,0==i?(c=0,u=0,{h:u,s:c,v:f}):(c=a/i,u=s==i?(h-o)/a:h==i?2+(o-s)/a:4+(s-h)/a,u*=60,0>u&&(u+=360),{h:u,s:c,v:f})},HSV2RGB:function(t){var e,n,i,r,a,s,h,o,u,c,f;if(u=t.h,c=t.s,f=t.v,0==c)return s=h=o=f,{r:s,g:h,b:o};switch(u/=60,e=~~u,n=u-e,i=f*(1-c),r=f*(1-c*n),a=f*(1-c*(1-n)),e){case 0:s=f,h=a,o=i;break;case 1:s=r,h=f,o=i;break;case 2:s=i,h=f,o=a;break;case 3:s=i,h=r,o=f;break;case 4:s=a,h=i,o=f;break;default:s=f,h=i,o=r}return{r:s,g:h,b:o}}}}(FILTER),function(t){var e,n=window.devicePixelRatio||1,i=Math.min,r=t.ImArray,a=t.Array32F,s=t.createCanvas;t._notSupportTypedArrays,e=t.blendModes={normal:function(t){return t},lighten:function(t,e){return e>t?e:t},darken:function(t,e){return e>t?t:e},multiply:function(t,e){return.003921568627451*t*e},average:function(t,e){return.5*(t+e)},add:function(t,e){return Math.min(255,t+e)},substract:function(t,e){return 255>t+e?0:t+e-255},difference:function(t,e){return Math.abs(t-e)},negation:function(t,e){return 255-Math.abs(255-t-e)},screen:function(t,e){return 255-((255-t)*(255-e)>>8)},exclusion:function(t,e){return t+e-.003921568627451*2*t*e},overlay:function(t,e){return 128>e?.003921568627451*2*t*e:255-.003921568627451*2*(255-t)*(255-e)},softLight:function(t,e){return 128>e?2*((t>>1)+64)*.003921568627451*e:255-.003921568627451*2*(255-((t>>1)+64))*(255-e)},hardLight:function(t,e){return 128>t?.003921568627451*2*e*t:255-.003921568627451*2*(255-e)*(255-t)},colorDodge:function(t,e){return 255==e?e:Math.min(255,(t<<8)/(255-e))},colorBurn:function(t,e){return 0==e?e:Math.max(0,255-(255-t<<8)/e)},linearLight:function(t,n){return 128>n?e.linearBurn(t,2*n):e.linearDodge(t,2*(n-128))},vividLight:function(t,n){return 128>n?e.colorBurn(t,2*n):e.colorDodge(t,2*(n-128))},pinLight:function(t,n){return 128>n?e.darken(t,2*n):e.lighten(t,2*(n-128))},hardMix:function(t,n){return e.vividLight(t,n)<128?0:255},reflect:function(t,e){return 255==e?e:Math.min(255,t*t/(255-e))},glow:function(t,e){return 255==t?t:Math.min(255,e*e/(255-t))},phoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}},e.linearDodge=e.add,e.linearBurn=e.substract;var h=t.Image=function(t,e){this.width=0,this.height=0,this.context=null,this.imageData=null,this.domElement=this.canvasElement=s(this.width,this.height),this.context=this.canvasElement.getContext("2d"),this._tmpCanvas=s(this.width,this.height),this.webgl=null,this._histogram=null,this._integral=null,this._histogramRefresh=!0,this._integralRefresh=!0,this.setImage(t,e)};h.prototype={constructor:h,width:0,height:0,canvasElement:null,domElement:null,context:null,webgl:null,setWidth:function(t){return this.imageData=this._setDimensions(t).context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},setHeight:function(t){return this.imageData=this._setDimensions(t).context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},setDimensions:function(t,e){return this.imageData=this._setDimensions(t,e).context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},setImage:function(e,n){if("undefined"==typeof e||null==e)return this;var i,r,a,s,h=this;return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?(i=e,a=i instanceof HTMLVideoElement?i.videoWidth:i.width,s=i instanceof HTMLVideoElement?i.videoHeight:i.height,r=h.context=h._setDimensions(a,s).canvasElement.getContext("2d"),r.drawImage(i,0,0),h.imageData=r.getImageData(0,0,a,s),h._histogramRefresh=!0,h._integralRefresh=!0,h.webgl=t.useWebGL?new t.WebGL(h.canvasElement):null):(i=new Image,i.onload=function(){a=i.width,s=i.height,r=h.context=h._setDimensions(a,s).canvasElement.getContext("2d"),r.drawImage(i,0,0),h.imageData=r.getImageData(0,0,a,s),h._histogramRefresh=!0,h._integralRefresh=!0,h.webgl=t.useWebGL?new t.WebGL(h.canvasElement):null,"undefined"!=typeof n&&n.call(h)},i.src=e),i.crossOrigin="",this},getPixel:function(t,e){var n=~~(e*this.width+t+.5),i=this.imageData.data;return{r:i[n],g:i[n+1],b:i[n+2],a:i[n+3]}},setPixel:function(t,e,n,i,a,s){var h=new r([255&n,255&i,255&a,255&s]);return this.context.putImageData(h,t,e),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},getData:function(){return new r(this.imageData.data)},setData:function(t){return this.imageData.data.set(t),this.context.putImageData(this.imageData,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},getPixelData:function(){return this.imageData},setPixelData:function(t){return this.context.putImageData(t,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},createImageData:function(t,e){return this.context=this._setDimensions(t,e).canvasElement.getContext("2d"),this.context.createImageData(t,e),this.imageData=this.context.getImageData(0,0,this.width,this.height),this.imageData},copy:function(t){return this.setData(t.getData()),this.imageData=this.context.getImageData(0,0,this.width,this.height),this},clone:function(){return new h(this.canvasElement)},scale:function(t,e){if(t=t||1,e=e||t,1==t&&1==e)return this;var i=this._tmpCanvas.getContext("2d");return i.scale(t,e),i.drawImage(this.canvasElement,0,0),this.width=~~(t*this.width+.5),this.height=~~(e*this.height+.5),this.canvasElement.style.width=this.width+"px",this.canvasElement.style.height=this.height+"px",this.canvasElement.width=this.width*n,this.canvasElement.height=this.height*n,this.context.drawImage(this._tmpCanvas,0,0),this._tmpCanvas.width=this.width,this._tmpCanvas.height=this.height,this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},flipHorizontal:function(){var t=this._tmpCanvas.getContext("2d");return t.translate(this.width,0),t.scale(-1,1),t.drawImage(this.canvasElement,0,0),this.context.drawImage(this._tmpCanvas,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},flipVertical:function(){var t=this._tmpCanvas.getContext("2d");return t.translate(0,this.height),t.scale(1,-1),t.drawImage(this.canvasElement,0,0),this.context.drawImage(this._tmpCanvas,0,0),this.imageData=this.context.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},clear:function(){if(this.width&&this.height){var t=this.context;t.clearRect(0,0,this.width,this.height),this.imageData=t.getImageData(0,0,this.width,this.height)}return this},fill:function(t,e,n,i,r){if(!i&&this.width&&!r&&this.height)return this;i&&!this.width&&r&&!this.height&&(this.context=this._setDimensions(i,r).canvasElement.getContext("2d"),this.context.createImageData(i,r),this.imageData=this.context.getImageData(0,0,this.width,this.height)),t=t||0,e=e||0,n=n||0,i=i||this.width,r=r||this.height;var a=this.context;return a.fillStyle=t,a.fillRect(e,n,i,r),this.imageData=a.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},draw:function(){return this},blend:function(t,n,r,a,s){"undefined"==typeof n&&(n="normal"),"undefined"==typeof r&&(r=1),r>1?r=1:0>r&&(r=0),"undefined"==typeof a&&(a=0),"undefined"==typeof s&&(s=0);var h=0,o=0,u=this.context;if(0>a&&(h=-a,a=0),0>s&&(o=-s,s=0),a>=this.width||s>=this.height)return this;var c=e[n];if(void 0==c||null==c)return this;var f,l,p,d,g,m,_,y=i(this.width,t.width-h),A=i(this.height,t.height-o),w=this.context.getImageData(a,s,y,A),v=t.context.getImageData(h,o,y,A),L=w.data,E=v.data,C=1-r,M=E.length;for(_=0;M>_;_+=4)d=L[_],g=L[_+1],m=L[_+2],f=c(E[_],d),l=c(E[_+1],g),p=c(E[_+2],m),L[_]=f*r+d*C,L[_+1]=l*r+g*C,L[_+2]=p*r+m*C;return u.putImageData(w,a,s),this.imageData=u.getImageData(0,0,this.width,this.height),this._histogramRefresh=!0,this._integralRefresh=!0,this},integral:function(){return this._integralRefresh&&this._computeIntegral(),this._integral},histogram:function(){return this._histogramRefresh&&this._computeHistogram(),this._histogram},_setDimensions:function(t,e){return this._tmpCanvas.style.width=this.canvasElement.style.width=t+"px",this._tmpCanvas.width=this.canvasElement.width=this.width=t*n,this._tmpCanvas.style.height=this.canvasElement.style.height=e+"px",this._tmpCanvas.height=this.canvasElement.height=this.height=e*n,this},_setWidth:function(t){return this._tmpCanvas.style.width=this.canvasElement.style.width=t+"px",this._tmpCanvas.width=this.canvasElement.width=this.width=t*n,this},_setHeight:function(t){return this._tmpCanvas.style.height=this.canvasElement.style.height=t+"px",this._tmpCanvas.height=this.canvasElement.height=this.height=t*n,this},_computeIntegral:function(){var t,e,n,i,r,s,h=this.width,o=this.height,u=h*o,c=h<<2,f=new a(u),l=new a(u),p=new a(u),d=this.getPixelData().data;for(t=0,e=0,n=0,i=r=s=0;h>n;)i+=d[t],r+=d[t+1],s+=d[t+2],f[e]=i,l[e]=r,p[e]=s,t+=4,e++,n++;for(t=c,n=0,i=r=s=0;imLen>t;)i+=d[t],r+=d[t+1],s+=d[t+2],f[e]=f[e-h]+i,l[e]=l[e-h]+r,p[e]=p[e-h]+s,t+=4,e++,n++,n>=h&&(n=0,i=r=s=0);this._integral=[f,l,p],this._integralRefresh=!1},_computeHistogram:function(){var t,e,n,i,r=this.getPixelData().data,i=0,s=r.length,h=0,o=0,u=0,c=255,f=255,l=255,p=new a(256),d=new a(256),g=new a(256),m=1/(s>>2);for(i=0;256>i;)p[i]=0,d[i]=0,g[i]=0,i++;for(i=0;s>i;)t=r[i],e=r[i+1],n=r[i+2],p[t]+=m,d[e]+=m,g[n]+=m,t>h&&(h=t),c>t&&(c=t),e>o&&(o=e),f>e&&(f=e),n>u&&(u=n),l>n&&(l=n),i+=4;this._histogram=[p,d,g],this._histogramRefresh=!1},_refresh:function(){return this.context=this.canvasElement.getContext("2d"),this.imageData=this.context.getImageData(0,0,this.width,this.height),this}}}(FILTER),function(t){var e=t.CustomFilter=function(t){this._handler=t};e.prototype={constructor:e,_handler:null,_apply:function(t,e,n,i){return this._handler?this._handler.call(this,t,e,n,i):t},apply:function(t){return this._handler?t.setData(this._handler.call(this,t.getData(),t.width,t.height,t)):t}}}(FILTER),function(t){function e(t,e){var n,r,a,s,h,o=new i(20);return n=e[0],r=e[1],a=e[2],s=e[3],h=e[4],o[0]=n*t[0]+r*t[5]+a*t[10]+s*t[15],o[1]=n*t[1]+r*t[6]+a*t[11]+s*t[16],o[2]=n*t[2]+r*t[7]+a*t[12]+s*t[17],o[3]=n*t[3]+r*t[8]+a*t[13]+s*t[18],o[4]=n*t[4]+r*t[9]+a*t[14]+s*t[19]+h,n=e[5],r=e[6],a=e[7],s=e[8],h=e[9],o[5]=n*t[0]+r*t[5]+a*t[10]+s*t[15],o[6]=n*t[1]+r*t[6]+a*t[11]+s*t[16],o[7]=n*t[2]+r*t[7]+a*t[12]+s*t[17],o[8]=n*t[3]+r*t[8]+a*t[13]+s*t[18],o[9]=n*t[4]+r*t[9]+a*t[14]+s*t[19]+h,n=e[10],r=e[11],a=e[12],s=e[13],h=e[14],o[10]=n*t[0]+r*t[5]+a*t[10]+s*t[15],o[11]=n*t[1]+r*t[6]+a*t[11]+s*t[16],o[12]=n*t[2]+r*t[7]+a*t[12]+s*t[17],o[13]=n*t[3]+r*t[8]+a*t[13]+s*t[18],o[14]=n*t[4]+r*t[9]+a*t[14]+s*t[19]+h,n=e[15],r=e[16],a=e[17],s=e[18],h=e[19],o[15]=n*t[0]+r*t[5]+a*t[10]+s*t[15],o[16]=n*t[1]+r*t[6]+a*t[11]+s*t[16],o[17]=n*t[2]+r*t[7]+a*t[12]+s*t[17],o[18]=n*t[3]+r*t[8]+a*t[13]+s*t[18],o[19]=n*t[4]+r*t[9]+a*t[14]+s*t[19]+h,o}function n(t,e,n){var r=1-n,a=new i(20);return a[0]=r*t[0]+n*e[0],a[1]=r*t[1]+n*e[1],a[2]=r*t[2]+n*e[2],a[3]=r*t[3]+n*e[3],a[4]=r*t[4]+n*e[4],a[5]=r*t[5]+n*e[5],a[6]=r*t[6]+n*e[6],a[7]=r*t[7]+n*e[7],a[8]=r*t[8]+n*e[8],a[9]=r*t[9]+n*e[9],a[10]=r*t[10]+n*e[10],a[11]=r*t[11]+n*e[11],a[12]=r*t[12]+n*e[12],a[13]=r*t[13]+n*e[13],a[14]=r*t[14]+n*e[14],a[15]=r*t[15]+n*e[15],a[16]=r*t[16]+n*e[16],a[17]=r*t[17]+n*e[17],a[18]=r*t[18]+n*e[18],a[19]=r*t[19]+n*e[19],a}var i=t.Array32F,r=t.CONSTANTS.toRad,a=(t.CONSTANTS.toDeg,t._notSupportTypedArrays),s=t.ColorMatrixFilter=function(e){this._matrix="undefined"!=typeof e&&e.length?new i(e):null,t.useWebGL&&(this._webglInstance=t.WebGLColorMatrixFilterInstance)};s.prototype={constructor:s,_matrix:null,_webglInstance:null,channel:function(e,n){n="undefined"==typeof n?!1:n;var i=n?1:0;switch(e){case t.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case t.CHANNEL.BLUE:return this.concat([0,0,i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,0,0,255]);case t.CHANNEL.GREEN:return this.concat([0,i,0,0,0,0,1,0,0,0,0,i,0,0,0,0,0,0,0,255]);case t.CHANNEL.RED:default:return this.concat([1,0,0,0,0,i,0,0,0,0,i,0,0,0,0,0,0,0,0,255])}},redChannel:function(e){return this.channel(t.CHANNEL.RED,e)},greenChannel:function(e){return this.channel(t.CHANNEL.GREEN,e)},blueChannel:function(e){return this.channel(t.CHANNEL.BLUE,e)},alphaChannel:function(){return this.channel(t.CHANNEL.ALPHA,!0)},maskChannel:function(e){switch(e){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.concat([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(e,n){switch(e){case t.CHANNEL.ALPHA:switch(n){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.RED:default:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case t.CHANNEL.BLUE:switch(n){case t.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.BLUE:return this;case t.CHANNEL.GREEN:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case t.CHANNEL.GREEN:switch(n){case t.CHANNEL.ALPHA:return this.concat([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.BLUE:return this.concat([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this;case t.CHANNEL.RED:default:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case t.CHANNEL.RED:default:switch(n){case t.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case t.CHANNEL.BLUE:return this.concat([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.concat([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this}}},desaturate:function(){return this.concat([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,0,0,0,1,0])},colorize:function(e,n){var i,r,a,s;return"undefined"==typeof n&&(n=1),i=.00392156862745098*(255&e>>16),r=.00392156862745098*(255&e>>8),a=.00392156862745098*(255&e),s=1-n,this.concat([s+n*i*t.LUMA[0],n*i*t.LUMA[1],n*i*t.LUMA[2],0,0,n*r*t.LUMA[0],s+n*r*t.LUMA[1],n*r*t.LUMA[2],0,0,n*a*t.LUMA[0],n*a*t.LUMA[1],s+n*a*t.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(e){var n,i,r,a;return n=1-e,i=n*t.LUMA[0],r=n*t.LUMA[1],a=n*t.LUMA[2],this.concat([i+e,r,a,0,0,i,r+e,a,0,0,i,r,a+e,0,0,0,0,0,1,0])},contrast:function(t,e,n){return"undefined"==typeof e&&(e=t),"undefined"==typeof n&&(n=t),t+=1,e+=1,n+=1,this._log=!0,this.concat([t,0,0,0,128*(1-t),0,e,0,0,128*(1-e),0,0,n,0,128*(1-n),0,0,0,1,0])},brightness:function(t,e,n){return"undefined"==typeof e&&(e=t),"undefined"==typeof n&&(n=t),this.concat([1,0,0,0,t,0,1,0,0,e,0,0,1,0,n,0,0,0,1,0])},adjustHue:function(e){e*=r;var n=Math.cos(e),i=Math.sin(e);return this.concat([t.LUMA[0]+n*(1-t.LUMA[0])+i*-t.LUMA[0],t.LUMA[1]+n*-t.LUMA[1]+i*-t.LUMA[1],t.LUMA[2]+n*-t.LUMA[2]+i*(1-t.LUMA[2]),0,0,t.LUMA[0]+n*-t.LUMA[0]+.143*i,t.LUMA[1]+n*(1-t.LUMA[1])+.14*i,t.LUMA[2]+n*-t.LUMA[2]+i*-.283,0,0,t.LUMA[0]+n*-t.LUMA[0]+i*-(1-t.LUMA[0]),t.LUMA[1]+n*-t.LUMA[1]+i*t.LUMA[1],t.LUMA[2]+n*(1-t.LUMA[2])+i*t.LUMA[2],0,0,0,0,0,1,0])},average:function(t,e,n){return"undefined"==typeof t&&(t=.3333),"undefined"==typeof e&&(e=.3333),"undefined"==typeof n&&(n=.3334),this.concat([t,e,n,0,0,t,e,n,0,0,t,e,n,0,0,0,0,0,1,0])},quickContrastCorrection:function(t){return"undefined"==typeof t&&(t=1.2),this.concat([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0])},sepia:function(t){return"undefined"==typeof t&&(t=.5),t>1?t=1:0>t&&(t=0),this.concat([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0])},quickSepia:function(e){return"undefined"==typeof e&&(e=10),e>100&&(e=100),e*=2.55,this.concat([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,40,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,20,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,-e,0,0,0,1,0])},threshold:function(e,n){return"undefined"==typeof n&&(n=256),this.concat([t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*e,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*e,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*e,0,0,0,1,0])},threshold_rgb:function(t,e){return"undefined"==typeof e&&(e=256),this.concat([e,0,0,0,-(e-1)*t,0,e,0,0,-(e-1)*t,0,0,e,0,-(e-1)*t,0,0,0,1,0])},threshold_alpha:function(t,e){return"undefined"==typeof t&&(t=.5),"undefined"==typeof e&&(e=256),this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,e,-e*t])},RGB2YCbCr:function(){return this.concat([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.concat([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(t,e){return this._matrix=this._matrix?n(this._matrix,t.getMatrix(),e):new i(t.getMatrix()),this},concat:function(t){return this._matrix=this._matrix?e(this._matrix,new i(t)):new i(t),this},combineWith:function(t){return this.concat(t.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(t){return this._matrix=t,this},_apply:function(t){if(!this._matrix)return t;for(var e,n,i,r,s,h,o,u,c=t.length,f=this._matrix,l=0;c>l;)e=t[l],n=t[l+1],i=t[l+2],r=t[l+3],s=f[0]*e+f[1]*n+f[2]*i+f[3]*r+f[4],h=f[5]*e+f[6]*n+f[7]*i+f[8]*r+f[9],o=f[10]*e+f[11]*n+f[12]*i+f[13]*r+f[14],u=f[15]*e+f[16]*n+f[17]*i+f[18]*r+f[19],a&&(0>s?s=0:s>255&&(s=255),0>h?h=0:h>255&&(h=255),0>o?o=0:o>255&&(o=255),0>u?u=0:u>255&&(u=255)),t[l]=~~s,t[l+1]=~~h,t[l+2]=~~o,t[l+3]=~~u,l+=4;return t},apply:function(t){return this._matrix?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},reset:function(){return this._matrix=null,this}},s.prototype.grayscale=s.prototype.desaturate}(FILTER),function(t){function e(t){var e=new r(256),n=0;if(t)for(;256>n;)e[n]=255-n,n++;else for(;256>n;)e[n]=n,n++;return e}function n(t){for(var e=new r(256),n=0;256>n;)e[n]=t,n++;return e}function i(t){return t?new r(t):null}var r=t.ImArray,a=Math.pow,s=Math.exp,h=1/255,o=e(),u=e(1),c=t.TableLookupFilter=function(t,e,n,i){this._tableR=t||null,this._tableG=e||this._tableR,this._tableB=n||this._tableG,this._tableA=i||null};c.prototype={constructor:c,_tableR:null,_tableG:null,_tableB:null,_tableA:null,thresholds:function(t,e,n){t.length||(t=[t]),e||(e=t),n||(n=e);var i,a,s=t.length,h=s+1,o=e.length,u=o+1,c=n.length,f=c+1,l=new r(256),p=new r(h),d=new r(256),g=new r(u),m=new r(256),_=new r(f),y=255/(h-1),A=255/(u-1),w=255/(f-1);for(i=0;h>i;)p[i]=~~(y*i),i++;for(t[0]=~~(255*t[0]),i=1;s>i;)t[i]=t[i-1]+~~(255*t[i]),i++;for(i=0;u>i;)g[i]=~~(A*i),i++;for(e[0]=~~(255*e[0]),i=1;o>i;)e[i]=e[i-1]+~~(255*e[i]),i++;for(i=0;f>i;)_[i]=~~(w*i),i++;for(n[0]=~~(255*n[0]),i=1;c>i;)n[i]=n[i-1]+~~(255*n[i]),i++;for(i=0;256>i;){for(a=0;s>a&&i>t[a];)a++;for(l[i]=p[a],a=0;o>a&&i>e[a];)a++;for(d[i]=g[a],a=0;c>a&&i>n[a];)a++;m[i]=_[a],i++}return this.concat(l,d,m)},threshold:function(t,e,n){return t=t||.5,e=e||t,n=n||e,this.thresholds([t],[e],[n])},quantize:function(t){"undefined"==typeof t&&(t=64),2>t&&(t=2);var e,n=new r(256),i=new r(t),a=255/(t-1),s=t/256;for(e=0;t>e;)i[e]=~~(a*e),e++;for(e=0;256>e;)n[e]=i[~~(s*e)],e++;return this.concat(n)},levels:function(t){return this.quantize(t)},posterize:function(t){return this.quantize(t)},binarize:function(){return this.quantize(2)},solarize:function(t){"undefined"==typeof t&&(t=.5);var e=0,n=new r(256);for(t=~~(256*t)-1,e=0;256>e;)n[e]=e>t?255-(e<<1):(e<<1)-255,e++;return this.concat(n)},invert:function(){return this.concat(u)},mask:function(t){var e=0,n=255&t>>16,i=255&t>>8,a=255&t;for(tR=new r(256),tG=new r(256),tB=new r(256),e=0;256>e;)tR[e]=e&n,tG[e]=e&i,tB[e]=e&a,e++;return this.concat(tR,tG,tB)},replace:function(t,e){if(t==e)return this;var n=255&t>>16,r=255&t>>8,a=255&t,s=255&e>>16,h=255&e>>8,u=255&e,c=i(o),f=i(o),l=i(o);return c[n]=s,f[r]=h,l[a]=u,this.concat(c,f,l)},extract:function(e,i,r){if(!i||!i.length)return this;r=r||0;var a,s,h=255&r>>16,o=255&r>>8,u=255&r,c=n(h),f=n(o),l=n(u);switch(e){case t.CHANNEL.BLUE:for(a=i[0],s=i[1];s>=a;)l[a]=a,a++;break;case t.CHANNEL.GREEN:for(a=i[0],s=i[1];s>=a;)f[a]=a,a++;break;case t.CHANNEL.RED:default:for(a=i[0],s=i[1];s>=a;)c[a]=a,a++}return this.concat(c,f,l)},gammaCorrection:function(t,e,n){t=t||1,e=e||t,n=n||e,t=1/t,e=1/e,n=1/n;for(var i=new r(256),s=new r(256),o=new r(256),u=0;256>u;)i[u]=~~(255*a(h*u,t)),s[u]=~~(255*a(h*u,e)),o[u]=~~(255*a(h*u,n)),u++;return this.concat(i,s,o)},exposure:function(t){"undefined"==typeof t&&(t=1);var e=0,n=new r(256);for(e=0;256>e;)n[e]=~~(255*(1-s(-t*e*h))),e++;return this.concat(n)},concat:function(t,n,r){if(!t)return this;n=n||t,r=r||n;var a,s,h,o,u,c=this._tableR||e(),f=i(c);if(n&&r){for(a=this._tableG||i(c),s=this._tableB||i(a),h=i(a),o=i(s),u=0;256>u;)c[u]=t[f[u]],a[u]=n[h[u]],s[u]=r[o[u]],u++;this._tableR=c,this._tableG=a,this._tableB=s}else{for(u=0;256>u;)c[u]=t[f[u]],u++;this._tableR=c,this._tableG=this._tableR,this._tableB=this._tableR}return this},combineWith:function(t){return this.concat(t.getTable(0),t.getTable(1),t.getTable(2))},getTable:function(e){switch(e=e||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA;case t.CHANNEL.BLUE:return this._tableB;case t.CHANNEL.GREEN:return this._tableG;case t.CHANNEL.RED:default:return this._tableR}},setTable:function(e,n){switch(n=n||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA=e,this;case t.CHANNEL.BLUE:return this._tableB=e,this;case t.CHANNEL.GREEN:return this._tableG=e,this;case t.CHANNEL.RED:default:return this._tableR=e,this}},_apply:function(t){if(!this._tableR)return t;var e,n,i,r,a=t.length,s=0,h=this._tableR,o=this._tableG,u=this._tableB,c=this._tableA;if(c)for(;a>s;)e=t[s],n=t[s+1],i=t[s+2],r=t[s+3],t[s]=h[e],t[s+1]=o[n],t[s+2]=u[i],t[s+3]=c[r],s+=4;else for(;a>s;)e=t[s],n=t[s+1],i=t[s+2],t[s]=h[e],t[s+1]=o[n],t[s+2]=u[i],s+=4;return t},apply:function(t){return this._tableR?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},reset:function(){return this._tableR=null,this._tableG=null,this._tableB=null,this._tableA=null,this}}}(FILTER),function(t){var e=t.ImArray,n=Math.min;Math.max;var i=t.DisplacementMapFilter=function(t){t&&this.setMap(t)};i.prototype={constructor:i,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:t.MODE.CLAMP,_map:null,combineWith:function(){return this},getMap:function(){return this._map},setMap:function(t){return this._map=t,this},_apply:function(i,r,a){if(!this._map)return i;var s,h,o,u,c,f,l,p,d,g,m=this._map.getData(),_=this._map.width,y=this._map.height,A=_*y,w=new t.Array16I(A<<1),v=n(_,r),L=n(y,a),E=.00390625*this.scaleX,C=.00390625*this.scaleY,M=this.componentX,b=this.componentY,x=255&this.color>>24,R=255&this.color>>16,D=255&this.color>>8,N=255&this.color,I=~~this.startY,U=~~this.startX,H=this.mode,F=I*r,k=-U,T=-I,G=r-U-1,B=a-I-1,P=v*L<<2,S=(i.length,new e(i)),O=t.MODE.IGNORE,Y=t.MODE.CLAMP,W=t.MODE.COLOR,X=t.MODE.WRAP;for(s=0,h=0,o=0,u=0,c=0;A>s;)p=o+c<<2,w[h]=~~((m[p+M]-128)*E),w[h+1]=~~((m[p+b]-128)*C),s++,h+=2,o++,o>=_&&(o=0,u++,c+=_);for(s=-4,o=-1,u=0,c=0,ty2=0;P>s;)if(s+=4,o++,o>=v&&(o=0,u++,c+=r,ty2+=_),!(T>u||u>B||k>o||o>G)){if(l=o+U,f=u+I,d=l+c+F<<2,h=o+ty2<<1,srcx=l+w[h],srcy=f+w[h+1],srcy>=a||0>srcy||srcx>=r||0>srcx)switch(H){case O:continue;case W:S[d]=R,S[d+1]=D,S[d+2]=N,S[d+3]=x;continue;case X:srcy>B?srcy-=a:0>srcy&&(srcy+=a),srcx>G?srcx-=r:0>srcx&&(srcx+=r);break;case Y:default:srcy>B?srcy=B:0>srcy&&(srcy=0),srcx>G?srcx=G:0>srcx&&(srcx=0)}g=srcx+srcy*r<<2,S[d]=i[g],S[d+1]=i[g+1],S[d+2]=i[g+2],S[d+3]=i[g+3]}return S},apply:function(t){return this._map?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},reset:function(){return this._map=null,this}}}(FILTER),function(t){function e(t,e){var n,i,r,a,s,h=t.length,o=new l(h);for(a=0,n=0,i=0,r=0;h>a;)s=e-1-n+r<<2,o[a]=t[s],o[a+1]=t[s+1],o[a+2]=t[s+2],o[a+3]=t[s+3],a+=4,n++,n>=e&&(n=0,i++,r+=e);return o}function n(t,e,n){var i,r,a,s,h,o=t.length,u=new l(o);for(s=0,i=0,r=0,a=(n-1)*e;o>s;)h=i+a<<2,u[s]=t[h],u[s+1]=t[h+1],u[s+2]=t[h+2],u[s+3]=t[h+3],s+=4,i++,i>=e&&(i=0,r++,a-=e);return u}function i(t,e,n){var i,r,a,s,h,o,u=t.length,c=new l(u);for(h=0,i=0,r=0,s=(n-1)*e;u>h;)o=e-1-i+s<<2,c[h]=t[o],c[h+1]=t[o+1],c[h+2]=t[o+2],c[h+3]=t[o+3],h+=4,i++,i>=e&&(i=0,r++,a+=e,s-=e);return c}function r(t,e,n){var i,r,a,s,h,o=t.length,u=new l(o),c=n*e;for(s=0,i=0,r=0,a=c-1;o>s;)h=r+a<<2,u[s]=t[h],u[s+1]=t[h+1],u[s+2]=t[h+2],u[s+3]=t[h+3],s+=4,i++,a-=e,i>=e&&(i=0,a=c-1,r++);return u}function a(t,e,n){var i,r,a,s,h,o=t.length,u=new l(o);for(s=0,i=0,r=0,a=0;o>s;)h=e-1-r+a<<2,u[s]=t[h],u[s+1]=t[h+1],u[s+2]=t[h+2],u[s+3]=t[h+3],s+=4,i++,a+=e,i>=e&&(i=0,a=0,r++);return u}function s(e,n,i){var r,a,s,h,o,u,c,f=e.length,p=new l(f),d=this.inverseTransform,g=this.mode,m=t.MODE.CLAMP,_=t.MODE.WRAP;for(s=0,r=0,a=0;f>s;){if(o=d([r,a],n,i),u=~~o[0],c=~~o[1],0>u||u>=n||0>c||c>=i)switch(g){case _:c>=i?c-=i:0>c&&(c+=i),u>=n?u-=n:0>u&&(u+=n);break;case m:default:c>=i?c=i-1:0>c&&(c=0),u>=n?u=n-1:0>u&&(u=0)}h=u+c*n<<2,p[s]=e[h],p[s+1]=e[h+1],p[s+2]=e[h+2],p[s+3]=e[h+3],s+=4,r++,r>=n&&(r=0,a++)}return p}function h(e,n,i){var r,a,s,h,o,u,c,f,p,d=n*i,g=e.length,m=new l(g),_=this.matrix,y=_[0],A=_[1],w=_[3],v=_[4],L=_[2],E=_[5],C=this.mode,M=t.MODE.CLAMP,b=t.MODE.WRAP,x=n-1,R=d-n;for(s=0,r=0,a=0,o=E*n,u=w*n,c=v*n;g>s;){if(f=~~(y*r+A*a+L),p=~~(u*r+c*a+o),0>f||f>x||0>p||p>R)switch(C){case b:p>R?p-=d:0>p&&(p+=d),f>=n?f-=n:0>f&&(f+=n);break;case M:default:p>R?p=R:0>p&&(p=0),f>x?f=x:0>f&&(f=0)}h=f+p<<2,m[s]=e[h],m[s+1]=e[h+1],m[s+2]=e[h+2],m[s+3]=e[h+3],s+=4,r++,r>=n&&(r=0,a++)}return m}function o(e,n,i){if(0>=this.radius)return e;var r,a,s,h,o,u,c,f,_=e.length,y=new l(e),A=this.centerX,w=this.centerY,v=this.angle,L=this.radius,E=this.mode,C=t.MODE.CLAMP,M=t.MODE.WRAP,b=v/L,x=n-1,R=i-1;for(s=0,r=0,a=0;_>s;){if(u=r-A,c=a-w,o=p(u*u+c*c),L>o){if(f=d(c,u)+b*(L-o),u=~~(A+o*m(f)),c=~~(w+o*g(f)),0>u||u>x||0>c||c>R)switch(E){case M:c>R?c-=i:0>c&&(c+=i),u>x?u-=n:0>u&&(u+=n);break;case C:default:c>R?c=R:0>c&&(c=0),u>x?u=x:0>u&&(u=0)}h=u+c*n<<2,y[s]=e[h],y[s+1]=e[h+1],y[s+2]=e[h+2],y[s+3]=e[h+3]}s+=4,r++,r>=n&&(r=0,a++)}return y}function u(e,n,i){if(0>=this.radius)return e;var r,a,s,h,o,u,c,f,d,g,m,A,w,v=e.length,L=new l(e),E=this.centerX,C=this.centerY,M=this.radius,b=this.mode,x=t.MODE.CLAMP,R=t.MODE.WRAP,D=M*M,N=.555556,I=1-N,U=n-1,H=i-1;for(s=0,r=0,a=0;v>s;){if(o=r-E,u=a-C,A=o*o,w=u*u,c=A+w,D>c){if(g=D-c,m=p(g),f=_(o/p(A+g))*I,d=_(u/p(w+g))*I,o=~~(r-m*y(f)),u=~~(a-m*y(d)),0>o||o>U||0>u||u>H)switch(b){case R:u>H?u-=i:0>u&&(u+=i),o>U?o-=n:0>o&&(o+=n);break;case x:default:u>H?u=H:0>u&&(u=0),o>U?o=U:0>o&&(o=0)}h=o+u*n<<2,L[s]=e[h],L[s+1]=e[h+1],L[s+2]=e[h+2],L[s+3]=e[h+3]}s+=4,r++,r>=n&&(r=0,a++)}return L}function c(t){return t}function f(t){return t}var l=t.ImArray,p=(t.CONSTANTS.PI,Math.sqrt),d=Math.atan2,g=Math.sin,m=Math.cos,_=Math.asin,y=Math.tan;Math.abs,t.CONSTANTS.toRad;var A=t.GeometricMapFilter=function(t){this.generic(t)};A.prototype={constructor:A,_map:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,angle:0,radius:0,mode:t.MODE.CLAMP,generic:function(t){return t&&(this.inverseTransform=t,this._map=s),this
},affine:function(t){return t&&(this.matrix=t,this._map=h),this},flipX:function(){return this._map=e,this},flipY:function(){return this._map=n,this},flipXY:function(){return this._map=i,this},rotateCW:function(){return this._map=r,this},rotateCCW:function(){return this._map=a,this},polar:function(t,e){return this.centerX=t||0,this.centerY=e||0,this._map=c,this},cartesian:function(t,e){return this.centerX=t||0,this.centerY=e||0,this._map=f,this},twirl:function(t,e,n,i){return this.angle=t||0,this.radius=e||0,this.centerX=n||0,this.centerY=i||0,this._map=o,this},sphere:function(t,e,n){return this.radius=t||0,this.centerX=e||0,this.centerY=n||0,this._map=u,this},combineWith:function(){return this},getMap:function(){return this._map},setMap:function(t){return this._map=t,this},_apply:function(t,e,n,i){return this._map?this._map.call(this,t,e,n,i):t},apply:function(t){return this._map?t.setData(this._map.call(this,t.getData(),t.width,t.height,t)):t},reset:function(){return this._map=null,this}}}(FILTER),function(t){function e(t,e,n,i){var r,a=t.length,s=new _(t.length);for(n=n||1,i=i||1,r=0;a>r;)s[r]=n*t[r]+i*e[r],r++;return s}function n(t,e){var n,i,r,a=t.length,s=[],h=0;for(n=0;a>n;n++)for(i=0;a>i;i++)r=t[n]*e[i],h+=r,s.push(r);return{kernel:s,sum:h}}function i(t){var e,n=new Array(t);for(e=0;t>e;)n[e]=1,e++;return n}function r(t){var e,n,i,r,a=A.length;if(t--,a>t)e=new _(A[t]);else for(e=new _(A[a-1]);t>=a;){for(n=e,e=new _(n.length+1),e[0]=1,i=0,r=n.length-1;r>i;i++)e[i+1]=n[i]+n[i+1];e[n.length]=1,40>a&&A.push(new Array(e)),a++}return e}function a(t){var e,n=t>>1,i=-n,r=new Array(t);for(e=0;t>e;)r[e]=i,i++,e++;return r}function s(t){var e=r(t);return n(e,e)}function h(t,e){var i=r(t),s=a(t);return 1==e?n(s.reverse(),i):n(i,s)}function o(t,e){var r=i(t),s=a(t);return 1==e?n(s.reverse(),r):n(r,s)}function u(t,e,n){e=e||1,n=n||e;var i,r=t*t,a=r>>1,s=new _(r);for(i=0;r>i;)s[i]=e,i++;return s[a]=n,s}function c(t,e,n,i){var r,a,s,h,o,u=t*t,c=t>>1,f=u>>1,l=new _(u);for(h=0,r=0;c>=r;r++){for(a=0,o=0,s=0;c>=s;s++)l[f+r+a]=h+o,l[f-r-a]=-h-o,l[f-r+a]=-h+o,l[f+r-a]=h-o,a+=t,o+=n;h+=e}return i=i||1,l[f]=i,l}function f(t,e,n,i){var r,a,s,h,o,u,c=t*t,f=t>>1,l=c>>1,p=new _(c),d=new _(c),g=1/t,m=1e-8;for(v(e)>m?(o=1,u=n/e):(o=e/n,u=1),r=0,s=0,h=0,a=u*t;f>=r;)d[l+r]=~~(l+s+h+.5),d[l-r]=~~(l-s-h+.5),r++,s+=o,h+=a;for(r=0;f>=r;)p[d[l+r]]=p[d[l-r]]=g,r++;return i=i||1,p[l]=i,p}function l(e,n,i,r,a,s,h,o,u,c){var f,l,p,d,g,_,A,w,v,L,E,C,M,b,x,R,D,N,I,U,H,F,k,T,G,B,P,S,O,Y,W,X,q,z,V,Q,j,J,K,Z,$,te,ee,ne,ie,re,ae,se,he,oe,ue=e.length,ce=s,fe=h;if(f=n*i,v=ce*fe,A=ce>>1,w=n*(fe>>1),C=-A-1,b=-w-n,M=A,x=w,W=0,q=n-1,X=0,z=f-n,p=(f<<1)+f,E=(n<<1)+n,c=c||1,oe=0,a)for(H=r[0],F=r[v>>1],k=F-H,T=a[0],G=a[v>>1],B=G-T,se=o,he=u;c>oe;){for(L=new m(e),l=new t.Array32F(p),R=0,D=0,N=0,d=g=_=0;n>N;)d+=e[R],g+=e[R+1],_+=e[R+2],l[D]=d,l[D+1]=g,l[D+2]=_,R+=4,D+=3,N++;for(R=E+n,D=E,N=0,d=g=_=0;ue>R;)d+=e[R],g+=e[R+1],_+=e[R+2],l[D]=l[D-E]+d,l[D+1]=l[D-E+1]+g,l[D+2]=l[D-E+2]+_,R+=4,D+=3,N++,N>=n&&(N=0,d=g=_=0);for(R=0,N=0,I=0,U=0;ue>R;)P=N+C,S=U+b,O=N+M,Y=U+x,W>P?P=W:O>q&&(O=q),X>S?S=X:Y>z&&(Y=z),V=P+S,J=O+Y,Q=O+S,j=P+Y,V=(V<<1)+V,Q=(Q<<1)+Q,j=(j<<1)+j,J=(J<<1)+J,te=H*(l[J]-l[Q]-l[j]+l[V])+k*e[R],ee=H*(l[J+1]-l[Q+1]-l[j+1]+l[V+1])+k*e[R+1],ne=H*(l[J+2]-l[Q+2]-l[j+2]+l[V+2])+k*e[R+2],ie=T*(l[J]-l[Q]-l[j]+l[V])+B*e[R],re=T*(l[J+1]-l[Q+1]-l[j+1]+l[V+1])+B*e[R+1],ae=T*(l[J+2]-l[Q+2]-l[j+2]+l[V+2])+B*e[R+2],K=se*te+he*ie,Z=se*ee+he*re,$=se*ne+he*ae,y&&(0>K?K=0:K>255&&(K=255),0>Z?Z=0:Z>255&&(Z=255),0>$?$=0:$>255&&($=255)),L[R]=~~K,L[R+1]=~~Z,L[R+2]=~~$,R+=4,N++,N>=n&&(N=0,I++,U+=n);e=L,oe++}else for(H=r[0],F=r[v>>1],k=F-H,o=o||1,u=u||0;c>oe;){for(L=new m(e),l=new t.Array32F(p),R=0,D=0,N=0,d=g=_=0;n>N;)d+=e[R],g+=e[R+1],_+=e[R+2],l[D]=d,l[D+1]=g,l[D+2]=_,R+=4,D+=3,N++;for(R=E+n,D=E,N=0,d=g=_=0;ue>R;)d+=e[R],g+=e[R+1],_+=e[R+2],l[D]=l[D-E]+d,l[D+1]=l[D-E+1]+g,l[D+2]=l[D-E+2]+_,R+=4,D+=3,N++,N>=n&&(N=0,d=g=_=0);for(R=0,N=0,I=0,U=0;ue>R;)P=N+C,S=U+b,O=N+M,Y=U+x,W>P?P=W:O>q&&(O=q),X>S?S=X:Y>z&&(Y=z),V=P+S,J=O+Y,Q=O+S,j=P+Y,V=(V<<1)+V,Q=(Q<<1)+Q,j=(j<<1)+j,J=(J<<1)+J,te=H*(l[J]-l[Q]-l[j]+l[V])+k*e[R],ee=H*(l[J+1]-l[Q+1]-l[j+1]+l[V+1])+k*e[R+1],ne=H*(l[J+2]-l[Q+2]-l[j+2]+l[V+2])+k*e[R+2],K=o*te+u,Z=o*ee+u,$=o*ne+u,y&&(0>K?K=0:K>255&&(K=255),0>Z?Z=0:Z>255&&(Z=255),0>$?$=0:$>255&&($=255)),L[R]=~~K,L[R+1]=~~Z,L[R+2]=~~$,R+=4,N++,N>=n&&(N=0,I++,U+=n);e=L,oe++}return L}function p(e,n,i,r,a,s,h,o,u){var c,f,l,p,d,g,_,A,w,v,L,E,C,M,b,x,R,D,N,I,U,H,F,k,T,G,B,P,S,O,Y,W,X,q,z,V,Q=e.length;for(c=n*i,g=[h,s],_=[a,r],f=[1,s],l=[h,1],p=[0,s>>1],d=[h>>1,0],q=[u,o],T=n-1,G=c-n,V=2;--V;){for(C=new m(e),L=g[V],E=_[V],w=p[V],v=d[V],A=f[V],z=q[V],x=new t.Array16I(L<<1),b=new t.Array8U(L),D=0,N=0,I=0,U=0,H=0,M=v*n;L>N;)b[N]=I+U,x[D]=I-w,x[D+1]=H-M,D+=2,N++,I++,I>=A&&(I=0,U+=A,H+=n);for(R=0,I=0,U=0;Q>R;){for(Y=0,W=0,X=0,D=0,N=0;L>N;)F=I+x[D],k=U+x[D+1],F>=0&&T>=F&&k>=0&&G>=k&&(srcOff=F+k<<2,O=z*E[b[N]],Y+=e[srcOff]*O,W+=e[srcOff+1]*O,X+=e[srcOff+2]*O),D+=2,N++;B=Y,P=W,S=X,y&&(0>B?B=0:B>255&&(B=255),0>P?P=0:P>255&&(P=255),0>S?S=0:S>255&&(S=255)),C[R]=~~B,C[R+1]=~~P,C[R+2]=~~S,C[R+3]=e[R+3],R+=4,I++,I>=n&&(I=0,U+=n)}e=C}return C}function d(e,n,i,r,a,s,h,o){var u,c,f,l,p,d,g,_,A,w,L,E,C,M,b,x,R,D,N,I,U=matRadiusY=3,H=matHalfSideY=1,F=9,k=n,T=new t.Array16I(18),G=new t.Array8U(9),B=n*i,P=e.length,S=new m(P),O=n-1,Y=B-n,W=s,X=h;for(g=0,_=0,A=0,w=0,L=0;F>_;)G[_]=A+w,T[g]=A-H,T[g+1]=L-k,g+=2,_++,A++,A>=U&&(A=0,w+=U,L+=n);if(a)for(d=0,A=0,w=0;P>d;)b=0,x=0,R=0,D=0,N=0,I=0,E=A+T[0],C=w+T[1],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[0]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[0]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[2],C=w+T[3],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[1]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[1]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[4],C=w+T[5],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[2]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[2]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[6],C=w+T[7],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[3]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[3]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[8],C=w+T[9],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[4]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[4]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[10],C=w+T[11],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[5]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[5]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[12],C=w+T[13],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[6]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[6]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[14],C=w+T[15],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[7]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[7]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[16],C=w+T[17],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[8]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[8]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),o?(f=v(b)+v(D),l=v(x)+v(N),p=v(R)+v(I)):(f=W*b+X*D,l=W*x+X*N,p=W*R+X*I),y&&(0>f?f=0:f>255&&(f=255),0>l?l=0:l>255&&(l=255),0>p?p=0:p>255&&(p=255)),S[d]=~~f,S[d+1]=~~l,S[d+2]=~~p,S[d+3]=e[d+3],d+=4,A++,A>=n&&(A=0,w+=n);else for(d=0,A=0,w=0;P>d;)b=0,x=0,R=0,E=A+T[0],C=w+T[1],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[0]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[2],C=w+T[3],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[1]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[4],C=w+T[5],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[2]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[6],C=w+T[7],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[3]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[8],C=w+T[9],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[4]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[10],C=w+T[11],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[5]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[12],C=w+T[13],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[6]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[14],C=w+T[15],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[7]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[16],C=w+T[17],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[8]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),f=s*b+h,l=s*x+h,p=s*R+h,y&&(0>f?f=0:f>255&&(f=255),0>l?l=0:l>255&&(l=255),0>p?p=0:p>255&&(p=255)),S[d]=~~f,S[d+1]=~~l,S[d+2]=~~p,S[d+3]=e[d+3],d+=4,A++,A>=n&&(A=0,w+=n);return S}function g(e,n,i,r,a,s,h,o){var u,c,f,l,p,d,g,_,A,w,L,E,C,M,b,x,R,D,N,I,U=matRadiusY=5,H=matHalfSideY=2,F=25,k=n,T=new t.Array16I(50),G=new t.Array8U(25),B=n*i,P=e.length,S=new m(P),O=n-1,Y=B-n,W=s,X=h;for(g=0,_=0,A=0,w=0,L=0;F>_;)G[_]=A+w,T[g]=A-H,T[g+1]=L-k,g+=2,_++,A++,A>=U&&(A=0,w+=U,L+=n);if(a)for(d=0,A=0,w=0;P>d;)b=0,x=0,R=0,D=0,N=0,I=0,E=A+T[0],C=w+T[1],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[0]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[0]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[2],C=w+T[3],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[1]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[1]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[4],C=w+T[5],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[2]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[2]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[6],C=w+T[7],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[3]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[3]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[8],C=w+T[9],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[4]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[4]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[10],C=w+T[11],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[5]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[5]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[12],C=w+T[13],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[6]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[6]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[14],C=w+T[15],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[7]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[7]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[16],C=w+T[17],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[8]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[8]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[18],C=w+T[19],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[9]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[9]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[20],C=w+T[21],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[10]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[10]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[22],C=w+T[23],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[11]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[11]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[24],C=w+T[25],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[12]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[12]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[26],C=w+T[27],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[13]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[13]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[28],C=w+T[29],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[14]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[14]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[30],C=w+T[31],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[15]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[15]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[32],C=w+T[33],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[16]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[16]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[34],C=w+T[35],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[17]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[17]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[36],C=w+T[27],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[18]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[18]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[38],C=w+T[39],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[19]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[19]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[40],C=w+T[41],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[20]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[20]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[42],C=w+T[43],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[21]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[21]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[44],C=w+T[45],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[22]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[22]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[46],C=w+T[47],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[23]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[23]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),E=A+T[48],C=w+T[49],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[24]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u,c=a[G[24]],D+=e[M]*c,N+=e[M+1]*c,I+=e[M+2]*c),o?(f=v(b)+v(D),l=v(x)+v(N),p=v(R)+v(I)):(f=W*b+X*D,l=W*x+X*N,p=W*R+X*I),y&&(0>f?f=0:f>255&&(f=255),0>l?l=0:l>255&&(l=255),0>p?p=0:p>255&&(p=255)),S[d]=~~f,S[d+1]=~~l,S[d+2]=~~p,S[d+3]=e[d+3],d+=4,A++,A>=n&&(A=0,w+=n);else for(d=0,A=0,w=0;P>d;)b=0,x=0,R=0,E=A+T[0],C=w+T[1],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[0]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[2],C=w+T[3],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[1]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[4],C=w+T[5],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[2]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[6],C=w+T[7],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[3]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[8],C=w+T[9],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[4]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[10],C=w+T[11],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[5]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[12],C=w+T[13],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[6]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[14],C=w+T[15],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[7]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[16],C=w+T[17],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[8]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[18],C=w+T[19],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[9]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[20],C=w+T[21],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[10]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[22],C=w+T[23],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[11]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[24],C=w+T[25],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[12]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[26],C=w+T[27],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[13]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[28],C=w+T[29],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[14]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[30],C=w+T[31],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[15]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[32],C=w+T[33],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[16]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[34],C=w+T[35],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[17]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[36],C=w+T[27],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[18]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[38],C=w+T[39],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[19]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[40],C=w+T[41],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[20]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[42],C=w+T[43],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[21]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[44],C=w+T[45],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[22]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[46],C=w+T[47],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[23]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),E=A+T[48],C=w+T[49],E>=0&&O>=E&&C>=0&&Y>=C&&(M=E+C<<2,u=r[G[24]],b+=e[M]*u,x+=e[M+1]*u,R+=e[M+2]*u),f=s*b+h,l=s*x+h,p=s*R+h,y&&(0>f?f=0:f>255&&(f=255),0>l?l=0:l>255&&(l=255),0>p?p=0:p>255&&(p=255)),S[d]=~~f,S[d+1]=~~l,S[d+2]=~~p,S[d+3]=e[d+3],d+=4,A++,A>=n&&(A=0,w+=n);return S}var m=t.ImArray,_=t.Array32F,y=t._notSupportTypedArrays,A=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],w=(t.CONSTANTS.SQRT2,t.CONSTANTS.toRad),v=(t.CONSTANTS.toDeg,Math.abs),L=Math.sqrt,E=Math.sin,C=Math.cos,M=t.ConvolutionMatrixFilter=function(e,n,i){this._coeff=new _([1,0]),"undefined"!=typeof e&&e.length?this.set(e,~~(L(e.length)+.5),n||1,i||0):(this._matrix=null,this._dim=0),this._matrix2=null,this._dim2=this._dim,this._isGrad=!1,this._doFast=0,this._doSeparable=!1,t.useWebGL&&(this._webglInstance=t.WebGLConvolutionMatrixFilterInstance)};M.prototype={constructor:M,_dim:0,_dim2:0,_matrix:null,_matrix2:null,_coeff:null,_webglInstance:null,lowPass:function(t){return t="undefined"==typeof t?3:t%2?t:t+1,this.set(u(t),t,1/(t*t),0),this._doFast=1,this},highPass:function(t,e){t="undefined"==typeof t?3:t%2?t:t+1,e="undefined"==typeof e?1:e;var n=t*t,i=-e/n,r=u(t,i,1+i);return this.set(r,t,1,0),this._doFast=1,this},glow:function(t,e){return t="undefined"==typeof t?.5:t,this.highPass(e,-t)},sharpen:function(t,e){return t="undefined"==typeof t?.5:t,this.highPass(e,t)},verticalBlur:function(t){return t="undefined"==typeof t?3:t%2?t:t+1,this.set(i(t),1,1/t,0),this._dim2=t,this._doFast=1,this},horizontalBlur:function(t){return t="undefined"==typeof t?3:t%2?t:t+1,this.set(i(t),t,1/t,0),this._dim2=1,this._doFast=1,this},directionalBlur:function(t,e){e="undefined"==typeof e?3:e%2?e:e+1,t*=w;var n=C(t),i=-E(t),r=f(e,n,i,1/e);return this.set(r,e,1,0)},fastGauss:function(t,e){return e="undefined"==typeof e?3:e%2?e:e+1,t=t||1,t=~~t,1>t?t=1:t>3&&(t=3),this.set(u(e),e,1/(e*e),0),this._doFast=t,this},binomialLowPass:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=r(t),n=1<<t-1,i=1/n;return this.set(e,t,i,i),this._matrix2=new _(e),this._doSeparable=!0,this},binomialHighPass:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var n=s(t);return this.set(e(u(t),new _(n.kernel),1,-1/n.sum),t,1,0)},prewittX:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=o(t,0);return this.set(e.kernel,t,1,0)},prewittY:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=o(t,1);return this.set(e.kernel,t,1,0)},prewittDirectional:function(t,n){n="undefined"==typeof n?3:n%2?n:n+1,t*=w;var i=C(t),r=E(t),a=o(n,0),s=o(n,1);return this.set(e(new _(a.kernel),new _(s.kernel),i,r),n,1,0)},prewitt:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=o(t,0),n=o(t,1);return this.set(e.kernel,t,1,0),this._isGrad=!0,this._matrix2=new _(n.kernel),this},sobelX:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=h(t,0);return this.set(e.kernel,t,1,0)},sobelY:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=h(t,1);return this.set(e.kernel,t,1,0)},sobelDirectional:function(t,n){n="undefined"==typeof n?3:n%2?n:n+1,t*=w;var i=C(t),r=E(t),a=h(n,0),s=h(n,1);return this.set(e(new _(a.kernel),new _(s.kernel),i,r),n,1,0)},sobel:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=h(t,0),n=h(t,1);return this.set(e.kernel,t,1,0),this._matrix2=new _(n.kernel),this._isGrad=!0,this},laplace:function(t){t="undefined"==typeof t?3:t%2?t:t+1;var e=t*t,n=u(t,-1,e-1);return this.set(n,t,1,0),this._doFast=1,this},emboss:function(t,e,n){n="undefined"==typeof n?3:n%2?n:n+1,t="undefined"==typeof t?-.25*Math.PI:t*w,e=e||1;var i=e*C(t),r=-e*E(t),a=c(n,i,r,1);return this.set(a,n,1,0)},edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,n,i){return this._matrix2=null,this._isGrad=!1,this._doFast=0,this._doSeparable=!1,this._matrix=new _(t),this._dim2=this._dim=e,this._coeff[0]=n||1,this._coeff[1]=i||0,this},combineWith:function(){return this},getMatrix:function(){return this._matrix},setMatrix:function(t,e){return this._matrix=t,this._dim2=this._dim=e,this._matrix2=null,this._coeff[0]=1,this._coeff[1]=0,this._isGrad=!1,this._doFast=0,this._doSeparable=!1,this},_apply:function(e,n,i){if(!this._matrix)return e;if(this._doFast)return this._matrix2?l(e,n,i,this._matrix,this._matrix2,this._dim,this._dim2,this._coeff[0],this._coeff[1],this._doFast):l(e,n,i,this._matrix,null,this._dim,this._dim2,this._coeff[0],this._coeff[1],this._doFast);if(this._doSeparable)return p(e,n,i,this._matrix,this._matrix2,this._dim,this._dim2,this._coeff[0],this._coeff[1]);if(3==this._dim)return this._matrix2?d(e,n,i,this._matrix,this._matrix2,this._coeff[0],this._coeff[1],this._isGrad):d(e,n,i,this._matrix,null,this._coeff[0],this._coeff[1],!1);if(5==this._dim)return this._matrix2?g(e,n,i,this._matrix,this._matrix2,this._coeff[0],this._coeff[1],this._isGrad):g(e,n,i,this._matrix,null,this._coeff[0],this._coeff[1],!1);var r,a,s,h,o,u,c,f,_,A,w,L,E,C,M,b,x,R,D,N,I=this._dim,U=this._dim,H=I>>1,F=U>>1,k=I*U,T=F*n,G=this._matrix,B=this._matrix2,P=this._isGrad,S=new t.Array16I(k<<1),O=new t.Array8U(k),Y=n*i,W=e.length,X=new m(W),q=n-1,z=Y-n,V=this._coeff[0],Q=this._coeff[1];for(c=0,f=0,_=0,A=0,w=0;k>f;)O[f]=_+A,S[c]=_-H,S[c+1]=w-T,c+=2,f++,_++,_>=I&&(_=0,A+=I,w+=n);if(B)for(u=0,_=0,A=0;W>u;){for(M=0,b=0,x=0,R=0,D=0,N=0,c=0,f=0;k>f;)L=_+S[c],E=A+S[c+1],L>=0&&q>=L&&E>=0&&z>=E&&(C=L+E<<2,r=G[O[f]],M+=e[C]*r,b+=e[C+1]*r,x+=e[C+2]*r,a=B[O[f]],R+=e[C]*a,D+=e[C+1]*a,N+=e[C+2]*a),c+=2,f++;P?(s=v(M)+v(R),h=v(b)+v(D),o=v(x)+v(N)):(s=V*M+Q*R,h=V*b+Q*D,o=V*x+Q*N),y&&(0>s?s=0:s>255&&(s=255),0>h?h=0:h>255&&(h=255),0>o?o=0:o>255&&(o=255)),X[u]=~~s,X[u+1]=~~h,X[u+2]=~~o,X[u+3]=e[u+3],u+=4,_++,_>=n&&(_=0,A+=n)}else for(u=0,_=0,A=0;W>u;){for(M=0,b=0,x=0,c=0,f=0;k>f;)L=_+S[c],E=A+S[c+1],L>=0&&q>=L&&E>=0&&z>=E&&(C=L+E<<2,r=G[O[f]],M+=e[C]*r,b+=e[C+1]*r,x+=e[C+2]*r),c+=2,f++;s=V*M+Q,h=V*b+Q,o=V*x+Q,y&&(0>s?s=0:s>255&&(s=255),0>h?h=0:h>255&&(h=255),0>o?o=0:o>255&&(o=255)),X[u]=~~s,X[u+1]=~~h,X[u+2]=~~o,X[u+3]=e[u+3],u+=4,_++,_>=n&&(_=0,A+=n)}return X},apply:function(t){return this._matrix?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},reset:function(){return this._matrix=null,this._matrix2=null,this._dim=0,this}},M.prototype.boxBlur=M.prototype.lowPass,M.prototype.gaussBlur=M.prototype.binomialLowPass,M.prototype.gradX=M.prototype.prewittX,M.prototype.gradY=M.prototype.prewittY,M.prototype.gradDirectional=M.prototype.prewittDirectional,M.prototype.grad=M.prototype.prewitt}(FILTER),function(t){function e(t){var e,n=t*t,r=new i(n);for(e=0;n>e;e++)r[e]=1;return r}var n=t.ImArray,i=t.Array8U,r=(Math.min,Math.max,Math.sqrt),a=function(e,i,r){var a,s,h,o,u,c,f,l,p,d,g,m,_,y,A,w=this._dim,v=w>>1,L=w*w,E=v*i,C=this.structureElement,M=i*r,b=e.length,x=new n(b),R=i-1,D=M-i;for(a=[],o=0,u=0,k=0;L>k;)C[k]&&(a.push(o-v),a.push(u-E)),k++,o++,o>=w&&(o=0,u+=i);for(a=new t.Array32I(a),A=a.length,s=0,o=0,u=0;b>s;){for(m=0,_=0,y=0,h=0;A>h;)c=o+a[h],f=u+a[h+1],c>=0&&R>=c&&f>=0&&D>=f&&(l=c+f<<2,p=e[l],d=e[l+1],g=e[l+2],p>m&&(m=p),d>_&&(_=d),g>y&&(y=g)),h+=2;x[s]=m,x[s+1]=_,x[s+2]=y,x[s+3]=e[s+3],s+=4,o++,o>=i&&(o=0,u+=i)}return x},s=function(e,i,r){var a,s,h,o,u,c,f,l,p,d,g,m,_,y,A,w=this._dim,v=w>>1,L=w*w,E=v*i,C=this.structureElement,M=i*r,b=e.length,x=new n(b),R=i-1,D=M-i;for(a=[],o=0,u=0,k=0;L>k;)C[k]&&(a.push(o-v),a.push(u-E)),k++,o++,o>=w&&(o=0,u+=i);for(a=new t.Array32I(a),A=a.length,s=0,o=0,u=0;b>s;){for(m=255,_=255,y=255,h=0;A>h;)c=o+a[h],f=u+a[h+1],c>=0&&R>=c&&f>=0&&D>=f&&(l=c+f<<2,p=e[l],d=e[l+1],g=e[l+2],m>p&&(m=p),_>d&&(_=d),y>g&&(y=g)),h+=2;x[s]=m,x[s+1]=_,x[s+2]=y,x[s+3]=e[s+3],s+=4,o++,o>=i&&(o=0,u+=i)}return x},h=function(t){return t},o=e(3),u=t.MorphologicalFilter=function(){this._dim=0,this.structureElement=null,this._apply=h};u.prototype={constructor:u,_dim:0,structureElement:null,erode:function(t){return this.set(t),this._apply=s,this},dilate:function(t){return this.set(t),this._apply=a,this},_apply:function(t){return t},apply:function(t){return this._dim?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},set:function(t){return t&&t.length?(this.structureElement=new i(t),this._dim=~~(r(this.structureElement.length)+.5)):t&&t===t-0?(this.structureElement=e(t),this._dim=t):(this.structureElement=o,this._dim=3),this},reset:function(){return this._apply=h,this._dim=0,this.structureElement=null,this}}}(FILTER),function(t){var e=t.ImArray;Math.min,Math.max;var n=function(n,i,r){var a,s,h,o,u,c,f,l,p,d,g,m,_,y,A,w=this._dim,v=w>>1,L=w*w,E=v*i,C=new t.Array32I(L<<1),M=i*r,b=n.length,x=new e(b),R=[],D=[],N=[],I=L<<1,U=i-1,H=M-i;for(s=0,h=0,o=0;I>s;)C[s]=h-v,C[s+1]=o-E,s+=2,h++,h>=w&&(h=0,o+=i);for(a=0,h=0,o=0;b>a;){for(R.length=0,D.length=0,N.length=0,s=0;I>s;)u=h+C[s],c=o+C[s+1],u>=0&&U>=u&&c>=0&&H>=c&&(f=u+c<<2,l=n[f],p=n[f+1],d=n[f+2],R.push(l),D.push(p),N.push(d)),s+=2;R.sort(),D.sort(),N.sort(),y=R.length,A=y>>1,g=y%2?R[A+1]:~~(.5*(R[A]+R[A+1])),y=D.length,A=y>>1,m=y%2?D[A+1]:~~(.5*(D[A]+D[A+1])),y=N.length,A=y>>1,_=y%2?N[A+1]:~~(.5*(N[A]+N[A+1])),x[a]=g,x[a+1]=m,x[a+2]=_,x[a+3]=n[a+3],a+=4,h++,h>=i&&(h=0,o+=i)}return x},i=function(n,i,r){var a,s,h,o,u,c,f,l,p,d,g,m,_,y=this._dim,A=y>>1,w=y*y,v=A*i,L=new t.Array32I(w<<1),E=i*r,C=n.length,M=new e(C),b=w<<1,x=i-1,R=E-i;for(h=0,o=0,s=0;b>s;)L[s]=h-A,L[s+1]=o-v,s+=2,h++,h>=y&&(h=0,o+=i);for(a=0,h=0,o=0;C>a;){for(g=0,m=0,_=0,s=0;b>s;)u=h+L[s],c=o+L[s+1],u>=0&&x>=u&&c>=0&&R>=c&&(f=u+c<<2,l=n[f],p=n[f+1],d=n[f+2],l>g&&(g=l),p>m&&(m=p),d>_&&(_=d)),s+=2;M[a]=g,M[a+1]=m,M[a+2]=_,M[a+3]=n[a+3],a+=4,h++,h>=i&&(h=0,o+=i)}return M},r=function(n,i,r){var a,s,h,o,u,c,f,l,p,d,g,m,_,y=this._dim,A=y>>1,w=y*y,v=A*i,L=new t.Array32I(w<<1),E=i*r,C=n.length,M=new e(C),b=w<<1,x=i-1,R=E-i;for(h=0,o=0,s=0;b>s;)L[s]=h-A,L[s+1]=o-v,s+=2,h++,h>=y&&(h=0,o+=i);for(a=0,h=0,o=0;C>a;){for(g=255,m=255,_=255,s=0;b>s;)u=h+L[s],c=o+L[s+1],u>=0&&x>=u&&c>=0&&R>=c&&(f=u+c<<2,l=n[f],p=n[f+1],d=n[f+2],g>l&&(g=l),m>p&&(m=p),_>d&&(_=d)),s+=2;M[a]=g,M[a+1]=m,M[a+2]=_,M[a+3]=n[a+3],a+=4,h++,h>=i&&(h=0,o+=i)}return M},a=function(t){return t},s=t.StatisticalFilter=function(){this._dim=0,this._apply=a};s.prototype={constructor:s,_dim:0,median:function(t){return t="undefined"==typeof t?3:t%2?t:t+1,this._dim=t,this._apply=n,this},minimum:function(t){return t="undefined"==typeof t?3:t,this._dim=t,this._apply=r,this},maximum:function(t){return t="undefined"==typeof t?3:t,this._dim=t,this._apply=i,this},_apply:function(t){return t},apply:function(t){return this._dim?t.setData(this._apply(t.getData(),t.width,t.height,t)):t},reset:function(){return this._apply=a,this._dim=0,this}},s.prototype.erode=s.prototype.minimum,s.prototype.dilate=s.prototype.maximum}(FILTER),function(t){var e=t._notSupportTypedArrays,n=Math.random;t.NoiseFilter=t.Create({min:-127,max:127,init:function(t,e){this.min=t||-127,this.max=e||127},apply:function(t){var i,r,a,s,h,o,u,c,f=this.max-this.min,l=this.min,p=t.length;for(i=0;p>i;)a=t[i],s=t[i+1],h=t[i+2],r=f*n()+l,o=a+r,u=s+r,c=h+r,e&&(0>o?o=0:o>255&&(o=255),0>u?u=0:u>255&&(u=255),0>c?c=0:c>255&&(c=255)),t[i]=~~o,t[i+1]=~~u,t[i+2]=~~c,i+=4;return t}})}(FILTER),function(t){var e=t._notSupportTypedArrays,n=t.Array32F,i=t.Color.RGB2YCbCr,r=t.Color.YCbCr2RGB;t.HistogramEqualizeFilter=t.Create({apply:function(t){var a,s,h,o,u,c,f,l,p,d,g,m=0,_=255,y=new n(256),A=new n(256),w=0,v=t.length,L=v>>2,E=1/L,C=new Array(L);for(l=0;256>l;)y[l]=0,A[l]=0,l++;for(l=0,p=0;v>l;)a=t[l],s=t[l+1],h=t[l+2],d=i({r:a,g:s,b:h}),y[d.y]+=E,d.y>m&&(m=d.y),d.y<_&&(_=d.y),C[p]=d,l+=4,p++;for(w=0,l=0;256>l;)w+=y[l],A[l]=w,l++;for(y=null,o=m-_,l=0,p=0;v>l;)d=C[p],d.y=A[d.y]*o+_,g=r(d),u=g.r,c=g.g,f=g.b,e&&(0>u?u=0:u>255&&(u=255),0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255)),t[l]=~~u,t[l+1]=~~c,t[l+2]=~~f,l+=4,p++;return t}})}(FILTER),function(t){var e=t._notSupportTypedArrays,n=t.Array32F;t.RGBHistogramEqualizeFilter=t.Create({apply:function(t){var i,r,a,s,h,o,u,c,f,l,p,d,g,m=0,_=0,y=0,A=255,w=255,v=255,L=new n(256),E=new n(256),C=new n(256),M=new n(256),b=new n(256),x=new n(256),R=t.length,D=R>>2,N=1/D;for(g=0;256>g;)L[g]=0,E[g]=0,C[g]=0,M[g]=0,b[g]=0,x[g]=0,g++;for(g=0;R>g;)i=t[g],r=t[g+1],a=t[g+2],L[i]+=N,E[r]+=N,C[a]+=N,i>m&&(m=i),A>i&&(A=i),r>_&&(_=r),w>r&&(w=r),a>y&&(y=a),v>a&&(v=a),g+=4;for(u=c=f=0,g=0;256>g;)u+=L[g],M[g]=u,c+=E[g],b[g]=c,f+=C[g],x[g]=f,g++;for(L=null,E=null,C=null,s=m-A,h=_-w,o=y-v,g=0;R>g;)i=t[g],r=t[g+1],a=t[g+2],l=M[i]*s+A,p=b[r]*h+w,d=x[a]*o+v,e&&(0>l?l=0:l>255&&(l=255),0>p?p=0:p>255&&(p=255),0>d?d=0:d>255&&(d=255)),t[g]=~~l,t[g+1]=~~p,t[g+2]=~~d,g+=4;return t}})}(FILTER),function(t){var e=Math.sqrt,n=t._notSupportTypedArrays,i=t.Array32F;t.PixelateFilter=t.Create({scale:1,init:function(t){this.scale=t||1},apply:function(t,r,a){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var s,h,o,u,c,f,l,p,d,g,m,_,y,A,w,v,L,E,C,M,b,x,R,D,N,I,U,H,F,k=t.length,T=r*a,G=~~(.01*e(T)*this.scale),B=G*G,P=1/B,S=G<<2,O=r*G,Y=B<<2,W=new i(3*T),X=G,q=G,z=(r<<1)+r;for(u=X-1,c=(q-1)*r,C=0,b=r-1,M=0,x=T-r,f=0,l=0,d=0,s=h=o=0;r>d;)s+=t[f],h+=t[f+1],o+=t[f+2],W[l]=s,W[l+1]=h,W[l+2]=o,f+=4,l+=3,d++;for(f=z+r,l=z,d=0,s=h=o=0;k>f;)s+=t[f],h+=t[f+1],o+=t[f+2],W[l]=W[l-z]+s,W[l+1]=W[l-z+1]+h,W[l+2]=W[l-z+2]+o,f+=4,l+=3,d++,d>=r&&(d=0,s=h=o=0);for(f=0,d=0,g=0;k>f;){for(w=d,v=g,L=d+u,E=g+c,L>b&&(L=b),E>x&&(E=x),R=w+v,I=L+E,D=L+v,N=w+E,R=(R<<1)+R,D=(D<<1)+D,N=(N<<1)+N,I=(I<<1)+I,U=P*(W[I]-W[D]-W[N]+W[R]),H=P*(W[I+1]-W[D+1]-W[N+1]+W[R+1]),F=P*(W[I+2]-W[D+2]-W[N+2]+W[R+2]),n&&(0>U?U=0:U>255&&(U=255),0>H?H=0:H>255&&(H=255),0>F?F=0:F>255&&(F=255)),U=~~U,H=~~H,F=~~F,l=f,m=d,_=g,A=d+G,p=f+Y,p>k&&(p=k);p>l;)y=m+_<<2,t[y]=U,t[y+1]=H,t[y+2]=F,l+=4,m++,(m>=r||m>=A)&&(m=d,_+=r);f+=S,d+=G,d>=r&&(d=0,g+=O)}return t}})}(FILTER),function(t){var e=t._notSupportTypedArrays,n=t.Color.RGB2HSV,i=.7083333333333334;t.HSVConverterFilter=t.Create({apply:function(t,r,a){var s,h,o,u,c,a,f,l,p,d,g,m=t.length;for(u=0;m>u;)s=t[u],h=t[u+1],o=t[u+2],c=n({r:s,g:h,b:o}),a=c.h*i,f=255*c.s,l=c.v,p=a,d=l,g=f,e&&(0>p?p=0:p>255&&(p=255),0>d?d=0:d>255&&(d=255),0>g?g=0:g>255&&(g=255)),t[u]=~~p,t[u+1]=~~d,t[u+2]=~~g,u+=4;return t}})}(FILTER),function(t){var e=t._notSupportTypedArrays,n=t.ImArray,i=t.Color.RGB2HSV,r=(t.Color.HSV2RGB,t.Color.Color2RGBA);t.HueExtractorFilter=t.Create({range:null,background:0,init:function(t,e){this.range=t,this.background=e||0},apply:function(t){if(!this.range||!this.range.length)return t;var a,s,h,o,u,c,f,l,p,d,g,m=t.length,_=this.range[0],y=this.range[this.range.length-1];for(o=new n(m),d=r(this.background||0),p=0;m>p;)a=t[p],s=t[p+1],h=t[p+2],g=i({r:a,g:s,b:h}).h,g>=_&&y>=g?(u=t[p],c=t[p+1],f=t[p+2],l=t[p+3]):(u=d.r,c=d.g,f=d.b,l=d.a),e&&(0>u?u=0:u>255&&(u=255),0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),0>l?l=0:l>255&&(l=255)),o[p]=~~u,o[p+1]=~~c,o[p+2]=~~f,o[p+3]=~~l,p+=4;return o}})}(FILTER),function(t){var e=(t._notSupportTypedArrays,Math.min);t.AlphaMaskFilter=t.Create({alphaMask:null,centerX:0,centerY:0,init:function(t,e,n){this.alphaMask=t||null,this.centerX=e||0,this.centerY=n||0},apply:function(t,n,i){if(!this.alphaMask)return t;var r,a,s,h,o,u,c,f,l=this.alphaMask.getData(),p=t.length,d=(l.length,this.alphaMask.width),g=this.alphaMask.height,m=e(n,d),_=e(i,g),y=n-d>>1,A=i-g>>1;for(c=this.centerX+y,f=this.centerY+A,r=0,a=0,s=0;p>r;)o=a-c,u=s-f,o>=0&&m>o&&u>=0&&_>u?(h=o+u*d<<2,t[r+3]=l[h+3]):t[r+3]=0,r+=4,a++,a>=n&&(a=0,s++);return t}})}(FILTER),function(t){var e=t._notSupportTypedArrays,n=t.Color.RGBA2Color,i=t.Color.Color2RGBA;t.ThresholdFilter=t.Create({thresholds:null,quantizedColors:null,init:function(t,e){this.thresholds=t,this.quantizedColors=e||null},apply:function(t){if(!this.thresholds||!this.thresholds.length)return t;if(!this.quantizedColors||!this.quantizedColors.length)return t;var r,a,s,h,o,u,c,f,l=t.length,p=this.thresholds,d=p.length,g=this.quantizedColors,m=g.length;for(c=0;l>c;){for(o=n({r:t[c],g:t[c+1],b:t[c+2],a:t[c+3]}),f=0;d>f&&o>p[f];)f++;o=m>f?g[f]:255,u=i(o),r=u.r,a=u.g,s=u.b,h=u.a,e&&(0>r?r=0:r>255&&(r=255),0>a?a=0:a>255&&(a=255),0>s?s=0:s>255&&(s=255),0>h?h=0:h>255&&(h=255)),t[c]=~~r,t[c+1]=~~a,t[c+2]=~~s,t[c+3]=~~h,c+=4}return t}})}(FILTER),function(t){var e=t.Color.RGB2YCbCr;t.YCbCrConverterFilter=t.Create({apply:function(t){var n,i,r,a,s,h=t.length;for(a=0;h>a;)n=t[a],i=t[a+1],r=t[a+2],s=e({r:n,g:i,b:r}),t[a]=s.cr,t[a+1]=s.y,t[a+2]=s.cb,a+=4;return t}})}(FILTER),function(t){var e=(Math.sqrt,Math.exp,Math.log),n=Math.abs,i=t._notSupportTypedArrays,r=t.ImArray,a=t.Array32F;t.BokehFilter=t.Create({centerX:0,centerY:0,radius:10,amount:10,init:function(t,e,n,i){this.centerX=t||0,this.centerY=e||0,this.radius=n||10,this.amount=i||10},apply:function(t,s,h){var o,u,c,f,l,p,d,g,m,_,y,A,w,v,L,E,C,M,b,x,R,D,N,I,U,H,F,k,T,G,B,P,S,O,Y=t.length,W=this.centerX,X=this.centerY,q=this.radius,z=this.amount;if(0>=z)return t;for(w=new r(t),o=s*h,B=0,P=s-1,S=0,O=o-s,c=(o<<1)+o,d=(s<<1)+s,u=new a(c),g=0,m=0,_=0,f=l=p=0;s>_;)f+=t[g],l+=t[g+1],p+=t[g+2],u[m]=f,u[m+1]=l,u[m+2]=p,g+=4,m+=3,_++;for(g=d+s,m=d,_=0,f=l=p=0;Y>g;)f+=t[g],l+=t[g+1],p+=t[g+2],u[m]=u[m-d]+f,u[m+1]=u[m-d+1]+l,u[m+2]=u[m-d+2]+p,g+=4,m+=3,_++,_>=s&&(_=0,f=l=p=0);for(g=0,_=0,y=0,A=0;Y>g;)L=_-W,E=y-X,v=n(L)+n(E),C=v>q?~~e((v-q)*z):~~(v/q+.5),C>0&&(M=C*s,b=.25/(C*C),x=_-C,R=A-M,D=_+C,N=A+M,B>x?x=B:D>P&&(D=P),S>R?R=S:N>O&&(N=O),I=x+R,F=D+N,U=D+R,H=x+N,I=(I<<1)+I,U=(U<<1)+U,H=(H<<1)+H,F=(F<<1)+F,k=b*(u[F]-u[U]-u[H]+u[I]),T=b*(u[F+1]-u[U+1]-u[H+1]+u[I+1]),G=b*(u[F+2]-u[U+2]-u[H+2]+u[I+2]),i&&(0>k?k=0:k>255&&(k=255),0>T?T=0:T>255&&(T=255),0>G?G=0:G>255&&(G=255)),w[g]=~~k,w[g+1]=~~T,w[g+2]=~~G),g+=4,_++,_>=s&&(_=0,y++,A+=s);
return w}})}(FILTER);