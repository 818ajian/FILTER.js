/**
*
*   FILTER.js MachineLearning Routines
*   @version: 0.9.6
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Machine Learning Routines)
*   https://github.com/foo123/FILTER.js
*
**/!function(r,f){"use strict";"object"==typeof module&&module.exports?module.exports=f.call(r,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_ML")?define("FILTER_ML",["module","FILTER"],function(e,o){return f.moduleUri=e.uri,f.call(r,o),o}):(f.call(r,r.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return r.FILTER})}(this,function(r){return!function(r,f){"use strict";function e(r,f){for(;f[r][1]!==r;)f[r][1]=f[f[r][1]][1],r=f[r][1];return r}function o(r,f,o){var n=e(r,o),i=e(f,o);n!==i&&(o[n][1]=i)}function n(r,f,e){var o=e.next;return o+1>e.length&&Array.prototype.push.apply(e,new Array(d)),e[o]=[o,o,0],++e.next,o}function i(r,f,i,t,u,c,s,h,y){var p,m,w,L,M,v,A,g,b,x,k,F=f.length,E=F>>>r,I=8===c,R=I?-1:0,T=null,_=null!=y;for(A=new Array(d),A.next=0,g=new a(E),T=_?n(0,0,A):null,g[0]=_&&l(i[0]-y)>h?T:n(0,0,A),w=1;t>w;w++)g[w]=_&&l(i[w]-y)>h?T:l(i[w]-i[w-1])<=h?g[w-1]:n(w,0,A);for(L=1,v=t;u>L;L++,v+=t)for(g[v]=_&&l(i[v]-y)>h?T:l(i[v]-i[v-t])<=h?g[v-t]:n(0,L,A),w=1;t>w;w++)if(_&&l(i[v+w]-y)>h)g[v+w]=T;else{for(m=T===g[v+w-1]?-1:l(i[v+w]-i[v+w-1])<=h?g[v+w-1]:-1,M=R;1>M;M++)T!==g[v-t+w+M]&&l(i[v+w]-i[v-t+w+M])<=h&&(m>=0?o(m,g[v-t+w+M],A):m=g[v-t+w+M]);g[v+w]=m>=0?m:n(w,L,A),I&&T!==g[v+w-1]&&T!==g[v-t+w]&&l(i[v+w-1]-i[v-t+w])<=h&&o(g[v+w-1],g[v-t+w],A)}if(0===T)for(p=0,b=A.next,x=0;b>p;p++)p===A[p][1]&&(A[p][2]=0===A[p][1]?0:++x);else for(p=0,b=A.next,x=0;b>p;p++)p===A[p][1]&&(A[p][2]=x++);if(x=x>0?x:1,s)if(r)for(w=0,p=0;F>p;p+=4,w++)k=A[e(g[w],A)][2],k=255-255*k/x|0,f[p]=f[p+1]=f[p+2]=k;else for(w=0;F>w;w++)k=A[e(g[w],A)][2],k=255-255*k/x|0,f[w]=k;else if(r)for(w=0,p=0;F>p;p+=4,w++)k=A[e(g[w],A)][2],k=255*k/x|0,f[p]=f[p+1]=f[p+2]=k;else for(w=0;F>w;w++)k=A[e(g[w],A)][2],k=255*k/x|0,f[w]=k;return f}function t(r,f,e,o,n,i,t,a,d,h){var y,p,m,w,L,M,v,A,g,b,x,k,F,E,I,R,T=t.length,_=T>>>2,q=a<<2,U=0,D=T-q,S=0,V=a-1<<2;for(y=r,p=f,m=r,w=f,R=new u(_),k=new Array(_),F=0,R[r+f>>>2]=255,f+q>=U&&D>=f+q&&(k[F++]=[f,r,r,q]),k[F++]=[f+q,r,r,-q];F>0;){for(E=k[--F],x=E[0]+(q=E[3]),g=E[1],b=E[2],p=c(p,x),w=s(w,x),y=c(y,g),m=s(m,b),A=g;A>=S&&(M=A+x,v=M>>>2,0===R[v]&&l(e-t[M])<=h&&l(o-t[M+1])<=h&&l(n-t[M+2])<=h);A-=4)R[v]=255,y=c(y,A);if(A>=g){for(M=A+x,v=M>>>2;b>=A&&(0!==R[v]||l(e-t[M])>h||l(o-t[M+1])>h||l(n-t[M+2])>h);)A+=4,M=A+x,v=M>>>2;L=A,I=b>=A}else L=A+4,g>L&&x-q>=U&&D>=x-q&&(k[F++]=[x,L,g-4,-q]),A=g+4,I=!0;for(;I;){for(M=A+x,v=M>>>2;V>=A&&0===R[v]&&l(e-t[M])<=h&&l(o-t[M+1])<=h&&l(n-t[M+2])<=h;)R[v]=255,m=s(m,A),A+=4,M=A+x,v=M>>>2;for(x+q>=U&&D>=x+q&&(k[F++]=[x,L,A-4,q]),A>b+4&&x-q>=U&&D>=x-q&&(k[F++]=[x,b+4,A-4,-q]),M=A+x,v=M>>>2;b>=A&&(0!==R[v]||l(e-t[M])>h||l(o-t[M+1])>h||l(n-t[M+2])>h);)A+=4,M=A+x,v=M>>>2;L=A,I=b>=A}}return i[0]=y,i[1]=p,i[2]=m,i[3]=w,R}var a=r.Array32U,u=r.Array8U,c=Math.min,s=Math.max,l=Math.abs,d=20;r.MachineLearning.connected_components=i,r.MachineLearning.connected_component=t}(r),!function(r,f){"use strict";var e=Math.abs;r.MachineLearning.kmeans=function(r,f,o,n,i,t){t=t||0;for(var a,u,c,s,l,d,h,y,p=f.length,m=new Array(p);;){for(h=0,u=0;p>u;u++){for(l=f[u],s=n(o[0],l),d=0,a=1;r>a;a++)c=n(o[a],l),s>c&&(s=c,d=a);m[u]=d,h+=s}for(a=0;r>a;a++)o[a]=null;for(u=0;p>u;u++)l=f[u],d=m[u],o[d]=i(o[d],l);for(y=0,u=0;p>u;u++)y+=n(o[m[u]],f[u]);if(e(y-h)<=t)break}return m},r.MachineLearning.kmedoids=function(r,f,o,n,i){i=i||0;for(var t,a,u,c,s,l,d,h,y,p,m,w,L=f.length,M=new Array(L);;){for(p=0,a=0;L>a;a++){for(l=f[a],s=n(o[0],l),y=0,t=1;r>t;t++)c=n(o[t],l),s>c&&(s=c,y=t);M[a]=y,p+=s}for(t=0,w=!1;r>t&&!w;){for(d=o[t],a=0;L>a;a++)if(h=f[a],h!==o[M[a]]){for(o[t]=h,m=0,u=0;L>u;u++)m+=n(o[M[u]],f[u]);if(e(m)+i<e(p)){w=!0;break}o[t]=d}t++}if(!w)break}return M}}(r),!function(r,f){"use strict";function e(r,f){var e=i(r),o=i(f);return e>o?(o/=e,e*t(1+o*o)):o>0?(e/=o,o*t(1+e*e)):0}function o(r,f){return f>=0?i(r):-i(r)}function n(r,f,n){if(n>f)throw"SVD: #rows must be >= #cols";var c,s,l,d,h,y,p,m,w,L,M,v,A,g,b,x,k,F,E,I,R=0,T=0,_=0;for(E=n>f?n:f,I=new u(E),c=new Array(E),h=0;E>h;h++)c[h]=0;for(l=new Array(n),h=0;n>h;h++)for(l[h]=new Array(n),p=0;n>p;p++)l[h][p]=0;for(s=new Array(f),h=0;f>h;h++)for(s[h]=new Array(f),p=0;f>p;p++)s[h][p]=n>p?r[h][p]:0;for(h=0;n>h;h++){if(L=h+1,I[h]=_*T,T=b=_=0,f>h){for(w=h;f>w;w++)_+=i(s[w][h]);if(_){for(w=h;f>w;w++)s[w][h]=s[w][h]/_,b+=s[w][h]*s[w][h];if(A=s[h][h],T=-o(t(b),A),g=A*T-b,s[h][h]=A-T,h+1!==n)for(p=L;n>p;p++){for(b=0,w=h;f>w;w++)b+=s[w][h]*s[w][p];for(A=b/g,w=h;f>w;w++)s[w][p]+=A*s[w][h]}for(w=h;f>w;w++)s[w][h]=s[w][h]*_}}if(c[h]=_*T,T=b=_=0,f>h&&h+1!==n){for(w=L;n>w;w++)_+=i(s[h][w]);if(_){for(w=L;n>w;w++)s[h][w]=s[h][w]/_,b+=s[h][w]*s[h][w];for(A=s[h][L],T=-o(t(b),A),g=A*T-b,s[h][L]=A-T,w=L;n>w;w++)I[w]=s[h][w]/g;if(h+1!==f)for(p=L;f>p;p++){for(b=0,w=L;n>w;w++)b+=s[p][w]*s[h][w];for(w=L;n>w;w++)s[p][w]+=b*I[w]}for(w=L;n>w;w++)s[h][w]=s[h][w]*_}}R=a(R,i(c[h])+i(I[h]))}for(h=n-1;h>=0;h--){if(n>h+1){if(T){for(p=L;n>p;p++)l[p][h]=s[h][p]/s[h][L]/T;for(p=L;n>p;p++){for(b=0,w=L;n>w;w++)b+=s[h][w]*l[w][p];for(w=L;n>w;w++)l[w][p]+=b*l[w][h]}}for(p=L;n>p;p++)l[h][p]=l[p][h]=0}l[h][h]=1,T=I[h],L=h}for(h=n-1;h>=0;h--){if(L=h+1,T=c[h],n>h+1)for(p=L;n>p;p++)s[h][p]=0;if(T){if(T=1/T,h+1!==n)for(p=L;n>p;p++){for(b=0,w=L;f>w;w++)b+=s[w][h]*s[w][p];for(A=b/s[h][h]*T,w=h;f>w;w++)s[w][p]+=A*s[w][h]}for(p=h;f>p;p++)s[p][h]=s[p][h]*T}else for(p=h;f>p;p++)s[p][h]=0;++s[h][h]}for(w=n-1;w>=0;w--)for(y=0;30>y;y++){for(d=1,L=w;L>=0;L--){if(M=L-1,i(I[L])+R===R){d=0;break}if(i(c[M])+R===R)break}if(d)for(v=0,b=1,h=L;w>=h;h++)if(A=b*I[h],i(A)+R!==R)for(T=c[h],g=e(A,T),c[h]=g,g=1/g,v=T*g,b=-A*g,p=0;f>p;p++)k=s[p][M],F=s[p][h],s[p][M]=k*v+F*b,s[p][h]=F*v-k*b;if(F=c[w],L===w){if(0>F)for(c[w]=-F,p=0;n>p;p++)l[p][w]=-l[p][w];break}if(y>=30)throw"SVD: No convergence after 30,000! iterations";for(x=c[L],M=w-1,k=c[M],T=I[M],g=I[w],A=((k-F)*(k+F)+(T-g)*(T+g))/(2*g*k),T=e(A,1),A=((x-F)*(x+F)+g*(k/(A+o(T,A))-g))/x,v=b=1,p=L;M>=p;p++){for(h=p+1,T=I[h],k=c[h],g=b*T,T=v*T,F=e(A,g),I[p]=F,v=A/F,b=g/F,A=x*v+T*b,T=T*v-x*b,g=k*b,k*=v,m=0;n>m;m++)x=l[m][p],F=l[m][h],l[m][p]=x*v+F*b,l[m][h]=F*v-x*b;for(F=e(A,g),c[p]=F,F&&(F=1/F,v=A*F,b=g*F),A=v*T+b*k,x=v*k-b*T,m=0;f>m;m++)k=s[m][p],F=s[m][h],s[m][p]=k*v+F*b,s[m][h]=F*v-k*b}I[L]=0,I[w]=A,c[w]=x}return[c,s,l]}var i=Math.abs,t=Math.sqrt,a=Math.max,u=r.Array32F;r.MachineLearning.svd=r.MachineLearning.singular_value_decomposition=n}(r),r});