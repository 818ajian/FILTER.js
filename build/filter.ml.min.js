/**
*
*   FILTER.js MachineLearning Routines
*   @version: 0.9.6
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Machine Learning Routines)
*   https://github.com/foo123/FILTER.js
*
**/!function(r,f){"use strict";"object"==typeof module&&module.exports?module.exports=f.call(r,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_ML")?define("FILTER_ML",["module","FILTER"],function(e,o){return f.moduleUri=e.uri,f.call(r,o),o}):(f.call(r,r.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return r.FILTER})}(this,function(r){return!function(r,f){"use strict";function e(r,f){for(;f[r][1]!==r;)f[r][1]=f[f[r][1]][1],r=f[r][1];return r}function o(r,f,o){var n=e(r,o),i=e(f,o);n!==i&&(o[n][1]=i)}function n(r,f,e){var o=e.next;return o+1>e.length&&Array.prototype.push.apply(e,new Array(h)),e[o]=[o,o,0],++e.next,o}function i(r,f,i,t,a,c,l,s,p){var m,y,L,M,g,v,w,b,x,A,k,F=f.length,I=F>>>r,E=8===c,R=E?-1:0,T=null,_=null!=p;for(w=new Array(h),w.next=0,b=new u(I),T=_?n(0,0,w):null,b[0]=_&&d(i[0]-p)>s?T:n(0,0,w),L=1;t>L;L++)b[L]=_&&d(i[L]-p)>s?T:d(i[L]-i[L-1])<=s?b[L-1]:n(L,0,w);for(M=1,v=t;a>M;M++,v+=t)for(b[v]=_&&d(i[v]-p)>s?T:d(i[v]-i[v-t])<=s?b[v-t]:n(0,M,w),L=1;t>L;L++)if(_&&d(i[v+L]-p)>s)b[v+L]=T;else{for(y=T===b[v+L-1]?-1:d(i[v+L]-i[v+L-1])<=s?b[v+L-1]:-1,g=R;1>g;g++)T!==b[v-t+L+g]&&d(i[v+L]-i[v-t+L+g])<=s&&(y>=0?o(y,b[v-t+L+g],w):y=b[v-t+L+g]);b[v+L]=y>=0?y:n(L,M,w),E&&T!==b[v+L-1]&&T!==b[v-t+L]&&d(i[v+L-1]-i[v-t+L])<=s&&o(b[v+L-1],b[v-t+L],w)}if(0===T)for(m=0,x=w.next,A=0;x>m;m++)m===w[m][1]&&(w[m][2]=0===w[m][1]?0:++A);else for(m=0,x=w.next,A=0;x>m;m++)m===w[m][1]&&(w[m][2]=A++);if(A=A>0?A:1,l)if(r)for(L=0,m=0;F>m;m+=4,L++)k=w[e(b[L],w)][2],k=255-255*k/A|0,f[m]=f[m+1]=f[m+2]=k;else for(L=0;F>L;L++)k=w[e(b[L],w)][2],k=255-255*k/A|0,f[L]=k;else if(r)for(L=0,m=0;F>m;m+=4,L++)k=w[e(b[L],w)][2],k=255*k/A|0,f[m]=f[m+1]=f[m+2]=k;else for(L=0;F>L;L++)k=w[e(b[L],w)][2],k=255*k/A|0,f[L]=k;return f}function t(r,f,e,o,n,i,t,u,h,p){var m,y,L,M,g,v,w,b,x,A,k,F,I,E,R,T=t.length,_=T>>>2,q=u<<2,U=0,$=T-q,j=0,C=u-1<<2;for(m=r,y=f,L=r,M=f,R=new c(_),F=new a(_<<2),I=0,R[r+f>>>2]=255,f+q>=U&&$>=f+q&&(F[I]=f,F[I+1]=r,F[I+2]=r,F[I+3]=q,I+=4),F[I]=f+q,F[I+1]=r,F[I+2]=r,F[I+3]=-q,I+=4;I>0;){for(I-=4,q=F[I+3],k=F[I]+q,x=F[I+1],A=F[I+2],y=l(y,k),M=s(M,k),m=l(m,x),L=s(L,A),b=x;b>=j&&(v=b+k,w=v>>>2,0===R[w]&&d(e-t[v])<=p&&d(o-t[v+1])<=p&&d(n-t[v+2])<=p);b-=4)R[w]=255,m=l(m,b);if(b>=x){for(v=b+k,w=v>>>2;A>=b&&(0!==R[w]||d(e-t[v])>p||d(o-t[v+1])>p||d(n-t[v+2])>p);)b+=4,v=b+k,w=v>>>2;g=b,E=A>=b}else g=b+4,x>g&&k-q>=U&&$>=k-q&&(F[I]=k,F[I+1]=g,F[I+2]=x-4,F[I+3]=-q,I+=4),b=x+4,E=!0;for(;E;){for(v=b+k,w=v>>>2;C>=b&&0===R[w]&&d(e-t[v])<=p&&d(o-t[v+1])<=p&&d(n-t[v+2])<=p;)R[w]=255,L=s(L,b),b+=4,v=b+k,w=v>>>2;for(k+q>=U&&$>=k+q&&(F[I]=k,F[I+1]=g,F[I+2]=b-4,F[I+3]=q,I+=4),b>A+4&&k-q>=U&&$>=k-q&&(F[I]=k,F[I+1]=A+4,F[I+2]=b-4,F[I+3]=-q,I+=4),v=b+k,w=v>>>2;A>=b&&(0!==R[w]||d(e-t[v])>p||d(o-t[v+1])>p||d(n-t[v+2])>p);)b+=4,v=b+k,w=v>>>2;g=b,E=A>=b}}return i[0]=m,i[1]=y,i[2]=L,i[3]=M,R}var a=r.Array32I,u=r.Array32U,c=r.Array8U,l=Math.min,s=Math.max,d=Math.abs,h=20;r.MachineLearning.connected_components=i,r.MachineLearning.connected_component=t}(r),!function(r,f){"use strict";var e=Math.abs;r.MachineLearning.kmeans=function(r,f,o,n,i,t){t=t||0;for(var a,u,c,l,s,d,h,p,m=f.length,y=new Array(m);;){for(h=0,u=0;m>u;u++){for(s=f[u],l=n(o[0],s),d=0,a=1;r>a;a++)c=n(o[a],s),l>c&&(l=c,d=a);y[u]=d,h+=l}for(a=0;r>a;a++)o[a]=null;for(u=0;m>u;u++)s=f[u],d=y[u],o[d]=i(o[d],s);for(p=0,u=0;m>u;u++)p+=n(o[y[u]],f[u]);if(e(p-h)<=t)break}return y},r.MachineLearning.kmedoids=function(r,f,o,n,i){i=i||0;for(var t,a,u,c,l,s,d,h,p,m,y,L,M=f.length,g=new Array(M);;){for(m=0,a=0;M>a;a++){for(s=f[a],l=n(o[0],s),p=0,t=1;r>t;t++)c=n(o[t],s),l>c&&(l=c,p=t);g[a]=p,m+=l}for(t=0,L=!1;r>t&&!L;){for(d=o[t],a=0;M>a;a++)if(h=f[a],h!==o[g[a]]){for(o[t]=h,y=0,u=0;M>u;u++)y+=n(o[g[u]],f[u]);if(e(y)+i<e(m)){L=!0;break}o[t]=d}t++}if(!L)break}return g}}(r),!function(r,f){"use strict";function e(r,f,e,o,n,i){var t,a,u,c;if(n)if(null!=i)for(t=0,u=0;e>t;t++,u+=e)for(a=0,c=0;e>a;a++,c+=e)r[u+a]=o>a?f[c+t<<i]:0;else for(t=0,u=0;e>t;t++,u+=e)for(a=0;e>a;a++)r[u+a]=o>a?f[a][t]:0;else if(null!=i)for(t=0,u=0,c=0;e>t;t++,u+=e,c+=o)for(a=0;e>a;a++)r[u+a]=o>a?f[c+a<<i]:0;else for(t=0,u=0;e>t;t++,u+=e)for(a=0;e>a;a++)r[u+a]=o>a?f[t][a]:0;return r}function o(r,f,o,c){var l,s,d,h,p,m,y,L,M,g,v,w,b,x,A,k,F,I,E,R,T,_,q,U,$,j,C,D,G,N,S=!1,V=0,z=0,B=0;for(o>f&&(S=!0,b=o,o=f,f=b),x=f*f,A=o*o,b=o*f,h=new i(f),m=0;f>m;m++)h[m]=0;for(l=new i(f),m=0;f>m;m++)l[m]=0;for(d=new i(A),m=0;A>m;m++)d[m]=0;for(s=e(new i(x),r,f,o,S,c),m=0,k=0,F=0;o>m;m++,k+=f,F+=o){if(v=m+1,_=k+f,q=F+o,h[m]=B*z,z=C=B=0,f>m){for(g=m,R=k;f>g;g++,R+=f)B+=t(s[R+m]);if(B){for(g=m,R=k;f>g;g++,R+=f)s[R+m]=s[R+m]/B,C+=s[R+m]*s[R+m];if($=s[k+m],z=$>=0?-a(C):a(C),j=$*z-C,s[k+m]=$-z,m+1!==o)for(L=v;o>L;L++){for(C=0,g=m,R=k;f>g;g++,R+=f)C+=s[R+m]*s[R+L];for($=C/j,g=m,R=k;f>g;g++,R+=f)s[R+L]+=$*s[R+m]}for(g=m,R=k;f>g;g++,R+=f)s[R+m]=s[R+m]*B}}if(l[m]=B*z,z=C=B=0,f>m&&m+1!==o){for(g=v;o>g;g++)B+=t(s[k+g]);if(B){for(g=v;o>g;g++)s[k+g]=s[k+g]*B,C+=s[k+g]*s[k+g];for($=s[k+v],z=$>=0?-a(C):a(C),j=$*z-C,s[k+v]=$-z,g=v;o>g;g++)h[g]=s[k+g]/j;if(m+1!==f)for(L=v,I=_;f>L;L++,I+=f){for(C=0,g=v;o>g;g++)C+=s[I+g]*s[k+g];for(g=v;o>g;g++)s[I+g]+=C*h[g]}for(g=v;o>g;g++)s[k+g]=s[k+g]*B}}V=u(V,t(l[m])+t(h[m]))}for(m=o-1,k=b-f,F=A-o;m>=0;m--,k-=f,F-=o){if(o>m+1){if(z){for(L=v,E=q;o>L;L++,E+=o)d[E+m]=s[k+L]/s[k+v]/z;for(L=v;o>L;L++){for(C=0,g=v,T=q;o>g;g++,T+=o)C+=s[k+g]*d[T+L];for(g=v,T=q;o>g;g++,T+=o)d[T+L]+=C*d[T+m]}}for(L=v,E=q;o>L;L++,E+=o)d[F+L]=d[E+m]=0}d[F+m]=1,z=h[m],v=m,_=k,q=F}for(m=o-1,k=b-f,F=A-o;m>=0;m--,k-=f,F-=o){if(v=m+1,_=k+f,q=F+o,z=l[m],o>m+1)for(L=v;o>L;L++)s[k+L]=0;if(z){if(z=1/z,m+1!==o)for(L=v;o>L;L++){for(C=0,g=v,R=_;f>g;g++,R+=f)C+=s[R+m]*s[R+L];for($=C/s[k+m]*z,g=m,R=k;f>g;g++,R+=f)s[R+L]+=$*s[R+m]}for(L=m,I=k;f>L;L++,I+=f)s[I+m]=s[I+m]*z}else for(L=m,I=k;f>L;L++,I+=f)s[I+m]=0;++s[k+m]}for(g=o-1;g>=0;g--)for(y=0;30>y;y++){for(p=1,v=g;v>=0;v--){if(w=v-1,t(h[v])+V===V){p=0;break}if(t(l[w])+V===V)break}if(p)for(U=0,C=1,m=v;g>=m;m++)if($=C*h[m],t($)+V!==V)for(z=l[m],j=n($,z),l[m]=j,j=1/j,U=z*j,C=-$*j,L=0,I=0;f>L;L++,I+=f)G=s[I+w],N=s[I+m],s[I+w]=G*U+N*C,s[I+m]=N*U-G*C;if(N=l[g],v===g){if(0>N)for(l[g]=-N,L=0,E=0;o>L;L++,E+=o)d[E+g]=-d[E+g];break}if(y>=30)throw"SVD: No convergence after 30,000! iterations";for(D=l[v],w=g-1,G=l[w],z=h[w],j=h[g],$=((G-N)*(G+N)+(z-j)*(z+j))/(2*j*G),z=n($,1),$=((D-N)*(D+N)+j*(G/($+($>=0?t(z):-t(z)))-j))/D,U=C=1,L=v;w>=L;L++){for(m=L+1,z=h[m],G=l[m],j=C*z,z=U*z,N=n($,j),h[L]=N,U=$/N,C=j/N,$=D*U+z*C,z=z*U-D*C,j=G*C,G*=U,M=0,E=0;o>M;M++,E+=o)D=d[E+L],N=d[E+m],d[E+L]=D*U+N*C,d[E+m]=N*U-D*C;for(N=n($,j),l[L]=N,N&&(N=1/N,U=$*N,C=j*N),$=U*z+C*G,D=U*G-C*z,M=0,I=0;f>M;M++,I+=f)G=s[I+L],N=s[I+m],s[I+L]=G*U+N*C,s[I+m]=N*U-G*C}h[v]=0,h[g]=$,l[g]=D}return S?[l,d,s]:[l,s,d]}var n=r.Util.Geometry.pythagorean_distance,i=r.Array32F,t=Math.abs,a=Math.sqrt,u=Math.max;r.MachineLearning.svd=r.MachineLearning.singular_value_decomposition=o}(r),r});